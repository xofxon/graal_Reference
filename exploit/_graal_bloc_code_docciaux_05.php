<?php
	//  Recherche informations transporteur      
  $sql_req_00="SELECT IFNULL(round(poids_bru,2),-1) as poidsbrut_memo,nomcommercial as transporteur,round(nombre_colis,0) as nbcolis_memo FROM $vl_c_fic_transporteur left join _acteurs on ($vl_c_fic_transporteur.act_cleunik_trans=_acteurs.act_cleunik) where commercial_cleunik=$vl_commercial_cleunik";
  $result_00=_graal_requete_bd($sql_req_00);
  if (mysql_num_rows($result_00)==0) {
    $transporteur="";
    $nbcolis_memo=-1;
    $poidsbrut_memo=-1;
  } else {
    $row_00 = mysql_fetch_assoc($result_00);
    $transporteur=$row_00['transporteur'];
    $nbcolis_memo=$row_00['nbcolis_memo'];
    $poidsbrut_memo=$row_00['poidsbrut_memo'];
  }
  _graal_libere_requete_bd($result_00);
  //  Recherche informations calculées (nombre de colis, poids etc)
  $sql_req_00="select IFNULL(round(sum(a3.qte * a1.poidsbrut),2),-1) AS poidsbrut_calcule,round(sum(a3.qte_condi),0) AS nbcolis_calcule from $vl_c_fic_ligne a1 left join $vl_c_fic_qte a3 using (commercial_ligne_cleunik) where a1.commercial_cleunik=$vl_commercial_cleunik group by a1.commercial_cleunik;";
  $result_00=_graal_requete_bd($sql_req_00);
  $row_00 = mysql_fetch_assoc($result_00);
  $nbcolis_calcule=$row_00['nbcolis_calcule'];
  $poidsbrut_calcule=$row_00['poidsbrut_calcule'];
  _graal_libere_requete_bd($result_00);
  if (($poidsbrut_memo==-1)||($poidsbrut_memo==0)) {$poidsbrut=$poidsbrut_calcule;} else {if ($poidsbrut_memo==-2) {$poidsbrut=0;} else {$poidsbrut=$poidsbrut_memo;}}
  if (($nbcolis_memo==-1)||($nbcolis_memo==0)) {$nbcolis=$nbcolis_calcule;} else {if ($nbcolis_memo==-1) {$nbcolis=0;} else {$nbcolis=$nbcolis_memo;}}
  //	Impression première partie de l'entête
	$this->_graal_logo($param_generaux_graal_027,10,6,$param_generaux_graal_071,$param_generaux_graal_072);
  $this->SetFont($this->police_du_document, "B",11);
  $this->_graal_pdf_cadre_00($contenu="Livraison ".$this->contenu_code,$colonne=120,$ligne=10,$largeur=80,$hauteur=10,"1111","DF");
  $this->_graal_pdf_cadre_00("Page ".$this->getPage()."/{nombredepages}",$colonne=120,$ligne=20,$largeur=20,$hauteur=10,'0000');
  $this->_graal_pdf_cadre_00("Le $datecre",$colonne=140,$ligne=20,$largeur=27,$hauteur=10,'0000');
  $this->_graal_pdf_cadre_00("$codealphanum15",$colonne=167,$ligne=20,$largeur=33,$hauteur=10,'0000');
  $this->SetFont($this->police_du_document, "",10);
  $this->_graal_pdf_cadre_01($this->contenu_dateexp,$legende="Date de départ",$colonne=10,$ligne=80,$largeur=25,$hauteur=10,'0011');
  $this->_graal_pdf_cadre_01($dateliv,$legende="Livraison au plus tard",$colonne=35,$ligne=80,$largeur=35,$hauteur=10,'0011');
	if ($nbcolis!=0) {
	  $this->_graal_pdf_cadre_01($nbcolis,$legende="Nombre de colis",$colonne=70,$ligne=80,$largeur=60,$hauteur=10,'0000');
	  if (trim($vosreferences)!="") {
	    $this->_graal_pdf_cadre_01($vosreferences,$legende="Vos références",$colonne=130,$ligne=80,$largeur=70,$hauteur=10,'0011');
	  }
	} else {
		if (trim($vosreferences)!="") {
	    $this->_graal_pdf_cadre_01($vosreferences,$legende="Vos références",$colonne=70,$ligne=80,$largeur=70,$hauteur=10,'0011');
	  }
	}
?>
