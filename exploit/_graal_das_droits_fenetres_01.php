<?php
include("_graal_header_xml.inc.php");
$vl_c_dico_00014=fa_recup_dico('dico_00014');
$vl_c_dico_00015=fa_recup_dico('dico_00015');
$vl_e_uti_cleunik=intval(fa_recup_param('vl_e_uti_cleunik','0'));
$vl_e_langue=intval(fa_recup_session('langue_appli','120131'));
//  Fenêtres pour lesquelles, pour un utilisateur donné, on a des droits d'accès aux fenêtres
$sql_req = "SELECT _objets.titre AS titre,_objets_libelle.descriptif AS descriptif,_objets.fen_cleunik as fen_cleunik,_droits_uti_fen.duf_cleunik as duf_cleunik,";
$sql_req.= " _droits_uti_fen.duf_acces as acces,_droits_uti_fen.duf_ajout as ajout,_droits_uti_fen.duf_modif as modif,_droits_uti_fen.duf_suppr as suppr ";
$sql_req.= " FROM _objets,_droits_uti_fen,_objets_libelle WHERE _objets.type_objet=1 and _objets.fen_cleunik=_droits_uti_fen.fen_cleunik ";
$sql_req.= " and _droits_uti_fen.uti_cleunik=$vl_e_uti_cleunik and _objets.fen_cleunik=_objets_libelle.fen_cleunik and _objets_libelle.langue=$vl_e_langue ORDER BY descriptif;";
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' duf_cleunik="'.fa_ent_xml($row['duf_cleunik']).'"');
  echo(' fen_cleunik="'.fa_ent_xml($row['fen_cleunik']).'"');
  echo(' titre="'.fa_ent_xml($row['titre']).'"');
  echo(' descriptif="'.fa_ent_xml($row['descriptif']).'"');
  switch (fa_ent_xml($row['acces'])){
    case 1 :echo(" acces=''");break;
    default :echo(" acces='$vl_c_dico_00015'");break;
  }      
  switch (fa_ent_xml($row['ajout'])){
    case 1 :echo(" ajout=''");break;
    default :echo(" ajout='$vl_c_dico_00014'");break;
  }      
  switch (fa_ent_xml($row['modif'])){
    case 1 :echo(" modif=''");break;
    default :echo(" modif='$vl_c_dico_00014'");break;
  }      
  switch (fa_ent_xml($row['suppr'])){
    case 1 :echo(" suppr=''");break;
    default :echo(" suppr='$vl_c_dico_00014'");break;
  }
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
