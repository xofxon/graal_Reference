<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
<window  onload="fa_gid('arbre').view.selection.select(0);pf_sel_ligne('arbre',0);" title="test XsOFtware" orient="vertical" xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" xmlns:html="http://www.w3.org/1999/xhtml" >
<script type="application/x-javascript"><![CDATA[

function pf_init(){
var vv_objet=fa_gid("arbre")
  var rowIndex = vv_objet.currentIndex;
  if(rowIndex == -1){return;}
	fa_gid("arbre").startEditing(rowIndex,fa_gid("arbre").columns.getNamedColumn("sender"));
}
function pf_sel_ligne(vv_objet,vv_noligne){
	var vv_objet=fa_gid("arbre");
	var rowIndex =-1;
	if (vv_noligne!="undefined"){
		rowIndex=vv_noligne;
		//alert(rowIndex);
	} else {
		rowIndex=vv_objet.currentIndex;
	}
  	if(rowIndex == -1){return;}
	fa_gid("arbre").startEditing(rowIndex,fa_gid("arbre").columns.getNamedColumn("sender"));
	//pf_numerote_ligne()
}
function pf_ligne_suivante(){
var vv_objet=fa_gid("arbre")
var vl_e_nb=fa_gid("arbre").view.rowCount;
//alert("nombre : "+vl_e_nb)
  var rowIndex = vv_objet.currentIndex;
  //fa_gid("ligne_en_cours").value=rowIndex;
  if(rowIndex == -1){return;}
  //alert("A->"+rowIndex)
  if (vl_e_nb-1<=rowIndex){
  	//alert("Dernière ligne atteinte->"+rowIndex+"<-B vl_e_nb->"+vl_e_nb)
  	fa_gid('arbre').view.selection.select(rowIndex)
	fa_gid("arbre").startEditing(rowIndex,fa_gid("arbre").columns.getNamedColumn("sender"));
  	return;
  }
  //alert("B->"+rowIndex+"<-B vl_e_nb->"+vl_e_nb)
  rowIndex++;
  //alert("C->"+rowIndex)
  fa_gid('arbre').view.selection.select(rowIndex)
	fa_gid("arbre").startEditing(rowIndex,fa_gid("arbre").columns.getNamedColumn("sender"));
	
	//pf_numerote_ligne()
}
function pf_ligne_précedente(){
var vv_objet=fa_gid("arbre")
var vl_e_nb=fa_gid("arbre").view.rowCount;
//alert("nombre : "+vl_e_nb)
  var rowIndex = vv_objet.currentIndex;
  //fa_gid("ligne_en_cours").value=rowIndex;
  if(rowIndex == -1){return;}
  //alert("AA->"+rowIndex)
  //if (vl_e_nb>=rowIndex){return;}
  //alert("BB->"+rowIndex)
  if (rowIndex == 0){
  	//alert("Première ligne atteinte->"+rowIndex+"<-B vl_e_nb->"+vl_e_nb)
  	fa_gid('arbre').view.selection.select(0)
	fa_gid("arbre").startEditing(0,fa_gid("arbre").columns.getNamedColumn("sender"));
  	return;
  }
  rowIndex--;
  //alert("CC->"+rowIndex)
  fa_gid('arbre').view.selection.select(rowIndex)
	fa_gid("arbre").startEditing(rowIndex,fa_gid("arbre").columns.getNamedColumn("sender"));
	
	//pf_numerote_ligne()
}
function fa_gid(vv_quoi){
  try {
    return document.getElementById(vv_quoi);
    } catch (e) {
		return null;
	}
}
function pf_old_clavier(e) {
	//fa_gid("clavier").value=e.keyCode
	try {
		switch(e.keyCode){
      case 13: return false;break;// 'Enter'	//	Surtout pas enter !!!
      case 9: return false;break;// 'Tab'
      case 1:
        pf_ligne_suivante();
        break;
      default:
        break;
    }
 	} catch (e) {
    alert("erreur"+e)
  }
}
function pf_clavier(e) {
	//fa_gid("clavier").value=e.keyCode
	try {
		switch(e.keyCode){
      case 13: // 'Enter'	//	Surtout pas enter !!!
      case 9: // 'Tab'
      case 40: // 'flèche basse'
      pf_ligne_suivante();
      	break;
      case 38:	//	flèche précédente
        pf_ligne_précedente()
        break;
      default:
        break;
    }
 	} catch (e) {
    alert("erreur"+e)
  }
}


function pf_numerote_ligne(){
	var vv_objet=fa_gid("arbre")
  	var rowIndex = vv_objet.currentIndex;
  	fa_gid("ligne_en_cours").value=rowIndex;
}
]]></script>
<raf_keyset>
	<key id="connect" raf_keycode="VK_RETURN" oncommand="pf_ligne_suivante();" />
	<key id="connect" modifiers="control" raf_keycode="VK_RETURN" oncommand="pf_sel_ligne('arbre');" />
</raf_keyset>
<label value="ligne en cours" /><textbox id="ligne_en_cours" value="" />
<label value="clavier" /><textbox id="clavier" value="" />
<tree editable="true" flex="1" id="arbre" disableKeyNavigation="true" old_onselect="pf_numerote_ligne()" onkeyup="pf_clavier(event);">
   <treecols>
     <treecol id="sender" label="Sender" flex="1" name="colonne1"/>
     <treecol id="subject" label="Subject" flex="2" editable="false"/>
   </treecols>
   <treechildren>
     <treeitem>
       <treerow>
         <treecell label="ligne 1" editable="true" type="number"/>
         <treecell label="Top secret plans" />
       </treerow>

     </treeitem>
<treeitem>
       <treerow>
         <treecell label="ligne 2"/>
         <treecell label="Top secret plans" editable="false"/>
       </treerow>

     </treeitem>
     <treeitem>
       <treerow>
         <treecell label="ligne 3"/>
         <treecell label="Top secret plans" editable="false"/>
       </treerow>

     </treeitem>
   </treechildren>
 </tree>

</window>
 