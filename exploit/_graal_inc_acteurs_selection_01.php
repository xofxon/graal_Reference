<?php
include("_graal_var_portee.php");
error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);  //  Pour éviter les warnings éventuels générés par simplexml_load_string
_graal_requete_charge_varlib($vl_c_id_inc_acteurs_selection_01,$vl_e_uti_cleunik);
$vl_c_bao_001=fa_recup_dico("bao_001");
$vl_c_bao_002=fa_recup_dico("bao_002");
$vl_c_bao_003=fa_recup_dico("bao_003");
$vl_c_bao_004=fa_recup_dico("bao_004");
$vl_c_bao_005=fa_recup_dico("bao_005");
$vl_c_bao_006=fa_recup_dico("bao_006");
$vl_c_bao_007=fa_recup_dico("bao_007");
$vl_c_bao_010=fa_recup_dico("bao_010");
$vl_c_bao_011=fa_recup_dico("bao_011");
$vl_c_bao_012=fa_recup_dico("bao_012");
$vl_c_bao_013=fa_recup_dico("bao_013");
$vl_c_bao_014=fa_recup_dico("bao_014");
$vl_c_bao_015=fa_recup_dico("bao_015");
$vl_c_bao_016=fa_recup_dico("bao_016");
$vl_c_bao_017=fa_recup_dico("bao_017");
$vl_c_bao_018=fa_recup_dico("bao_018");
$vl_c_bao_019=fa_recup_dico("bao_019");
$vl_c_bao_020=fa_recup_dico("bao_020");
$vl_c_bao_021=fa_recup_dico("bao_021");
$vl_c_bao_022=fa_recup_dico("bao_022");
$vl_c_bao_023=fa_recup_dico("bao_023");
$vl_c_bao_024=fa_recup_dico("bao_024");
$vl_c_dico_00018=fa_recup_dico("dico_00018");
$vl_c_dico_00029=fa_recup_dico("dico_00029");
$vl_c_dico_00020=fa_recup_dico("dico_00020");
$vl_c_dico_00021=fa_recup_dico("dico_00021");
$vl_c_dico_00022=fa_recup_dico("dico_00022");
$vl_c_dico_00023=fa_recup_dico("dico_00023");
$vl_c_dico_00024=fa_recup_dico("dico_00024");
$vl_c_dico_00025=fa_recup_dico("dico_00025");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_dico_00082=fa_recup_dico("dico_00082");
$vl_c_selqui_01="false";
$vl_c_selqui_02="false";
$vl_c_selqui_03="false";
$vl_c_selqui_04="false";
$vl_c_selqui_05="false";
$vl_c_selqui_06="false";
$vl_c_selqui_07="false";
$vl_c_selqui_08="false";
$vl_c_selqui_09="false";
$vl_c_selqui_10="false";
$vl_c_selqui_11="false";
$vl_c_selqui_12="false";
$vl_c_inactif="true";
$vl_e_portee=$vl_e_acteur;

$vl_e_portee=$vl_e_acteur+$vl_e_interl;

$vl_e_portee=0;
switch ($vl_c_id_inc_acteurs_selection_01) {
  //case "Div_00040":$vl_c_selqui_09="true";$vl_e_portee+=0;$vl_c_inactif="false";break;  //Tous les acteurs
  case "Div_00040":$vl_c_selqui_09="true";$vl_e_portee+=$vl_e_procli+$vl_e_profou+$vl_e_client+$vl_e_fourni+$vl_e_autrac+$vl_e_actind;$vl_c_inactif="false";break;  //Tous les acteurs
  case "Div_00165":$vl_c_selqui_02="true";$vl_e_portee=-1;break; //  Mes acteurs favoris
  case "Div_00042":$vl_c_selqui_03="true";$vl_e_portee+=$vl_e_procli;break; //  Prospects Clients
  case "Div_00043":$vl_c_selqui_05="true";$vl_e_portee+=$vl_e_profou;break; //  Prospects Fournisseurs
  case "Div_00044":$vl_c_selqui_04="true";$vl_e_portee+=$vl_e_client;break; //  Clients
  case "Div_00045":$vl_c_selqui_06="true";$vl_e_portee+=$vl_e_fourni;break; //  Fournisseurs
  case "Div_00046":$vl_c_selqui_07="true";$vl_e_portee+=$vl_e_autrac;break; //  Autres
  case "Div_00047":$vl_c_selqui_08="true";$vl_e_portee+=$vl_e_actind;break; //  Indéterminés
  case "Div_00515":$vl_c_selqui_12="true";$vl_e_portee=-1;break; //  Transporteurs
}
$vf_c_url_alimente_table="_graal_das_paniers_01.php?vl_c_actif=1&vl_special=1&vl_e_maportee=";
$vl_c_source_paniers="$vf_c_url_alimente_table$vl_e_portee";
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
switch ($vl_c_genre_rech) {
	case "postale":
		if (isset($vl_c_xml->selection_postale)){$selection_acteur=$vl_c_xml->selection_postale->attributes();}else{$selection_acteur='1';}
		break;
	case "geophysique":
		if (isset($vl_c_xml->selection_geophysique)){$selection_acteur=$vl_c_xml->selection_geophysique->attributes();}else{$selection_acteur='1';}
		break;
	case "site":
		if (isset($vl_c_xml->selection_site)){$selection_acteur=$vl_c_xml->selection_site->attributes();}else{$selection_acteur='1';}
		break;
	default:
		$selection_acteur=fa_ent_xml($vl_c_xml->selection_acteur->attributes());
		break;
}
if (isset($vl_c_xml->vl_selact_nbcaracrech)){$vl_selact_nbcaracrech=$vl_c_xml->vl_selact_nbcaracrech->attributes();}else{$vl_selact_nbcaracrech='3';}
switch ($vl_c_type) {
	case "6":$vl_c_value_bao_ml_actif="6";break;
	default:$vl_c_value_bao_ml_actif="3";break;

}
echo <<<END
<script type="text/javascript">
<![CDATA[
function po_change_menu() {
  var vo_list = fa_gid("bao_ml_qui");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
  fa_das("bao_ml_actif","$vl_c_source_paniers"+"&raf_random="+Math.random()+"&");
}
function po_change_menu_actifs() {
  var vo_list = document.getElementById("bao_ml_actif");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
}
function po_selbao_ml_actif() {
  var item=fa_gid("bao_ml_actif").selectedItem;
  var vl_portee=item.getAttribute("value");
  switch (vl_portee) {
    case "0":case "1":case "2":case "6":
      fa_cache_non("hb_recherche_acteurs");
      break;
    case "3":
      fa_cache_oui("hb_recherche_acteurs");
      break;
  }
}
]]>
</script>
  <vbox id="aai_acteurs_02" class='overflow_01' collapsed="$collapsed_aai_acteurs_02">
    <hbox id="hb_recherche_acteurs_00" collapsed="$collapsed_00">
    $vl_menulist_utilisateurs
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bao_ml_actif" oncommand="po_selbao_ml_actif();po_change_menu_actifs();pf_approximatif();" flags="" ref="*" querytype="xml" datasources="" >
      <menupopup>
        <menuitem label="$vl_c_dico_00046" tooltiptext="$vl_c_dico_00046" value="1" class="sans_icone" selected="true" /> <!--  Actifs-->
        <menuitem label="$vl_c_dico_00047" tooltiptext="$vl_c_dico_00047" value="2" class="sans_icone" /> <!--  Inactifs-->
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" value="0" class="sans_icone" /> <!--  Tous-->
      </menupopup>
      <template><query expr="*"/><action>
        <menupopup>
          <menuseparator/>
          <menuitem uri="?" class="menuitem-iconic ?prop" label="?panier_titre" tooltiptext="?panier_titre" selected="true" value="$vl_c_value_bao_ml_actif" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers-->
        </menupopup>
      </action></template>
    </menulist>
    </hbox>
    <hbox id="hb_recherche_acteurs" >
    <menulist sizetopopup="none" collapsed="$collapsed_acteurs" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="1" id="bao_ml_qui" oncommand="po_sel();pf_approximatif();">
      <menupopup>
        <menuitem class="menuitem-iconic ag15" label="$vl_c_dico_00029" tooltiptext="$vl_c_dico_00029" selected="$vl_c_selqui_02" value="888888" _graal_portee="999999999999"/> <!--  Acteurs favoris-->
        <menuitem class="menuitem-iconic ai17" label="$vl_c_dico_00020" tooltiptext="$vl_c_dico_00020" selected="$vl_c_selqui_03" value="110001" _graal_portee="$vl_e_procli"/> <!--  Prospects clients-->
        <menuitem class="menuitem-iconic ai14" label="$vl_c_dico_00021" tooltiptext="$vl_c_dico_00021" selected="$vl_c_selqui_04" value="110003" _graal_portee="$vl_e_client"/> <!--  Clients-->
        <menuitem class="menuitem-iconic ah10" label="$vl_c_dico_00022" tooltiptext="$vl_c_dico_00022" selected="$vl_c_selqui_05" value="110002" _graal_portee="$vl_e_profou"/> <!--  Prospects fournisseurs-->
        <menuitem class="menuitem-iconic ah06" label="$vl_c_dico_00023" tooltiptext="$vl_c_dico_00023" selected="$vl_c_selqui_06" value="110004" _graal_portee="$vl_e_fourni"/> <!--  Fournisseurs-->
        <menuitem class="menuitem-iconic ai16" label="$vl_c_dico_00024" tooltiptext="$vl_c_dico_00024" selected="$vl_c_selqui_07" value="110005" _graal_portee="$vl_e_autrac"/> <!--  Autres acteurs-->
        <menuitem class="menuitem-iconic aj08" label="$vl_c_dico_00025" tooltiptext="$vl_c_dico_00025" selected="$vl_c_selqui_08" value="110006" _graal_portee="$vl_e_actind"/> <!--  Acteurs indéterminés-->
        <menuitem class="menuitem-iconic ai15" label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" selected="$vl_c_selqui_09" value="999999" _graal_portee="000000000000"/> <!--  Tous les acteurs-->
        <menuitem class="menuitem-iconic xx01" label="$vl_c_dico_00082" tooltiptext="$vl_c_dico_00082" selected="$vl_c_selqui_12" value="666666" _graal_portee="000000000000"/> <!--   Tous les transporteurs-->
      </menupopup>
    </menulist>
    <label flex="0" value="$vl_c_bao_002" collapsed="$collapsed_01"/>
  <textbox  collapsed="$collapsed_01" minwidth="60" flex="2" value="$vl_c_bao_010" id="aai_tb_rechapproxima" oninput="if ('$vl_selact_nbcaracrech'!='-1') {if (this.value.length>=$vl_selact_nbcaracrech){pf_approximatif();}}" old_oninput="pf_approximatif()"/>
  <menulist sizetopopup="none" collapsed="$collapsed_01" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' class="normal" flex="1" id="aai_ml_type" oncommand="pf_approximatif();">
    <menupopup>
      <menuitem label="$vl_c_bao_003" selected="true" class="sans_icone" value="1"/>
      <menuitem hidden="true" label="$vl_c_bao_004" class="sans_icone" value="2"/>
    </menupopup>
  </menulist>
  <label collapsed="$collapsed_01" flex="0" value="$vl_c_bao_005"/>
  <menulist sizetopopup="none" collapsed="$collapsed_01" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' class="normal" flex="1" id="aai_ml_zone" oncommand="pf_approximatif();" value="$selection_acteur">
    <menupopup>
      <menuitem label="$vl_c_bao_006" tooltiptext="$vl_c_bao_006" class="sans_icone" value="1"/>
      <menuitem label="$vl_c_bao_007" tooltiptext="$vl_c_bao_007" class="sans_icone" value="2"/>
      <menuitem label="$vl_c_bao_011" tooltiptext="$vl_c_bao_011" class="sans_icone" value="3"/>
      <menuitem label="$vl_c_bao_012" tooltiptext="$vl_c_bao_012" class="sans_icone" value="4"/>
      <menuitem label="$vl_c_bao_013" tooltiptext="$vl_c_bao_013" class="sans_icone" value="5" hidden="$vl_c_infos_adresses"/>
      <menuitem label="$vl_c_bao_014" tooltiptext="$vl_c_bao_014" class="sans_icone" value="6" hidden="$vl_c_infos_adresses"/>
	  <menuitem label="$vl_c_bao_017" tooltiptext="$vl_c_bao_017" class="sans_icone" value="7" hidden="$vl_c_infos_sitesweb"/>
      <menuitem label="$vl_c_bao_018" tooltiptext="$vl_c_bao_018" class="sans_icone" value="8"/>
      <menuitem label="$vl_c_bao_019" tooltiptext="$vl_c_bao_019" class="sans_icone" value="9"/>
      <menuitem label="$vl_c_bao_020" tooltiptext="$vl_c_bao_020" class="sans_icone" value="10"/>
      <menuitem label="$vl_c_bao_021" tooltiptext="$vl_c_bao_021" class="sans_icone" value="11"/>
      <menuitem label="$vl_c_bao_022" tooltiptext="$vl_c_bao_022" class="sans_icone" value="12"/>
      <menuitem label="$vl_c_bao_023" tooltiptext="$vl_c_bao_023" class="sans_icone" value="13"/>
      <menuitem label="$vl_c_bao_024" tooltiptext="$vl_c_bao_024" class="sans_icone" value="14"/>
    </menupopup>
  </menulist>
  <label collapsed="$collapsed_01" value="$vl_c_bao_015"/>
  <textbox  collapsed="$collapsed_01" value="$vl_c_bao_016" id="bao_tb_limit" old_oninput="pf_approximatif();" size="4" type="number" hidespinbuttons="true"/>
  <toolbarbutton class="table-rafraichir" oncommand="pf_approximatif();"/>
  <button id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_win_id')" />
  </hbox>
</vbox>
END;
?>
