<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_c_url=fa_recup_param('vl_c_url','http://mib.fr');
$vl_c_genre=fa_recup_param('genre','keyword');
//$vl_c_url=fa_recup_param('vl_c_url','http://xulfr.org');
$meta_tags=get_meta_tags($vl_c_url);
$charset=fa_extrait_charset($vl_c_url);

/*
echo('<Description>');
echo('<charset data="'.fa_remplace_quotes(trim($charset)).'"/>');
echo('</Description>');
*/
switch (strtolower($charset)) {
  case 'utf-8':
    $k0=$meta_tags['keywords'];
    $k1=html_entity_decode($k0,ENT_QUOTES);
    //$k2=fa_ent_xml(utf8_encode($k1));
    $keywords=$k1;

    $k0=$meta_tags['description'];
    $k1=html_entity_decode($k0,ENT_QUOTES);
    //$k2=fa_ent_xml(utf8_encode($k1));
    $description=$k1;
    break;
  case 'iso-8859-1':
  case "windows-1250":  
  default:
    $k0=utf8_encode($meta_tags['keywords']);
    $k1=html_entity_decode($k0,ENT_QUOTES);
    //$k2=fa_ent_xml(utf8_encode($k1));
    
    $keywords=$k1;
    /*
    $keywords=$meta_tags['keywords']; //  Plante sur "réseau"
    $keywords=html_entity_decode($meta_tags['keywords']); //  ne plante pas mais "réseau" n'est pas bon
    */
    $k0=utf8_encode($meta_tags['description']);
    $k1=html_entity_decode($k0,ENT_QUOTES);
    //$k2=fa_ent_xml(utf8_encode($k1));
    $description=$k1;

    break; 
}
$k0=isUTF8($meta_tags['keywords']);
$k1=html_entity_decode($k0,ENT_QUOTES);
function isUTF8($string)
{
   if (is_array($string))
   {
      $enc = implode('', $string);
      return @!((ord($enc[0]) != 239) && (ord($enc[1]) != 187) && (ord($enc[2]) != 191));
   }
   else
   {
      return (utf8_encode(utf8_decode($string)) == $string);
   }   
}

switch ($vl_c_genre) {
  case 'keyword':
    echo(fa_xcree_entete_rdf());
    $pieces = explode(",", $keywords);
    $vl_e_i=count($pieces);
    if ($vl_e_i==1) {
      $pieces = explode(" ", $keywords);
      $vl_e_i=count($pieces);
    }
    $vl_e_j = 0;
    while ($vl_e_j < $vl_e_i):
      echo('<RDF:li>'.EOL);
      echo('<RDF:Description>');
      echo('<row:tag >'.fa_ent_xml(fa_remplace_quotes(trim($pieces[$vl_e_j]))).'</row:tag>');
      $vl_e_j++;
      echo('</RDF:Description>'.EOL);
      echo('</RDF:li>'.EOL);
    endwhile;
    echo('</RDF:Bag>'.EOL);
    echo('</RDF:RDF>'.EOL);
    break;
  case 'description':
    echo(fa_xcree_entete_xml());
    echo('<Description>');
    if ($description=='') {
      echo('<nombre data="0"/>');
    }
    else {
      echo('<nombre data="1"/>');
    }
    echo('<description data="'.fa_ent_xml(trim($description)).'"/>');
    echo('</Description>');
    break;
}
?>
