<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_param_pc_01";
fa_acces_script();
$vf_c_echo="";
//IMPORTANT IMPORTANT IMPORTANT IMPORTANT
//Bien penser à utiliser intval pour convertir les données numériques
//Bien penser à utiliser intval pour convertir les données numériques
//Bien penser à utiliser intval pour convertir les données numériques
$vl_pc_cleunik=intval(fa_recup_param("vl_pc_cleunik",0));
$vl_code=fa_recup_param("vl_code","");
$vl_intitule=fa_recup_param("vl_intitule","");
$vl_actif=intval(fa_recup_param("vl_actif",1));
$vf_c_action=fa_recup_param("vf_c_action","??????");
switch (TRUE){
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _param_pc WHERE _param_pc.pc_cleunik=$vl_pc_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="ajouter":
    $vl_pc_cleunik=_graal_requete_max("pc_cleunik","_param_pc");
    $sql_req = "INSERT INTO _param_pc set pc_cleunik=$vl_pc_cleunik,code='$vl_code',intitule='$vl_intitule',dateheurecreation=now(),actif=$vl_actif";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE _param_pc set code='$vl_code',intitule='$vl_intitule',dateheuremodification=now(),actif=$vl_actif WHERE _param_pc.pc_cleunik=$vl_pc_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="verifier_existant":
    $sql_req = "SELECT count(*) as nombre from _param_pc where code='$vl_code' and pc_cleunik<>$vl_pc_cleunik";
    $result = _graal_requete_bd($sql_req);
    $row = mysql_fetch_assoc($result);
    $nombre=$row['nombre'];
    _graal_libere_requete_bd($result);
    if($nombre==0) {$vf_c_echo="ok";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="verifier_nouveau":
    $sql_req = "SELECT count(*) as nombre from _param_pc where code='$vl_code'";
    $result = _graal_requete_bd($sql_req);
    $row = mysql_fetch_assoc($result);
    $nombre=$row['nombre'];
    _graal_libere_requete_bd($result);
    if($nombre==0) {$vf_c_echo="ok";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
