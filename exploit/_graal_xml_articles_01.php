<?php
//Devrait être enregistré sous forme _graal_xml_article_01.php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_art_cleunik=intval(fa_recup_param("vl_e_art_cleunik",'-1'));
$sql_req =" SELECT _article.art_cleunik as `art_cleunik`,_article.code as `code`,_article.indice as `indice`,_article.mnemotechnique as `mnemotechnique`,";
$sql_req.=" _article.description as `description`,_article.blocnotebrut as `blocnotebrut`,_article.blocnotertf as `blocnotertf`,_article.dateheurecreation as `dateheurecreation`,";
$sql_req.=" _article.dateheuremodif as `dateheuremodif`,date(_article.dateheurevalidite) as `dateheurevalidite`,_article.types_gestion as `types_gestion`,";
$sql_req.=" _article.actif as `actif`,_article.nbdec_prix as `nbdec_prix`,_article.nbdec_qte as `nbdec_qte`,_article.pr_generique as `pr_generique`,_art_stock.qte_stock as `qte_stock`,";
$sql_req.=" _art_stock.unite_stock as `unite_stock`,";
$sql_req.=" _art_stock.qte_inven as `qte_inven`,_art_stock.dateheure_invent as `dateheure_invent`,_art_stock.pu_reference as `pu_reference`,_art_stock.gestion as `gestion`,";
$sql_req.=" _art_stock.qte_mini as `qte_mini`,_art_stock.qte_maxi as `qte_maxi`,_art_stock.qte_securite,_art_stock.qte_alerte,_art_stock.cumul_entrees as 'cumul_entrees',";
$sql_req.=" _art_stock.cumul_sorties as 'cumul_sorties',_art_stock.nb_decimales_qte,_art_stock.unite_condi,_art_stock.nb_stock_in_condi,_art_achats.delai_reappro as `delai_reappro`,";
$sql_req.=" _art_achats.unite_reappro as `unite_reappro`,_art_achats.der_pa as `der_pa`,_art_achats.pamp as `pamp`,_art_achats.dateheure_der_achat as `dateheure_der_achat`,";
$sql_req.=" _art_achats.unite_achat as `unite_achat`,(select count(*) from _nomenclatures_fab where _nomenclatures_fab.art_cleunik_fils=_article.art_cleunik) as nombre_nomenc_fab,";
$sql_req.=" _art_fabs.multiple_base,_art_fabs.pr,_art_fabs.nbdec_pr,(select count(*) from _fab_lignes where _fab_lignes.art_cleunik=_article.art_cleunik) as nombre_fabrications,";
$sql_req.=" (select count(*) from _fab_lignes_nomenc where _fab_lignes_nomenc.art_cleunik_fils=_article.art_cleunik) as nombre_composants_fabrications,_art_dimensions.capacite as capacite,";
$sql_req.=" _art_dimensions.unite_capacite as unite_capacite,_art_dimensions.unite_poids as unite_poids,_art_dimensions.poids_brut as poids_brut,_art_dimensions.poids_net as poids_net,";
$sql_req.=" _art_dimensions.tare as tare,_art_dimensions.unite_longueur as unite_longueur,_art_dimensions.longueur as longueur,_art_dimensions.largeur as largeur,_art_dimensions.epaisseur as epaisseur,";
$sql_req.=" _art_ventes.unite_vente,f7.code as code_deb,f7.libelle as libelle_deb,_article.nc_2009_autosuffisant_cleunik as nc_2009_autosuffisant_cleunik";
$sql_req.=" FROM _article ";
$sql_req.=" left join _art_stock using(art_cleunik) ";
$sql_req.=" left join _art_achats using(art_cleunik) ";
$sql_req.=" left join _art_fabs using(art_cleunik) ";
$sql_req.=" left join _art_dimensions using(art_cleunik) ";
$sql_req.=" left join _art_ventes using(art_cleunik) ";
$sql_req.=" left join nc_2009_autosuffisant f7 on _article.nc_2009_autosuffisant_cleunik=f7.cleunik";
$sql_req.=" where _article.art_cleunik=$vl_e_art_cleunik;";
$result = _graal_requete_bd($sql_req);
//echo $sql_req;
echo fa_xcree_entete_xml();
$row = mysql_fetch_assoc($result);
$nb_dec=fa_ent_xml($row['nb_decimales_qte']);
$nbdec_prix=fa_ent_xml($row['nbdec_prix']);
echo('<Description>');
// parseType = indication pour le type des données, utile pour le tri sur la colonne
//  Informations relatives à la table "_article"
echo('<art_cleunik data="'.fa_ent_xml($row['art_cleunik']).'"/>');
echo('<code data="'.fa_ent_xml($row['code']).'"/>');
echo('<indice data="'.fa_ent_xml($row['indice']).'"/>');
echo('<mnemotechnique data="'.fa_ent_xml($row['mnemotechnique']).'"/>');
echo('<description data="'.fa_ent_xml($row['description']).'"/>');
echo('<blocnotebrut data="'.fa_ent_xml($row['blocnotebrut']).'"/>');
echo('<blocnotertf data="'.fa_ent_xml($row['blocnotertf']).'"/>');
echo('<dateheurecreation data="'.fa_ent_xml($row['dateheurecreation']).'"/>');
echo('<dateheuremodif data="'.fa_ent_xml($row['dateheuremodif']).'"/>');
echo('<dateheurevalidite data="'.fa_ent_xml($row['dateheurevalidite']).'"/>');
echo('<types_gestion data="'.fa_ent_xml($row['types_gestion']).'"/>');
echo('<nbdec_prix data="'.fa_ent_xml($row['nbdec_prix']).'"/>');
echo('<nbdec_qte data="'.fa_ent_xml($row['nbdec_qte']).'"/>');
echo('<actif data="'.fa_ent_xml($row['actif']).'"/>');
echo('<code_deb data="'.fa_ent_xml($row['code_deb']).'"/>');
echo('<libelle_deb data="'.fa_ent_xml($row['libelle_deb']).'"/>');
echo('<nc_2009_autosuffisant_cleunik data="'.fa_ent_xml($row['nc_2009_autosuffisant_cleunik']).'"/>');
echo('<pr_generique data="'.fa_reel_fiche(fa_ent_xml($row['pr_generique']),$nbdec_prix).'"/>');
//  Informations relatives à la table "_art_stock"
echo('<qte_stock data="'.fa_reel_fiche(fa_ent_xml($row['qte_stock']),$nb_dec).'"/>');
echo('<unite_stock data="'.fa_ent_xml($row['unite_stock']).'"/>');
echo('<qte_inven data="'.fa_reel_fiche(fa_ent_xml($row['qte_inven']),$nb_dec).'"/>');
echo('<dateheure_invent data="'.fa_ent_xml($row['dateheure_invent']).'"/>');
echo('<pu_reference data="'.fa_ent_xml($row['pu_reference']).'"/>');
echo('<gestion data="'.fa_ent_xml($row['gestion']).'"/>');
echo('<qte_mini data="'.fa_reel_fiche(fa_ent_xml($row['qte_mini']),$nb_dec).'"/>');
echo('<qte_maxi data="'.fa_reel_fiche(fa_ent_xml($row['qte_maxi']),$nb_dec).'"/>');
echo('<qte_securite data="'.fa_reel_fiche(fa_ent_xml($row['qte_securite']),$nb_dec).'"/>');
echo('<qte_alerte data="'.fa_reel_fiche(fa_ent_xml($row['qte_alerte']),$nb_dec).'"/>');
echo('<cumul_entrees data="'.fa_reel_fiche(fa_ent_xml($row['cumul_entrees']),$nb_dec).'"/>');
echo('<cumul_sorties data="'.fa_reel_fiche(fa_ent_xml($row['cumul_sorties']),$nb_dec).'"/>');
echo('<nb_decimales_qte data="'.fa_ent_xml($row['nb_decimales_qte']).'"/>');
echo('<unite_condi data="'.fa_ent_xml($row['unite_condi']).'"/>');
echo('<nb_stock_in_condi data="'.fa_ent_xml($row['nb_stock_in_condi']).'"/>');
//  Informations relatives à la table "_art_achats"
echo('<delai_reappro data="'.fa_ent_xml($row['delai_reappro']).'"/>');
echo('<unite_reappro data="'.fa_ent_xml($row['unite_reappro']).'"/>');
echo('<der_pa data="'.fa_reel_fiche(fa_ent_xml($row['der_pa']),$nbdec_prix).'"/>');
echo('<pamp data="'.fa_reel_fiche(fa_ent_xml($row['pamp']),$nbdec_prix).'"/>');
echo('<dateheure_der_achat data="'.fa_ent_xml($row['dateheure_der_achat']).'"/>');
echo('<unite_achat data="'.fa_ent_xml($row['unite_achat']).'"/>');
//  Informations relatives à la table "_art_fabs" et à la fabrication en général
echo('<nombre_nomenc_fab data="'.fa_ent_xml($row['nombre_nomenc_fab']).'"/>');
echo('<multiple_base data="'.fa_ent_xml($row['multiple_base']).'"/>');
echo('<pr data="'.fa_reel_fiche(fa_ent_xml($row['pr']),$row['nbdec_pr']).'"/>');
echo('<nbdec_pr data="'.fa_ent_xml($row['nbdec_pr']).'"/>');
echo('<nombre_composants_fabrications data="'.fa_ent_xml($row['nombre_composants_fabrications']).'"/>');
echo('<nombre_fabrications data="'.fa_ent_xml($row['nombre_fabrications']).'"/>');
//  Informations relatives à la table "_art_dimensions"
echo('<capacite data="'.fa_ent_xml($row['capacite']).'"/>');
echo('<unite_capacite data="'.fa_ent_xml($row['unite_capacite']).'"/>');
echo('<poids_net data="'.fa_ent_xml($row['poids_net']).'"/>');
echo('<poids_brut data="'.fa_ent_xml($row['poids_brut']).'"/>');
echo('<unite_poids data="'.fa_ent_xml($row['unite_poids']).'"/>');
echo('<tare data="'.fa_ent_xml($row['tare']).'"/>');
echo('<longueur data="'.fa_ent_xml($row['longueur']).'"/>');
echo('<largeur data="'.fa_ent_xml($row['largeur']).'"/>');
echo('<epaisseur data="'.fa_ent_xml($row['epaisseur']).'"/>');
echo('<unite_longueur data="'.fa_ent_xml($row['unite_longueur']).'"/>');
//  Informations relatives à la table "_art_ventes"
echo('<unite_vente data="'.fa_ent_xml($row['unite_vente']).'"/>');
_graal_libere_requete_bd($result);
//  Informations documents commerciaux

$sql_req= "select 1,(select count(*) from _offcli_lignes where art_cleunik=$vl_e_art_cleunik) as t01,";
$sql_req.="(select count(*) from _cdecli_lignes where art_cleunik=$vl_e_art_cleunik) as t02,";
$sql_req.="(select count(*) from _livcli_lignes where art_cleunik=$vl_e_art_cleunik) as t03,";
$sql_req.="(select count(*) from _faccli_lignes where art_cleunik=$vl_e_art_cleunik) as t04,";
$sql_req.="(select count(*) from _demfou_lignes where art_cleunik=$vl_e_art_cleunik) as t05,";
$sql_req.="(select count(*) from _cdefou_lignes where art_cleunik=$vl_e_art_cleunik) as t06,";
$sql_req.="(select count(*) from _recfou_lignes where art_cleunik=$vl_e_art_cleunik) as t07,";
$sql_req.="(select count(*) from _facfou_lignes where art_cleunik=$vl_e_art_cleunik) as t08,";
$sql_req.="(select count(*) from _cdecli_consignes where art_cleunik=$vl_e_art_cleunik) as t09,";
$sql_req.="(select count(*) from _retcli_lignes where art_cleunik=$vl_e_art_cleunik) as t10,";
$sql_req.="(select count(*) from _retfou_lignes where art_cleunik=$vl_e_art_cleunik) as t11;";
/*
(select count(*) from _offcli_consignes where art_cleunik=$vl_e_art_cleunik) as t10)
(select count(*) from _livcli_consignes where art_cleunik=$vl_e_art_cleunik) as t11)
(select count(*) from _faccli_consignes where art_cleunik=$vl_e_art_cleunik) as t12)
(select count(*) from _demfou_consignes where art_cleunik=$vl_e_art_cleunik) as t13)
(select count(*) from _cdefou_consignes where art_cleunik=$vl_e_art_cleunik) as t14)
(select count(*) from _recfou_consignes where art_cleunik=$vl_e_art_cleunik) as t15)
(select count(*) from _facfou_consignes where art_cleunik=$vl_e_art_cleunik) as t16)
*/
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$t0=$row['t01']+$row['t02']+$row['t03']+$row['t04']+$row['t05']+$row['t06']+$row['t07']+$row['t08']+$row['t09']+$row['t10']+$row['t11'];
echo('<t0 data="'.$t0.'"/>');
echo('<t1 data="'.fa_ent_xml($row['t01']).'"/>');
echo('<t2 data="'.fa_ent_xml($row['t02']).'"/>');
echo('<t3 data="'.fa_ent_xml($row['t03']).'"/>');
echo('<t4 data="'.fa_ent_xml($row['t04']).'"/>');
echo('<t5 data="'.fa_ent_xml($row['t05']).'"/>');
echo('<t6 data="'.fa_ent_xml($row['t06']).'"/>');
echo('<t7 data="'.fa_ent_xml($row['t07']).'"/>');
echo('<t8 data="'.fa_ent_xml($row['t08']).'"/>');
echo('<t10 data="'.fa_ent_xml($row['t10']).'"/>');
echo('<t11 data="'.fa_ent_xml($row['t11']).'"/>');
echo('</Description>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
