<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_icones_cleunik=intval(fa_recup_param('vl_e_icones_cleunik','0'));
$vl_c_sortie=fa_recup_param('sortie','xml');
switch ($vl_c_sortie){
	case "xml":
		$sql_req="SELECT ficones_cleunik,ficones_designation,ficones_cheminorigine,ficones_infos FROM _ficones where ficones_cleunik=$vl_e_icones_cleunik";
		$result = _graal_requete_bd($sql_req);
		$row = mysql_fetch_assoc($result);
		echo(fa_xcree_entete_xml());
		  echo('<Description>');
		  echo('<ficones_cleunik data="'.fa_ent_xml($row['ficones_cleunik']).'"/>');
		  echo('<ficones_designation data="'.fa_ent_xml($row['ficones_designation']).'"/>');
		  echo('<ficones_cheminorigine data="'.fa_ent_xml($row['ficones_cheminorigine']).'"/>');
		  echo('<ficones_infos data="'.fa_ent_xml($row['ficones_infos']).'"/>');
		echo('</Description>'.EOL);
		break;
	case "b64":
		$data = _graal_requete_ob("SELECT ficones_image FROM _ficones WHERE ficones_cleunik=$vl_e_icones_cleunik");
		$mime=fa_mime_type_buffer($data->ficones_image);
		  if (($mime=="") || ($mime=="???") || ($mime=="!!!")){
		    $mime="image/".fa_extension($tmp);
		  } else {
		  $mime="image/jpeg";
		}
		header('Content-type: text/plain; charset=utf-8');
		echo 'data:'.$mime.';base64,'.base64_encode($data->ficones_image);
		break;
}

_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
