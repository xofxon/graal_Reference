<?php
header('Content-type: text/plain; charset=utf-8');
header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); // Date in the past

$string = <<<XML
<dossier label="" properties="" url="" id="root" hidden="" value="" link="">
	<item label="Nouveau dossier" link="Lien internet" properties="e3" id="root" value="0">
		<item label="Entête" link="Lien internet" properties="e2" id="entete" value="0">
			<item label="Description : Mon nouveau dossier" link="Lien internet" properties="e0" value="0"/>
			<item label="Auteur : Christophe Charron" link="Lien internet" properties="e0" value="0"/>
			<item label="Créé le samedi 19 juin 2010" link="Lien internet" properties="e0" value="0"/>
			<item label="Mis à jour le samedi 19 juin 2010" link="Lien internet" properties="e0" value="0"/>
		</item>
		<item label="Corpus" link="Lien internet" properties="e2" value="0">
			<item label="Introduction" link="Lien internet" properties="e0" value="0"/>
			<item label="Chapitres" link="Lien internet" properties="e0" value="0">
				<item label="I. Mozilla ? " link="Lien internet" properties="e0" value="0"/>
			</item>
			<item label="Réferences" link="Lien internet" properties="e0" value="0">
				<item label="Mon site" link="Lien internet" properties="e0" value="0"/>
			</item>
			<item label="Conclusions" link="Lien internet" properties="e0" value="0"/>
		</item>
		<item label="Thésaurus" link="Lien internet" properties="e2" value="0">
			<item label="Première entrée" link="Lien internet" properties="e0" value="0"/>
		</item>
		<item label="A classer, à explorer ..." link="Lien internet" properties="e0" id="branche_a_classer" value="0">
			<item label="Premier élément" link="Lien internet" properties="e0" value="0"/>
			<item label="Jacques BAREL" link="Interlocuteurs" properties="ai18" url="1" id="id" hidden="false" value="4"/>
		</item>
	</item>
</dossier>
XML;

/*
$string = <<<XML
<?xml version='1.0'?>
<dossier label="" properties="" url="" id="root" hidden="" value="" link="">
	<item label="Nouveau dossier" link="Lien internet" properties="e3" id="toto" value="0">
		
	</item>
</dossier>"/>
XML;
*/
$doc = new DomDocument;

// Nous devons valider notre document avant de nous référer à l'ID
$doc->validateOnParse = true;
$doc->LoadXML($string);

$params = $doc->getElementsByTagName('item'); // Find Sections
//var_dump($doc);
$k=0;
foreach ($params as $param) //go to each section 1 by 1
{
	if ($params->item($k)->getAttribute('id')=="branche_a_classer"){
		//echo "bingo !!";
		//var_dump($params->item($k));
		//var_dump($param);
		//$element = $params->item($k)->createElement('test', 'Ceci est un élément ajouté !');
		$element = $doc->createElement('item', 'Ceci est un élément ajouté !');
		$element = createElement($doc, 'item', '', array('label'=>'Jacques Brel',
		'link'=>'Interlocuteurs',
		'properties'=>'ai18',
		'url'=>'1',
		'id'=>'id',
		'hidden'=>'false',
		'value'=>'8',
		)
		);
		$params->item($k)->appendChild($element);
		//$att=$toto->createAttribute('label');
		
		
		//$att->value="Jacques Brel";
		/*
		$att=$element->createAttribute('link',"Interlocuteurs");
		$att=$element->createAttribute('properties',"ai18");
		$att=$element->createAttribute('url',"1");
		$att=$element->createAttribute('id',"id");
		$att=$element->createAttribute('hidden',"false");
		$att=$element->createAttribute('value',"8");
		*/
		//$element = $doc->createElement('test', 'Ceci est un élément ajouté !');
		//$params->item($k)->appendChild($element);


		
	}
	//echo "Section Attribute :-> ".$params->item($k)->getAttribute('id')."<br>";   //get section attribute          
	$k++;  
}

echo $doc->saveXML();


function createElement($domObj, $tag_name, $value = NULL, $attributes = NULL)
{
    $element = ($value != NULL ) ? $domObj->createElement($tag_name, $value) : $domObj->createElement($tag_name);

    if( $attributes != NULL )
    {
        foreach ($attributes as $attr=>$val)
        {
            $element->setAttribute($attr, $val);
        }
    }

    return $element;
}
/*


echo $doc->saveXML();

echo "L'élément dont l'ID est 'branche_a_classer' est : " . $doc->getElementById('branche_a_classer')->tagName . "\n";

function getElementById($id)
{
    $xpath = new DOMXPath($this->domDocument);
    return $xpath->query("//*[@id='$id']")->item(0);
}
//var_dump($doc);
*/
?>
