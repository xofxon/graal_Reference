<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik=intval(fa_recup_session("vs_uti_cleunik","0"));
$param_generaux_graal_044=intval(fa_recup_session('vs_param_generaux_graal_044','0'));
$vl_c_genreaction=fa_recup_param("genreaction","bordex_creer");
$vl_c_visu=fa_recup_param("visu","non");
$lesquels=fa_recup_param("lesquels","raf");
$vl_c_quelarbre_actions=fa_recup_param("arbre","1");
$vl_e_doc_cleunik=intval(fa_recup_param("vl_e_doc_cleunik",-1));
$vl_c_dico_00005=fa_recup_dico('dico_00005');
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_id_fenetre="Fen_01059";$id_inc_actions_recherche="Div_00573";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false||$vl_tb_droits[1]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
$vl_tc_composants=array($id_inc_actions_recherche);
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bsf_100=fa_recup_dico("bsf_100");
$vl_c_bsf_101=fa_recup_dico("bsf_101");
$vl_c_bsf_102=fa_recup_dico("bsf_102");
$vl_c_bsf_103=fa_recup_dico("bsf_103");
$vl_c_bsf_104=fa_recup_dico("bsf_104");
$vl_c_bsf_105=fa_recup_dico("bsf_105");
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
$sql_req = "SELECT _acteurs.act_cleunik as act_cleunik,case _acteurs.nomcommercial when '' then _acteurs.raisonsoc else _acteurs.nomcommercial END as `raisonsoc` FROM `_acteurs` where (SELECT count(*) as nombre from _act_choix_fixes where _act_choix_fixes.choix_cleunik=-25 and _act_choix_fixes.act_cleunik=_acteurs.act_cleunik) >0 and _acteurs.actif=1 order by 2;";
$vv_brik_transporteur="<menulist sizetopopup='none' class='menuitem-iconic' onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex='1' id='ml_transporteurs' observer='broadcaster_01'><menupopup>";
$sql_result = _graal_requete_bd($sql_req);
if (mysql_num_rows($sql_result) == 0){
$vv_brik_transporteur.="<menuitem value='$vl_c_bsf_105' value='-1' label='$vl_c_bsf_105' selected='true'/>";
} else {
while ($row = mysql_fetch_assoc($sql_result)){
  $vv_brik_transporteur.="<menuitem value='".$row['act_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['raisonsoc']))."' selected='true'/>";
}
}
$vv_brik_transporteur.="</menupopup></menulist>";
_graal_libere_requete_bd($sql_result);
$vl_c_pop_selections="";$vl_c_pop_panier="";
$vl_c_pop_selections.="<popupset><popup id='pop_selections'>";
$vl_c_pop_selections.='<menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\''."arbre_actions_01".'\');" />';
$vl_c_pop_selections.='<menuseparator/>';
$vl_c_pop_selections.="<menuitem class='menuitem-iconic af08' label='$vl_c_bsf_101' oncommand='pf_action_ouvre(\"arbre_actions_01\");' />";
$vl_c_pop_selections.='<menuitem class="menuitem-iconic ak11" label="'.$vl_c_bsf_102.'" oncommand="pf_panier_ajoute();" />';
$vl_c_pop_selections.="</popup></popupset>";
$vl_c_pop_panier.="<popupset><popup id='pop_panier'>";
$vl_c_pop_panier.='<menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\''."arbre_actions_panier".'\');" />';
$vl_c_pop_panier.='<menuseparator/>';
$vl_c_pop_panier.="<menuitem class='menuitem-iconic af08' label='$vl_c_bsf_103' oncommand='pf_action_ouvre(\"arbre_actions_panier\");' />";
$vl_c_pop_panier.="<menuitem class='menuitem-iconic ak12' label='$vl_c_bsf_104' oncommand='pf_panier_enleve();'/>";
$vl_c_pop_panier.="</popup></popupset>";
echo <<<END
<window context="graal_cp00" title="$vl_c_bda_100" id="$c_id_windows" onload="fa_aa(this);pf_aa_init_bem('21')" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
$vl_c_pop_selections
$vl_c_pop_panier
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_04.js.php");
include_once("js/_graal_actions_bordereaux_expedition_creation_01.js.php");
include_once("js/_graal_05_dates.js.php");
$vl_b_bloc_action_recherche=true;$vl_c_arbre_action="arbre_actions_01";
echo('<vbox flex="10" class="overflow_01">');
include ("_graal_inc_actions_recherche_01.php");
echo $vv_brik_transporteur;
$vl_b_bloc_action_recherche=false;$vl_c_arbre_action="arbre_des_actions_panier";
include ("_graal_inc_actions_recherche_01.php");
echo('<vbox><hbox id="boutons_standards">'); 
echo <<<END
	<button tooltiptext ="$vl_c_dico_00005 Ctrl+Shift+F5" keycode="k-enregistrer" flex="1" id="bt_enregistrer" label="$vl_c_dico_00005" orient="vertical" crop="end" oncommand="pf_validation('enregistrer')" />
    <button flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen_bem('sortir')" collapsed="true"/>
</hbox></vbox></vbox>
END;
if ($vl_c_visu=="oui") {
echo <<<END
<splitter ondblclick="aad_pf_cache();"> </splitter>
  <vbox flex="10">
      <iframe onload="fa_aa(window.graal_iframe_visu_action);event.stopPropagation();" id="graal_iframe_visu_action" src="" flex="1"/>
  </vbox>
END;
}
echo("</window>");
?>
