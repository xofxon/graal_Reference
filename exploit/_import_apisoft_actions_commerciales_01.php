<?php
include("_graal_header_txt.inc.php");
/* Valable pour descriptifs APISoft Version ??????????? */ 
define('EOL', "\r\n");
set_time_limit(6000);
$vl_c_base_origine=fa_recup_param('vl_c_base_origine','apisoft_bar_gc');
$vl_c_base_destination=fa_recup_param('vl_c_base_destination','graal_bar_02');
$vl_c_typedoc=fa_recup_param('vl_c_type_doc','?????');
/*
 * Nécessaire pour éviter le blocage du au trop long traitements voir conversation ici http://www.developpez.net/forums/showthread.php?p=3024462#post3024462   
 * Il ne faut plus rien avoir à récupérer, dans ce script, dans les variables de session ou dans les paramètres passés
 */
session_write_close();
include("_import_apisoft_sp_array_pays.php");
include("_import_apisoft_sp_array_devises.php");
include("_import_apisoft_sp_array_transporteurs.php");
include("_import_class_data_km.php");


$cat_cod=array();$cat_cle=array();
$sql_req="select catcompta_cleunik,code from $vl_c_base_destination._param_categories_compta;";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($cat_cod,$row['code']);
  array_push ($cat_cle, $row['catcompta_cleunik']);
}
_graal_libere_requete_bd($result);
$reg_cod=array();$reg_cle=array();
$sql_req="select reg_cleunik,codealphanum15 from $vl_c_base_destination._modereg;";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($reg_cod,$row['codealphanum15']);
  array_push ($reg_cle, $row['reg_cleunik']);
}
_graal_libere_requete_bd($result);

$modliv_cod=array();$modliv_cle=array();
$sql_req="select choix_cleunik as cleunik,choix_code as code from _choix where critere_cleunik=140"; //  On recherche les critères modalités de livraison
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($modliv_cod, $row['code']);
  array_push ($modliv_cle, $row['cleunik']);
}
_graal_libere_requete_bd($result);
$typpor_cod=array();$typpor_cle=array();
$sql_req="select choix_cleunik as cleunik,choix_code as code from _choix where critere_cleunik=139"; //  On recherche les critères type de port
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($typpor_cod, $row['code']);
  array_push ($typpor_cle, $row['cleunik']);
}
_graal_libere_requete_bd($result);

$condit_cod=array();$condit_cle=array();
$sql_req="select choix_cleunik as cleunik,choix_code as code from _choix where critere_cleunik=128"; //  On recherche les critères unité de conditionnement
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($condit_cod, $row['code']);
  array_push ($condit_cle, $row['cleunik']);
}
_graal_libere_requete_bd($result);

$univen_cod=array();$univen_cle=array();
$sql_req="select choix_cleunik as cleunik,choix_code as code from _choix where critere_cleunik=109"; //  On recherche les critères unité de vente
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($univen_cod, $row['code']);
  array_push ($univen_cle, $row['cleunik']);
}
_graal_libere_requete_bd($result);


$o_entete=new _graal_import();
$o_adresse=new _graal_import();
$o_action=new _graal_import();
$o_graal=new _graal_import();
$o_rep=new _graal_import();
$o_transporteur=new _graal_import();
$o_consigne=new _graal_import();
$o_lignes=new _graal_import();
$o_lignes_qte=new _graal_import();

$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
$vl_commercial_cleunik=_graal_requete_max("commercial_cleunik","_".$vl_c_typedoc."_entetes");
$o_adresse->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_adresses (adr_cleunik,commercial_cleunik,adr_nom,adr_complementnom,adr_ligne1,adr_ligne2,adr_cp,adr_ville,choix_cleunik,adr_typecoordonnees) VALUES ";
$vl_adr_cleunik=_graal_requete_max("adr_cleunik","_".$vl_c_typedoc."_adresses");
$o_rep->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_representants (action_rep_cleunik,commercial_cleunik,action_rep_cleunik_reference,act_cleunik_rep) VALUES ";
$vl_action_rep_cleunik=_graal_requete_max("action_rep_cleunik","_".$vl_c_typedoc."_representants");
$o_transporteur->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_transporteurs (action_trans_cleunik,commercial_cleunik,action_trans_cleunik_reference,act_cleunik_trans,poids_net,poids_bru,nombre_colis) VALUES ";
$vl_action_trans_cleunik=_graal_requete_max("action_trans_cleunik","_".$vl_c_typedoc."_transporteurs");
$o_consigne->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_consignes (action_consi_cleunik,commercial_cleunik,act_cleunik,art_cleunik,qte,qte_nbdec,qte_colis) VALUES ";
$vl_action_consi_cleunik=_graal_requete_max("action_consi_cleunik","_".$vl_c_typedoc."_consignes");
switch ($vl_c_typedoc) {
  case "cdecli":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,ifnull(date(Date_Liv),date(Date)) as `date2`,ifnull(time(Date_Liv),time(Date)) as `heure2`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,CodeAnalytique as `CodeAnalytique`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,Transporteur as `Transporteur`,SeuilFranco as `SeuilFranco`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied`,Palette as `Palette`,Nbpal as `Nbpal`,PP as `PP`,Heures as `Heures`,Modalite as `Modalite`,Refcli as `Refcli`,Interlocuteur as `Interlocuteur`,RV as `RV`,concat_ws('-',Modalite,Heures) as modliv FROM $vl_c_base_origine.entetecdeclient order by Code ;";
    $pal_cod=array();$pal_cle=array();
    $sql_req="select art_cleunik,code from $vl_c_base_destination._article where code in (select distinct Palette FROM $vl_c_base_origine.entetecdeclient);";
    $result = _graal_requete_bd($sql_req);
    while ($row = mysql_fetch_assoc($result)) {
      array_push ($pal_cod, $row['code']);
      array_push ($pal_cle, $row['art_cleunik']);
    }
    $vf_e_typeacteur=110003;
    $vf_e_choix_cleunik_doc=-110108;
    $vf_e_choix_cleunik_graal=-110409;
    $vl_e_critere_cleunik_tarcli=101;$vl_e_tarif_cleunik_defaut=-31;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,LigneAIntegrer as `LigneAIntegrer`,LigneSoldee as `LigneSoldee`,DateLivraison as `DateLivraison`,QteLivree as `QteLivree`,FraisLigne as `FraisLigne`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_FraisLigne as `MonnaieRef_FraisLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal`,Capsule as `Capsule`,Comrep as `Comrep`,Conditionnement as `Conditionnement` FROM $vl_c_base_origine.lignecdeclient order by CodeDocument,NumeroLigne";
    $tarif_defaut=-31;
    $qte_unite_defaut=-35;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
  case "livcli":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,CodeAnalytique as `CodeAnalytique`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,Transporteur as `Transporteur`,SeuilFranco as `SeuilFranco`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied` FROM $vl_c_base_origine.enteteblclient order by Code;";
    $vf_e_typeacteur=110003;
    $vf_e_choix_cleunik_doc=-110110;
    $vf_e_choix_cleunik_graal=-110410;
    $vl_e_critere_cleunik_tarcli=101;$vl_e_tarif_cleunik_defaut=-31;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,QuantiteRestantALivrer as `QuantiteRestantALivrer`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,`Description` as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,FraisLigne as `FraisLigne`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_FraisLigne as `MonnaieRef_FraisLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal`,Capsule as `Capsule`,Comrep as `Comrep`,Conditionnement as `Conditionnement` FROM $vl_c_base_origine.ligneblclient order by CodeDocument,NumeroLigne;";
    $tarif_defaut=-31;
    $qte_unite_defaut=-35;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
  case "faccli":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,NumeroReleve as `NumeroReleve`,CodeAnalytique as `CodeAnalytique`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,TransfereComptable as `TransfereComptable`,Transporteur as `Transporteur`,SeuilFranco as `SeuilFranco`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied`,Refcli as `Refcli` FROM $vl_c_base_origine.entetefacture where Type not in ('AC','nC') order by Code";
    $vf_e_typeacteur=110003;
    $vf_e_choix_cleunik_doc=-110112;
    $vf_e_choix_cleunik_graal=-110411;
    $vl_e_critere_cleunik_tarcli=101;$vl_e_tarif_cleunik_defaut=-31;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,FraisLigne as `FraisLigne`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_FraisLigne as `MonnaieRef_FraisLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal`,Capsule as `Capsule`,Comrep as `Comrep`,Conditionnement as `Conditionnement` FROM $vl_c_base_origine.lignefacture order by CodeDocument,NumeroLigne";
    $tarif_defaut=-31;
    $qte_unite_defaut=-35;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
  case "avocli":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,NumeroReleve as `NumeroReleve`,CodeAnalytique as `CodeAnalytique`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,TransfereComptable as `TransfereComptable`,Transporteur as `Transporteur`,SeuilFranco as `SeuilFranco`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied`,Refcli as `Refcli` FROM $vl_c_base_origine.entetefacture where Type in ('AC','nC') order by Code";
    $vf_e_typeacteur=110003;
    $vf_e_choix_cleunik_avo=-110116;
    $vf_e_choix_cleunik_avo_finan=-110117;
    $vf_e_choix_cleunik_graal=-110411;
    $vl_e_critere_cleunik_tarcli=101;$vl_e_tarif_cleunik_defaut=-31;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,FraisLigne as `FraisLigne`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_FraisLigne as `MonnaieRef_FraisLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal`,Capsule as `Capsule`,Comrep as `Comrep`,Conditionnement as `Conditionnement` FROM $vl_c_base_origine.lignefacture order by CodeDocument,NumeroLigne";
    $tarif_defaut=-31;
    $qte_unite_defaut=-35;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,type_avoir,modliv_bis) VALUES ";
    break;
  case "cdefou":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,ifnull(date(Date_Liv),date(Date)) as `date2`,ifnull(time(Date_Liv),time(Date)) as `heure2`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,SeuilFranco as `SeuilFranco`,MontantMinimunCde as `MontantMinimunCde`,EcartReglement as `EcartReglement`,EcartTva as `EcartTva`,CodeAnalytique as `CodeAnalytique`,RefFournisseur as `RefFournisseur`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied` FROM $vl_c_base_origine.entetecdefournisseur order by Code;";
    $vf_e_typeacteur=110004;
    $vf_e_choix_cleunik_doc=-110109;
    $vf_e_choix_cleunik_graal=-110413;
    $vl_e_critere_cleunik_tarcli=127;$vl_e_tarif_cleunik_defaut=-33;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,RefFournisseur as `RefFournisseur`,DateReception as `DateReception`,LigneAIntegrer as `LigneAIntegrer`,LigneSoldee as `LigneSoldee`,QteLivree as `QteLivree`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal` FROM $vl_c_base_origine.lignecdefournisseur order by CodeDocument,NumeroLigne";
    $tarif_defaut=-33;
    $qte_unite_defaut=-36;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
  case "recfou":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,SeuilFranco as `SeuilFranco`,MontantMinimunCde as `MontantMinimunCde`,EcartReglement as `EcartReglement`,EcartTva as `EcartTva`,CodeAnalytique as `CodeAnalytique`,RefFournisseur as `RefFournisseur`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied` FROM $vl_c_base_origine.entetereceptionfournisseur order by Code;";
    $vf_e_typeacteur=110004;
    $vf_e_choix_cleunik_doc=-110111;
    $vf_e_choix_cleunik_graal=-110414;
    $vl_e_critere_cleunik_tarcli=127;$vl_e_tarif_cleunik_defaut=-33;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,QuantiteRestantALivrer as `QuantiteRestantALivrer`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,NumeroChronologique as `NumeroChronologique`,RefFournisseur as `RefFournisseur`,DateReception as `DateReception`,LigneAIntegrer as `LigneAIntegrer`,LigneSoldee as `LigneSoldee`,QteLivree as `QteLivree`,QteALivrerDirect as `QteALivrerDirect`,GestionReliquat as `GestionReliquat`,LigneFacturee as `LigneFacturee`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal` FROM $vl_c_base_origine.lignereceptionfournisseur order by CodeDocument,NumeroLigne";
    $tarif_defaut=-33;
    $qte_unite_defaut=-36;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
  case "facfou":
    $sql_req_doc="SELECT Code as `Code`,Type as `Type`,date(Date) as `date1`,time(Date) as `heure1`,CodeTiers as `CodeTiers`,Nom as `Nom`,Nom_Liv as `Nom_Liv`,Civilite as `Civilite`,Civilite_Liv as `Civilite_Liv`,Adr as `Adr`,Adr_Liv as `Adr_Liv`,SuiteAdr as `SuiteAdr`,SuiteAdr_Liv as `SuiteAdr_Liv`,Cp as `Cp`,Cp_Liv as `Cp_Liv`,Ville as `Ville`,Ville_Liv as `Ville_Liv`,Corres as `Corres`,Corres_Liv as `Corres_Liv`,Representant as `Representant`,Tarif as `Tarif`,TypeDeTarif as `TypeDeTarif`,Remise as `Remise`,CalCulTva as `CalCulTva`,GestionTPF as `GestionTPF`,Devise as `Devise`,Pays as `Pays`,Pays_Liv as `Pays_Liv`,Note as `Note`,CategorieAV as `CategorieAV`,Depot as `Depot`,Dossier as `Dossier`,HT0 as `HT0`,HT1 as `HT1`,HT2 as `HT2`,HT3 as `HT3`,HT4 as `HT4`,HT5 as `HT5`,TVA1 as `TVA1`,TVA2 as `TVA2`,TVA3 as `TVA3`,TVA4 as `TVA4`,TVA5 as `TVA5`,TPF1 as `TPF1`,TPF2 as `TPF2`,TPF3 as `TPF3`,TPF4 as `TPF4`,TPF5 as `TPF5`,TPF6 as `TPF6`,TPF7 as `TPF7`,TPF8 as `TPF8`,TPF9 as `TPF9`,TPF10 as `TPF10`,CodeTpf1 as `CodeTpf1`,CodeTpf2 as `CodeTpf2`,CodeTpf3 as `CodeTpf3`,CodeTpf4 as `CodeTpf4`,CodeTpf5 as `CodeTpf5`,CodeTpf6 as `CodeTpf6`,CodeTpf7 as `CodeTpf7`,CodeTpf8 as `CodeTpf8`,CodeTpf9 as `CodeTpf9`,CodeTpf10 as `CodeTpf10`,TotalTvaNet1 as `TotalTvaNet1`,TotalTvaNet2 as `TotalTvaNet2`,TotalTvaNet3 as `TotalTvaNet3`,TotalTvaNet4 as `TotalTvaNet4`,TotalTvaNet5 as `TotalTvaNet5`,TotalPrixRevient as `TotalPrixRevient`,TotalTTC as `TotalTTC`,Escompte as `Escompte`,Acompte as `Acompte`,FraisFacturationHT as `FraisFacturationHT`,FraisFacturationTTC as `FraisFacturationTTC`,TauxTvaFraisFacturation as `TauxTvaFraisFacturation`,CodeTvaFraisFacturation as `CodeTvaFraisFacturation`,CodeReglement as `CodeReglement`,LibReglement as `LibReglement`,PieceTrans as `PieceTrans`,PieceEdit as `PieceEdit`,TraiteEdit as `TraiteEdit`,PortHT as `PortHT`,PortTTC as `PortTTC`,CodeTvaPort as `CodeTvaPort`,TauxTvaPort as `TauxTvaPort`,Poids as `Poids`,NombreColis as `NombreColis`,NetAPayer as `NetAPayer`,GestionReleve as `GestionReleve`,SeuilFranco as `SeuilFranco`,MontantMinimunCde as `MontantMinimunCde`,EcartReglement as `EcartReglement`,EcartTva as `EcartTva`,CodeAnalytique as `CodeAnalytique`,RefFournisseur as `RefFournisseur`,EcheanceCreeDansFinanc as `EcheanceCreeDansFinanc`,MontantRemise as `MontantRemise`,MontantEscompte as `MontantEscompte`,DateDerniereModif as `DateDerniereModif`,MonnaieRef_TotalPrixRevient as `MonnaieRef_TotalPrixRevient`,MonnaieRef_TotalTTC as `MonnaieRef_TotalTTC`,MonnaieRef_NetAPayer as `MonnaieRef_NetAPayer`,TransfereComptable as `TransfereComptable`,LettreEntete as `LettreEntete`,LettrePied as `LettrePied` FROM $vl_c_base_origine.entetefacturefournisseur order by Code";
    $vf_e_typeacteur=110004;
    $vf_e_choix_cleunik_doc=-110113;
    $vf_e_choix_cleunik_graal=-110415;
    $vl_e_critere_cleunik_tarcli=127;$vl_e_tarif_cleunik_defaut=-33;
    $sql_req_lig="SELECT CodeDocument as `CodeDocument`,NumeroLigne as `NumeroLigne`,CodeArticle as `CodeArticle`,TypeLigne as `TypeLigne`,Designation as `Designation`,Quantite as `Quantite`,QuantiteHoraire as `QuantiteHoraire`,PrixUnitaire as `PrixUnitaire`,Remise as `Remise`,Largeur as `Largeur`,Longueur as `Longueur`,Epaisseur as `Epaisseur`,Representant as `Representant`,AImprimer as `AImprimer`,PoidsB as `PoidsB`,Tare as `Tare`,PoidsN as `PoidsN`,FacturationPoidsParQte as `FacturationPoidsParQte`,PrixTotalLigne as `PrixTotalLigne`,TotalLigneHT as `TotalLigneHT`,TauxTVA as `TauxTVA`,CodeTVA as `CodeTVA`,CodeTiers as `CodeTiers`,UniteMesure as `UniteMesure`,NombreDec as `NombreDec`,EquivalenceStockage as `EquivalenceStockage`,Depot as `Depot`,UniteFacturation as `UniteFacturation`,PrixRevient as `PrixRevient`,Marge as `Marge`,Compte as `Compte`,CodeAnalytique as `CodeAnalytique`,NombreColis as `NombreColis`,NombreParcolis as `NombreParcolis`,DateDocument as `DateDocument`,TotalTTCLigne as `TotalTTCLigne`,`Remise Pied` as `Remise Pied`,`Escompte Pied` as `Escompte Pied`,Description as `Description`,CodeTPF1 as `CodeTPF1`,BaseTPF1 as `BaseTPF1`,ValeurTPF1 as `ValeurTPF1`,TauxTvaTPF1 as `TauxTvaTPF1`,CodeTvaTPF1 as `CodeTvaTPF1`,CodeTPF2 as `CodeTPF2`,BaseTPF2 as `BaseTPF2`,ValeurTPF2 as `ValeurTPF2`,TauxTvaTPF2 as `TauxTvaTPF2`,CodeTvaTPF2 as `CodeTvaTPF2`,DateReception as `DateReception`,NumeroChronologique as `NumeroChronologique`,RefFournisseur as `RefFournisseur`,MonnaieRef_PrixTotalLigne as `MonnaieRef_PrixTotalLigne`,MonnaieRef_PrixRevient as `MonnaieRef_PrixRevient`,MonnaieRef_Marge as `MonnaieRef_Marge`,MonnaieRef_TotalTTCLigne as `MonnaieRef_TotalTTCLigne`,MonnaieRef_TotalLigneHT as `MonnaieRef_TotalLigneHT`,CompteurArticleMvt as `CompteurArticleMvt`,NumeroLot as `NumeroLot`,GestionLot as `GestionLot`,CoeffFacturation as `CoeffFacturation`,CodeCompose as `CodeCompose`,NumeroCompose as `NumeroCompose`,PRUnitaire as `PRUnitaire`,MonnaieRef_PRUnitaire as `MonnaieRef_PRUnitaire`,StockCoef as `StockCoef`,PoidsTotal as `PoidsTotal` FROM $vl_c_base_origine.lignefacturefournisseur order by CodeDocument,NumeroLigne";
    $tarif_defaut=-33;
    $qte_unite_defaut=-36;
		$o_entete->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_entetes (action_cleunik,commercial_cleunik,code,dateheurecreation,dateheuremodif,act_cleunik,blocnotebrut_entete,devise,tarif_cleunik,remise_taux,remise_type,remise_genr,escompte_taux,escompte_type,remise_natu,reference_acteur,catcompta_cleunik,reg_cleunik,blocnotebrut_pied,rendezvous,modliv,typpor,dateheureexpedition,dateheurelivraison,frais_type,frais_taux,port_type,port_taux,acompte_type,acompte_taux,modliv_bis) VALUES ";
    break;
}
include("_import_apisoft_sp_array_tiers.php");
include("_import_apisoft_sp_array_representants.php");
include("_import_apisoft_sp_array_tarifs_cli.php");
$vl_action_cleunik=_graal_requete_max("action_cleunik","_actions");

$o_action->req="INSERT INTO $vl_c_base_destination._actions (action_cleunik,choix_cleunik,dateheuredebut,dateheurefin,dateheurecreation,sujet,c_uuid,reference,statut) VALUES ";
$o_graal->req="INSERT INTO $vl_c_base_destination._graal (act_cleunik,int_cleunik,action_cleunik,choix_cleunik,portee,principal) VALUES ";
$i=0;$b=500;
$result = _graal_requete_bd($sql_req_doc);
while ($row = mysql_fetch_assoc($result)) {
  $vl_e_trouve=array_search($row['CodeTiers'], $acteur_cod);
  if ($vl_e_trouve===false) {} else {
    $vl_e_act_cleunik=$acteur_cle[$vl_e_trouve];
    $vl_e_trouve_devise=array_search($row['Devise'], $devise_cod);if ($vl_e_trouve_devise===false) {$devise=122047;} else {$devise=$devise_cle[$vl_e_trouve_devise];}
    $vl_e_trouve_tarcli=array_search($row['Tarif'], $tarcli_cod);if ($vl_e_trouve_tarcli===false) {$vl_e_tarif_cleunik=$vl_e_tarif_cleunik_defaut;} else {$vl_e_tarif_cleunik=$tarcli_cle[$vl_e_trouve_tarcli];}
    $vl_e_trouve_catcom=array_search($row['CategorieAV'], $cat_cod);if ($vl_e_trouve_catcom===false) {$catcompta_cleunik=-1;} else {$catcompta_cleunik=$cat_cle[$vl_e_trouve_catcom];}
    $vl_e_trouve_reg=array_search($row['CodeReglement'], $reg_cod);if ($vl_e_trouve_reg===false) {$reg_cleunik=-1;} else {$reg_cleunik=$reg_cle[$vl_e_trouve_reg];}
    $vl_uuid=_graal_requete_uuid();
    $i++;
    $date1=$row['date1'];
    $heure1=$row['heure1'];
    $date2=$row['date2'];
    $heure2=$row['heure2'];
    $code=addslashes($row['Code']);
    $blocnotes_entete=addslashes($row['Note']);
    $blocnotes_pied="";
    $refcli=addslashes($row['Refcli']);
    $tarif_cleunik=$vl_e_tarif_cleunik;
    $remise_taux=$row['Remise'];
    $poids_net=$row['Poids'];
    $poids_bru=$row['Poids'];
    $remise_type=1;
    $remise_genr=2;
    $escompte_taux=$row['Escompte'];
    $escompte_type=1;
    $remise_natu=1;
    $statut=-23;  //  En cours
    $nombre_colis=$row['NombreColis'];
    $rendezvous=addslashes($row['RV']);
    $vl_e_trouve_typpor=array_search($row['PP'], $typpor_cod);if ($vl_e_trouve_typpor===false) {$typpor=-93;} else {$typpor=$typpor_cle[$vl_e_trouve_typpor];}
    $vl_e_trouve_modliv=array_search($row['modliv'], $modliv_cod);if ($vl_e_trouve_modliv===false) {$modliv=-94;} else {$modliv=$modliv_cle[$vl_e_trouve_modliv];}
    $modliv_bis=$modliv;
	$frais_type=2;
    $frais_taux=$row['FraisFacturationHT'];
    $port_type=2;
    $port_taux=$row['PortHT'];
    $acompte_type=2;
    $acompte_taux=$row['Acompte'];
		
    switch ($vl_c_typedoc) {
      case "avocli":
        switch ($row['Type']) {
          case 'AC' : $vf_e_choix_cleunik_doc=$vf_e_choix_cleunik_avo;$type_avoir=1;break;
          case 'nC' : $vf_e_choix_cleunik_doc=$vf_e_choix_cleunik_avo_finan;$type_avoir=2;break;
        }
				break;  
    }
    $o_action->dat.="($vl_action_cleunik,$vf_e_choix_cleunik_doc,'$date1 $heure1','$date1 $heure1','$date1 $heure1','$code','$vl_uuid','$code',$statut),";
    $o_graal->dat.="($vl_e_act_cleunik,0,$vl_action_cleunik,$vf_e_choix_cleunik_graal,8192,2),";
    switch ($vl_c_typedoc) {
      case "avocli":
				$o_entete->dat.="($vl_action_cleunik,$vl_commercial_cleunik,'$code','$date1 $heure1','$date1 $heure1',$vl_e_act_cleunik,'$blocnotes_entete',$devise,$tarif_cleunik,$remise_taux,$remise_type,$remise_genr,$escompte_taux,$escompte_type,$remise_natu,'$refcli',$catcompta_cleunik,$reg_cleunik,'$blocnotes_entete','$rendezvous',$modliv,$typpor,'$date1 $heure1','$date2 $heure2',$frais_type,$frais_taux,$port_type,$port_taux,$acompte_type,$acompte_taux,$type_avoir,$modliv_bis),";
				break;
			default:
				$o_entete->dat.="($vl_action_cleunik,$vl_commercial_cleunik,'$code','$date1 $heure1','$date1 $heure1',$vl_e_act_cleunik,'$blocnotes_entete',$devise,$tarif_cleunik,$remise_taux,$remise_type,$remise_genr,$escompte_taux,$escompte_type,$remise_natu,'$refcli',$catcompta_cleunik,$reg_cleunik,'$blocnotes_entete','$rendezvous',$modliv,$typpor,'$date1 $heure1','$date2 $heure2',$frais_type,$frais_taux,$port_type,$port_taux,$acompte_type,$acompte_taux,$modliv_bis),";  
				break;
    }
    //  Gestion de l'adresse de facturation
    $vl_e_trouve=array_search($row['Pays'], $pays_cod);
    if ($vl_e_trouve===false) { 
      $vl_pays_cleunik=60000;
    } else {
      $vl_pays_cleunik=$pays_cle[$vl_e_trouve];
    }
    $adr_nom            =addslashes($row['Nom']);
    $adr_complementnom  =addslashes($row['Corres']);
    switch ($vl_c_typedoc) {
      case "cdecli":
        //  Particularisme Baronnat
        if (trim($row['Interlocuteur'])!="") {$adr_complementnom=addslashes($row['Interlocuteur']);}
        break;
    }
    $adr_ligne1         =addslashes($row['Adr']);
    $adr_ligne2         =addslashes($row['SuiteAdr']);
    $adr_cp             =addslashes($row['Cp']);
    $adr_ville          =addslashes($row['Ville']);
    $o_adresse->dat.="($vl_adr_cleunik,$vl_commercial_cleunik,'$adr_nom','$adr_complementnom','$adr_ligne1','$adr_ligne2','$adr_cp','$adr_ville',$vl_pays_cleunik,1),";
    $vl_adr_cleunik++;
    //  Gestion de l'adresse de livraison
    $vl_e_trouve=array_search($row['Pays_Liv'], $pays_cod);
    if ($vl_e_trouve===false) {$vl_pays_cleunik=60000;} else {$vl_pays_cleunik=$pays_cle[$vl_e_trouve];}
    $adr_nom            =addslashes($row['Nom_Liv']);
    $adr_complementnom  =addslashes($row['Corres_Liv']);
    switch ($vl_c_typedoc) {
      case "cdecli":
        //  Particularisme Baronnat
        if (trim($row['Interlocuteur'])!="") {$adr_complementnom=addslashes($row['Interlocuteur']);}
        break;
    }
    $adr_ligne1         =addslashes($row['Adr_Liv']);
    $adr_ligne2         =addslashes($row['SuiteAdr_Liv']);
    $adr_cp             =addslashes($row['Cp_Liv']);
    $adr_ville          =addslashes($row['Ville_Liv']);
    $o_adresse->dat.="($vl_adr_cleunik,$vl_commercial_cleunik,'$adr_nom','$adr_complementnom','$adr_ligne1','$adr_ligne2','$adr_cp','$adr_ville',$vl_pays_cleunik,2),";
    //  Gestion des représentants
    $vl_e_trouve=array_search($row['Representant'], $rep_cod);
    if ($vl_e_trouve===false) {} else {
      $act_cleunik_rep=$rep_cle[$vl_e_trouve];
      $o_rep->dat.="($vl_action_rep_cleunik,$vl_commercial_cleunik,$vl_action_rep_cleunik,$act_cleunik_rep),";
      $o_graal->dat.="($act_cleunik_rep,0,$vl_action_cleunik,-110427,8192,1),";
    }
    //  Gestion des transporteurs
    $act_cleunik_trans=0;
    $vl_e_trouve=array_search($row['Transporteur'], $trans_cod);
    if ($vl_e_trouve===false) {} else {
      $act_cleunik_trans=$trans_cle[$vl_e_trouve];
      $o_transporteur->dat.="($vl_action_trans_cleunik,$vl_commercial_cleunik,$vl_action_trans_cleunik,$act_cleunik_trans,$poids_net,$poids_bru,$nombre_colis),";
      $o_graal->dat.="($act_cleunik_trans,0,$vl_action_cleunik,-110428,8192,1),";    
    }
    switch ($vl_c_typedoc) {
      case "cdecli":
        if ($row['Nbpal']!=0.0) {
          $vl_e_trouve=array_search($row['Palette'], $pal_cod);
          if ($vl_e_trouve===false) {} else {
            $art_cleunik=$pal_cle[$vl_e_trouve];
            if($act_cleunik_trans==0) {
              $act_cleunik_cons=$vl_e_act_cleunik;
            } else {
              $act_cleunik_cons=$act_cleunik_trans;
            }
            $qtecons=$row['Nbpal'];
            $o_consigne->dat.="($vl_action_consi_cleunik,$vl_commercial_cleunik,$act_cleunik_cons,$art_cleunik,$qtecons,0,-1),";
            $vl_action_consi_cleunik++;    
          }
        }
      break;
    }
    $vl_action_rep_cleunik++;
    $vl_action_trans_cleunik++;  
    $vl_adr_cleunik++;
    $vl_action_cleunik++;$vl_commercial_cleunik++;
  }
  if ($i % $b==0){
    $o_action->execute();
    $o_entete->execute();
    $o_adresse->execute();
    $o_graal->execute();
    switch ($vl_c_typedoc) {
      case "cdecli":
      case "livcli":
      case "faccli":
			case "avocli":
        $o_rep->execute();
        $o_transporteur->execute();
        $o_consigne->execute();
        break;
      case "cdefou":
      case "recfou":
      case "facfou":
        break;
    }
  }
}
$o_action->execute();
$o_entete->execute();
$o_adresse->execute();
$o_graal->execute();
switch ($vl_c_typedoc) {
  case "cdecli":
  case "livcli":
  case "faccli":
	case "avocli":
    $o_rep->execute();
    $o_transporteur->execute();
    $o_consigne->execute();
    break;
  case "cdefou":
  case "recfou":
  case "facfou":
    break;
}
_graal_libere_requete_bd($result);
$nbdoc=$i;
//  Traitement des lignes
$o_lignes->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_lignes (commercial_ligne_cleunik,commercial_cleunik,ligne_cleunik,art_cleunik,code_interne,indice_interne,mnemotechnique_interne,description_interne,typeligne,pu,pu_portee,pu_type,nbdec_pu,tarif_cleunik,remise_taux,remise_type,remise_genr,poidsbrut,tare,poidsnet,devise_taux,pr,blocnotebrut,blocnoteriche,devise) VALUES ";
$o_lignes_qte->req="INSERT INTO $vl_c_base_destination._".$vl_c_typedoc."_lignes_qte (commercial_ligne_cleunik,ligne_cleunik,ligne_qte_cleunik,qte,qte_unite,qte_nbdec,dateheure_demande,dateheure_confirm,statut,unite_condi,qte_condi,nb_stock_in_condi)  VALUES ";
$commercial_ligne_cleunik=_graal_requete_max("commercial_ligne_cleunik",$vl_c_base_destination."._".$vl_c_typedoc."_lignes");
$ligne_qte_cleunik=_graal_requete_max("ligne_qte_cleunik",$vl_c_base_destination."._".$vl_c_typedoc."_lignes_qte");
$doc_cod=array();$doc_cle=array();$doc_dat=array();$doc_dev=array();
$sql_req="select commercial_cleunik,code,dateheurecreation,devise from $vl_c_base_destination._".$vl_c_typedoc."_entetes;";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($doc_cod, $row['code']);
  array_push ($doc_cle, $row['commercial_cleunik']);
  array_push ($doc_dat, $row['dateheurecreation']);
  array_push ($doc_dev, $row['devise']);
}
_graal_libere_requete_bd($result);
$art_cod=array();$art_cle=array();$art_ind=array();$art_mne=array();$art_des=array();
$sql_req="select art_cleunik,code,indice,mnemotechnique,description from $vl_c_base_destination._article;";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  array_push ($art_cod, $row['code']);
  array_push ($art_cle, $row['art_cleunik']);
  array_push ($art_ind, $row['indice']);
  array_push ($art_mne, $row['mnemotechnique']);
  array_push ($art_des, $row['description']);
}
_graal_libere_requete_bd($result);
$i=0;$b=500;
$result = _graal_requete_bd($sql_req_lig);
while ($row = mysql_fetch_assoc($result)) {
  $vl_e_trouve=array_search($row['CodeDocument'], $doc_cod);
  if ($vl_e_trouve===false) {} else {
    $commercial_ligne_cleunik++;
    $ligne_qte_cleunik++;
    $i++;
    $commercial_cleunik=$doc_cle[$vl_e_trouve];
    $devise=$doc_dev[$vl_e_trouve];
    $dateheure_demande=$doc_dat[$vl_e_trouve];
    $dateheure_confirm=$doc_dat[$vl_e_trouve];
    $ligne_cleunik=$row['NumeroLigne'];
    $vl_e_trouve=array_search($row['CodeArticle'], $art_cod);
    if ($vl_e_trouve===false) {
      $art_cleunik=0;
      $code_interne=addslashes($row['CodeArticle']);
      $indice_interne='';
      $mnemotechnique_interne=addslashes($row['CodeArticle']);
      $description_interne=addslashes($row['Designation']);
    } else {
      $art_cleunik=$art_cle[$vl_e_trouve];
      $code_interne=addslashes($art_cod[$vl_e_trouve]);
      $indice_interne=addslashes($art_ind[$vl_e_trouve]);
      $mnemotechnique_interne=addslashes($art_mne[$vl_e_trouve]);
      $description_interne=addslashes($art_des[$vl_e_trouve]);
    }
    $typeligne=$row['TypeLigne'];
    $qte=$row['Quantite'];
    $qte_nbdec=$row['NombreDec'];
    $vl_e_trouve_univen=array_search($row['UniteMesure'], $univen_cod);if ($vl_e_trouve_univen===false) {$qte_unite=$qte_unite_defaut;} else {$qte_unite=$univen_cle[$vl_e_trouve_univen];}
    $pu=$row['PrixUnitaire'];
    $pu_portee=1;
    $pu_type=1;
    $nbdec_pu=2;
    $tarif_cleunik=$tarif_defaut;
    $remise_taux=$row['Remise'];
    $remise_type=1;
    $remise_genr=1;
    $poidsbrut=$row['PoidsB'];
    $tare=$row['Tare'];
    $poidsnet=$row['PoidsN'];
    $devise_taux=1;
    $pr=$row['PRUnitaire'];
    $statut=1;
    $vl_e_trouve_condit=array_search($row['Conditionnement'], $condit_cod);if ($vl_e_trouve_condit===false) { $unite_condi=-37;} else {$unite_condi=$condit_cle[$vl_e_trouve_condit];}
    $qte_condi=$row['NombreColis'];
    $nb_stock_in_condi=$row['NombreParcolis'];
    if($row['TypeLigne']=='T') {
      $blocnotebrut=addslashes($row['Designation']);
      $blocnoteriche=addslashes($row['Designation']);
    } else {
      $blocnotebrut='';
      $blocnoteriche='';
    }
    if ($row['LigneSoldee']==0){$statut=-38;} else {$statut=-39;}
    if ($typeligne=='T') {$statut=-39;}
    $o_lignes->dat.="($commercial_ligne_cleunik,$commercial_cleunik,$ligne_cleunik,$art_cleunik,'$code_interne','$indice_interne','$mnemotechnique_interne','$description_interne','$typeligne',$pu,$pu_portee,$pu_type,$nbdec_pu,$tarif_cleunik,$remise_taux,$remise_type,$remise_genr,$poidsbrut,$tare,$poidsnet,$devise_taux,$pr,'$blocnotebrut','$blocnoteriche',$devise),";
    $o_lignes_qte->dat.="($commercial_ligne_cleunik,1,$ligne_qte_cleunik,$qte,$qte_unite,$qte_nbdec,'$dateheure_demande','$dateheure_confirm',$statut,$unite_condi,$qte_condi,$nb_stock_in_condi),";
    if ($i % $b==0){
      $o_lignes->execute();
      $o_lignes_qte->execute();
    }
  }
}
$o_lignes->execute();
$o_lignes_qte->execute();
_graal_libere_requete_bd($result);
switch ($vl_c_typedoc) {
  case "cdecli":break;
  case "livcli":break;
  case "faccli":
		$sql_req="update $vl_c_base_destination._".$vl_c_typedoc."_entetes set date_fact=dateheurecreation where date_fact is null;";
		_graal_exec_requete($sql_req);
		break;
	case "avocli":
		$sql_req="update $vl_c_base_destination._".$vl_c_typedoc."_entetes set date_avoi=dateheurecreation where date_avoi is null;";
		_graal_exec_requete($sql_req);
		break;
  case "cdefou":break;
  case "recfou":	break;
  case "facfou":
		$sql_req="update $vl_c_base_destination._".$vl_c_typedoc."_entetes set date_fact=dateheurecreation where date_fact is null;";
		_graal_exec_requete($sql_req);
		break;
}
//  Fonctionne pour les lignes de commande fournisseur
//  Ne fonctionne pas pour les lignes de réception fournisseur
//  Ne fonctionne pas pour les lignes de facture fournisseur
$sql_req="update _actions set statut=-40 where choix_cleunik=$vf_e_choix_cleunik_doc and action_cleunik not in (select action_cleunik from _".$vl_c_typedoc."_entetes where (select count(*) from _".$vl_c_typedoc."_lignes where statut=-38 and _".$vl_c_typedoc."_lignes.commercial_cleunik=_".$vl_c_typedoc."_entetes.commercial_cleunik) >0);";
_graal_exec_requete($sql_req);
$sql_req="update _".$vl_c_typedoc."_lignes a1,_".$vl_c_typedoc."_entetes a2 set a1.catcompta_cleunik=a2.catcompta_cleunik where a1.commercial_cleunik=a2.commercial_cleunik;";
_graal_exec_requete($sql_req);
$sql_req="update _".$vl_c_typedoc."_lignes a1,_art_compta a2 set a1.pc_cleunik=a2.pc_cleunik_vente,a1.taxes_cleunik=a2.taxes_cleunik where a1.art_cleunik=a2.art_cleunik and a1.catcompta_cleunik=a2.catcompta_cleunik;";
_graal_exec_requete($sql_req);
//  Insertion HT marchandise remisé
$sql_req="replace into _".$vl_c_typedoc."_compta select commercial_cleunik,catcompta_cleunik,taxes_cleunik,pc_cleunik,1,round(sum(htbrutremise-montantremise_pied),4) from _vue_".$vl_c_typedoc."_ht_01 group by catcompta_cleunik,taxes_cleunik,commercial_cleunik;";
_graal_exec_requete($sql_req);
$nblig=$i;
switch ($vl_c_typedoc) {
  case "cdecli":echo($nbdoc." commandes clients ajoutées et $nblig lignes");break;
  case "livcli":echo($nbdoc." livraisons clients ajoutées et $nblig lignes");break;
  case "faccli":echo($nbdoc." factures clients ajoutés et $nblig lignes");break;
	case "avocli":echo($nbdoc." avoirs clients ajoutés et $nblig lignes");break;
  case "cdefou":echo($nbdoc." commandes fournisseurs ajoutées et $nblig lignes");break;
  case "recfou":echo($nbdoc." réceptions fournisseurs ajoutées et $nblig lignes");break;
  case "facfou":echo($nbdoc." factures fournisseurs ajoutées et $nblig lignes");break;
}
?>
