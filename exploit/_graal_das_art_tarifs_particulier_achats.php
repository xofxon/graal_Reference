<?php
include("_graal_header_xml.inc.php");
$vl_e_art_cleunik=intval(fa_recup_param("vl_art_cleunik","10000113"));
$vl_actif=intval(fa_recup_param("actif",3));
$sql_req = "SELECT _acteurs.act_cleunik as act_cleunik,tar_cleunik,quantite_basse,quantite_haute,";
$sql_req.= " case _art_tarifs.pu_reference WHEN 0 THEN '' ELSE round(_art_tarifs.pu_reference,_art_tarifs.nb_dec) END as pu_reference,choix_code,";
$sql_req.= " choix_valeur_texte_01,nomcommercial,"._graalsql_date('dateheure_validite')." as datevalidite,_art_tarifs.actif,_art_tarifs.nb_dec,";
$sql_req.= _graalsql_date('dateheure_dermaj')." as date_dermaj";
$sql_req.= "  FROM _article,_art_tarifs,_choix,_acteurs where choix_cleunik=tarif_cleunik and _art_tarifs.art_cleunik=$vl_e_art_cleunik ";
$sql_req.= " and _article.art_cleunik=_art_tarifs.art_cleunik and _art_tarifs.act_cleunik<>0 and _acteurs.act_cleunik=_art_tarifs.act_cleunik and type=2";
switch ($vl_actif) {
  case 1 : $sql_req.= " and _art_tarifs.actif=1";break;
  case 2 : $sql_req.= " and _art_tarifs.actif=2";break;
  case 3 : break;
}
$sql_req.=" order by choix_valeur_texte_01;";
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
		echo(' tar_cleunik_particulier_achat="'.fa_ent_xml($row['tar_cleunik']).'"');
    echo(' act_cleunik_particulier_achat="'.fa_ent_xml($row['act_cleunik']).'"');
    echo(' code_particulier_achat="'.fa_ent_xml($row['choix_code']).'"');
    echo(' designation_particulier_achat="'.fa_ent_xml($row['choix_valeur_texte_01']).'"');
    echo(' tarif_particulier_achat="'.fa_ent_xml($row['pu_reference']).'"');
    echo(' nomacteur_particulier_achat="'.fa_ent_xml($row['nomcommercial']).'"');
		echo(' nbdec="'.fa_ent_xml($row['nb_dec']).'"');		
    if ($row['actif']==1) {
      echo(' properties=""');
    } else {
      echo(' properties="css_0001"');
    }
    echo(' datevalidite="'.fa_ent_xml($row['datevalidite']).'"');
    $borne_basse=fa_reel(fa_ent_xml($row['quantite_basse']),0);
 	$val_borne_basse=fa_ent_xml($row['quantite_basse'])*1000;
  	echo(' borne_basse="'.$borne_basse.'"');
  	printf(' val_borne_basse="%011u"',$val_borne_basse);
  	$borne_haute=fa_reel(fa_ent_xml($row['quantite_haute']),0);
 	$val_borne_haute=fa_ent_xml($row['quantite_haute'])*1000;
  	echo(' borne_haute="'.$borne_haute.'"');
  	printf(' val_borne_haute="%011u"',$val_borne_haute);
  	echo(' date_dermaj="'.fa_ent_xml($row['date_dermaj']).'"');
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
