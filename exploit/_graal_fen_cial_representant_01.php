<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_action_cleunik=intval(fa_recup_param("vl_e_action_cleunik","-1"));
$vl_action_rep_cleunik=intval(fa_recup_param("vl_e_action_rep_cleunik","0"));
$commercial_cleunik=intval(fa_recup_param("vl_commercial_cleunik","0"));
$sql_req="SELECT choix_cleunik from _actions where action_cleunik=$vl_action_cleunik;";
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
switch ($row['choix_cleunik']) {
  case -110108:$vl_c_genreaction="cdecli";$vl_c_fic_entete="_cdecli_entetes";$vl_c_fic_rep="_cdecli_representants";$vl_c_id_fenetre="Fen_00680";break;
  case -110109:$vl_c_genreaction="cdefou";$vl_c_fic_entete="_cdefou_entetes";$vl_c_fic_rep="_cdefou_representants";$vl_c_id_fenetre="Fen_00684";break;
  case -110110:$vl_c_genreaction="livcli";$vl_c_fic_entete="_livcli_entetes";$vl_c_fic_rep="_livcli_representants";$vl_c_id_fenetre="Fen_00681";break;
  case -110111:$vl_c_genreaction="recfou";$vl_c_fic_entete="_recfou_entetes";$vl_c_fic_rep="_recfou_representants";$vl_c_id_fenetre="Fen_00685";break;
  case -110112:$vl_c_genreaction="faccli";$vl_c_fic_entete="_faccli_entetes";$vl_c_fic_rep="_faccli_representants";$vl_c_id_fenetre="Fen_00682";break;
  case -110113:$vl_c_genreaction="facfou";$vl_c_fic_entete="_facfou_entetes";$vl_c_fic_rep="_facfou_representants";$vl_c_id_fenetre="Fen_00686";break;
  case -110114:$vl_c_genreaction="offcli";$vl_c_fic_entete="_offcli_entetes";$vl_c_fic_rep="_offcli_representants";$vl_c_id_fenetre="Fen_00679";break;
  case -110115:$vl_c_genreaction="demfou";$vl_c_fic_entete="_demfou_entetes";$vl_c_fic_rep="_demfou_representants";$vl_c_id_fenetre="Fen_00683";break;
  case -110116:$vl_c_genreaction="avocli";$vl_c_fic_entete="_avocli_entetes";$vl_c_fic_rep="_avocli_representants";$vl_c_id_fenetre="Fen_00682";break;
  case -110117:$vl_c_genreaction="avocli";$vl_c_fic_entete="_avocli_entetes";$vl_c_fic_rep="_avocli_representants";$vl_c_id_fenetre="Fen_00682";break;
  default:fa_redirige("acces_interdit");break;
}
_graal_libere_requete_bd($result);
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bpg_100=fa_recup_dico("bpg_100");
$vl_c_bpg_101=fa_recup_dico("bpg_101");
$vl_c_bpg_102=fa_recup_dico("bpg_102");
$vl_c_bpg_103=fa_recup_dico("bpg_103");
$vl_c_bpg_104=fa_recup_dico("bpg_104");
$vl_c_bpg_105=fa_recup_dico("bpg_105");
$vl_c_bpg_106=fa_recup_dico("bpg_106");
$vl_c_bpg_107=fa_recup_dico("bpg_107");
$vl_c_bpg_108=fa_recup_dico("bpg_108");
$vl_c_bpg_109=fa_recup_dico("bpg_109");
$vl_c_bpg_110=fa_recup_dico("bpg_110");
$vl_c_bpg_111=fa_recup_dico("bpg_111");
$vl_c_bpg_112=fa_recup_dico("bpg_112");


$vl_c_dico_00002=fa_recup_dico('dico_00002');
$vl_c_dico_00003=fa_recup_dico('dico_00003');
$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_dico_00010=fa_recup_dico('dico_00010');
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_id_inc_acteurs_recherche="Div_00443";
$vl_c_inactif_acteurs_recherche='true';
$vl_c_qui_acteurs_recherche='11';
if ($vl_action_rep_cleunik==0) {
  $sql_req="SELECT a1.code as code,a2.raisonsoc as raisonsoc from $vl_c_fic_entete a1 left join _acteurs a2 using(act_cleunik) where action_cleunik=$vl_action_cleunik;";
  $result = _graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_c_qui=$row['code'];
  $vl_c_acteur=$row['raisonsoc'];
  $vl_act_cleunik=$row['act_cleunik'];
  _graal_libere_requete_bd($result);
  $vl_c_rep="";
  $vl_act_cleunik_rep=0;
$vl_c_boutons=<<<EOT
  <hbox> 
    <button width="40" flex="1" id="bt_ajouter" label="$vl_c_dico_00002" crop="end" dir="normal" oncommand="pf_validation('enregistrer')" />
    <button width="40" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
  </hbox>
EOT;
} else {
  $sql_req="SELECT a1.code as code,a2.raisonsoc as raisonsoc,a3.act_cleunik_rep as act_cleunik_rep,a4.raisonsoc as raisonsoc_rep from $vl_c_fic_entete a1 left join _acteurs a2 using(act_cleunik) left join $vl_c_fic_rep a3 using (commercial_cleunik) left join _acteurs a4 on(a3.act_cleunik_rep=a4.act_cleunik) where action_rep_cleunik=$vl_action_rep_cleunik;";
  $result = _graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_c_qui=$row['code'];
  $vl_c_acteur=$row['raisonsoc'];
  $vl_act_cleunik_rep=$row['act_cleunik_rep'];
  $vl_c_rep=$row['raisonsoc_rep'];
  _graal_libere_requete_bd($result);

$vl_c_boutons=<<<EOT
  <hbox> 
    <button width="40" flex="1" id="bt_modifier" label="$vl_c_dico_00003" crop="end" dir="normal" oncommand="pf_validation('modifier')" />
    <button width="40" flex="1" id="bt_supprimer" label="$vl_c_dico_00004" crop="end" dir="normal" oncommand="pf_validation('supprimer_bis')" />
    <button width="40" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
  </hbox>
EOT;
}
include("_graal_header_winxul.inc.php"); 
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_context_00='<popupset><popup id="pop_arbre_representants"><menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\'arbre_representants\');" /></popup></popupset>';
echo <<<END
<window context="graal_cp00" title="$vl_c_bpg_100" id="_win_fen_act_representants" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
$vl_c_context_00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_cial_representant_01.js.php");
if ($vl_action_rep_cleunik==0) {
  include("_graal_inc_acteurs_recherche_01.php");
  echo ("<splitter/>");
}
echo <<<END
  <groupbox >
  <label control="la_prefixe_choix_cleunik" value="$vl_c_bpg_101"/>
  <textbox id="tb_qui_action" value="$vl_c_qui ($vl_c_acteur)" disabled="true" />
  <label value="$vl_c_bpg_108"/>
  <textbox id="tb_qui_droite" value="$vl_c_rep" _graal_act_cleunik="$vl_act_cleunik_rep" disabled="true" />
  <hbox>
    <vbox flex="1">
      <label flex="1"/>
      <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="2" id="ml_commission_typ" _graal_nombre="3">
        <menupopup>
          <menuitem value="1" label="$vl_c_bpg_102"/>
          <menuitem value="2" label="$vl_c_bpg_103"/>
          <menuitem value="3" label="$vl_c_bpg_104"/>
        </menupopup>
      </menulist>
    </vbox>
    <vbox>
        <label control="la_taux" value="$vl_c_bpg_102"/>
        <textbox flex="1" id="tb_taux" type="number" hidespinbuttons="true" decimalplaces="2"   />
    </vbox>
    <vbox>

        <label control="la_montant" value="$vl_c_bpg_103"/>
        <textbox flex="1" id="tb_montant" type="number" hidespinbuttons="true" decimalplaces="2"   />
    </vbox>
      <vbox flex="2">
      <label value="$vl_c_bpg_105"/>
      <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" observes="broadcaster_01" flex="2" id="ml_commission_regle" _graal_nombre="2">
        <menupopup>
          <menuitem value="1" label="$vl_c_bpg_106"/>
          <menuitem value="2" label="$vl_c_bpg_107"/>
        </menupopup>
      </menulist>
    </vbox>    

  </hbox>
  $vl_c_boutons
  </groupbox>
END;
if ($vl_action_rep_cleunik==0) {
echo <<<END
<splitter/>
<tree id="arbre_representants" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" context="pop_arbre_representants">
  <treecols>
    <treecol hidden="true" id="tr_act_cleunik_rep" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol hidden="true" id="tr_action_rep_cleunik" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol id="tr_qui" label="$vl_c_bpg_108" sort="?qui_gauche_00"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol id="tr_type" label="$vl_c_bpg_109" sort="?type"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol id="tr_taux" class="droite" label="$vl_c_bpg_110" sort="?taux"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol id="tr_fixe" class="droite" label="$vl_c_bpg_111" sort="?fixe"/><splitter class="tree-splitter" resizeafter="grow"/>
    <treecol id="tr_regle" label="$vl_c_bpg_112" sort="?regle"/><splitter class="tree-splitter" resizeafter="grow"/>
  </treecols>
  <template>
	<query expr="*"/>
   	<action>
    <treechildren>
      <treeitem uri="?" seltype="single">
        <treerow>
          <treecell label="?act_cleunik_rep"/>
          <treecell label="?action_rep_cleunik"/>
          <treecell label="?qui"/>
          <treecell label="?type"/>
          <treecell label="?taux"/>
          <treecell label="?fixe"/>
          <treecell label="?regle"/>
        </treerow>
      </treeitem>
    </treechildren>
		</action>
  </template>
</tree>
<button width="40" id="bt_supprimer" label="$vl_c_dico_00004" crop="end" dir="normal" oncommand="pf_validation('supprimer')" />
END;
}
echo('</window>');
?>
