<?php
/* Pour les pseudos-docs,les notes, les modèles de courriel et les flux RSS */
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_doc_cleunik=intval(fa_recup_param('vl_e_doc_cleunik','0'));
$sql_req = "SELECT f2.emplacement_prive,f2.emplacement_publi,f2.niveauacces,f2.nb_affiche,f2.typeacces,f2.genre,f1.typedoc as typedoc,f1.doc_cleunik AS doc_cleunik,f1.titre AS titre,f1.dateheurecreation AS dateheurecreation,f1.dateheuremodif AS dateheuremodif,f1.descriptif_sommaire as descriptif_sommaire,f1.tailledoc as tailledoc,f1.hash as hash,f1.origine as origine,(select count(*) from _documents_rattachement where doc_cleunik=10000$vl_e_doc_cleunik431) as nombre FROM _documents f1 left join _documents_rss f2 using (doc_cleunik) WHERE f1.doc_cleunik=$vl_e_doc_cleunik;";
$vl_e_critere_cleunik=0;
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
echo(fa_xcree_entete_xml());
  echo('<Description>');
	//echo('<sql data='.$sql_req.'/>');
  echo('<doc_cleunik data="'.fa_ent_xml($row['doc_cleunik']).'"/>');
  echo('<emplacement_prive data="'.fa_ent_xml($row['emplacement_prive']).'"/>');
  echo('<emplacement_publi data="'.fa_ent_xml($row['emplacement_publi']).'"/>');
  echo('<titre data="'.fa_ent_xml($row['titre']).'"/>');
  echo('<dateheurecreation data="'.fa_ent_xml($row['dateheurecreation']).'"/>');
  echo('<dateheuremodif data="'.fa_ent_xml($row['dateheuremodif']).'"/>');
  echo('<descriptif_sommaire  data="'.fa_ent_xml($row['descriptif_sommaire']).'"/>');
  echo('<tailledoc data="'.fa_ent_xml($row['tailledoc']).'"/>');
  echo('<hash data="'.fa_ent_xml($row['hash']).'"/>');
  echo('<origine data="'.fa_ent_xml($row['origine']).'"/>');
  echo('<nombre data="'.fa_ent_xml($row['nombre']).'"/>');
  echo('<typedoc data="'.fa_ent_xml($row['typedoc']).'"/>');
	echo('<nb_affiche data="'.fa_ent_xml($row['nb_affiche']).'"/>');
	echo('<typeacces data="'.fa_ent_xml($row['typeacces']).'"/>');
	echo('<niveauacces data="'.fa_ent_xml($row['niveauacces']).'"/>');
	echo('<genre data="'.fa_ent_xml($row['genre']).'"/>');
	_graal_libere_requete_bd($result);
/*	
	//	Recherche du nombre de critères
	$sql_req="SELECT count(*) as nombre FROM _documents_choix_fixes where doc_cleunik=$vl_e_doc_cleunik;";
	$result = _graal_requete_bd($sql_req);
	$row = mysql_fetch_assoc($result);
	if ($row['nombre']==0) {
		echo('<nombre_criteres data=""/>');
	} else {
		echo('<nombre_criteres data=" ('.fa_ent_xml($row['nombre']).')"/>');
	}
	_graal_libere_requete_bd($result);
	//	Recherche du nombre de commentaires
	$sql_req="SELECT count(*) as nombre FROM _documents_commentaires where doc_cleunik=$vl_e_doc_cleunik;";
	$result = _graal_requete_bd($sql_req);
	$row = mysql_fetch_assoc($result);
	if ($row['nombre']==0) {
		echo('<nombre_commentaires data=""/>');
	} else {
		echo('<nombre_commentaires data=" ('.fa_ent_xml($row['nombre']).')"/>');
	}
	_graal_libere_requete_bd($result);
	//	Recherche du nombre de connexions
	$sql_req="SELECT count(*) as nombre FROM _documents_connexions where doc_cleunik_gauche=$vl_e_doc_cleunik or doc_cleunik_droite=$vl_e_doc_cleunik;";
	$result = _graal_requete_bd($sql_req);
	$row = mysql_fetch_assoc($result);
	if ($row['nombre']==0) {
		echo('<nombre_connexions data=""/>');
	} else {
		echo('<nombre_connexions data=" ('.fa_ent_xml($row['nombre']).')"/>');
	}
	_graal_libere_requete_bd($result);
//	Recherche du nombre de rattachements
	$sql_req="SELECT count(*) as nombre FROM _documents_rattachement where doc_cleunik=$vl_e_doc_cleunik;";
	$result = _graal_requete_bd($sql_req);
	$row = mysql_fetch_assoc($result);
	if ($row['nombre']==0) {
		echo('<nombre_rattachements data=""/>');
	} else {
		echo('<nombre_rattachements data=" ('.fa_ent_xml($row['nombre']).')"/>');
	}
	_graal_libere_requete_bd($result);
*/
echo('</Description>'.EOL);

_graal_ferme_connexion();
?>
