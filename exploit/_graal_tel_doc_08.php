<?php
// transformation d'un fichier .tiff en fichier .png
include("_graal_header_html.inc.php");
include("_graal_var_portee.php");
include("_graal_fonctions_cryptage.php");
include("_graal_fonctions_documents.php");
require("_graal_fonctions_url_absolue.php");
$vl_c_fichier=fa_recup_param('vl_c_fichier','');
$vl_c_uuid=_graal_requete_uuid();

switch ($_SERVER["HTTP_HOST"]){
	case "localhost":
		$nom_fichier="ecoute".$vl_c_uuid.".ogg";
		$path_pj="mail/$nom_fichier";
		$resultat=exec("ffmpeg -i $vl_c_fichier -acodec vorbis -ac 2 -ab 13 -y $path_pj");
		header('Content-type: application/ogg');
		echo file_get_contents("$path_pj");
		break;
	default:
		
/*		
		
		$nom_fichier="ecoute".$vl_c_uuid.".mp3";
		$path_pj="mail/$nom_fichier";
		$resultat=exec("ffmpeg -ab 192 -i $vl_c_fichier $path_pj");
		$page=<<<EOT
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="fr"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head><body>
  <div class="resultObject">
  <object type="audio/mpeg" data="$path_pj" width="200" height="20">
  <param name="src" value="$path_pj">
  <param name="autoplay" value="false">
  <param name="autoStart" value="0">
  alt : <a href="$path_pj">Ecouter</a>
</object>
</div>
</body>
EOT;
		echo $page;
		break;
		
*/

		$url_absolue=fa_url_absolue("oui");
		$nom_fichier="ecoute".$vl_c_uuid.".mp3";
		$path_pj="mail/$nom_fichier";
		$resultat=exec("ffmpeg -ab 192 -i $vl_c_fichier $path_pj");
		
										$lecteur=$url_absolue."dewplayer.swf?son=$path_pj";
								$page=<<<EOT
		<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Message téléphonique</title>
	</head>
	<body>
	<p align="justify">
	Ecouter
<object type="application/x-shockwave-flash" data="$lecteur" width="200" height="20"> 
<param name="movie" value="$lecteur" pluginspage='http://www.macromedia.com/go/getflashplayer'/> 
</object>	
</p> 
	</body>
</html>
EOT;
		
		echo $page;
		break;
		
}
//$path_pj="mail/toto.ogg";
/*
 * le 30 décembre 2009 conversion en ogg ne fonctionne pas avec la version installée sur les serveurs main et secours 
 * $resultat=exec("ffmpeg -i $vl_c_fichier -acodec vorbis -ac 2 -ab 13 -y $path_pj");
 */
//sleep(2);
/*
 * Première solution : uniquement afficher l'objet, mais on ne peut pas régler le son, par exemple
 */

/*
header('Content-type: application/ogg');
echo file_get_contents("$path_pj");
*/
/*
 * Deuxième solution un objet : en fait pas plus de réglage de volume (sous ubuntu) mais possibilité de lancer l'écoute à la demande
 * 
 * Ne s'affiche pas sous windows
 */


/*
$url_absolue=fa_url_absolue("oui");
										$path=$url_absolue.$path_pj;
										$lecteur=$url_absolue."dewplayer.swf?son=$path";
$page=<<<EOT

		<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Message téléphonique</title>
	</head>
	<body>
	<p align="justify">
	Ecouter
<object type="application/x-shockwave-flash"
data="$lecteur"
width="200" height="20"> <param name="movie" value="$lecteur" pluginspage='http://www.macromedia.com/go/getflashplayer'/> 
</object>	
</p> 
	</body>
</html>
EOT;
*/

?>
