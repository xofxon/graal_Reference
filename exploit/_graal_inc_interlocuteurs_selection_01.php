<?php
include("_graal_var_portee.php");
$vl_c_infos_adresses='true';
_graal_requete_charge_varlib($vl_c_id_inc_interlocuteurs_selection_01,$vl_e_uti_cleunik);
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->selection_interlocuteur)){$selection_interlocuteur=$vl_c_xml->selection_interlocuteur->attributes();}else{$selection_interlocuteur='1';}
if (isset($vl_c_xml->vl_selint_nbcaracrech)){$vl_selint_nbcaracrech=$vl_c_xml->vl_selint_nbcaracrech->attributes();}else{$vl_selint_nbcaracrech='3';}
$vl_c_bdr_001=fa_recup_dico("bdr_001");
$vl_c_bdr_002=fa_recup_dico("bdr_002");
$vl_c_bdr_003=fa_recup_dico("bdr_003");
$vl_c_bdr_004=fa_recup_dico("bdr_004");
$vl_c_bdr_005=fa_recup_dico("bdr_005");
$vl_c_bdr_006=fa_recup_dico("bdr_006");
$vl_c_bdr_007=fa_recup_dico("bdr_007");
$vl_c_bdr_008=fa_recup_dico("bdr_008");
$vl_c_bdr_009=fa_recup_dico("bdr_009");
$vl_c_bdr_010=fa_recup_dico("bdr_010");
$vl_c_bdr_011=fa_recup_dico("bdr_011");
$vl_c_bdr_012=fa_recup_dico("bdr_012");
$vl_c_bdr_013=fa_recup_dico("bdr_013");
$vl_c_bdr_014=fa_recup_dico("bdr_014");
$vl_c_bdr_015=fa_recup_dico("bdr_015");$vl_c_bdr_015="1000";
$vl_c_dico_00019=fa_recup_dico("dico_00019");
$vl_c_dico_00031=fa_recup_dico("dico_00031");
$vl_c_dico_00032=fa_recup_dico("dico_00032");
$vl_c_dico_00033=fa_recup_dico("dico_00033");
$vl_c_dico_00034=fa_recup_dico("dico_00034");
$vl_c_dico_00035=fa_recup_dico("dico_00035");
$vl_c_dico_00036=fa_recup_dico("dico_00036");
$vl_c_dico_00037=fa_recup_dico("dico_00037");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_dico_00065=fa_recup_dico("dico_00065");
$vl_c_selqui_01="false";
$vl_c_selqui_02="false";
$vl_c_selqui_03="false";
$vl_c_selqui_04="false";
$vl_c_selqui_05="false";
$vl_c_selqui_06="false";
$vl_c_selqui_07="false";
$vl_c_selqui_08="false";
$vl_c_selqui_09="false";
$vl_c_selqui_10="false";
$vl_c_inactif="true";
$vl_e_portee=$vl_e_interl;
if ($vl_c_genreacteur=="favori") {
  $vl_c_selqui_10="true";$vl_c_inactif="true";$vl_c_selection_invisible="true";
} else {
  if ($vl_c_genreacteur=="favori_position") {
    $vl_c_selqui_10="true";
    $vl_c_selection_invisible="false";
    $vl_c_inactif="false";
  }
  else {
    $vl_c_selection_invisible="false";
    switch ($vl_c_id_inc_interlocuteurs_selection_01) {
      case "Div_00333";$vl_c_selqui_09="true";$vl_e_portee+=0;$vl_c_inactif="false";break;  //Tous les acteurs
      case "Div_00341";$vl_c_selqui_02="true";$vl_e_portee+=$vl_e_entrep;break; //  Entreprise
      case "Div_00334";$vl_c_selqui_03="true";$vl_e_portee+=$vl_e_procli;break; //  Prospects Clients
      case "Div_00335";$vl_c_selqui_04="true";$vl_e_portee+=$vl_e_profou;break; //  Prospects Fournisseurs
      case "Div_00336";$vl_c_selqui_05="true";$vl_e_portee+=$vl_e_client;break; //  Clients
      case "Div_00337";$vl_c_selqui_06="true";$vl_e_portee+=$vl_e_fourni;break; //  Fournisseurs
      case "Div_00338";$vl_c_selqui_07="true";$vl_e_portee+=$vl_e_autrac;break; //  Autres
      case "Div_00339";$vl_c_selqui_08="true";$vl_e_portee+=$vl_e_actind;break; //  Indéterminés
    }
  }
}
$vf_c_url_alimente_table="_graal_das_paniers_01.php?vl_e_maportee=";
$vl_c_source_paniers="_graal_das_paniers_01.php?vl_c_quelspaniers=medoc#38;vl_e_portee=$vl_e_portee#38;";
$vl_c_source_paniers="$vf_c_url_alimente_table$vl_e_portee";
echo <<<END
<script type="text/javascript">
<![CDATA[
function po_sel() {
  var vl_interlocuteur=$vl_e_interl;
  var vf_c_url_alimente_table="$vf_c_url_alimente_table";
  var item=fa_gid("bbj_ml_qui").selectedItem;
  var vl_portee=item.getAttribute("_graal_portee")
  var vl_e_total=parseInt(vl_portee)+parseInt(vl_interlocuteur)
  fa_das("bbj_ml_actif",vf_c_url_alimente_table+vl_e_total);
  //fa_gid("bbj_ml_actif").builder.rebuild();
  po_change_menu()
}
function po_change_menu() {
  var vo_list = document.getElementById("bbj_ml_qui")
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"))
}
]]>
</script>
<hbox id="bdr_interlocuteurs_02" collapsed="$vl_c_invisible_inc_interlocuteurs_selection_01">
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="1" id="bbj_ml_qui" oncommand="po_sel();pf_approximatif();">
      <menupopup>
        <menuitem class="menuitem-iconic ba07" crop="start" label="$vl_c_dico_00019" tooltiptext="$vl_c_dico_00019" selected="$vl_c_selqui_02" value="110000" _graal_portee="$vl_e_entrep" /> <!--  Entreprise-->
        <menuitem class="menuitem-iconic ba02" crop="start" label="$vl_c_dico_00031" tooltiptext="$vl_c_dico_00031" selected="$vl_c_selqui_03" value="110001" _graal_portee="$vl_e_procli"/> <!--  Prospects clients-->
        <menuitem class="menuitem-iconic ba04" crop="start" label="$vl_c_dico_00032" tooltiptext="$vl_c_dico_00032" selected="$vl_c_selqui_04" value="110002" _graal_portee="$vl_e_profou"/> <!--  Prospects fournisseurs-->
        <menuitem class="menuitem-iconic ba01" crop="start" label="$vl_c_dico_00033" tooltiptext="$vl_c_dico_00033" selected="$vl_c_selqui_05" value="110003" _graal_portee="$vl_e_client"/> <!--  Clients-->
        <menuitem class="menuitem-iconic ba03" crop="start" label="$vl_c_dico_00034" tooltiptext="$vl_c_dico_00034" selected="$vl_c_selqui_06" value="110004" _graal_portee="$vl_e_fourni"/> <!--  Fournisseurs-->
        <menuitem class="menuitem-iconic ba05" crop="start" label="$vl_c_dico_00035" tooltiptext="$vl_c_dico_00035" selected="$vl_c_selqui_07" value="110005" _graal_portee="$vl_e_autrac"/> <!--  Autres acteurs-->
        <menuitem class="menuitem-iconic ba06" crop="start" label="$vl_c_dico_00036" tooltiptext="$vl_c_dico_00036" selected="$vl_c_selqui_08" value="110006" _graal_portee="$vl_e_actind"/> <!--  Acteurs indéterminés-->
        <menuitem class="menuitem-iconic ai18" crop="start" label="$vl_c_dico_00065" tooltiptext="$vl_c_dico_00065" selected="$vl_c_selqui_09" value="999999" _graal_portee="000000000000"/> <!--  Tous les acteurs-->
        <menuitem class="menuitem-iconic ag15" crop="start" label="$vl_c_dico_00037" tooltiptext="$vl_c_dico_00037" selected="$vl_c_selqui_10" value="888888" _graal_portee="000000000000"/> <!--  Tous les favoris-->
      </menupopup>
    </menulist>
    <hbox collapsed="$vl_c_selection_invisible" id="selections" flex="3">
      <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="10" id="bbj_ml_actif" oncommand="pf_approximatif();" flags="" ref="*" querytype="xml" datasources="$vl_c_source_paniers" >
        <menupopup>
          <menuitem label="$vl_c_dico_00046" tooltiptext="$vl_c_dico_00046" selected="true" value="1" /> <!--  Actifs-->
          <menuitem label="$vl_c_dico_00047" tooltiptext="$vl_c_dico_00047" value="2" /> <!--  Inactifs-->
          <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" value="0" /> <!--  Tous-->
        </menupopup>
        <template><query expr="*"/><action>
          <menupopup>
            <menuseparator/>
            <menuitem uri="?" class="menuitem-iconic ?prop" label="?panier_titre" tooltiptext="?panier_titre" selected="true" value="3" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers-->
          </menupopup>
        </action></template>
      </menulist>
    <label flex="0" value="$vl_c_bdr_002"/>
    <textbox flex="2" value="$vl_c_bdr_010" id="bbj_tb_rechapproxima" oninput="if ('$vl_selint_nbcaracrech'!='-1') {if (this.value.length>=$vl_selint_nbcaracrech){pf_approximatif();}}"  />
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' class="sans_icone" flex="1" id="bbj_ml_type" oncommand="pf_approximatif()" value="1">
      <menupopup>
        <menuitem label="$vl_c_bdr_003" tooltiptext="$vl_c_bdr_003" value="1"/>
        <menuitem label="$vl_c_bdr_004" tooltiptext="$vl_c_bdr_004" value="2" hidden="true" />
      </menupopup>
    </menulist>
    <label flex="0" value="$vl_c_bdr_005"/>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' class="sans_icone" flex="1" id="bbj_ml_zone" oncommand="pf_approximatif()" value="$selection_interlocuteur">
      <menupopup>
        <menuitem label="$vl_c_bdr_006" tooltiptext="$vl_c_bdr_006" value="1"/> <!--  Nom de la société-->
        <menuitem label="$vl_c_bdr_007" tooltiptext="$vl_c_bdr_007" value="2"/> <!--  Nom commercial de la société-->
        <menuitem label="$vl_c_bdr_013" tooltiptext="$vl_c_bdr_013" value="3"/> <!--  Nom-prénom de l''interlocuteur-->
        <menuitem label="$vl_c_bdr_011" tooltiptext="$vl_c_bdr_011" value="4"/> <!--  Code de l''acteur-->
        <menuitem label="$vl_c_bdr_012" tooltiptext="$vl_c_bdr_012" value="5"/> <!--  Id Mnémotechnique de l''acteur-->
        <menuitem label="$vl_c_bdr_014" tooltiptext="$vl_c_bdr_014" value="6" hidden="$vl_c_infos_adresses"/>
      </menupopup>
    </menulist>
    <keyset id="_graal_ks_02">
    <key id="k-recherche" modifiers="alt" keycode="VK_F3" oncommand="pf_approximatif();"/>
	</keyset>
		<textbox flex="0"   value="$vl_c_bdr_015" id="bbj_tb_limit" size="4" type="number" hidespinbuttons="true"/>
      <toolbarbutton class="table-rafraichir" oncommand="pf_approximatif();"/>
      <toolbarbutton id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_id_fenetre')" />
    </hbox>
</hbox>
END;
?>
