<?php
include("_graal_header_xml.inc.php");
$uti_cleunik=intval(fa_recup_param("uti_cleunik","-2"));
$vl_c_quelleplage=fa_recup_param('vl_c_quelleplage','debut');
$vl_c_datedebut=fa_recup_param('vl_c_dateheuredebut','');
$vl_c_datefin=fa_recup_param('vl_c_dateheurefin','');
$vl_c_heuredebut=fa_recup_param('vl_c_heuredebut','000000');
$vl_c_heurefin=fa_recup_param('vl_c_heurefin','235959');
$vl_e_limit=intval(fa_recup_param('vl_e_limit','150'));
define('EOL', "\r\n");
if ($uti_cleunik!=-2) {$vl_c_uti_cleunik=" and _utilisateur.uti_cleunik=$uti_cleunik";} else {$vl_c_uti_cleunik="";}
$sql_req = "SELECT concat(_utilisateur.prenom,' ',_utilisateur.patronyme) AS prenom_nom,_uti_connexions.uticonnexions_cleunik as uticonnexions_cleunik,_uti_connexions.dateheuredebutconnexion as dateheuredebutconnexion,_uti_connexions.infos_ip as infos_ip,_uti_connexions.infos_fenetres as infos_fenetres FROM _utilisateur, _uti_connexions WHERE _utilisateur.uti_cleunik=_uti_connexions.uti_cleunik $vl_c_uti_cleunik AND (dateheuredebutconnexion between '$vl_c_datedebut$vl_c_heuredebut' and '$vl_c_datefin$vl_c_heurefin') order by dateheuredebutconnexion desc limit $vl_e_limit";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  echo('<row:uticonnexions_cleunik NC:parseType="Integer">'.fa_ent_xml($row['uticonnexions_cleunik']).'</row:uticonnexions_cleunik>');
  echo('<row:prenom_nom>'.fa_ent_xml($row['prenom_nom']).'</row:prenom_nom>');
  echo('<row:dateheuredebutconnexion>'.fa_ent_xml($row['dateheuredebutconnexion']).'</row:dateheuredebutconnexion>');
  echo('<row:infos_fenetres>'.fa_ent_xml($row['infos_fenetres']).'</row:infos_fenetres>');
  echo('<row:infos_ip>'.fa_ent_xml($row['infos_ip']).'</row:infos_ip>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
