<?php
include_once("_graal_var_portee.php");
$vl_c_bdc_102=fa_recup_dico_js("bdc_102");
$vl_c_bdc_123=fa_recup_dico_js("bdc_123");
$vs_envah=fa_recup_session('vs_envah','');	//	Nom des bases externes
$argument1=explode("|",$vs_envah);
$nom_base_i=$argument1[1];
$vl_e_portee=$vl_e_acteur;
$vl_c_particularisme="''";
switch ($vl_c_genreacteur) {
  case "tousss": $vl_e_portee+=000000000000;break;  //  Tous les acteurs
  case "110001": $vl_e_portee+=$vl_e_procli;break;  //  prospects clients
  case "110002": $vl_e_portee+=$vl_e_profou;break;  //  prospects fournisseurs
  case "110003": $vl_e_portee+=$vl_e_client;break;  //  clients
  case "110004": $vl_e_portee+=$vl_e_fourni;break;  //  fournisseurs
  case "110005": $vl_e_portee+=$vl_e_autrac;break;  //  autres acteurs
  case "110006": $vl_e_portee+=$vl_e_actind;break;  //  acteurs indéterminés
  case "liste_blanc_tousss":$vl_e_portee+=000000000000;$vl_c_particularisme="'&vl_c_particularisme=$vl_c_genreacteur&'";break;  //  Tous les acteurs
  case "liste_noire_tousss":$vl_e_portee+=000000000000;$vl_c_particularisme="'&vl_c_particularisme=$vl_c_genreacteur&'";break;  //  Tous les acteurs
}
switch ($vl_c_genreacteur) {
  case "liste_blanc_tousss":
  case "liste_noire_tousss":
$pf_validation_duplication=<<<AAA
  function pf_validation(vv_type){
	var vl_t_acteur=pf_tab_acteurs();
    if (vl_t_acteur.length==0) {return;}
    switch (vv_type){
    	case "ajouter_liste_blanc_tousss":
    	case "ajouter_liste_noire_tousss":
    		if (!confirm("Confirmez-vous l'ajout de ces acteurs dans cette liste ?")){return;}
    		break;
    	case "supprimer_liste_blanc_tousss":
    	case "supprimer_liste_noire_tousss":
    		if (!confirm("Confirmez-vous la suppression de ces acteurs de cette liste ?")){return;}
    		break;
    }
	var vl_c_param="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
	vl_c_param+="vf_c_action="+vv_type+"&";
  vl_c_param+="vl_e_uti_cleunik="+fa_enc(fa_value_get("brk_ml_utilisateurs"))+"&";
  vl_c_param+="vl_c_genreacteur="+fa_enc('$vl_c_genreacteur')+"&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_param,pf_validation_fin);
}
function pf_validation_fin(vv_retour){
	alert(vv_retour)
	pf_approximatif();
}

AAA;
	break;
}
if ($vl_c_type=="5") {
	$pf_validation_duplication=<<<EOT
function pf_validation_duplication(vv_typeacteur){
	var vl_e_nb=fa_cl("arbre_des_acteurs_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_liste="";

	var nombre=vf_t_panier.length;
	var pasdeprogression=100/vl_e_nb;
	if (!confirm("$vl_c_bdc_123")){return;}
	fa_cache_non("vb_duplication");
	fa_cache_non("pm_evolution_01");
	fa_grise_fenetre("","oui");
	for(i=0;i<vl_e_nb;i++) {
		vl_act_cleunik=fa_cell_get("arbre_des_acteurs_panier",i,"act_cleunik_panier")+",";
		progression=parseInt(fa_value_get("pm_evolution_01")) + pasdeprogression;
      	fa_value_set("pm_evolution_01",progression);
  		var http = new XMLHttpRequest();
  		var vl_c_donnees="";
  		vl_c_donnees+="vl_typeacteur="+fa_enc(vv_typeacteur)+"&";
  		vl_c_donnees+="vl_act_cleunik="+vl_act_cleunik+"&";
  		vl_c_donnees+="vf_c_action=dupliquer&";
  		vl_c_donnees+="vl_base_destination="+fa_enc('$nom_base_i.')+"&";
 		http.open("GET","_graal_bdope_acteurs_01.php?"+vl_c_donnees,false);
  		http.send("");
	}
    pf_alimente_table();
	fa_cache_oui("pm_evolution_01");
	fa_value_set("pm_evolution_01",0);
	fa_cache_non("bt_enregistrer");
	fa_grise_fenetre("","non");
}
EOT;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_export;
var vf_c_url_alimente_table,vf_c_recup_requete,vf_titre_requete;
const vf_c_script_act='_graal_rech_acteurs_01.php?var=vs_tempo_panier_acteur&';
const vf_c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_acteur';
const vf_c_script_bdope_panier='_graal_bdope_paniers_01.php';
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const cf_fen_choix_critere="_graal_fen_sel_choix_criteres.php?vl_e_domaine=$vl_e_acteur&genre=$vl_c_genreacteur&genrecritere=";
const vf_c_script_bdope_fen_criteres="_graal_bdope_act_criteres_01.php?genreacteur=$vl_c_genreacteur&";
const _c_script_bdope_act='_graal_bdope_acteurs_01.php';
const vf_c_script_bdope_fen="_graal_bdope_traitements_acteurs_01.php";
var vf_t_panier=[];
const lstn_grise_acteurs= {
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");}
};
function pf_aa_init() {
  fa_att_set("arbre_des_acteurs",'seltype', 'multiple');
  fa_att_set("arbre_des_acteurs_panier",'seltype','multiple');
  fa_att_set("arbre_des_acteurs",'context','pop_selections');
  fa_att_set("arbre_des_acteurs_panier",'context','pop_panier');
  fa_badl("arbre_des_acteurs",lstn_grise_acteurs);
  fa_badl("arbre_des_acteurs_panier",lstn_grise_acteurs);
  switch ($vl_c_type) {
    case 1 :
    case 6 :
      fa_ael("bao_ml_qui","ValueChange",po_change_menu);
      po_change_menu();
      break;
  }
  pf_approximatif()
}
function pf_acteurs_active () {
  var vl_t_acteur=pf_tab_acteurs();
  if (vl_t_acteur.length==0) {return;}
  var vl_c_donnees="vf_c_action=kilometres_activer&";
  vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_acteurs_compta_defaut () {
  var vl_t_acteur=pf_tab_acteurs();
  if (vl_t_acteur.length==0) {return;}
  var vl_c_donnees="vf_c_action=kilometres_compta_defaut&";
  vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_acteurs_desactive () {
  var vl_t_acteur=pf_tab_acteurs();
  if (vl_t_acteur.length==0) {return;}
  var vl_c_donnees="vf_c_action=kilometres_desactiver&";
  vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_acteur_ouvre() {
  var rowIndex = fa_cui("arbre_des_acteurs");if(rowIndex == -1){return;}
  var param=fa_cell_get("arbre_des_acteurs",rowIndex,"typeacteur")+"&act_cleunik="+fa_cell_get("arbre_des_acteurs",rowIndex,"act_cleunik")+"&";
  fa_ouvre(vf_c_script_fen_acteur+param,1000,800);
}
function pf_acteurs_supprime () {
  var vl_t_acteur=pf_tab_acteurs();
  if (vl_t_acteur.length==0) {return;}
  if (!confirm("Confirmez-vous la suppression de ces acteurs ?")){return;}
  var vl_c_donnees="vf_c_action=kilometres_supprimer&";
  vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_alimente_table() {
  switch (fa_value_get("bao_ml_qui")) {
    case "000000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006": case "110006_dupliq":
      fa_cache_oui("portee");break;
    case "999999": case "888888":
      fa_cache_non("portee");break;
  }
  fa_grise_fenetre("","oui");
  fa_das("arbre_des_acteurs",vf_c_url_alimente_table);
}
function pf_approximatif(vv_valeur) {
  switch ($vl_c_type) {
    case 1:
      if ( fa_value_get("aai_tb_rechapproxima") == "" ) {return;};
      var item=fa_gid("bao_ml_actif").selectedItem;
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&";
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_url_alimente_table+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_url_alimente_table+="vl_c_inactifs=2&";}
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_recup_requete+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_recup_requete+="vl_c_inactifs=2&";}
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_url_alimente_table+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_url_alimente_table+="vl_c_inactifs=2&";}
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_recup_requete+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_recup_requete+="vl_c_inactifs=2&";}
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs=3&vl_e_panier=-68&';
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs=3&vl_e_panier=-68&';
      break;
   case 6:
      if ( fa_value_get("aai_tb_rechapproxima") == "" ) {return;};
      var item=fa_gid("bao_ml_actif").selectedItem;

      var vl_e_acteur_choix_cleunik="";
	  var vl_e_acteur_critere_cleunik="";
	  var vl_arbre=fa_gid('tb_choix_acteurs');
	  if(vl_arbre.currentIndex>=0) {
			var vl_t_tableau=fa_lignes_selectionnees("tb_choix_acteurs");
			var vl_e_nb_sel=vl_t_tableau.length;
		  	if (vl_e_nb_sel!=0) {
		    	for(i=0;i<vl_e_nb_sel;i++) {
		    		var selected  = vl_arbre.contentView.getItemAtIndex(vl_t_tableau[i]);
					if (i!=0) {
						vl_e_acteur_choix_cleunik+=",";
						vl_e_acteur_critere_cleunik+=",";
					}
    				vl_e_acteur_choix_cleunik+= selected.firstChild.childNodes[0].getAttribute("_graal_choix_cleunik");
    				//alert(vl_e_acteur_choix_cleunik)
					vl_e_acteur_critere_cleunik+= selected.firstChild.childNodes[0].getAttribute("_graal_critere_cleunik");
		    	}
			}
			vl_e_acteur_choix=fa_value_get("rdg_cherche_choix");
	  } else {
	  	vl_e_acteur_choix_cleunik=0;
		vl_e_acteur_choix=0;
		vl_e_acteur_critere_cleunik=0;
	  }
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"));
      vf_c_url_alimente_table+='&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random();
      vf_c_url_alimente_table+='&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&";
      vf_c_url_alimente_table+="&vl_e_acteur_choix="+vl_e_acteur_choix;
	  vf_c_url_alimente_table+="&vl_e_acteur_choix_cleunik="+vl_e_acteur_choix_cleunik;
	  vf_c_url_alimente_table+="&vl_e_acteur_critere_cleunik="+vl_e_acteur_critere_cleunik;
	  vf_c_url_alimente_table+="&$vl_c_particularisme"+'&vl_brk_ml_utilisateurs='+fa_value_get('brk_ml_utilisateurs')+'&vl_c_action_particularisme='+fa_value_get('brk_ml_action')+'&';

      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))
      +'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()
      +'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&vl_e_acteur_choix="+vl_e_acteur_choix;
	  vf_c_recup_requete+="&vl_e_acteur_choix_cleunik="+vl_e_acteur_choix_cleunik;
	  vf_c_recup_requete+="&vl_e_acteur_critere_cleunik="+vl_e_acteur_critere_cleunik;
	  vf_c_recup_requete+="&$vl_c_particularisme"+'&vl_brk_ml_utilisateurs='+fa_value_get('brk_ml_utilisateurs')+'&vl_c_action_particularisme='+fa_value_get('brk_ml_action')+'&';
      break;
    case 7:	//	Acteurs ayant une certaine catégorie comptable
    	vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui=categorie_comptable&raf_random='"+Math.random()+"&catcompta_cleunik=$vl_catcompta_cleunik&";
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui=categorie_comptable&raf_random='"+Math.random()+"&catcompta_cleunik=$vl_catcompta_cleunik&";
      break;
  }
  pf_alimente_table();
}
function pf_critere_action(vv_quoi) {
  var vl_t_acteur=pf_tab_acteurs();
  var vl_c_donnees="";
  if (vl_t_acteur.length==0) {return;}
  switch (vv_quoi) {
    case 'sup':
      vl_c_donnees="vf_c_action=critere_sup&vl_e_critere_cleunik=$vl_e_critere_cleunik&";
      vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
      break;
  }
}
function pf_choix_action(vv_quoi) {
  var vl_t_acteur=pf_tab_acteurs();
  var vl_c_donnees="";
  if (vl_t_acteur.length==0) {return;}
  switch (vv_quoi) {
    case 'sup':
      vl_c_donnees="vf_c_action=choix_sup&vl_e_choix_cleunik=$vl_e_choix_cleunik&";
      vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
      break;
    case 'ajo':
      if ("$vl_c_genreacteur"=="tousss") {alert("Ajout de masse impossible de cette manière !!");}
      vl_c_donnees="vf_c_action=choix_ajo&vl_e_choix_cleunik=$vl_e_choix_cleunik&vl_e_critere_cleunik=$vl_e_critere_cleunik&genreacteur=$vl_c_genreacteur&";
      vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
	  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
      break;
  }
}
function pf_enleve_choix_critere() {
	if (!confirm("Confirmez-vous la suppression de ce choix de critère pour les acteurs sélectionnés ?")){return;}
	pf_valide_criteres('suppression');
    fa_cache_oui("bt_sup_choix");
}
function pf_montre_transformer(){
	fa_cache_non("vb_transformation_panier");
}
function pf_ouvre_choix_critere(vv_quoi) {
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_critere_qui",vv_quoi);
  fa_ouvre(cf_fen_choix_critere+vv_quoi+"&",800,400);
}
function pf_ouvre_choix_critere_recup(vv_critere_cleunik,vv_choix_cleunik,vv_c_critere_denomination,vv_c_choix_valeur_texte_01) {
  fa_cache_non("vb_criteres_panier");
  fa_cache_non("bt_sup_choix");
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_choix_cleunik",vv_choix_cleunik);
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_critere_cleunik",vv_critere_cleunik);
	fa_value_set("tb_ajout_critere_denomination",vv_c_critere_denomination);
  fa_value_set("tb_ajout_choix_valeur_texte_01",vv_c_choix_valeur_texte_01);
}
function pf_panier_ajoute() {
  var vl_t_acteur=pf_tab_acteurs();
  //alert(vl_t_acteur)
  if (vl_t_acteur.length==0) {return;}
  var vl_t_panier=[];
  vl_t_panier=vf_t_panier;
  vf_t_panier=vl_t_panier.concat(vl_t_acteur);
  fa_remove_attribute("bt_voir_panier","collapsed");
  //alert(vf_t_panier)
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
}
function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier")
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier.length;i++) {
      if (vl_t_acteur.indexOf(vf_t_panier[i])==-1) {
        k++;
        vl_t_panier[k]=vf_t_panier[i];
      }
    }
    vf_t_panier=vl_t_panier;
    fa_grise_fenetre("","oui");
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
  }
}
function pf_recup_requete(vv_export) {
  vf_c_export=vv_export;
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_acteur),pf_recup_requete_01);
  }
}
function pf_recup_requete_01() {
switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=sql&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=sql&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=sql&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_url_alimente_table,'',pf_recup_requete_fin);
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
}
function pf_sel_ligne() {}
function pf_tab_acteurs(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_acteur=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(var i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs",vl_t_tableau[i],"act_cleunik");
    }
  }
  return vl_t_acteur;
}
function pf_tableau_donnees_fin(stream) {
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
  }
  fa_das("arbre_des_acteurs_panier",vf_c_url_alimente_table);
}
function pf_validation_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
  pf_approximatif();
  switch ("$vl_c_p02") {
      case "Fen_00267":
	  case "Fen_00268":
	  case "Fen_00269":
	  case "Fen_00270":
	  case "Fen_00271":
	  case "Fen_00272":
        try {
          window.opener.pf06_alimente_table_bbb("sel");
          } catch(e){}
        break;

    }
}
function pf_valide_criteres(vv_quoi) {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    var vl_te_choix_cleunik=[];
    var vl_te_critere_cleunik=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
      vl_te_choix_cleunik[i]=fa_att_get("_graal_ajout_ove_bdc_datas","_graal_choix_cleunik");
      vl_te_critere_cleunik[i]=fa_att_get("_graal_ajout_ove_bdc_datas","_graal_critere_cleunik");
    }
    var vl_c_donnees="genrecritere="+fa_enc(fa_att_get("_graal_ajout_ove_bdc_datas","_graal_critere_qui"))+"&";
    vl_c_donnees+="vl_te_act_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
    vl_c_donnees+="vl_te_choix_cleunik="+fa_enc(fa_jsarray2php_00(vl_te_choix_cleunik))+"&";
    vl_c_donnees+="vl_te_critere_cleunik="+fa_enc(fa_jsarray2php_00(vl_te_critere_cleunik))+"&";
    switch (vv_quoi) {
    	case "ajout":
    		vl_c_donnees+="vf_c_action=enregistrer_kilometre_bis&";
    		break;
    	case "suppression":
    		vl_c_donnees+="vf_c_action=supprimer_kilometre&";
    		break;
    }
	fa_grise_fenetre("","oui");
    fa_xmlhttprequest_txt(vf_c_script_bdope_fen_criteres,vl_c_donnees,pf_valide_criteres_fin);
  }
}
function pf_valide_criteres_fin(stream) {
  alert(stream);
  //alert("toto")
  fa_vide_arbre("arbre_des_acteurs_panier");
  vf_t_panier=[];
  pf_voir_deck(0);
  pf_alimente_table();
  fa_grise_fenetre("","non");
}
function pf_valide_transformation() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    var vl_c_donnees="vl_typeacteur="+fa_enc(fa_value_get("bao_ml_transformation"))+"&";
    vl_c_donnees+="vl_t_acteur="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
    vl_c_donnees+="vf_c_action=changer_genre_kilometre&";
	fa_grise_fenetre("","oui");
	//alert(vl_c_donnees);
    fa_xmlhttprequest_txt(_c_script_bdope_act,vl_c_donnees,pf_valide_criteres_fin);
  }
}
function pf_valide_danspanier() {
  var vl_e_nb=fa_cl("arbre_des_acteurs_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_liste="";
  for(i=0;i<vl_e_nb;i++) {
    vl_c_liste+=fa_cell_get("arbre_des_acteurs_panier",i,"act_cleunik_panier")+",";
  }
  vl_c_liste=vl_c_liste.substring(0,vl_c_liste.length-1);
  var vl_c_titrepanier=prompt("Titre du nouveau panier : ");
  if (vl_c_titrepanier==null) {alert("Création du panier abandonnée.");return;}
  vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vl_c_titrepanier)+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=1&";
  vl_c_donnees+="vl_actif=1&";
  vl_c_donnees+="vl_panier_resultat="+vl_c_liste+"&";
  vl_c_donnees+="vl_c_action=ajouter_panier&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
function pf_valide_danspanier_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
}
function pf_valide_requete() {
  vf_titre_requete=prompt("Donnez un titre à votre requete ...");
  if(vf_titre_requete==null) {alert("Requête abandonnée.");return;}
  fa_xmlhttprequest_txt(vf_c_recup_requete,'',pf_valide_requete_01);
}
function pf_valide_requete_01(stream) {
  var vl_c_requete=stream,vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_blocnote_brut="+fa_enc(fa_value_get("tb_enclair")+" : "+fa_value_get("tb_critere_denomination")+" ("+fa_value_get("tb_choix_valeur_texte_01")+")")+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=2&";
  vl_c_donnees+="vl_panier_requete_selection="+vl_c_requete+"&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vf_titre_requete)+"&";
  vl_c_donnees+="vl_c_action=ajouter&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
$pf_validation_duplication
function pf_voir_deck(vv_lequel) {
  fa_gid("deck_acteurs").selectedIndex=vv_lequel;
}
function pf_xls_adresses_courriels_interlo(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_xls_adresses_courriels_interlo_fin);
  }
}
function pf_xls_adresses_courriels_interlo_fin(stream) {
var item=fa_gid("bao_ml_actif").selectedItem;
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_courriels_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_courriels_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_courriels_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_courriels_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_courriels_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&vl_c_actifs="+fa_value_get("bao_ml_actif");
     vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")
      break;
  }
  fa_ouvre(vf_c_url_alimente_table);
}




function pf_xls_adresses_postales(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_xls_adresses_postales_fin);
  }
}
function pf_xls_adresses_postales_fin(stream) {
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
  }
  fa_ouvre(vf_c_url_alimente_table);
}
function pf_xls_adresses_postales_interlo(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_xls_adresses_postales_interlo_fin);
  }
}
function pf_xls_adresses_postales_interlo_fin(stream) {
var item=fa_gid("bao_ml_actif").selectedItem;
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_adresses_postales_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&vl_c_actifs="+fa_value_get("bao_ml_actif");
     vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")
      break;
  }
  fa_ouvre(vf_c_url_alimente_table);
}
function pf_xls_téléphones_interlo(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_xls_téléphones_interlo_fin);
  }
}
function pf_xls_téléphones_interlo_fin(stream) {
var item=fa_gid("bao_ml_actif").selectedItem;
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_téléphones_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_téléphones_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_téléphones_interlo&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_téléphones_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_téléphones_interlo&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&vl_c_actifs="+fa_value_get("bao_ml_actif");
     vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")
      break;
  }
  fa_ouvre(vf_c_url_alimente_table);
}
function pf_xls_totale_01(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_xls_totale_01_fin);
  }
}
function pf_xls_totale_01_fin(stream) {
var item=fa_gid("bao_ml_actif").selectedItem;
	switch ($vl_c_type) {
    case 1:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_totale_01&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_totale_01&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_totale_01&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=0&vl_c_qui=888888&raf_random='"+Math.random()+"'&vl_e_choix_cleunik=0&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
   case 5:	// panier -68 pour duplication dans autre base
      vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_totale_01&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&";
      break;
   case 6:
     vf_c_url_alimente_table=vf_c_script_act+'sortie=excel_totale_01&vl_c_type=0&vl_c_qui=888888&raf_random='+Math.random()+"&vl_c_actifs="+fa_value_get("bao_ml_actif");
     vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")
      break;
  }
  fa_ouvre(vf_c_url_alimente_table);
}

]]></script>
END;
?>
