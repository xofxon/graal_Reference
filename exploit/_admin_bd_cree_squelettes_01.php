<?php
include("_graal_header_txt.inc.php");
define('EOL', "\r\n");
// Tab (définie dans TOTO) fait 8 caractères. C'est trop, je fais donc un "pseudo" tab de 2 caractères 
define('TOTO', "\t");
define('TAB', "  ");
$vl_c_requete_lib=fa_recup_telquel('vl_c_requete_lib','select now()');
$query=fa_recup_telquel('vl_c_requete','select now()');
$vl_c_nom_fenetre='_win_fen'.fa_recup_param('vl_c_nom_fenetre','p...cestquoicettefenetredemerde');
$vl_c_nom_table=fa_recup_param('vl_c_nom_table','p...cestquoicettetabledemerde');
$vl_c_nom_base=fa_recup_param('vl_c_nom_base','');
$vl_c_quoi=fa_recup_param('vl_c_quoi','p...onmamemepasditcequejedoisgenerer!!!p...deprogrammeurdemerde');
$vl_c_prefixe_appli=fa_recup_param('vl_c_prefixe','_graal_');
$vl_b_integre_script=intval(fa_recup_param('vl_b_integre_script','false'));

$vl_c_fic_das=$vl_c_prefixe_appli.'das'.$vl_c_nom_table.'_01.php';
$vl_c_fic_bdope=$vl_c_prefixe_appli.'bdope'.$vl_c_nom_table.'_01.php';
$vl_c_fic_xml=$vl_c_prefixe_appli.'xml'.$vl_c_nom_table.'_01.php';
$vl_c_fic_js=$vl_c_prefixe_appli.$vl_c_nom_table.'_01.js.php';
$vl_c_fic_xul_01=$vl_c_prefixe_appli.'fen'.$vl_c_nom_table.'_01.php';
$vl_c_fic_tab_01=$vl_c_prefixe_appli.'tab'.$vl_c_nom_table.'_01.php';
$vl_c_fic_xul_02=$vl_c_prefixe_appli.'fen'.$vl_c_nom_table.'_02.php';
if ($query=='') die('Error: SQL command must be provided');

$command = strtolower(substr($query,0,strpos($query,' ')));
if (strpos('select,show,describe',$command)===false) die('Error: Only SELECT/SHOW/DESCRIBE is allowed');

$connection = mysql_connect($sql_serveur,$sql_user,$sql_passwd) or die('Error: Could not connect to server - ' . mysql_error());
$result = mysql_query("SET CHARACTER SET 'utf8';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$result = mysql_query("SET collation_connection = 'utf8_general_ci';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
//mysql_select_db($vl_c_sql_bdd,$connection) or die('Error: Could not select database - ' . $vl_c_sql_bdd);
$result = mysql_query($query,$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$nfields = mysql_num_fields($result);
$vl_c_prems = mysql_field_name($result, 0);

$result_lib = mysql_query($vl_c_requete_lib,$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$nfields_lib = mysql_num_fields($result_lib);

$vl_c_js_01='';
$vl_c_js_01.='<?php'.EOL;
$vl_c_js_01.='echo <<<END'.EOL;
$vl_c_js_01.='<script type="application/x-javascript"><![CDATA['.EOL;
$vl_c_js_01.='const _c_url_alimente_table_01="'.$vl_c_fic_das.'";'.EOL;
$vl_c_js_01.='const _c_script_edite="'.$vl_c_fic_xml.'";'.EOL;
$vl_c_js_01.='const _c_script_bdope_fen="'.$vl_c_fic_bdope.'";'.EOL;
$vl_c_js_01.='var vf_c_action;'.EOL;
$vl_c_js_01.=EOL.EOL;

$vl_c_js_02='';  
$vl_c_js_02.='function pf_alimente_table(vv_qui){'.EOL;
$vl_c_js_02.=TAB.'fa_ds(vv_qui,"");'.EOL;
$vl_c_js_02.=TAB.'fa_ds(vv_qui,_c_url_alimente_table_01+"?raf="+Math.random());'.EOL;
$vl_c_js_02.='}'.EOL;
$vl_c_js_02.='function pf_etat_fen(vv_quoi){'.EOL;
$vl_c_js_02.=TAB.'vf_c_action=vv_quoi;'.EOL;
$vl_c_js_02.=TAB.'switch(vv_quoi) {'.EOL;
$vl_c_js_02.=TAB.TAB.'case "selectionner":'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'var i=fa_cui("arbre_receptacle");if(i==-1){return;}'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_non("bt_supprimer");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_non("bt_modifier");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_oui("bt_enregistrer");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_oui("bt_ajouter");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_oui("bt_detailler");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_oui("bt_sortir");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'fa_grise_non("bt_annuler");'.EOL;
$vl_c_js_02.=TAB.TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.TAB.'case "modifier":'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_supprimer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_modifier");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_ajouter");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_detailler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_sortir");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_annuler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_enregistrer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_groupe_non("broadcaster_01");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_focusdonne("tb_'.$vl_c_prems.'")'.EOL;
$vl_c_js_02.=TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.TAB.'case "ajouter":'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_supprimer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_modifier");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_ajouter");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_detailler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_sortir");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_annuler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_enregistrer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_groupe_non("broadcaster_01");'.EOL;
$vl_c_js_02.=TAB.TAB.'pf_raz_fiche();'.EOL;
$vl_c_js_02.=TAB.TAB.'pf_alimente_defaut();'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_focusdonne("tb_'.$vl_c_prems.'")'.EOL;
$vl_c_js_02.=TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.TAB.'case "annuler":'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_modifier");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_annuler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_supprimer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_oui("bt_enregistrer");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_sortir");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_ajouter");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_non("bt_detailler");'.EOL;
$vl_c_js_02.=TAB.TAB.'fa_grise_groupe_oui("broadcaster_01");'.EOL;
$vl_c_js_02.=TAB.TAB.'pf_raz_fiche();'.EOL;
$vl_c_js_02.=TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.TAB.'case "sortir":'.EOL;
$vl_c_js_02.=TAB.TAB.'window.close();'.EOL;
$vl_c_js_02.=TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.TAB.'default:'.EOL;
$vl_c_js_02.=TAB.TAB.'break;'.EOL;
$vl_c_js_02.=TAB.'}'.EOL;
$vl_c_js_02.=TAB.'}'.EOL;
$vl_c_js_02.='function pf_fin_requete(stream)'.EOL;
$vl_c_js_02.='{'.EOL;
$vl_c_js_02.=TAB.'var vl_datas = stream;'.EOL;
$vl_c_js_02.=TAB.'if (vl_datas=="ok") {pf_alimente_table("arbre_receptacle");} else {alert(vl_datas)}'.EOL;
$vl_c_js_02.=TAB.'pf_etat_fen("annuler");'.EOL;
$vl_c_js_02.='}'.EOL;
$vl_c_js_03="";
$vl_c_js_03.=']]></script>'.EOL;
$vl_c_js_03.='END;'.EOL;
$vl_c_js_03.='?>'.EOL;

$vl_c_fontion_01='';
$vl_c_fontion_01.='function pf_aa_init(){'.EOL;
$vl_c_fontion_01.=TAB.'fa_grise_oui("bt_supprimer");'.EOL;
$vl_c_fontion_01.=TAB.'fa_grise_oui("bt_modifier");'.EOL;
$vl_c_fontion_01.=TAB.'fa_grise_oui("bt_enregistrer");'.EOL;
$vl_c_fontion_01.=TAB.'fa_grise_oui("bt_annuler");'.EOL;
$vl_c_fontion_01.=TAB.'fa_grise_groupe_oui("broadcaster_01");'.EOL;
$vl_c_fontion_01.=TAB.'pf_raz_fiche();'.EOL;
$vl_c_fontion_01.=TAB.'pf_alimente_table("arbre_receptacle");'.EOL;
$vl_c_fontion_01.='}'.EOL;

$vl_c_fontion_02='';
$vl_c_fontion_02.='function pf_alimente_defaut(){'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_fontion_02.=TAB.'fa_value_set("tb_'.$fieldname.'","");'.EOL;
}
$vl_c_fontion_02.='}'.EOL;

$vl_c_fontion_03='';
$vl_c_fontion_03.='function pf_raz_fiche(){'.EOL;
$vl_c_fontion_03.=TAB.'fa_gid("'.$vl_c_nom_fenetre.'").setAttribute("_cleunik_encours",-1);'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_fontion_03.=TAB.'fa_value_set("tb_'.$fieldname.'","");'.EOL;
}
$vl_c_fontion_03.='}'.EOL;

$vl_c_fontion_04='';
$vl_c_fontion_04.='function pf_sel_ligne(vv_qui){'.EOL;
$vl_c_fontion_04.=TAB.'if(fa_est_grise("bt_detailler")==true){return}'.EOL;
$vl_c_fontion_04.=TAB.'switch (vv_qui)'.EOL;
$vl_c_fontion_04.=TAB.TAB.'{'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.'case "arbre_receptacle":'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.TAB.'var i=fa_cui(vv_qui);if(i==-1){return;}'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.TAB.'var vl_e_cleunik_encours=fa_cell_get(vv_qui,i,"!!!!!!!!!!!!");'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.TAB.'var s ="xx_cleunik="+fa_cell_get(vv_qui,i,"!!!!!!!!!!!!!!!!")+"&";'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.TAB.'fa_xmlhttprequest_xml(_c_script_edite,s,pf_affiche_datas);'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.'break;'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.'case "un_autre_arbre":'.EOL;
$vl_c_fontion_04.=TAB.TAB.TAB.'break;'.EOL;
$vl_c_fontion_04.=TAB.TAB.'}'.EOL;
$vl_c_fontion_04.='}'.EOL;


$vl_c_fontion_05='function pf_onunload(){}';
$vl_c_fontion_05.='function pf_validation(vv_quoi) {'.EOL;
$vl_c_fontion_05.=TAB.TAB.'var vl_c_donnees;'.EOL;
$vl_c_fontion_05.=TAB.TAB.'var vl_e_ele_cleunik;'.EOL;
$vl_c_fontion_05.=TAB.TAB.'vl_e_ele_cleunik=fa_gid("'.$vl_c_nom_fenetre.'").getAttribute("_cleunik_encours");'.EOL;
$vl_c_fontion_05.=TAB.TAB.'vl_c_donnees="";'.EOL;
$vl_c_fontion_05.=TAB.TAB.'vl_c_donnees="vl_e_cleunik="+vl_e_ele_cleunik+"&";'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_fontion_05.=TAB.TAB.'vl_c_donnees+="vl_'.$fieldname.'="+fa_enc(fa_value_get("tb_'.$fieldname.'"))+"&";'.EOL;
}
$vl_c_fontion_05.=TAB.TAB.'switch(vv_quoi) {'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.'case "enregistrer":'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.'if (vl_e_ele_cleunik!=-1)'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.TAB.'{vl_c_donnees+="vf_c_action=modifier&";}'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.'else'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.TAB.'{vl_c_donnees+="vf_c_action=ajouter&";}'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.'break;'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.'case "supprimer":'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.TAB.'if(confirm("Confirmez-vous la suppression de cet élément ?")==false) return;'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.TAB.'vl_c_donnees+="vf_c_action=supprimer&";'.EOL;
$vl_c_fontion_05.=TAB.TAB.TAB.TAB.'break;'.EOL;
$vl_c_fontion_05.=TAB.TAB.'}'.EOL;     
$vl_c_fontion_05.=TAB.TAB.'fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);'.EOL;
$vl_c_fontion_05.='}'.EOL;
$vl_c_fontion_05.=EOL.EOL;

$vl_c_fontion_06='';
$vl_c_fontion_06.='function pf_affiche_datas(stream){'.EOL;
$vl_c_fontion_06.=TAB.'var vl_c_datas=stream;'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_fontion_06.=TAB.'fa_value_set("tb_'.$fieldname.'",fa_xml_get(vl_c_datas,"'.$fieldname.'"));'.EOL;
}
$vl_c_fontion_06.='}'.EOL;


$vl_c_javascript='';
$vl_c_javascript.=$vl_c_js_01.$vl_c_fontion_06.$vl_c_fontion_01.$vl_c_fontion_02.$vl_c_js_02.$vl_c_fontion_03.$vl_c_fontion_04.$vl_c_fontion_05.$vl_c_js_03;


$vl_c_bout_fenetre_01='';
$vl_c_bout_fenetre_01.='<?php'.EOL;
$vl_c_bout_fenetre_01.='include("_graal_header_xul.inc.php");'.EOL;
$vl_c_bout_fenetre_01.='$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));'.EOL;
$vl_c_bout_fenetre_01.='$vl_c_id_fenetre="Fen_?????";'.EOL;
$vl_c_bout_fenetre_01.='$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_acces=$vl_tb_droits[0];'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_ajout=$vl_tb_droits[1];'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_modif=$vl_tb_droits[2];'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_suppr=$vl_tb_droits[3];'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_impri=$vl_tb_droits[4];'.EOL;
$vl_c_bout_fenetre_01.='$vl_b_detai=true;'.EOL;
$vl_c_bout_fenetre_01.='if ($vl_b_acces==false) {fa_redirige("acces_interdit");}'.EOL;
$vl_c_bout_fenetre_01.='_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);'.EOL;

$vl_c_bou_100=fa_recup_dico("bou_100");
for ($i=0; $i<$nfields_lib; $i++){    
  $fieldname = mysql_field_name($result_lib, $i);
  $vl_c_bout_fenetre_01.=TAB.'$vl_c_xxx_10'.$i.'=fa_recup_dico("'.$fieldname.'");'.EOL;
}



$vl_c_bout_fenetre_01.='include("_graal_header_winxul.inc.php");'.EOL;
$vl_c_bout_fenetre_01.='echo <<<END'.EOL;
$vl_c_bout_fenetre_01.='<!--'.EOL; 
$vl_c_bout_fenetre_01.='Fenêtre avec libellés au dessus des champs'.EOL;
$vl_c_bout_fenetre_01.='Devrait être enregistré sous forme '.$vl_c_fic_xul_01.' ou '.$vl_c_fic_xul_02.EOL;
$vl_c_bout_fenetre_01.='-->'.EOL;

$vl_c_bout_fenetre_01.='<window context="graal_cp00" title="$vl_c_xxx_100" id="'.$vl_c_nom_fenetre.'" onload="fa_aa(this);pf_aa_init();" onunload="pf_onunload();" '.$c_xmlns.'>'.EOL;
$vl_c_bout_fenetre_01.='<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>'.EOL;
$vl_c_bout_fenetre_01.='$vl_c_graal_cp00'.EOL;
$vl_c_bout_fenetre_01.='END;'.EOL;
$vl_c_bout_fenetre_01.='include_once("js/_graal_01.js.php");'.EOL;
if ($vl_b_integre_script==true){
  $vl_c_bout_fenetre_01.='echo <<<END'.EOL;
  $vl_c_bout_fenetre_01.='<script type="text/javascript">'.EOL;
  $vl_c_bout_fenetre_01.='<![CDATA['.EOL;
  $vl_c_bout_fenetre_01.=$vl_c_javascript.EOL;
  $vl_c_bout_fenetre_01.=']]>'.EOL;
  $vl_c_bout_fenetre_01.='</script>'.EOL;
}
else{
  $vl_c_bout_fenetre_01.='include("js/'.$vl_c_fic_js.'");'.EOL;
  $vl_c_bout_fenetre_01.='echo <<<END'.EOL;
}
$vl_c_bout_fenetre_01.='<vbox id="hbox_panneaudegauche" flex="1">'.EOL;

$vl_c_bout_fenetre_02='';
$vl_c_bout_fenetre_02.='<splitter />'.EOL;
$vl_c_bout_fenetre_02.='<hbox>'.EOL;

$vl_c_bout_fenetre_03='';
$vl_c_bout_fenetre_03.='<vbox>'.EOL;
$vl_c_bout_fenetre_03.='     <vbox id="boutons_standards" />'.EOL;
$vl_c_bout_fenetre_03.='END;'.EOL;
$vl_c_bout_fenetre_03.='include("_graal_inc_boutons_01.php");'.EOL;
$vl_c_bout_fenetre_03.='echo <<<END'.EOL;
$vl_c_bout_fenetre_03.='    </vbox>'.EOL;
$vl_c_bout_fenetre_03.='  </hbox>'.EOL;
$vl_c_bout_fenetre_03.='</vbox>'.EOL;
$vl_c_bout_fenetre_03.='</window>'.EOL;
$vl_c_bout_fenetre_03.='END;'.EOL;
$vl_c_bout_fenetre_03.='?>'.EOL;


$vl_c_ele_01='';
$vl_c_ele_01.='<vbox id="box_boite_outils_xof_01" flex="1">'.EOL;
$vl_c_ele_01.=TAB.'<label value="'.$query.'"/>'.EOL;
$vl_c_ele_01.=TAB.'<tree id="arbre_receptacle" flex="1" hidecolumnpicker="false" flags="" ref="*" querytype="xml" datasources="" enableColumnDrag="true" onselect="pf_sel_ligne(this.id);">'.EOL;
$vl_c_ele_01.=TAB.TAB.'<treecols>'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_ele_01.=TAB.TAB.TAB.'<treecol id="tc_'.$fieldname.'" label="$vl_c_xxx_10'.$i.'" tooltiptext="$vl_c_xxx_10'.$i.'" sort="?'.$fieldname.'" /><splitter class="tree-splitter" resizeafter="grow"/>'.EOL;
}


$vl_c_ele_01.=TAB.TAB.'</treecols>'.EOL;
$vl_c_ele_01.=TAB.TAB.' <template><query expr="*"/><action>'.EOL;
$vl_c_ele_01.=TAB.TAB.TAB.'<treechildren>'.EOL;
$vl_c_ele_01.=TAB.TAB.TAB.TAB.'<treeitem uri="?" seltype="single">'.EOL;
$vl_c_ele_01.=TAB.TAB.TAB.TAB.TAB.'<treerow>'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_ele_01.=TAB.TAB.TAB.TAB.TAB.TAB.'<treecell label="?'.$fieldname.'"/>'.EOL;
}
$vl_c_ele_01.=TAB.TAB.TAB.TAB.TAB.'</treerow>'.EOL;
$vl_c_ele_01.=TAB.TAB.TAB.TAB.'</treeitem>'.EOL;
$vl_c_ele_01.=TAB.TAB.TAB.'</treechildren>'.EOL;
$vl_c_ele_01.=TAB.TAB.'</action></template>'.EOL;
$vl_c_ele_01.=TAB.'</tree>'.EOL;
$vl_c_ele_01.='</vbox>'.EOL;

$vl_c_ele_02='';
$vl_c_ele_02.='<vbox id="box_boite_outils_xof_02" flex="9">'.EOL;
$vl_c_ele_02.=TAB.'<label value="'.$query.'"/>'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_ele_02.=TAB.'<vbox>'.EOL;  
  $vl_c_ele_02.=TAB.TAB.'<label control="la_'.$fieldname.'" value="$vl_c_xxx_10'.$i.'"/>'.EOL;
  $vl_c_ele_02.=TAB.TAB.'<textbox id="tb_'.$fieldname.'"   observes="broadcaster_01"/>'.EOL;
  $vl_c_ele_02.=TAB.'</vbox>'.EOL;
}
$vl_c_ele_02.='</vbox>'.EOL;

$i=0;

$vl_c_ele_03='';
$vl_c_ele_03.='<vbox id="box_boite_outils_xof_03" flex="1">'.EOL;
$vl_c_ele_03.=TAB.'<label value="'.$query.'"/>'.EOL;
$vl_c_ele_03.=TAB.'<grid flex="1">'.EOL;
$vl_c_ele_03.=TAB.TAB.'<columns>'.EOL;
$vl_c_ele_03.=TAB.TAB.TAB.'<column flex="1"/>'.EOL;
$vl_c_ele_03.=TAB.TAB.TAB.'<column flex="10"/>'.EOL;
$vl_c_ele_03.=TAB.TAB.'</columns>'.EOL;
$vl_c_ele_03.=TAB.TAB.'<rows>'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_ele_03.=TAB.TAB.TAB.'<row>'.EOL;  
  $vl_c_ele_03.=TAB.TAB.TAB.TAB.'<label control="la_'.$fieldname.'" value="$vl_c_xxx_10'.$i.'"/>'.EOL;
  $vl_c_ele_03.=TAB.TAB.TAB.TAB.'<textbox id="tb_'.$fieldname.'"   observes="broadcaster_01"/>'.EOL;
  $vl_c_ele_03.=TAB.TAB.TAB.'</row>'.EOL;
}
$vl_c_ele_03.=TAB.TAB.'</rows>'.EOL;
$vl_c_ele_03.=TAB.'</grid>'.EOL;
$vl_c_ele_03.='</vbox>'.EOL;

$vl_c_das='';
$vl_c_cartourch_rdf='//Devrait être enregistré sous forme '.$vl_c_fic_das.EOL;
$vl_c_das.='<?php'.EOL;
$vl_c_das.=$vl_c_cartourch_rdf;
$vl_c_das.='include("_graal_header_xml.inc.php");'.EOL;
$vl_c_das.='$sql_req="'.$query.'";'.EOL;
$vl_c_das.='$result = _graal_requete_bd($sql_req);'.EOL;
$vl_c_das.='echo("<donnees>");'.EOL;  
$vl_c_das.='while ($row = mysql_fetch_assoc($result)){'.EOL;
$vl_c_das.=TAB.'echo("<quoi ");'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_das.=TAB.TAB.'echo(\' '.$fieldname.'="\'.fa_ent_xml($row['.$fieldname.']).\'"\');'.EOL;
}
$vl_c_das.=TAB.'echo("/>");'.EOL;
$vl_c_das.='}'.EOL;
$vl_c_das.='echo("</donnees>");'.EOL;
$vl_c_das.='_graal_libere_requete_bd($result);'.EOL;
$vl_c_das.='_graal_ferme_connexion();'.EOL;
$vl_c_das.='?>'.EOL;
$vl_c_das.=EOL.EOL;

$vl_c_xml='';
$vl_c_cartourch_xml='//Devrait être enregistré sous forme '.$vl_c_fic_xml.EOL;
$vl_c_xml.='<?php'.EOL;
$vl_c_xml.=$vl_c_cartourch_xml;
$vl_c_xml.='include("_graal_header_xml.inc.php");'.EOL;
$vl_c_xml.='$xx_cleunik=intval(fa_recup_param("xx_cleunik",-1));'.EOL;
$vl_c_xml.='define(\'EOL\', "\r\n");'.EOL;
$vl_c_xml.='// execution de la requête SQL'.EOL;
$vl_c_xml.='$sql_req="'.$query.' where xx_cleunik=$xx_cleunik;";'.EOL;
$vl_c_xml.='$result = _graal_requete_bd($sql_req);'.EOL;
$vl_c_xml.='echo fa_xcree_entete_xml();'.EOL;  
$vl_c_xml.='$row = mysql_fetch_assoc($result);'.EOL;
$vl_c_xml.='echo(\'<Description>\');'.EOL;
$vl_c_xml.='// parseType = indication pour le type des données, utile pour le tri sur la colonne'.EOL;
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_xml.='echo(\'<'.$fieldname.' data="\'.fa_ent_xml($row[\''.$fieldname.'\']).\'"/>\');'.EOL;
}
$vl_c_xml.='echo(\'</Description>\');'.EOL;
$vl_c_xml.='_graal_libere_requete_bd($result);'.EOL;
$vl_c_xml.='_graal_ferme_connexion();'.EOL;
$vl_c_xml.='?>'.EOL;

$vl_c_bd_ope='';
$vl_c_cartourch_ope='//Devrait être enregistré sous forme '.$vl_c_fic_bdope.EOL;
$vl_c_bd_ope.='<?php'.EOL; 
$vl_c_bd_ope.=$vl_c_cartourch_ope;
$vl_c_bd_ope.='include("_graal_header_txt.inc.php");'.EOL;
$vl_c_bd_ope.='$vf_c_echo="";'.EOL;
$vl_c_bd_ope.='$vl_e_cleunik=intval(fa_recup_param("vl_e_cleunik","-1"));'.EOL;
$vl_c_bd_ope.='$vf_c_action=fa_recup_param("vf_c_action","??????");'.EOL;
$vl_c_bd_ope.='//IMPORTANT IMPORTANT IMPORTANT IMPORTANT'.EOL;
$vl_c_bd_ope.='//Bien penser à utiliser intval pour convertir les données numériques'.EOL;
$vl_c_bd_ope.='//Bien penser à utiliser intval pour convertir les données numériques'.EOL;
$vl_c_bd_ope.='//Bien penser à utiliser intval pour convertir les données numériques'.EOL;
for ($i=0; $i<$nfields; $i++)
{    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_bd_ope.='$vl_'.$fieldname.'=fa_recup_param("vl_'.$fieldname.'","");'.EOL;
}
$vl_c_bd_ope.='switch (TRUE) {'.EOL; 
$vl_c_bd_ope.=TAB.'case $vf_c_action=="supprimer":'.EOL; 
$vl_c_bd_ope.=TAB.TAB.'$sql_req = "DELETE FROM '.$vl_c_nom_table.' WHERE '.$vl_c_nom_table.'.???????????????? = $vl_e_cleunik";'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$vf_c_echo=_graal_exec_requete($sql_req);'.EOL;
$vl_c_bd_ope.=TAB.TAB.'if($vf_c_echo==\'ok\') {$vf_c_echo=$???????????;} else {$vf_c_echo=-1;}'.EOL;
$vl_c_bd_ope.=TAB.TAB.'break;'.EOL;
$vl_c_bd_ope.=TAB.'case $vf_c_action=="ajouter":'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$vl_e_fen_cleunik=_graal_requete_max("???????????????????????","'.$vl_c_nom_table.'");'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$sql_req = "INSERT INTO '.$vl_c_nom_table.' set ??????????????????=$vl_e_fen_cleunik';
for ($i=0; $i<$nfields; $i++){    
  $fieldname = mysql_field_name($result, $i);
  $vl_c_bd_ope.=','.$fieldname.'=\'$vl_'.$fieldname.'\'';
}
$vl_c_bd_ope.='";'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$vf_c_echo=_graal_exec_requete($sql_req);'.EOL;
$vl_c_bd_ope.=TAB.TAB.'if($vf_c_echo==\'ok\') {$vf_c_echo=$???????????;} else {$vf_c_echo=-1;}'.EOL;
$vl_c_bd_ope.=TAB.TAB.'break;'.EOL;
$vl_c_bd_ope.=TAB.'case $vf_c_action=="modifier":'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$sql_req = "UPDATE '.$vl_c_nom_table.' set ';
for ($i=0; $i<$nfields; $i++)
{    
  $fieldname = mysql_field_name($result, $i);
  if ($i!=0) {$vl_c_bd_ope.=',';}
  $vl_c_bd_ope.=$fieldname.'=\'$vl_'.$fieldname.'\'';
}
$vl_c_bd_ope.=' WHERE '.$vl_c_nom_table.'.???????????????? = $vl_e_cleunik";'.EOL;
$vl_c_bd_ope.=TAB.TAB.'$vf_c_echo=_graal_exec_requete($sql_req);'.EOL;
$vl_c_bd_ope.=TAB.TAB.'if($vf_c_echo==\'ok\') {$vf_c_echo=$???????????;} else {$vf_c_echo=-1;}'.EOL;
$vl_c_bd_ope.=TAB.TAB.'break;'.EOL;
$vl_c_bd_ope.=TAB.'case $vf_c_action=="??????":'.EOL;
$vl_c_bd_ope.=TAB.TAB.'exit;'.EOL;
$vl_c_bd_ope.=TAB.TAB.'break;'.EOL;
$vl_c_bd_ope.='}'.EOL;
$vl_c_bd_ope.='_graal_ferme_connexion();'.EOL;
$vl_c_bd_ope.='echo $vf_c_echo;'.EOL;
$vl_c_bd_ope.='?>'.EOL;
mysql_free_result($result);
mysql_close($connection);
switch ($vl_c_quoi)
{
  case 'javascript':
    echo '********************************************************************************************'.EOL;
    echo 'Javascript '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_js.EOL;
    echo '********************************************************************************************'.EOL;
    echo EOL.EOL;
    $vl_c_cartourch_js='//Devrait être enregistré sous forme '.$vl_c_fic_js.EOL;
    echo $vl_c_cartourch_js.$vl_c_javascript;
    break;
  case 'fenetre_01':
    echo '********************************************************************************************'.EOL;
    echo 'Fenêtre avec libellés au dessus des champs'.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xul_01.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_entete_01.$vl_c_bout_fenetre_01.$vl_c_ele_01.$vl_c_bout_fenetre_02.$vl_c_ele_02.$vl_c_bout_fenetre_03;
    break;
  case 'fenetre_02':
    echo '********************************************************************************************'.EOL;
    echo 'Fenêtre avec libellés à gauche des champs'.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xul_02.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_bout_fenetre_01.$vl_c_ele_01.$vl_c_bout_fenetre_02.$vl_c_ele_03.$vl_c_bout_fenetre_03;
    echo '********************************************************************************************'.EOL;
    break;
  case 'rdf':
    echo '********************************************************************************************'.EOL;
    echo 'Script de création d\un fichier RDF afin d\'alimenter l\arbre récapitulatif '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_das.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_das;
    break;
  case 'xml':
    echo '********************************************************************************************'.EOL;
    echo 'Script de récupération des données sous forme xml '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xml.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_xml;
    break;    
  case 'enregistrement':
    echo '********************************************************************************************'.EOL;
    echo 'Script d\'enregistrement des données '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_bdope.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_bd_ope; 
    break;
  case 'table':
    echo '********************************************************************************************'.EOL;
    echo 'Uniquement tous forme de table'.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_tab_01.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_entete_01.$vl_c_bout_fenetre_01.$vl_c_ele_01.$vl_c_bout_fenetre_03;
    break;
  
  case 'p...onmamemepasditcequejedoisgenerer!!!p...deprogrammeurdemerde':
  case 'tout':
    echo '********************************************************************************************'.EOL;
    echo 'Fenêtre avec libellés au dessus des champs'.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xul_01.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_entete_01.$vl_c_bout_fenetre_01.$vl_c_ele_01.$vl_c_bout_fenetre_02.$vl_c_ele_02.$vl_c_bout_fenetre_03;
    echo EOL.EOL.EOL.EOL;
    echo '********************************************************************************************'.EOL;
    echo 'Fenêtre avec libellés à gauche des champs'.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xul_02.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_bout_fenetre_01.$vl_c_ele_01.$vl_c_bout_fenetre_02.$vl_c_ele_03.$vl_c_bout_fenetre_03;
    echo '********************************************************************************************'.EOL;
    echo 'Javascript '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_js.EOL;
    echo '********************************************************************************************'.EOL;
    echo EOL.EOL;
    $vl_c_cartourch_js='//Devrait être enregistré sous forme '.$vl_c_fic_js.EOL;
    echo $vl_c_cartourch_js.$vl_c_javascript;
    echo '********************************************************************************************'.EOL;
    echo 'Script de création d\un fichier RDF afin d\'alimenter l\arbre récapitulatif '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_das.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_das;
    echo EOL.EOL;
    echo '********************************************************************************************'.EOL;
    echo 'Script de récupération des données sous forme xml '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_xml.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_xml;
    echo EOL.EOL;
    echo '********************************************************************************************'.EOL;
    echo 'Script d\'enregistrement des données '.EOL;
    echo 'Devrait être enregistré sous forme '.$vl_c_fic_bdope.EOL;
    echo '********************************************************************************************'.EOL;
    echo $vl_c_bd_ope; 
    echo EOL.EOL;
    break;
}    
?>
