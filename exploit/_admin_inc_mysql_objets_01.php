<?php
/*
****************************************************************
**********  WAA Fenêtre d'administration de base de données Mysql    ********
****************************************************************
*/
_graal_requete_charge_varlib($vl_c_id_inc_mysql_objets_01,$vl_e_uti_cleunik);
$vl_c_waa_001=fa_recup_dico("waa_001");
$vl_c_waa_002=fa_recup_dico("waa_002");
$vl_c_waa_003=fa_recup_dico("waa_003");
$vl_c_waa_004=fa_recup_dico("waa_004");
$vl_c_waa_005=fa_recup_dico("waa_005");
$vl_c_waa_006=fa_recup_dico("waa_006");
$vl_c_waa_007=fa_recup_dico("waa_007");
$vl_c_waa_008=fa_recup_dico("waa_008");
$vl_c_waa_009=fa_recup_dico("waa_009");
//  On recherche toutes les bases
$sql_req_bases = "show databases;";
$sql_result_bases = _graal_requete_bd($sql_req_bases);
$vl_e_nombre_bases=mysql_num_rows($sql_result_bases);
echo <<<END
  <vbox id="waa_objets_01" width="200">
    <tree id="arbre_des_objets_bd" flex="1" hidecolumnpicker="true" onselect="pf_sel_ligne('arbre_des_objets_bd');">
        <treecols>
            <treecol id="treeDatabases" flex="1" label="$vl_e_nombre_bases $vl_c_waa_001" primary="true" />
        </treecols>
        <treechildren>
  <treeitem container="true" _graal_type="mysql" open="true">
    <treerow>
      <treecell class="datatables" label=" $vl_c_waa_001" src="graphics/tables.bmp"/>
    </treerow>
  </treeitem>
                    
END;
if ($vl_e_nombre_bases == 0) 
{
$vl_b_envoi_possible=false;
echo <<<END
  <treeitem container="true" open="true">
    <treerow>
      <treecell class="dataconn" label="$vl_c_waa_003" src="graphics/connected.bmp"/>
    </treerow>
END;
}
else
{
while ($row_bases = mysql_fetch_array($sql_result_bases, MYSQL_NUM))
  {
  $vl_c_base_en_cours=$row_bases[0];
  echo("<treeitem _graal_type='base' container='true' open='true' _graal_name_base='$vl_c_base_en_cours' >");
  echo("<treerow>");
  echo("<treecell class='dataconn' label='$vl_c_base_en_cours' src='graphics/connected.bmp'/>");
  echo("</treerow>");
  
echo <<<END
<treechildren>
  <treeitem _graal_type="lestables" container="true" open="true" _graal_name_base="$vl_c_base_en_cours">
    <treerow>
      <treecell class="datatables" label=" $vl_c_waa_004" src="graphics/tables.bmp"/>
    </treerow>
  <treechildren>
END;
{
//  Début recherche des tables d'une base
$sql_req_tables = "SELECT TABLE_NAME FROM information_schema.`TABLES` where table_schema='$vl_c_base_en_cours' and table_type='BASE TABLE';";
$sql_req_tables = "show tables from $vl_c_base_en_cours;";
$sql_result_tables = _graal_requete_bd($sql_req_tables);
$vl_e_nombre_tables=mysql_num_rows($sql_result_tables);
if ($vl_e_nombre_tables == 0) 
{
$vl_b_envoi_possible=false;
echo <<<END
  <treeitem _graal_name="_acteurs" _graal_type="table" id="table_acteurs">
    <treerow>
      <treecell class="datatable" label=" $vl_c_waa_005"  src="graphics/table.bmp"/>
    </treerow>
  </treeitem>
END;
}
else
{
while ($row_tables = mysql_fetch_array($sql_result_tables, MYSQL_NUM))
  {
  $vl_c_table_en_cours=$row_tables[0];
echo <<<END
   <treeitem _graal_name_base="$vl_c_base_en_cours" _graal_name_table="$vl_c_table_en_cours" _graal_type="table" >
    <treerow>
      <treecell class="datatable" label=" $vl_c_table_en_cours"  src="graphics/table.bmp"/>
    </treerow>
  </treeitem>
END;
  }
}
//  Fin recherche des tables d'une base
_graal_libere_requete_bd($sql_result_tables);
}
echo <<<END
              </treechildren>
          </treeitem>

          <treeitem><treerow><treecell class="dataviews" label=" $vl_c_waa_006" src="graphics/views.bmp"/>     </treerow>
  <treechildren>
END;
/*
{
//  Début recherche des vues d'une base
$sql_req_tables = "SELECT TABLE_NAME FROM information_schema.`TABLES` where table_schema='$vl_c_base_en_cours' and table_type='VIEW';";
$sql_result_tables = _graal_requete_bd($sql_req_tables);
$vl_e_nombre_tables=mysql_num_rows($sql_result_tables);
if ($vl_e_nombre_tables == 0) 
{
$vl_b_envoi_possible=false;
echo <<<END
  <treeitem _graal_name="_acteurs" _graal_type="vue" id="table_acteurs">
    <treerow>
      <treecell class="datatable" label=" $vl_c_waa_005"  src="graphics/view.bmp"/>
    </treerow>
  </treeitem>
END;
}
else
{
while ($row_tables = mysql_fetch_array($sql_result_tables, MYSQL_NUM))
  {
  $vl_c_table_en_cours=$row_tables[0];
echo <<<END
   <treeitem _graal_name_base="$vl_c_base_en_cours" _graal_name_table="$vl_c_table_en_cours" _graal_type="vue" >
    <treerow>
      <treecell class="datatable" label=" $vl_c_table_en_cours"  src="graphics/views.bmp"/>
    </treerow>
  </treeitem>
END;
  }
}
//  Fin recherche des vues d'une base
_graal_libere_requete_bd($sql_result_tables);
}
echo <<<END
*/
echo <<<END
              </treechildren>
          </treeitem>
          <treeitem hidden="true"><treerow><treecell class="dataprocs" label=" $vl_c_waa_007" src="graphics/procedures.bmp"/></treerow></treeitem>
          <treeitem hidden="true"><treerow><treecell class="datafuncs" label=" $vl_c_waa_008" src="graphics/functions.bmp"/> </treerow></treeitem>
          <treeitem hidden="true"><treerow><treecell class="datatrigs" label=" $vl_c_waa_009" src="graphics/functions.bmp"/> </treerow></treeitem>
      </treechildren>
    </treeitem>
END;
  }
}
_graal_libere_requete_bd($sql_result_bases);
echo <<<END
                </treechildren>
            </tree>
        </vbox>
END;
?>
