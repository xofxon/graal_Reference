<?php
  $this->SetFont($this->police_du_document, "",11);
  //  Recherche interlocuteur privilégié d'offre, de commande, de livraison, de raception, de facture ... selon le document
  $sql_req="SELECT concat_ws(' ',a3.choix_valeur_texte_01,a2.prenom,a2.patronyme) as qui,a1.principal FROM _graal a1 left join _act_interlo a2 using(int_cleunik) left join _choix a3 on a3.choix_cleunik=a2.choix_cleunik where a1.action_cleunik=$action_cleunik and a1.choix_cleunik=$interlo_privilegie;";
  $result = _graal_requete_bd($sql_req);
  if (mysql_num_rows($result) == 0) {
    $qui="";
  } else {
    $row = mysql_fetch_assoc($result);
    $qui=fa_ent_xml($row['qui']);
  }
  _graal_libere_requete_bd($result);
  
  // Recherche adresse de livraison ou de facturation, selon $genre_adresse
  $this->SetXY(120,40);
  $sql_req="Select * from $vl_e_fic_adresses where commercial_cleunik=$vl_commercial_cleunik and adr_typecoordonnees&$genre_adresse";
  $result = _graal_requete_bd($sql_req);
  if ((mysql_num_rows($result) == 0)&& ($genre_adresse==1)) {
	//	On recherche l'adresse de facturation si l'on a pas demandé et trouvé l'adresse de livraison
  	$sql_req="Select * from $vl_e_fic_adresses where commercial_cleunik=$vl_commercial_cleunik and adr_typecoordonnees&2;";
  	$result = _graal_requete_bd($sql_req);
  }
  $row = mysql_fetch_assoc($result);
  $adresse="";
  if (trim($row['adr_nom'])!="") {$adresse.=$row['adr_nom'].EOL;}
  if (trim($row['adr_complementnom'])!="") {$adresse.=$row['adr_complementnom'].EOL;}
  if (trim($qui)!="") {$adresse.=$qui.EOL;}
  if (trim($row['adr_ligne1'])!="") {$adresse.=$row['adr_ligne1'].EOL;}
  if (trim($row['adr_ligne2'])!="") {$adresse.=$row['adr_ligne2'].EOL;}
  if (trim($row['adr_ligne3'])!="") {$adresse.=$row['adr_ligne3'].EOL;}
  if (trim($row['adr_cp'].$row['adr_ville'])!="") {$adresse.=$row['adr_cp']." ".$row['adr_ville'].EOL;}
  _graal_libere_requete_bd($result);
  $this->MultiCell(0, 4, $adresse,0,'L');
  //  Impression du bloc note entête
  $this->SetFont($this->police_du_document, "",11);
  $this->SetXY(10,100);
  $this->MultiCell(0, 4, $blocnotebrut_entete,0,"L");
  //  Entête du tableau
  $this->SetFont($this->police_du_document, "",9);
  $y=$this->getY();
  $position_debut_lignes=round($y+10,0);
  $this->addCols_00( $cols,$xyz=array("10",$y,40+$hauteur_blocnote_pied));
  $this->addLineFormat_00($format,$cols);
  $this->SetY($position_debut_lignes);
  $y=$position_debut_lignes;
?>
