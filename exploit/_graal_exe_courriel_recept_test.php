<?php
include("_graal_header_txt.inc.php");
require("_graal_classe_pop3.php");
include("_graal_fonctions_cryptage.php");
if (strtoupper(substr(PHP_OS,0,3)=='WIN')) {
  $eol="\r\n";
} elseif (strtoupper(substr(PHP_OS,0,3)=='MAC')) {
  $eol="\r";
} else {
  $eol="\n";
}
$vl_c_serveurpop3=fa_recup_param('vl_c_serveurpop3','');
$vl_c_port_pop=intval(fa_recup_param('vl_c_port_pop',''));
$vl_c_utilisateurpop3=fa_recup_param('vl_c_utilisateurpop3','');
$vl_c_motdepassepop3=fa_recup_param('vl_c_motdepassepop3','');
$vl_c_pop_ssl=intval(fa_recup_param('vl_c_pop_ssl',''));

$vl_e_uticptbal_cleunik=intval(fa_recup_param('vl_e_uticptbal_cleunik','0'));
$sql_req = "SELECT compte FROM _uti_cpt_bal where uticptbal_cleunik=$vl_e_uticptbal_cleunik";
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$vl_c_comptexml_chiffre=fa_mcrypte("info_compte_courriel",$row['compte'],"déchiffrer");
_graal_libere_requete_bd($result);
$vl_c_xml=simplexml_load_string($vl_c_comptexml_chiffre);

$vl_c_motdepassepop3=$vl_c_xml->motdepassepop3[0]->attributes();

/*_graal_exe_courriel_recept_test.php
$vl_c_serveurpop3="smtp.c-a-f-e.fr";
$vl_c_serveurpop3="mail.c-a-f-e.fr";
$vl_c_port_pop=25;
$vl_c_port_pop=110;
$vl_c_utilisateurpop3="a.viland@c-a-f-e.fr";
$vl_c_motdepassepop3="gestion";
$vl_c_pop_ssl=0;
*/

/* Uncomment when using SASL authentication mechanisms */
/*
require("sasl.php");
*/

$pop3=new pop3_class;
$pop3->hostname="$vl_c_serveurpop3";             /* POP 3 server host name                      */
$pop3->port=$vl_c_port_pop;                         /* POP 3 server host port, usually 110 but some servers use other ports Gmail uses 995                              */
if ($vl_c_pop_ssl==1) {$pop3->tls=1;} else {$pop3->tls=0;}  /* Establish secure connections using TLS      */
$user="$vl_c_utilisateurpop3";           /* Authentication user name                    */
$password="$vl_c_motdepassepop3";        /* Authentication password                     */

$pop3->realm="";                         /* Authentication realm or domain              */
$pop3->workstation="";                   /* Workstation for NTLM authentication         */
$apop=0;                                 /* Use APOP authentication                     */
$pop3->authentication_mechanism="USER";  /* SASL authentication mechanism               */
$pop3->debug=0;                          /* Output debug information                    */
$pop3->html_debug=0;                     /* Debug information is in HTML                */
$pop3->join_continuation_header_lines=1; /* Concatenate headers split in multiple lines */
$vf_c_retour="";$error="";
if(($error=$pop3->Open())=="") {
  $vf_c_retour.="1-> Connecté".$eol;
  if(($error=$pop3->Login($user,$password,$apop))==""){
    $vf_c_retour.="2-> Correctement identifié".$eol;
    $pop3->Close();
    $vf_c_retour.="3-> Bien déconnecté".$eol;
  }
}
$vf_c_retour.=$error.$eol;
echo $vf_c_retour;

?>

