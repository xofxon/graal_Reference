<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_param_taxes_parafiscales_01";
fa_acces_script();
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_tpf_cleunik=fa_recup_param("vl_tpf_cleunik","");
$vl_taxes_cleunik=fa_recup_param("vl_taxes_cleunik","");
$vl_code=fa_recup_param("vl_code","");
$vl_denomination=fa_recup_param("vl_denomination","");
$vl_valeur_base=fa_floatval(fa_recup_param("vl_valeur_base",""));
$vl_base=intval(fa_recup_param("vl_base",""));
$vl_compte_vente=intval(fa_recup_param("vl_compte_vente",""));
$vl_compte_achat=intval(fa_recup_param("vl_compte_achat",""));
$vl_compte_taxe=intval(fa_recup_param("vl_compte_taxe",""));

$vl_dateheuremodification=fa_recup_param("vl_dateheuremodification","");
$vl_dateheurecreation=fa_recup_param("vl_dateheurecreation","");
$vl_actif=intval(fa_recup_param("vl_actif",""));
switch (TRUE) {
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _param_tpf WHERE tpf_cleunik=$vl_tpf_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo=-3;}
    break;
  case $vf_c_action=="ajouter":
    $vl_tpf_cleunik=_graal_requete_max("tpf_cleunik","_param_tpf");
    $sql_req = "INSERT INTO _param_tpf set tpf_cleunik=$vl_tpf_cleunik,taxes_cleunik=$vl_compte_taxe,code='$vl_code',denomination='$vl_denomination',valeur_base=$vl_valeur_base,compte_vente=$vl_compte_vente,compte_achat=$vl_compte_achat,dateheurecreation=now(),actif=$vl_actif,base=$vl_base";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo="-2"."-".$sql_req;}
    break;
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE _param_tpf set code='$vl_code',denomination='$vl_denomination',valeur_base=$vl_valeur_base,compte_vente=$vl_compte_vente,compte_achat=$vl_compte_achat,dateheuremodification=now(),actif=$vl_actif,base=$vl_base,taxes_cleunik=$vl_compte_taxe WHERE tpf_cleunik=$vl_tpf_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="ok";} else {$vf_c_echo="-1"."$sql_req";}
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
