<?php
include("_graal_header_xml.inc.php");
$vl_c_dico_00086=fa_recup_dico("dico_00086");
$vl_c_dico_00087=fa_recup_dico("dico_00087");
$vl_c_dico_00088=fa_recup_dico("dico_00088");
define('EOL', "\r\n");
$vl_e_art_cleunik=intval(fa_recup_param("vl_art_cleunik","10000113"));
$vl_actif=intval(fa_recup_param("actif",3));
$sql_req = "SELECT f1.mvt_cleunik,f1.art_cleunik,f1.uti_cleunik,f1.int_cleunik,f1.blocnotebrut,f1.dateheuremvt,f1.dateheuresaisie,f1.choix_depot,f1.choix_empla,f1.qte_mvt,f1.qte_pos,f1.unite_mvt,f1.genre_mvt,f1.type_mvt,f1.pu_mvt,f2.choix_valeur_texte_01 as 'depot',f3.choix_valeur_texte_01 as 'empla',f4.choix_valeur_texte_01 as 'genre' from _mouvements_stock f1,_choix f2,_choix f3,_choix f4  where f2.choix_cleunik=f1.choix_depot and f3.choix_cleunik=f1.choix_empla and f4.choix_cleunik=f1.genre_mvt and f1.art_cleunik=$vl_e_art_cleunik";
$sql_req.=" order by dateheuremvt desc, mvt_cleunik desc;";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
    echo('<row:mvt_cleunik NC:parseType="Integer">'.fa_ent_xml($row['mvt_cleunik']).'</row:mvt_cleunik>');
    echo('<row:art_cleunik NC:parseType="Integer">'.fa_ent_xml($row['art_cleunik']).'</row:art_cleunik>');
    echo('<row:uti_cleunik NC:parseType="Integer">'.fa_ent_xml($row['uti_cleunik']).'</row:uti_cleunik>');
    echo('<row:int_cleunik NC:parseType="Integer">'.fa_ent_xml($row['int_cleunik']).'</row:int_cleunik>');
    echo('<row:dateheuremvt>'.fa_ent_xml($row['dateheuremvt']).'</row:dateheuremvt>');
    echo('<row:dateheuresaisie>'.fa_ent_xml($row['dateheuresaisie']).'</row:dateheuresaisie>');
    echo('<row:choix_depot NC:parseType="Integer">'.fa_ent_xml($row['choix_depot']).'</row:choix_depot>');
    echo('<row:choix_empla NC:parseType="Integer">'.fa_ent_xml($row['choix_empla']).'</row:choix_empla>');
    echo('<row:qte_mvt>'.fa_ent_xml($row['qte_mvt']).'</row:qte_mvt>');
    if ($row['qte_pos']==0) {$vl_c_qte_pos="";} else {$vl_c_qte_pos=fa_ent_xml($row['qte_pos']);}
    echo('<row:qte_pos>'.$vl_c_qte_pos.'</row:qte_pos>');
    echo('<row:unite_mvt NC:parseType="Integer">'.fa_ent_xml($row['unite_mvt']).'</row:unite_mvt>');
    echo('<row:genre_mvt NC:parseType="Integer">'.fa_ent_xml($row['genre_mvt']).'</row:genre_mvt>');
    switch ($row['type_mvt']) {
      case 1 : $vl_c_type_mvt=$vl_c_dico_00086;break;
      case 2 : $vl_c_type_mvt=$vl_c_dico_00087;break;
      case 3 : $vl_c_type_mvt=$vl_c_dico_00088;break;
    }
    echo('<row:type_mvt>'.$vl_c_type_mvt.'</row:type_mvt>');
    echo('<row:pu_mvt>'.fa_ent_xml($row['pu_mvt']).'</row:pu_mvt>');
    $mt_mvt=$row['pu_mvt']*$row['qte_mvt'];
    echo('<row:mt_mvt>'.fa_ent_xml($mt_mvt).'</row:mt_mvt>');
    echo('<row:depot>'.fa_ent_xml($row['depot']).'</row:depot>');
    echo('<row:empla>'.fa_ent_xml($row['empla']).'</row:empla>');
    echo('<row:genre>'.fa_ent_xml($row['genre']).'</row:genre>');
    echo('<row:blocnotebrut>'.fa_ent_xml($row['blocnotebrut']).'</row:blocnotebrut>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
