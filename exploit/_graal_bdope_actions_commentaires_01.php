<?php 
include("_graal_header_txt.inc.php");
$vf_c_action=fa_recup_param('vf_c_action','??????');
$vl_action_cleunik=intval(fa_recup_param('vl_action_cleunik','-1'));
$vl_act_cleunik=intval(fa_recup_param('vl_act_cleunik','-1'));
$vl_int_cleunik=intval(fa_recup_param('vl_int_cleunik','-1'));
$vl_commentaire_cleunik=intval(fa_recup_param('vl_commentaire_cleunik','-1'));
$vl_blocnotebrut=fa_recup_param('vl_blocnotebrut','');
$vl_date=fa_recup_param('vl_date','');
$vf_c_echo='';
switch (TRUE) {
  case $vf_c_action=='supprimer': 
    $sql_req = "DELETE FROM _actions_commentaires WHERE commentaire_cleunik = $vl_commentaire_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
  case $vf_c_action=='ajouter':
    $vl_commentaire_cleunik=_graal_requete_max("commentaire_cleunik","_actions_commentaires");
    $sql_req = "INSERT INTO _actions_commentaires set commentaire_cleunik=$vl_commentaire_cleunik,action_cleunik=$vl_action_cleunik,act_cleunik=$vl_act_cleunik,int_cleunik=$vl_int_cleunik,blocnote_brut='$vl_blocnotebrut'";
    if ($vl_date!='') {$sql_req.=",dateheuremodif='$vl_date'";}
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_commentaire_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=='modifier':
    $sql_req = "UPDATE _actions_commentaires set act_cleunik=$vl_act_cleunik,int_cleunik=$vl_int_cleunik,blocnote_brut='$vl_blocnotebrut'";
    if ($vl_date!='') {$sql_req.=",dateheuremodif='$vl_date'";}
    $sql_req.=" where commentaire_cleunik=$vl_commentaire_cleunik;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_commentaire_cleunik;} else {$vf_c_echo=-1;}
  case $vf_c_action=='??????':
    exit;
    break;    
} 
_graal_ferme_connexion();
echo $vf_c_echo;       
?>
