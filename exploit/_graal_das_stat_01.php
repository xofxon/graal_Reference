<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_critere_cleunik=intval(fa_recup_param('critere_cleunik','87'));
$vl_c_genre=fa_recup_param('genre','graal');
$vl_e_limit=fa_recup_param('limit','50');
$vl_c_sens=fa_recup_param('sens','desc');
switch ($vl_e_critere_cleunik) {
  case 11:    //  PCS N1
  case 12:    //  PCS N2
  case 13:    //  PCS N3
  case 14:    //  PCS N4
  case 21:    //  NAF N1
  case 22:    //  NAF N2
  case 23:    //  NAF N3
  case 24:    //  NAF N4
  case 25:    //  NAF N5
  case 41:    //  Catégories juridiques Niveau 1 
  case 42:    //  Catégories juridiques Niveau 2
  case 43:    //  Catégories juridiques Niveau 3
  case 51:    //  Nomenclature économique de synthèse Niveau 1 
  case 52:    //  Nomenclature économique de synthèse Niveau 2
  case 53:    //  Nomenclature économique de synthèse Niveau 3
  case 61:    //  Régions 
  case 62:    //  Départements
  case 63:    //  Arrondissements
  case 64:    //  Cantons
  case 65:    //  Communes
  case 80:    //  Genres d'acteurs
    $sql_champ="_act_choix_fixes.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_choix_fixes";
    break;
  case 58:    //  Langues
  case 120:   //  Meta-tags
  case 121:   
      $sql_champ="_documents_choix_fixes.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_documents_choix_fixes";
    break;

  case 59:    //  Langues
    $sql_champ="_utilisateur.langue_appli=_choix.choix_cleunik";
    $sql_fichi="_utilisateur";
    break;
  case 60:
/*    Pays 
          On cherche dans 
         - les critères des acteurs
         - les adresses postales des acteurs
         - les adresses postales des interlocuteurs d'acteurs
         - Les adresses des offres de prix client
         - Les adresses des commandes client
         - Les adresses des livraison client
         - Les adresses des factures client
         - Les adresses des demande de prix fournisseur
         - Les adresses des commandes fournisseur
         - Les adresses des réceptions fournisseur
         - Les adresses des factures fournisseur
*/          
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _offcli_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _offcli_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdecli_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdecli_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _livcli_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _livcli_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _faccli_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _faccli_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _demfou_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _demfou_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdefou_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdefou_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _recfou_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _recfou_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _facfou_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _facfou_adresses.choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    ) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 66:    //  Préfixes téléphoniques internationaux On cherche dans les téléphones et les fax des interlocuteurs des acteurs
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_fax,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_fax.prefixe_choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_tel,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_tel.prefixe_choix_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 67:
/*   Devise 
        On cherche dans 
         - les acteurs
         - Les offres de prix client
         - Les commandes client
         - Les livraison client
         - Les factures client
         - Les demande de prix fournisseur
         - Les commandes fournisseur
         - Les réceptions fournisseur
         - Les factures fournisseur
*/          
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _acteurs,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _acteurs.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _offcli_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _offcli_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdecli_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdecli_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _livcli_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _livcli_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _faccli_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _faccli_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _demfou_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _demfou_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdefou_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdefou_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _recfou_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _recfou_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _facfou_entetes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _facfou_entetes.devise=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    ) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 92:    //  Fonctions (interlocuteurs)
  case 81:     //  Genres d'interlocuteurs
    $sql_champ="_act_interlo_choix_fixes.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_interlo_choix_fixes";
    break;
  case 82:    //  Genres de téléphones On cherche dans les téléphones des interlocuteurs des acteurs
    $sql_champ="_act_interlo_tel.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_interlo_tel";
    break;
  case 83:    //  Genres de Fax On cherche dans les fax des interlocuteurs des acteurs
    $sql_champ="_act_interlo_fax.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_interlo_fax";
    break;
  case 84:    //  Genres de courriels On cherche dans les courriels des interlocuteurs des acteurs
    $sql_champ="_act_interlo_mail.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_interlo_mail";
    break;
  case 85:    //  Genres de Sites On cherche dans les sites des acteurs
    $sql_champ="_act_sites.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_sites";
    break;
  case 86:    //  civilités
    $sql_champ="_act_interlo.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_act_interlo";
    break;
  case 94:     //  Genres d'actions
    $sql_champ="_actions.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_actions";
    break;
  case 95:     //  Nature des Relations entre les actions et les interlocuteurs/acteurs
    $sql_champ="_graal.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_graal";
    break;
  case 98:    //  Genres d'adresses postales On cherche dans les adresses des acteurs et des interlocuteurs des acteurs
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_adresses.adr_typecoordonnees=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_adresses,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_adresses.adr_typecoordonnees=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 101:  //  Tarifs de vente
  case 127:  //  Tarifs d'achats
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _art_tarifs,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _art_tarifs.tarif_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_compta,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_compta.tarif_cleunik=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 108:  //  Unités de stocks
    $sql_champ="_art_stock.unite_stock=_choix.choix_cleunik";
    $sql_fichi="_art_stock";
    break;
  case 109:  //  Unités de vente
    $sql_champ="_art_ventes.unite_vente=_choix.choix_cleunik";
    $sql_fichi="_art_ventes";
    break;
  case 110:  //  Unités d'achats
    $sql_champ="_art_achats.unite_achat=_choix.choix_cleunik";
    $sql_fichi="_art_achats";
    break;
  case 113:     //  Intitulé des relations entre interlocuteurs d'acteurs
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_relations.choix_cleunik_gauche=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _act_interlo_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _act_interlo_relations.choix_cleunik_droite=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 114:     //  Intitulé des relations entre acteurs
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _acteurs_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _acteurs_relations.choix_cleunik_gauche=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _acteurs_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _acteurs_relations.choix_cleunik_droite=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _acteurs_representants,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _acteurs_representants.choix_cleunik_droite=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _acteurs_representants,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _acteurs_representants.choix_cleunik_gauche=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01
    ) toto group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 115:     //  Mode de gestion
    $sql_champ="_acteurs.modegestion=_choix.choix_cleunik";
    $sql_fichi="_acteurs";
    break;
  case 116:     //  Dépôts
    $sql_champ="_art_dep_emp.choix_depot=_choix.choix_cleunik";
    $sql_fichi="_art_dep_emp";
    break;
  case 117:     //  Emplacements
    $sql_champ="_art_dep_emp.choix_empla=_choix.choix_cleunik";
    $sql_fichi="_art_dep_emp";
    break;
  case 118:     //  Intitulé des relations entre articles
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _art_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _art_relations.choix_cleunik_gauche=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _art_relations,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _art_relations.choix_cleunik_droite=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 119:     //  Unités de temps
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _art_achats,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _art_achats.unite_reappro=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _art_fournis,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _art_fournis.unite_reappro=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 122:     //  Confidentialité des actions
    $sql_champ="_actions.confidentialite=_choix.choix_cleunik";
    $sql_fichi="_actions";
    break;
  case 123:     //  Priorités des actions
    $sql_champ="_actions.priorite=_choix.choix_cleunik";
    $sql_fichi="_actions";
    break;
  case 124:     //  Statuts des actions
    $sql_champ="_actions.statut=_choix.choix_cleunik";
    $sql_fichi="_actions";
    break;
  case 125:     //  Intitulé des relations entre action
    $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _graal_act,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _graal_act.choix_cleunik_gauche=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _graal_act,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _graal_act.choix_cleunik_droite=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 128:  //  Unités de conditionnement
    $sql_champ="_art_stock.unite_condi=_choix.choix_cleunik";
    $sql_fichi="_art_stock";
    break;
  case 129: //  Statuts des lignes d'actions commerciales
      $sql_req="select sum(nombre) as nombre,choix_code as choix_code,choix_valeur_texte_01 as choix_valeur_texte_01 from (
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _offcli_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _offcli_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdecli_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdecli_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _livcli_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _livcli_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _faccli_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _faccli_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _demfou_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _demfou_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union 
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _cdefou_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _cdefou_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _recfou_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _recfou_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    union
    select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from _facfou_lignes,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and _facfou_lignes.statut=_choix.choix_cleunik group by _choix.choix_code,_choix.choix_valeur_texte_01 
    ) toto 
    group by choix_code,choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit";
    break;
  case 130:  //  Origine des mouvements de stock
    $sql_champ="_mouvements_stock.genre_mvt=_choix.choix_cleunik";
    $sql_fichi="_mouvements_stock";
    break;
  case  31 : //  Classification des Produits Français (Sections)
  case  32 : //Classification des Produits Français (Sous-Sections)
  case  33 : //Classification des Produits Français (Divisions)
  case  34 : //Classification des Produits Français (Groupes)
  case  35 : //Classification des Produits Français (Classes)
  case  36 : //Classification des Produits Français (Catégories)
  case  37 : //Classification des Produits Français (Sous-Catégories)
  case 1000: //  Millésimes       (articles seuls)
  case 1001: //  Couleurs         (articles seuls)
  case 1002: //  Type de vin      (articles seuls)
  //case 1003: //  Conditionnement  (articles seuls)
  case 1004: //  Contenants       (articles seuls)
    $sql_champ="_art_choix_fixes.choix_cleunik=_choix.choix_cleunik";
    $sql_fichi="_art_choix_fixes";
    break;
  default:
    switch ($vl_c_genre) {
      case 'graal':
        break;
      case 'criteres_acteurs':
        $sql_champ="_act_choix_fixes.choix_cleunik=_choix.choix_cleunik";
        $sql_fichi="_act_choix_fixes";
        break;
      case 'criteres_interlocuteurs':
        $sql_champ="_act_interlo_choix_fixes.choix_cleunik=_choix.choix_cleunik";
        $sql_fichi="_act_interlo_choix_fixes";
        break;
      case 'criteres_articles':
        $sql_champ="_art_choix_fixes.choix_cleunik=_choix.choix_cleunik";
        $sql_fichi="_art_choix_fixes";
        break;
      case 'criteres_actions':
        //$sql_req .= " and (SELECT count(*) as nombre from _actions_choix_fixes where _actions_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
        break;
      case 'criteres_ged':
        $sql_champ="_documents_choix_fixes.choix_cleunik=_choix.choix_cleunik";
        $sql_fichi="_documents_choix_fixes";
        break;
    break;
    } 
  break;
}
if ($sql_req=="") {
  if (trim($sql_fichi)!="") {
    $sql_req="select count(*) as nombre,_choix.choix_code as choix_code,_choix.choix_valeur_texte_01 as choix_valeur_texte_01 from $sql_fichi,_choix where _choix.critere_cleunik=$vl_e_critere_cleunik and $sql_champ group by _choix.choix_code,_choix.choix_valeur_texte_01 order by nombre $vl_c_sens limit $vl_e_limit;";
  } else {
    $sql_req="select 1 from _choix where 1=2";
  }
}
$result = _graal_requete_bd($sql_req);
$vl_e_nombre_types=mysql_num_rows($result);
echo('<donnees>');
if ($vl_e_nombre_types!=0) { 
	while ($row = mysql_fetch_assoc($result)) {
		echo('<quoi ');
    echo(' nombre="'.fa_ent_xml($row['nombre']).'"');
    echo(' choix_code="'.fa_ent_xml($row['choix_code']).'"');
    echo(' choix_valeur_texte_01="'.fa_ent_xml($row['choix_valeur_texte_01']).'"');
    echo('/>');
  }
} else {
    echo('<quoi ');
    echo(' nombre="0"');
    echo(' choix_code=""');
    echo(' choix_valeur_texte_01="Pas utilisé !!"');
    echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
