<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_metatags_02";
fa_acces_script();
$vf_c_echo="";
define('EOL', "\r\n");
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_critere_cleunik=intval(fa_recup_param('vl_critere_cleunik',''));
$vl_act_cleunik=intval(fa_recup_param('vl_act_cleunik',''));
$sql_req="SELECT typeacteur from _acteurs where act_cleunik=$vl_act_cleunik";
$result = _graal_requete_bd($sql_req);
if (mysql_num_rows($result) == 0) {
  $vf_c_echo="Problème sur l'acteur";
} else {
  $row = mysql_fetch_assoc($result);
  $vl_e_typeact=fa_ent_xml($row['typeacteur']);
  
  $t1=fa_recup_param('t1','');
  $vl_e_uti_cleunik=0;
  $t1=utf8_encode(base64_decode($t1));
  $pieces = explode(",", $t1);
  $vl_e_i=count($pieces);
  $vl_e_j = 0;
  while ($vl_e_j < $vl_e_i):
    $valeur=addslashes($pieces[$vl_e_j]);
    $sql_req="SELECT choix_cleunik from _choix where critere_cleunik=$vl_critere_cleunik and choix_valeur_texte_01='$valeur'";
    $result = _graal_requete_bd($sql_req);
    if (mysql_num_rows($result) == 0) {
      $vl_choix_cleunik=_graal_requete_max("choix_cleunik","_choix");
      $sql_req_01 = "INSERT INTO _choix set choix_cleunik=$vl_choix_cleunik,critere_cleunik=$vl_critere_cleunik,choix_valeur_texte_01='$valeur',choix_valeur_texte_02='$valeur',choix_actif=1";
      $vf_c_echo=_graal_exec_requete($sql_req_01);
    } else {
      $row = mysql_fetch_assoc($result);
      $vl_choix_cleunik=fa_ent_xml($row['choix_cleunik']);
    }
    $sql_req_02 .="($vl_act_cleunik,$vl_choix_cleunik,$vl_critere_cleunik,$vl_e_typeact,$vl_e_uti_cleunik),";
    _graal_libere_requete_bd($result);
    $vl_e_j++;
  endwhile;
  if ($sql_req_02!="") {
    $sql_req_02=substr($sql_req_02, 0, -1);
    $sql_req="REPLACE INTO _act_choix_fixes (act_cleunik,choix_cleunik,critere_cleunik,typeacteur,uti_cleunik) VALUES ";
    $result_02 = _graal_requete_bd($sql_req.$sql_req_02);
    if($result_02 === false) {$vf_c_echo='Erreur 02 ->'.mysql_error($cnx) . $sql_req_02;} else {$vf_c_echo='Données correctement enregistrées.';}
  }
  echo $vf_c_echo;
}
_graal_ferme_connexion();
?>
