<?php
include("_graal_header_xul.inc.php");
include("_graal_var_portee.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_nomcomplet=fa_recup_session('vs_nomcomplet','tesquiconnard?');
$vl_c_typedoc=fa_recup_param('typedoc','0');
$vl_e_doc_cleunik=intval(fa_recup_param("vl_e_doc_cleunik","-1"));
$vl_c_titre=fa_ent_xml(fa_recup_param("vl_c_titre",'Titre inconnu !!!!'));
$vl_c_lien=fa_ent_xml(fa_recup_param("vl_c_lien",''));
$vl_c_genrecritere=fa_recup_param('genrecritere','0');
$vl_c_codecache="false";
$vl_c_cache_texte2="false";
switch ($vl_c_genrecritere) {
  case "entreprise":
    switch ($vl_c_typedoc) {
      default : $vl_c_id_fenetre="Fen_00403";$vl_e_portee=$vl_e_gedged;break;  //  Tous les types de documents de la GED
    }
    break;
  case "moi":
    switch ($vl_c_genreacteur) {
      default : $vl_c_id_fenetre="Fen_00404";$vl_e_portee=$vl_e_gedged;break;  //  Tous les types de documents de la GED
    }
    break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=1;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_beg_101=fa_recup_dico("beg_101");
$vl_c_beg_102=fa_recup_dico("beg_102");
$vl_c_beg_103=fa_recup_dico("beg_103");
$vl_c_beg_104=fa_recup_dico("beg_104");
$vl_c_beg_105=fa_recup_dico("beg_105");
$vl_c_beg_106=fa_recup_dico("beg_106");
$vl_c_beg_107=fa_recup_dico("beg_107");
$vl_c_beg_108=fa_recup_dico("beg_108");
$vl_c_beg_109=fa_recup_dico("beg_109");
$vl_c_beg_110=fa_recup_dico("beg_110");
$vl_c_beg_111=fa_recup_dico("beg_111");
$vl_c_beg_112=fa_recup_dico("beg_112");
$vl_c_beg_113=fa_recup_dico("beg_113");
$vl_c_beg_114=fa_recup_dico("beg_114");
$vl_c_beg_115=fa_recup_dico("beg_115");
$vl_c_beg_116=fa_recup_dico("beg_116");
$vl_c_dico_00004=fa_recup_dico("dico_00004");
$vl_c_dico_00005=fa_recup_dico("dico_00005");
$vl_c_dico_00007=fa_recup_dico("dico_00007");
$vl_c_mes_00007=fa_recup_dico("mess_00007");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_dico_00149=fa_recup_dico('dico_00149');
$vl_tb_droits_choix=_graal_requete_droits_fenetre("Fen_00402",$vl_e_uti_cleunik); //ajout dans les choix des critères de la GED 
if ($vl_tb_droits_choix[1]==true){$vl_c_choix_menu='<menuitem label="'.$vl_c_beg_110.'" oncommand="pf_nouveaux_choix()"/>';} else {$vl_c_choix_menu='';}
$vl_tb_droits_criteres=_graal_requete_droits_fenetre("Fen_00400",$vl_e_uti_cleunik); //ajout dans les critères de la GED 
if ($vl_tb_droits_criteres[1]==true){$vl_c_critere_menu='<menuitem label="'.$vl_c_beg_111.'" oncommand="pf_nouveaux_criteres()"/>';} else {$vl_c_critere_menu='';}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_beg_101" id="_win_fen_ged_criteres_01" onload="fa_aa(this);pf_aa_init()" _graal_lien="$vl_c_lien" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("_graal_inc_keyset_01.php");
include_once("js/_graal_01.js.php");
include("js/_graal_ged_criteres_01.js.php");
echo <<<END
<description>$vl_c_lien ($vl_c_titre)</description>
<popupset>
  <popup id="graal_acces_choix">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_choix_criteres');" />
    $vl_c_choix_menu
  </popup>
  <popup id="graal_acces_critere">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_criteres');" />
    $vl_c_critere_menu
  </popup>
  <popup id="graal_criteres_retenus">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','criteres_des_geds');" />
  </popup>
</popupset>
<hbox id="beg_ged_02" flex="2">
   <vbox flex="1">
END;
switch ($vl_c_typedoc) {
  case '1': //  pseudo-documents, liens internet
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00072",$vl_e_uti_cleunik); //Récupération des meta-tags des pseudo-documents (liens)
    if ($vl_tb_droits[0]==true){
      //  On recherche tous les critères un peu particuliers
      $genre="ged";
      include("_graal_inc_menulist_critere_particuliers.php");        
    }
    break;
	case '3': //  Documents
	case '13': //  Pièces jointes
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_01029",$vl_e_uti_cleunik); //Récupération des propriétés des documents
    if ($vl_tb_droits[0]==true){
      //  On recherche tous les critères un peu particuliers
      $genre="doc";
      include("_graal_inc_menulist_critere_particuliers.php");        
    }
    break;	
}
echo <<<END
     <tree flex="40" id="arb_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onclick="pf_sel_arbre_criteres();" seltype="single" context="graal_acces_critere">
       <treecols> 
        <treecol id="critere_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="critere_choixmultiples" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="critere_code" label="$vl_c_beg_102"  sort="?critere_code"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="critere_denomination" label="$vl_c_beg_103"  sort="?critere_denomination" sortActive="true" sortDirection="ascending" />
        <treecol id="critere_codechoixpertinent" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
       </treecols>
       <template><query expr="*"/><action>
         <treechildren >
           <treeitem uri="?" seltype="single">
             <treerow >
               <treecell label="?critere_cleunik"/>
               <treecell label="?critere_choixmultiples"/>
               <treecell label="?critere_code"/>
               <treecell label="?critere_denomination"/>
               <treecell label="?critere_codechoixpertinent"/>
             </treerow>
           </treeitem>
         </treechildren>
       </action></template>
     </tree>
  </vbox>
  <splitter/>
    <vbox flex="1">
  
  <hbox flex="1">
  <groupbox flex="1">
    <caption><label value="$vl_c_beg_113" /></caption>
    <radiogroup id="rdg_position" onclick="pf_affiche_choix_criteres_potentiel_ged();" flex="1" value="2">
       <hbox flex="1">
       <radio label="$vl_c_beg_114" value="1" /><spacer flex="1"/>
       <radio label="$vl_c_beg_115" value="2" selected="true"/><spacer flex="1"/>
       <radio label="$vl_c_beg_116" value="3" />
       </hbox>
     </radiogroup>
  </groupbox>
  </hbox>

     <tree flex="40" context="graal_acces_choix" id="arb_choix_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onclick="pf_sel_arbre_choix();" seltype="single">
       <treecols> 
        <treecol id="choix_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="choix_code" hidden="$vl_c_codecache" ignoreincolumnpicker="$vl_c_codecache" label="$vl_c_beg_104"  sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="choix_valeur_texte_01" label="$vl_c_beg_105" sort="?choix_valeur_texte_01" sortActive="true" sortDirection="ascending"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="nombre_entreprise" label="$vl_c_beg_112" class="droite" sort="?nombre"/><splitter class="tree-splitter" resizeafter="grow"/><splitter class="tree-splitter" resizeafter="grow"/>
       </treecols>
       <template><query expr="*"/><action>
         <treechildren >
           <treeitem uri="?" seltype="single">
             <treerow >
               <treecell label="?choix_cleunik"/>
               <treecell label="?choix_code"/>
               <treecell label="?choix_valeur_texte_01"/>
               <treecell label="?nombre"/>
             </treerow>
           </treeitem>
         </treechildren>
       </action></template>
     </tree>
     <button width="40" flex="1" id="bt_enregistrer" tooltiptext="$vl_c_dico_00005 Ctrl+Shift+F5" label="$vl_c_dico_00005" keycode="k-enregistrer" crop="end" dir="normal" oncommand="pf_validation('enregistrer')" />
   </vbox>
</hbox>
<splitter/>
<hbox flex="2">
<keyset id="_graal_ks_02">
    <key id="k-recherche" modifiers="alt" keycode="VK_F3" oncommand="pf_affiche_criteres_ged();"/>
	</keyset>
  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_mes_00007" oncommand="pf_affiche_criteres_ged();"/>
   <tree id="criteres_des_geds" enableColumnDrag="true" flex="40" flags="" ref="*" querytype="xml" datasources="" seltype="multiple" onclick="pf_sel_arbre_criteres_ged();" context="graal_criteres_retenus">
     <treecols>
       <treecol id="doc_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
       <treecol id="choix_cleunik_fixe" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
       <treecol id="critere_cleunik_fixe" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_denomination_entreprise" label="$vl_c_beg_108" sort="?critere_denomination"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_code_entreprise" label="$vl_c_beg_106" sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_valeur_texte_01_entreprise" label="$vl_c_beg_107" sort="?choix_valeur_texte_01"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template><query expr="*"/><action>
       <treechildren>
         <treeitem uri="?" seltype="single">
           <treerow>
             <treecell label="?doc_cleunik"/>
             <treecell label="?choix_cleunik"/>
             <treecell label="?critere_cleunik"/>
             <treecell label="?critere_denomination"/>
             <treecell label="?choix_code"/>
             <treecell label="?choix_valeur_texte_01"/>
           </treerow>
         </treeitem>
       </treechildren>
     </action></template>
   </tree>
   <vbox>
     <button tooltiptext ="$vl_c_dico_00004 Ctrl+Shift+F4" keycode="k-supprimer" flex="1" id="bt_supprimer" label="$vl_c_dico_00004" crop="end" dir="normal" oncommand="pf_validation('supprimer')" />
     <button tooltiptext ="$vl_c_dico_00007 Alt+F4" keycode="k-sortir" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
	 <button id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_win_id')" />
   </vbox> 
</hbox>
</window>
END;
?>
