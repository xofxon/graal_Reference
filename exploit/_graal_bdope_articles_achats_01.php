<?php
include("_graal_header_txt.inc.php");
$vf_c_echo="";
$vl_e_art_cleunik=intval(fa_recup_param("vl_art_cleunik","-1"));
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_delai_reappro=intval(fa_recup_param("vl_delai_reappro","0"));
$vl_unite_reappro=intval(fa_recup_param("vl_unite_reappro","-20"));
$vl_unite_achat=intval(fa_recup_param("vl_unite_achat","-36"));
switch ($vf_c_action)
{
  case "supprimer":
    $sql_req = "DELETE FROM _art_achats WHERE _art_stock.art_cleunik = $vl_e_art_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_e_art_cleunik;} else {$vf_c_echo=-1;}
    break;    
  case "ajouter":
  case "modifier":
    //  Toujours commencer par la tentative d'ajout qui plantera s'il y a un doublon alors qu'un update ne plante pas si l'enregistrment n'existe pas
    $sql_req="INSERT INTO _art_achats set art_cleunik=$vl_e_art_cleunik,delai_reappro=$vl_delai_reappro,unite_reappro=$vl_unite_reappro,unite_achat=$vl_unite_achat;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo==='ok') 
    {
    $vf_c_echo=$vl_e_art_cleunik;
    } 
    else {
      $sql_req="UPDATE _art_achats set delai_reappro=$vl_delai_reappro,unite_reappro=$vl_unite_reappro,unite_achat=$vl_unite_achat WHERE art_cleunik = $vl_e_art_cleunik;";        
      $vf_c_echo=_graal_exec_requete($sql_req);
      if($vf_c_echo==='ok') {$vf_c_echo=$vl_e_art_cleunik;} else {$vf_c_echo=-1;}
    }
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
echo $sql_req;
?>
