<?php
include("_graal_var_portee.php");
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->selection_interlocuteur)){$selection_interlocuteur=$vl_c_xml->selection_interlocuteur->attributes();}else{$selection_interlocuteur='1';}
if (isset($vl_c_xml->vl_selint_nbcaracrech)){$vl_selint_nbcaracrech=$vl_c_xml->vl_selint_nbcaracrech->attributes();}else{$vl_selint_nbcaracrech='3';}
$vl_c_selqui_01="false";
$vl_c_selqui_02="false";
$vl_c_selqui_03="false";
$vl_c_selqui_04="false";
$vl_c_selqui_05="false";
$vl_c_selqui_06="false";
$vl_c_selqui_07="false";
$vl_c_selqui_08="false";
$vl_c_selqui_09="false";
$vl_c_selqui_10="false";
$vl_c_inactif="true";
$vl_e_portee=$vl_e_interl;
switch ($vl_c_inc_interlos_recherche_01){
  case "Div_00194";$vl_c_selqui_09="true";$vl_e_portee+=0;$vl_c_inactif="false";break;  //Recherche de tous les interlocuteurs
  case "Div_00128";$vl_c_selqui_02="true";$vl_e_portee+=$vl_e_entrep;break; //  Entreprise
  case "Div_00129";$vl_c_selqui_03="true";$vl_e_portee+=$vl_e_procli;break; //  Prospects Clients
  case "Div_00130";$vl_c_selqui_05="true";$vl_e_portee+=$vl_e_profou;break; //  Prospects Fournisseurs
  case "Div_00131";$vl_c_selqui_04="true";$vl_e_portee+=$vl_e_client;break; //  Clients
  case "Div_00132";$vl_c_selqui_06="true";$vl_e_portee+=$vl_e_fourni;break; //  Fournisseurs
  case "Div_00133";$vl_c_selqui_07="true";$vl_e_portee+=$vl_e_autrac;break; //  Autres
  case "Div_00134";$vl_c_selqui_08="true";$vl_e_portee+=$vl_e_actind;break; //  Indéterminés
}
$vf_c_url_alimente_table="_graal_das_paniers_01.php?vl_e_maportee=";
$vl_c_source_paniers="_graal_das_paniers_01.php?vl_c_quelspaniers=medoc#38;vl_e_portee=$vl_e_portee#38;";
$vl_c_source_paniers="$vf_c_url_alimente_table$vl_e_portee";
_graal_requete_charge_varlib($vl_c_inc_interlos_recherche_01,$vl_e_uti_cleunik);
$vl_c_dico_00018=fa_recup_dico("dico_00018");
$vl_c_dico_00019=fa_recup_dico("dico_00019");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00031=fa_recup_dico("dico_00031");
$vl_c_dico_00032=fa_recup_dico("dico_00032");
$vl_c_dico_00033=fa_recup_dico("dico_00033");
$vl_c_dico_00034=fa_recup_dico("dico_00034");
$vl_c_dico_00035=fa_recup_dico("dico_00035");
$vl_c_dico_00036=fa_recup_dico("dico_00036");
$vl_c_dico_00037=fa_recup_dico("dico_00037");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_bbj_010=fa_recup_dico("bbj_010");
$vl_c_bbj_011=fa_recup_dico("bbj_011");
$vl_c_bbj_012=fa_recup_dico("bbj_012");
$vl_c_bbj_013=fa_recup_dico("bbj_013");
$vl_c_bbj_014=fa_recup_dico("bbj_014");
$vl_c_bbj_015=fa_recup_dico("bbj_015");
$vl_c_bbj_016=fa_recup_dico("bbj_016");
$vl_c_bbj_017=fa_recup_dico("bbj_017");
$vl_c_bbj_018=fa_recup_dico("bbj_018");
$vl_c_bbj_019=fa_recup_dico("bbj_019");
$vl_c_bbj_020=fa_recup_dico("bbj_020");
$vl_c_bbj_021=fa_recup_dico("bbj_021");
$vl_c_bbj_022=fa_recup_dico("bbj_022");
$vl_c_bbj_023=fa_recup_dico("bbj_023");$vl_c_bbj_023="Nombre maxi";
$vl_c_bbj_024=fa_recup_dico("bbj_024");$vl_c_bbj_024="150";
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_context_00='<popupset><popup id="pop_arbre_interlo"><menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\'arbre_interlo\');" /></popup></popupset>';
echo <<<END
$vl_c_context_00
<script type="text/javascript">
<![CDATA[
function po_sel() {
  var vl_interlocuteur=$vl_e_interl;
  var vf_c_url_alimente_table="$vf_c_url_alimente_table";
  var item=fa_gid("bbj_ml_qui").selectedItem;
  var vl_portee=item.getAttribute("_graal_portee");
  var vl_e_total=parseInt(vl_portee)+parseInt(vl_interlocuteur);
  fa_das("bbj_ml_actif",vf_c_url_alimente_table+vl_e_total);
  fa_gid("bbj_ml_actif").builder.rebuild();
}
]]>
</script>
    <vbox flex="1">
  <hbox>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="2" id="bbj_ml_qui" oncommand="pf_approximatif();">
      <menupopup>
        <menuitem label="$vl_c_dico_00018" tooltiptext="$vl_c_dico_00018" selected="$vl_c_selqui_01" value="000000" _graal_portee="999999999999"/>
        <menuitem label="$vl_c_dico_00037" tooltiptext="$vl_c_dico_00037" selected="$vl_c_selqui_10" value="888888" _graal_portee="999999999999"/>
        <menuitem label="$vl_c_dico_00019" tooltiptext="$vl_c_dico_00019" selected="$vl_c_selqui_02" value="110000" _graal_portee="$vl_e_entrep"/>
        <menuitem label="$vl_c_dico_00031" tooltiptext="$vl_c_dico_00031" selected="$vl_c_selqui_03" value="110001" _graal_portee="$vl_e_procli"/>
        <menuitem label="$vl_c_dico_00033" tooltiptext="$vl_c_dico_00033" selected="$vl_c_selqui_04" value="110003" _graal_portee="$vl_e_client"/>
        <menuitem label="$vl_c_dico_00032" tooltiptext="$vl_c_dico_00032" selected="$vl_c_selqui_05" value="110002" _graal_portee="$vl_e_profou"/>
        <menuitem label="$vl_c_dico_00034" tooltiptext="$vl_c_dico_00034" selected="$vl_c_selqui_06" value="110004" _graal_portee="$vl_e_fourni"/>
        <menuitem label="$vl_c_dico_00035" tooltiptext="$vl_c_dico_00035" selected="$vl_c_selqui_07" value="110005" _graal_portee="$vl_e_autrac"/>
        <menuitem label="$vl_c_dico_00036" tooltiptext="$vl_c_dico_00036" selected="$vl_c_selqui_08" value="110006" _graal_portee="$vl_e_actind"/>
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" selected="$vl_c_selqui_09" value="999999" _graal_portee="000000000000"/>
      </menupopup>
    </menulist>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbj_ml_actif" oncommand="pf_approximatif();" flags="" ref="*" querytype="xml" datasources="$vl_c_source_paniers" value="1">
      <menupopup>
        <menuitem label="$vl_c_dico_00046" tooltiptext="$vl_c_dico_00046" value="1" /> <!--  Actifs-->
        <menuitem label="$vl_c_dico_00047" tooltiptext="$vl_c_dico_00047" value="2" /> <!--  Inactifs-->
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" value="0" /> <!--  Tous-->
      </menupopup>
      <template><query expr="*"/><action>
        <menupopup>
          <menuseparator/>
          <menuitem uri="?" label="?panier_titre" tooltiptext="?panier_titre" selected="true" value="3" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers-->
        </menupopup>
      </action></template>
    </menulist>
    <label flex="1" value="$vl_c_bbj_010"/>
    <textbox flex="1" value="$vl_c_bbj_011" id="bbj_tb_rechapproxima" oninput="if ('$vl_selint_nbcaracrech'!='-1') {if (this.value.length>=$vl_selint_nbcaracrech){pf_approximatif();}}"/>

  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbj_ml_type" oncommand="pf_approximatif();" value="1">
    <menupopup>
      <menuitem label="$vl_c_bbj_021" tooltiptext="$vl_c_bbj_021" value="1"/>
      <menuitem label="$vl_c_bbj_022" tooltiptext="$vl_c_bbj_022" value="2" hidden="true" />
    </menupopup>
  </menulist>

    <label flex="1" value="$vl_c_bbj_012"/>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbj_ml_zone" value="3">
      <menupopup>
        <menuitem label="$vl_c_bbj_013" tooltiptext="$vl_c_bbj_013" value="1"/>
        <menuitem label="$vl_c_bbj_014" tooltiptext="$vl_c_bbj_014" value="2"/>
        <menuitem label="$vl_c_bbj_015" tooltiptext="$vl_c_bbj_015" value="3"/>
      </menupopup>
    </menulist>
		<label flex="0" value="$vl_c_bbj_023"/>
    <textbox flex="0"   value="$vl_c_bbj_024" id="bbj_tb_limit" size="4" type="number" hidespinbuttons="true"/>
    <toolbarbutton flex="1" hidden="true" class="aa12" oncommand="pf_approximatif();"/>
  </hbox>
  <vbox flex="2">
<tree id="arbre_interlo" onselect="pf_sel_arbre_interlo();" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" context="pop_arbre_interlo">
<treecols>
 <treecol id="civilite" sort="?civilite" label="$vl_c_bbj_016" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="qui" sort="?qui" label="$vl_c_bbj_017" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="act_cleunik" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="int_cleunik" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="portee" sort="?portee" label="$vl_c_bbj_018" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="raisonsoc" sort="?raisonsoc" label="$vl_c_bbj_019" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="nc" sort="?nc" label="$vl_c_bbj_020" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="typeacteur" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
</treecols>
 <template><query expr="*"/><action>
 <treechildren>

 <treeitem container="true" uri="?" seltype="single">
 <treerow>
 <treecell label="?civilite" properties="?properties"/>
 <treecell label="?qui" properties="?properties"/>
 <treecell label="?act_cleunik"/>
 <treecell label="?int_cleunik"/>
 <treecell label="?portee" properties="?properties"/>
 <treecell label="?raisonsoc" properties="?properties"/>
 <treecell label="?nc" properties="?properties"/>
 <treecell label="?typeacteur"/>
 </treerow>
 </treeitem>
 </treechildren>
 </action></template>
 </tree>
 </vbox>

  </vbox>
END;
?>
