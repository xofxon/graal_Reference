<?php
$vl_c_id_vbox='bej_ged_01';
_graal_requete_charge_varlib($id_inc_ged,$vl_e_uti_cleunik);
$vl_c_bej_001=fa_recup_dico("bej_001");
$vl_c_bej_002=fa_recup_dico("bej_002");
$vl_c_bej_003=fa_recup_dico("bej_003");
$vl_c_bej_004=fa_recup_dico("bej_004");
$vl_c_bej_005=fa_recup_dico("bej_005");
$vl_c_bej_006=fa_recup_dico("bej_006");
$vl_c_bej_007=fa_recup_dico("bej_007");
$vl_c_bej_008=fa_recup_dico("bej_008");
$vl_c_bej_009=fa_recup_dico("bej_009");
$vl_c_bej_010=fa_recup_dico("bej_010");
$vl_c_bej_011=fa_recup_dico("bej_011");
$vl_c_bej_012=fa_recup_dico("bej_012");
$vl_c_bej_013=fa_recup_dico("bej_013");
$vl_c_bej_014=fa_recup_dico("bej_014");
$vl_c_bej_015=fa_recup_dico("bej_015");
$vl_c_bej_016=fa_recup_dico("bej_016");
$vl_c_bej_017=fa_recup_dico("bej_017");
$vl_c_bej_018=fa_recup_dico("bej_018");
$vl_c_bej_019=fa_recup_dico("bej_019");
$vl_c_bej_020=fa_recup_dico("bej_020");
$vl_c_bej_021=fa_recup_dico("bej_021");$vl_c_bej_021="Voir ?";
$vl_b_infos_01_hidden="true";
$vb_barre_hidden="false";$vl_c_bloc_pseudodocs="";$vl_c_bloc_documents="";$vl_c_bloc_notes="";$vl_c_bloc_toutes="";
switch ($id_inc_ged) {
  case "Div_00397": //Toutes les actions
    $vl_tb_droits_pseudodocs=_graal_requete_droits_fenetre("Fen_00428",$vl_e_uti_cleunik);
    $vl_tb_droits_documents=_graal_requete_droits_fenetre("Fen_00429",$vl_e_uti_cleunik);
    $vl_tb_droits_notes=_graal_requete_droits_fenetre("Fen_00430",$vl_e_uti_cleunik);
    $quelsdocs="undoc_action";
    break;  
  case "Div_00365": //Tous les acteurs
    $vl_tb_droits_pseudodocs=_graal_requete_droits_fenetre("Fen_00409",$vl_e_uti_cleunik);
    $vl_tb_droits_documents=_graal_requete_droits_fenetre("Fen_00410",$vl_e_uti_cleunik);
    $vl_tb_droits_notes=_graal_requete_droits_fenetre("Fen_00411",$vl_e_uti_cleunik);
		$vl_c_bloc_toutes=<<<EOT
			<toolbarbutton class="table-rafraichir af08" tooltiptext="$vl_c_bej_020" oncommand="pf_affiche_donnees_ged_actions();"/>
EOT;
    $quelsdocs="undoc_acteur";
    break;  
  case "Div_00366": //Tous les articles
    $vl_tb_droits_pseudodocs=_graal_requete_droits_fenetre("Fen_00412",$vl_e_uti_cleunik);
    $vl_tb_droits_documents=_graal_requete_droits_fenetre("Fen_00414",$vl_e_uti_cleunik);
    $vl_tb_droits_notes=_graal_requete_droits_fenetre("Fen_00413",$vl_e_uti_cleunik);
    $quelsdocs="undoc_articl";
    break;  
  case "Div_00367": //Tous les interlocuteurs
    $vl_tb_droits_pseudodocs=_graal_requete_droits_fenetre("Fen_00415",$vl_e_uti_cleunik);
    $vl_tb_droits_documents=_graal_requete_droits_fenetre("Fen_00416",$vl_e_uti_cleunik);
    $vl_tb_droits_notes=_graal_requete_droits_fenetre("Fen_00417",$vl_e_uti_cleunik);
    $quelsdocs="undoc_interl";
$vl_c_bloc_toutes=<<<EOT
			<toolbarbutton class="table-rafraichir af08" tooltiptext="$vl_c_bej_020" oncommand="pf_affiche_donnees_ged_actions();"/>
EOT;
    break;  
  case "Div_00363": //  Mes document GED favoris
    //  Pour l'instant (27-06-2007, il n'y a pas de gestion de l'ajout de favoris. Donc comme on peut tout le temps ajouter des documents, il faut toujours pouvoir les consulter )
    $vl_b_infos_01_hidden="false";
    switch ($vl_c_quelsdocs) {
      case "tous":
				$vl_tb_droits_pseudodocs[0]=1;
      	$vl_tb_droits_documents[0]=1;
      	$vl_tb_droits_notes[0]=1;
      	$quelsdocs="undoc";
      	break;
      case "docs": 
      	$vl_tb_droits_pseudodocs[0]=0;
      	$vl_tb_droits_documents[0]=1;
      	$vl_tb_droits_notes[0]=0;
      	$quelsdocs="undoc";
		if ($vl_c_genreged=="cgv"||$vl_c_genreged=="palett"||$vl_c_genreged=="filigrane"){
			$vl_tb_droits_documents[1]=1;
		}
      	break;
    	case "notes": 
      	$vl_tb_droits_pseudodocs[0]=0;
      	$vl_tb_droits_documents[0]=0;
      	$vl_tb_droits_notes[0]=1;
      	$quelsdocs="undoc";
      	break;
			case "pseudodocs": 
      	$vl_tb_droits_pseudodocs[0]=1;
      	$vl_tb_droits_documents[0]=0;
      	$vl_tb_droits_notes[0]=0;
      	$quelsdocs="unpseudodoc";
      	break;
    }
    break;
  case "Div_00369": //Entreprise
    $vl_tb_droits_pseudodocs=_graal_requete_droits_fenetre("Fen_00419",$vl_e_uti_cleunik);
    $vl_tb_droits_documents=_graal_requete_droits_fenetre("Fen_00420",$vl_e_uti_cleunik);
    $vl_tb_droits_notes=_graal_requete_droits_fenetre("Fen_00421",$vl_e_uti_cleunik);
    $quelsdocs="undoc_entrep";
    break;  
  case "Div_00514": // Liaisons des documents
    $vl_b_infos_01_hidden="false";
    $vb_barre_hidden="true";
    $vl_tb_droits_pseudodocs[0]=0;
    $vl_tb_droits_documents[0]=0;
    $vl_tb_droits_notes[0]=0;
    $quelsdocs="undoc";
    break;
}
if ($vl_tb_droits_pseudodocs[0]!=0){
  $vl_c_bloc_pseudodocs='<toolbarseparator /><hbox id="bloc_ged_lien"><label value="'.$vl_c_bej_006.'"/>';
  $vl_c_bloc_pseudodocs.='<toolbarbutton class="aa13" tooltiptext="'.$vl_c_bej_016.'"  oncommand="pf07_atteindre()"/>';
  $vl_c_bloc_pseudodocs.='<toolbarbutton class="ah05" id="tb_ged_liens_02" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_007.'" oncommand="pf07_ouvre_ged();" />';
	if ($vl_tb_droits_pseudodocs[1]!=0){
		$vl_c_bloc_pseudodocs.='<toolbarbutton class="al11" id="tb_ged_lien_01" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_005.'" oncommand="pf_ged_ajout(\'ged_lien\');"/>';
	}
  $vl_c_bloc_pseudodocs.='</hbox><toolbarseparator />';
}

if ($vl_tb_droits_documents[0]!=0){
  $vl_c_bloc_documents='<toolbarseparator /><hbox id="bloc_ged_doc"><label value="'.$vl_c_bej_008.'"/>';
  if ($vl_c_voir_doc=="non") {
  	$vl_c_bloc_documents.='<toolbarbutton id="tb_visualise_doc" observes="broadcaster_01" class="aa04" tooltiptext="'.$vl_c_bej_021.'"  oncommand="pf07_visualise();"/>';
  }
  $vl_c_bloc_documents.='<toolbarbutton id="tb_telecharge_doc" observes="broadcaster_01" class="aa03" tooltiptext="'.$vl_c_bej_015.'"  oncommand="pf07_telecharge();"/>';
  $vl_c_bloc_documents.='<toolbarbutton class="ai03" id="tb_ged_docs_02" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_009.'" oncommand="pf07_ouvre_ged();" />';
  if ($vl_tb_droits_documents[1]!=0){
  	$vl_c_bloc_documents.='<toolbarbutton class="al08" id="tb_ged_docs_01" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_010.'" oncommand="pf_ged_ajout(\'ged_doc\');"/>';
	}
  $vl_c_bloc_documents.='</hbox><toolbarseparator />';
}  
if ($vl_tb_droits_notes[0]!=0){
  $vl_c_bloc_notes='<toolbarseparator /><hbox id="bloc_ged_note"><label value="'.$vl_c_bej_011.'"/>';
  $vl_c_bloc_notes.='<toolbarbutton class="ai02" id="tb_ged_notes_02" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_012.'" oncommand="pf07_ouvre_ged();" />';
  if ($vl_tb_droits_notes[1]!=0){
  	$vl_c_bloc_notes.='<toolbarbutton class="al09" id="tb_ged_notes_01" observes="broadcaster_01" tooltiptext="'.$vl_c_bej_013.'" oncommand="pf_ged_ajout(\'ged_note\');"/>';
	}
  $vl_c_bloc_notes.='</hbox><toolbarseparator />';
}
include_once("js/_graal_07_ged.js.php");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_context_00=<<<EOT
	<popupset><popup id="pop_arbre_des_ged">
		<menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_ged');" />
		$menu_ouvre
    $menu_partage
	</popup></popupset>
EOT;
echo <<<END
$vl_c_context_00
  <vbox id="$vl_c_id_vbox" flex="1" class='overflow_01'>
    <vbox flex="0" hidden="$vb_barre_hidden" >
      <toolbar grippyhidden="true">
  		  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_bej_014" oncommand="pf_affiche_donnees_ged();"/>
				$vl_c_bloc_toutes
        $vl_c_bloc_pseudodocs
        $vl_c_bloc_documents
        $vl_c_bloc_notes
      </toolbar>
    </vbox>    
    <tree id="arbre_des_ged" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" ondblclick="pf07_ouvre_ged();" onselect="pf07_sel_arbre_ged();" seltype="single" context="pop_arbre_des_ged" >
      <treecols>
        <treecol id="doc_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="emplacement" label="$vl_c_bej_001" sort="?emplacement"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="titre" label="$vl_c_bej_002" sort="?titre"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="typedoc" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="descriptif_sommaire" label="$vl_c_bej_003" sort="?descriptif_sommaire"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="origine" label="$vl_c_bej_004" sort="?origine"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="portee" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="rattachement" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="infos_01" hidden="$vl_b_infos_01_hidden" label="$vl_c_bej_017" sort="?infos_01"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="dateheurecreation" label="$vl_c_bej_018" sort="?dateheurecreation_brut"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="dateheuremodif" label="$vl_c_bej_019" sort="?dateheuremodif_brut"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
		<treecol id="prop_droits" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
      <template><query expr="*"/><action>
        <treechildren>
          <treeitem uri="?" seltype="single">
            <treerow>
              <treecell label="?doc_cleunik" />
              <treecell properties="?prop_droits ?prop_actif" label="?emplacement"/>
              <treecell properties="?properties ?prop_actif" label=" ?titre"/>
              <treecell label="?typedoc" />
              <treecell properties="?prop_actif" label="?descriptif_sommaire"/>
              <treecell label="?origine"/>
              <treecell label="?portee"/>
              <treecell label="?rattachement"/>
              <treecell label="?infos_01"/>
              <treecell label="?dateheurecreation"/>
              <treecell label="?dateheuremodif"/>
              <treecell label="?dateheurecreation_brut"/>
              <treecell label="?dateheuremodif_brut"/>
				<treecell label="?prop_droits"/>
            </treerow>
          </treeitem>
        </treechildren>
      </action></template>
    </tree>
  </vbox>
END;
?>
