<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_e_act_cleunik=intval(fa_recup_param("vl_e_act_cleunik","-1"));
$vl_e_art_cleunik=intval(fa_recup_param("vl_e_art_cleunik","-1"));
$vl_e_tar_cleunik=intval(fa_recup_param("vl_e_tar_cleunik","0"));
$vl_e_type=intval(fa_recup_param("vl_e_type","110004"));
$vl_c_genre=intval(fa_recup_param("vl_c_genre",1));
$vl_c_origine=fa_recup_param("vl_c_origine","article");
switch ($vl_e_type) {
  case 110000:  // tarifs entreprise
    switch ($vl_c_genre) {
      case 1 : // Ventes
        $vl_c_id_fenetre="Fen_00357";
        $vl_c_id_article_ventes="Div_00318"; //  Onglet des ventes (tarif type, tarifs spéciaux)
        _graal_requete_charge_varlib($vl_c_id_article_ventes,$vl_e_uti_cleunik);
        $vl_c_bdg_005=fa_recup_dico("bdg_005");
        $vl_c_bdg_006=fa_recup_dico("bdg_006");
        $vl_c_bdg_007=fa_recup_dico("bdg_007");
        $vl_c_bdg_030=fa_recup_dico("bdg_030");
        $vl_c_id_article_recherche='Div_00209';
        $ml_tarif=fa_brik_menulist_choix(101,1,-1,-1,'','ml_tarif',"broadcaster_01",0);
        break;
      case 2 : // Achats  
        $vl_c_id_fenetre="Fen_00482";
        $vl_c_id_article_achats="Div_00221";
        _graal_requete_charge_varlib($vl_c_id_article_achats,$vl_e_uti_cleunik);
        $vl_c_bbv_010=fa_recup_dico("bbv_010");
        $vl_c_bbv_011=fa_recup_dico("bbv_011");
        $vl_c_bbv_012=fa_recup_dico("bbv_012");
        $vl_c_bbv_022=fa_recup_dico("bbv_022");
        $vl_c_id_article_recherche='Div_00208';
        $ml_tarif=fa_brik_menulist_choix(127,1,-1,-1,'','ml_tarif',"broadcaster_01",0);
        break;
    }
    break;
  case 110004:  // tarifs particulier fournisseur
    $vl_c_id_fenetre="Fen_00484";$vl_c_id_inc_acteurs_selection_01="Div_00045";$vl_c_id_inc_acteurs_01="Div_00037";
    $vl_c_id_article_achats="Div_00221";
    _graal_requete_charge_varlib($vl_c_id_article_achats,$vl_e_uti_cleunik);
    $vl_c_bbv_019=fa_recup_dico("bbv_019");
    $vl_c_bbv_020=fa_recup_dico("bbv_020");
    $vl_c_bbv_021=fa_recup_dico("bbv_021");
    $vl_c_bbv_023=fa_recup_dico("bbv_023");
    $vl_c_bbv_024=fa_recup_dico("bbv_024");
	$vl_c_bbv_025=fa_recup_dico("bbv_025");
	$vl_c_bbv_026=fa_recup_dico("bbv_026");
	$vl_c_bbv_027=fa_recup_dico("bbv_027");
	$vl_c_bbv_028=fa_recup_dico("bbv_028");
	$vl_c_bbv_029=fa_recup_dico("bbv_029");
    $vl_c_id_article_recherche='Div_00208';
    $ml_tarif=fa_brik_menulist_choix(127,1,-1,-1,'','ml_tarif',"broadcaster_01",0);
    break;
  case 110003:  // tarifs particulier clients
    $vl_c_id_fenetre="Fen_00483";$vl_c_id_inc_acteurs_selection_01="Div_00044";$vl_c_id_inc_acteurs_01="Div_00032";
    $vl_c_id_article_ventes="Div_00318"; //  Onglet des ventes (tarif type, tarifs spéciaux)
    _graal_requete_charge_varlib($vl_c_id_article_ventes,$vl_e_uti_cleunik);
    $vl_c_bdg_013=fa_recup_dico("bdg_013");
    $vl_c_bdg_014=fa_recup_dico("bdg_014");
    $vl_c_bdg_015=fa_recup_dico("bdg_015");
    $vl_c_bdg_031=fa_recup_dico("bdg_031");
    $vl_c_id_article_recherche='Div_00209';
    $ml_tarif=fa_brik_menulist_choix(101,1,-1,-1,'','ml_tarif',"broadcaster_01",0);
    break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bdh_100=fa_recup_dico("bdh_100");
$vl_c_bdh_101=fa_recup_dico("bdh_101");
$vl_c_bdh_102=fa_recup_dico("bdh_102");
$vl_c_bdh_103=fa_recup_dico("bdh_103");
$vl_c_bdh_104=fa_recup_dico("bdh_104");
$vl_c_bdh_105=fa_recup_dico("bdh_105");
$vl_c_bdh_106=fa_recup_dico("bdh_106");
$vl_c_bdh_107=fa_recup_dico("bdh_107");
$vl_c_bdh_108=fa_recup_dico("bdh_108");
$vl_c_bdh_109=fa_recup_dico("bdh_109");
$vl_c_bdh_110=fa_recup_dico("bdh_110");
$vl_c_bdh_111=fa_recup_dico("bdh_111");
$vl_c_bdh_112=fa_recup_dico("bdh_112");
$vl_c_bdh_113=fa_recup_dico("bdh_113");
$vl_c_bdh_114=fa_recup_dico("bdh_114");
$vl_c_bdh_115=fa_recup_dico("bdh_115");
$vl_c_bdh_116=fa_recup_dico("bdh_116");

$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_dico_00010=fa_recup_dico('dico_00010');
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_bouton_sup="";
$vl_c_message_alerte_actif="";
$vl_c_radiogroup_actif="<radiogroup id='rdg_tarif_actif'>";
if ($vl_e_tar_cleunik==0) {
  $vl_c_action=fa_recup_dico('dico_00002');
} else {
  $sql_req="select count(*) as nombre from _nomenclatures_fab where base_valorisation=$vl_e_tar_cleunik;";
  $result = _graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_e_nombre_utilisations=fa_ent_xml($row['nombre']);
  _graal_libere_requete_bd($result);
  if ($vl_e_nombre_utilisations==0) {  
    $vl_c_bouton_sup="<button width='40' flex='1' id='bt_supprimer' label='$vl_c_dico_00004' crop='end' dir='normal' oncommand='pf_validation(\"supprimer\")' />";
  } else {
    $vl_c_bouton_sup="<button flex='1' id='bt_cademplois' label='$vl_c_bdh_111' crop='end' dir='normal' oncommand='pf_casdemploinomenclatures();' />";
    $vl_c_radiogroup_actif="<radiogroup id='rdg_tarif_actif' oncommand='alert(\"$vl_c_bdh_112\")'>";
  }
  $vl_c_action=fa_recup_dico('dico_00003');
} 
//  On recherche les informations sur l'acteur 
if ($vl_e_act_cleunik!=-1){$vl_c_acteur=_graal_requete_acteur($vl_e_act_cleunik);}
//  On recherche les informations sur l'article 
if ($vl_e_art_cleunik!=-1){
  $ret=_graal_requete_article($vl_e_art_cleunik);
  $vl_c_code=$ret[0];
  $vl_c_mnemotechnique=$ret[1];
  $vl_c_description=$ret[2];
  $vl_c_nbdec_prix=$ret[3];
} else {
	$vl_c_nbdec_prix=2;
}
$vl_c_id_inc_acteurs_recherche="Div_00205";
$vl_c_inactif_acteurs_recherche='false';
$vl_c_qui_acteurs_recherche='06';

$vl_c_type_article_recherche="1";
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bdh_100" id="_win_fen_art_tarifs" titi="$vl_c_id_fenetre" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("js/_graal_art_tarifs_01.js.php");
include_once("js/_graal_01.js.php");
if ($vl_e_act_cleunik==-1){
  $vl_c_infos_adresses="true";$vl_c_infos_sitesweb="true";
  include("_graal_inc_acteurs_selection_01.php");
  $vl_c_id_vbox_inc_acteurs_01='aai_acteurs_01';
  $vl_c_id_arbre_inc_acteurs_01='arbre_des_acteurs';
$vl_c_id_arbre_inc_acteurs_01='arbre_des_acteurs';
  $vl_c_menucontext_01="pop_acteurs";
  	$vl_c_menucontext_arbre=<<<EOT
		<popupset>
			<popup id="pop_acteurs">
				<menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','$vl_c_id_arbre_inc_acteurs_01');" />
			</popup>
		</popupset>
EOT;
	echo($vl_c_menucontext_arbre);  
  include("_graal_inc_acteurs_01.php");
}
if ($vl_e_art_cleunik==-1){
echo('<vbox flex="2">');
include("js/_graal_articles_selection_01.js.php");
include("_graal_inc_articles_recherche_01.php");
$vl_c_id_vbox_inc_article_01='arbre_articles_01';
$vl_c_id_arbre_inc_article_01='arbre_des_articles';
include("_graal_inc_articles_recherche_01_bis.php");
echo('</vbox>');
}
if ($vl_e_act_cleunik==-1 || $vl_e_art_cleunik==-1) {echo ("<splitter />");}
echo <<<END
  <vbox flex="1">
  <groupbox id="groupe_acteur" >
    <caption><label value="$vl_c_bdh_101"/></caption>
    <textbox id="tb_acteur" value="$vl_c_acteur" disabled="true"/>
  </groupbox>
  <groupbox id="groupe_article">
    <caption><label value="$vl_c_bdh_102"/></caption>
    <hbox>
      <label value="$vl_c_bdh_103" />
      <textbox id="tb_code_art" value="$vl_c_code" disabled="true" />
      <label value="$vl_c_bdh_104" />
      <textbox id="tb_code_mnemotechnique" value="$vl_c_mnemotechnique" disabled="true" />
      <label value="$vl_c_bdh_105" />
      <textbox flex="2" id="tb_code_description" value="$vl_c_description" disabled="true" />
    </hbox>
  </groupbox>
  <groupbox >
    <caption><label value="$vl_c_bdh_106"/></caption>
    $ml_tarif
    <hbox>
     <label control="la_nb_dec" value="$vl_c_bdh_113"/>
     <textbox flex="1" id="tb_nb_dec" type="number" max="4" min="0" hidespinbuttons="true"   class="droite" onkeyup="pf_change_decimal_pu(this.value);"/>
		 
     <label control="la_prix_unitaire" value="$vl_c_bdh_107"/>
     <textbox flex="1" id="tb_prix_unitaire" type="number" hidespinbuttons="true" decimalplaces="2"   class="droite"/>
     <label control="la_unite_quantite" value="$vl_c_bdh_114"/>
     <textbox flex="1" id="tb_unite_quantite" type="number" hidespinbuttons="true" decimalplaces="2"   class="droite"/>
     <label control="la_quantite_basee" value="$vl_c_bdh_115"/>
     <textbox flex="1" id="tb_quantite_basse" type="number" hidespinbuttons="true" decimalplaces="0"   class="droite"/>
     <label control="la_quantite_haute" value="$vl_c_bdh_116"/>
     <textbox flex="1" id="tb_quantite_haute" type="number" hidespinbuttons="true" decimalplaces="0"   class="droite"/>
	</hbox>
	<hbox>
     

      <label control="la_dateheurevalidite" value="$vl_c_bdh_108"/>
      <hbox>
				<spacer flex="1"/>
				<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dateheurevalidite"/>
				<spacer flex="1"/>
			</hbox>                  
      <caption><label value="$vl_c_bdh_110" /></caption>
      $vl_c_radiogroup_actif
        <hbox>
          <radio observes="broadcaster_01" id='ra_actif_oui' label="$vl_c_dico_00013" value='1' />
          <spacer />
          <radio observes="broadcaster_01" id='ra_actif_non' label="$vl_c_dico_00014" value='2'/>
         </hbox>
       </radiogroup>
    </hbox> 
    <label control="la_blocnotebrut" value="$vl_c_bdh_109"/>
    <textbox flex="1" id="tb_blocnotebrut"   multiline="true"/>
   </groupbox>
  <hbox> 
    <button width="40" flex="1" id="bt_ajouter" label="$vl_c_action" crop="end" dir="normal" oncommand="pf_validation('enregistrer')" />
    $vl_c_bouton_sup
    <button width="40" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
  </hbox>
END;
  switch ($vl_c_origine) {
    case "article" :
      switch ($vl_e_type) {
        case 110000:  // tarifs entreprise
          switch ($vl_c_genre) {
            case 1 : include("_graal_inc_arbre_tarif_type_vente_01.php");break;// Ventes
            case 2 : include("_graal_inc_arbre_tarif_type_achat_01.php");break;// Achats  
          }
          break;
        case 110004: include("_graal_inc_arbre_tarif_particulier_achat_01.php");break;// tarifs particuliers fournisseur
        case 110003: include("_graal_inc_arbre_tarif_particulier_vente_01.php");break;// tarifs particuliers clients
      }
      break;
    case "acteur" :
      switch ($vl_e_type) {
        case 110004: $id_inc_tarifs_particuliers_fournis="Div_00445";$vl_b_toolbar_tarifs_particulier_achat="pasok";include("_graal_inc_arbre_tarif_particulier_achat_02.php");echo("</vbox>");break;// tarifs particuliers fournisseur
        case 110003: $id_inc_tarifs_particuliers_client="Div_00446";$vl_b_toolbar_tarifs_particulier_vente=="pasok";include("_graal_inc_arbre_tarif_particulier_vente_02.php");echo("</vbox>");break;// tarifs particuliers clients
      }
    break;

  }
echo <<<END
</vbox>
</window>
END;
?>
