<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_genre=fa_recup_param('genre','tousss');
$vl_c_type=fa_recup_param("type","0");
switch ($vl_c_genre){
	case "tousss":  //  Tous les articles
	switch ($vl_c_type){
		case "1":$vl_c_id_fenetre="Fen_01075";$vl_c_id_article_recherche="Div_00227";break;
		case "2":$vl_c_id_fenetre="Fen_01076";$vl_c_id_article_recherche="Div_00227";break;
		 default: fa_redirige("acces_interdit");break;
	}
	break;
	default: fa_redirige("acces_interdit");break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bsn_100=fa_recup_dico("bsn_100");
$vl_c_bsn_101=fa_recup_dico("bsn_101");
$vl_c_bsn_102=fa_recup_dico("bsn_102");
$vl_c_bsn_103=fa_recup_dico("bsn_103");
$vl_c_bsn_104=fa_recup_dico("bsn_104");
$vl_c_bsn_106=fa_recup_dico("bsn_106");
$vl_c_bsn_107=fa_recup_dico("bsn_107");
$vl_c_bsn_108=fa_recup_dico("bsn_108");
$vl_c_bsn_110=fa_recup_dico("bsn_110");
$vl_c_bsn_111=fa_recup_dico("bsn_111");
$vl_c_bsn_112=fa_recup_dico("bsn_112");
$vl_c_bsn_114=fa_recup_dico("bsn_114");
$vl_c_bsn_120=fa_recup_dico("bsn_120");
$vl_c_bsn_121=fa_recup_dico("bsn_121");
$vl_c_bsm_122=fa_recup_dico("bsm_122");
$vl_c_bsn_130=fa_recup_dico("bsn_130");
$vl_c_bsn_131=fa_recup_dico("bsn_131");
$vl_c_bsn_132=fa_recup_dico("bsn_132");
$vl_c_bsn_133=fa_recup_dico("bsn_133");
$vl_c_bsn_134=fa_recup_dico("bsn_134");
$vl_c_bsn_135=fa_recup_dico("bsn_135");
$vl_c_bsn_136=fa_recup_dico("bsn_136");
$vl_c_bsn_137=fa_recup_dico("bsn_137");
$vl_c_bsn_138=fa_recup_dico("bsn_138");
$vl_c_bsn_140=fa_recup_dico("bsn_140");
$vl_c_bsn_141=fa_recup_dico("bsn_141");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_dico_00149=fa_recup_dico('dico_00149');
$vl_c_dico00051=fa_recup_dico('dico_00051');
$vl_c_dico00052=fa_recup_dico('dico_00052');
$vl_c_dico00053=fa_recup_dico("dico_00053");
$vl_c_dico00054=fa_recup_dico('dico_00054');
$vl_c_dico00055=fa_recup_dico("dico_00055");
switch ($vl_c_type){
	case "1":$titre_col01=$vl_c_bsn_104;break;
	case "2":$titre_col01=$vl_c_bsn_122;break;
}
//$ml_genre_mouvement=fa_brik_menulist_choix('130X',1,-1,-1,'','ml_genre_mvt',true,-46);
//$ml_genre_mouvement=fa_brik_menulist_coche('130X',1,-1,-1,'','ml_genre_mvt',true,-46);
$ml_genre_mouvement=fa_brik_menulist_coche('130X',1,-1,-1,'','ml_genre_mvt',true,-1);
$vl_c_type_article_recherche="7";
$vl_c_menu_context="<popup id='pop_art'>";
$vl_c_menu_context.="<menuitem class='menuitem-iconic ad09' label='$vl_c_dico_00106' oncommand='fa_infos_colonnes_arbre_recup(\"$vl_c_id_fenetre\",\"arbre_des_articles\");'/><menuseparator />";
$vl_c_menu_context.="<menuitem class='menuitem-iconic ai07' label='$vl_c_bsn_108' oncommand='pf_ouvre(\"art\");' />";
$vl_tb_droits_mousto=_graal_requete_droits_fenetre("Fen_00565",$vl_e_uti_cleunik);
if ($vl_tb_droits_mousto[1]!=0){$vl_c_menu_context.="<menuitem class='menuitem-iconic ai07' label='$vl_c_bsn_107' oncommand='pf_ouvre(\"mousto\");' />";}
$vl_tb_droits_mousto=_graal_requete_droits_fenetre("Fen_00569",$vl_e_uti_cleunik);
if ($vl_tb_droits_mousto[0]!=0){$vl_c_menu_context.="<menuitem class='menuitem-iconic ai07' label='$vl_c_bsn_114' oncommand='pf_ouvre(\"mouvements\");' />";}
$vl_c_menu_context.=<<<EOT
<menuseparator/>
<menuitem label="$vl_c_dico00055" oncommand="pf_recup_sql('ods');" class="menuitem-iconic ac12"/>
  <menuitem label="$vl_c_dico00052" oncommand="pf_recup_sql('rdf');" class="menuitem-iconic ak02" collapsed="true"/>
  <menuitem label="$vl_c_dico00053" oncommand="pf_recup_sql('htm');" class="menuitem-iconic ak03"/>
  <menuitem label="$vl_c_dico00054" disabled="true" oncommand="pf_recup_sql('xml');" class="menuitem-iconic ak04"/>
  <menuseparator />
  <menuitem dir="reverse" label="$vl_c_dico00051" oncommand="pf_recup_sql('xls');" class="menuitem-iconic ak05"/>
EOT;
$vl_c_menu_context.="</popup>";
include("_graal_header_winxul.inc.php");
$vl_tc_composants=array($vl_c_id_article_recherche);
echo <<<END
<window context="graal_cp00"  _graal_genre="$vl_c_genre" title="$vl_c_bsn_100" id="_win_fen_articles_cumuls_mvts_01" onload="fa_aa(this);pf_aa_init()" $c_xmlns>
$vl_c_graal_cp00
$vl_c_menu_context
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_fen_articles_stockes_03.js.php");
include("js/_graal_articles_selection_01.js.php");
include("_graal_inc_articles_recherche_01.php");
echo <<<END

<vbox id="bbb_ove_01" >
<hbox flex="1">
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="mvtart_ml_type" oncommand="fa_approximatif_bbo()" class="normal" value="$vl_c_type" collapsed="true">
    <menupopup>
      <menuitem label="$vl_c_bsn_104" tooltiptext="$vl_c_bsn_104" value="1"/>
      <menuitem label="$vl_c_bsn_122" tooltiptext="$vl_c_bsn_118" value="2"/>
      <menuitem label="$vl_c_bsn_106" tooltiptext="$vl_c_bsn_119" value="1,2"/>
    </menupopup>
  </menulist>
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="mvtart_ml_nature" oncommand="fa_approximatif_bbo()" class="normal" value="1">
    <menupopup>
      <menuitem label="$vl_c_bsn_110" tooltiptext="$vl_c_bsn_110" value="1"/>
      <menuitem label="$vl_c_bsn_111" tooltiptext="$vl_c_bsn_111" value="2"/>
      <menuitem label="$vl_c_bsn_112" tooltiptext="$vl_c_bsn_112" value="3"/>
    </menupopup>
  </menulist>
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="mvtart_ml_date" oncommand="fa_approximatif_bbo()" class="normal" value="1">
    <menupopup>
      <menuitem label="$vl_c_bsn_120" tooltiptext="$vl_c_bsn_120" value="1"/>
      <menuitem label="$vl_c_bsn_121" tooltiptext="$vl_c_bsn_121" value="2"/>
    </menupopup>
  </menulist>
  $ml_genre_mouvement
END;
  $id_pref="";$id_deb="bbo_tb_deb";$id_fin="bbo_tb_fin";$trimestres="oui";include ("_graal_inc_choix_periodes_01.php");
echo <<<END
  </hbox>
</vbox>
  <vbox flex="100" class="overflow_01">
<tree id="arbre_des_articles" flex="1" flags="" ref="*" querytype="xml" datasources="" enableColumnDrag="true" context="pop_art">
    <treecols>
      <treecol id="mousto_tc_mvt_cleunik" label="$vl_c_bsn_130" sort="?mvt_cleunik"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="mousto_tc_art_cleunik" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="mousto_tc_uti_cleunik" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="mousto_tc_int_cleunik" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="code" sort="?code" label="$vl_c_bsn_101" /><splitter class="tree-splitter" resizeafter="grow"/>
	<treecol id="mnemotech" sort="?mnemotechnique" label="$vl_c_bsn_102" /><splitter class="tree-splitter" resizeafter="grow"/>
	<treecol id="art_cleunik"  hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
	<treecol id="description" sort="?description" label="$vl_c_bsn_103" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_dateheuremvt" label="$vl_c_bsn_131" sort="?dateheuremvt"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_dateheuresaisie" label="$vl_c_bsn_132" sort="?dateheuresaisie"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_qte_mvt" class="droite" label="$vl_c_bsn_133" sort="?val_volume"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_qte_pos" class="droite" label="$vl_c_bsn_134" sort="?qte_pos"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_type_mvt" label="$vl_c_bsn_135" sort="?type_mvt"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_pu_mvt" class="droite" label="$vl_c_bsn_136" sort="?pu_mvt"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_mt_mvt" class="droite" label="$vl_c_bsn_137" sort="?mt_mvt"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_depot" label="$vl_c_bsn_138" sort="?depot" hidden="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_empla" label="$vl_c_bsn_139" sort="?empla" hidden="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_genre" label="$vl_c_bsn_140" sort="?genre"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="mousto_tc_blocnotebrut" label="$vl_c_bsn_141" sort="?blocnotebrut"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="mousto_val_volume" /><splitter class="tree-splitter" resizeafter="grow"/>
    </treecols>
    <template><query expr="*"/><action>
      <treechildren>
        <treeitem uri="?" seltype="single">
          <treerow>
            <treecell label="?mvt_cleunik"/>
            <treecell label="?art_cleunik"/>
            <treecell label="?uti_cleunik"/>
            <treecell label="?int_cleunik"/>
            <treecell properties="?properties" label="?code" />
 			<treecell properties="?properties" label="?mnemotechnique"/>
 			<treecell properties="?properties" label="?art_cleunik"/>
 			<treecell properties="?properties" label="?description"/>
            <treecell label="?dateheuremvt"/>
            <treecell label="?dateheuresaisie"/>
            <treecell label="?volume"/>
            <treecell label="?qte_pos"/>
            <treecell label="?type_mvt"/>
            <treecell label="?pu_mvt"/>
            <treecell label="?mt_mvt"/>
            <treecell label="?depot"/>
            <treecell label="?empla"/>
            <treecell label="?genre"/>
            <treecell label="?blocnotebrut"/>
            <treecell label="?val_volume"/>
          </treerow>
        </treeitem>
      </treechildren>
    </action></template>
  </tree>
  </vbox>
 </window>
END;
?>
