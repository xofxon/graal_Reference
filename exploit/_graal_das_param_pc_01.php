<?php
include("_graal_header_xml.inc.php");
$vl_c_oui=fa_recup_dico("dico_00013");
$vl_c_non=fa_recup_dico("dico_00014");
$vl_c_type=fa_recup_param('vl_c_type','1');
$vl_c_recherche=fa_recup_param('vl_c_recherche','%');
$vl_c_limit=fa_recup_param('vl_c_limit','');
switch ($vl_c_type) {
	case "1":$vl_c_condition=" where code like '$vl_c_recherche%'";break;
	case "2":$vl_c_condition=" where intitule like '$vl_c_recherche%'";break;
}
if ($vl_c_limit!=""){
	$vl_c_condition.=" LIMIT $vl_c_limit";
}
$sql_req="SELECT `pc_cleunik` as `pc_cleunik`,`code` as `code`,`intitule` as `intitule`,`dateheuremodification` as `dateheuremodification`,`dateheurecreation` as `dateheurecreation`,
case actif WHEN 1 THEN '$vl_c_oui' ELSE '$vl_c_non' END AS actif FROM _param_pc $vl_c_condition";
//echo $sql_req;
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' pc_cleunik="'.fa_ent_xml($row['pc_cleunik']).'"');
  echo(' code="'.fa_ent_xml($row['code']).'"');
  echo(' intitule="'.fa_ent_xml($row['intitule']).'"');
  echo(' dateheuremodification="'.fa_ent_xml($row['dateheuremodification']).'"');
  echo(' dateheurecreation="'.fa_ent_xml($row['dateheurecreation']).'"');
  echo(' actif="'.fa_ent_xml($row['actif']).'"');
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
