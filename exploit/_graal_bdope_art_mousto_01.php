<?php
define('EOL', "\r\n");
include("_graal_header_txt.inc.php");
include("_graal_fonctions_mousto.php");
$vl_mousto_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_mousto_int_cleunik=intval(fa_recup_session('vs_int_cleunik','0'));

$vl_nature=fa_recup_param('vl_nature','normal');
switch ($vl_nature){
	case "normal":
		$vl_mousto_art_cleunik=intval(fa_recup_param('vl_art_cleunik','0'));
		$vl_mousto_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
		$vl_mousto_date_mvt=fa_recup_param("vl_date_mvt","");
		$vl_mousto_choix_depot=intval(fa_recup_param('vl_choix_depot','0'));
		$vl_mousto_choix_empla=intval(fa_recup_param('vl_choix_empla','0'));
		$vl_mousto_qte_mvt=fa_floatval(fa_recup_param("vl_qte_mvt",""));
		$vl_mousto_pu_mvt=fa_floatval(fa_recup_param("vl_pu_mvt",""));
		$vl_mousto_genre_mvt=intval(fa_recup_param('vl_genre_mvt','0'));
		$vl_mousto_type_mvt=intval(fa_recup_param('vl_type_mvt','0'));
		//$vl_mousto_unite_mvt=fa_recup_param("vl_unite_mvt","");
		$deb_trans=_graal_requete_bd("START TRANSACTION;");
		$vl_mousto_mvt_cleunik=fa_mousto_ajout();
		if ($vl_mousto_mvt_cleunik==-1) {
		  _graal_requete_bd("ROLLBACK;");
		  echo 'La transaction de stock a échoué.';
		} else {
		  _graal_requete_bd("COMMIT;");
		  echo 'La transaction de stock a été correctement enregistrée.';
		}
		break;
	case "cession":
		$vl_mousto_art_cleunik=intval(fa_recup_param('vl_art_cleunik','0'));
		$vl_mousto_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
		$vl_mousto_date_mvt=fa_recup_param("vl_date_mvt","");
		$vl_mousto_qte_mvt=fa_floatval(fa_recup_param("vl_qte_mvt",""));
		$vl_mousto_genre_mvt=intval(fa_recup_param('vl_genre_mvt','0'));
		$vl_mousto_pu_mvt=fa_floatval(fa_recup_param("vl_pu_mvt",""));
		// origine
		$vl_mousto_choix_depot_ori=intval(fa_recup_param('vl_choix_depot_ori','0'));
		$vl_mousto_choix_empla_ori=intval(fa_recup_param('vl_choix_empla_ori','0'));
		$vl_mousto_type_mvt_ori=intval(fa_recup_param('vl_type_mvt_ori','0'));
		
		$vl_mousto_choix_depot=$vl_mousto_choix_depot_ori;
		$vl_mousto_choix_empla=$vl_mousto_choix_empla_ori;
		$vl_mousto_type_mvt=$vl_mousto_type_mvt_ori;
		$vl_mousto_mvt_cleunik=fa_mousto_ajout();
		//	destination
		$vl_mousto_choix_depot_des=intval(fa_recup_param('vl_choix_depot_des','0'));
		$vl_mousto_choix_empla_des=intval(fa_recup_param('vl_choix_empla_des','0'));
		$vl_mousto_type_mvt_des=intval(fa_recup_param('vl_type_mvt_des','0'));
		$vl_mousto_choix_depot=$vl_mousto_choix_depot_des;
		$vl_mousto_choix_empla=$vl_mousto_choix_empla_des;
		$vl_mousto_type_mvt=$vl_mousto_type_mvt_des;
		$vl_mousto_mvt_cleunik=fa_mousto_ajout();
		break;
}
?>
