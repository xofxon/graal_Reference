<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_e_interlo_cleunik=intval(fa_recup_param("vl_e_interlo_cleunik","-1"));
$vl_e_intweb_cleunik=intval(fa_recup_param("vl_e_intweb_cleunik","-1"));
$vl_c_refweb=fa_recup_param('refweb','');
switch ($vl_c_genreacteur){
  case "110000": $vl_c_id_fenetre="Fen_00162";$vl_e_choix_portee="01";break;  //  Adresses courriels des interlocuteurs des Membres de l'entreprise
  case "110001": $vl_c_id_fenetre="Fen_00163";$vl_e_choix_portee="02";break;  //  adresses courriels des interlocuteurs prospects clients
  case "110002": $vl_c_id_fenetre="Fen_00164";$vl_e_choix_portee="08";break;  //  adresses courriels des interlocuteurs prospects fournisseurs
  case "110003": $vl_c_id_fenetre="Fen_00165";$vl_e_choix_portee="04";break;  //  adresses courriels des interlocuteurs clients
  case "110004": $vl_c_id_fenetre="Fen_00166";$vl_e_choix_portee="16";break;  //  adresses courriels des interlocuteurs fournisseurs
  case "110005": $vl_c_id_fenetre="Fen_00167";$vl_e_choix_portee="32";break;  //  adresses courriels des interlocuteurs autres acteurs
  case "110006": $vl_c_id_fenetre="Fen_00168";$vl_e_choix_portee="64";break;  //  adresses courriels des interlocuteurs acteurs indéterminés
  default:
    fa_redirige("acces_interdit");  
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=0;$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_aal_100=fa_recup_dico("aal_100");
$vl_c_aal_101=fa_recup_dico("aal_101");
$vl_c_aal_102=fa_recup_dico("aal_102");
$vl_c_aal_103=fa_recup_dico("aal_103");
$vl_c_aal_104=fa_recup_dico("aal_104");
$vl_c_aal_105=fa_recup_dico("aal_105");
$vl_c_aal_106=fa_recup_dico("aal_106");
$vl_c_aal_107=fa_recup_dico("aal_107");

//$vl_c_aal_107="toto";

$vl_c_aal_108=fa_recup_dico("aal_108");
$vl_c_aal_109=fa_recup_dico("aal_109");
$vl_c_aal_110=fa_recup_dico("aal_110");
$vl_c_aal_111=fa_recup_dico("aal_111");
$vl_c_aal_112=fa_recup_dico("aal_112");
$vl_c_aal_113=fa_recup_dico("aal_113");
$vl_c_aal_114=fa_recup_dico("aal_114");
$vl_c_aal_115=fa_recup_dico("aal_115");
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00028=fa_recup_dico("dico_00028");
//  On recherche l'interlocuteur à partir de l'adresse courriel
if ($vl_e_intweb_cleunik!=-1){
  $sql_req="SELECT _act_interlo_mail.int_cleunik as int_cleunik FROM _act_interlo_mail where _act_interlo_mail.intweb_cleunik=$vl_e_intweb_cleunik;"; 
  $result=_graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_e_interlo_cleunik=$row['int_cleunik'];
  _graal_libere_requete_bd($result);
}
//  On recherche les informations sur l'acteur et l'interlocuteur 
if ($vl_e_interlo_cleunik!=-1){
  $vl_c_tab=_graal_requete_interlo($vl_e_interlo_cleunik);
  $vl_c_qui=$vl_c_tab[0];
  $vl_e_act_cleunik=$vl_c_tab[1];
}
$ml_mail=fa_brik_menulist_choix(84,1,$vl_e_choix_portee,1,'','ml_mail_00',"broadcaster_01",-11);
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
//$c_id_windows=""; 
echo <<<END
<window context="graal_cp00" title="$vl_c_aal_100" id="$c_id_windows" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_03.js.php");
include("js/_graal_act_interlo_mail_01.js.php");
echo <<<END
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
    <vbox flex="1" class="overflow_01">
  
  <description>$vl_c_qui</description>
  <grid flex="1">
    <columns flex="1">
      <column/>
      <column flex="1"/>
    </columns>
    <rows flex="1">
      <row flex= "1">
        <label control="la_prefixe_choix_cleunik" value="$vl_c_aal_105"/>
        $ml_mail
     </row>
      <row flex= "1">
      <label control="la_refweb" value="$vl_c_aal_101"/>
			
			<hbox flex= "1">
					<textbox observes="broadcaster_01" flex= "30" id="tb_refweb"  />
        	<button observes="broadcaster_01" flex= "1" class="aa04" id="tb_courriel_verif_deja" tooltiptext="$vl_c_aal_113" label="$vl_c_aal_113" oncommand="pf_verifie_deja_refweb();"/>
	      </hbox>
      </row>
      <row flex= "1">
        <label control="la_infodefaut" value="$vl_c_aal_104"/>
        <radiogroup id='rdg_actif' flex="1" name='name'>
          <hbox>
            <radio observes="broadcaster_01" id='ra_choix_actif_oui' label="$vl_c_dico_00013" value='1' />
            <radio observes="broadcaster_01" id='ra_choix_actif_non' label="$vl_c_dico_00014" value='2'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row flex= "1">
        <label control="la_dateheuremodif" value="$vl_c_aal_102"/>
        <label id="tb_dateheuremodif" />
      </row>
      <row flex= "1">
				<raf></raf>
        <groupbox><caption><label control="la_valide" value="$vl_c_aal_107"/></caption>
        <radiogroup id='rdg_veuxpasdemail' flex="1">
          <hbox>
            <radio class="ak16" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdemail_oui' label="$vl_c_dico_00013" value='1' />
            <radio class="ak17" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdemail_non' label="$vl_c_dico_00014" value='2'/>
            <radio class="ak18" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdemail_nsp' label="$vl_c_dico_00028" value='3'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
				</groupbox>
      </row>
      <row flex= "1">
				<raf></raf>
        <groupbox><caption><label control="la_valide" value="$vl_c_aal_109"/></caption>
				<radiogroup id='rdg_valide' flex="1">
          <hbox>
            <radio class="af16" dir="reverse" observes="broadcaster_01" id='ra_valide_oui' label="$vl_c_dico_00013" value='1' />
            <radio class="ae15" dir="reverse" observes="broadcaster_01" id='ra_valide_non' label="$vl_c_dico_00014" value='2'/>
            <radio class="af15" dir="reverse" observes="broadcaster_01" id='ra_valide_nsp' label="$vl_c_dico_00028" value='3'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
				 </groupbox>
      </row>
      <row flex= "1">
        <label control="la_dateheureverification" value="$vl_c_aal_111"/>
        <hbox flex= "1">
					<label value="" id="tb_dateheureverification" /><label collapsed="true" value="" id="la_dateverification" /><label collapsed="true" value="" id="la_heurverification" />
        	<toolbarbutton observes="broadcaster_01" flex= "1" class="aj18" id="tb_courriel_01" tooltiptext="$vl_c_aal_110" label="$vl_c_aal_110" oncommand="pf_verifie();"/>
	      </hbox>
      </row>
      <row flex= "1">
        <label control="la_cr_verification" value="$vl_c_aal_112" flex="1"/>
        <textbox readonly="true" class="extensible" id="tb_cr_verification" rows="5" flex="1"/>
      </row>
      <row flex= "30">
        <label control="la_blocnotebrut" value="$vl_c_aal_103" flex="1"/>
        <textbox observes="broadcaster_01" id="tb_blocnotebrut" flex="1"  multiline="true"/>
      </row>
    </rows>
  </grid>
  <hbox flex="0" id="boutons_standards"> 
END;
include("_graal_inc_boutons_01.php");
echo <<<END
</hbox>
</vbox>
</window>
END;
?>
