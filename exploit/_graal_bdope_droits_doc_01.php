<?php 
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_droits_01";
$t_origines_ok[1]="_graal_fen_ged_03";
fa_acces_script();
$vf_c_action=fa_recup_param('vf_c_action','??????');
$vl_e_uti_cleunik =intval(fa_recup_param('vl_e_uti_cleunik','0')); 
$vl_e_doc_cleunik=intval(fa_recup_param('vl_e_doc_cleunik','0'));
$vl_e_droits_proprio=intval(fa_recup_param('vl_e_droits_proprio','15'));
$genre_droits=fa_recup_param('genre_droits','raf');
$vf_c_echo=$vf_c_action;
switch (TRUE) {
  case $vf_c_action=='??????':
    exit;
    break;    
  case $vf_c_action=='supprimer': 
    $sql_req = "DELETE FROM _droits_doc WHERE doc_cleunik=$vl_e_doc_cleunik AND uti_cleunik=$vl_e_uti_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
  case $vf_c_action=='ajouter':
    /* 1 -> Propriétaire, 2 -> Lecture, 4 -> Modification -> 8 -> Suppression */
    $droits_groupe=0;
    $droits_lambda=0;
    $sql_req = "INSERT INTO _droits_doc set doc_cleunik=$vl_e_doc_cleunik,uti_cleunik=$vl_e_uti_cleunik,droits_proprio=$vl_e_droits_proprio,droits_groupe=$droits_groupe,droits_lambda =$droits_lambda" ;
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
  case $vf_c_action=='modifier':
    $sql_req = "update _droits_doc set droits_proprio=$vl_e_droits_proprio where doc_cleunik=$vl_e_doc_cleunik AND uti_cleunik=$vl_e_uti_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
	case $vf_c_action=="ajouter_droits_kilometres":	// Ajout des droits au kilomètre
		$vl_t_listecles=fa_recup_param("vl_t_listecles","");
		$vl_t_listecles=unserialize(stripslashes($vl_t_listecles));
		$vl_e_i=-1;
    $droits_groupe=0;
    $droits_lambda=0;
    foreach($vl_t_listecles as $vl_raf) {
      $vl_e_i++;
      $vl_e_doc_cleunik=$vl_t_listecles[$vl_e_i];
			switch ($genre_droits){
				case "droits":
					$sql_req = "INSERT INTO _droits_doc set doc_cleunik=$vl_e_doc_cleunik,uti_cleunik=$vl_e_uti_cleunik,droits_proprio=$vl_e_droits_proprio,droits_groupe=$droits_groupe,droits_lambda =$droits_lambda;";
					break;
				case "blancs":
					$sql_req = "INSERT INTO _doc_blanc set doc_cleunik=$vl_e_doc_cleunik,uti_cleunik=$vl_e_uti_cleunik;";
					break;
				case "noires":
					$sql_req = "INSERT INTO _doc_noire set doc_cleunik=$vl_e_doc_cleunik,uti_cleunik=$vl_e_uti_cleunik;";
					break;
			}
    	$vf_c_echo=_graal_exec_requete($sql_req);
    }
		break;
	case $vf_c_action=="supprimer_droits_kilometres":	// Suppression des droits au kilomètre	
		$vl_t_listecles=fa_recup_param("vl_t_listecles","");
		$vl_t_listecles=unserialize(stripslashes($vl_t_listecles));
		$vl_e_i=-1;
    $sql_condition="";
    foreach($vl_t_listecles as $vl_raf) {
      $vl_e_i++;
      $vl_e_doc_cleunik=$vl_t_listecles[$vl_e_i];
			if ($vl_e_i==0) {$sql_condition.= "$vl_e_doc_cleunik";} else {$sql_condition.= ",$vl_e_doc_cleunik";};
    }
		switch ($genre_droits){
			case "droits":
				$sql_req = "delete from _droits_doc where doc_cleunik in($sql_condition);";
				break;
			case "blancs":
				$sql_req = "delete from _doc_blanc where doc_cleunik in($sql_condition);";
				break;
			case "noires":
				$sql_req = "delete from _doc_noire where doc_cleunik in($sql_condition);";
				break;
		}
  	$vf_c_echo=_graal_exec_requete($sql_req);
		break;
} 
_graal_ferme_connexion();
//echo "-".$genre_droits."-".$vf_c_echo;
//echo $sql_req;
echo $vf_c_echo;
?>
