<?php
include("_graal_header_pdf_02.inc.php");
include("_graal_var_portee.php");
include("_graal_fonctions_numerotation.php");
include("_graal_htbrutremise_inc.php");// contient la variable $sql_htbrutremise
include("_graal_fonctions_documents.php");
include("_graal_fonctions_documents_ciaux.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_commercial_cleunik=intval(fa_recup_param("vl_commercial_cleunik","0"));
$vl_e_action_cleunik=intval(fa_recup_param("vl_e_action_cleunik","0"));
$genre_adresse=intval(fa_recup_param("vl_genre_adresse","1"));  // 1-> adresse de livraison, 2 adresse de facturation 
if ($vl_commercial_cleunik==0) {fa_redirige("acces_interdit");}
$param_generaux_graal_138=intval(fa_recup_session('vs_param_generaux_graal_138',2)); //  1->mémoriser le pdf dans le fichier, 2->ne pas le mémoriser dans le fichier
$param_generaux_graal_141=intval(fa_recup_session('vs_param_generaux_graal_141',-1)); //  Logo sur la première page d'édition
$param_generaux_graal_142=intval(fa_recup_session('vs_param_generaux_graal_142',-1)); //  Logo sur les autres pages d'adition
$param_generaux_graal_143=intval(fa_recup_session('vs_param_generaux_graal_143',0)); //  Largeur logo première page
$param_generaux_graal_144=intval(fa_recup_session('vs_param_generaux_graal_144',0)); //  Hauteur logo première page
$param_generaux_graal_145=intval(fa_recup_session('vs_param_generaux_graal_145',0)); //  Largeur logo autres pages
$param_generaux_graal_146=intval(fa_recup_session('vs_param_generaux_graal_146',0)); //  Hauteur logo autres pages

$vl_c_fic_ligne="_facfou_lignes";
$vl_c_fic_qte="_facfou_lignes_qte";
$vl_c_fic_entete="_facfou_entetes";
$vl_e_fic_adresses="_facfou_adresses";
$vl_c_id_fenetre="Edi_00030";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);
$vl_b_acces=$vl_tb_droits[0];
if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);





$vl_c_dico_00058=fa_recup_dico("dico_00058");
$police_du_document="FreeSerif";	// Il faut intégrer la police : 819.5 Ko
$police_du_document="Courier";		//	Police non intégrée : 3.6 Ko
$police_du_document="times";		//	Police non intégrée : 3.5 Ko	Pas de différence visuelle avec FreeSerif
$police_du_document="Helvetica";		//	Police non intégrée : 3.5 Ko	Pas de différence visuelle avec FreeSerif
$genreaction="facfou";
$genreregroupement="initial";
include("_graal_req_docial_recap_montants.inc.php");
require_once('_graal_pdf_bloc_001.php');
define('EOL', "\r\n");
class pseudo extends _graal_TCPDF {
function Header() {}
}
class toto extends _graal_TCPDF {
// private variables
var $contenu_code;
var $contenu_nom_commercial;
var $contenu_dateexp;
var $contenu_code_bondepreparation;
var $impression_cgv;
var $police_du_document;
function Header() {
	global $vl_c_fic_entete;
  global $vl_commercial_cleunik;
  global $genre_adresse;
  global $action_cleunik;
  global $datecre;
  global $dateliv;
  global $codealphnaum15_seul;
  global $description_reg;
  global $vosreferences;
  global $blocnotebrut_entete;
  global $y;
  global $cols;
  global $format;
  global $nbligne_montant_pied;
  global $hauteur_blocnote_pied;
  global $ybas_tableau;
  global $blocnotebrut_pied;
  global $position_pied;
  global $position_debut_lignes;
	global $raisonsoc;
	global $vl_e_fic_adresses;
	global $param_generaux_graal_141;
	global $param_generaux_graal_143;	
	global $param_generaux_graal_144;
	global $vl_c_bvj_119;

	$vl_c_bvj_101=fa_recup_dico("bvj_101");$vl_c_bvj_101="Adresse";
	$vl_c_bvj_102=fa_recup_dico("bvj_102");$vl_c_bvj_102="82300 SAINT CIRQ";
	$vl_c_bvj_103=fa_recup_dico("bvj_103");$vl_c_bvj_103="FRANCE";
	$vl_c_bvj_104=fa_recup_dico("bvj_104");$vl_c_bvj_104="33 5 63 63 94 69";	// Téléphone
	$vl_c_bvj_105=fa_recup_dico("bvj_105");$vl_c_bvj_105="33 5 47 74 50 81";	//	Fax
	$vl_c_bvj_106=fa_recup_dico("bvj_106");$vl_c_bvj_106="";
	$vl_c_bvj_107=fa_recup_dico("bvj_107");$vl_c_bvj_107="www.francelampes.com";
	$vl_c_bvj_108=fa_recup_dico("bvj_108");$vl_c_bvj_108="info@francelampes.com";
	$vl_c_bvj_109=fa_recup_dico("bvj_109");$vl_c_bvj_109="FACTURE FOURNISSEUR";
	$vl_c_bvj_110=fa_recup_dico("bvj_110");$vl_c_bvj_110="SUPPLIER INVOICE";
	
	$vl_c_bvj_111=fa_recup_dico("bvj_111");$vl_c_bvj_111="N° ";
	$vl_c_bvj_112=fa_recup_dico("bvj_112");$vl_c_bvj_112="Date : ";
	$vl_c_bvj_113=fa_recup_dico("bvj_113");$vl_c_bvj_113="Facture fournisseur";
	$vl_c_bvj_114=fa_recup_dico("bvj_114");$vl_c_bvj_114="Mode de règlement: ";
	$vl_c_bvj_115=fa_recup_dico("bvj_115");$vl_c_bvj_115="Livraison";
	$vl_c_bvj_116=fa_recup_dico("bvj_116");$vl_c_bvj_116="A l'attention de :";
	$vl_c_bvj_117=fa_recup_dico("bvj_117");$vl_c_bvj_117="Compte fournisseur :";
	$vl_c_bvj_118=fa_recup_dico("bvj_118");$vl_c_bvj_118="Email :";
	
	$vl_c_bvj_122=fa_recup_dico("bvj_122");$vl_c_bvj_122="Adresse de livraison / Delivry adress";
	$vl_c_bvj_123=fa_recup_dico("bvj_123");$vl_c_bvj_123="Adresse de facturation / Billing adress";
	$vl_c_bvj_124=fa_recup_dico("bvj_124");$vl_c_bvj_124="Responsable des achats : Mr Menin";
	$vl_c_bvj_145=fa_recup_dico("bvj_145");$vl_c_bvj_145="Si la commande ne peut-être livrée complète, veuillez nous le faire savoir ainsi que les délais des différents reliquats occasionnés.";
	
	$vl_c_bvj_101=fa_recup_dico_telquel("bvj_101");
	$vl_c_bvj_102=fa_recup_dico_telquel("bvj_102");
	$vl_c_bvj_103=fa_recup_dico_telquel("bvj_103");
	$vl_c_bvj_104=fa_recup_dico_telquel("bvj_104");
	$vl_c_bvj_105=fa_recup_dico_telquel("bvj_105");
	$vl_c_bvj_106=fa_recup_dico_telquel("bvj_106");
	$vl_c_bvj_107=fa_recup_dico_telquel("bvj_107");
	$vl_c_bvj_108=fa_recup_dico_telquel("bvj_108");
	$vl_c_bvj_109=fa_recup_dico_telquel("bvj_109");
	$vl_c_bvj_110=fa_recup_dico_telquel("bvj_110");
	
	$vl_c_bvj_111=fa_recup_dico_telquel("bvj_111");
	$vl_c_bvj_112=fa_recup_dico_telquel("bvj_112");
	$vl_c_bvj_113=fa_recup_dico_telquel("bvj_113");
	$vl_c_bvj_114=fa_recup_dico_telquel("bvj_114");
	$vl_c_bvj_115=fa_recup_dico_telquel("bvj_115");
	$vl_c_bvj_116=fa_recup_dico_telquel("bvj_116");
	$vl_c_bvj_117=fa_recup_dico_telquel("bvj_117");
	$vl_c_bvj_118=fa_recup_dico_telquel("bvj_118");
	$vl_c_bvj_122=fa_recup_dico_telquel("bvj_122");
	$vl_c_bvj_123=fa_recup_dico_telquel("bvj_123");
	$vl_c_bvj_124=fa_recup_dico_telquel("bvj_124");
	$vl_c_bvj_145=fa_recup_dico_telquel("bvj_145");
	
		
  switch ($this->getPage()) {
    case 1:
    default:
    	$this->SetFont( $this->police_du_document, "",9);
    	//$this->SetXY(1,1);$this->Cell(0,4,$position_pied, 0, 0, "L");//	Conserver pour débugage
    	
		$this->_graal_logo($param_generaux_graal_141,10,6,$param_generaux_graal_143,$param_generaux_graal_144);
      $this->SetFont( $this->police_du_document, "",4);
      $length = $this->GetStringWidth( $vl_c_bvj_119 );
      $y=30;
		$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_119,0,'L');$y+=4;
		$this->SetFont( $this->police_du_document, "",9);
        $length = $this->GetStringWidth( $vl_c_bvj_119 );
		$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_122,0,'L');$y+=4;
		$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_101,0,'L');$y+=4;
		$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_102,0,'L');$y+=4;
		$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_103,0,'L');
	  $y=30;
		$this->SetXY(110,$y);$this->MultiCell(0, 4, $vl_c_bvj_123,0,'L');$y+=4;
		$this->SetXY(110,$y);$this->MultiCell(0, 4, $vl_c_bvj_101,0,'L');$y+=4;
		$this->SetXY(110,$y);$this->MultiCell(0, 4, $vl_c_bvj_102,0,'L');$y+=4;
		$x=110;
		$this->Image('css/telephone.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $vl_c_bvj_104 );
		$this->Cell( $length, 2, $vl_c_bvj_104);
		$x+=$length+2;
		$this->Image('css/fax.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $vl_c_bvj_105 );
		$this->Cell( $length, 2, $vl_c_bvj_105);
		$x+=$length+2;
		
	  $y=10;
      $this->SetXY(130,$y);
      $this->SetFont( $this->police_du_document, "B",12);
      $length = $this->GetStringWidth( $vl_c_bvj_109 );
      $this->SetXY(130,$y);$this->Cell($length,4, $vl_c_bvj_109, 0, 0, "L");$y+=5;
      $this->SetFont( $this->police_du_document, "BI",12);
      $length = $this->GetStringWidth( $vl_c_bvj_110 );
      $this->SetXY(130,$y);$this->Cell($length,4, $vl_c_bvj_110, 0, 0, "L");$y+=5;
      $this->SetFont( $this->police_du_document, "B",10);
      $this->SetXY(130,$y);$this->MultiCell(0, 4, $vl_c_bvj_111.$this->contenu_code,0,'L');$y+=5;
      $this->SetFont( $this->police_du_document, "",9);
      $this->SetXY(130,$y);$this->MultiCell(0, 4, $vl_c_bvj_112.$datecre,0,'L');$y+=5;
      
      $this->SetFont( $this->police_du_document, "B",12);
      
      
      
      $this->_graal_pdf_cadre_00("",$colonne=10,$ligne=55,$largeur=95,$hauteur=30,'1111');
      $this->SetLineStyle(array("width" => 0.25, "cap" => "butt", "join" => "miter", "dash" => 0, "color" => array(0, 0, 0)));
      
      /*
	   * Recherche interlocuteur privilégié du document et ses coordonnées
	   */
	$interlo_privilegie=-110424;
	$int_cleunik=-1;
  $sql_req ="SELECT concat_ws(' ',a3.choix_valeur_texte_01,a2.prenom,a2.patronyme) as qui,a1.principal,a2.int_cleunik FROM _graal a1 left join _act_interlo a2 using(int_cleunik) ";
  $sql_req.=" left join _choix a3 on a3.choix_cleunik=a2.choix_cleunik where a1.action_cleunik=$action_cleunik and a1.choix_cleunik=$interlo_privilegie;";
  $result = _graal_requete_bd($sql_req);
  if (mysql_num_rows($result) == 0) {
  	_graal_libere_requete_bd($result);
  	$sql_req=" SELECT concat_ws(' ',a3.choix_valeur_texte_01,a2.prenom,a2.patronyme) as qui,a2.int_cleunik FROM $vl_c_fic_entete a4 left join _acteurs a5 using(act_cleunik)";
  	$sql_req.=" left join _act_interlo a2 using(act_cleunik) left join _choix a3 on a3.choix_cleunik=a2.choix_cleunik where a4.action_cleunik=$action_cleunik";
  	
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $qui="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$qui=fa_ent_xml($row['qui']);
    	$int_cleunik=$row['int_cleunik'];
  	}
  } else {
    $row = mysql_fetch_assoc($result);
    $qui=fa_ent_xml($row['qui']);
    $int_cleunik=$row['int_cleunik'];
  }
  _graal_libere_requete_bd($result);
      
      
      
	  
  	$sql_req=" select telformate from _act_interlo_tel where int_cleunik=$int_cleunik and portable=1;";
  	
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $tel="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$tel=fa_ent_xml($row['telformate']);
  	}
    _graal_libere_requete_bd($result);
    $sql_req=" select telformate from _act_interlo_fax where int_cleunik=$int_cleunik;";
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $fax="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$fax=fa_ent_xml($row['telformate']);
  	}
    _graal_libere_requete_bd($result);
    
    $x=12;
  		$y=55;
      $this->SetXY(10,$y);
      $this->SetFont( $this->police_du_document, "",9);
  	
  	$this->SetXY($x,$y);$this->MultiCell(0, 4, $vl_c_bvj_116.$qui,0,'L');$y+=10;
    if (trim($tel)!=""){
	 	$this->Image('css/telephone.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $tel );
		$this->Cell( $length, 2, $tel);
		$x+=$length+2;
    }
    
  if (trim($fax)!=""){
	 	$this->Image('css/fax.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $fax );
		$this->Cell( $length, 2, $fax);
		$x+=$length+2;
    }
    $x=12;
    $y+=10;
    $this->SetXY($x,$y);
    $this->MultiCell(0, 4, $vl_c_bvj_114.$description_reg,0,'L');$y+=5;
    $this->SetXY($x,$y);
    $this->MultiCell(0, 4, $vl_c_bvj_124,0,'L');$y+=5;
      /*
       * On recherche l'adresse de facturation
       */
	  $sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&2";
	  $result = _graal_requete_bd($sql_req);
	  if (mysql_num_rows($result) == 0){
		//	On recherche l'adresse de livraison si l'on a pas trouvé l'adresse de facturation
	  	$sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&1;";
	  	$result = _graal_requete_bd($sql_req);
	  }
	  $row = mysql_fetch_assoc($result);
	  $adresse="";
	  if (trim($row['adr_nom'])!="") {$adresse.=$row['adr_nom'].EOL;}
  	  if (trim($row['adr_complementnom'])!="") {
	  	if($qui!=$row['adr_complementnom']) {
	  		$adresse.=$row['adr_complementnom'].EOL;
	  	}
	  }
	  if (trim($row['adr_ligne1'])!="") {$adresse.=$row['adr_ligne1'].EOL;}
	  if (trim($row['adr_ligne2'])!="") {$adresse.=$row['adr_ligne2'].EOL;}
	  if (trim($row['adr_ligne3'])!="") {$adresse.=$row['adr_ligne3'].EOL;}
	  if (trim($row['adr_cp'].$row['adr_ville'])!="") {$adresse.=$row['adr_cp']." ".$row['adr_ville'].EOL;}
      if (trim($row['pays'])!="") {$adresse.=$row['pays'].EOL;}
	  
	  _graal_libere_requete_bd($result);
	  $this->SetXY(120,55);
	  $this->MultiCell(0, 4, $adresse,0,'L');
      $y+=5;
      
  $this->SetFont($this->police_du_document, "B",11);
  $this->SetXY(10,90);
  $this->SetFont($this->police_du_document, "B",9);
  $length = $this->GetStringWidth( $vl_c_bvj_145 );
  $this->MultiCell($length, 4, $vl_c_bvj_145,0,"C");
  $this->MultiCell(0, 4, $blocnotebrut_entete,0,"L");
  //  Entête du tableau
  $this->SetFont($this->police_du_document, "",9);
  $y=$this->GetY();
  $position_debut_lignes=round($y+10,0);
  //$this->SetXY(10,1);$this->Cell(0,4,$position_debut_lignes, 0, 0, "L");//	Conserver pour débugage
  $this->addCols_01( $cols,$xyz=array("10",$y,30+$hauteur_blocnote_pied));
  $this->addLineFormat_00($format,$cols);
  //$this->SetY($y+10);
  //$y=$this->GetY();
  $this->SetY($position_debut_lignes);
  $y=$position_debut_lignes;
  $ybas_tableau=$this->h - ($this->h-$position_pied);
  //$blocnotebrut_pied=$this->h."-".$position_pied."-".$hauteur_blocnote_pied."-".$ybas_tableau;
      break;
    
  }
}
}
$sql_req ="SELECT f1.blocnotebrut,f1.code_interne,f1.mnemotechnique_interne as z06,f1.description_interne,f4.qte,f4.qte_nbdec,f4.qte_unite as z10,f1.pu as pu,";
$sql_req.=" f1.pu_type as z12,f1.nbdec_pu,f1.remise_taux,f2.choix_valeur_texte_01 as z17,f3.choix_valeur_texte_01 as z18,f1.typeligne as z19,f1.coef_facture as coef_facture,";
$sql_req.=" f1.code_acteur,f1.description_acteur,";
$sql_req.=" f1.remise_genr,f1.remise_natu,f1.remise_type,$sql_htbrutremise,f5.code,f6.code as code_tpf from $vl_c_fic_ligne f1,_choix f2,_choix f3,$vl_c_fic_qte f4,";
$sql_req.=" _param_taxes f5, _param_tpf f6 WHERE commercial_cleunik=$vl_commercial_cleunik and f1.commercial_ligne_cleunik=f4.commercial_ligne_cleunik";
$sql_req.="  and f2.choix_cleunik = qte_unite and f3.choix_cleunik=statut and f5.taxes_cleunik=f1.taxes_cleunik and f6.tpf_cleunik=f1.tpf_cleunik order by f1.ligne_cleunik;";

//die($sql_req);

$result = _graal_requete_bd($sql_req);
if (mysql_num_rows($result)==0) {
  //  Rien à éditer
  $pdf = new _graal_TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true);
  $pdf->_graal_pf_rai(); 
} else {
	$vl_c_bvj_119=fa_recup_dico("bvj_119");$vl_c_bvj_119="SARL au capital de 7622.45€ - RCS Montauban B 412 223 349 - APE 4669A - Code TVA FR 84 412 223 349 00033";
	$vl_c_bvj_120=fa_recup_dico("bvj_120");$vl_c_bvj_120="";
	$vl_c_bvj_121=fa_recup_dico("bvj_121");$vl_c_bvj_121="";
	$vl_c_bvj_119=fa_recup_dico_telquel("bvj_119");
	$vl_c_bvj_120=fa_recup_dico_telquel("bvj_120");
	$vl_c_bvj_121=fa_recup_dico_telquel("bvj_121");
	$texte_entre_corps_et_pied_01=" ";
  	$texte_entre_corps_et_pied_02=" ";
  	$texte_fin_de_page=$vl_c_bvj_121;
  //  Recherche informations entête
  //  Recherche du nombre de remises de lignes pour déterminer l'affichage ou non de la colonne  
  //  Recherche du nombre de taux de taxes différents pour déterminer l'affichage ou non de la colonne  
	include("_graal_bloc_code_docciaux_03.php");
  //  Calcul du nombre de lignes de montants dans le pied
	include("_graal_bloc_code_docciaux_montants_pied_doc.php");
  $pseudo_pdf = new pseudo(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true);
  $pseudo_pdf->Open();
  $pseudo_pdf->SetFont( $police_du_document, "", 9);  //  Police utilisée pour les lignes
  $hauteur_blocnote_pied=0;
  $hauteur_texte_entre_corps_et_pied_01=0;
  $hauteur_texte_entre_corps_et_pied_02=0;
  $hauteur_fin_de_page=0;
  if (trim($blocnotebrut_pied)!="") {
    $hauteur_blocnote_pied+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $blocnotebrut_pied,$x=10,$pos=2,array($police_du_document, "", 9)),0);
  }
if (trim($texte_entre_corps_et_pied_01)!="") {
    $hauteur_texte_entre_corps_et_pied_01+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $texte_entre_corps_et_pied_01,$x=10,$pos=2,array($police_du_document, "", 6)),0);
    $hauteur_texte_entre_corps_et_pied_01=5;
  }
if (trim($texte_entre_corps_et_pied_02)!="") {
    $hauteur_texte_entre_corps_et_pied_02+=round($pseudo_pdf->_graal_hauteur_00( $y=80, $texte_entre_corps_et_pied_02,$x=10,$pos=2,array($police_du_document, "", 6)),0);
    $hauteur_texte_entre_corps_et_pied_02=5;
  }
if (trim($texte_fin_de_page)!="") {
    $hauteur_fin_de_page+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $texte_fin_de_page,$x=10,$pos=2,array($police_du_document, "", 6)),0);
  } else{
  	$hauteur_fin_de_page+=10;
  }
  
  if ($texte_entre_corps_et_pied_02>$texte_entre_corps_et_pied_01){
  	$hauteur_blocnote_pied+=$hauteur_texte_entre_corps_et_pied_02;
  } else {
  	$hauteur_blocnote_pied+=$hauteur_texte_entre_corps_et_pied_01;
  }
  
  $hauteur_blocnote_pied+=$hauteur_fin_de_page;
  
  //  S'il y a 2 lignes de montants, le pied peut commencer à 270
  $position_pied=260;
  if ($nbligne_montant_pied>2) {
    $position_pied=$position_pied-(($nbligne_montant_pied-2)*5);
  }
  $position_pied-=$hauteur_blocnote_pied;
  $pdf = new toto(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true); 
  $pdf->SetCreator(PDF_CREATOR);
  //$pdf->SetProtection(array('print'));  //  On protège le document : seule l'impression est autorisée. 
  /*
   * le 27 août 2009 -> ne plus utiliser la protection, sinon on ne peut rien faire avec le document via le programme pdftk
   */
  //$pdf->setPrintHeader(false);
  $pdf->setPrintFooter(false);  //  Définir ce que l'on mettra dans le pied
  $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);
  $pdf->SetAutoPageBreak(TRUE, 10);
  $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
  $pdf->SetFooterMargin(5);
  $pdf->SetLineWidth(0.01);  //  Cadre invisible
  $pdf->SetFont( $police_du_document, "", 9);  //  Police utilisée pour les lignes
  $pdf->AliasNbPages("nombredepages");
  $pdf->contenu_code=$code;
  $pdf->contenu_dateexp=$dateexp;
  
  
  $ref_col=array();
  $ref_col[ 0]="Référence";
  $ref_col[ 1]="Désignation";
  $ref_col[ 2]="Quantité";
  $ref_col[ 3]="PU";
  $ref_col[ 4]="Référence F";
  
  $vl_c_bvj_125=fa_recup_dico("bvj_125");
  $vl_c_bvj_126=fa_recup_dico("bvj_126");
  $vl_c_bvj_127=fa_recup_dico("bvj_127");
  $vl_c_bvj_128=fa_recup_dico("bvj_128");
  $vl_c_bvj_129=fa_recup_dico("bvj_129");
  
  $ref_col[ 0]=$vl_c_bvj_128;
  $ref_col[ 1]=$vl_c_bvj_125;
  $ref_col[ 2]=$vl_c_bvj_126;
  $ref_col[ 3]=$vl_c_bvj_127;
  $ref_col[ 4]=$vl_c_bvj_129;
  
  $cols=array( $ref_col[ 0]=>35,$ref_col[ 1]=>90,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 4]=>30);
  $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 2]=>"R",$ref_col[ 3]=>"R",$ref_col[ 4]=>"L");
  $fonts=array( $ref_col[ 0]=>array($police_du_document,"","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 2]=>array($police_du_document,"","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"B","9"));
  $type=array( $ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 4]=>"Texte");
  
	$pdf->impression_cgv="false";
  $pdf->AddPage();
  
  //	Impression du corps de la page : modele 4: Code, Désignation, TaxeParafiscale (le cas échéant), Quantité,PU,Remise(le cas écheant), montant, code taxe (le cas échéant)
	include('_graal_bloc_code_docciaux_impression_corpus_doc_08.php');
  //  Fin de document
  //$position_pied+=5;
  include("_graal_bloc_code_docciaux_impression_pied_doc_03.php");
  
  fa_fin_creation_facfou();
}
?>
