<?
	function tinyUrlizeText($string) { 
		$string = preg_replace_callback("/(http:\/\/|ftp:\/\/)([^\s]*)/i", "replaceUrlCallback", $string); 
		return $string; 
	} 
	
	function getTinyUrl($url) { 
		$tinyurl = @file_get_contents("http://tinyurl.com/api-create.php?url=".$url); 
		if (!$tinyurl) { 
			return $url; 
		} 
		return $tinyurl; 
	} 
	
	function replaceUrlCallback($matches, $len = 30) { 
		$url = $matches[0]; 
		$tinyurl = getTinyUrl($url); 
		if (strlen($tinyurl) > $len) { 
			$tinyurl = substr($tinyurl, 0, $len/2)."&hellip;".substr($tinyurl, -($len/2)); 
			//return '<a href="'.$url.'">'.$tinyurl.'</a>'; 
			return $url;
		} 
		//return '<a href="'.$tinyurl.'">'.$tinyurl.'</a>'; 
		return $tinyurl;
	} 
?>