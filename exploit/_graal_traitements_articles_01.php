<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_type=fa_recup_param('type','1');  //  1 Normal,2 Choix,3 Critere
$vl_e_choix_cleunik=intval(fa_recup_param('vl_e_choix_cleunik','0'));
$vl_e_critere_cleunik=intval(fa_recup_param('vl_e_critere_cleunik','0'));
$vl_c_quoi=fa_recup_param('vl_c_quoi','');
$vl_c_enclair=fa_recup_param('vl_c_enclair','');
$vl_c_code_critere=fa_recup_param('vl_c_code_critere','');
$vl_c_code_choix=fa_recup_param('vl_c_code_choix','');
$vl_c_deno_critere=fa_recup_param('vl_c_deno_critere','');
$vl_c_deno_choix=fa_recup_param('vl_c_deno_choix','');
$vl_c_id_fenetre="Fen_00360";$vl_c_id_article_recherche="Div_00206";$vl_c_id_inc_infos_critere_choix_01="Div_00344";
$vl_c_id_t01="Trait_00052";$vl_c_id_t02="Trait_00053";$vl_c_id_t03="Trait_00265";$vl_c_id_t04="Trait_00266";$vl_c_id_t05="Trait_00267";$vl_c_id_t06="Trait_00268";$vl_c_id_t07="Trait_00269";$vl_c_id_t08="Trait_00270";$vl_c_id_t09="Trait_00271";$vl_c_id_t10="Trait_00272";$vl_c_id_t11="Trait_00273";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==false) {fa_redirige("acces_interdit");}
switch ($vl_c_type) {
  case '1' : // Normal
    $vl_c_type_article_recherche="1";
    break;
  case '2' : // Choix
  case '3' : // Critère
    break;
  case '6' : // Avec critères
  	$vl_c_type_article_recherche="17";
    break;
}


_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bdl_100=fa_recup_dico("bdl_100");
$vl_c_bdl_101=fa_recup_dico("bdl_101");
$vl_c_bdl_103=fa_recup_dico("bdl_103");
$vl_c_bdl_104=fa_recup_dico("bdl_104");
$vl_c_bdl_105=fa_recup_dico("bdl_105");
$vl_c_bdl_106=fa_recup_dico("bdl_106");
$vl_c_bdl_108=fa_recup_dico("bdl_108");
$vl_c_bdl_109=fa_recup_dico("bdl_109");
$vl_c_bdl_110=fa_recup_dico("bdl_110");
$vl_c_bdl_111=fa_recup_dico("bdl_111");
$vl_c_bdl_112=fa_recup_dico("bdl_112");
$vl_c_bdl_113=fa_recup_dico("bdl_113");
$vl_c_bdl_114=fa_recup_dico("bdl_114");
$vl_c_bdl_115=fa_recup_dico("bdl_115");
$vl_c_bdl_116=fa_recup_dico("bdl_116");
$vl_c_bdl_117=fa_recup_dico("bdl_117");
$vl_c_bdl_118=fa_recup_dico("bdl_118");

$vl_c_dico_00106=fa_recup_dico("dico_00106");
_graal_requete_charge_libobj($vl_c_id_t01,$vl_e_uti_cleunik);$vl_c_t01=fa_recup_dico("$vl_c_id_t01");
_graal_requete_charge_libobj($vl_c_id_t02,$vl_e_uti_cleunik);$vl_c_t02=fa_recup_dico("$vl_c_id_t02");
_graal_requete_charge_libobj($vl_c_id_t03,$vl_e_uti_cleunik);$vl_c_t03=fa_recup_dico("$vl_c_id_t03");
_graal_requete_charge_libobj($vl_c_id_t04,$vl_e_uti_cleunik);$vl_c_t04=fa_recup_dico("$vl_c_id_t04");
_graal_requete_charge_libobj($vl_c_id_t05,$vl_e_uti_cleunik);$vl_c_t05=fa_recup_dico("$vl_c_id_t05");
_graal_requete_charge_libobj($vl_c_id_t06,$vl_e_uti_cleunik);$vl_c_t06=fa_recup_dico("$vl_c_id_t06");
_graal_requete_charge_libobj($vl_c_id_t07,$vl_e_uti_cleunik);$vl_c_t07=fa_recup_dico("$vl_c_id_t07");
_graal_requete_charge_libobj($vl_c_id_t08,$vl_e_uti_cleunik);$vl_c_t08=fa_recup_dico("$vl_c_id_t08");
_graal_requete_charge_libobj($vl_c_id_t09,$vl_e_uti_cleunik);$vl_c_t09=fa_recup_dico("$vl_c_id_t09");
_graal_requete_charge_libobj($vl_c_id_t10,$vl_e_uti_cleunik);$vl_c_t10=fa_recup_dico("$vl_c_id_t10");
_graal_requete_charge_libobj($vl_c_id_t11,$vl_e_uti_cleunik);$vl_c_t11=fa_recup_dico("$vl_c_id_t11");
$vl_c_txx="Dupliquer les informations comptables de l article référence";
$chaine_choix_critere=<<<EOT
<menuitem label="$vl_c_bdl_116" oncommand="pf_ouvre_choix_critere('entreprise');" id="bt_sel_critere" />
<menuitem label="$vl_c_bdl_117" oncommand="pf_ouvre_choix_critere('moi');" id="bt_sel_choix" />
<menuitem label="$vl_c_bdl_118" oncommand="pf_enleve_choix_critere();" id="bt_sup_choix" collapsed="true"/>
EOT;
include("_graal_header_winxul.inc.php");
echo <<<END
<window id="_win_traitements_articles_01" onload="fa_aa(this);pf_aa_init()" old_onunload="pf_aa_ferme();" $c_xmlns>
$vl_c_graal_cp00
END;
echo <<<END
<popupset>
  <popup id="pop_selections">
  <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_articles');" />
  <menuitem label="$vl_c_bdl_109" oncommand="" />
  <menuitem class='menuitem-iconic ai07' label="$vl_c_bdl_110" oncommand='pf_article_ouvre();' />
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t01,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) { echo("<menuitem label='".$vl_c_t01."' oncommand='pf_article_active();'/>");}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t02,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) { echo("<menuitem label='".$vl_c_t02."' oncommand='pf_article_desactive();'/>");}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t01,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];$vl_b_acces=true;if ($vl_b_acces==true) { echo("<menuitem label='".$vl_c_txx."' oncommand='pf_article_duplique_compta_reference();'/>");}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t03,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem class="menuitem-iconic ak11" label="'.$vl_c_bdl_111.'" oncommand="pf_panier_ajoute();" />');}
switch ($vl_c_type) {
  case '2' : // Choix
    echo('<menuseparator/>');
    switch ($vl_c_quoi) {
      case 'in':
        $vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t10,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t10.'" oncommand="pf_choix_action(\'sup\');"/>');}
        break;
       case 'notin':
        $vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t09,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t09.'" oncommand="pf_choix_action(\'ajo\');"/>');}
      break;
    }
    break;
  case '3' : // Critère
    echo('<menuseparator/>');
    switch ($vl_c_quoi) {
      case 'in':
        $vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t11,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t11.'" oncommand="pf_critere_action(\'sup\');"/>');}
        break;
      break;
    }
    break;
}
echo <<<END
  <menuitem tooltiptext ="$vl_c_bdl_103" collapsed="true" id="bt_voir_panier" label="$vl_c_bdl_103" oncommand="pf_voir_deck(1)" />
  </popup>
</popupset>
  <popupset>
    <popup id="pop_panier">
      <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_articles_panier');" />
      <menuitem label="$vl_c_bdl_108" oncommand="" />
      <menuitem class="menuitem-iconic ak12" label="$vl_c_bdl_106" oncommand="pf_panier_enleve();"/>
      <menuitem class="menuitem-iconic ak13" label="$vl_c_t03" oncommand="pf_valide_danspanier();"/>
      <menuseparator />
      $chaine_choix_critere
      <menuseparator />
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t04,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t04.'" oncommand="pf_recup_requete(\'ods\');" class="menuitem-iconic ac12" />');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t05,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t05.'" oncommand="pf_recup_requete(\'rdf\');" class="menuitem-iconic ak02"  collapsed="true"/>');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t06,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t06.'" oncommand="pf_recup_requete(\'htm\');" class="menuitem-iconic ak03" />');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t07,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t07.'" oncommand="pf_recup_requete(\'xml\');" class="menuitem-iconic ak04" disabled="true"/>');}
echo ('<menuseparator />');
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t08,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t08.'" oncommand="pf_recup_requete(\'xls\');" class="menuitem-iconic ak05" dir="reverse"/>');}
echo <<<END
    </popup>
  </popupset>
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_articles_traitements_01.js.php");
include("js/_graal_articles_selection_01.js.php");
echo('<deck id="deck_articles" selectedIndex="0" flex="1">');
echo('<vbox flex="1">');
$vl_c_bloc_arbre_criteres=false;
$vl_c_id_vbox_inc_article_01='arbre_articles_01';
$vl_c_id_arbre_inc_article_01='arbre_des_articles';
switch ($vl_c_type) {
  case '1' : // Normal
    include("_graal_inc_articles_recherche_01.php");
	include("_graal_inc_articles_recherche_01_bis.php");
    break;
  case '2' : // Choix
  case '3' : // Critère
    $_graal_inc_infos_critere_choix_01="articles";
    include("_graal_inc_infos_critere_choix_01.php");
    include("_graal_inc_articles_recherche_01_bis.php");
    break;
  case '6' : // Avec critères
  	$vl_c_bloc_arbre_criteres=true;
    include("_graal_inc_articles_recherche_01.php");
	include("_graal_inc_articles_recherche_01_bis.php");
    break;
}

echo('<hbox><button flex="1" tooltiptext ="'."Sortir".'" id="bt_sortir" label="'."Sortir".'" crop="end" dir="normal" oncommand="window.close();" /><button flex="1" tooltiptext ="'.$vl_c_bdl_105.'" id="bt_sortir_renvoyer" label="'.$vl_c_bdl_105.'" crop="end" dir="normal" oncommand="pf_renvoie();" /></hbox></vbox><vbox flex="1">');
$vl_c_id_vbox_inc_article_01='arbre_articles_panier';
$vl_c_id_arbre_inc_article_01='arbre_des_articles_panier';
$vl_c_bloc_arbre_criteres=false;
include("_graal_inc_articles_recherche_01_bis.php");
echo('<hbox><button flex="1" tooltiptext ="'.$vl_c_bdl_104.'" id="bt_retour_selection" label="'.$vl_c_bdl_104.'" crop="end" dir="normal" oncommand="pf_voir_deck(0)" /></hbox>');
echo <<<XOF
<vbox id="vb_criteres_panier" collapsed="true">
    <_graal_datas id="_graal_ajout_ove_bdc_datas" _graal_choix_cleunik="" _graal_critere_cleunik="" _graal_critere_qui=""/>  
    <hbox>
      <caption label="$vl_c_bdl_113" /><textbox flex="10" id="tb_ajout_critere_denomination" />
      <caption label="$vl_c_bdl_114" /><textbox flex="10" id="tb_ajout_choix_valeur_texte_01"/>
      <toolbarbutton class="al01" id="tob_requete" tooltiptext="$vl_c_bdl_115" oncommand="pf_valide_criteres('ajout');"/>
    </hbox>
  </vbox>
  </vbox>
  </deck></window>
XOF;
?>
