<?php
include("_graal_header_xml.inc.php");
include("_graal_var_portee.php");
define('EOL', "\r\n");
$filename="menu_03_criteres.xml";
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$metier=intval(fa_recup_session('vs_envaf'));
$vl_c_dico_00044=fa_recup_dico("dico_00044");
$vl_c_dico_00045=fa_recup_dico("dico_00045");
$vl_c_dico_00019=fa_recup_dico("dico_00019");
$vl_c_dico_00020=fa_recup_dico("dico_00020");
$vl_c_dico_00021=fa_recup_dico("dico_00021");
$vl_c_dico_00022=fa_recup_dico("dico_00022");
$vl_c_dico_00023=fa_recup_dico("dico_00023");
$vl_c_dico_00024=fa_recup_dico("dico_00024");
$vl_c_dico_00025=fa_recup_dico("dico_00025");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00057=fa_recup_dico("dico_00057");
$vl_c_dico_00031=fa_recup_dico("dico_00031");
$vl_c_dico_00032=fa_recup_dico("dico_00032");
$vl_c_dico_00033=fa_recup_dico("dico_00033");
$vl_c_dico_00034=fa_recup_dico("dico_00034");
$vl_c_dico_00035=fa_recup_dico("dico_00035");
$vl_c_dico_00036=fa_recup_dico("dico_00036");
$vl_c_dico_00062=fa_recup_dico("dico_00062");
$vl_c_dico_00068=fa_recup_dico("dico_00068");
$vl_c_dico_00074=fa_recup_dico("dico_00074");
$sql_maj="update _act_choix_fixes f1 left join _acteurs f2 on f1.act_cleunik=f2.act_cleunik set f1.typeacteur=f2.typeacteur where f1.typeacteur<>f2.typeacteur;";
$vf_c_echo=_graal_exec_requete($sql_maj);
$sql_req_deb="SELECT critere_cleunik AS cleunik, critere_denomination AS denomination,critere_codechoixpertinent,critere_actif FROM _criteres where critere_cleunik <>0 and (critere_cleunik >=10000";
$vl_c_ordre_tri=" ORDER BY critere_actif,denomination ASC";
$xml='';
$xml .=fa_xcree_entete_xml().EOL;
$xml .='<dossier label="'.$vl_c_dico_00044.'" properties="al01" id="root">'.EOL;
    //  Gestion des acteurs
    $vl_e_portee=0;
    $vl_e_acces=0;
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00260",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_procli;}//Prospects clients
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00262",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_client;}//Clients
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00261",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_profou;}//Prospects fournisseurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00263",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_fourni;}//fournisseurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00264",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_autrac;}//Autres acteurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00265",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_actind;}//Acteurs indéterminés
    if ($vl_e_acces!=0) {
      $xml .='<item label=" '.$vl_c_dico_00045.'" properties="ai15" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_acteur.'&#38;portee='.$vl_e_portee.'" >'.EOL; //  Tous les acteurs
       //  Prospects clients
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00260",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_procli;
        $xml .='<item label=" '.$vl_c_dico_00020.'" properties="ai17" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Clients
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00262",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_client;
        $xml .='<item label=" '.$vl_c_dico_00021.'" properties="ai14" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL; //  Clients
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Prospects fournisseurs
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00261",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_profou;
        $xml .='<item label=" '.$vl_c_dico_00022.'" properties="ah10" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL; //  Prospects fournisseurs
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Fournisseurs
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00263",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_fourni;
        $xml .='<item label=" '.$vl_c_dico_00023.'" properties="ah06" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL; //  Fournisseurs
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Autres acteurs
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00264",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {
        $vl_e_portee=$vl_e_autrac;
        $xml .='<item label=" '.$vl_c_dico_00024.'" properties="ai16" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL; //  Autres acteurs
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Acteurs indéterminés
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00265",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_actind;
        $xml .='<item label=" '.$vl_c_dico_00025.'" properties="aj08" url="_graal_fen_criteres_acteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL; //  Acteurs indéterminés
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_acteur) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_acteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      $xml .='</item>'.EOL;
    }      
    //  Gestion des interlocuteurs des acteurs et des membres de l'entreprise
    $vl_e_portee=0;
    $vl_e_acces=0;
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00259",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_entrep;}//Membres de l'entreprise
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00281",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_procli;}//Interlocuteurs des Prospects clients
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00283",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_client;}//Interlocuteurs des Clients
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00282",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_profou;}//Interlocuteurs des Prospects fournisseurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00284",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_fourni;}//Interlocuteurs des fournisseurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00285",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_autrac;}//Interlocuteurs des Autres acteurs
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00286",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0) {$vl_e_portee+=$vl_e_actind;}//Interlocuteurs des Acteurs indéterminés
    if ($vl_e_acces!=0) {
      $xml .='<item label=" '.$vl_c_dico_00057.'" properties="ai18" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_interl.'&#38;portee='.$vl_e_portee.'" >'.EOL; //  Tous les interlocuteurs
      //Membres de l'entreprise
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00259",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_entrep;
        $xml .='<item label=" '.$vl_c_dico_00019.'" properties="ag17" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des Prospects clients
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00281",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_procli;
        $xml .='<item label=" '.$vl_c_dico_00031.'" properties="ai17" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des clients
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00283",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_client;
        $xml .='<item label=" '.$vl_c_dico_00033.'" properties="ai14" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des prospects fournisseurs 
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00282",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_profou;
        $xml .='<item label=" '.$vl_c_dico_00032.'" properties="ah10" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des fournisseurs 
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00284",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_fourni;
        $xml .='<item label=" '.$vl_c_dico_00034.'" properties="ah06" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des autres acteurs 
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00285",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_autrac;
        $xml .='<item label=" '.$vl_c_dico_00035.'" properties="ai16" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      //  Interlocuteurs des acteurs indéterminés 
      $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00286",$vl_e_uti_cleunik);$vl_e_acces+=$vl_tb_droits[0];if ($vl_tb_droits[0]!=0){
        $vl_e_portee=$vl_e_actind;
        $xml .='<item label=" '.$vl_c_dico_00036.'" properties="aj08" url="_graal_fen_criteres_interlocuteurs.php?fausseportee='.$vl_e_portee.'&#38;portee='.$vl_e_portee.'">'.EOL;
        $sql_req_criteres=$sql_req_deb.") and (critere_portee & $vl_e_portee and critere_portee & $vl_e_interl) $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_interlocuteurs.php?critere_cleunik='.$row_uti['cleunik'].'&#38;portee='.$vl_e_portee.'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        $xml .='</item>'.EOL;
      }
      $xml .='</item>'.EOL;
    }
    //  Gestion des articles
    $vl_e_acces=0;
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00334",$vl_e_uti_cleunik);$vl_e_acces=$vl_tb_droits[0]; //Articles
    if ($vl_e_acces!=0){
        $xml .='<item label=" '.$vl_c_dico_00062.'" properties="ai07" url="_graal_fen_criteres_articles.php" >'.EOL; //  Tous les articles
        $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and  critere_cleunik not in (1000,1001,1002,1003,1004) and critere_portee & $vl_e_articl $vl_c_ordre_tri";
        $res_uti=_graal_requete_bd($sql_req_criteres);
        while ($row_uti = mysql_fetch_assoc($res_uti)){
          if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
          $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_articles.php?critere_cleunik='.$row_uti['cleunik'].'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
        }
        switch ($metier){
        	case 1:
        		$xml .='<item label=" Métiers" properties="ai04">'.EOL;
          			$xml .='<item label=" Viticulture " properties="ai04">'.EOL;
		            $xml .='<item label=" Millésimes" properties="ai04" url="_graal_fen_critere_04.php?quelnocritere=1000"/>'.EOL;
		            $xml .='<item label=" Couleurs" properties="ai04" url="_graal_fen_critere_04.php?quelnocritere=1001"/>'.EOL;
		            $xml .='<item label=" Types de vins" properties="ai04" url="_graal_fen_critere_04.php?quelnocritere=1002"/>'.EOL;
		            $xml .='<item hidden="true" label=" Disponible" properties="ai04" url="_graal_fen_critere_04.php?quelnocritere=1003"/>'.EOL;
		            $xml .='<item label=" Contenants" properties="ai04" url="_graal_fen_critere_04.php?quelnocritere=1004"/>'.EOL;
		          $xml .='</item>'.EOL;
		        $xml .='</item>'.EOL;
		     	break;
        }
      $xml .='</item>'.EOL;
    }
    //  Gestion GED
    $vl_e_acces=0;
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00400",$vl_e_uti_cleunik);$vl_e_acces=$vl_tb_droits[0]; //GED
    if ($vl_e_acces!=0){
      $xml .='<item label=" '.$vl_c_dico_00068.'" properties="ah03" url="_graal_fen_criteres_ged.php?fausseportee='.$vl_e_gedged.'&#38;" >'.EOL; //  Tous les documents : documents, notes, pseudo-documents
      $sql_req_criteres=$sql_req_deb." or critere_cleunik < 10000 ) and critere_portee & $vl_e_gedged $vl_c_ordre_tri";
      $res_uti=_graal_requete_bd($sql_req_criteres);
      while ($row_uti = mysql_fetch_assoc($res_uti)){
        if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
        $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_ged.php?critere_cleunik='.$row_uti['cleunik'].'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
      }
      $xml .='</item>'.EOL;
    }
    //  Gestion Actions
    $vl_e_acces=0;
    $vl_tb_droits=_graal_requete_droits_fenetre("Fen_00433",$vl_e_uti_cleunik);$vl_e_acces=$vl_tb_droits[0]; //Actions
    if ($vl_e_acces!=0){
      $xml .='<item label=" '.$vl_c_dico_00074.'" properties="af08" url="_graal_fen_criteres_actions.php?fausseportee='.$vl_e_action.'&#38;" >'.EOL; //  Toutes les actions
      $sql_req_criteres="SELECT _criteres.critere_cleunik AS cleunik, _criteres.critere_denomination AS denomination,critere_codechoixpertinent,critere_actif FROM _criteres where (_criteres.critere_cleunik >=10000 or _criteres.critere_cleunik=141) and critere_portee & $vl_e_action $vl_c_ordre_tri";
      $res_uti=_graal_requete_bd($sql_req_criteres);
      while ($row_uti = mysql_fetch_assoc($res_uti)){
        if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
        $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_actions.php?critere_cleunik='.$row_uti['cleunik'].'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
      }
      $xml .='</item>'.EOL;
    }
$xml .='</dossier>'.EOL;
_graal_libere_requete_bd($res_uti);
_graal_ferme_connexion();
echo $xml;
?>
