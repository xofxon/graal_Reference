<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik=intval(fa_recup_session("vs_uti_cleunik","0"));
$param_generaux_graal_044=intval(fa_recup_session('vs_param_generaux_graal_044','0'));
$param_generaux_graal_046=intval(fa_recup_session('vs_param_generaux_graal_046','0'));
$param_generaux_graal_180=intval(fa_recup_session('vs_param_generaux_graal_180','-1'));//	Contrôle de la disponibilité automatique sur expédition totale
$vl_c_genreaction=fa_recup_param("genreaction","bordex_creer");
$vl_c_destination=fa_recup_param("destination","nullepart");
$vl_c_visu=fa_recup_param("visu","non");
$lesquels=fa_recup_param("lesquels","raf");
$vl_e_doc_cleunik=intval(fa_recup_param("vl_e_doc_cleunik",-1));
$vl_c_dico_00005=fa_recup_dico('dico_00005');
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_dico_00013=fa_recup_dico('dico_00013');
$vl_c_dico_00014=fa_recup_dico('dico_00014');
switch ($param_generaux_graal_046){
	case 1:$vl_c_id_fenetre="Fen_00781";break;
	case 2:$vl_c_id_fenetre="Fen_00477";break;
	case 3:$vl_c_id_fenetre="Fen_00477";break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false||$vl_tb_droits[1]==false) {fa_redirige("acces_interdit");}
switch ($vl_c_destination){
  case "exp"	:$vl_c_id_fenetre="Fen_01065";break;
  case "exp_fac":$vl_c_id_fenetre="Fen_01066";break;
  case "fac"	:$vl_c_id_fenetre="Fen_01067";break;
  default:fa_redirige("acces_interdit");
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$id_inc_actions_recherche="Div_00573";
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
$vl_tc_composants=array($id_inc_actions_recherche);
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bsh_100=fa_recup_dico("bsh_100");
$vl_c_bsh_101=fa_recup_dico("bsh_101");
$vl_c_bsh_102=fa_recup_dico("bsh_102");
$vl_c_bsh_103=fa_recup_dico("bsh_103");
$vl_c_bsh_104=fa_recup_dico("bsh_104");
$vl_c_bsh_105=fa_recup_dico("bsh_105");
$vl_c_bsh_107=fa_recup_dico("bsh_107");
$vl_c_bsh_111=fa_recup_dico("bsh_111");
$vl_c_bsh_112=fa_recup_dico("bsh_112");$vl_c_bsh_112="Nouvelle date d'expédition";
$vl_c_bsh_113=fa_recup_dico("bsh_113");$vl_c_bsh_113="Nouvelle date de facturation";
if ($param_generaux_graal_180==1){
	$bloc_attention=<<<EOT
<html:div id="contenu" style="border:0px;font-style:italic;
	background-color:#FFDDFF;
	border-bottom:1px solid #ED23AD;
	border-top:1px solid #ED23AD;
	border-right:1px solid #ED23AD;
	border-left:8px solid #ED23AD;
	padding:10px 10px 10px 44px;
	background-image:url('css/PanneauInfo.png');
	background-repeat:no-repeat;
	background-position:10px 10px;
	color:#000000;
	margin:10px 20px 10px 10px;
	height:100px;
">
	<html:blockquote class="sty01" >
      <html:br/><html:br/><html:br/>
      <html:div style="margin:10px 20px 10px 100px;"><html:h3>Attention, le contrôle de disponibilité n'est géré ici.</html:h3></html:div>
      <html:br/>
    </html:blockquote>
	</html:div>
EOT;
}
switch ($vl_c_destination){
  case "exp":
$bloc_changement_dates=<<<EOT
	<groupbox orient="vertical"><label value="$vl_c_bsh_112" />
      <hbox><radiogroup id='rdg_modif_date_expedition' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_expedition_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_expedition_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_exp"/> 
  	</hbox></groupbox>  
      <groupbox orient="vertical"><label value="$vl_c_bsh_111" />
      <hbox>
      <radiogroup id='rdg_modif_date_livraison' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_livraison_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_livraison_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_liv"/> 
  	</hbox></groupbox>
EOT;
  	break;
  case "exp_fac":
 $bloc_changement_dates=<<<EOT
	<groupbox orient="vertical"><label value="$vl_c_bsh_112" />
      <hbox>
		<radiogroup id='rdg_modif_date_expedition' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_expedition_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_expedition_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_exp"/> 
  	  </hbox>
  	</groupbox>  
      <groupbox orient="vertical"><label value="$vl_c_bsh_111" />
      <hbox><radiogroup id='rdg_modif_date_livraison' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_livraison_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_livraison_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_liv"/> 
  	</hbox></groupbox>
  	<groupbox orient="vertical"><label value="$vl_c_bsh_113" />
      <hbox><radiogroup id='rdg_modif_date_facturation' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_facturation_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_facturation_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_fac"/> 
  	</hbox></groupbox>
EOT;
  	break;
  case "fac":
  	$bloc_attention="";
$bloc_changement_dates=<<<EOT
  	<groupbox orient="vertical"><label value="$vl_c_bsh_113" />
      <hbox><radiogroup id='rdg_modif_date_facturation' flex="1" value="2">
        <hbox>
          <radio id='ra_modif_date_facturation_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
          <spacer flex="1"/>
          <radio id='ra_modif_date_facturation_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
         </hbox>
       </radiogroup>
  		<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_fac"/> 
  	</hbox></groupbox>
EOT;
  	break;
}


include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
$vl_c_pop_selections="";$vl_c_pop_panier="";
$vl_c_pop_selections.="<popupset><popup id='pop_selections'>";
$vl_c_pop_selections.='<menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\''."arbre_actions_01".'\');" />';
$vl_c_pop_selections.='<menuseparator/>';
$vl_c_pop_selections.="<menuitem class='menuitem-iconic af08' label='$vl_c_bsh_101' oncommand='pf_action_ouvre(\"arbre_actions_01\");' />";
$vl_c_pop_selections.='<menuitem class="menuitem-iconic ak11" label="'.$vl_c_bsh_102.'" oncommand="pf_panier_ajoute();" />';
$vl_c_pop_selections.="</popup></popupset>";
$vl_c_pop_panier.="<popupset><popup id='pop_panier'>";
$vl_c_pop_panier.='<menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\''."arbre_actions_panier".'\');" />';
$vl_c_pop_panier.='<menuseparator/>';
$vl_c_pop_panier.="<menuitem class='menuitem-iconic af08' label='$vl_c_bsh_103' oncommand='pf_action_ouvre(\"arbre_actions_panier\");' />";
$vl_c_pop_panier.="<menuitem class='menuitem-iconic ak12' label='$vl_c_bsh_104' oncommand='pf_panier_enleve();'/>";
$vl_c_pop_panier.="</popup></popupset>";
echo <<<END
<window context="graal_cp00" title="$vl_c_bda_100" id="$c_id_windows" onload="fa_aa(this);pf_aa_init_bem('21')" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
$vl_c_pop_selections
$vl_c_pop_panier
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_04.js.php");
include_once("js/_graal_actions_cdecli_01.js.php");
include_once("js/_graal_05_dates.js.php");
$vl_b_bloc_action_recherche=true;$vl_c_arbre_action="arbre_actions_01";
echo('<vbox flex="10" class="overflow_01">');
include ("_graal_inc_actions_recherche_01.php");
$vl_b_bloc_action_recherche=false;$vl_c_arbre_action="arbre_des_actions_panier";
include ("_graal_inc_actions_recherche_01.php");
echo $bloc_attention;
echo('<vbox><hbox id="boutons_standards">'); 
echo <<<END
	<progressmeter id="pm_evolution_01" mode="determined" value="0" collapsed="true" flex="1"/>
	<progressmeter id="pm_evolution_02" mode="determined" value="0" collapsed="true" flex="1"/>
	$bloc_changement_dates
	<button tooltiptext ="$vl_c_bsh_107 Ctrl+Shift+F5" keycode="k-enregistrer" flex="1" id="bt_enregistrer" label="$vl_c_bsh_107" orient="horizontal" crop="none" oncommand="pf_validation('enregistrer')" />
    <button flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen_bem('sortir')" collapsed="true"/>
</hbox></vbox></vbox>
END;
if ($vl_c_visu=="oui") {
echo <<<END
<splitter ondblclick="aad_pf_cache();"> </splitter>
  <vbox flex="10">
      <iframe onload="fa_aa(window.graal_iframe_visu_action);event.stopPropagation();" id="graal_iframe_visu_action" src="" flex="1"/>
  </vbox>
END;
}
echo("</window>");
?>
