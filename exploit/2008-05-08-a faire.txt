ALTER TABLE `_courriel_pj` ADD COLUMN `doc_cleunik` bigint(20);
ALTER TABLE `_courriel_pj_action` ADD COLUMN `doc_cleunik` bigint(20) comment 'Cl√© unique du document';
update _courriel_pj a1 left join _documents a2 using(hash) set a1.doc_cleunik=a2.doc_cleunik; 
select a1.courriel_pj_cleunik,a1.doc_cleunik,a2.courriel_pj_cleunik,a2.doc_cleunik from _courriel_pj a1 left join _courriel_pj_action a2 using(courriel_pj_cleunik);
_graal_oneshot_01_20080508_1700.php
http://localhost/graal/exploit/_graal_oneshot_01_20080508_1700.php


select a1.hash,a1.courriel_pj_cleunik,a1.doc_cleunik,a2.hash,a2.doc_cleunik from _courriel_pj a1 left join _documents a2 using(hash) where a2.doc_cleunik is null;

update _courriel_pj a1 left join _documents a2 using(hash) set a1.doc_cleunik=a2.doc_cleunik;
update _courriel_pj_action a1 left join _courriel_pj a2 using(courriel_pj_cleunik) set a1.doc_cleunik=a2.doc_cleunik;
INSERT IGNORE INTO _documents_rattachement select doc_cleunik,65536,action_cleunik from _courriel_pj_action;
ALTER TABLE `_courriel_pj_action` DROP INDEX `courriel_pj_action_cleunik`; 



ALTER TABLE `_courriel_pj_action` DROP COLUMN `courriel_pj_cleunik`;
drop table _courriel_pj_favoris;
drop table _courriel_pj;


SELECT a1.courriel_pj_cleunik, a1.hash, a1.nom, a1.mime from _courriel_pj a1 left join _documents a2 using(hash)
    
select a1.nom, a2.emplacement from _courriel_pj a1 left join _documents a2 using(doc_cleunik) where a2.typedoc=13;
select count(*) from _documents where typedoc=13
