<?php 
include("_graal_header_html.inc.php");
$vl_int_cleunik=intval(fa_recup_session('vs_int_cleunik','0'));
$lequels=fa_recup_param('lequels','0');

require("_graal_fonctions_soundex.php");
$vl_c_lesquelles=fa_recup_param('vl_c_lesquelles','toutes');
$vl_c_recherche=fa_recup_param('vl_c_recherche','%');
$vl_c_quelleplage=fa_recup_param('vl_c_quelleplage','debut');
$vl_c_datedebut=fa_recup_param('vl_c_dateheuredebut','');
$vl_c_datefin=fa_recup_param('vl_c_dateheurefin','');
$vl_c_heuredebut=fa_recup_param('vl_c_heuredebut','000000');
$vl_c_heurefin=fa_recup_param('vl_c_heurefin','235959');
$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_limit=intval(fa_recup_param('vl_e_limit','150'));
$vl_e_genre=intval(fa_recup_param('vl_e_genre','-1'));
$vl_e_statut=fa_recup_param('vl_e_statut','-1');
$vl_e_act_cleunik=intval(fa_recup_param('act_cleunik','-1'));
$vl_e_int_cleunik=intval(fa_recup_param('int_cleunik','-1'));
$vl_e_operat=intval(fa_recup_param('vl_operat','1'));
$vl_e_operat_genre=intval(fa_recup_param('vl_operat_genre','1'));
$vl_e_zone=intval(fa_recup_param('vl_zone','1'));
$vl_e_type_recherche=intval(fa_recup_param('vl_type_recherche','1'));
$vl_e_choix_cleunik=intval(fa_recup_param('vl_e_choix_cleunik','0'));
$vl_e_critere_cleunik=intval(fa_recup_param('vl_e_critere_cleunik','0'));
$vl_c_type_recherche_cleunik=fa_recup_param('vl_c_t01','');
$vl_c_sortie=fa_recup_param('sortie','das');
$vl_e_spec=intval(fa_recup_param('spec','0'));
$vl_e_spec_quoi=fa_recup_param('spec_quoi','0');
$vl_e_action_choix=intval(fa_recup_param('vl_e_action_choix','0'));
$vl_e_action_choix_cleunik=fa_recup_param('vl_e_action_choix_cleunik','0');
$vl_e_action_critere_cleunik=fa_recup_param('vl_e_action_critere_cleunik','0');
$vl_e_priorite=fa_recup_param('vl_e_priorite','-1');
$vl_e_operat_priorite=intval(fa_recup_param('vl_operat_priorite','1'));
$vl_c_concerne_qui=intval(fa_recup_param('vl_c_concerne_qui','1'));
$vs_int_cleunik=intval(fa_recup_session('vs_int_cleunik','0'));
switch ($vl_e_spec){
	case -1:
		$vl_c_lesquelles="acteurs";
		$vl_e_act_cleunik=$vl_e_spec_quoi;
		break;
	case -2:
		$vl_c_lesquelles="interlo";
		$vl_e_int_cleunik=$vl_e_spec_quoi;
		break;
}
$prop_obsolete="css_0001";
$req_compte_pj="select count(*) from _documents_rattachement where _documents_rattachement.rat_cleunik=_actions.action_cleunik and portee &$vl_e_piejoi";
$ignorer_gestion_listes_acteurs=true;
include("_graal_req_actions_01.php");
if (strlen($vl_c_in)!=0) {
	$vl_c_in=substr($vl_c_in,0,-1);
} else {
	$vl_c_in="";
}
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_actions_01";
fa_acces_script();
$sql_req_auteur="SELECT f1.action_cleunik,f1.sujet as `sujet`,f1.description,"._graalsql_date('f1.dateheuredebut')." as `datedebut`,"._graalsql_time('f1.dateheuredebut')." as `heuredebut`,concat_ws(_utf8' ',f4.`prenom`,f4.`patronyme`) as qui_destinataire,concat_ws(_utf8' ',f5.`prenom`,f5.`patronyme`) as qui_emetteur FROM _actions f1 join _graal f2 using (action_cleunik) join _graal f3 using (action_cleunik) left join _act_interlo f4 on f2.int_cleunik=f4.int_cleunik left join _act_interlo f5 on f3.int_cleunik=f5.int_cleunik where f1.choix_cleunik=-110130 and (f2.choix_cleunik=-110437) and (f3.choix_cleunik=-110436) and f3.int_cleunik=$vl_int_cleunik and f1.action_cleunik in ($vl_c_in) order by dateheuredebut desc;";
$sql_req_destin="SELECT f1.action_cleunik,f1.sujet as `sujet`,f1.description,"._graalsql_date('f1.dateheuredebut')." as `datedebut`,"._graalsql_time('f1.dateheuredebut')." as `heuredebut`,concat_ws(_utf8' ',f4.`prenom`,f4.`patronyme`) as qui_destinataire,concat_ws(_utf8' ',f5.`prenom`,f5.`patronyme`) as qui_emetteur FROM _actions f1 join _graal f2 using (action_cleunik) join _graal f3 using (action_cleunik) left join _act_interlo f4 on f2.int_cleunik=f4.int_cleunik left join _act_interlo f5 on f3.int_cleunik=f5.int_cleunik where f1.choix_cleunik=-110130 and (f2.choix_cleunik=-110437) and (f3.choix_cleunik=-110436) and f2.int_cleunik=$vl_int_cleunik and f1.action_cleunik in ($vl_c_in) order by dateheuredebut desc;";
$sql_req_lemond="SELECT f1.action_cleunik,f1.sujet as `sujet`,f1.description,"._graalsql_date('f1.dateheuredebut')." as `datedebut`,"._graalsql_time('f1.dateheuredebut')." as `heuredebut`,concat_ws(_utf8' ',f4.`prenom`,f4.`patronyme`) as qui_destinataire,concat_ws(_utf8' ',f5.`prenom`,f5.`patronyme`) as qui_emetteur FROM _actions f1 join _graal f2 using (action_cleunik) join _graal f3 using (action_cleunik) left join _act_interlo f4 on f2.int_cleunik=f4.int_cleunik left join _act_interlo f5 on f3.int_cleunik=f5.int_cleunik where f1.choix_cleunik=-110130 and (f2.choix_cleunik=-110437) and (f3.choix_cleunik=-110436) and f1.action_cleunik in ($vl_c_in) order by dateheuredebut desc;";
$sql_req_moimoi="SELECT f1.action_cleunik,f1.sujet as `sujet`,f1.description,"._graalsql_date('f1.dateheuredebut')." as `datedebut`,"._graalsql_time('f1.dateheuredebut')." as `heuredebut`,concat_ws(_utf8' ',f4.`prenom`,f4.`patronyme`) as qui_destinataire,concat_ws(_utf8' ',f5.`prenom`,f5.`patronyme`) as qui_emetteur FROM _actions f1 join _graal f2 using (action_cleunik) join _graal f3 using (action_cleunik) left join _act_interlo f4 on f2.int_cleunik=f4.int_cleunik left join _act_interlo f5 on f3.int_cleunik=f5.int_cleunik where f1.choix_cleunik=-110130 and (f2.choix_cleunik=-110437) and (f3.choix_cleunik=-110436) and (f3.int_cleunik=$vl_int_cleunik or f2.int_cleunik=$vl_int_cleunik) and f1.action_cleunik in ($vl_c_in) order by dateheuredebut desc;";
switch ($lequels){
	case "auteur":$sql_req=$sql_req_auteur;break;
	case "destinataire":$sql_req=$sql_req_destin;break;
	case "moi":$sql_req=$sql_req_moimoi;break;
	default:$sql_req=$sql_req_lemond;break;
}
switch ($vl_c_sortie) {
 	case "sql":
	    header('Content-type: text/plain; charset=utf-8');
	    header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
	    header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); // Date in the past
	    echo $sql_req;
		exit();
		break;
	case "das":
		$result = _graal_requete_bd($sql_req);
		$qui_suj=array();$qui_cle=array();$qui_des=array();$qui_deb=array();$qui_nde=array();$qui_nau=array();$qui_heb=array();
		while ($row = mysql_fetch_assoc($result)) {
			array_push ($qui_suj, $row['sujet']);
			array_push ($qui_cle, $row['action_cleunik']);
			array_push ($qui_des, nl2br($row['description']));
			array_push ($qui_deb, $row['datedebut']);
			array_push ($qui_heb, $row['heuredebut']);
			array_push ($qui_nde, $row['qui_destinataire']);
			array_push ($qui_nau, $row['qui_emetteur']);
		}
		_graal_libere_requete_bd($result);
		/*
		$chaine_open="var vl_e_haut = (screen.height / 2) - (1000 / 2);var vl_e_gauche = ;";
		      window.open(vv_fen, "",'"'+'
			  "chrome,hidechrome,centerscreen,modal,resizable,width='1000',height='1000',left='(screen.height / 2) - (1000 / 2)',top='(screen.width / 2) - (1000 / 2)";
		*/
		/*
		 * 		  echo '<button onclick="fa_ouvre(\'_graal_fen_actions_02.php?vf_e_action_cleunik='.$qui_cle[$vl_e_i].'&vf_c_action=modifier&genreaction=toutes_principales&\',1000,1000);return false"><strong>'.$qui_suj[$vl_e_i].'</strong></button><br/><br/>';
		 * 
		 * 
		 * 
		 */
		/*
		 * Pour les post it 
		 * récupéré ici : 
		 * http://htmlfixit.com/tutes/tutorial_CSS_Generated_Sticky_Note_Image_on_Your_Page.php
		 */
		 
		/*
		 * plante dans le body !!! ???
		<script type="application/x-javascript"><![CDATA[
		const ca_c_ouvre='chrome,hidechrome,centerscreen,modal,resizable';
		function fa_ouvre(vv_fen,vv_lar,vv_hau) {
		  switch (vv_lar) {
		    case 0    : window.open(vv_fen);break;
		    default   : 
		    	var vl_e_haut = (screen.height / 2) - (vv_hau / 2);
		    	var vl_e_gauche = (screen.width / 2) - (vv_lar / 2);
		      window.open(vv_fen, "",'"'+ca_c_ouvre+',width='+vv_lar+',height='+vv_hau+',left='+vl_e_gauche +',top='+vl_e_haut+'"');
		      break;  
		  }
		}
		]]></script>
		*/ 
		 
		 
		echo <<<END
		<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		  <meta content="text/html; charset=UTF-8" http-equiv="content-type" 
		    <meta content="Christophe Charron" name="author">
		    <title>Intro</title>
		
		<style type="text/css">
		<!--
		.sticky_note_container {
		    float: right;
		    width: 253px;
		    margin-right: 10px;
		    margin-left: 40px;
		}
		.sticky_note {
		     width: 253px;
		     min-height: 240px;
		     background-image: url(css/note_middle.gif);
		     background-repeat: repeat-y;
		     margin: 0px 0px 0px 0px;
		     padding: 20px 0px 0px 0px;
		}
		.sticky_note_content {
		     padding: 20px 30px 0px 30px;
		     color: blue;
		     font: normal normal bold Comic Sans MS, Cursive, Serif;
			 font-size: small;
		}
		.sticky_note_footer {
		     width: 253px;
		     background-image: url(css/note_finish.gif);
		     background-position: 0% 100%;
		     background-repeat: no-repeat;
		     margin: 0px 0px 0px 0px;
		     padding: 0px 0px 0px 0px;
		}
		body {
		 margin:0px;
		 background:white;
		 color: #333333;
		 text-align:center;
		 padding:0;
		 }
		
		#cont {
		 width:300px;
		 background:#ffffff;
		 color: #333333;
		 border:solid #3366CC;
		 border-width:0 0 0 2px;
		 text-align:left;
		 }
		
		
		-->
		</style>
		</head>
		<body>
		<a  target="_blank" href="_graal_fen_actions_post_it_01.php"><strong>Ajouter un post it</strong></a><br/><br/>
		  <table width="100%" border="0">
		  
END;
		  $vl_e_i=-1;
		  $vl_e_nb_col=0;
				foreach($qui_cle as $vl_raf) {
					$vl_e_i++;
				  if ($vl_e_nb_col==3){
				  	echo '</tr>';
					$vl_e_nb_col=0;
				  }
				  if ($vl_e_nb_col==0){
				  	echo '<tr>';
				  }
				  echo '<td><div id="cont"><div class="sticky_note_container"><div class="sticky_note"><div class="sticky_note_content">';
				  echo "De $qui_nau[$vl_e_i] <br>";
				  echo "A  $qui_nde[$vl_e_i] <br>";
				  echo "Le $qui_deb[$vl_e_i] à $qui_heb[$vl_e_i]<br><br>";
				  echo '<a  target="_blank" href="_graal_fen_actions_02.php?vf_e_action_cleunik='.$qui_cle[$vl_e_i].'&vf_c_action=modifier&genreaction=toutes_principales&"><strong>'.$qui_suj[$vl_e_i].'</strong></a><br/><br/>';
				  echo $qui_des[$vl_e_i];
				  echo '</div></div><div class="sticky_note_footer">&nbsp;</div><br clear="all" /></div></div></td>';
				  $vl_e_nb_col++;
				}
		  		echo '</tr>';
		echo('</table></body></html>');
		break;
}
?>