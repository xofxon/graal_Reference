<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_c_emailing=fa_recup_param('emailing','non');
$vl_e_action_cleunik=intval(fa_recup_param('vl_e_action_cleunik',-1));
$vl_e_int_cleunik=intval(fa_recup_param('vl_e_int_cleunik',-1));
$vl_e_act_cleunik=intval(fa_recup_param('vl_e_act_cleunik',-1));
$vl_c_type_recherche="normal";$vl_c_id_bloc_sel_rech_courriel=true;
if ($vl_e_int_cleunik!=-1){$vl_c_type_recherche="interl";$vl_c_id_bloc_sel_rech_courriel=false;}
if ($vl_e_act_cleunik!=-1){$vl_c_type_recherche="acteur";$vl_c_id_bloc_sel_rech_courriel=false;}
$vl_c_renvoyer_unseul=fa_recup_param('vl_c_renvoyer_unseul','non');
$vl_c_fonction_retour=fa_recup_param('vl_c_fonction_retour','');
$vl_c_reste=intval(fa_recup_param('reste',""));
switch ($vl_c_genreacteur){
  case "tousss": $vl_c_id_fenetre="Fen_00497";$vl_c_id_rech_courriel="Div_00118";break;  //Tous les acteurs
  case "110000": $vl_c_id_fenetre="Fen_00498";$vl_c_id_rech_courriel="Div_00119";break; //  Entreprise
  case "110001": $vl_c_id_fenetre="Fen_00499";$vl_c_id_rech_courriel="Div_00120";break; //  Prospects Clients
  case "110002": $vl_c_id_fenetre="Fen_00500";$vl_c_id_rech_courriel="Div_00121";break; //  Prospects Fournisseurs
  case "110003": $vl_c_id_fenetre="Fen_00501";$vl_c_id_rech_courriel="Div_00122";break; //  Clients
  case "110004": $vl_c_id_fenetre="Fen_00502";$vl_c_id_rech_courriel="Div_00123";break; //  Fournisseurs
  case "110005": $vl_c_id_fenetre="Fen_00503";$vl_c_id_rech_courriel="Div_00124";break; //  Autres
  case "110006": $vl_c_id_fenetre="Fen_00504";$vl_c_id_rech_courriel="Div_00125";break; //  Indéterminés
}
switch ($vl_c_genreacteur) {
  case "tousss": $vl_c_id_t3="Trait_00203";$vl_c_id_t4="Trait_00170";$vl_c_id_t5="Trait_00179";$vl_c_id_t6="Trait_00211";$vl_c_id_t7="Trait_00187";$vl_c_id_t8="Trait_00195";break;  //  Tous les acteurs
  case "110001": $vl_c_id_t3="Trait_00204";$vl_c_id_t4="Trait_00171";$vl_c_id_t5="Trait_00180";$vl_c_id_t6="Trait_00212";$vl_c_id_t7="Trait_00188";$vl_c_id_t8="Trait_00196";break;  //  prospects clients
  case "110002": $vl_c_id_t3="Trait_00205";$vl_c_id_t4="Trait_00172";$vl_c_id_t5="Trait_00181";$vl_c_id_t6="Trait_00213";$vl_c_id_t7="Trait_00189";$vl_c_id_t8="Trait_00197";break;  //  prospects fournisseurs
  case "110003": $vl_c_id_t3="Trait_00206";$vl_c_id_t4="Trait_00173";$vl_c_id_t5="Trait_00182";$vl_c_id_t6="Trait_00214";$vl_c_id_t7="Trait_00190";$vl_c_id_t8="Trait_00198";break;  //  clients
  case "110004": $vl_c_id_t3="Trait_00207";$vl_c_id_t4="Trait_00174";$vl_c_id_t5="Trait_00183";$vl_c_id_t6="Trait_00215";$vl_c_id_t7="Trait_00191";$vl_c_id_t8="Trait_00199";break;  //  fournisseurs
  case "110005": $vl_c_id_t3="Trait_00208";$vl_c_id_t4="Trait_00176";$vl_c_id_t5="Trait_00184";$vl_c_id_t6="Trait_00216";$vl_c_id_t7="Trait_00192";$vl_c_id_t8="Trait_00200";break;  //  autres acteurs
  case "110006": $vl_c_id_t3="Trait_00209";$vl_c_id_t4="Trait_00177";$vl_c_id_t5="Trait_00185";$vl_c_id_t6="Trait_00217";$vl_c_id_t7="Trait_00193";$vl_c_id_t8="Trait_00201";break;  //  acteurs indéterminés
  case "110000": $vl_c_id_t3="Trait_00210";$vl_c_id_t4="Trait_00178";$vl_c_id_t5="Trait_00186";$vl_c_id_t6="Trait_00218";$vl_c_id_t7="Trait_00194";$vl_c_id_t8="Trait_00202";break; //  Entreprise
}
switch ($vl_c_genreacteur) {
  case "tousss": $vl_c_id_t9="Trait_00249";$vl_c_id_t10="Trait_00257";$vl_c_id_t11="Trait_00306";break;  //  Tous les acteurs
  case "110001": $vl_c_id_t9="Trait_00250";$vl_c_id_t10="Trait_00258";$vl_c_id_t11="Trait_00306";break;  //  prospects clients
  case "110002": $vl_c_id_t9="Trait_00251";$vl_c_id_t10="Trait_00259";$vl_c_id_t11="Trait_00306";break;  //  prospects fournisseurs
  case "110003": $vl_c_id_t9="Trait_00252";$vl_c_id_t10="Trait_00260";$vl_c_id_t11="Trait_00306";break;  //  clients
  case "110004": $vl_c_id_t9="Trait_00253";$vl_c_id_t10="Trait_00261";$vl_c_id_t11="Trait_00306";break;  //  fournisseurs
  case "110005": $vl_c_id_t9="Trait_00254";$vl_c_id_t10="Trait_00262";$vl_c_id_t11="Trait_00306";break;  //  autres acteurs
  case "110006": $vl_c_id_t9="Trait_00255";$vl_c_id_t10="Trait_00263";$vl_c_id_t11="Trait_00306";break;  //  acteurs indéterminés
  case "110000": $vl_c_id_t9="Trait_00256";$vl_c_id_t10="Trait_00264";$vl_c_id_t11="Trait_00306";break; //  Entreprise
}
$vl_c_id_t12="Trait_00325";//	ajout dans un panier d'adresses de courriels
_graal_requete_charge_libobj($vl_c_id_t3,$vl_e_uti_cleunik);$vl_c_t3=fa_recup_dico("$vl_c_id_t3");
_graal_requete_charge_libobj($vl_c_id_t4,$vl_e_uti_cleunik);$vl_c_t4=fa_recup_dico("$vl_c_id_t4");
_graal_requete_charge_libobj($vl_c_id_t5,$vl_e_uti_cleunik);$vl_c_t5=fa_recup_dico("$vl_c_id_t5");
_graal_requete_charge_libobj($vl_c_id_t6,$vl_e_uti_cleunik);$vl_c_t6=fa_recup_dico("$vl_c_id_t6");
_graal_requete_charge_libobj($vl_c_id_t7,$vl_e_uti_cleunik);$vl_c_t7=fa_recup_dico("$vl_c_id_t7");
_graal_requete_charge_libobj($vl_c_id_t8,$vl_e_uti_cleunik);$vl_c_t8=fa_recup_dico("$vl_c_id_t8");
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00028=fa_recup_dico("dico_00028");
$vl_c_bgi_100=fa_recup_dico("bgi_100");
$vl_c_bgi_101=fa_recup_dico("bgi_101");
$vl_c_bgi_102=fa_recup_dico("bgi_102");
$vl_c_bgi_103=fa_recup_dico("bgi_103");
$vl_c_bgi_104=fa_recup_dico("bgi_104");
$vl_c_bgi_105=fa_recup_dico("bgi_105");
$vl_c_bgi_106=fa_recup_dico("bgi_106");
$vl_c_bgi_107=fa_recup_dico("bgi_107");
$vl_c_bgi_108=fa_recup_dico("bgi_108");
$vl_c_bgi_109=fa_recup_dico("bgi_109");
$vl_c_bgi_110=fa_recup_dico("bgi_110");
$vl_c_bgi_111=fa_recup_dico("bgi_111");
$vl_c_bgi_112=fa_recup_dico("bgi_112");
$vl_c_bgi_113=fa_recup_dico("bgi_113");
$vl_c_bgi_114=fa_recup_dico("bgi_114");
$vl_c_bgi_115=fa_recup_dico("bgi_115");
$vl_c_bgi_116=fa_recup_dico("bgi_116");$vl_c_bgi_116="Renvoyer la requête de sélection et sortir.";
$vl_c_bgi_117=fa_recup_dico("bgi_117");$vl_c_bgi_117="Compter les courriels correspondant";
$vl_c_bgi_118=fa_recup_dico("bgi_118");$vl_c_bgi_118="Renvoyer le courriel sélectionné";
$vl_c_bgi_119=fa_recup_dico("bgi_119");$vl_c_bgi_119="Ajouter à un panier de courriels";

$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_nom_arbre_courriel_select="arbre_des_courriels_interlo_act";
$vl_c_nom_arbre_courriel_panier="arbre_des_courriels_interlo_act_panier";
$vl_tc_composants=array($vl_c_id_rech_courriel);
$bloc_01="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t9,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_01=<<<EOT
  <menu label="$vl_c_bgi_109" >
     <menupopup>
      <menuitem class="menuitem-iconic ak16" label="$vl_c_dico_00013" oncommand="pf_masse(1,1,1);" />
      <menuitem class="menuitem-iconic ak17" label="$vl_c_dico_00014" oncommand="pf_masse(1,2,1);" />
      <menuitem class="menuitem-iconic ak18" label="$vl_c_dico_00028" oncommand="pf_masse(1,3,1);" />
     </menupopup>
  </menu>
EOT;
}
$bloc_02="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t10,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_02=<<<EOT
  <menu label="$vl_c_bgi_110" >
     <menupopup>
      <menuitem class="menuitem-iconic af16" label="$vl_c_dico_00013" oncommand="pf_masse(2,1,1);" />
      <menuitem class="menuitem-iconic ae15" label="$vl_c_dico_00014" oncommand="pf_masse(2,2,1);" />
      <menuitem class="menuitem-iconic af15" label="$vl_c_dico_00028" oncommand="pf_masse(2,3,1);" />
     </menupopup>
  </menu>
EOT;
}
$bloc_03="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t9,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_03=<<<EOT
  <menu label="$vl_c_bgi_109" >
     <menupopup>
      <menuitem class="menuitem-iconic ak16" label="$vl_c_dico_00013" oncommand="pf_masse(1,1,2);" />
      <menuitem class="menuitem-iconic ak17" label="$vl_c_dico_00014" oncommand="pf_masse(1,2,2);" />
      <menuitem class="menuitem-iconic ak18" label="$vl_c_dico_00028" oncommand="pf_masse(1,3,2);" />
     </menupopup>
  </menu>
EOT;
}
$bloc_04="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t10,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_04=<<<EOT
  <menu label="$vl_c_bgi_110" >
     <menupopup>
      <menuitem class="menuitem-iconic af16" label="$vl_c_dico_00013" oncommand="pf_masse(2,1,2);" />
      <menuitem class="menuitem-iconic ae15" label="$vl_c_dico_00014" oncommand="pf_masse(2,2,2);" />
      <menuitem class="menuitem-iconic af15" label="$vl_c_dico_00028" oncommand="pf_masse(2,3,2);" />
     </menupopup>
  </menu>
EOT;
}
$bloc_05="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t11,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_05=<<<EOT
<menuitem class="menuitem-iconic" label="$vl_c_bgi_115" oncommand="pf_masse(5,'',2);"/>
EOT;
}
$bloc_06="";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t12,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {
$bloc_06=<<<EOT
<menuitem class="menuitem-iconic" label="$vl_c_bgi_119" oncommand="pf_valide_danspanier_courriels();"/>
EOT;
}
$param_generaux_graal_031=intval(fa_recup_session('vs_param_generaux_graal_031','0'));
$param_generaux_graal_032=intval(fa_recup_session('vs_param_generaux_graal_032','0'));
$param_generaux_graal_033=intval(fa_recup_session('vs_param_generaux_graal_033','0'));
$param_generaux_graal_100=intval(fa_recup_session('vs_param_generaux_graal_100',0));	//	Possibilité de renvoyer la requête
if (("$vl_c_emailing"=="oui") && ($param_generaux_graal_031==2)){$ra_veuxpasdemail_non_grise="disabled='true'";}
if (("$vl_c_emailing"=="oui") && ($param_generaux_graal_032==2)){$ra_valide_non_grise="disabled='true'";}
if (("$vl_c_emailing"=="oui") && ($param_generaux_graal_033==2)){$rdg_deja_dans_emailing_grise="disabled='true'";}
if (("$vl_c_emailing"=="oui") && ($param_generaux_graal_100==1)){
$bloc_renvoie_requete=<<<EOT
<button tooltiptext ="$vl_c_bgi_116" flex="1" id="bt_sortir" label="$vl_c_bgi_116" crop="end" dir="normal" oncommand="pf_aa_ferme('renvoyer_requete');" />
EOT;
}
$rdg_immediat="1";
if (("$vl_c_emailing"=="oui")){
$bloc_comptage_requete=<<<EOT
<toolbarbutton class="af01" id="bt_comptage" tooltiptext="$vl_c_bgi_117" crop="end" dir="normal" oncommand="pf_compte();" />
EOT;
$rdg_immediat="2";
}
switch ($vl_c_renvoyer_unseul){
	case "non":
		$bloc_renvoi=<<<EOT
<hbox>
  <button tooltiptext ="$vl_c_bgi_113" flex="1" id="bt_sortir_rien" label="$vl_c_bgi_113" crop="end" dir="normal" oncommand="pf_aa_ferme('rien');" />
	<button tooltiptext ="$vl_c_bgi_114" flex="1" id="bt_enregistrer" label="$vl_c_bgi_114" crop="end" dir="normal" oncommand="pf_renvoyer();" />
	$bloc_renvoie_requete
  <button tooltiptext ="$vl_c_bgi_108" flex="1" id="bt_sortir" label="$vl_c_bgi_108" crop="end" dir="normal" oncommand="pf_aa_ferme('renvoyer');" />
</hbox>
EOT;
		break;
	case "oui":
$bloc_renvoi=<<<EOT
<hbox>
  <button tooltiptext ="$vl_c_bgi_113" flex="1" id="bt_sortir_rien" label="$vl_c_bgi_113" crop="end" dir="normal" oncommand="pf_aa_ferme('rien');" />
	<button tooltiptext ="Renvoyer le courriel sélectionné" flex="1" id="bt_enregistrer" label="$vl_c_bgi_118" crop="end" dir="normal" oncommand="pf_renvoyer();" />
</hbox>
EOT;
		break;
}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bgi_100" id="_graal_fen_rech_courriel_01" onload="fa_aa(this);pf_aa_init();" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_courriel_traitements_01.js.php");
echo('<deck id="deck_courriels" selectedIndex="0" flex="1">');
echo('<vbox flex="1" class="overflow_01">');
$vl_c_nom_arbre_courriel=$vl_c_nom_arbre_courriel_select;$vl_cache_controle_01="true";
include("_graal_inc_rech_courriel_01.php");
echo <<<END
<popupset>
  <popup id="pop_selections">
  <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_courriels_interlo_act');" />
  <menuitem label="$vl_c_bgi_101" oncommand="fa_lignes_arbre_deselectionne('$vl_c_nom_arbre_courriel_select');" />
  <menuseparator/>
  <menuitem class="menuitem-iconic ai15" label="$vl_c_bgi_102" oncommand="pf_acteur_ouvre();" />
  <menuitem class="menuitem-iconic ai18" label="$vl_c_bgi_103" oncommand="pf_interlo_ouvre();" />
  <menuitem class="menuitem-iconic ag18" label="$vl_c_bgi_104" oncommand="pf_courriel_ouvre('$vl_c_nom_arbre_courriel_select');" />
  <menuseparator/>
  $bloc_01
  $bloc_02
  <menuitem class="menuitem-iconic" label="$vl_c_bgi_111" oncommand="pf_masse(3,0,1);" />
  <menuitem class="menuitem-iconic" label="$vl_c_bgi_112" oncommand="pf_masse(4,0,1);" />
  <menuseparator/>
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t3,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem class="menuitem-iconic ak11" label="'.$vl_c_t3.'" oncommand="pf_panier_ajoute();" />');}
echo <<<END
  <menuitem tooltiptext ="$vl_c_bgi_106" collapsed="true" id="bt_voir_panier" label="$vl_c_bgi_106" oncommand="pf_voir_deck(1)" />
  </popup>
</popupset>
</vbox>
<vbox flex="1">
END;
$vl_c_id_bloc_sel_rech_courriel=false;$vl_c_nom_arbre_courriel=$vl_c_nom_arbre_courriel_panier;$vl_cache_controle_01="false";
include("_graal_inc_rech_courriel_01.php");
echo <<<END
  <popupset>
    <popup id="pop_panier">
      <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_courriels_interlo_act_panier');" />
      <menuitem class="menuitem-iconic ag18" label="$vl_c_bgi_104" oncommand="pf_courriel_ouvre('$vl_c_nom_arbre_courriel_panier');" />
      <menuitem label="$vl_c_bgi_101" oncommand="fa_lignes_arbre_deselectionne('$vl_c_nom_arbre_courriel_panier');" />
      <menuitem tooltiptext ="$vl_c_bgi_107" label="$vl_c_bgi_107" crop="end" dir="normal" oncommand="pf_voir_deck(0)" />
      <menuseparator/>
      <menuitem class="menuitem-iconic ak12" label="$vl_c_bgi_105" oncommand="pf_panier_enleve();"/>
      <menuitem class="menuitem-iconic ak13" label="$vl_c_t3" oncommand="pf_valide_danspanier();"/>
      		$bloc_06
			$bloc_05
      <menuseparator />
      $bloc_03
      $bloc_04
      <menuseparator />
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t4,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t4.'" oncommand="pf_recup_requete(\'ods\');" class="menuitem-iconic ac12" />');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t5,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t5.'" oncommand="pf_recup_requete(\'rdf\');" class="menuitem-iconic ak02" collapsed="true"/>');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t6,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t6.'" oncommand="pf_recup_requete(\'htm\');" class="menuitem-iconic ak03" />');}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t7,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t7.'" oncommand="pf_recup_requete(\'xml\');" class="menuitem-iconic ak04" disabled="true"/>');}
echo ('<menuseparator />');
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t8,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t8.'" oncommand="pf_recup_requete(\'xls\');" class="menuitem-iconic ak05" dir="reverse"/>');}
echo <<<END
    </popup>
  </popupset>
</vbox>
<pseudo_boite>
  <vbox flex="1">
    <iframe flex="1" src="_graal_en_plein_travail.php" />
  </vbox>
</pseudo_boite>
</deck>
$bloc_renvoi
</window>
END;
?>
