<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_act_cleunik=intval(fa_recup_param("vl_act_cleunik","10000113"));
$vl_actif=intval(fa_recup_param("actif",3));
$sql_req = "SELECT _article.art_cleunik as art_cleunik,tar_cleunik,case _art_tarifs.pu_reference WHEN 0 THEN '' ELSE round(_art_tarifs.pu_reference,_art_tarifs.nb_dec) END as pu_reference,choix_code,choix_valeur_texte_01,code,mnemotechnique,description,"._graalsql_date('dateheure_validite')." as datevalidite,_art_tarifs.actif FROM _art_tarifs,_choix,_article where choix_cleunik=tarif_cleunik and act_cleunik=$vl_e_act_cleunik and _article.art_cleunik=_art_tarifs.art_cleunik and type=1";
switch ($vl_actif) {
  case 1 : $sql_req.= " and _art_tarifs.actif=1";break;
  case 2 : $sql_req.= " and _art_tarifs.actif=2";break;
  case 3 : break;
}
$sql_req.=" order by choix_valeur_texte_01;";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
    // parseType = indication pour le type des donn√©es, utile pour le tri sur la colonne
    echo('<row:tar_cleunik_particulier_vente NC:parseType="Integer">'.fa_ent_xml($row['tar_cleunik']).'</row:tar_cleunik_particulier_vente>');
    echo('<row:art_cleunik_particulier_vente NC:parseType="Integer">'.fa_ent_xml($row['art_cleunik']).'</row:art_cleunik_particulier_vente>');
    echo('<row:code_particulier_vente>'.fa_ent_xml($row['choix_code']).'</row:code_particulier_vente>');
    echo('<row:designation_particulier_vente>'.fa_ent_xml($row['choix_valeur_texte_01']).'</row:designation_particulier_vente>');
    echo('<row:tarif_particulier_vente>'.fa_ent_xml($row['pu_reference']).'</row:tarif_particulier_vente>');
    echo('<row:code_article_interne_vente>'.fa_ent_xml($row['code']).'</row:code_article_interne_vente>');
    echo('<row:desi_article_interne_vente>'.fa_ent_xml($row['description']).'</row:desi_article_interne_vente>');
    echo('<row:mnemotechnique>'.fa_ent_xml($row['code']).'</row:mnemotechnique>');
    if ($row['actif']==1) {
      echo('<row:properties></row:properties>');
    } else {
      echo('<row:properties>css_0001</row:properties>');
    }
    echo('<row:datevalidite>'.fa_ent_xml($row['datevalidite']).'</row:datevalidite>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
