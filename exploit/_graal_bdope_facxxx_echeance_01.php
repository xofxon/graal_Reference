<?php
//Devrait être enregistré sous forme _graal_bdope_faccli_echeance_01.php
include("_graal_header_txt.inc.php");
include("_graal_fonctions_echeances.php");
define('EOL', "\r\n");
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_qui=fa_recup_param("vl_qui","");
switch ($vl_qui){
	case "faccli":$fichier="_faccli_echeance";$fichier_01="_faccli_entetes";break;
	case "facfou":$fichier="_facfou_echeance";$fichier_01="_facfou_entetes";break;
}
$vl_echeance_cleunik=intval(fa_recup_param("vl_echeance_cleunik",""));
$vl_commercial_cleunik=intval(fa_recup_param("vl_commercial_cleunik",""));
$vl_pc_cleunik=intval(fa_recup_param("vl_pc_cleunik",""));
$vl_noligne=intval(fa_recup_param("vl_noligne",""));
$vl_date_paiement=fa_recup_param("vl_date_paiement","");
$vl_date_echeance=fa_recup_param("vl_date_echeance","");
$vl_libelle=fa_recup_param("vl_libelle","");
$vl_montant_du=fa_floatval(fa_recup_param("vl_montant_du",""));
$vl_montant_paye=fa_floatval(fa_recup_param("vl_montant_paye",""));
$vl_devise_du=fa_floatval(fa_recup_param("vl_devise_du",""));
$vl_devise_paye=fa_floatval(fa_recup_param("vl_devise_paye",""));
$vl_taux_de_change=fa_floatval(fa_recup_param("vl_taux_de_change",""));
$vl_mode_paiement=intval(fa_recup_param("vl_mode_paiement",""));
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_dateheurecreation=fa_recup_param("vl_dateheurecreation","");
$vl_dateheuremodif=fa_recup_param("vl_dateheuremodif","");
$vl_etat=intval(fa_recup_param("vl_etat",""));
switch (TRUE) {
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM $fichier WHERE echeance_cleunik = $vl_echeance_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_echeance_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="ajouter":
    $vl_e_fen_cleunik=_graal_requete_max("echeance_cleunik","$fichier");
    $sql_req = "INSERT INTO $fichier set echeance_cleunik=$vl_echeance_cleunik,commercial_cleunik=$vl_commercial_cleunik,pc_cleunik=$vl_pc_cleunik,noligne=$vl_noligne,date_paiement='$vl_date_paiement',date_echeance='$vl_date_echeance',libelle='$vl_libelle',montant_du=$vl_montant_du,montant_paye=$vl_montant_paye,devise_du=$vl_devise_du,devise_paye=$vl_devise_paye,taux_de_change=$vl_taux_de_change,mode_paiement=$vl_mode_paiement,blocnotebrut='$vl_blocnotebrut',dateheurecreation=now(),etat=$vl_etat";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_echeance_cleunik;} else {$vf_c_echo=-1;}
    break;
	case $vf_c_action=="ajouter_auto":
    $vl_echeance_cleunik=_graal_requete_max("echeance_cleunik","$fichier");
    $sql_req = "INSERT INTO $fichier set echeance_cleunik=$vl_echeance_cleunik,commercial_cleunik=$vl_commercial_cleunik,pc_cleunik=$vl_pc_cleunik,noligne=$vl_noligne,date_paiement='$vl_date_paiement',date_echeance='$vl_date_echeance',libelle='$vl_libelle',montant_du=$vl_montant_du,montant_paye=$vl_montant_paye,devise_du=$vl_devise_du,devise_paye=$vl_devise_paye,taux_de_change=$vl_taux_de_change,mode_paiement=$vl_mode_paiement,blocnotebrut='$vl_blocnotebrut',dateheurecreation=now(),etat=$vl_etat";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_echeance_cleunik;} else {$vf_c_echo=-1;}
    break;
	case $vf_c_action=="ajouter_kilometre":
		fa_calcule_echeance_kilometres($vl_qui);
    break;			
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE $fichier set commercial_cleunik=$vl_commercial_cleunik,pc_cleunik=$vl_pc_cleunik,noligne=$vl_noligne,date_paiement='$vl_date_paiement',date_echeance='$vl_date_echeance',libelle='$vl_libelle',montant_du=$vl_montant_du,montant_paye=$vl_montant_paye,devise_du=$vl_devise_du,devise_paye=$vl_devise_paye,taux_de_change=$vl_taux_de_change,mode_paiement=$vl_mode_paiement,blocnotebrut='$vl_blocnotebrut',dateheuremodif=now(),etat=$vl_etat;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_echeance_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
