<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_traitements_articles_03";
$t_origines_ok[1]="_graal_traitements_articles_04";
fa_acces_script();
$vl_c_mess_00018=fa_recup_dico("mess_00018");
$vl_c_mess_00019=fa_recup_dico("mess_00019");
$vl_c_mess_00020=fa_recup_dico("mess_00020");
$vl_c_mess_00021=fa_recup_dico("mess_00021");
$vl_c_mess_00022=fa_recup_dico("mess_00022");
$vl_c_mess_00023=fa_recup_dico("mess_00023");
$vl_c_mess_00024=fa_recup_dico("mess_00024");
$vl_c_mess_00025=fa_recup_dico("mess_00025");
$vl_c_mess_00026=fa_recup_dico("mess_00026");
$vl_c_mess_00027=fa_recup_dico("mess_00027");
$vl_c_mess_00028=fa_recup_dico("mess_00028");
$vl_c_mess_00029=fa_recup_dico("mess_00029");
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_t_tarif=fa_recup_param("vl_t_tarif","");
$vl_t_tar_cleunik=fa_recup_param("vl_t_tar_cleunik","");
$vl_t_tarif=unserialize(stripslashes($vl_t_tarif));
$vl_t_tar_cleunik=unserialize(stripslashes($vl_t_tar_cleunik));
$vl_b_transaction_ok=true;
$vl_e_i=-1;
switch (TRUE){
  case $vf_c_action=="kilometres_majtarif";
	foreach($vl_t_tar_cleunik as $vl_raf) {
	  $vl_e_i++;
	  $vl_tar_cleunik=$vl_t_tar_cleunik[$vl_e_i];
	  $pu_reference=fa_floatval($vl_t_tarif[$vl_e_i]);
	  $sql_req = "UPDATE _art_tarifs SET dateheure_dermaj=now(),_art_tarifs.pu_reference=$pu_reference where tar_cleunik=$vl_tar_cleunik;";
	  $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
	}
	if ($vl_b_transaction_ok==false) {echo $vl_c_mess_00026.$vl_c_mess_err;} else {echo $vl_c_mess_00027;}
	break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
?>
