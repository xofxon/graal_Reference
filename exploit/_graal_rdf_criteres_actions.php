<?php
include("_graal_header_xml.inc.php");
include("_graal_var_portee.php");
define('EOL', "\r\n");
$vl_c_etat=fa_recup_param('vl_c_etat','1');
$vl_c_position=fa_recup_param('vl_c_position','1');
$vl_c_operateur_01="=";
$vl_c_oui=fa_recup_dico("dico_00013");
$vl_c_non=fa_recup_dico("dico_00014");
$vl_c_actif=fa_recup_dico("dico_00046");
$vl_c_inactif=fa_recup_dico("dico_00047");
switch ($vl_c_etat){
  case "1": break;  //  Tous
  case "2": $vl_c_operateur_01=">";break; //  les utilisés
  case "3": $vl_c_operateur_01="=";break;//  pas utilisés
}
$sql_req = "select critere_cleunik,critere_code,critere_denomination,case critere_actif WHEN 1 THEN '$vl_c_actif' ELSE '$vl_c_inactif' END AS critere_actif";
$sql_req .= " from _criteres where critere_cleunik >9999 and critere_portee & $vl_e_action";
switch ($vl_c_position){
  case "1": break;  //  Actifs et inactifs
  case "2": $sql_req .= " AND critere_actif =1";break;//  les utilisés
  case "3": $sql_req .= " AND critere_actif =2";break;//  les pas utilisés
}
switch ($vl_c_etat){
  case "1": break;  //  Tous
  case "2": //  les utilisés
  case "3": //  les pas utilisés
   $sql_req .= " and (SELECT count(*) as nombre from _actions_choix_fixes where _actions_choix_fixes.critere_cleunik = _criteres.critere_cleunik) $vl_c_operateur_01 0";
}
$sql_req .= " ORDER BY critere_denomination";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)){
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  echo('<row:critere_cleunik NC:parseType="Integer">'.fa_ent_xml($row['critere_cleunik']).'</row:critere_cleunik>');
  echo('<row:critere_code>'.fa_ent_xml($row['critere_code']).'</row:critere_code>');
  echo('<row:critere_denomination>'.fa_ent_xml($row['critere_denomination']).'</row:critere_denomination>');
  echo('<row:critere_actif>'.fa_ent_xml($row['critere_actif']).'</row:critere_actif>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
// fin du fichier RDF
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
