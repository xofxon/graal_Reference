<?php
include("_graal_header_xml.inc.php");
$vl_e_art_cleunik=intval(fa_recup_param('vl_e_art_cleunik',-1));
$vl_e_act_cleunik=intval(fa_recup_param('vl_e_act_cleunik',-1));
define('EOL', "\r\n");
// execution de la requÃ¨te SQL
$sql_req ="SELECT _art_acteur.art_acteur_cleunik ,_art_acteur.art_cleunik ,_art_acteur.act_cleunik ,_art_acteur.code ,_art_acteur.description ,_art_acteur.delai_reappro ,";
$sql_req.=" _art_acteur.unite_reappro ,_art_acteur.minimum_commande ,_acteurs.raisonsoc, _article.code as 'code_article_interne', _article.description as 'desi_article_interne',";
$sql_req.=" _choix.choix_valeur_texte_01,"._graalsql_date('_art_acteur.dateheurevalidite')." as `dateheurevalidite`, f4.choix_valeur_texte_01 as unite_achat";
$sql_req.=" FROM _art_acteur left join _acteurs using(act_cleunik) left join _article using(art_cleunik) left join _choix on _choix.choix_cleunik=_art_acteur.unite_reappro";
$sql_req.=" left join _choix f4 on f4.choix_cleunik=_art_acteur.unite_achat";
if ($vl_e_art_cleunik!=-1) {$sql_req.=" where _acteurs.typeacteur in(110004,110002) and _art_acteur.art_cleunik=$vl_e_art_cleunik;";} 
if ($vl_e_act_cleunik!=-1) {$sql_req.=" where _acteurs.typeacteur in(110004,110002) and _art_acteur.act_cleunik=$vl_e_act_cleunik;";}
//echo $sql_req;
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
    echo(' art_fournis_cleunik="'.fa_ent_xml($row['art_acteur_cleunik']).'"');
    echo(' art_cleunik="'.fa_ent_xml($row['art_cleunik']).'"');
    echo(' act_cleunik="'.fa_ent_xml($row['act_cleunik']).'"');
    echo(' code="'.fa_ent_xml($row['code']).'"');
    echo(' description="'.fa_ent_xml($row['description']).'"');
    echo(' dateheurevalidite="'.fa_ent_xml($row['dateheurevalidite']).'"');
    echo(' delai_reappro="'.fa_ent_xml($row['delai_reappro']).'"');
    echo(' unite_reappro="'.fa_ent_xml($row['choix_valeur_texte_01']).'"');
    echo(' nom_acteur="'.fa_ent_xml($row['raisonsoc']).'"');
    echo(' code_article_interne="'.fa_ent_xml($row['code_article_interne']).'"');
    echo(' desi_article_interne="'.fa_ent_xml($row['desi_article_interne']).'"');
    echo(' minimum_commande="'.fa_ent_xml($row['minimum_commande']).'"');
    echo(' unite_achat="'.fa_ent_xml($row['unite_achat']).'"');
	echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
