<?php
include("_graal_header_xml.inc.php");
$catcompta_cleunik=intval(fa_recup_param("catcompta_cleunik",-1));
define('EOL', "\r\n");
$utilisations ="(select count(*) from _act_compta where catcompta_cleunik=$catcompta_cleunik)+(select count(*) from _art_compta where catcompta_cleunik=$catcompta_cleunik)";
$utilisations.=" +(select count(*) from _cdecli_entetes where catcompta_cleunik=$catcompta_cleunik)+(select count(*) from _cdecli_lignes where catcompta_cleunik=$catcompta_cleunik)";
$utilisations.=" as utilisations";

/*
(select count(*) from _offcli_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _livcli_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _faccli_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _cdefou_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _demfou_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _recfou_entetes where catcompta_cleunik=$catcompta_cleunik)
(select count(*) from _facfou_entetes where catcompta_cleunik=$catcompta_cleunik)
*/

// execution de la requète SQL
$sql_req ="SELECT catcompta_cleunik,p0.code as code,p0.intitule as intitule,compte_vente_port,compte_vente_divers,compte_achat_port,compte_achat_divers,";
$sql_req.=" p0.dateheuremodification as dateheuremodification,p0.dateheurecreation as dateheurecreation,journal,p0.taxes_vente_port,p0.taxes_vente_divers,p1.code as code_vente_port,";
$sql_req.=" p1.intitule as intitule_vente_port,p2.code as code_achat_port,p2.intitule as intitule_achat_port,p3.code as code_vente_divers,p3.intitule as intitule_vente_divers,";
$sql_req.=" p4.code as code_achat_divers,p4.intitule as intitule_achat_divers,$utilisations,p5.denomination as denomination_vente_port,p5.code as code_taxe_vente_port,";
$sql_req.=" p6.denomination as denomination_vente_divers,p6.code as code_taxe_vente_divers,p0.taxes_achat_port,p0.taxes_achat_divers, ";
$sql_req.=" p7.denomination as denomination_achat_port,p7.code as code_taxe_achat_port,p8.denomination as denomination_achat_divers,p8.code as code_taxe_achat_divers";
$sql_req.=" FROM _param_categories_compta p0,_param_pc p1,_param_pc p2,_param_pc p3,_param_pc p4,";
$sql_req.=" _param_taxes p5,_param_taxes p6, _param_taxes p7,_param_taxes p8 ";
$sql_req.=" where catcompta_cleunik=$catcompta_cleunik and p1.pc_cleunik=compte_vente_port and p2.pc_cleunik=compte_achat_port and p3.pc_cleunik=compte_vente_divers";
$sql_req.="  and p4.pc_cleunik=compte_achat_divers and p5.taxes_cleunik=p0.taxes_vente_port and p6.taxes_cleunik=p0.taxes_vente_divers";
$sql_req.=" and p7.taxes_cleunik=p0.taxes_achat_port and p8.taxes_cleunik=p0.taxes_achat_divers";
$result = _graal_requete_bd($sql_req);
echo fa_xcree_entete_xml();
$row = mysql_fetch_assoc($result);
echo('<Description>');
// parseType = indication pour le type des données, utile pour le tri sur la colonne
echo('<catcompta_cleunik data="'.fa_ent_xml($row['catcompta_cleunik']).'"/>');
echo('<code data="'.fa_ent_xml($row['code']).'"/>');
echo('<intitule data="'.fa_ent_xml($row['intitule']).'"/>');
echo('<compte_vente_port data="'.fa_ent_xml($row['compte_vente_port']).'"/>');
echo('<compte_vente_divers data="'.fa_ent_xml($row['compte_vente_divers']).'"/>');
echo('<compte_achat_port data="'.fa_ent_xml($row['compte_achat_port']).'"/>');
echo('<compte_achat_divers data="'.fa_ent_xml($row['compte_achat_divers']).'"/>');
echo('<dateheuremodification data="'.fa_ent_xml($row['dateheuremodification']).'"/>');
echo('<dateheurecreation data="'.fa_ent_xml($row['dateheurecreation']).'"/>');
echo('<journal data="'.fa_ent_xml($row['journal']).'"/>');
echo('<code_vente_port data="'.fa_ent_xml($row['code_vente_port']).'"/>');
echo('<code_achat_port data="'.fa_ent_xml($row['code_achat_port']).'"/>');
echo('<intitule_vente_port data="'.fa_ent_xml($row['intitule_vente_port']).'"/>');
echo('<intitule_achat_port data="'.fa_ent_xml($row['intitule_achat_port']).'"/>');
echo('<code_vente_divers data="'.fa_ent_xml($row['code_vente_divers']).'"/>');
echo('<code_achat_divers data="'.fa_ent_xml($row['code_achat_divers']).'"/>');
echo('<intitule_vente_divers data="'.fa_ent_xml($row['intitule_vente_divers']).'"/>');
echo('<intitule_achat_divers data="'.fa_ent_xml($row['intitule_achat_divers']).'"/>');
echo('<utilisations data="'.fa_ent_xml($row['utilisations']).'"/>');
echo('<code_taxe_vente_port data="'.fa_ent_xml($row['code_taxe_vente_port']).'"/>');
echo('<denomination_vente_port data="'.fa_ent_xml($row['denomination_vente_port']).'"/>');
echo('<code_taxe_vente_divers data="'.fa_ent_xml($row['code_taxe_vente_divers']).'"/>');
echo('<denomination_vente_divers data="'.fa_ent_xml($row['denomination_vente_divers']).'"/>');
echo('<taxes_vente_divers data="'.fa_ent_xml($row['taxes_vente_divers']).'"/>');
echo('<taxes_vente_port data="'.fa_ent_xml($row['taxes_vente_port']).'"/>');

echo('<code_taxe_achat_port data="'.fa_ent_xml($row['code_taxe_achat_port']).'"/>');
echo('<denomination_achat_port data="'.fa_ent_xml($row['denomination_achat_port']).'"/>');
echo('<code_taxe_achat_divers data="'.fa_ent_xml($row['code_taxe_achat_divers']).'"/>');
echo('<denomination_achat_divers data="'.fa_ent_xml($row['denomination_achat_divers']).'"/>');
echo('<taxes_achat_divers data="'.fa_ent_xml($row['taxes_achat_divers']).'"/>');
echo('<taxes_achat_port data="'.fa_ent_xml($row['taxes_achat_port']).'"/>');

echo('</Description>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
