<?php
include("_graal_header_xml.inc.php");
$vf_c_argfen00=fa_recup_param('quelsdocs','');
$vl_e_typedoc=fa_recup_param('vs_typedoc','1');
$vl_e_uti_cleunik=fa_recup_session('vs_uti_cleunik','0');
switch (TRUE) {
  case $vf_c_argfen00 == "medoc":
  case $vf_c_argfen00 == "mesliens":
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.typedoc,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc FROM _documents	WHERE _documents.doc_cleunik in(SELECT distinct(_documents.doc_cleunik) AS doc_cleunik FROM _droits_doc, _documents	WHERE _documents.doc_cleunik = _droits_doc.doc_cleunik AND _droits_doc.uti_cleunik=$vl_e_uti_cleunik AND _documents.typedoc = $vl_e_typedoc) order by _documents.doc_cleunik desc;";
    break;
  case $vf_c_argfen00 == "nosdocs":
  case $vf_c_argfen00 == "nosliens":
    $sql_req = "SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc = $vl_e_typedoc and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0 order by _documents.doc_cleunik desc";
    break;
  case $vf_c_argfen00 == "leurdocs": 
  case $vf_c_argfen00 == "leurliens":
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc = $vl_e_typedoc AND _droits_doc.uti_cleunik<>$vl_e_uti_cleunik and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0";
    break;
  case $vf_c_argfen00 == "mesflux":
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents_rss.emplacement_prive AS emplacement,_documents.typedoc,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc FROM _documents,_documents_rss	WHERE _documents_rss.doc_cleunik=_documents.doc_cleunik and _documents.doc_cleunik in(SELECT distinct(_documents.doc_cleunik) AS doc_cleunik FROM _droits_doc, _documents	WHERE _documents.doc_cleunik = _droits_doc.doc_cleunik AND _droits_doc.uti_cleunik=$vl_e_uti_cleunik AND _documents.typedoc = $vl_e_typedoc) order by _documents.doc_cleunik desc;";
    break;
  case $vf_c_argfen00 == "nosflux":
    $sql_req = "SELECT _documents.doc_cleunik AS doc_cleunik,_documents_rss.emplacement_prive AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents,_documents_rss	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents_rss.doc_cleunik=_documents.doc_cleunik AND _documents.typedoc = $vl_e_typedoc and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0 order by _documents.doc_cleunik desc";
    break;
  case $vf_c_argfen00 == "leursflux":
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents_rss.emplacement_prive AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents,_documents_rss	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc = $vl_e_typedoc AND _documents_rss.doc_cleunik=_documents.doc_cleunik AND _droits_doc.uti_cleunik<>$vl_e_uti_cleunik and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0";
    break;

  default :
    echo 	('booom');
    exit;
}
//echo $sql_req;
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' doc_cleunik="'.fa_ent_xml($row['doc_cleunik']).'"');
  echo(' emplacement="'.fa_ent_xml($row['emplacement']).'"');
  echo(' descriptif_sommaire="'.fa_ent_xml($row['descriptif_sommaire']).'"');
  echo(' titre="'.fa_ent_xml($row['titre']).'"');
  echo(' prenom="'.fa_ent_xml($row['prenom']).'"');
  echo(' patronyme="'.fa_ent_xml($row['patronyme']).'"');
  echo(' dateheurecreation="'.fa_ent_xml($row['dateheurecreation']).'"');
  echo(' dateheuremodif="'.fa_ent_xml($row['dateheuremodif']).'"');
  echo(' tailledoc="'.fa_ent_xml($row['tailledoc']).'"');
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
