<?php
include("_graal_header_xul.inc.php");
include("_graal_fonctions_rss.php");
$vl_id=fa_recup_param('id','');	//	uniquement pour traitement flux RSS
$vl_cle=fa_recup_param('cle','');	//	uniquement pour traitement flux RSS
if ($vl_id!=""||$vl_cle!=""){
	if ($vl_id!="") {
		$c_uuid=$vl_id;
		$rss_accès="restreint";
	} else {
		$c_uuid=$vl_cle;
		$rss_accès="total";
	}
	$sql_req="SELECT action_cleunik from _documents_rss_actions where c_uuid='$c_uuid';";
  $result = _graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
	$vl_action_cleunik=$row['action_cleunik'];
  _graal_libere_requete_bd($result);
} else {
	$vl_action_cleunik=intval(fa_recup_param('vf_e_action_cleunik','-1'));
	$rss_accès="total";
}
/*
 * Rien compris, le 5 février 2010 au code qui suit !!! Désactivé en attendant que quelqu'un saute au plafond !!
 */
/*
if ($vl_action_cleunik!=-1){
	$sql_req="SELECT action_cleunik from _actions where action_cleunik=$vl_action_cleunik;";
    $result = _graal_requete_bd($sql_req);
    $row = mysql_fetch_assoc($result);
    $verif_action_cleunik=$row['action_cleunik'];
    _graal_libere_requete_bd($result);
    if ($verif_action_cleunik!=$vl_action_cleunik){
    	fa_redirige("acces_interdit");
    }
}
*/
/*
 * Gestion liste noire
 */
if ($vl_action_cleunik!=-1){
	$sql_req="SELECT action_cleunik from _actions_noire where action_cleunik=$vl_action_cleunik;";
    $result = _graal_requete_bd($sql_req);
	if (mysql_num_rows($result)!=0) {fa_redirige("document_interdit");}
	_graal_libere_requete_bd($result);
}
$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_nomcomplet=fa_recup_session('vs_nomcomplet','tesquiconnard?');
$vs_envaa=fa_recup_session('vs_envaa','0');	//	Nombre d'utilisateurs
$vl_c_genreaction=fa_recup_param('genreaction','generique');
$vl_c_specificite=fa_recup_param('specificite','');
$vl_e_doccialorigine=intval(fa_recup_param('doccialorigine','-1'));
$vf_c_action=fa_recup_param('vf_c_action','ajouter');
$vl_c_suppression=fa_recup_param('vl_c_suppression','droits');
$param_generaux_graal_045=intval(fa_recup_session('vs_param_generaux_graal_045','0'));
$param_generaux_graal_046=intval(fa_recup_session('vs_param_generaux_graal_046','0'));
$param_generaux_graal_047=intval(fa_recup_session('vs_param_generaux_graal_047','0'));
$param_generaux_graal_048=intval(fa_recup_session('vs_param_generaux_graal_048','0'));
$param_generaux_graal_049=intval(fa_recup_session('vs_param_generaux_graal_049','0'));
$param_generaux_graal_050=intval(fa_recup_session('vs_param_generaux_graal_050','0'));
$param_generaux_graal_103=intval(fa_recup_session('vs_param_generaux_graal_103','0'));
$param_generaux_graal_114=intval(fa_recup_session('vs_param_generaux_graal_114','0'));
$param_generaux_graal_125=intval(fa_recup_session('vs_param_generaux_graal_125','0'));
$param_generaux_graal_136=intval(fa_recup_session('vs_param_generaux_graal_136','0'));
$vl_c_id_fenetre="Fen_00425";$id_inc_actions_criteres_entreprise="Div_00373";$vl_c_id_fen_criteres_entreprise="Fen_00426";$id_inc_actions_criteres_moi="Div_00394";
$vl_c_id_fen_criteres_moi="Fen_00427";$id_inc_actions_criteres_autres="Div_00395";$id_inc_actions_criteres_tous="Div_00396";$id_inc_ged="Div_00397";
$id_inc_actions_graal="Div_00403";$vl_c_id_fen_graal="Fen_00437";$vl_c_id_inc_actions_relations="Div_00423";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);
if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
if ($rss_accès=="restreint"){
	$vl_b_ajout=0;
	$vl_b_modif=0;
	$vl_b_suppr=0;
	$vl_c_impri=0;
} else {
	$vl_tb_droits[4]=1; //commenté le 26 février 2009 puis tout de suite décommenté, Baronnat s'en sert
//$vl_tb_droits[4]=0;
	$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
	if ($vl_action_cleunik!=-1) {$vl_b_ajout=0;}
	switch ($vl_c_suppression){
		case "droits":
			break;
		case "non":
			$vl_b_suppr=0;
			break;
	}
}
$vl_b_impri=false;
$vl_b_dupliq=true;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->vl_selection_action_fenetre)){$vl_selection_action_fenetre=$vl_c_xml->vl_selection_action_fenetre->attributes();}else{$vl_selection_action_fenetre=1;}
$vl_c_ben_100=fa_recup_dico("ben_100");
$vl_c_ben_101=fa_recup_dico("ben_101");
$vl_c_ben_102=fa_recup_dico("ben_102");
$vl_c_ben_103=fa_recup_dico("ben_103");
$vl_c_ben_104=fa_recup_dico("ben_104");
$vl_c_ben_105=fa_recup_dico("ben_105");
$vl_c_ben_106=fa_recup_dico("ben_106");
$vl_c_ben_107=fa_recup_dico("ben_107");
$vl_c_ben_108=fa_recup_dico("ben_108");
$vl_c_ben_109=fa_recup_dico("ben_109");
$vl_c_ben_110=fa_recup_dico("ben_110");
$vl_c_ben_111=fa_recup_dico("ben_111");
$vl_c_ben_112=fa_recup_dico("ben_112");
$vl_c_ben_113=fa_recup_dico("ben_113");
$vl_c_ben_114=fa_recup_dico("ben_114");
$vl_c_ben_115=fa_recup_dico("ben_115");
$vl_c_ben_116=fa_recup_dico("ben_116");
$vl_c_ben_117=fa_recup_dico("ben_117");
$vl_c_ben_118=fa_recup_dico("ben_118");
$vl_c_ben_119=fa_recup_dico("ben_119");
$vl_c_ben_120=fa_recup_dico("ben_120");
$vl_c_ben_121=fa_recup_dico("ben_121");
$vl_c_ben_122=fa_recup_dico("ben_122");
$vl_c_ben_123=fa_recup_dico("ben_123");
$vl_c_ben_124=fa_recup_dico("ben_124");
$vl_c_ben_125=fa_recup_dico("ben_125");
$vl_c_ben_126=fa_recup_dico("ben_126");
$vl_c_ben_127=fa_recup_dico("ben_127");
$vl_c_ben_128=fa_recup_dico("ben_128");
$vl_c_ben_129=fa_recup_dico("ben_129");
$vl_c_ben_130=fa_recup_dico("ben_130");
$vl_c_ben_131=fa_recup_dico("ben_131");
$vl_c_ben_132=fa_recup_dico("ben_132");
$vl_c_ben_133=fa_recup_dico("ben_133");
$vl_c_ben_134=fa_recup_dico("ben_134");
$vl_c_ben_135=fa_recup_dico("ben_135");
$vl_c_ben_136=fa_recup_dico("ben_136");
$vl_c_ben_137=fa_recup_dico("ben_137");
$vl_c_ben_138=fa_recup_dico("ben_138");
$vl_c_ben_139=fa_recup_dico("ben_139");
$vl_c_ben_140=fa_recup_dico("ben_140");
$vl_c_ben_141=fa_recup_dico("ben_141");
$vl_c_ben_142=fa_recup_dico("ben_142");
$vl_c_ben_143=fa_recup_dico("ben_143");
$vl_c_ben_144=fa_recup_dico("ben_144");
$vl_c_ben_145=fa_recup_dico("ben_145");
$vl_c_ben_146=fa_recup_dico("ben_146");
$vl_c_ben_152=fa_recup_dico("ben_152");
$vl_c_ben_153=fa_recup_dico("ben_153");
$vl_c_ben_154=fa_recup_dico("ben_154");
$vl_c_ben_155=fa_recup_dico("ben_155");
$vl_c_ben_156=fa_recup_dico("ben_156");
$vl_c_ben_157=fa_recup_dico("ben_157");
$vl_c_ben_158=fa_recup_dico("ben_158");
$vl_c_ben_159=fa_recup_dico("ben_159");
$vl_c_ben_160=fa_recup_dico("ben_160");
$vl_c_ben_161=fa_recup_dico("ben_161");
$vl_c_ben_162=fa_recup_dico("ben_162");
$vl_c_ben_163=fa_recup_dico("ben_163");
$vl_c_ben_164=fa_recup_dico("ben_164");
$vl_c_ben_165=fa_recup_dico("ben_165");
$vl_c_ben_166=fa_recup_dico("ben_166");
$vl_c_ben_167=fa_recup_dico("ben_167");
$vl_c_ben_168=fa_recup_dico("ben_168");
$vl_c_ben_169=fa_recup_dico("ben_169");
$vl_c_ben_170=fa_recup_dico("ben_170");
$vl_c_ben_171=fa_recup_dico("ben_171");
$vl_c_ben_172=fa_recup_dico("ben_172");
$vl_c_ben_173=fa_recup_dico("ben_173");
$vl_c_ben_174=fa_recup_dico("ben_174");
$vl_c_ben_175=fa_recup_dico("ben_175");
$vl_c_ben_176=fa_recup_dico("ben_176");
$vl_c_ben_177=fa_recup_dico("ben_177");
$vl_c_ben_178=fa_recup_dico("ben_178");
$vl_c_ben_179=fa_recup_dico("ben_179");
$vl_c_ben_180=fa_recup_dico("ben_180");
$vl_c_ben_181=fa_recup_dico("ben_181");
$vl_c_ben_182=fa_recup_dico("ben_182");
$vl_c_ben_183=fa_recup_dico("ben_183");
$vl_c_ben_184=fa_recup_dico("ben_184");
$vl_c_ben_185=fa_recup_dico("ben_185");
$vl_c_ben_186=fa_recup_dico("ben_186");
$vl_c_ben_187=fa_recup_dico("ben_187");
$vl_c_ben_188=fa_recup_dico("ben_188");
$vl_c_ben_189=fa_recup_dico("ben_189");
$vl_c_ben_192=fa_recup_dico("ben_192");
$vl_c_ben_193=fa_recup_dico("ben_193");
$vl_c_ben_194=fa_recup_dico("ben_194");
$vl_c_ben_195=fa_recup_dico("ben_195");
$vl_c_ben_196=fa_recup_dico("ben_196");$vl_c_ben_196="Créer une alerte";
$vl_c_ben_197=fa_recup_dico("ben_197");$vl_c_ben_197="J - 1";
$vl_c_ben_198=fa_recup_dico("ben_198");$vl_c_ben_198="Créer une alerte J - 1";
$vl_c_ben_199=fa_recup_dico("ben_199");$vl_c_ben_199="Action à l'origine de l'alerte";
$vl_c_ben_200=fa_recup_dico("ben_200");$vl_c_ben_200="Ajouter à un dossier";
$vl_c_ben_201=fa_recup_dico("ben_201");$vl_c_ben_201="Répondre au formulaire en texte";
$vl_c_ben_202=fa_recup_dico("ben_202");$vl_c_ben_202="Répondre au formulaire en HTML";
$vl_c_ben_203=fa_recup_dico("ben_203");$vl_c_ben_203="Brouillon de courriel";


$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00058=fa_recup_dico("dico_00058");
$vl_c_dico_00059=fa_recup_dico("dico_00059");
$vl_c_dico_00073=fa_recup_dico("dico_00073");
if(( ($vl_c_genreaction=="jenesaispas")||($vl_c_genreaction=="generique")||($vl_c_genreaction=="toutes_principales")||($vl_c_genreaction=="toutes_traitements")) && ($vl_action_cleunik!=-1)) {
  $sql_req="SELECT choix_cleunik from _actions where action_cleunik=$vl_action_cleunik;";
  $result = _graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  switch ($row['choix_cleunik']) {
    case -110100:$vl_c_genreaction="generique";break;
    case -110101:$vl_c_genreaction="emimail";break;
    case -110102:$vl_c_genreaction="recmail";break;
    case -110103:$vl_c_genreaction="emimail";break;
    case -110104:$vl_c_genreaction="recmail_erreur";break;
    case -110105:$vl_c_genreaction="generique";break;
    case -110106:$vl_c_genreaction="rectel";break;
    case -110107:$vl_c_genreaction="emitel";break;
    case -110108:$vl_c_genreaction="cdecli";break;
    case -110109:$vl_c_genreaction="cdefou";break;
    case -110110:$vl_c_genreaction="livcli";break;
    case -110111:$vl_c_genreaction="recfou";break;
    case -110112:$vl_c_genreaction="faccli";break;
    case -110113:$vl_c_genreaction="facfou";break;
    case -110114:$vl_c_genreaction="offcli";break;
    case -110115:$vl_c_genreaction="demfou";break;
    case -110116:$vl_c_genreaction="avocli";break;
    case -110117:$vl_c_genreaction="avofin";break;
    case -110118:$vl_c_genreaction="chat";break;
    case -110119:$vl_c_genreaction="fabrica";break;
    case -110120:$vl_c_genreaction="recmail_lecture";break;
    case -110121:$vl_c_genreaction="emimail_ar";break;
    case -110122:$vl_c_genreaction="emailing";break;
    case -110123:$vl_c_genreaction="formul";break;
	case -110124:$vl_c_genreaction="desins_mail";break;
	case -110125:$vl_c_genreaction="recvoc";break;
	case -110126:$vl_c_genreaction="recfax";break;
	case -110127:$vl_c_genreaction="remban";break;
	case -110128:$vl_c_genreaction="emifax";break;
	case -110129:$vl_c_genreaction="emisms";break;
	case -110130:$vl_c_genreaction="post_it";break;
	case -110131:$vl_c_genreaction="bordex";break;
	case -110132:$vl_c_genreaction="emailing_track";break;
	case -110133:$vl_c_genreaction="retcli";break;
	case -110134:$vl_c_genreaction="retfou";break;
	case -110135:$vl_c_genreaction="relfou";break;
	case -110137:$vl_c_genreaction="avofou";break;
    case -110138:$vl_c_genreaction="avofif";break;
    case -110139:$vl_c_genreaction="alertes";break;
    case -110140:$vl_c_genreaction="emimail_brouillon";break;
    case -110141:$vl_c_genreaction="reponse_sondage";break;
    default:$vl_c_genreaction="generique";break;
  }
  _graal_libere_requete_bd($result);
}
$tab_key=array();
$vl_k_ben_101=fa_cree_raccourcis($vl_c_ben_101,$tab_key);
$vl_k_ben_102=fa_cree_raccourcis($vl_c_ben_102,$tab_key);
$vl_k_ben_103=fa_cree_raccourcis($vl_c_ben_103,$tab_key);
$vl_k_ben_104=fa_cree_raccourcis($vl_c_ben_104,$tab_key);
$vl_k_ben_125=fa_cree_raccourcis($vl_c_ben_125,$tab_key);
$vl_k_nomcomplet=fa_cree_raccourcis($vl_e_nomcomplet,$tab_key);
$vl_k_dico_00058=fa_cree_raccourcis($vl_c_dico_00058,$tab_key);
$vl_k_dico_00059=fa_cree_raccourcis($vl_c_dico_00059,$tab_key);
$vl_k_dico_00073=fa_cree_raccourcis($vl_c_dico_00073,$tab_key);
switch ($vl_c_genreaction){
  case "offcli":$vl_k_ben_128=fa_cree_raccourcis($vl_c_ben_128,$tab_key);break;
  case "cdecli":$vl_k_ben_129=fa_cree_raccourcis($vl_c_ben_129,$tab_key);break;
  case "livcli":$vl_k_ben_130=fa_cree_raccourcis($vl_c_ben_130,$tab_key);break;
  case "faccli":$vl_k_ben_131=fa_cree_raccourcis($vl_c_ben_131,$tab_key);break;
  case "avocli":$vl_k_ben_136=fa_cree_raccourcis($vl_c_ben_136,$tab_key);break;
  case "avofin":$vl_k_ben_136=fa_cree_raccourcis($vl_c_ben_136,$tab_key);break;
  case "demfou":$vl_k_ben_132=fa_cree_raccourcis($vl_c_ben_132,$tab_key);break;
  case "cdefou":$vl_k_ben_133=fa_cree_raccourcis($vl_c_ben_133,$tab_key);break;
  case "recfou":$vl_k_ben_134=fa_cree_raccourcis($vl_c_ben_134,$tab_key);break;
  case "facfou":$vl_k_ben_135=fa_cree_raccourcis($vl_c_ben_135,$tab_key);break;
  case "chat"  :$vl_k_ben_137=fa_cree_raccourcis($vl_c_ben_137,$tab_key);break;
  case "emimail":$vl_k_ben_138=fa_cree_raccourcis($vl_c_ben_138,$tab_key);break;
  case "emimail_ar":$vl_k_ben_142=fa_cree_raccourcis($vl_c_ben_142,$tab_key);break;
  case "emailing":$vl_k_ben_144=fa_cree_raccourcis($vl_c_ben_144,$tab_key);break;
  case "recmail":$vl_k_ben_139=fa_cree_raccourcis($vl_c_ben_139,$tab_key);break;
  case "recmail_lecture":$vl_k_ben_140=fa_cree_raccourcis($vl_c_ben_140,$tab_key);break;
  case "recmail_erreur":$vl_k_ben_141=fa_cree_raccourcis($vl_c_ben_141,$tab_key);break;
	case "fabrica":$vl_k_ben_153=fa_cree_raccourcis($vl_c_ben_153,$tab_key);break;
	case "recvoc":$vl_k_ben_155=fa_cree_raccourcis($vl_c_ben_155,$tab_key);break;
	case "recfax":$vl_k_ben_156=fa_cree_raccourcis($vl_c_ben_156,$tab_key);break;
	case "remban":$vl_k_ben_157=fa_cree_raccourcis($vl_c_ben_157,$tab_key);break;
	case "emifax":$vl_k_ben_187=fa_cree_raccourcis($vl_c_ben_187,$tab_key);break;
	case "emisms":$vl_k_ben_188=fa_cree_raccourcis($vl_c_ben_188,$tab_key);break;
	case "bordex":$vl_k_ben_189=fa_cree_raccourcis($vl_c_ben_189,$tab_key);break;
  case "retcli":$vl_k_ben_192=fa_cree_raccourcis($vl_c_ben_192,$tab_key);break;
  case "retfou":$vl_k_ben_193=fa_cree_raccourcis($vl_c_ben_193,$tab_key);break;
  case "relfou":$vl_k_ben_194=fa_cree_raccourcis($vl_c_ben_194,$tab_key);break;
  case "avofou":$vl_k_ben_195=fa_cree_raccourcis($vl_c_ben_195,$tab_key);break;
  case "avofif":$vl_k_ben_195=fa_cree_raccourcis($vl_c_ben_195,$tab_key);break;
  case "alertes":$vl_k_ben_199=fa_cree_raccourcis($vl_c_ben_199,$tab_key);break;
  case "emimail_brouillon":$vl_k_ben_203=fa_cree_raccourcis($vl_c_ben_203,$tab_key);break;
  case "generique":
  case "post_it":
  case "emailing_track":
  case "reponse_sondage":
  default:
    break;  //  Toutes les actions génériques
}
switch ($vf_c_action) {
  case 'ajouter' : $ml_genre_actions=fa_brik_menulist_choix('94B',1,-1,1,'','ml_genre_action',"broadcaster_01",0);break;
  case 'modifier' :
  case 'ajoutermodifier' :
  case 'selectionner' :
    $ml_genre_actions=fa_brik_menulist_choix('94C',1,-1,-1,'','ml_genre_action',"broadcaster_01",0);break;
}
$ml_statu_actions=fa_brik_menulist_choix('124',1,-1,-1,'','ml_statut_action',"broadcaster_01",0);
$ml_confidentialite_actions=fa_brik_menulist_choix('122',1,-1,-1,'','ml_confidentialite_action',"broadcaster_01",0);
$ml_priorite_actions=fa_brik_menulist_choix('123',1,-1,-1,'','ml_priorite_action',"broadcaster_01",0);
$menu_rss_action=fa_brik_ajout_rss_action("1","","broadcaster_01","pf_ajoute_rss");
$vl_c_bloc_tel=false;

switch ($vl_c_genreaction){
	case "offcli":
	case "cdecli":
	case "livcli":
	case "demfou":
	case "cdefou":
	case "recfou":
	case "facfou":
	case "retcli":
	case "retfou":
	case "relfou":
		$sql_req="SELECT f1.commercial_cleunik,f2.typeacteur,f2.act_cleunik from _".$vl_c_genreaction."_entetes f1 left join _acteurs f2 using(act_cleunik) where action_cleunik=$vl_action_cleunik;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    $commercial_cleunik=$row['commercial_cleunik'];
	    $typeacteur=$row['typeacteur'];
	    $commercial_act_cleunik=$row['act_cleunik'];
	    _graal_libere_requete_bd($result);
	    break;
  	case "avocli":
	case "avofin":
	    $sql_req="SELECT f1.commercial_cleunik,f2.typeacteur,f2.act_cleunik from _avocli_entetes f1 left join _acteurs f2 using(act_cleunik) where action_cleunik=$vl_action_cleunik;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    $commercial_cleunik=$row['commercial_cleunik'];
	    $typeacteur=$row['typeacteur'];
	    $commercial_act_cleunik=$row['act_cleunik'];
	    _graal_libere_requete_bd($result);
	    break;
	case "avofou":
	case "avofif":
	    $sql_req="SELECT f1.commercial_cleunik,f2.typeacteur,f2.act_cleunik from _avofou_entetes f1 left join _acteurs f2 using(act_cleunik) where action_cleunik=$vl_action_cleunik;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    $commercial_cleunik=$row['commercial_cleunik'];
	    $typeacteur=$row['typeacteur'];
	    $commercial_act_cleunik=$row['act_cleunik'];
	    _graal_libere_requete_bd($result);
	    break;
  	case "faccli":
	    $sql_req="SELECT f1.commercial_cleunik,f1.fact_genr,f2.typeacteur,f2.act_cleunik from _".$vl_c_genreaction."_entetes f1 left join _acteurs f2 using(act_cleunik) where action_cleunik=$vl_action_cleunik;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    $commercial_cleunik=$row['commercial_cleunik'];
	    $typeacteur=$row['typeacteur'];
		$fact_genr=$row['fact_genr'];
		$commercial_act_cleunik=$row['act_cleunik'];
	    _graal_libere_requete_bd($result);
	    break;
	case "rectel":
		$sql_req="SELECT count(*) as nombre from _graal where action_cleunik=$vl_action_cleunik and choix_cleunik=-110406;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    if ($row['nombre']==0) {$vl_c_bloc_tel=true;}
	    _graal_libere_requete_bd($result);
		break;
	case "recvoc":
		$sql_req="SELECT count(*) as nombre from _graal where action_cleunik=$vl_action_cleunik and choix_cleunik=-110431;";
	    $result = _graal_requete_bd($sql_req);
	    $row = mysql_fetch_assoc($result);
	    if ($row['nombre']==0) {$vl_c_bloc_tel=true;}
	    _graal_libere_requete_bd($result);
		break;
	case "remban":
		$sql_req="SELECT remise_cleunik FROM _treso_remise where action_cleunik=$vl_action_cleunik";
		$result = _graal_requete_bd($sql_req);
		$row = mysql_fetch_assoc($result);
		$remise_banque_cleunik=$row['remise_cleunik'];
		_graal_libere_requete_bd($result);
		break;
	case "chat":
    	break;
	default:
    	break;  //  Toutes les actions génériques
}
$vl_tc_composants=array($vl_c_id_fenetre,$id_inc_actions_criteres_entreprise,$id_inc_actions_criteres_moi,$id_inc_actions_criteres_autres,$id_inc_actions_criteres_tous,$id_inc_ged,$id_inc_actions_graal,$vl_c_id_inc_actions_relations);
switch ($vl_c_genreaction){
  case "offcli":
		switch ($param_generaux_graal_045){
			case 1:$inc_doc_cial="_graal_inc_actions_offcli_02.php";$id_fen_doc_cial="Fen_00780";break;
			case 2:$inc_doc_cial="_graal_inc_actions_offcli.php";$id_fen_doc_cial="Fen_00671";break;
			case 3:$inc_doc_cial="_graal_inc_actions_offcli.php";$id_fen_doc_cial="Fen_00671";break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
  case "cdecli":
		switch ($param_generaux_graal_046){
			case 1:$inc_doc_cial="_graal_inc_actions_cdecli_02.php";$id_fen_doc_cial="Fen_00781";break;
			case 2:$inc_doc_cial="_graal_inc_actions_cdecli.php";$id_fen_doc_cial="Fen_00477";break;
			case 3:$inc_doc_cial="_graal_inc_actions_cdecli.php";$id_fen_doc_cial="Fen_00477";break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
  case "livcli":
		/*
		 * Il n'est pas prévu, au 25 janvier 2009 de gérer des livraisons sur un type 1-> Services-Prestations
		 */
		$inc_doc_cial="_graal_inc_actions_livcli.php";
		$id_fen_doc_cial="Fen_00672";
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
	case "retcli":
		switch ($param_generaux_graal_103){
			case 1:$inc_doc_cial="_graal_inc_actions_retcli.php";$id_fen_doc_cial="Fen_01106";break;
			case 2:$inc_doc_cial="_graal_inc_actions_retcli.php";$id_fen_doc_cial="Fen_01091";break;
			case 3:$inc_doc_cial="_graal_inc_actions_retcli.php";$id_fen_doc_cial="Fen_01091";break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
	case "bordex":
		/*
		 * Il n'est pas prévu, au 5 octobre 2009 de gérer des livraisons sur un type 1-> Services-Prestations
		 */
		$inc_doc_cial="_graal_inc_actions_bordex.php";
		$id_fen_doc_cial="Fen_01061";
		$id_inc_actions_recherche="Div_00573";
		$vl_tc_composants[7]=$id_fen_doc_cial;
		$vl_tc_composants[8]=$id_inc_actions_recherche;
		break;
  case "faccli":
		switch ($param_generaux_graal_048){
			case 1:
				$inc_doc_cial="_graal_inc_actions_faccli_02.php";
				if ($fact_genr==1) {
					$id_fen_doc_cial="Fen_00782";
				} else {
					$id_fen_doc_cial="Fen_00783";
				}
				break;
			case 2:
				$inc_doc_cial="_graal_inc_actions_faccli.php";
				if ($fact_genr==1) {
					$id_fen_doc_cial="Fen_00673";
				} else {
					$id_fen_doc_cial="Fen_00742";
				}
				break;
			case 3:
				$inc_doc_cial="_graal_inc_actions_faccli.php";
				if ($fact_genr==1) {
					$id_fen_doc_cial="Fen_00673";
				} else {
					$id_fen_doc_cial="Fen_00742";
				}
				break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
  case "avocli":
  case "avofin":
		switch ($param_generaux_graal_048){
			case 1:$inc_doc_cial="_graal_inc_actions_avocli_02.php";$id_fen_doc_cial="Fen_00784";break;
			case 2:$inc_doc_cial="_graal_inc_actions_avocli.php";$id_fen_doc_cial="Fen_00674";break;
			case 3:$inc_doc_cial="_graal_inc_actions_avocli.php";$id_fen_doc_cial="Fen_00674";break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
	case "avofou":
  	case "avofif":
		switch ($param_generaux_graal_136){
			case 1:$inc_doc_cial="_graal_inc_actions_avofou_02.php";$id_fen_doc_cial="Fen_01140";break;
			case 2:$inc_doc_cial="_graal_inc_actions_avofou.php";$id_fen_doc_cial="Fen_01139";break;
			case 3:$inc_doc_cial="_graal_inc_actions_avofou.php";$id_fen_doc_cial="Fen_01139";break;
		}
		$vl_tc_composants[7]=$id_fen_doc_cial;
		break;
  case "demfou":$inc_doc_cial="_graal_inc_actions_demfou.php";$id_fen_doc_cial="Fen_00675";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "cdefou":$inc_doc_cial="_graal_inc_actions_cdefou.php";$id_fen_doc_cial="Fen_00676";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "relfou":$inc_doc_cial="_graal_inc_actions_relfou.php";$id_fen_doc_cial="Fen_01134";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "recfou":$inc_doc_cial="_graal_inc_actions_recfou.php";$id_fen_doc_cial="Fen_00763";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "retfou":$inc_doc_cial="_graal_inc_actions_retfou.php";$id_fen_doc_cial="Fen_01092";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "facfou":$inc_doc_cial="_graal_inc_actions_facfou.php";$id_fen_doc_cial="Fen_00764";$vl_tc_composants[7]=$id_fen_doc_cial;break;
  case "emimail":
  case "emimail_ar":
  case "emimail_brouillon":
    $inc_doc_courriel="_graal_inc_courriel.php";$id_inc_courriel="Div_00473";$vl_tc_composants[7]=$id_inc_courriel;break;
  case "emailing":
    $inc_doc_courriel="_graal_inc_emailing.php";$id_inc_courriel="Div_00497";$vl_tc_composants[7]=$id_inc_courriel;break;
  case "recmail":
  case "recmail_lecture":
  case "recmail_erreur":
    $inc_doc_courriel="_graal_inc_courriel_recus.php";$id_inc_courriel="Div_00472";$vl_tc_composants[7]=$id_inc_courriel;$voir_bloc_reponse=true;break;
	case "fabrica":$inc_doc_fabr="_graal_inc_actions_fabric.php";$id_fen_doc_fabr="Fen_00765";$vl_tc_composants[7]=$id_fen_doc_fabr;break;
	case "recvoc":
    $inc_doc_recvoc="_graal_inc_messages_vocaux_recus.php";$id_inc_courriel="Div_00546";$vl_tc_composants[7]=$id_inc_courriel;$voir_bloc_reponse=true;break;
	case "recfax":
    $inc_doc_courriel="_graal_inc_fax_recus.php";$id_inc_courriel="Div_00548";$vl_tc_composants[7]=$id_inc_courriel;$voir_bloc_reponse=true;break;
	case "remban":
    $inc_doc_courriel="_graal_inc_remise_banques.php";$id_inc_remise_banque="Div_00561";$vl_tc_composants[7]=$id_inc_remise_banque;$voir_bloc_reponse=false;break;
	case "emifax":
    $inc_doc_courriel="_graal_inc_fax_emis.php";$id_inc_courrel="Div_00571";$vl_tc_composants[7]=$id_inc_courriel;$voir_bloc_reponse=false;break;
	case "emisms":
    $inc_doc_courriel="";$id_inc_remise_banque="Div_xxxxx";$vl_tc_composants[7]=$id_inc_remise_banque;$voir_bloc_reponse=false;break;
    case "alertes":
    	$inc_alertes="_graal_inc_action_alertes.php";$voir_bloc_reponse=false;
    	$sql_req="SELECT action_cleunik_droite FROM _graal_act where action_cleunik_gauche=$vl_action_cleunik;";
		$result = _graal_requete_bd($sql_req);
		$row = mysql_fetch_assoc($result);
		$vl_action_cleunik_origine_alerte=$row['action_cleunik_droite'];
		_graal_libere_requete_bd($result);

    	break;
    case "formul":
    	$vl_c_bloc_transfert="";
		$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00246",$vl_e_uti_cleunik);
		$vl_tb_droits[0]=true;
		if ($vl_tb_droits[0]==true) {
		  $vl_c_bloc_transfert.="<toolbarbutton id='bt_emimail_formule_text' class='aj19' tooltiptext='$vl_c_ben_201' oncommand='pf_formulaire_repondre(\"formulaire\",\"texte\");'/>";
		  $vl_c_bloc_transfert.="<toolbarbutton id='bt_emimail_formule_html' class='aj19' tooltiptext='$vl_c_ben_202' oncommand='pf_formulaire_repondre(\"formulaire\",\"html\");'/>";
		}
    	break;
	case "post_it":
	case "emailing_track":
	case "reponse_sondage":
	default:
    break;  //  Toutes les actions génériques
}
$vl_c_tel="";
switch ($vl_c_genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
  case "avofin":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "retcli":
  case "retfou":
  case "relfou":
  case "avofou":
  case "avofif":
    $vl_tb_droits_cial=_graal_requete_droits_fenetre($id_fen_doc_cial,$vl_e_uti_cleunik);
    if ($vl_tb_droits_cial[0]==false) {fa_redirige("acces_interdit");}
    break;
	case "remban":
    $vl_tb_droits_cial=_graal_requete_droits_fenetre("Fen_00954",$vl_e_uti_cleunik);
    if ($vl_tb_droits_cial[0]==false) {fa_redirige("acces_interdit");}
    break;
	case "rectel":
	case "recvoc":
		if ($vl_c_bloc_tel==true) {
//	menu contextuel sur téléphone
$vl_menu_tel="<menupopup id='ml_reponse_tel'>";
$vl_menu_tel.="<menuitem class='menuitem-iconic ai18' id='mi_voir_deja_rectel' label='$vl_c_ben_186' oncommand='pf_rectel_voir_deja_reftel(\"tb_telformate_tel_00\");'/>";// Voir les résultatts
$vl_menu_tel.="<menuitem class='menuitem-iconic aa04' id='mi_cher_deja_rectel' label='$vl_c_ben_159' oncommand='pf_rectel_verifie_deja_tel_00();'/>";// Voir les résultatts
$vl_menu_tel.="<menu class='menuitem-iconic ak17' label='$vl_c_ben_162'>";
$vl_menu_tel.="<menupopup>";
$vl_menu_tel.="<menuitem class='menuitem-iconic ai18' label='$vl_c_ben_186' oncommand='pf_rectel_ajoute_tel(\"tousss\",\"1\");'/>";// sélection de tous les interlocuteurs
$vl_tb_droits_e2=_graal_requete_droits_fenetre("Fen_00149",$vl_e_uti_cleunik);if ($vl_tb_droits_e2[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be01' label='$vl_c_ben_164' oncommand='pf_rectel_ajoute_tel(\"110001\",\"1\");'/>";}//Téléphones des interlocuteurs prospects clients
$vl_tb_droits_e3=_graal_requete_droits_fenetre("Fen_00150",$vl_e_uti_cleunik);if ($vl_tb_droits_e3[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be03' label='$vl_c_ben_165' oncommand='pf_rectel_ajoute_tel(\"110002\",\"1\");'/>";}//  Téléphones des interlocuteurs prospects fournisseurs
$vl_tb_droits_e4=_graal_requete_droits_fenetre("Fen_00151",$vl_e_uti_cleunik);if ($vl_tb_droits_e4[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic bd09' label='$vl_c_ben_166' oncommand='pf_rectel_ajoute_tel(\"110003\",\"1\");'/>";}//  Téléphones des interlocuteurs clients
$vl_tb_droits_e5=_graal_requete_droits_fenetre("Fen_00152",$vl_e_uti_cleunik);if ($vl_tb_droits_e5[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be02' label='$vl_c_ben_167' oncommand='pf_rectel_ajoute_tel(\"110004\",\"1\");'/>";}//  Téléphones des interlocuteurs fournisseurs
$vl_tb_droits_e6=_graal_requete_droits_fenetre("Fen_00153",$vl_e_uti_cleunik);if ($vl_tb_droits_e6[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be04' label='$vl_c_ben_168' oncommand='pf_rectel_ajoute_tel(\"110005\",\"1\");'/>";}//  Téléphones des interlocuteurs autres acteurs
$vl_tb_droits_e7=_graal_requete_droits_fenetre("Fen_00154",$vl_e_uti_cleunik);if ($vl_tb_droits_e7[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be05' label='$vl_c_ben_169' oncommand='pf_rectel_ajoute_tel(\"110006\",\"1\");'/>";}//  Téléphones des interlocuteurs acteurs indéterminés
$vl_tb_droits_e1=_graal_requete_droits_fenetre("Fen_00147",$vl_e_uti_cleunik);if ($vl_tb_droits_e1[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic be06' label='$vl_c_ben_163' oncommand='pf_rectel_ajoute_tel(\"110000\",\"1\");'/>";}//Téléphones des interlocuteurs des Membres de l'entreprise
$vl_menu_tel.="</menupopup></menu>";
$vl_menu_tel.="<menu class='menuitem-iconic ak17' label='$vl_c_ben_178'><menupopup>";
$vl_menu_tel.="<menuitem class='menuitem-iconic ai15' label='$vl_c_ben_178' oncommand='pf_rectel_ajoute_tel(\"tousss\",\"2\");'/>";// sélection de tous les acteurs
$vl_tb_droits_f2=_graal_requete_droits_fenetre("Fen_00976",$vl_e_uti_cleunik);if ($vl_tb_droits_f2[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba02' label='$vl_c_ben_171' oncommand='pf_rectel_ajoute_tel(\"110001\",\"2\");'/>";}//interlocuteurs prospects clients
$vl_tb_droits_f3=_graal_requete_droits_fenetre("Fen_00977",$vl_e_uti_cleunik);if ($vl_tb_droits_f3[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba04' label='$vl_c_ben_172' oncommand='pf_rectel_ajoute_tel(\"110002\",\"2\");'/>";}//interlocuteurs prospects fournisseurs
$vl_tb_droits_f4=_graal_requete_droits_fenetre("Fen_00978",$vl_e_uti_cleunik);if ($vl_tb_droits_f4[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba01' label='$vl_c_ben_173' oncommand='pf_rectel_ajoute_tel(\"110003\",\"2\");'/>";}//interlocuteurs clients
$vl_tb_droits_f5=_graal_requete_droits_fenetre("Fen_00979",$vl_e_uti_cleunik);if ($vl_tb_droits_f5[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba03' label='$vl_c_ben_174' oncommand='pf_rectel_ajoute_tel(\"110004\",\"2\");'/>";}//interlocuteurs fournisseurs
$vl_tb_droits_f6=_graal_requete_droits_fenetre("Fen_00980",$vl_e_uti_cleunik);if ($vl_tb_droits_f6[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba05' label='$vl_c_ben_175' oncommand='pf_rectel_ajoute_tel(\"110005\",\"2\");'/>";}//interlocuteurs autres acteurs
$vl_tb_droits_f7=_graal_requete_droits_fenetre("Fen_00981",$vl_e_uti_cleunik);if ($vl_tb_droits_f7[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba06' label='$vl_c_ben_176' oncommand='pf_rectel_ajoute_tel(\"110006\",\"2\");'/>";}//interlocuteurs acteurs indéterminés
$vl_tb_droits_f1=_graal_requete_droits_fenetre("Fen_00975",$vl_e_uti_cleunik);if ($vl_tb_droits_f1[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ba07' label='$vl_c_ben_170' oncommand='pf_rectel_ajoute_tel(\"110000\",\"2\");'/>";}//Membres de l'entreprise
$vl_menu_tel.="</menupopup></menu>";
$vl_menu_tel.="<menu class='menuitem-iconic ak17' label='$vl_c_ben_177'><menupopup>";
$vl_tb_droits_g1=_graal_requete_droits_fenetre("Fen_00982",$vl_e_uti_cleunik);if ($vl_tb_droits_g1[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai17' label='$vl_c_ben_179' oncommand='pf_rectel_ajoute_tel(\"110001\",\"3\");'/>";}//prospects clients
$vl_tb_droits_g2=_graal_requete_droits_fenetre("Fen_00983",$vl_e_uti_cleunik);if ($vl_tb_droits_g2[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ah10' label='$vl_c_ben_180' oncommand='pf_rectel_ajoute_tel(\"110002\",\"3\");'/>";}//prospects fournisseurs
$vl_tb_droits_g3=_graal_requete_droits_fenetre("Fen_00984",$vl_e_uti_cleunik);if ($vl_tb_droits_g3[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai14' label='$vl_c_ben_181' oncommand='pf_rectel_ajoute_tel(\"110003\",\"3\");'/>";}//clients
$vl_tb_droits_g4=_graal_requete_droits_fenetre("Fen_00985",$vl_e_uti_cleunik);if ($vl_tb_droits_g4[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ah06' label='$vl_c_ben_182' oncommand='pf_rectel_ajoute_tel(\"110004\",\"3\");'/>";}//fournisseurs
$vl_tb_droits_g5=_graal_requete_droits_fenetre("Fen_00986",$vl_e_uti_cleunik);if ($vl_tb_droits_g5[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai16' label='$vl_c_ben_183' oncommand='pf_rectel_ajoute_tel(\"110005\",\"3\");'/>";}//autres acteurs
$vl_tb_droits_g6=_graal_requete_droits_fenetre("Fen_00987",$vl_e_uti_cleunik);if ($vl_tb_droits_g6[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic aj08' label='$vl_c_ben_184' oncommand='pf_rectel_ajoute_tel(\"110006\",\"3\");'/>";}//acteurs indéterminés
$vl_menu_tel.="</menupopup></menu>";
$vl_menu_tel.="<menu class='menuitem-iconic ak17' label='$vl_c_ben_185'><menupopup>";
$vl_tb_droits_d1=_graal_requete_droits_fenetre("Fen_00006",$vl_e_uti_cleunik);if ($vl_tb_droits_d1[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai17' label='$vl_c_ben_179' oncommand='pf_rectel_ajoute_tel(\"110001\",\"4\");'/>";}//prospects clients
$vl_tb_droits_d2=_graal_requete_droits_fenetre("Fen_00007",$vl_e_uti_cleunik);if ($vl_tb_droits_d2[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ah10' label='$vl_c_ben_180' oncommand='pf_rectel_ajoute_tel(\"110002\",\"4\");'/>";}//prospects fournisseurs
$vl_tb_droits_d3=_graal_requete_droits_fenetre("Fen_00002",$vl_e_uti_cleunik);if ($vl_tb_droits_d3[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai14' label='$vl_c_ben_181' oncommand='pf_rectel_ajoute_tel(\"110003\",\"4\");'/>";}//clients
$vl_tb_droits_d4=_graal_requete_droits_fenetre("Fen_00004",$vl_e_uti_cleunik);if ($vl_tb_droits_d4[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ah06' label='$vl_c_ben_182' oncommand='pf_rectel_ajoute_tel(\"110004\",\"4\");'/>";}//fournisseurs
$vl_tb_droits_d5=_graal_requete_droits_fenetre("Fen_00001",$vl_e_uti_cleunik);if ($vl_tb_droits_d5[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic ai16' label='$vl_c_ben_183' oncommand='pf_rectel_ajoute_tel(\"110005\",\"4\");'/>";}//autres acteurs
$vl_tb_droits_d6=_graal_requete_droits_fenetre("Fen_00005",$vl_e_uti_cleunik);if ($vl_tb_droits_d6[1]==true) {$vl_menu_tel.="<menuitem class='menuitem-iconic aj08' label='$vl_c_ben_184' oncommand='pf_rectel_ajoute_tel(\"110006\",\"4\");'/>";}//acteurs indéterminés
$vl_menu_tel.="</menupopup></menu>";
$vl_menu_tel.="</menupopup>";
		$vl_c_tel=<<<EOT
		<row flex="1">
      <label value="$vl_c_ben_158"/>
      <hbox flex="1">
				<textbox observes="broadcaster_01" flex= "1" id="tb_telformate_tel_00" value="" />
				<toolbarbutton observes="broadcaster_01" flex= "1" class="aa04" id="tb_tel_00_verif_deja" crop="end" tooltiptext="$vl_c_ben_159" label="$vl_c_ben_159" oncommand="pf_rectel_verifie_deja_tel_00();">
				$vl_menu_tel
				</toolbarbutton>
			</hbox>
		  </row>
EOT;
}
		break;
  default:
    break;  //  Toutes les autres actions
}
include("_graal_header_winxul.inc.php");
include("_graal_header_textfied.inc.php");
$vl_accordion='<?xml-stylesheet href="xbl/accordion.css?v=1.0" type="text/css"?>';
echo <<<END
$vl_accordion
<window context="graal_cp00" _graal_genreaction="$vl_c_genreaction" _graal_action_cleunik="$vl_action_cleunik" title="$vl_c_ben_100 $vl_c_genreaction" id="_win_fen_actions_02" onload="fa_aa(this);pf_aa_init()" onunload="pf_unload();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("js/_graal_actions_01.js.php");
include_once("js/_graal_01.js.php");
include_once("js/_graal_04.js.php");
include_once("js/_graal_07_ged.js.php");
switch ($vl_c_genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
  case "avofin":
  case "avofou":
  case "avofif":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "retcli":
  case "retfou":
  case "relfou":
    include("js/_graal_actions_cial.js.php");
    break;
  case "chat"  :
    include("js/_graal_actions_chat.js.php");
    break;
  case "emimail":
  case "emimail_ar":
  case "emimail_brouillon":
    include("js/_graal_actions_emimail.js.php");
    break;
  case "emailing":
    include("js/_graal_actions_emailing.js.php");
    break;
  case "recmail":
  case "recmail_lecture":
  case "recmail_erreur":
    include("js/_graal_actions_recmail.js.php");
    break;
	case "fabrica":
		include("js/_graal_actions_fabric.js.php");
		break;
	case "recvoc":
		include("js/_graal_actions_recvoc.js.php");
		include("js/_graal_actions_rectel.js.php");
		break;
	case "recfax":
    include("js/_graal_actions_recfax.js.php");
		break;
	case "remban":
    include("js/_graal_actions_remban.js.php");
		break;
	case "rectel":
    include("js/_graal_actions_rectel.js.php");
		break;
	case "emifax":
    	include("js/_graal_actions_emifax.js.php");
    	include("js/_graal_actions_recfax.js.php");		// pour gestion des accusé de réception de fax keyyo
		break;
	case "emisms":
    	include("js/_graal_actions_emisms.js.php");
		break;
	case "bordex":
    	include("js/_graal_actions_bordex.js.php");
		break;
	case "alertes":
		include("js/_graal_actions_alertes.js.php");
		break;
  case "generique":
  case "post_it":
  case "emailing_track":
  case "reponse_sondage":

  default:
    break;  //  Toutes les actions génériques
}
//$vl_selection_action_fenetre=1;
switch ($vl_selection_action_fenetre){
	case 1:
		$bloc_modele_01_01=<<<XOF
	<hbox >
               <label control="la_sujet" value="$vl_c_ben_126"/>
               <hbox flex="1">
               $vl_c_bloc_transfert
                <textbox flex="3" id="tb_sujet" observes="broadcaster_01"   onchange="pf_changement(this);"/>
                <label control="la_reference" value="$vl_c_ben_127"/>
                <textbox flex="1" id="tb_reference" observes="broadcaster_01"  />
              </hbox>
             </hbox>
XOF;
$bloc_modele_01_02=<<<XOF
<row>
              <spacer/>
								<hbox>
	                $ml_genre_actions
								<label value="$vl_c_ben_154" readonly="true"/>
                <radiogroup id='rdg_duree' value="2">
                  <hbox>
                    <radio id='ra_oui_duree' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
                    <radio id='ra_non_duree' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
                  </hbox>
                </radiogroup>
								</hbox>
             </row>
			 <row>
              <spacer/>
                <hbox>
                  <label value="$vl_c_ben_110"/>
  					<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_deb"/>
                  <label value="$vl_c_ben_111"/>
                  <toolbarbutton id="tb_debut_maintenant" class="ag04" tooltiptext="$vl_c_ben_121" oncommand="pf_maintenant(this.id)" observes="broadcaster_01"/>
				  <timepicker is24HourClock="true" id="tb_heu_deb" observes="broadcaster_01"/>
                  <label value="$vl_c_ben_112"/>
                  <toolbarbutton id="tb_fin_maintenant" class="ag04" tooltiptext="$vl_c_ben_122" oncommand="pf_maintenant(this.id)" observes="broadcaster_01"/>
            	  <datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_fin" />
                  <label value="$vl_c_ben_113"/>
				  <timepicker is24HourClock="true" id="tb_heu_fin" observes="broadcaster_01"/>
				  <toolbarbutton type="menu-button" id="tb_alerte" class="al19" tooltiptext="$vl_c_ben_196" observes="broadcaster_01">
                      <menupopup class="sans_icone" >
						<menuitem class="sans_icone" label="$vl_c_ben_197" tooltiptext="$vl_c_ben_198" oncommand="pf_alerte('1');"/>
                      </menupopup>
                    </toolbarbutton>


                </hbox>
             </row>
            <row >
              <spacer/>

             </row>
            <row>
             </row>

              <row>
               <spacer/>
                <hbox>
                    <label value="$vl_c_ben_114"/>$ml_statu_actions
                    <label value="$vl_c_ben_115"/>$ml_confidentialite_actions
                    <label value="$vl_c_ben_116"/>$ml_priorite_actions
                </hbox>
              </row>
XOF;
		break;
	case 2:
$bloc_modele_01_01=<<<XOF
<vbox>
<hbox>

	$ml_genre_actions
               <label control="la_sujet" value="$vl_c_ben_126"/>
               <hbox flex="1">
				$vl_c_bloc_transfert
                <textbox flex="3" id="tb_sujet" observes="broadcaster_01"   onchange="pf_changement(this);"/>
                <label control="la_reference" value="$vl_c_ben_127"/>
                <textbox flex="1" id="tb_reference" observes="broadcaster_01"  />
              </hbox>
             </hbox>

			<row>
                <hbox flex="1">
                  <label value="$vl_c_ben_110"/>
  					<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_deb"/>
                  <label value="$vl_c_ben_111"/>
                  <toolbarbutton id="tb_debut_maintenant" class="ag04" tooltiptext="$vl_c_ben_121" oncommand="pf_maintenant(this.id)" observes="broadcaster_01"/>
				  <timepicker is24HourClock="true" id="tb_heu_deb" observes="broadcaster_01"/>
                  <label value="$vl_c_ben_112"/>
                  <toolbarbutton id="tb_fin_maintenant" class="ag04" tooltiptext="$vl_c_ben_122" oncommand="pf_maintenant(this.id)" observes="broadcaster_01"/>
            	  <datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dat_fin" />
                  <label value="$vl_c_ben_113"/>
				  <timepicker is24HourClock="true" id="tb_heu_fin" observes="broadcaster_01"/>
				  <toolbarbutton type="menu-button" id="tb_alerte" class="al19" tooltiptext="$vl_c_ben_196" observes="broadcaster_01">
                      <menupopup class="sans_icone" >
						<menuitem class="sans_icone" label="$vl_c_ben_197" tooltiptext="$vl_c_ben_198" oncommand="pf_alerte('1');"/>
                      </menupopup>
                    </toolbarbutton>
				  <label value="$vl_c_ben_154" readonly="true"/>
                <radiogroup id='rdg_duree' value="2">
                  <vbox>
                    <radio id='ra_oui_duree' label="$vl_c_dico_00013" value='1' observes="broadcaster_01"/>
                    <radio id='ra_non_duree' label="$vl_c_dico_00014" value='2' observes="broadcaster_01"/>
                  </vbox>
                </radiogroup>

                </hbox>
             </row>
             <row>
                <hbox flex="1">
                    <label value="$vl_c_ben_114"/>$ml_statu_actions
                    <label value="$vl_c_ben_115"/>$ml_confidentialite_actions
                    <label value="$vl_c_ben_116"/>$ml_priorite_actions
                </hbox>
              </row>
      </vbox>
XOF;
$bloc_modele_01_02=<<<XOF
XOF;
		break;
}

echo <<<END
<broadcasterset><broadcaster id="broadcaster_01" /><broadcaster id="broadcaster_02" /></broadcasterset>
  <hbox flex="1">
  <tabbox id="tabbox_01" flex="1" orient="vertical" class="overflow_01">
    <tabs id="tab_infogene">
       <tab class="af08" id="tab_edition" linkedpanel="tabpanel_edition" first-tab="true" label="$vl_c_ben_101" selected="true" accesskey="$vl_k_ben_101"/>

END;
switch ($vl_c_genreaction){
  case "offcli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_128.'" accesskey="'.$vl_k_ben_128.'"/>');break;
  case "cdecli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_129.'" accesskey="'.$vl_k_ben_129.'"/>');break;
  case "livcli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_130.'" accesskey="'.$vl_k_ben_130.'"/>');break;
  case "bordex":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_189.'" accesskey="'.$vl_k_ben_189.'"/>');break;
  case "faccli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_131.'" accesskey="'.$vl_k_ben_131.'"/>');break;
  case "avocli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_136.'" accesskey="'.$vl_k_ben_136.'"/>');break;
  case "avofin":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_136.'" accesskey="'.$vl_k_ben_136.'"/>');break;
  case "demfou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_132.'" accesskey="'.$vl_k_ben_132.'"/>');break;
  case "cdefou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_133.'" accesskey="'.$vl_k_ben_133.'"/>');break;
  case "recfou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_134.'" accesskey="'.$vl_k_ben_134.'"/>');break;
  case "facfou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_135.'" accesskey="'.$vl_k_ben_135.'"/>');break;
  case "retcli":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_192.'" accesskey="'.$vl_k_ben_192.'"/>');break;
  case "retfou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_193.'" accesskey="'.$vl_k_ben_193.'"/>');break;
  case "relfou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_194.'" accesskey="'.$vl_k_ben_194.'"/>');break;
  case "avofou":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_195.'" accesskey="'.$vl_k_ben_195.'"/>');break;
  case "avofif":echo('<tab id="tab_doc_cial" linkedpanel="tabpanel_doc_cial" label="'.$vl_c_ben_195.'" accesskey="'.$vl_k_ben_195.'"/>');break;
  case "chat"  :echo('<tab id="tab_chat" linkedpanel="tabpanel_chat" label="'.$vl_c_ben_137.'" class="ag06" accesskey="'.$vl_k_ben_137.'"/>');break;
  case "emimail":echo('<tab id="tab_emimail" linkedpanel="tabpanel_emimail" label="'.$vl_c_ben_138.'" class="ah09" accesskey="'.$vl_k_ben_138.'"/>');break;
  case "emimail_ar":echo('<tab id="tab_emimail" linkedpanel="tabpanel_emimail" label="'.$vl_c_ben_142.'" class="ah09" accesskey="'.$vl_k_ben_142.'"/>');break;
  case "emimail_brouillon":echo('<tab id="tab_emimail" linkedpanel="tabpanel_emimail" label="'.$vl_c_ben_203.'" class="ah09" accesskey="'.$vl_k_ben_203.'"/>');break;
  case "emailing":echo('<tab id="tab_emimail" linkedpanel="tabpanel_emimail" label="'.$vl_c_ben_144.'" class="ah09" accesskey="'.$vl_k_ben_144.'"/>');break;
  case "recmail":echo('<tab id="tab_recmail" linkedpanel="tabpanel_recmail" label="'.$vl_c_ben_139.'" class="ah11" accesskey="'.$vl_k_ben_139.'"/>');break;
  case "recmail_lecture":echo('<tab id="tab_recmail" linkedpanel="tabpanel_recmail" label="'.$vl_c_ben_140.'" class="ag06" accesskey="'.$vl_k_ben_140.'"/>');break;
  case "recmail_erreur":echo('<tab id="tab_recmail" linkedpanel="tabpanel_recmail" label="'.$vl_c_ben_141.'" class="ad19" accesskey="'.$vl_k_ben_141.'"/>');break;
	case "fabrica":echo('<tab id="tab_doc_fabr" linkedpanel="tabpanel_doc_fabr" label="'.$vl_c_ben_153.'" accesskey="'.$vl_k_ben_153.'"/>');break;
	case "recvoc":echo('<tab id="tab_doc_recvoc" linkedpanel="tabpanel_recvoc" label="'.$vl_c_ben_155.'" accesskey="'.$vl_k_ben_155.'"/>');break;
	case "recfax":echo('<tab id="tab_recmail" linkedpanel="tabpanel_recmail" label="'.$vl_c_ben_156.'" class="al03" accesskey="'.$vl_k_ben_156.'"/>');break;
	case "remban":echo('<tab id="tab_remban" linkedpanel="tabpanel_remban" label="'.$vl_c_ben_157.'" accesskey="'.$vl_k_ben_157.'"/>');break;
	case "emifax":echo('<tab id="tab_recmail" linkedpanel="tabpanel_recmail" label="'.$vl_c_ben_187.'" class="ah11" accesskey="'.$vl_k_ben_187.'"/>');break;
	case "emisms":echo('<tab id="tab_emisms" linkedpanel="tabpanel_emisms" label="'.$vl_c_ben_188.'" accesskey="'.$vl_k_ben_188.'"/>');break;
	case "alertes":echo('<tab id="tab_alertes" linkedpanel="tabpanel_alertes" label="'.$vl_c_ben_199.'" accesskey="'.$vl_k_ben_199.'"/>');break;
  case "generique":
  case "post_it":
  case "emailing_track":
  case "reponse_sondage":
  default:
    break;  //  Toutes les actions génériques
}
echo <<<END

       <tab id="tab_graal" class="ai15" linkedpanel="tabpanel_graal" label="$vl_c_ben_103" accesskey="$vl_k_ben_103"/>
       <tab id="tab_graal_actions" linkedpanel="tabpanel_graal_actions" label="$vl_c_ben_125" accesskey="$vl_k_ben_125"/>
       <tab id="tab_criteres" class="al01" linkedpanel="tabpanel_critere" label="$vl_c_ben_102" accesskey="$vl_k_ben_102"/>
       <tab id="tab_ged" class="ah03" linkedpanel="tabpanel_ged"  label="$vl_c_ben_104" accesskey="$vl_k_ben_104"/>
    </tabs>
    $bloc_modele_01_01
    <tabpanels flex="1">
  		<tabpanel id="tabpanel_edition" flex="1">
        <vbox flex="1" id="ben_acteurs_03">
        <hbox>
          <menubar id="menu_menus" flex="1">
            <menu observes="broadcaster_01" id="menu_02" label="$vl_c_ben_105" accesskey="C" >
              <menupopup>
                <menuitem id="menu_02_01" label="$vl_c_ben_106" class="menuitem-iconic ak08" oncommand="pf_action('favoris_ajout')" />
                <menuitem id="menu_02_02" label="$vl_c_ben_107" class="menuitem-iconic ak09" oncommand="pf_action('favoris_supprimer')" />
                <menuitem id="menu_02_05" label="$vl_c_ben_200" class="menuitem-iconic aj01" oncommand="pf_action('dossier_ajouter')" />
                <menuseparator id="menu_02_03"/>
                <menuitem id="menu_02_04" disabled="true" label="$vl_c_ben_108" />
								$menu_rss_action
             </menupopup>
            </menu>
          </menubar>
        </hbox>
          <grid flex="1">
            <columns flex="1">
             <column/>
             <column flex="1"/>
            </columns>
            <rows>
						$vl_c_tel
             <row flex= "10">
               <label control="la_description" value="$vl_c_ben_109"/>
               <textbox id="tb_description" observes="broadcaster_01"   multiline="true"/>
             </row>

              $bloc_modele_01_02

             <row flex= "1">
               <hbox><label control="la_lieu" value="$vl_c_ben_117"/><toolbarbutton id="tb_aller_lieu" tooltiptext="$vl_c_ben_143" class="am04" oncommand="pf_ouvre('lieu','')" observes="broadcaster_01"/></hbox>
               <textbox id="tb_lieu" observes="broadcaster_01"  />
             </row>
              <row flex= "1">
               <raf/><hbox><label control="la_dateheurecreation" value="$vl_c_ben_119"/><label id="la_dateheurecreation" /><label control="la_dateheuremodif" value="$vl_c_ben_120"/><label id="la_dateheuremodif" /></hbox>
              </row>
          </rows>
        </grid>


        <vbox flex="1">
          <hbox flex="1">
            <vbox>
              <toolbarbutton id="tb_aller_commentaires" tooltiptext="$vl_c_ben_123" class="al13" oncommand="pf_ouvre('commentaires','favori')" observes="broadcaster_01"/>
              <toolbarbutton id="tb_aller_commentaires_moi" tooltiptext="$vl_c_ben_145" class="bl04" oncommand="pf_ouvre('commentaires','moimoi')" observes="broadcaster_01"/>
              <toolbarbutton id="tb_aller_commentaires_principal" tooltiptext="$vl_c_ben_146" class="bl05" oncommand="pf_ouvre('commentaires','princi')" observes="broadcaster_01"/>
            </vbox>
            <iframe onload="event.stopPropagation();" id="if_commentaires" flex="1" src="" />
          </hbox>
        </vbox>




        </vbox>
      </tabpanel>
      <tabpanel id="tabpanel_graal" flex="1">
      <vbox flex="1">
END;
$vl_c_inc_actions_graal_barre_invisible="false";
include("_graal_inc_actions_graal.php");
echo <<<END
<splitter/>
<vbox flex="1">
  <iframe onload="event.stopPropagation();" id="if_carteviste" flex="1" src="" />
</vbox>
</vbox>
      </tabpanel>
      <tabpanel id="tabpanel_graal_actions" flex="1">
END;
$vl_c_barre_presente_actions_relations="ok";
$vl_c_visu_relation="oui";
include("_graal_inc_actions_relations_01.php");
echo <<<END
      </tabpanel>
      <tabpanel id="tabpanel_critere" flex="1">
        <tabbox id="tabbox_02" flex="1" orient="vertical" class="overflow_01">
          <tabs>
            <tab class="ag17" id="tab_edition_critere_entreprise" linkedpanel="tabpanel_critere_entreprise" first-tab="true" label="$vl_c_dico_00058" selected="true" accesskey="$vl_k_dico_00058"/>
            <tab class="ak15" id="tab_edition_critere_lesmiens" linkedpanel="tabpanel_critere_lesmiens" label="$vl_e_nomcomplet" accesskey="$vl_k_nomcomplet"/>
END;
if ($vs_envaa!=1){
echo <<<END
            <tab class="ak19" linkedpanel="tabpanel_critere_lesautres" id="tab_edition_critere_lesautres" label="$vl_c_dico_00059" accesskey="$vl_k_dico_00059"/>
            <tab class="bd01" id="tab_edition_critere_tous" linkedpanel="tabpanel_critere_tous" label="$vl_c_dico_00073" accesskey="$vl_k_dico_00073"/>
END;
}
echo <<<END
          </tabs>
          <tabpanels flex="1">
          	<tabpanel id="tabpanel_critere_entreprise" flex="1">
END;
include("_graal_inc_actions_criteres_entreprise.php");
echo '</tabpanel>';
echo '<tabpanel id="tabpanel_critere_lesmiens" flex="1">';
include("_graal_inc_actions_criteres_lesmiens.php");
echo '</tabpanel>';
if ($vs_envaa!=1){
	echo '<tabpanel id="tabpanel_critere_lesautres" flex="1">';
	include("_graal_inc_actions_criteres_lesautres.php");
	echo '</tabpanel>';
	echo '<tabpanel id="tabpanel_critere_tous" flex="1">';
	include("_graal_inc_actions_criteres_tous.php");
	echo('</tabpanel>');
}
echo <<<END
          </tabpanels>
        </tabbox>
      </tabpanel>
      <tabpanel id="tabpanel_ged" flex="1">
END;
$vl_c_voir_doc="non";
include("_graal_inc_ged_01.php");
echo <<<END
      </tabpanel>

END;
switch ($vl_c_genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "bordex":
  case "faccli":
  case "avocli":
  case "avofin":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "retcli":
  case "retfou":
  case "relfou":
  case "avofou":
  case "avofif":
    echo '<tabpanel id="tabpanel_doc_cial" orient="vertical" >';include("$inc_doc_cial");echo '</tabpanel>';break;
    break;
	case "fabrica":
    echo '<tabpanel id="tabpanel_doc_fabr" orient="vertical" >';include("$inc_doc_fabr");echo '</tabpanel>';break;
    break;
  case "chat":
    echo '<tabpanel id="tabpanel_chat" flex="1">';
    echo '<toolbarbutton observes="broadcaster_01" class="aa05" tooltiptext="'.$vl_c_ben_152.'" oncommand="pf_chat_imprime();"/>';
    echo '<html:iframe onload="event.stopPropagation();" id="content" flex="2" src="" old_src="_graal_page_blanche_01.html" style="border:0px;"/>';
    echo '</tabpanel>';
    break;
  case "emimail":
  case "emimail_ar":
  case "emailing":
  case "emimail_brouillon":
    echo '<tabpanel id="tabpanel_emimail" flex="1">';include("$inc_doc_courriel");echo '</tabpanel>';break;
    break;
  case "recmail":
  case "recmail_lecture":
  case "recmail_erreur":
	case "recfax":
    	echo '<tabpanel id="tabpanel_recmail" flex="1">';include("$inc_doc_courriel");echo '</tabpanel>';break;
    	break;
	case "recvoc":
    	echo '<tabpanel id="tabpanel_recvoc" flex="1">';include("$inc_doc_recvoc");echo '</tabpanel>';break;
    	break;
	case "remban":
   	 	echo '<tabpanel id="tabpanel_remban" flex="1">';include("$inc_doc_courriel");echo '</tabpanel>';break;
    	break;
	case "emifax":
    	echo '<tabpanel id="tabpanel_recmail" flex="1">';include("$inc_doc_courriel");echo '</tabpanel>';break;
    	break;
	case "emisms":
    	echo '<tabpanel id="tabpanel_emisms" flex="1">';include("$inc_doc_courriel");echo '</tabpanel>';break;
    	break;
    case "alertes":
    	echo '<tabpanel id="tabpanel_alertes" flex="1">';include("$inc_alertes");echo '</tabpanel>';break;
    	break;
  case "generique":
  case "emailing_track":
  case "reponse_sondage":
  default:
    break;  //  Toutes les actions génériques
}
echo <<<END
    </tabpanels>
  </tabbox>
  <vbox id="boutons_standards">
END;
include("_graal_inc_boutons_01.php");
echo <<<END
  </vbox>
  </hbox>
</window>
END;
?>
