<?php
include("_graal_header_xul.inc.php");
$vl_c_id_fenetre="Fen_00717"; //Personnalisation des menus
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_genre=fa_recup_param('genre','utilis');
$vl_e_portee_cleunik=fa_recup_param('portee_cleunik','0');
$vl_c_qui=fa_recup_param('qui','');
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_dupliq=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bps_100=fa_recup_dico("bps_100");
$vl_c_bps_101=fa_recup_dico("bps_101");
$vl_c_bps_102=fa_recup_dico("bps_102");
$vl_c_bps_103=fa_recup_dico("bps_103");
$vl_c_bps_104=fa_recup_dico("bps_104");
$vl_c_bps_105=fa_recup_dico("bps_105");
$vl_c_bps_106=fa_recup_dico("bps_106");
$vl_c_bps_107=fa_recup_dico("bps_107");
$vl_c_bps_108=fa_recup_dico("bps_108");
$vl_c_bps_109=fa_recup_dico("bps_109");
$vl_c_bps_110=fa_recup_dico("bps_110");
$vl_c_bps_111=fa_recup_dico("bps_111");
$vl_e_typedoc=15;
if ($vl_c_qui=="lui"){
	$vl_e_uti_cleunik =intval(fa_recup_param('vl_e_uti_cleunik','0'));
}
$vl_modeles_menu_orig="";
//  On recherche tous les modèles arbres pour l'utilisateur
$sql_req = "SELECT _documents.doc_cleunik AS doc_cleunik,_documents.titre AS titre,_documents.descriptif_sommaire AS descriptif_sommaire FROM _droits_doc, _documents WHERE _droits_doc.uti_cleunik=$vl_e_uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc=14 order by descriptif_sommaire";
$sql_result = _graal_requete_bd($sql_req);
if (mysql_num_rows($sql_result) != 0){
  while ($row = mysql_fetch_assoc($sql_result)){
    $vl_modeles_menu_orig.="<menuitem oncommand='pf_charge_menu_orig(".$row['doc_cleunik'].",\"".fa_remplace_quotes(fa_ent_xml($row['titre']))."\");' label='".fa_remplace_quotes(fa_ent_xml($row['titre']))."' tooltiptext='".fa_remplace_quotes(fa_ent_xml($row['titre']))."'/>";
  }
}
_graal_libere_requete_bd($sql_result);


//  On recherche tous les modèles pages pour l'utilisateur
$vl_modeles="<hbox>";
$sql_req = "SELECT _documents.doc_cleunik AS doc_cleunik,_documents.titre AS titre,_documents.descriptif_sommaire AS descriptif_sommaire FROM _droits_doc, _documents WHERE _droits_doc.uti_cleunik=$vl_e_uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc=$vl_e_typedoc order by descriptif_sommaire";
$sql_result = _graal_requete_bd($sql_req);
if (mysql_num_rows($sql_result) == 0){
$vl_modeles=<<<EOT
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' id="ml_choix_destination" hidden="true">
    <menupopup>
      <menuitem id="bt_choix_menu_destination" label="" oncommand="fa_vide_arbre('treeitems_destination');" hidden="true"/>
      <menuitem id="bt_destination_defaut_01" label="$vl_c_bps_105" tooltiptext="$vl_c_bps_105" oncommand="pf_charge_destination_defaut();" hidden="true" />
    </menupopup>
  </menulist>
EOT;
}
else {
$vl_modeles=<<<EOT
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' id="ml_choix_destination" value="1">
    <menupopup>
      <menuitem id="bt_choix_menu_destination" label="" oncommand="fa_vide_arbre('treeitems_destination');" hidden="true"/>
      <menuitem id="bt_destination_defaut_01" label="$vl_c_bps_105" tooltiptext="$vl_c_bps_105" oncommand="pf_charge_destination_defaut();" hidden="true" />
EOT;
$i=0;
  while ($row = mysql_fetch_assoc($sql_result)){
  	$i++;
    $vl_modeles_menu_dest.="<menuitem value='".$i."' oncommand='pf_charge_menu_dest(".$row['doc_cleunik'].",\"".fa_remplace_quotes(fa_ent_xml($row['titre']))."\",\"".fa_remplace_quotes(fa_ent_xml($row['descriptif_sommaire']))."\");' label='".fa_remplace_quotes(fa_ent_xml($row['titre']))."' tooltiptext='".fa_remplace_quotes(fa_ent_xml($row['titre']))."'/>";
  }
  $vl_modeles.=$vl_modeles_menu_dest;
  $vl_modeles.="</menupopup></menulist>";
}
_graal_libere_requete_bd($sql_result);




include("_graal_header_winxul.inc.php");
echo ('<?xml-stylesheet href="css/outliner.css" type="text/css"?>');
echo <<<END
<window context="graal_cp00" title="$vl_c_bps_100" onload="fa_aa(this);pf_etat_fen('ini')" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("js/_graal_fen_utilisateurs_menu_02.js.php");
include("js/_graal_editeur_wysiwyg_01.js.php");
include("js/_graal_xml_dossiers_01.js.php");
include("js/_graal_03.js.php");
include_once("js/_graal_01.js.php");
echo <<<END
<broadcasterset>
  <broadcaster id="broadcaster_01" />
</broadcasterset>
 <popup id="popup_destination">
  <menuitem class="menuitem-iconic ad09" label="$vl_c_bps_106" tooltiptext="$vl_c_bps_106" oncommand="pf_change_libelle();" />
 </popup>
<hbox flex="1">
<vbox id="hbox_panneaudegauche" flex="1">
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="0" id="ml_choix_origine" >
    <menupopup>
      <menuitem id="bt_choix_menu_origine" label="$vl_c_bps_102" tooltiptext="$vl_c_bps_102" oncommand="fa_vide_arbre('treeitems_origine');" hidden="true"/>
      <menuitem id="bt_exploitation_defaut_01" label="$vl_c_bps_101" tooltiptext="$vl_c_bps_101" oncommand="pf_charge_exploitation_defaut_ouvert();"/>
      <menuitem id="bt_exploitation_defaut_02" label="$vl_c_bps_103" tooltiptext="$vl_c_bps_103" oncommand="pf_charge_exploitation_defaut_ferme();"/>
      <menuseparator/>
      $vl_modeles_menu_orig
    </menupopup>
  </menulist>

    <tree id="treedata_origine" flex="1" hidecolumnpicker="true" seltype="single" >
      <treecols>
          <treecol id="colname_origine" ignoreincolumnpicker="true" class="colname"  flex="2" primary="true" hideheader="true"/>
          <treecol hidden="true" id="colvalue" />
      </treecols>
      <treechildren id="treeitems_origine" />
    </tree>

  </vbox>
  <splitter></splitter>
  <vbox flex="1">
  $vl_modeles
    <hbox >
    <hbox flex="1" ><label value="$vl_c_bps_110"/>
    <textbox flex="1" id="tb_descriptif_sommaire"/></hbox>
        <label control="la_titre" value="$vl_c_bps_111"/>
        <textbox flex="1" observes="broadcaster_01" id="tb_titre" width="300"  />
    </hbox>
    
END;
include("_graal_inc_baroutils_04.php");
echo <<<END
   	<deck id="workarea" flex="1">
			<html:iframe onload="event.stopPropagation();" id="content" flex="2" src="about:blank" />
      <textbox multiline="true" id="tb_source"/>
    </deck>
  
    
    <hbox flex="0" id="boutons_standards" >
END;
include("_graal_inc_boutons_01.php");
echo <<<END
    </hbox>
  </vbox>
</hbox>
</window>
END;
?>
