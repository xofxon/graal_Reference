<?php
include("_graal_header_xml.inc.php");
$vl_c_datedebut=fa_recup_param('vl_c_dateheuredebut','');
$vl_c_datefin=fa_recup_param('vl_c_dateheurefin','');
$vl_c_heuredebut=fa_recup_param('vl_c_heuredebut','000000');
$vl_c_heurefin=fa_recup_param('vl_c_heurefin','235959');
$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_limit=intval(fa_recup_param('vl_e_limit','150'));
define('EOL', "\r\n");
// execution de la requète SQL
$sql_req="SELECT a1.ip,a1.host,a1.dateheure_entree,a1.dateheure_valida,a1.c_uuid,a1.reponse,a1.formulaire,a1.origine,a2.action_cleunik FROM _formulaires_internet a1 left join _actions a2 using (c_uuid)";
$sql_req.= " where ((dateheure_entree between '$vl_c_datedebut$vl_c_heuredebut' and '$vl_c_datefin$vl_c_heurefin') or (dateheure_valida between '$vl_c_datedebut$vl_c_heuredebut' and '$vl_c_datefin$vl_c_heurefin'))";
$sql_req.= " order by dateheure_entree desc limit $vl_e_limit";
$result = _graal_requete_bd($sql_req);
//echo $sql_req;
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)){
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  // parseType = indication pour le type des données, utile pour le tri sur la colonne
    echo('<row:ip>'.fa_ent_xml($row['ip']).'</row:ip>');
    echo('<row:host>'.fa_ent_xml($row['host']).'</row:host>');
    echo('<row:dateheure_entree>'.fa_ent_xml($row['dateheure_entree']).'</row:dateheure_entree>');
    echo('<row:dateheure_valida>'.fa_ent_xml($row['dateheure_valida']).'</row:dateheure_valida>');
    echo('<row:c_uuid>'.fa_ent_xml($row['c_uuid']).'</row:c_uuid>');
    echo('<row:reponse>'.fa_ent_xml($row['reponse']).'</row:reponse>');
    echo('<row:formulaire>'.fa_ent_xml($row['formulaire']).'</row:formulaire>');
    echo('<row:origine>'.fa_ent_xml($row['origine']).'</row:origine>');
    echo('<row:action_cleunik>'.fa_ent_xml($row['action_cleunik']).'</row:action_cleunik>');
  echo('</RDF:Description>');
  echo('</RDF:li>');
}
// fin du fichier RDF
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>


