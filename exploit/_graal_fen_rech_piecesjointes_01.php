<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_type=fa_recup_param('type','');
$vl_c_renvoi="";
$vl_c_selqui=array();
$vl_c_selqui[0]="false";
$vl_c_selqui[1]="false";
$vl_c_selqui[2]="false";
$vl_c_selqui[3]="false";
$vl_tc_type=array();
$vl_tc_type[0]="recfav";
$vl_tc_type[1]="rectou";
$vl_tc_type[2]="recrec";
$vl_tc_type[3]="recenv";

$vl_c_inactif="true";
switch ($vl_c_type) {
  case "select":$vl_c_id_fenetre="Fen_00581";
    $vl_c_renvoi="<button width='40' flex='1' id='bt_enregistrer' label='$vl_c_boh_104' crop='end' dir='normal' oncommand='pf_etat_fen(\"renvoyer\");' />";
    $vl_c_selqui[1]="true";
    $vl_c_inactif="false";
    break;
  case "recenv":$vl_c_id_fenetre="Fen_00582";$vl_c_selqui[3]="true";break;
  case "rectou":$vl_c_id_fenetre="Fen_00584";$vl_c_selqui[1]="true";break;
  case "recrec":$vl_c_id_fenetre="Fen_00583";$vl_c_selqui[2]="true";break;
  case "recfav":$vl_c_id_fenetre="Fen_00585";$vl_c_selqui[0]="true";break;
  default:fa_redirige("acces_interdit");break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_boh_100=fa_recup_dico("boh_100");
$vl_c_boh_101=fa_recup_dico("boh_101");
$vl_c_boh_102=fa_recup_dico("boh_102");
$vl_c_boh_103=fa_recup_dico("boh_103");
$vl_c_boh_104=fa_recup_dico("boh_104");
$vl_c_boh_105=fa_recup_dico("boh_105");
$vl_c_boh_106=fa_recup_dico("boh_106");
$vl_c_boh_107=fa_recup_dico("boh_107");
$vl_c_boh_108=fa_recup_dico("boh_108");
$vl_c_boh_109=fa_recup_dico("boh_109");
$vl_c_boh_110=fa_recup_dico("boh_110");
$vl_c_boh_111=fa_recup_dico("boh_111");
$vl_c_boh_112=fa_recup_dico("boh_112");
$vl_c_boh_113=fa_recup_dico("boh_113");
$vl_c_boh_114=fa_recup_dico("boh_114");
$vl_c_boh_115=fa_recup_dico("boh_115");
$vl_c_boh_116=fa_recup_dico("boh_116");
$vl_c_boh_117=fa_recup_dico("boh_117");
$vl_c_boh_118=fa_recup_dico("boh_118");
$vl_c_boh_119=fa_recup_dico("boh_119");$vl_c_boh_119="Date de création";
$vl_c_dico_00007=fa_recup_dico("dico_00007");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_dico_00149=fa_recup_dico('dico_00149');
$vl_c_context_00='<menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\'tarbre_pj\');" />';

$menu_partage="";
$vl_tb_droits_partage=_graal_requete_droits_fenetre("Fen_00641",$vl_e_uti_cleunik);
if ($vl_tb_droits_partage[0]==true) {$menu_partage='<menuitem class="menuitem-iconic ak08" label="'.$vl_c_boh_118.'" oncommand="pf_favoris_partager();" />';}
$vl_tc_composants=array();
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_boh_100" id="_graal_fen_rech_piecesjointes_01" onload="fa_aa(this);pf_aa_init()" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
<popupset>
  <popup id="pop_selections">
    $vl_c_context_00
    <menuitem class="menuitem-iconic ai18" id="mi_telecharge_pj" label="$vl_c_boh_101" oncommand="pf_telecharge_pj();"/>
    <menuitem class="menuitem-iconic ag18" id="mi_voiractions" label="$vl_c_boh_117" oncommand="pf_voir_actions();"/>
END;
switch ($vl_c_type) {
  case "select":
  case "recenv":
  case "rectou":
  case "recrec":
    echo ("<menuitem class='menuitem-iconic ag15' id='mi_ajout_favoris' label='$vl_c_boh_115' oncommand='pf_ajout_favoris();'/>");
    break;
  case "recfav":
    echo ("<menuitem class='menuitem-iconic ag15' id='mi_ajout_favoris' label='$vl_c_boh_116' oncommand='pf_enleve_favoris();'/>$menu_partage");
    
    break;
}
echo <<<END
  </popup>
  <popup id="pop_selections_01">
    <menuitem class="menuitem-iconic ai18" id="mi_telecharge_pj" label="$vl_c_boh_101" oncommand="pf_telecharge_pj();"/>
    <menuitem class="menuitem-iconic ag15" id="mi_ajout_favoris" label="$vl_c_boh_116" oncommand="pf_enleve_favoris();"/>
  </popup>

</popupset>
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_fen_rech_piecesjointes_01.js.php");
echo <<<END
<vbox flex="1">
  <hbox>
      <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="1" id="boh_ml_qui" oncommand="po_sel();pf_approximatif();">
      <menupopup>
        <menuitem class="menuitem-iconic al14" label="$vl_c_boh_111" selected="$vl_c_selqui[0]" value="$vl_tc_type[0]" /> <!--  Pièces jointes favorites -->
        <menuitem class="menuitem-iconic al14" label="$vl_c_boh_112" selected="$vl_c_selqui[1]" value="$vl_tc_type[1]" /> <!--  Toutes les Pièces jointes -->
        <menuitem class="menuitem-iconic al14" label="$vl_c_boh_113" selected="$vl_c_selqui[2]" value="$vl_tc_type[2]" /> <!--  Pièces jointes reçues -->
        <menuitem class="menuitem-iconic al14" label="$vl_c_boh_114" selected="$vl_c_selqui[3]" value="$vl_tc_type[3]" /> <!--  Pièces jointes envoyées -->
      </menupopup>
    </menulist>

    <label value="$vl_c_boh_105" />
    <textbox flex="1" value="$vl_c_boh_106"   id="tb_rechapproxima" oninput="pf_approximatif();"/>
    <label value="$vl_c_boh_107" />
    <textbox value="$vl_c_boh_108"   id="tb_limit" old_oninput="pf_approximatif();" size="4" type="number" hidespinbuttons="true"/>
    <button id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_win_id')" />
  </hbox> 
  <vbox flex="1">
   <tree id="tarbre_pj" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="">
     <treecols>
      <treecol hidden="true" ignoreincolumnpicker="true" id="doc_cleunik"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="nom" sort="?nom" hidden="false" label="$vl_c_boh_102" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="mime" sort="?mime" label="$vl_c_boh_103" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="hash" sort="?hash" label="hash" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="nombre" sort="?nombre" label="$vl_c_boh_109" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="genre" sort="?genre" label="$vl_c_boh_110" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="dateheurecreation_clair" sort="?dateheurecreation" label="$vl_c_boh_119" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" ignoreincolumnpicker="true" id="dateheurecreation" sort="?dateheurecreation" label="Date de création" /><splitter class="tree-splitter" resizeafter="grow"/>

     </treecols>
     <template><query expr="*"/><action>
       <treechildren>
         <treeitem container="true" uri="?">
           <treerow>
             <treecell label="?doc_cleunik"/>
             <treecell label="?nom"/>
             <treecell label="?mime"/>
             <treecell label="?hash"/>
             <treecell label="?nombre"/>
             <treecell label="?genre"/>
             <treecell label="?dateheurecreation_clair"/>
             <treecell label="?dateheurecreation"/>

           </treerow>
         </treeitem>
       </treechildren>
     </action></template>
   </tree>
  </vbox>
</vbox>
<hbox id="bt_renvoyer_valeur">
  $vl_c_renvoi
  <button width="40" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir');" />
</hbox>
</window>
END;
?>
