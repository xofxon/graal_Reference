<?php
include("_graal_header_xul.inc.php");
include_once("_graal_var_portee.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_genre=fa_recup_param('genre','0');
$vl_c_genrecritere=fa_recup_param('genrecritere','0');
$vl_c_codecache="false";
$vl_c_cache_texte2="false";
$vl_e_domaine=intval(fa_recup_param('vl_e_domaine','8192'));
switch ($vl_e_domaine){
	case $vl_e_acteur:
		switch ($vl_c_genre) {
		  case "110001": $vl_c_id_fenetre="Fen_00665";$vl_c_id_fen_criteres="Fen_00260";$vl_c_id_fen_choix="Fen_00267";$vl_e_portee=$vl_e_procli;break;  //  prospects clients
		  case "110002": $vl_c_id_fenetre="Fen_00667";$vl_c_id_fen_criteres="Fen_00261";$vl_c_id_fen_choix="Fen_00268";$vl_e_portee=$vl_e_profou;break;  //  prospects fournisseurs
		  case "110003": $vl_c_id_fenetre="Fen_00666";$vl_c_id_fen_criteres="Fen_00262";$vl_c_id_fen_choix="Fen_00269";$vl_e_portee=$vl_e_client;break;  //  clients
		  case "110004": $vl_c_id_fenetre="Fen_00668";$vl_c_id_fen_criteres="Fen_00263";$vl_c_id_fen_choix="Fen_00270";$vl_e_portee=$vl_e_fourni;break;  //  fournisseurs
		  case "110005": $vl_c_id_fenetre="Fen_00669";$vl_c_id_fen_criteres="Fen_00264";$vl_c_id_fen_choix="Fen_00271";$vl_e_portee=$vl_e_autrac;break;  //  autres acteurs
		  case "110006": $vl_c_id_fenetre="Fen_00670";$vl_c_id_fen_criteres="Fen_00265";$vl_c_id_fen_choix="Fen_00272";$vl_e_portee=$vl_e_actind;break;  //  acteurs indéterminés
		}
		break;	
	case $vl_e_interl:
		switch ($vl_c_genre) {
		  case "110001": $vl_c_id_fenetre="Fen_00665";$vl_c_id_fen_criteres="Fen_00281";$vl_c_id_fen_choix="Fen_00287";$vl_e_portee=$vl_e_procli;break;  //  prospects clients
		  case "110002": $vl_c_id_fenetre="Fen_00667";$vl_c_id_fen_criteres="Fen_00282";$vl_c_id_fen_choix="Fen_00288";$vl_e_portee=$vl_e_profou;break;  //  prospects fournisseurs
		  case "110003": $vl_c_id_fenetre="Fen_00666";$vl_c_id_fen_criteres="Fen_00283";$vl_c_id_fen_choix="Fen_00289";$vl_e_portee=$vl_e_client;break;  //  clients
		  case "110004": $vl_c_id_fenetre="Fen_00668";$vl_c_id_fen_criteres="Fen_00284";$vl_c_id_fen_choix="Fen_00290";$vl_e_portee=$vl_e_fourni;break;  //  fournisseurs
		  case "110005": $vl_c_id_fenetre="Fen_00669";$vl_c_id_fen_criteres="Fen_00285";$vl_c_id_fen_choix="Fen_00291";$vl_e_portee=$vl_e_autrac;break;  //  autres acteurs
		  case "110006": $vl_c_id_fenetre="Fen_00670";$vl_c_id_fen_criteres="Fen_00286";$vl_c_id_fen_choix="Fen_00292";$vl_e_portee=$vl_e_actind;break;  //  acteurs indéterminés
		}
		break;
	case $vl_e_articl:
		$vl_c_id_fenetre="Fen_01158";$vl_c_id_fen_criteres="Fen_00334";$vl_c_id_fen_choix="Fen_00335";$vl_e_portee=$vl_e_articl;  //  prospects clients
		break;
}
//$vl_e_portee+=$vl_e_domaine;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bpf_101=fa_recup_dico("bpf_101");
$vl_c_bpf_102=fa_recup_dico("bpf_102");
$vl_c_bpf_103=fa_recup_dico("bpf_103");
$vl_c_bpf_104=fa_recup_dico("bpf_104");
$vl_c_bpf_105=fa_recup_dico("bpf_105");
$vl_c_bpf_106=fa_recup_dico("bpf_106");
$vl_c_bpf_107=fa_recup_dico("bpf_107");
$vl_c_bpf_108=fa_recup_dico("bpf_108");
$vl_c_bpf_109=fa_recup_dico("bpf_109");
$vl_c_bpf_110=fa_recup_dico("bpf_110");
$vl_c_bpf_111=fa_recup_dico("bpf_111");
$vl_c_bpf_112=fa_recup_dico("bpf_112");
$vl_c_bpf_113=fa_recup_dico("bpf_113");
$vl_c_bpf_114=fa_recup_dico("bpf_114");
$vl_c_bpf_115=fa_recup_dico("bpf_115");
$vl_c_bpf_116=fa_recup_dico("bpf_116");
$vl_c_bpf_117=fa_recup_dico("bpf_117");
$vl_c_bpf_118=fa_recup_dico("bpf_118");
$vl_c_dico_00004=fa_recup_dico("dico_00004");
$vl_c_dico_00005=fa_recup_dico("dico_00005");
$vl_c_dico_00007=fa_recup_dico("dico_00007");
$vl_c_mes_00007=fa_recup_dico("mess_00007");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_tb_droits_choix=_graal_requete_droits_fenetre($vl_c_id_fen_choix,$vl_e_uti_cleunik); //ajout dans les choix des critères de la GED 
if ($vl_tb_droits_choix[1]==true){$vl_c_choix_menu='<menuitem label="'.$vl_c_bpf_110.'" oncommand="pf_nouveaux_choix()"/>';} else {$vl_c_choix_menu='';}
$vl_tb_droits_criteres=_graal_requete_droits_fenetre($vl_c_id_fen_criteres,$vl_e_uti_cleunik); //ajout dans les critères de la GED 
if ($vl_tb_droits_criteres[1]==true){$vl_c_critere_menu='<menuitem label="'.$vl_c_bpf_111.'" oncommand="pf_nouveaux_criteres()"/>';} else {$vl_c_critere_menu='';}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bpf_101" id="_win_fen_sel_choix_criteres" onload="fa_aa(this);pf_aa_init()" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("_graal_inc_keyset_01.php");
include_once("js/_graal_01.js.php");
include("js/_graal_sel_choix_criteres_01.js.php");
echo <<<END
<popupset>
  <popup id="graal_acces_choix">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_choix_criteres');" />
    $vl_c_choix_menu
  </popup>
  <popup id="graal_acces_critere">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_criteres');" />
    $vl_c_critere_menu
  </popup>
</popupset>
<description>$vl_c_raisonsoc</description>
<hbox id="bpf_acteurs_02" flex="10">
   <vbox flex="1">
    <hbox>
END;
switch ($vl_e_domaine){
	case $vl_e_acteur:
	    $genre="acteur";
	    include("_graal_inc_menulist_critere_particuliers.php");        
	    break;
	default:
		echo '<hbox flex="1"></hbox>';
		break;
}
echo <<<END
</hbox>
   <tree flex="40" id="arb_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onselect="pf_sel_arbre_criteres();" seltype="single" context="graal_acces_critere">
     <treecols> 
      <treecol id="critere_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_choixmultiples" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_code" label="$vl_c_bpf_102" sort="?critere_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_denomination" label="$vl_c_bpf_103"  sort="?critere_denomination" sortActive="true" sortDirection="ascending"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_codechoixpertinent" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template>
		 <query expr="*"/>
			<action>
       <treechildren >
         <treeitem uri="?" seltype="single">
           <treerow >
             <treecell label="?critere_cleunik"/>
             <treecell label="?critere_choixmultiples"/>
             <treecell label="?critere_code"/>
             <treecell label="?critere_denomination"/>
             <treecell label="?critere_codechoixpertinent"/>
           </treerow>
         </treeitem>
       </treechildren>
			 </action>
     </template>
   </tree>
  </vbox>
  <splitter/>
  <vbox flex="1">
  
  <hbox flex="1">
  <groupbox flex="1">
    <caption><label value="$vl_c_bpf_113" /></caption>
    <radiogroup id="rdg_position" onclick="pf_affiche_choix_criteres_potentiel();" flex="1" value="2">
       <hbox flex="1">
       <radio label="$vl_c_bpf_114" value="1" /><spacer flex="1"/>
       <radio label="$vl_c_bpf_115" value="2" selected="true"/><spacer flex="1"/>
       <radio label="$vl_c_bpf_116" value="3" />
       </hbox>
     </radiogroup>
  </groupbox>
  </hbox>

   <tree flex="40" id="arb_choix_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onselect="pf_sel_arbre_choix();" seltype="single" context="graal_acces_choix">
     <treecols> 
      <treecol id="choix_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_code" hidden="$vl_c_codecache" ignoreincolumnpicker="$vl_c_codecache" label="$vl_c_bpf_104"  sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_valeur_texte_01" label="$vl_c_bpf_105" sort="?choix_valeur_texte_01" sortActive="true" sortDirection="ascending"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="nombre_entreprise" label="$vl_c_bpf_112" class="droite" sort="?nombre"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template>
		 <query expr="*"/>
			<action>
       <treechildren >
         <treeitem uri="?" seltype="single">
           <treerow >
             <treecell label="?choix_cleunik"/>
             <treecell label="?choix_code"/>
             <treecell label="?choix_valeur_texte_01"/>
             <treecell label="?nombre"/>
           </treerow>
         </treeitem>
       </treechildren>
			 </action>
     </template>
   </tree>
   
   </vbox>
</hbox>
<hbox>
  <button flex="1" id="bt_enregistrer" tooltiptext="$vl_c_bpf_117" label="$vl_c_bpf_117" oncommand="pf_renvoie();" />
  <button flex="1" id="bt_sortir" tooltiptext="$vl_c_bpf_118" label="$vl_c_bpf_118"  oncommand="window.close();" />
</hbox>
</window>
END;
?>
