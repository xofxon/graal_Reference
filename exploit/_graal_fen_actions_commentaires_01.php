<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_action_cleunik=intval(fa_recup_param('vf_e_action_cleunik','-1'));
$vl_commentaire_cleunik=intval(fa_recup_param('vf_e_commentaire_cleunik','-1'));
$vl_c_genreacteur=fa_recup_param('genreacteur','tousss');
$vl_c_datedebut=fa_recup_param('vf_c_datedebut','');
$vl_c_heuredebut=fa_recup_param('vf_c_heuredebut','');
switch ($vl_c_genreacteur) {
  case "moimoi": break;  //  Moi
  case "princi": break;  //  Interlocuteur principal
  case "favori": $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";$vl_c_genreacteur="favori_position";break;  //  interlocuteurs favoris
  case "tousss": $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";break;  //  interlocuteurs de Tous les acteurs
  case "110001": $vl_c_id_inc_interlocuteurs_01="Div_00327";$vl_c_id_inc_interlocuteurs_selection_01="Div_00334";break;  //  interlocuteurs de prospects clients
  case "110002": $vl_c_id_inc_interlocuteurs_01="Div_00328";$vl_c_id_inc_interlocuteurs_selection_01="Div_00335";break;  //  interlocuteurs de prospects fournisseurs
  case "110003": $vl_c_id_inc_interlocuteurs_01="Div_00329";$vl_c_id_inc_interlocuteurs_selection_01="Div_00336";break;  //  interlocuteurs de clients
  case "110004": $vl_c_id_inc_interlocuteurs_01="Div_00330";$vl_c_id_inc_interlocuteurs_selection_01="Div_00337";break;  //  interlocuteurs de fournisseurs
  case "110005": $vl_c_id_inc_interlocuteurs_01="Div_00331";$vl_c_id_inc_interlocuteurs_selection_01="Div_00338";break;  //  interlocuteurs de autres acteurs
  case "110006": $vl_c_id_inc_interlocuteurs_01="Div_00332";$vl_c_id_inc_interlocuteurs_selection_01="Div_00339";break;  //  interlocuteurs de acteurs indéterminés
  case "110000": $vl_c_id_inc_interlocuteurs_01="Div_00340";$vl_c_id_inc_interlocuteurs_selection_01="Div_00341";break;  //  interlocuteurs de Entreprise
}
$vl_c_id_fenetre="Fen_00440";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
if ($vl_action_cleunik!=-1) {$vl_b_ajout=0;}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bfg_100=fa_recup_dico("bfg_100");
$vl_c_bfg_101=fa_recup_dico("bfg_101");
$vl_c_bfg_102=fa_recup_dico("bfg_102");
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_id_vbox_inc_interlocuteurs_01="bdq_interlocuteur_01";
$vl_c_id_arbre_inc_interlocuteurs_01="arbre_des_interlocuteurs";
$vl_tc_composants=array($vl_c_id_inc_interlocuteurs_01,$vl_c_id_inc_interlocuteurs_selection_01);
switch ($vl_c_genreacteur) {
  case 'moimoi':
	$vl_e_int_cleunik=intval(fa_recup_session('vs_int_cleunik','0'));
	$vl_e_act_cleunik=intval(fa_recup_session('vs_act_cleunik','0'));
    break;
  case 'princi':
    $sql_req="select 1,concat(f2.prenom,' ',f2.patronyme) as nomprenom,f2.act_cleunik,f2.int_cleunik from _graal f1 left join _act_interlo f2 using (int_cleunik) where action_cleunik=$vl_action_cleunik and principal=2;";
    $result = _graal_requete_bd($sql_req);
    $row = mysql_fetch_assoc($result);
    $vl_c_moi=fa_ent_xml($row['nomprenom']);
    $vl_e_act_cleunik=fa_ent_xml($row['act_cleunik']);
    $vl_e_int_cleunik=fa_ent_xml($row['int_cleunik']);
    _graal_libere_requete_bd($result);
    if ($vl_e_int_cleunik=="") {
      $vl_c_invisible_inc_interlocuteurs_selection_01="false";
      $vl_e_act_cleunik=-1;
      $vl_e_int_cleunik=-1;
      $vl_c_moi="";
      $vl_c_genreacteur="tousss";
      $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";
    }
    break;
  default:
    $vl_c_invisible_inc_interlocuteurs_selection_01="false";
    $vl_e_act_cleunik=-1;
    $vl_e_int_cleunik=-1;
    $vl_c_moi="";
    break;
}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bfg_100" id="_win_fen_actions_commentaires_01" onload="fa_aa(this);pf_aa_init()" $c_xmlns>
$vl_c_graal_cp00
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
<popupset>
  <popup id="pop_selections">
		<menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_interlocuteurs');" />
  </popup>
</popupset>
END;
include("_graal_visites.inc.php");
include ("js/_graal_actions_commentaires_01.js.php");
include ("js/_graal_01.js.php");
switch ($vl_c_genreacteur) {
  case 'moimoi':
  case 'princi':
    break;
  default:
    include("_graal_inc_interlocuteurs_selection_01.php");
    echo ('<vbox flex="3">');
    include("_graal_inc_interlocuteurs_01.php");
    echo ('</vbox>');
    break;
}
echo <<<END
<textbox id="tb_interlo" value="$vl_c_moi" int_cleunik="$vl_e_int_cleunik" act_cleunik="$vl_e_act_cleunik" disabled="true" />
<hbox>
  <label value="$vl_c_bfg_101"/>
  <datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="tb_dat_deb"/>
  <label value="$vl_c_bfg_102"/>
  <toolbarbutton id="tb_debut_maintenant" class="ag04" tooltiptext="$vl_c_ben_121" oncommand="pf_maintenant(this.id)" observes="broadcaster_01"/>
  <timepicker is24HourClock="true" id="tb_heu_deb" observes="broadcaster_01"/>
</hbox>
<hbox flex="1">
<textbox flex="1"   id="tb_commentaire" observes="broadcaster_01" multiline="true"/>
<vbox id="boutons_standards"> 
END;
include("_graal_inc_boutons_01.php");
echo <<<END
  </vbox>
 </hbox>    
</window>
END;
?>
