<?php
_graal_requete_charge_varlib($vl_c_id_article_nomenclature,$vl_e_uti_cleunik);
error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);  //  Pour éviter les warnings éventuels générés par simplexml_load_string
$vl_c_bdj_001=fa_recup_dico("bdj_001");
$vl_c_bdj_002=fa_recup_dico("bdj_002");
$vl_c_bdj_003=fa_recup_dico("bdj_003");
$vl_c_bdj_004=fa_recup_dico("bdj_004");
$vl_c_bdj_005=fa_recup_dico("bdj_005");
$vl_c_bdj_006=fa_recup_dico("bdj_006");
$vl_c_bdj_007=fa_recup_dico("bdj_007");
$vl_c_bdj_008=fa_recup_dico("bdj_008");
$vl_c_bdj_009=fa_recup_dico("bdj_009");
$vl_c_bdj_010=fa_recup_dico("bdj_010");
$vl_c_bdj_011=fa_recup_dico("bdj_011");
$vl_c_bdj_012=fa_recup_dico("bdj_012");
$vl_c_bdj_013=fa_recup_dico("bdj_013");
$vl_c_bdj_014=fa_recup_dico("bdj_014");
$vl_c_bdj_015=fa_recup_dico("bdj_015");
$vl_c_bdj_016=fa_recup_dico("bdj_016");
$vl_c_bdj_017=fa_recup_dico("bdj_017");
$vl_c_bdj_018=fa_recup_dico("bdj_018");
$vl_c_bdj_019=fa_recup_dico("bdj_019");
$vl_c_bdj_020=fa_recup_dico("bdj_020");
$vl_c_bdj_021=fa_recup_dico("bdj_021");
$vl_c_bdj_022=fa_recup_dico("bdj_022");
$vl_c_bdj_023=fa_recup_dico("bdj_023");
$vl_c_bdj_024=fa_recup_dico("bdj_024");
$vl_c_bdj_025=fa_recup_dico("bdj_025");
$vl_c_bdj_026=fa_recup_dico("bdj_026");
$vl_c_bdj_027=fa_recup_dico("bdj_027");
$vl_c_bdj_028=fa_recup_dico("bdj_028");
$vl_c_bdj_029=fa_recup_dico("bdj_029");
$vl_c_bdj_030=fa_recup_dico("bdj_030");
$vl_c_bdj_031=fa_recup_dico("bdj_031");
$vl_c_bdj_032=fa_recup_dico("bdj_032");
$vl_c_bdj_033=fa_recup_dico("bdj_033");
$vl_c_bdj_034=fa_recup_dico("bdj_034");
$vl_c_bdj_035=fa_recup_dico("bdj_035");
$vl_c_bdj_036=fa_recup_dico("bdj_036");
$vl_c_bdj_037=fa_recup_dico("bdj_037");
$vl_c_bdj_038=fa_recup_dico("bdj_038");
$vl_c_bdj_039=fa_recup_dico("bdj_039");
$vl_c_bdj_040=fa_recup_dico("bdj_040");
$vl_c_dico_00001=fa_recup_dico('dico_00001');
$vl_c_dico_00002=fa_recup_dico('dico_00002');
$vl_c_dico_00003=fa_recup_dico('dico_00003');
$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00005=fa_recup_dico('dico_00005');
$vl_c_dico_00006=fa_recup_dico('dico_00006');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_id_fen_nomenclature_fab="Fen_00359";
$vl_tb_droits_nomenc_fab=_graal_requete_droits_fenetre($vl_c_id_fen_nomenclature_fab,$vl_e_uti_cleunik);
if ($vl_tb_droits_nomenc_fab[1]!=0){ $vl_c_ajouter="<button id='bt_nomclaturefab_ajouter' class='ajouter' observes='broadcaster_01' tooltiptext='$vl_c_dico_00002' label='$vl_c_dico_00002' oncommand='pf_nomclaturefab_ajouter()'/>";}
if ($vl_tb_droits_nomenc_fab[2]!=0){ $vl_c_modifier="<button id='bt_nomclaturefab_modifier' class='modifier' observes='broadcaster_01' tooltiptext='$vl_c_dico_00003' label='$vl_c_dico_00003' oncommand='pf_nomclaturefab_modifier()'/>";}
if ($vl_tb_droits_nomenc_fab[3]!=0){ $vl_c_supprimer="<button id='bt_nomclaturefab_supprimer' class='supprimer' observes='broadcaster_01' tooltiptext='$vl_c_dico_00004' label='$vl_c_dico_00004' oncommand='pf_nomclaturefab_supprimer()'/>";}
if (($vl_tb_droits_nomenc_fab[1]!=0) or ($vl_tb_droits_nomenc_fab[2]!=0) or ($vl_tb_droits_nomenc_fab[3]!=0)) {
  $vl_c_enregistrer="<button observes='broadcaster_01' class='enregistrer' id='bt_val_nomencfab' tooltiptext ='$vl_c_dico_00005' label='$vl_c_dico_00005' oncommand='pf_nomclaturefab_valider()'/>";
  $vl_c_annuler="<button observes='broadcaster_01' class='annuler' id='bt_nomencfab_annuler' tooltiptext ='$vl_c_dico_00006' label='$vl_c_dico_00006' oncommand='pf_nomclaturefab_annuler()'/>";
}
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
$selection_article=fa_ent_xml($vl_c_xml->selection_article->attributes());
echo <<<END
  <tabbox id="tabbox_nomenc" flex="1" orient="vertical" class="overflow_01">
    <tabs id="tab_nomenc">
       <tab id="tabnomenc_edition" linkedpanel="tabnomencpanel_edition" first-tab="true" label="$vl_c_bdj_011" selected="true"/>
       <tab id="tabnomenc_fab" linkedpanel="tabnomencpanel_fab" label="$vl_c_bdj_012"/>
    </tabs>
    <tabpanels flex="1">
  		<tabpanel id="tabnomencpanel_edition" flex="1">
<deck id="deck_fab" selectedIndex="0" flex="1">
<hbox flex="1">
<vbox flex="3">
END;
if ($vl_c_barre_presente_nomenclature=='ok'){
echo <<<END
      <toolbar grippyhidden="true">
  		  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_bdj_001" oncommand="pf_affiche_donnees_nomenclature_fab();"/>
        <toolbarseparator />
        <button label="$vl_c_bdj_004" tooltiptext="$vl_c_bdj_005" oncommand="fa_gid('deck_fab').selectedIndex=1;pf_affiche_donnees_casdemploi_nomenc();" id="cademploi_nomenc" />
      </toolbar>
END;
}
echo <<<END
<popup id="pop_nomclaturefab_arbre_nomenc">
  <menuitem class="menuitem-iconic ai07" label="$vl_c_bdj_013" oncommand="pf_ouvre('nomenc_fab');" />
</popup>
<popup id="pop_nomclaturefab_cademploi">
  <menuitem class="menuitem-iconic ai07" label="$vl_c_bdj_013" oncommand="pf_ouvre('nomenc_cademploi');" />
</popup>
<tree id="arbre_nomenc_fab" flex="20" seltype="single" onselect="pf_sel_arbre_nomenc_fab();" context="pop_nomclaturefab_arbre_nomenc">
  <treecols>
    <treecol id="arbre_nomenc_fab_col01" flex="1" label="$vl_c_bdj_007"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_codearticle" flex="3" label="$vl_c_bdj_009"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_quantite" flex="1" label="$vl_c_bdj_008" class="droite" /><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_col02"  class="colname" primary="true" flex="20" label="$vl_c_bdj_011" /><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_art_cleunik_pere"  hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_art_cleunik_fils"  hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_fab_modifiable" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
  </treecols>
  <treechildren id="fils_arbre_nomenc_fab">
  </treechildren>
</tree>
</vbox>
<splitter/>
<vbox id="bdj_art_nomenclatures_fab_02" flex="0">
<groupbox>
  <caption><label value="$vl_c_bdj_014"/></caption>
  <grid >
    <columns >
     <column flex="1" />
     <column flex="4" />
    </columns>
    <rows>
      <row flex= "1">
        <label value="$vl_c_bdj_015" />
        <textbox observes="broadcaster_01" id="tb_multiple_base" type="number" hidespinbuttons="true" decimalplaces="2"  />
      </row>
      <row flex= "1">
        <label value="$vl_c_bdj_016" />
        <textbox observes="broadcaster_01" id="tb_pr" type="number" hidespinbuttons="true" decimalplaces="2"  />
      </row>
      <row flex= "1">
        <label value="$vl_c_bdj_017" />
        <textbox observes="broadcaster_01" id="tb_nbdec_pr" size="1" type="number" hidespinbuttons="true" min="0" max="4" onblur="pf_change_nbdec_pr();"/>
      </row>
    </rows>
  </grid>
</groupbox>
<groupbox flex="1">
  <caption><label value="$vl_c_bdj_018"/></caption>
        <grid flex="1">
          <columns >
           <column flex="1" />
           <column flex="4" />
          </columns>
          <rows>
           <row>
             <label value="$vl_c_bdj_007"/>
             <textbox observes="broadcaster_02" id="tb_nomencfab_noligne" type="number" hidespinbuttons="true" size="3"   />
           </row>
           <row>
            <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_02" flex="1" id="selart_nomenc_fab_ml_zone" class="normal" oncommand="pf_param_choix_selart_nomenc_fab();" value="$selection_article">
              <menupopup>
                <menuitem label="$vl_c_bdj_010" value="1"/>
                <menuitem label="$vl_c_bdj_009" value="2"/>
                <menuitem label="$vl_c_bdj_019" value="3"/>
              </menupopup>
            </menulist>

            <hbox>
            <textbox observes="broadcaster_02" flex="1" type="autosuggest" autosuggestsearch="" autosuggestparam="recherche" autosuggestlimit="limit" limit="50"
              minlength="2"
              maxrows="50"
              ref="urn:suggest:values"
              label="?label"
              properties="?prop"
              issuggest="?issuggest"
               
              
              _graal_cleunik=""
              id="selart_nomenc_fab"
            />
            <button observes="broadcaster_02" class="ad02" oncommand="pf_nomclaturefab_sel_article_pour_ligne();"/>
            </hbox>
           </row>
           <row>
             <label value="$vl_c_bdj_009"/>
             <textbox readonly="true" id="tb_nomencfab_codefils"   />
           </row>
           <row>
             <label value="$vl_c_bdj_010"/>
             <textbox readonly="true" id="tb_nomencfab_descourfils"   />
           </row>
           <row>
             <label value="$vl_c_bdj_008"/>
             <hbox>
               <textbox observes="broadcaster_02" id="tb_nomencfab_quantite" type="number" hidespinbuttons="true" decimalplaces="2"  onblur="pf_nomenclaturefab_valorise();" />
               <label value="$vl_c_bdj_020"/>
               <textbox observes="broadcaster_02" id="tb_nomencfab_nbdecimales" type="number" max="4" min="0"  onblur="fa_att_set('tb_nomencfab_quantite','decimalplaces',this.value);"/>
							 
            </hbox>
           </row>
					 <row>
					 <label value="$vl_c_bdj_037"/>
                <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_02" flex="1" id="ml_nomencfab_arrondi_fab" class="normal" _graal_nombre="3">
              <menupopup>
                <menuitem label="$vl_c_bdj_038" value="1" selected="true"/>
                <menuitem label="$vl_c_bdj_039" value="2" />
								<menuitem label="$vl_c_bdj_040" value="3" />
              </menupopup>
            </menulist>
					</row>	
           <row>
             <label value="$vl_c_bdj_021"/>
                <hbox>
                  <textbox id="tb_nomencfab_valorisation" type="number" hidespinbuttons="true" decimalplaces="2" readonly="true"  onblur="pf_nomenclaturefab_valorise();" _graal_base_valorisation=""/>
                  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_02" flex="1" id="ml_nomencfab_base_valorisation" oncommand="pf_change_menu_actifs_nomencfab_base_valorisation();" flags="" ref="*" querytype="xml" datasources="">
                    <template><query expr="*"/><action>
                      <menupopup>
                        <menuitem uri="?" class="menuitem-iconic ?prop" _graal_nbdec="?nbdec" _graal_nombre="?nombre" label="?tar_designation" value="?tar_cleunik" _graal_cleunik="?tar_cleunik" _graal_base_valorisation="?pu_reference"/> <!--  Les tarifs -->
                      </menupopup>
                    </action></template>
                  </menulist>
                  
                </hbox>
            </row>
           <row>
             <label value="$vl_c_bdj_022"/>
             <hbox>
               <textbox observes="broadcaster_02" id="tb_nomencfab_valeur_complement" type="number" hidespinbuttons="true" decimalplaces="2"  onblur="pf_nomenclaturefab_valorise();" />
               <label value="Type"/>
                <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_02" flex="1" id="ml_nomencfab_valeur_complement_type" class="normal" oncommand="pf_nomenclaturefab_valorise();">
              <menupopup>
                <menuitem label="$vl_c_bdj_023" value="1" selected="true"/>
                <menuitem label="$vl_c_bdj_024" value="2" />
              </menupopup>
            </menulist>
            </hbox>
            </row>
           <row>
             <label value="$vl_c_bdj_025"/>
                <hbox>
                  <textbox id="tb_nomencfab_valeurligne" type="number" hidespinbuttons="true" decimalplaces="2" readonly="true"  />
                  <_graal_raf flex="1" />
                </hbox>
            </row>

           <row flex= "10">
             <label value="$vl_c_bdj_026"/>
             <textbox observes="broadcaster_02" id="tb_nomencfab_blocnotebrut" multiline="true" row="10"   flex="1"/>
           </row>

          </rows>
        </grid>
<hbox>
$vl_c_ajouter<spacer flex="1"/>
$vl_c_modifier<spacer flex="1"/>
$vl_c_supprimer<spacer flex="1"/>
$vl_c_enregistrer<spacer flex="1"/>
$vl_c_annuler<spacer flex="1"/>
</hbox>
</groupbox>
</vbox>
</hbox>
<vbox>
<button label="$vl_c_bdj_006" oncommand="fa_gid('deck_fab').selectedIndex=0;" />
  <tree id="arbre_cademplois_nomenc" flex="1" hidecolumnpicker="true" flags="" ref="*" querytype="xml" datasources="" seltype="single" enableColumnDrag="true" context="pop_nomclaturefab_cademploi">
    <treecols>
      <treecol id="art_cleunik_pere" sort="?art_cleunik_pere" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol label="$vl_c_bdj_007" sort="?noligne"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol label="$vl_c_bdj_008" sort="?quantite" class="droite" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol label="$vl_c_bdj_009" sort="?code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol label="$vl_c_bdj_010" sort="?description"/><splitter class="tree-splitter" resizeafter="grow"/>
    </treecols>
    <template><query expr="*"/><action>
      <treechildren>
        <treeitem uri="?" seltype="single">
          <treerow>
            <treecell label="?art_cleunik_pere"/>
            <treecell label="?noligne"/>
            <treecell label="?quantite"/>
            <treecell label="?code"/>
            <treecell label="?description"/>
          </treerow>
        </treeitem>
      </treechildren>
    </action></template>
  </tree>
</vbox>
</deck>
      </tabpanel>
  		<tabpanel id="tabnomencpanel_fab" flex="1">



<vbox id="bdj_art_fabrication_fab_01" flex="3">
  <deck id="deck_fab_01" selectedIndex="0" flex="1">
    <vbox flex="1">
      <toolbar grippyhidden="true">
    	  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_bdj_001" oncommand="pf_affiche_donnees_fabrications();"/>
				<toolbarbutton class="am07" tooltiptext="Lancer une fabrication" oncommand="pf_lance_fabrication();"/>
        <toolbarseparator />
        <button label="$vl_c_bdj_004" tooltiptext="$vl_c_bdj_005" oncommand="fa_gid('deck_fab_01').selectedIndex=1;pf_affiche_donnees_casdemploi_fab();" id="cademploi_composants_fab" />
      </toolbar>
      <tree id="arbre_fabrications" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" enableColumnDrag="true" ondblclick="pf_dblclick_arbre_art_actions(this.id);">
        <treecols>
          <treecol id="code" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="reference" label="$vl_c_bdj_027" sort="?reference"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="sujet" label="$vl_c_bdj_028" sort="?sujet"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="action_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="dateheuredebut" label="$vl_c_bdj_029" sort="?dateheuredebut"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="dateheurefin" label="$vl_c_bdj_030" sort="?dateheurefin"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="fab_ligne_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="fab_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="qte_lancee" class="droite" label="$vl_c_bdj_031" sort="?qte_lancee"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="qte_fabriq" class="droite" label="$vl_c_bdj_032" sort="?qte_fabriq"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="pu" class="droite" label="$vl_c_bdj_033" sort="?pu"/><splitter class="tree-splitter" resizeafter="grow"/>
        </treecols>
        <template><query expr="*"/><action>
          <treechildren>
            <treeitem uri="?" seltype="single">
              <treerow>
                <treecell label="?code"/>
                <treecell label="?reference"/>
                <treecell label="?sujet"/>
                <treecell label="?action_cleunik"/>
                <treecell label="?dateheuredebut"/>
                <treecell label="?dateheurefin"/>
                <treecell label="?fab_ligne_cleunik"/>
                <treecell label="?fab_cleunik"/>
                <treecell label="?qte_lancee"/>
                <treecell label="?qte_fabriq"/>
                <treecell label="?pu"/>
              </treerow>
            </treeitem>
          </treechildren>
        </action></template>
      </tree>
    </vbox>
  <vbox>
    <button label="$vl_c_bdj_036" oncommand="fa_gid('deck_fab_01').selectedIndex=0;" />
      <tree id="arbre_cademplois_fab" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" enableColumnDrag="true">
        <treecols>
          <treecol id="code" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="reference" label="$vl_c_bdj_027" flex="1" sort="?reference"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="code_article_pere" label="$vl_c_bdj_034" sort="?code_article_pere"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="description_article_pere" label="$vl_c_bdj_035" sort="?description_article_pere"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="sujet" label="$vl_c_bdj_028" sort="?sujet"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="action_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="dateheuredebut" label="$vl_c_bdj_029" sort="?dateheuredebut"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="dateheurefin" label="$vl_c_bdj_030" sort="?dateheurefin"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="fab_ligne_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="fab_cleunik" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="qte_lancee" class="droite" label="$vl_c_bdj_031" sort="?qte_lancee"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="qte_fabriq" class="droite" label="$vl_c_bdj_032" sort="?qte_fabriq"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="pu" class="droite" label="$vl_c_bdj_033" sort="?pu"/><splitter class="tree-splitter" resizeafter="grow"/>
        </treecols>
        <template><query expr="*"/><action>
          <treechildren>
            <treeitem uri="?" seltype="single">
              <treerow>
                <treecell label="?code"/>
                <treecell label="?reference"/>
                <treecell label="?code_article_pere"/>
                <treecell label="?description_article_pere"/>
                <treecell label="?sujet"/>
                <treecell label="?action_cleunik"/>
                <treecell label="?dateheuredebut"/>
                <treecell label="?dateheurefin"/>
                <treecell label="?fab_ligne_cleunik"/>
                <treecell label="?fab_cleunik"/>
                <treecell label="?qte_lancee"/>
                <treecell label="?qte_fabriq"/>
                <treecell label="?pu"/>
              </treerow>
            </treeitem>
          </treechildren>
        </action></template>
      </tree>
    </vbox>
  </deck>
</vbox>
  		</tabpanel>
  	</tabpanels>
  </tabbox>
END;
?>
