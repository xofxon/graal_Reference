<?php
include("_graal_header_xml.inc.php");
$vl_e_obj_cleunik=intval(fa_recup_param('vl_e_obj_cleunik','0'));
$vl_e_langue=intval(fa_recup_param('vl_e_langue','120115'));  //  anglais par défaut
$vl_e_français=120131;
$vl_b_atraduireseuls=intval(fa_recup_param('vl_b_atraduireseuls','0'));
$vl_e_uti_cleunik=0;
$vl_c_dico00008=fa_recup_dico("dico_00008");
$vl_c_dico00009=fa_recup_dico("dico_00009");
$vl_c_dico00010=fa_recup_dico("dico_00010");
$vl_c_dico00011=fa_recup_dico("dico_00011");
$vl_c_dico00012=fa_recup_dico("dico_00012");
$vl_c_dico00017=fa_recup_dico("dico_00017");
//  On commence par ajouter, à partir des libellés français, les libellés étrangers
$sql_req = "insert into _elements_libelle select alias01.ele_cleunik,alias01.descriptif,alias01.commentaire,$vl_e_langue,$vl_e_uti_cleunik from _elements_libelle alias01 where alias01.ele_cleunik not in ( select _elements_libelle.ele_cleunik from _elements_libelle where langue=$vl_e_langue)";
$result = _graal_requete_bd($sql_req);
$sql_req = "SELECT _elements.ele_cleunik as ele_cleunik,_elements.titre AS titre,_elements_libelle.descriptif AS descriptif, _traduits.descriptif AS traduction,_elements_libelle.commentaire AS commentaire,_elements.type_objet as type_objet FROM _elements,_elements_libelle,_elements_libelle _traduits WHERE _elements.ele_cleunik=_elements_libelle.ele_cleunik and _traduits.ele_cleunik=_elements_libelle.ele_cleunik and _elements_libelle.langue=$vl_e_français and _traduits.langue=$vl_e_langue and _elements.fen_cleunik=$vl_e_obj_cleunik";
if ($vl_b_atraduireseuls==1)
{
  $sql_req .= " and _elements_libelle.descriptif=_traduits.descriptif"; 
}
$sql_req .= " ORDER BY descriptif;";
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
	echo(' ele_cleunik="'.fa_ent_xml($row['ele_cleunik']).'"');
	echo(' titre="'.fa_ent_xml($row['titre']).'"');
	echo(' descriptif="'.fa_ent_xml($row['descriptif']).'"');
	echo(' traduction="'.fa_ent_xml($row['traduction']).'"');
	echo(' commentaire="'.fa_ent_xml($row['commentaire']).'"');
	switch ($row['type_objet']){
	  case 1:echo(" type_objet_clair='$vl_c_dico00008'");break;
	  case 2:echo(" type_objet_clair='$vl_c_dico00009'");break;
	  case 3:echo(" type_objet_clair='$vl_c_dico00011'");break;
	  case 4:echo(" type_objet_clair='$vl_c_dico00012'");break;
	  case 5:echo(" type_objet_clair='$vl_c_dico00017'");break;
	  default:echo(" type_objet_clair='$vl_c_dico00010'");break;
	}
	 echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
