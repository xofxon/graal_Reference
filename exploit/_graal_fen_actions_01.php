<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik=intval(fa_recup_session("vs_uti_cleunik","0"));
$param_generaux_graal_044=intval(fa_recup_session('vs_param_generaux_graal_044','0'));
$vl_c_genreaction=fa_recup_param("genreaction","aucune");
$vl_c_visu=fa_recup_param("visu","non");
$lesquels=fa_recup_param("lesquels","raf");
$quoi=fa_recup_param("quoi","raf");
$vl_e_doc_cleunik=intval(fa_recup_param("vl_e_doc_cleunik",-1));
$vl_c_quelarbre_actions=fa_recup_param("arbre","1");
$vl_c_dico_00002=fa_recup_dico('dico_00002');
$vl_c_dico_00003=fa_recup_dico('dico_00003');
$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_dico_00019=fa_recup_dico('dico_00019');
$vl_c_dico_00020=fa_recup_dico('dico_00020');
$vl_c_dico_00021=fa_recup_dico('dico_00021');
$vl_c_dico_00022=fa_recup_dico('dico_00022');
$vl_c_dico_00023=fa_recup_dico('dico_00023');
$vl_c_dico_00024=fa_recup_dico('dico_00024');
$vl_c_dico_00025=fa_recup_dico('dico_00025');
$vl_c_dico_00045=fa_recup_dico('dico_00045');
switch ($vl_c_genreaction){
  case "toutes":
  case "toutes_principales":
  case "courriels":
  case "favorites"              :$vl_c_id_fenetre="Fen_00339";$id_inc_actions_recherche="Div_00374";break;
  case "dernieres_sauf_emailing":$vl_c_id_fenetre="Fen_00339";$id_inc_actions_recherche="Div_00592";break;
  case "emitel"                 :$vl_c_id_fenetre="Fen_00441";$id_inc_actions_recherche="Div_00404";break;
  case "rectel"                 :$vl_c_id_fenetre="Fen_00442";$id_inc_actions_recherche="Div_00405";break;
  case "emimail":
  case "emimail_brouillon":
  	$vl_c_id_fenetre="Fen_00454";$id_inc_actions_recherche="Div_00424";break;

  case "emifax"                :$vl_c_id_fenetre="Fen_01028";$id_inc_actions_recherche="Div_00570";break;
  case "emisms"                :$vl_c_id_fenetre="Fen_xxxxx";$id_inc_actions_recherche="Div_00xxx";break;

  case "recmail":
  case "recmail_lecture":
  case "recmail_erreur":
  case "recmail_ar":
  case "emailing":
		$vl_c_id_fenetre="Fen_00455";$id_inc_actions_recherche="Div_00425";break;
	case "recvoc":
	  $vl_c_id_fenetre="Fen_00939";$id_inc_actions_recherche="Div_00545";break;
	case "recfax":
	  $vl_c_id_fenetre="Fen_00940";$id_inc_actions_recherche="Div_00547";break;
  case "offcli"                 :$vl_c_id_fenetre="Fen_00456";$id_inc_actions_recherche="Div_00426";break;
  case "demfou"                 :$vl_c_id_fenetre="Fen_00457";$id_inc_actions_recherche="Div_00427";break;
  case "cdecli"                 :
  	$vl_c_id_fenetre="Fen_00458";
	switch ("$vl_c_quelarbre_actions"){
		case "1":$id_inc_actions_recherche="Div_00428";break;
		case "2":$id_inc_actions_recherche="Div_00575";break;
		case "5":$id_inc_actions_recherche="Div_00593";break;
	}
	break;
  case "cdefou"                 :$vl_c_id_fenetre="Fen_00459";$id_inc_actions_recherche="Div_00429";break;
  case "relfou"                 :$vl_c_id_fenetre="Fen_01135";$id_inc_actions_recherche="Div_00596";break;
  case "livcli"                 :$vl_c_id_fenetre="Fen_00460";$id_inc_actions_recherche="Div_00430";break;
  case "recfou"                 :$vl_c_id_fenetre="Fen_00461";$id_inc_actions_recherche="Div_00431";break;
  case "faccli":
  case "faccli_livcli"                 :
  case "faccli_avocli":
  	$vl_c_id_fenetre="Fen_00462";
	switch ("$vl_c_quelarbre_actions"){
		case "1":$id_inc_actions_recherche="Div_00432";break;
		case "4":$id_inc_actions_recherche="Div_00593";break;
		case "5":$id_inc_actions_recherche="Div_00593";break;
		case "6":$id_inc_actions_recherche="Div_00593";break;
		case "7":$id_inc_actions_recherche="Div_00593";break;
	}
  	break;
  case "profor"                 :$vl_c_id_fenetre="Fen_00462";$id_inc_actions_recherche="Div_00432";break;
  case "avocli"                 :$vl_c_id_fenetre="Fen_00734";$id_inc_actions_recherche="Div_00537";break;
  case "facfou"                 :$vl_c_id_fenetre="Fen_00463";$id_inc_actions_recherche="Div_00433";break;
  case "avofou"                 :$vl_c_id_fenetre="Fen_01138";$id_inc_actions_recherche="Div_00597";break;
  case "retcli"                 :$vl_c_id_fenetre="Fen_01089";$id_inc_actions_recherche="Div_00577";break;
  case "retfou"                 :$vl_c_id_fenetre="Fen_01090";$id_inc_actions_recherche="Div_00578";break;
  case "chat"                   :$vl_c_id_fenetre="Fen_00507";$id_inc_actions_recherche="Div_00471";break;
  case "fabrica"  				:$vl_c_id_fenetre="Fen_00554";$id_inc_actions_recherche="Div_00483";break;
  case "avecpj"                 :$vl_c_id_fenetre="Fen_00586";$id_inc_actions_recherche="Div_00495";break;
  case "formul"                 :$vl_c_id_fenetre="Fen_00662";$id_inc_actions_recherche="Div_00513";break;
	case "desins_mail"			:$vl_c_id_fenetre="Fen_00738";$id_inc_actions_recherche="Div_00540";break;
	case "remban"				:$vl_c_id_fenetre="Fen_00953";$id_inc_actions_recherche="Div_00560";break;
	case "post_it"				:$vl_c_id_fenetre="Fen_01048";$id_inc_actions_recherche="Div_00572";break;
	case "bordex"				:$vl_c_id_fenetre="Fen_01060";$id_inc_actions_recherche="Div_00572";break;
	case "emailing_track"		:$vl_c_id_fenetre="Fen_01077";$id_inc_actions_recherche="Div_00576";break;
	case "alertes"				:$vl_c_id_fenetre="Fen_01145";$id_inc_actions_recherche="Div_00598";break;
	case "cdecli_suivi"			:$vl_c_id_fenetre="Fen_01150";$id_inc_actions_recherche="Div_00599";break;
	case "reponse_sondage"			:$vl_c_id_fenetre="Fen_00738";$id_inc_actions_recherche="Div_00540";break;
	case "aucune":
  default:
    fa_redirige("acces_interdit");
    break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
switch ($quoi){
	case "raf":
		$onload="fa_aa(this);pf_aa_init_bem('21');";
	break;
	case "nouvelle_cdecli":
		$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00477",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false){fa_redirige("acces_interdit");}
		$onload="fa_aa(this);pf_aa_init_bem('21');fa_cache_oui('$c_id_windows');fa_cache_non('$c_id_windows');";	//comment cacher une fenêtre ?
		$onload="fa_aa(this);pf_aa_init_bem('21');pf_ouvre_acteur('110003','cdecli');";
		break;
}
$vl_c_id_fen_action="Fen_00425";
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fen_action,$vl_e_uti_cleunik);
switch ("$vl_c_quelarbre_actions"){
		case "7":
			$vl_b_ajout=0;$vl_b_modif=0;$vl_b_suppr=0;$vl_b_impri=0;$vl_b_detai=0;
			break;
		default:
			$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
			break;
	}
$vl_tc_composants=array($vl_c_id_fenetre,$id_inc_actions_recherche);
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bda_100=fa_recup_dico("bda_100");
$vl_c_bda_101=fa_recup_dico("bda_101");
$vl_c_bda_102=fa_recup_dico("bda_102");
$vl_c_bda_103=fa_recup_dico("bda_103");
$vl_c_bda_104=fa_recup_dico("bda_104");
$vl_c_bda_105=fa_recup_dico("bda_105");
$vl_c_bda_106=fa_recup_dico("bda_106");
$vl_c_bda_109=fa_recup_dico("bda_109");
$vl_c_bda_110=fa_recup_dico("bda_110");
$vl_c_bda_111=fa_recup_dico("bda_111");
$vl_c_bda_112=fa_recup_dico("bda_112");
$vl_c_bda_113=fa_recup_dico("bda_113");
$vl_c_bda_114=fa_recup_dico("bda_114");
$vl_c_bda_115=fa_recup_dico("bda_115");
$vl_c_bda_116=fa_recup_dico("bda_116");
$vl_c_bda_117=fa_recup_dico("bda_117");
$vl_c_bda_118=fa_recup_dico("bda_118");
$vl_c_bda_119=fa_recup_dico("bda_119");
$vl_c_bda_120=fa_recup_dico("bda_120");
$vl_c_bda_121=fa_recup_dico("bda_121");
$vl_c_bda_123=fa_recup_dico("bda_123");
$vl_c_bda_124=fa_recup_dico("bda_124");
$vl_c_bda_125=fa_recup_dico("bda_125");
$vl_c_bda_126=fa_recup_dico("bda_126");
$vl_c_bda_127=fa_recup_dico("bda_127");
$vl_c_bda_128=fa_recup_dico("bda_128");
$menu_ajout="";
$menu_ajout.="<menupopup id='menu_ajout'><menuitem class='menuitem-iconic ba07' label='$vl_c_bda_103' oncommand='pf_etat_fen_bem(\"ajouter\")' tooltiptext='$vl_c_dico_00002 Ctrl+Shift+F2' keycode='k-ajouter'/>";
$menu_ajout.="<menu label='$vl_c_bda_101'><menupopup>";
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00001",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_dico_00019.'" oncommand="pf_ajoute_bem(\'tel\',\'110000\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00002",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba02" label="'.$vl_c_dico_00020.'" oncommand="pf_ajoute_bem(\'tel\',\'110001\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00005",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba04" label="'.$vl_c_dico_00022.'" oncommand="pf_ajoute_bem(\'tel\',\'110002\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00006",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba01" label="'.$vl_c_dico_00021.'" oncommand="pf_ajoute_bem(\'tel\',\'110003\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00009",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba03" label="'.$vl_c_dico_00023.'" oncommand="pf_ajoute_bem(\'tel\',\'110004\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00010",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba05" label="'.$vl_c_dico_00024.'" oncommand="pf_ajoute_bem(\'tel\',\'110005\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00011",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba06" label="'.$vl_c_dico_00025.'" oncommand="pf_ajoute_bem(\'tel\',\'110006\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Trait_00219",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ai18" label="'.$vl_c_dico_00045.'" oncommand="pf_ajoute_bem(\'tel\',\'tousss\')" />';}
$menu_ajout.="</menupopup></menu>";
$menu_ajout.="<menu label='$vl_c_bda_109'><menupopup>";
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00671",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_111.'" oncommand="pf_ouvre_acteur(\'110001\',\'offcli\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00671",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_112.'" oncommand="pf_ouvre_acteur(\'110003\',\'offcli\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00477",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_110.'" oncommand="pf_ouvre_acteur(\'110003\',\'cdecli\')" />';}
switch ($param_generaux_graal_044) {
	case 1://	Services
		break;
	case 2://	Négoce
		$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00672",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_113.'" oncommand="pf_ouvre_acteur(\'110003\',\'livcli\')" />';}
		$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01091",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_124.'" oncommand="pf_ouvre_acteur(\'110003\',\'retcli\')" />';}
		break;
	case 3://	Mixte
		$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00672",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_113.'" oncommand="pf_ouvre_acteur(\'110003\',\'livcli\')" />';}
		$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01091",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_124.'" oncommand="pf_ouvre_acteur(\'110003\',\'retcli\')" />';}
		break;
}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00742",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_121.'" oncommand="pf_ouvre_acteur(\'110003\',\'profor\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00673",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_114.'" oncommand="pf_ouvre_acteur(\'110003\',\'faccli\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00674",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_115.'" oncommand="pf_ouvre_acteur(\'110003\',\'avocli\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00674",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_116.'" oncommand="pf_ouvre_acteur(\'110003\',\'avofin\')" />';}
$menu_ajout.="</menupopup></menu>";

$menu_ajout.="<menu label='$vl_c_bda_117'><menupopup>";
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00675",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_118.'" oncommand="pf_ouvre_acteur(\'110002\',\'demfou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00675",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_119.'" oncommand="pf_ouvre_acteur(\'110004\',\'demfou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00676",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_120.'" oncommand="pf_ouvre_acteur(\'110004\',\'cdefou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01092",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_125.'" oncommand="pf_ouvre_acteur(\'110004\',\'retfou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00678",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_127.'" oncommand="pf_ouvre_acteur(\'110004\',\'facfou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01139",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_126.'" oncommand="pf_ouvre_acteur(\'110004\',\'avofou\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01139",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ba07" label="'.$vl_c_bda_128.'" oncommand="pf_ouvre_acteur(\'110004\',\'avofif\')" />';}
$menu_ajout.="</menupopup></menu>";


$menu_ajout.="<menuitem class='ba07' label='$vl_c_bda_102' oncommand='pf_ajoute_bem(\"rectel\",\"\");'/>";
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00696",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic xx02" label="'.$vl_c_bda_104.'" oncommand="pf04_emichat(-1);" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00066",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ah09" label="'.$vl_c_bda_105.'" oncommand="pf_ajoute_bem(\'emimail_texte\',\'tousss\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_00513",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic ah09" label="'.$vl_c_bda_106.'" oncommand="pf_ajoute_bem(\'emimail_html\',\'tousss\')" />';}
$vl_tb_droits=_graal_requete_droits_fenetre("Fen_01049",$vl_e_uti_cleunik);if ($vl_tb_droits[0]==true) {$menu_ajout.='<menuitem class="menuitem-iconic am16" label="'.$vl_c_bda_123.'" oncommand="pf_ajoute_bem(\'post_it\',\'\')" />';}
$menu_ajout.="</menupopup>";
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
//$c_id_windows="";
echo <<<END
<window context="graal_cp00" title="$vl_c_bda_100" id="$c_id_windows" onload="$onload" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_04.js.php");
include("js/_graal_actions_selection_01.js.php");
include_once("js/_graal_05_dates.js.php");
$vl_b_bloc_action_recherche=true;$vl_c_arbre_action="arbre_actions_01";
if ($vl_c_genreaction=="post_it"){
	$bloc_date="periode_datepicker";
	$vl_c_visu="non";
include("_graal_var_portee.php");
include("_graal_inc_actions_recherche_selection_01.php");
echo <<<END
<vbox flex="20">
      <iframe onload="fa_aa(window.graal_iframe_visu_action);event.stopPropagation();" id="graal_iframe_visu_action" src="" flex="1"/>
  </vbox>
END;
echo('</vbox></vbox>');

} else {
echo('<vbox flex="10" class="overflow_01">');
include ("_graal_inc_actions_recherche_01.php");
echo('<vbox><hbox id="boutons_standards">');
if ($vl_b_ajout==true)
{echo ('<button type="menu" width="40" flex="1" id="bt_ajouter" label="'.$vl_c_dico_00002.'" crop="end" dir="normal" >');echo($menu_ajout);echo("</button>");}
else {echo('<spacer flex="1"/>');}
if ($vl_b_modif==true) {echo('<button tooltiptext ="'.$vl_c_dico_00003.' Ctrl+Shift+F3" keycode="k-modifier" width="40" flex="1" id="bt_modifier" label="'.$vl_c_dico_00003.'" crop="end" dir="normal" oncommand="pf_dblclick_arbre_actions_bem()" />');}
else {echo('<spacer flex="1"/>');}
echo <<<END
    <button flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen_bem('sortir')" collapsed="true"/>
</hbox></vbox></vbox>
END;
if ($vl_c_visu=="oui") {
echo <<<END
<splitter ondblclick="aad_pf_cache();"> </splitter>
  <vbox flex="20">
      <iframe onload="fa_aa(window.graal_iframe_visu_action);event.stopPropagation();" id="graal_iframe_visu_action" src="" flex="1"/>
  </vbox>
END;
}
}
echo("</window>");
?>
