<?php
define('EOL', "\r\n");
include("_graal_header_txt.inc.php");
$name=$_FILES['filename']['name'];
$tmp=$_FILES['filename']['tmp_name'];
$type=$_FILES['filename']['type'];  //  Pas fiable : regarde, a priori, l'extension !!  
if (fa_extension($name)!="ico") {
  $mime=fa_mime_type_buffer(file_get_contents($tmp));
  if (($mime=="") || ($mime=="???") || ($mime=="!!!")){
    $mime="image/".fa_extension($tmp);
  }
} else {
  $mime="image/x-icon";
}

echo 'data:'.$mime.';base64,'.base64_encode(file_get_contents($_FILES['filename']["tmp_name"]));
//echo 'data:'.$name.';base64,'.base64_encode(file_get_contents($_FILES['filename']["tmp_name"]));
//echo 'data:xxx;base64,'.base64_encode(file_get_contents($_FILES['filename']["tmp_name"]));
?>
