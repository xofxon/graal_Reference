<?php
include("_graal_header_xml.inc.php");
include("_graal_var_portee.php");
define('EOL', "\r\n");
$vl_e_action_cleunik=intval(fa_recup_param('vl_action_cleunik','10281'));
$prop_acteur_principal="ad05";
// execution de la requète SQL
$sql_req = "SELECT f01.act_cleunik as `act_cleunik`,f01.int_cleunik as `int_cleunik`,f01.action_cleunik as `action_cleunik`,f01.choix_cleunik as `choix_cleunik`,f01.portee as `portee`,f02.choix_valeur_texte_01 as `choix_valeur_texte_01`,f03.raisonsoc as `raisonsoc`,'' as `interlocuteur`,'ai15' as prop_act,'' as prop_int,f07.choix_valeur_texte_01 as type_acteur_en_clair,f01.principal as principal FROM _graal f01,_choix f02,_acteurs f03,_choix f07 where action_cleunik=$vl_e_action_cleunik and f01.portee = $vl_e_acteur and f02.choix_cleunik=f01.choix_cleunik and f01.act_cleunik=f03.act_cleunik and f07.choix_cleunik=f03.typeacteur"; 
$sql_req.=" union all "; 
$sql_req.="SELECT f01.act_cleunik as `act_cleunik`,f01.int_cleunik as `int_cleunik`,f01.action_cleunik as `action_cleunik`,f01.choix_cleunik as `choix_cleunik`,f01.portee as `portee`,f02.choix_valeur_texte_01 as `choix_valeur_texte_01`,f03.raisonsoc as `raisonsoc`,concat_ws(' ',f05.choix_valeur_texte_01,f04.prenom,f04.patronyme) as `interlocuteur`,'' as prop_act,'ai18' as prop_int,f07.choix_valeur_texte_01 as type_acteur_en_clair,f01.principal as principal FROM _graal f01,_choix f02,_acteurs f03,_act_interlo f04,_choix f05,_choix f07 where action_cleunik=$vl_e_action_cleunik and f02.choix_cleunik=f01.choix_cleunik and f01.act_cleunik=f03.act_cleunik and f04.int_cleunik =f01.int_cleunik and f05.choix_cleunik = f04.choix_cleunik and f01.portee = $vl_e_interl and f07.choix_cleunik=f03.typeacteur;"; 

$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());  
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  // parseType = indication pour le type des données, utile pour le tri sur la colonne
  echo('<row:act_cleunik NC:parseType="Integer">'.fa_ent_xml($row['act_cleunik']).'</row:act_cleunik>');
  echo('<row:int_cleunik NC:parseType="Integer">'.fa_ent_xml($row['int_cleunik']).'</row:int_cleunik>');
  echo('<row:action_cleunik NC:parseType="Integer">'.fa_ent_xml($row['action_cleunik']).'</row:action_cleunik>');
  echo('<row:choix_cleunik NC:parseType="Integer">'.fa_ent_xml($row['choix_cleunik']).'</row:choix_cleunik>');
  echo('<row:portee NC:parseType="Integer">'.fa_ent_xml($row['portee']).'</row:portee>');
  echo('<row:choix_valeur_texte_01>'.fa_ent_xml($row['choix_valeur_texte_01']).'</row:choix_valeur_texte_01>');
  echo('<row:raisonsoc>'.fa_ent_xml($row['raisonsoc']).'</row:raisonsoc>');
  echo('<row:interlocuteur>'.fa_ent_xml($row['interlocuteur']).'</row:interlocuteur>');
  echo('<row:prop_act>'.fa_ent_xml($row['prop_act']).'</row:prop_act>');
  echo('<row:prop_int>'.fa_ent_xml($row['prop_int']).'</row:prop_int>');
  echo('<row:type_acteur_en_clair>'.fa_ent_xml($row['type_acteur_en_clair']).'</row:type_acteur_en_clair>');
  if (fa_ent_xml($row['principal'])==2) {
    echo('<row:principal>'.$prop_acteur_principal.'</row:principal>');
  } else {
    echo('<row:principal></row:principal>');
  }
  echo('<row:val_principal>'.fa_ent_xml($row['principal']).'</row:val_principal>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
// fin du fichier RDF
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
