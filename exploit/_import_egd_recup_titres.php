<?php
include("_graal_header_txt.inc.php");
/*
 * http://localhost/graal/exploit/_import_egd_recup_titres.php
 * https://egdiffusion.xsoftware.fr/2c760b07-4c7a-402f-b015-d2ca450b9b0c/graal/exploit/_import_egd_recup_titres.php
 */
define('EOL', "\r\n");
set_time_limit(60);
$vl_c_base_origine=fa_recup_param('vl_c_base_origine','egdiffusion');
$vl_c_base_destination=fa_recup_param('vl_c_base_destination','graal_egdiffusion');
$vl_e_traitement=fa_recup_param('vl_e_traitement','0');
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.casino_catalogue c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.eg_catalogues c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);

$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.eg_pas_catalogues c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.celine_casino_catalogues c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.celine_casino_pas_catalogue c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);

$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.celine_catalogues c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);

$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.celine_pas_catalogue c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);

$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.maeva_catalogue c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.maeva_pas_catalogue c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);
$sql_req = "SELECT distinct(Titre) as fonction FROM $vl_c_base_origine.fournisseurs c where Titre is not null and Titre not in (select choix_valeur_texte_01 from $vl_c_base_destination._choix where critere_cleunik=86);";
$result = _graal_requete_bd($sql_req);
$vf_c_echo='Rien de nouveau à importer. Vérifiez tout de même les associations.';echo $sql_req.EOL;
while ($row = mysql_fetch_assoc($result))
  {
//  Ajout dans la table des choix
      $vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
      $sql_req_01 = "INSERT INTO $vl_c_base_destination._choix set";
      $sql_req_01 .=" critere_cleunik=86";
      $sql_req_01 .=",choix_cleunik=$vf_e_choix_cleunik";
      $sql_req_01 .=",choix_code=''";
      $sql_req_01 .=",choix_valeur_texte_01='".addslashes($row['fonction'])."'";
      $sql_req_01 .=",choix_actif=1";
      $sql_req_01 .=",choix_portee=127";
      $result_01 = _graal_requete_bd($sql_req_01);echo $sql_req_01.EOL;flush();
      if($result_01 === false)
      {
          $vf_c_echo=mysql_error($cnx) . $sql_req_01;
      }
        else
          $vf_c_echo='ok';
  }
_graal_libere_requete_bd($result);

_graal_ferme_connexion();
echo($vf_c_echo);
?>
