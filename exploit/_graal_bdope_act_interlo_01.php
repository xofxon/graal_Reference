<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_act_interlo_02";
$t_origines_ok[1]="_graal_fen_act_interlo_simple_01";
$t_origines_ok[2]="_graal_fen_act_interlo_simple_02";
$t_origines_ok[3]="_graal_fen_act_interlo_simple_03";
$t_origines_ok[4]="_graal_fen_act_interlo_simple_04";
$t_origines_ok[5]="_graal_fen_act_interlo_simple_05";
fa_acces_script();
$vf_c_echo="";
$a[0]='/[^0-9]/i'; // Tout ce qui n'est pas compris entre 0 et 9 sans distinction de minuscule ou majuscule
$b[0]='';
//  Informations interlocuteur
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_int_cleunik=intval(fa_recup_param("vl_int_cleunik",0));
$vl_codealphanum15=fa_recup_param("vl_codealphanum15","");
$vl_act_cleunik=intval(fa_recup_param("vl_act_cleunik",0));
$vl_patronyme=fa_recup_param("vl_patronyme","");
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_prenom=fa_recup_param("vl_prenom","");
$vl_infodefaut=intval(fa_recup_param("vl_infodefaut",0));
$vl_actif=intval(fa_recup_param("vl_actif",0));
$vl_fonction=intval(fa_recup_param("vl_fonction",0));
$vl_c_genreacteur=fa_recup_param("vl_c_genreacteur","");
//$vl_dateheurevalidite=fa_recup_param("vl_dateheurevalidite","");
$vl_choix_cleunik=intval(fa_recup_param("vl_choix_cleunik",0));
//  Eventuelles informations courriel
$vl_refweb=fa_recup_param("vl_refweb","");
$vl_blocnotebrut_courriel=fa_recup_param("vl_blocnotebrut_courriel","");
$vl_veuxpasdemail=intval(fa_recup_param("vl_veuxpasdemail",""));
$vl_infofavori=intval(fa_recup_param("vl_infofavori",""));
$vl_utilisable=intval(fa_recup_param("vl_utilisable","1"));
$vl_act_cleunik=intval(fa_recup_param("vl_act_cleunik",""));
$vl_choix_cleunik_courriel=intval(fa_recup_param("vl_choix_cleunik_courriel",""));
$vl_valide=intval(fa_recup_param("vl_valide",""));
$vl_cr_verification=fa_recup_param("vl_cr_verification","");
$vl_dateheureverification=fa_recup_param("vl_dateheureverification","");
//  Eventuelles informations tel
$vl_telformate_tel=fa_recup_param("vl_telformate_tel","");
$vl_blocnotebrut_tel=fa_recup_param("vl_blocnotebrut_tel","");
$vl_infofavori_tel=intval(fa_recup_param("vl_infofavori_tel",0));
$vl_choix_cleunik_tel=intval(fa_recup_param("vl_choix_cleunik_tel",0));
$vl_prefixe_choix_cleunik_tel=intval(fa_recup_param("vl_prefixe_choix_cleunik_tel",0));
$vl_c_chaine_nette_tel=preg_replace($a, $b, $vl_telformate_tel);
$vl_portable_tel=intval(fa_recup_param("vl_portable_tel",2));
$vl_sms_tel=intval(fa_recup_param("vl_sms_tel",2));
//  Eventuelles informations fax
$vl_telformate_fax=fa_recup_param("vl_telformate_fax","");
$vl_blocnotebrut_fax=fa_recup_param("vl_blocnotebrut_fax","");
$vl_infofavori_fax=intval(fa_recup_param("vl_infofavori_fax",0));
$vl_choix_cleunik_fax=intval(fa_recup_param("vl_choix_cleunik_fax",0));
$vl_prefixe_choix_cleunik_fax=intval(fa_recup_param("vl_prefixe_choix_cleunik_fax",0));
$vl_c_chaine_nette_fax=preg_replace($a, $b, $vl_telformate_fax);
//  Eventuelles informations 2° teléléphone
$vl_telformate_tel_01=fa_recup_param("vl_telformate_tel_01","");
$vl_blocnotebrut_tel_01=fa_recup_param("vl_blocnotebrut_tel_01","");
$vl_infofavori_tel_01=intval(fa_recup_param("vl_infofavori_tel_01",0));
$vl_choix_cleunik_tel_01=intval(fa_recup_param("vl_choix_cleunik_tel_01",0));
$vl_prefixe_choix_cleunik_tel_01=intval(fa_recup_param("vl_prefixe_choix_cleunik_tel_01",0));
$vl_c_chaine_nette_tel_01=preg_replace($a, $b, $vl_telformate_tel_01);
$vl_portable_tel_01=intval(fa_recup_param("vl_portable_tel_01",2));
$vl_sms_tel_01=intval(fa_recup_param("vl_sms_tel_01",2));
switch (TRUE) {
  case $vf_c_action=="supprimer":
    if ($vl_int_cleunik!=0) {
      $sql_req = "DELETE FROM _act_interlo WHERE _act_interlo.int_cleunik = $vl_int_cleunik";
      if(_graal_exec_requete($sql_req)=='ok') {$vf_c_echo=0;} else {$vf_c_echo=-1;}
    } else {
      $vf_c_echo=-1;
    }
    break;
  case $vf_c_action=="ajouter":
    $vl_int_cleunik=_graal_requete_max("int_cleunik","_act_interlo");
    $sql_req = "INSERT INTO _act_interlo set int_cleunik=$vl_int_cleunik,codealphanum15='$vl_codealphanum15',act_cleunik=$vl_act_cleunik,patronyme='$vl_patronyme',blocnotebrut='$vl_blocnotebrut',prenom='$vl_prenom',dateheuremodif=now(),infodefaut=$vl_infodefaut,choix_cleunik=$vl_choix_cleunik,actif=$vl_actif";
    if(_graal_exec_requete($sql_req)=='ok') {
      $vf_c_echo=$vl_int_cleunik;
      $sql_req = "insert into _act_interlo_choix_fixes set act_cleunik=$vl_act_cleunik,int_cleunik=$vl_int_cleunik,choix_cleunik=$vl_fonction,critere_cleunik=92,typeacteur=$vl_c_genreacteur,uti_cleunik=0";
      if(_graal_exec_requete($sql_req)!='ok') {$vf_c_echo=-1;}
    } else {
      $vf_c_echo=-1;
      }
    break;
  case $vf_c_action=="ajouter_simple_courriel":
  case $vf_c_action=="ajouter_simple_courriel_tel_fax":
  case $vf_c_action=="ajouter_simple_courriel_tel_tel":
  case $vf_c_action=="ajouter_simple_fax":
    $vl_int_cleunik=_graal_requete_max("int_cleunik","_act_interlo");
    $sql_req = "INSERT INTO _act_interlo set int_cleunik=$vl_int_cleunik,codealphanum15='$vl_codealphanum15',act_cleunik=$vl_act_cleunik,patronyme='$vl_patronyme',blocnotebrut='$vl_blocnotebrut',prenom='$vl_prenom',dateheuremodif=now(),infodefaut=$vl_infodefaut,choix_cleunik=$vl_choix_cleunik,actif=$vl_actif";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {
      $sql_req = "insert into _act_interlo_choix_fixes set act_cleunik=$vl_act_cleunik,int_cleunik=$vl_int_cleunik,choix_cleunik=$vl_fonction,critere_cleunik=92,typeacteur=$vl_c_genreacteur,uti_cleunik=0";
      $vf_c_echo=_graal_exec_requete($sql_req);
      if ($vl_refweb!="") {
        $vl_intweb_cleunik=_graal_requete_max("intweb_cleunik","_act_interlo_mail");
        $sql_req = "INSERT INTO _act_interlo_mail set intweb_cleunik=$vl_intweb_cleunik,int_cleunik=$vl_int_cleunik,refweb='$vl_refweb',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut_courriel',veuxpasdemail=$vl_veuxpasdemail,infofavori=$vl_infofavori,utilisable=$vl_utilisable,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik_courriel,valide=$vl_valide,c_uuid=(select uuid()),cr_verification='$vl_cr_verification',dateheureverification='$vl_dateheureverification';";
        $vf_c_echo=_graal_exec_requete($sql_req);
      }
      if ($vl_telformate_tel!="") {
        $vl_intel_cleunik=_graal_requete_max("intel_cleunik","_act_interlo_tel");
        $sql_req = "INSERT INTO _act_interlo_tel set intel_cleunik=$vl_intel_cleunik,int_cleunik=$vl_int_cleunik,telformate='$vl_telformate_tel',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut_tel',intel_05='$vl_c_chaine_nette_tel',intel_06=$vl_c_chaine_nette_tel,infofavori=$vl_infofavori_tel,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik_tel,prefixe_choix_cleunik=$vl_prefixe_choix_cleunik_tel,portable=$vl_portable_tel,sms=$vl_sms_tel;";
        $vf_c_echo=_graal_exec_requete($sql_req);
      }
      if ($vl_telformate_tel_01!="") {
        $vl_intel_cleunik=_graal_requete_max("intel_cleunik","_act_interlo_tel");
        $sql_req = "INSERT INTO _act_interlo_tel set intel_cleunik=$vl_intel_cleunik,int_cleunik=$vl_int_cleunik,telformate='$vl_telformate_tel_01',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut_tel_01',intel_05='$vl_c_chaine_nette_tel_01',intel_06=$vl_c_chaine_nette_tel_01,infofavori=$vl_infofavori_tel_01,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik_tel_01,prefixe_choix_cleunik=$vl_prefixe_choix_cleunik_tel_01,portable=$vl_portable_tel_01,sms=$vl_sms_tel_01;";
        $vf_c_echo=_graal_exec_requete($sql_req);
      }

      if ($vl_telformate_fax!="") {
        $vl_intel_cleunik=_graal_requete_max("intel_cleunik","_act_interlo_fax");
        $sql_req = "INSERT INTO _act_interlo_fax set intel_cleunik=$vl_intel_cleunik,int_cleunik=$vl_int_cleunik,telformate='$vl_telformate_fax',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut_fax',intel_05='$vl_c_chaine_nette_fax',intel_06=$vl_c_chaine_nette_fax,infofavori=$vl_infofavori_fax,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik_fax,prefixe_choix_cleunik=$vl_prefixe_choix_cleunik_fax;";
        $vf_c_echo=_graal_exec_requete($sql_req);
      }
      $vf_c_echo=$vl_int_cleunik;
    } else {
      $vf_c_echo=-1;
    }
    break;
  case $vf_c_action=="modifier":
    if ($vl_int_cleunik!=0) {
      $sql_req = "UPDATE _act_interlo set codealphanum15='$vl_codealphanum15',patronyme='$vl_patronyme',blocnotebrut='$vl_blocnotebrut',prenom='$vl_prenom',dateheuremodif=now(),infodefaut=$vl_infodefaut,choix_cleunik=$vl_choix_cleunik,actif=$vl_actif WHERE _act_interlo.int_cleunik=$vl_int_cleunik";
      $vf_c_echo=_graal_exec_requete($sql_req);
      if($vf_c_echo=='ok') {
        $vf_c_echo=$vl_int_cleunik;
        $sql_req = "delete from _act_interlo_choix_fixes where act_cleunik=$vl_act_cleunik and int_cleunik=$vl_int_cleunik and critere_cleunik=92;";
        if(_graal_exec_requete($sql_req)!='ok') {$vf_c_echo=-1;}
        $sql_req = "insert into _act_interlo_choix_fixes set act_cleunik=$vl_act_cleunik,int_cleunik=$vl_int_cleunik,choix_cleunik=$vl_fonction,critere_cleunik=92,typeacteur=$vl_c_genreacteur,uti_cleunik=0";
        if(_graal_exec_requete($sql_req)!='ok') {$vf_c_echo=-1;}
      } else {
        $vf_c_echo=-1;
      }
    } else {
      $vf_c_echo=-1;
    }
    break;
  case $vf_c_action=="??????":
    die;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
