<?php
header('Content-type: text/xml; charset=utf-8');
header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); // Date in the past
require("_graal_fonctions_mysql.php");
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
/*
echo('<RDF:li>'.EOL);
echo('<RDF:Description>');
echo('<row:sql>'.fa_ent_xml($sql_req).'</row:sql>');
echo('</RDF:Description>'.EOL);
echo('</RDF:li>'.EOL);
*/
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  // parseType = indication pour le type des données, utile pour le tri sur la colonne
  echo('<row:doc_cleunik NC:parseType="Integer">'.fa_ent_xml($row['doc_cleunik']).'</row:doc_cleunik>');
  echo('<row:emplacement>'.fa_ent_xml($row['emplacement']).'</row:emplacement>');
  echo('<row:titre>'.fa_ent_xml($row['titre']).'</row:titre>');
  echo('<row:typedoc>'.fa_ent_xml($row['typedoc']).'</row:typedoc>');
  echo('<row:descriptif_sommaire>'.fa_ent_xml($row['descriptif_sommaire']).'</row:descriptif_sommaire>');
  echo('<row:origine>'.fa_ent_xml($row['origine']).'</row:origine>');
  echo('<row:portee>'.fa_ent_xml($row['portee']).'</row:portee>');
  echo('<row:rattachement>'.fa_ent_xml($row['rattachement']).'</row:rattachement>');
  echo('<row:dateheurecreation>'.fa_ent_xml($row['dateheurecreation']).'</row:dateheurecreation>');
  echo('<row:dateheuremodif>'.fa_ent_xml($row['dateheuremodif']).'</row:dateheuremodif>');
  echo('<row:dateheurecreation_brut >'.fa_ent_xml($row['dateheurecreation']).'</row:dateheurecreation_brut>');
  if (fa_ent_xml($row['ut_dateheuremodif'])!="") {
    echo('<row:dateheuremodif_brut >'.fa_ent_xml($row['dateheuremodif']).'</row:dateheuremodif_brut>');
  } else {
    echo('<row:dateheuremodif_brut >'.fa_ent_xml($row['dateheurecreation']).'</row:dateheuremodif_brut>');
  }
//  le 8 mai 2008 : typedoc -> //  1 -> Liens 2 -> Notes, 3-> Documents, 4-> Dossier, 5 -> courriels envoyés, 6 -> modèles de courriels texte,7->Flux RSS, 8 -> requêtes personnelles,9 -> images,10 -> modèles de courriels HTML, 11 -> modèles de notes,12 -> modèles de notification de lecture, 13 -> Pièces jointes de courriels
  switch ($row['typedoc']) {
    case 1  : echo('<row:properties>ah05</row:properties>');break;  //  liens
    case 2  : echo('<row:properties>ai02</row:properties>');break;  //  notes  
    case 3  : echo('<row:properties>ai03</row:properties>');break;  //  documents
    case 13  : echo('<row:properties>al14</row:properties>');break;  //  Pièces jointes
    default : echo('<row:properties></row:properties>');break;
  }
  
  switch ($vl_c_qui) {
    case "liaisons":
      switch ($row['portee']) {
        case 1: //  Entreprise
          $vl_c_infos01="Entreprise ->".fa_ent_xml($row['qui_quoi']);
          break;
        case 1024: //  article
          $vl_c_infos01="Article ->".fa_ent_xml($row['qui_quoi']);
          break;
        case 2048: //  action
          $vl_c_infos01="Action ->".fa_ent_xml($row['qui_quoi']);
          break;
        case 4096:  //interlocuteur
          $vl_c_infos01=fa_ent_xml($row['qui_quoi']);
          break;
        case 8192: //  Acteur
          $vl_c_infos01="Acteur ->".fa_ent_xml($row['qui_quoi']);
          break;
        case 32768: //  Utilisateur
          $vl_c_infos01=fa_ent_xml($row['qui_quoi']);
          break;
        default:
          $vl_c_infos01=fa_ent_xml($row['qui_quoi']);
          break;
      }
      break;
    case '555555': //toutes les actions
    case '666666': //tous les interlocuteurs
    case '777777': //GED de tous les articles sauf les images (géré dans _graal_rech_ged_02.php)
    case '999999': //tous les acteurs
    case '999998': //Entreprise
    case '888888':  //  Favoris
    case 'notfav':  //  Mes notes favorites
    case 'docfav':  //  Mes documents favoris
    case 'notmoi':
    case 'docmoi':
    case 'notnos': 
    case 'docnos':
    case 'noteux': 
    case 'doceux':
    case 'docs':
      break;
    case 'notaction':
    case 'docaction':
    case "docpj":
      $vl_c_infos01=fa_ent_xml($row['choix_valeur_texte_01']);
      if ($row['sujet']!="") {
        $vl_c_infos01.=" (".fa_ent_xml($row['sujet']).")";
      }
      if ($row['description']!="") {
        $vl_c_infos01.=" [".fa_ent_xml($row['description'])."]";
      }
      break;
    case 'notarticl':
    case 'docarticl':
      $vl_c_infos01=fa_ent_xml($row['mnemotechnique'])." (".fa_ent_xml($row['description'])."]";
      break;
    case 'notact':
    case 'notclient':
    case 'notprocli':
    case 'notfourni':
    case 'notprofou':
    case 'notautact':
    case 'notactind':
    case 'notentrep':
    case 'docact':
    case 'docclient':
    case 'docprocli':
    case 'docfourni':
    case 'docprofou':
    case 'docautact':
    case 'docactind':
    case 'docentrep':
      if ($row['raisonsoc']!=$row['nomcommercial']) {
        $vl_c_infos01=fa_ent_xml($row['choix_valeur_texte_01'])." (".fa_ent_xml($row['raisonsoc'])."[".fa_ent_xml($row['nomcommercial'])."]".")";
      } else {
        $vl_c_infos01=fa_ent_xml($row['choix_valeur_texte_01'])." (".fa_ent_xml($row['raisonsoc']).")";
      }
      break;
    case 'notinterl':
    case 'notintclient':
    case 'notintprocli':
    case 'notintfourni':
    case 'notintprofou':
    case 'notintautact':
    case 'notintactind':
    case 'docinterl':
    case 'docintclient':
    case 'docintprocli':
    case 'docintfourni':
    case 'docintprofou':
    case 'docintautact':
    case 'docintactind':
      $vl_c_infos01=fa_ent_xml($row['choix_valeur_texte_01'])."{".fa_ent_xml($row['prenom']).fa_ent_xml($row['patronyme'])."}"."(".fa_ent_xml($row['raisonsoc'])."[".fa_ent_xml($row['nomcommercial'])."]".")";
      break;
  }
  echo('<row:infos_01>'.$vl_c_infos01.'</row:infos_01>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
