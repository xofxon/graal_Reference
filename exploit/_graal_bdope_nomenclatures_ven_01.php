<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_articles_01";
fa_acces_script();
$vf_c_echo="";
$vl_art_cleunik_pere=intval(fa_recup_param("vl_art_cleunik_pere","0"));
$vl_art_cleunik_fils=intval(fa_recup_param("vl_art_cleunik_fils","0"));
$vl_noligne=intval(fa_recup_param("vl_noligne","-1"));
$vl_noligne_nouvelle=intval(fa_recup_param("vl_noligne_nouvelle","-1"));
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_quantite=fa_floatval(fa_recup_param("vl_quantite",0));
$vl_nb_decimales_qte=intval(fa_recup_param("vl_nb_decimales_qte",0));
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_valeur_complement=fa_floatval(fa_recup_param("vl_valeur_complement",0));
$vl_valeur_complement_type=intval(fa_recup_param("vl_valeur_complement_type",0));
$vl_base_valorisation=intval(fa_recup_param("vl_base_valorisation",0));
$vl_ajout_pv_pere=intval(fa_recup_param("vl_ajout_pv_pere",2));
$vl_ajout_pr_pere=intval(fa_recup_param("vl_ajout_pr_pere",2));
$vl_gestion_stock=intval(fa_recup_param("vl_gestion_stock",2));
$vl_gestion_norma=intval(fa_recup_param("vl_gestion_norma",1));
switch (TRUE){
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _nomenclatures_ventes WHERE art_cleunik_pere = $vl_art_cleunik_pere and art_cleunik_fils=$vl_art_cleunik_fils and noligne=$vl_noligne";
    break;
  case $vf_c_action=="ajouter":
    $sql_req = "INSERT INTO _nomenclatures_ventes set art_cleunik_pere=$vl_art_cleunik_pere,art_cleunik_fils=$vl_art_cleunik_fils,noligne=$vl_noligne_nouvelle,
		quantite=$vl_quantite,blocnotebrut='$vl_blocnotebrut',nb_decimales_qte=$vl_nb_decimales_qte,valeur_complement=$vl_valeur_complement,
		valeur_complement_type=$vl_valeur_complement_type,base_valorisation=$vl_base_valorisation,ajout_pv_pere=$vl_ajout_pv_pere,ajout_pr_pere=$vl_ajout_pr_pere,
		gestion_stock=$vl_gestion_stock,gestion_norma=$vl_gestion_norma;";
    break;
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE _nomenclatures_ventes set noligne=$vl_noligne_nouvelle,quantite=$vl_quantite,blocnotebrut='$vl_blocnotebrut',nb_decimales_qte=$vl_nb_decimales_qte,
		valeur_complement=$vl_valeur_complement,valeur_complement_type=$vl_valeur_complement_type,base_valorisation=$vl_base_valorisation,
		ajout_pv_pere=$vl_ajout_pv_pere,ajout_pr_pere=$vl_ajout_pr_pere,gestion_stock=$vl_gestion_stock,gestion_norma=$vl_gestion_norma";
    $sql_req.=" WHERE art_cleunik_pere = $vl_art_cleunik_pere and art_cleunik_fils=$vl_art_cleunik_fils and noligne=$vl_noligne;";
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
$vf_c_echo=_graal_exec_requete($sql_req);
if($vf_c_echo=='ok') {$vf_c_echo="";} else {$vf_c_echo="L'opération sur la nomenclature a échoué!!";}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
