<?php
	while ($row = mysql_fetch_assoc($result)) {
    $Quantité=$row['qte'];
    //  L'arrondi ne fonctionne pas dans la requête (8/7/2008)
    $Quantité=round($row['qte'],$row['qte_nbdec']);
    $Code=$row['code_interne'];
    $Désignation=$row['description_interne'];
    $pu=$row['pu'];
    $nbdec_pu=$row['nbdec_pu'];
    $pu_arrondi=fa_reel($pu,$nbdec_pu);
    $htbrutremise=$row['htbrutremise'];
    $htbrutremise_arrondi=fa_reel($htbrutremise,$nbdec_pu);
    $blocnotebrut=trim($row['blocnotebrut']);
    if ($blocnotebrut!="") {
      $Désignation.=EOL.$blocnotebrut;
    }
    $taxe=trim($row['code']);
    $tpf=trim($row['code_tpf']);
    if ($tpf=="RAF"){$tpf="";}
    if ($Quantité==0){$Code="";}

  switch ($nombre_taxes) {
    case 1:
      switch ($nb_remises_lignes) {
        case 0:
      		if ($pu_arrondi==0) {$pu_arrondi="";}
	        if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
			if ($Quantité==0) {$Quantité="";}
        	switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>$htbrutremise_arrondi);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 5]=>$tpf,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>$htbrutremise_arrondi);
          			break;
        	}
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
		  if ($Quantité==0) {$Quantité="";}
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 6]=>$remise,$ref_col[ 4]=>$htbrutremise_arrondi);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 5]=>$tpf,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 6]=>$remise,$ref_col[ 4]=>$htbrutremise_arrondi);
          			break;
        	}
          break;
      }
      break;
    default:
      switch ($nb_remises_lignes) {
        case 0:
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>$htbrutremise_arrondi,$ref_col[ 7]=>$taxe);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 5]=>$tpf,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>$htbrutremise_arrondi,$ref_col[ 7]=>$taxe);
          			break;
        	}
          
          break;
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
		  if ($Quantité==0) {$Quantité="";}
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 6]=>$remise,$ref_col[ 4]=>$htbrutremise_arrondi,$ref_col[ 7]=>$taxe);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 5]=>$tpf,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 6]=>$remise,$ref_col[ 4]=>$htbrutremise_arrondi,$ref_col[ 7]=>$taxe);
          			break;
        	}
          break;
      }
      break;
    }
    $pdf->_graal_pf_imprime_ligne($line,$y,$cols,$format,$fonts,$type,$position_pied);
  }
  /*
   * On recherche une éventuelle remise pied de document
   */
  if ($remise_pied!=0){
  	$vl_c_bvj_144=fa_recup_dico("bvj_144");
  	$remise_pied=fa_reel($remise_pied,2);
  	switch ($nombre_taxes) {
    case 1:
      switch ($nb_remises_lignes) {
        case 0:
        	switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 4]=>$remise_pied);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 5]=>"",$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 4]=>$remise_pied);
          			break;
        	}
        default:
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 6]=>"",$ref_col[ 4]=>$remise_pied);
          			break;
        		default:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 5]=>"",$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 6]=>"",$ref_col[ 4]=>$remise_pied);
          			break;
        	}
          break;
      }
      break;
    default:
      switch ($nb_remises_lignes) {
        case 0:
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 4]=>$remise_pied,$ref_col[ 7]=>"");
          			break;
        		default:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 5]=>"",$ref_col[ 2]=>"",$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>"",$ref_col[ 7]=>"");
          			break;
        	}
          
          break;
        default:
      		switch ($nombre_tpf){
        		case 0:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 6]=>"",$ref_col[ 4]=>$remise_pied,$ref_col[ 7]=>"");
          			break;
        		default:
         			$line = array($ref_col[ 0]=>"",$ref_col[ 1]=>$vl_c_bvj_144,$ref_col[ 5]=>"",$ref_col[ 2]=>"",$ref_col[ 3]=>"",$ref_col[ 6]=>"",$ref_col[ 4]=>$remise_pied,$ref_col[ 7]=>"");
          			break;
        	}
          break;
      }
      break;
    }
    $pdf->_graal_pf_imprime_ligne($line,$y,$cols,$format,$fonts,$type,$position_pied);
  }
  
?>