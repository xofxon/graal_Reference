<?php
include("_graal_header_xml.inc.php");
$vl_e_art_cleunik=intval(fa_recup_param('art_cleunik','10001770'));
$vl_c_genrecritere=fa_recup_param('genrecritere','');
switch ($vl_c_genrecritere) {
  case "entreprise":$vl_e_uti_cleunik=0;break;
  case "moi":$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));break;
}
$vl_c_operateur_01="=";
$vl_c_cleunik_metiers_viticulture="1000,1001,1002,1003,1004";
$vl_c_cleunik_particuliers="142";
$vl_c_cleunik_metiers=$vl_c_cleunik_metiers_viticulture.",".$vl_c_cleunik_particuliers;
$sql_req ="select critere_cleunik,critere_code,critere_denomination,critere_choixmultiples,critere_codechoixpertinent as critere_codechoixpertinent";
$sql_req.=" from _criteres where (critere_cleunik >9999 or critere_cleunik in ($vl_c_cleunik_metiers)) and critere_portee & 1024";
$sql_req.=" AND (critere_cleunik not in (select distinct critere_cleunik from _art_choix_fixes where art_cleunik=$vl_e_art_cleunik and uti_cleunik=$vl_e_uti_cleunik) or (critere_cleunik in (select distinct critere_cleunik from _art_choix_fixes where art_cleunik=$vl_e_art_cleunik and uti_cleunik=$vl_e_uti_cleunik) and critere_choixmultiples=1))";
$sql_req.=" AND critere_actif =1";
$sql_req.=" ORDER BY critere_denomination";
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' critere_cleunik="'.fa_ent_xml($row['critere_cleunik']).'"');
  echo(' critere_code="'.fa_ent_xml($row['critere_code']).'"');
  echo(' critere_denomination="'.fa_ent_xml($row['critere_denomination']).'"');
  echo(' critere_choixmultiples="'.fa_ent_xml($row['critere_choixmultiples']).'"');
  echo(' critere_codechoixpertinent="'.fa_ent_xml($row['critere_codechoixpertinent']).'"');
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
