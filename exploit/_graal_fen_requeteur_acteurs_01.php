<?php
include("_graal_header_xul.inc.php");
$vl_e_portee_criteres_acteurs=intval(fa_recup_param('portee','0'));
$vl_e_fausseportee_criteres_acteurs=intval(fa_recup_param('fausseportee','0'));
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_pertinencecode=1;
if ($vl_e_pertinencecode==1) {$vl_c_codecache='false';} else {$vl_c_codecache='true';} 
switch ($vl_e_fausseportee_criteres_acteurs){
  case '8192': $vl_c_id_fenetre="Fen_00393";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00232";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break;//Critères de tous les acteurs
  case '2'   : $vl_c_id_fenetre="Fen_00394";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00234";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //Prospects clients
  case '4'   : $vl_c_id_fenetre="Fen_00396";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00235";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //Clients
  case '8'   : $vl_c_id_fenetre="Fen_00395";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00236";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //Prospects fournisseurs
  case '16'  : $vl_c_id_fenetre="Fen_00397";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00237";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //fournisseurs
  case '32'  : $vl_c_id_fenetre="Fen_00398";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00238";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //Autres acteurs
  case '64'  : $vl_c_id_fenetre="Fen_00399";$vl_c_id_graal_inc_criteres_acteurs_01="Div_00239";$vl_c_id_graal_inc_choix_criteres_01="Div_00034";break; //Acteurs indéterminés
  default :
    fa_redirige("acces_interdit");
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=1;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_dico00020=fa_recup_dico("dico_00020");
$vl_c_dico00021=fa_recup_dico("dico_00021");
$vl_c_dico00022=fa_recup_dico("dico_00022");
$vl_c_dico00023=fa_recup_dico("dico_00023");
$vl_c_dico00024=fa_recup_dico("dico_00024");
$vl_c_dico00025=fa_recup_dico("dico_00025");
$vl_c_dico00066=fa_recup_dico("dico_00066");
$vl_c_dico00067=fa_recup_dico("dico_00067");
$vl_c_bdw_100=fa_recup_dico("bdw_100");
$vl_c_bdw_101=fa_recup_dico("bdw_101");
$vl_c_bdw_102=fa_recup_dico("bdw_102");
$vl_c_bdw_103=fa_recup_dico("bdw_103");
$vl_c_bdw_104=fa_recup_dico("bdw_104");
$vl_c_bdw_105=fa_recup_dico("bdw_105");
$vl_c_bdw_106=fa_recup_dico("bdw_106");
$vl_c_bdw_107=fa_recup_dico("bdw_107");
$vl_c_id_graal_inc_requetes_01="Div_00343";
include("_graal_header_winxul.inc.php");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_context_00='<popupset><popup id="pop_arb_choix_criteres_cible"><menuitem class="menuitem-iconic ad09" label="'.$vl_c_dico_00106.'" oncommand="fa_infos_colonnes_arbre_recup(\''.$vl_c_id_fenetre.'\',\'arb_choix_criteres_cible\');" /></popup></popupset>';
echo <<<END
<window context="graal_cp00" _graal_cleunik="$vl_e_cleunik_critere" title="$vl_c_bdw_100" id="_graal_critere_01" onload="fa_aa(this);pf_etat_fen('ini')" $c_xmlns >
$vl_c_graal_cp00
$vl_c_context_00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_fen_requeteur_acteurs.js.php");
include("js/_graal_06_choix_criteres.js.php");
echo <<<END
<popupset>
  <popup id="pop_choix_a_faire">
  <menuitem label="Tout déselectionner dans la table" oncommand="" />
  <menuitem label="Ajouter" oncommand="pf_choix_ajoute();" />
  </popup>
</popupset>
<popupset>
  <popup id="pop_choix_faits">
  <menuitem label="Tout déselectionner dans la table" oncommand="" />
  <menuitem label="Enlever" oncommand="pf_choix_enleve();" />
  </popup>
</popupset>
<deck id="deck_requeteur" flex="1" selectedIndex="1">
  <vbox id="bdv_requetes_01" flex="1">
END;
include("_graal_inc_requetes_01.php");
echo <<<END
    <spacer />
    <vbox >
      <hbox flex="1" id="boutons_standards" />
    </vbox>
  </vbox>
  <vbox>
    <button label="Voir la récap" oncommand="pf_voir_deck_construction_suivant(5);"/>
    <deck id="deck_construction" flex="1" selectedIndex="0">
      <vbox>
        <!--  selectedIndex="0" -->
        <label value="Etape 1/5 : choix du critère ..." />
END;
include("_graal_inc_criteres_acteurs.php");
echo <<<END
        <button label="$vl_c_dico00067" oncommand="pf_voir_deck_construction_suivant(1);"/>
      </vbox>
      
	  	<!--  selectedIndex="1" -->
        
		<vbox flex="1">
        <label value="Etape 2/5 : sélection des choix ..."/>
		<hbox flex="1">
END;
include("_graal_inc_choix_criteres_01.php");
echo <<<END
            <vbox flex="40">
                <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="ml_operande" _graal_nombre="2">
                  <menupopup>
                    <menuitem value="1" label="Dans la liste" _graal_operande="IN" selected="true"/>
                    <menuitem value="2" label="Pas dans la liste" _graal_operande="NOT IN"/>
                  </menupopup>
                </menulist>
             <tree flex="40" id="arb_choix_criteres_cible" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" context="pop_arb_choix_criteres_cible" >
               <treecols> 
                <treecol id="critere_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
                <treecol id="choix_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
                <treecol id="choix_code" hidden="$vl_c_codecache" label="$vl_c_bbb_012" sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
                <treecol id="choix_valeur_texte_01" label="$vl_c_bbb_013" sort="?choix_valeur_texte_01"/><splitter class="tree-splitter" resizeafter="grow"/>
                <treecol id="choix_valeur_texte_02" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
                <treecol id="choix_actif" label="$vl_c_bbb_015"   sort="?choix_actif"/><splitter class="tree-splitter" resizeafter="grow"/>
               </treecols>
               <template><query expr="*"/><action>
                 <treechildren >
                   <treeitem uri="?" seltype="single">
                     <treerow >
                       <treecell label="?critere_cleunik"/>
                       <treecell label="?choix_cleunik"/>
                       <treecell label="?choix_code"/>
                       <treecell label="?choix_valeur_texte_01"/>
                       <treecell label="?choix_valeur_texte_02"/>
                       <treecell label="?choix_actif"/>
                     </treerow>
                   </treeitem>
                 </treechildren>
               </action></template>
             </tree>
             </vbox>
        </hbox>  
        <hbox flex="0">
          <button flex="1" label="$vl_c_dico00066" oncommand="pf_voir_deck_construction_precedent(0);"/>
          <button flex="1" label="$vl_c_dico00067" oncommand="pf_voir_deck_construction_suivant(2);"/>
        </hbox>
	</vbox>	
      <vbox>
        <label value="Etape 4/5 : Validation de l'étape ..."/>
        <hbox flex="0">
          <button flex="1" label="$vl_c_dico00066" oncommand="pf_voir_deck_construction_precedent(1);"/>
          <button flex="1" label="$vl_c_dico00067" oncommand="pf_voir_deck_construction_suivant(3);"/>
        </hbox>
      </vbox>
      <vbox>
        <label value="Etape 5/5 : Validation de la requête ..."/>
        <hbox flex="0">
          <button flex="1" label="$vl_c_dico00066" oncommand="pf_voir_deck_construction_precedent(2);"/>
        </hbox>
      </vbox>

    </deck>
  </vbox>
</deck>
 </window>
END;
?>
