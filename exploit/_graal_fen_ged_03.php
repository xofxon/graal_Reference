<?php
include("_graal_header_xul.inc.php");
$vl_c_genreaction=fa_recup_param('genreaction','aucun');
$vl_c_genreged="tousss";
$vl_c_quelsdocs="docs";
switch ($vl_c_genreaction) {
  case "droits":$vl_c_id_fenetre="Fen_00965";$vl_c_id_ged_selection="Div_00364";$id_inc_ged="Div_00363";break;
  case "blancs":$vl_c_id_fenetre="Fen_00966";$vl_c_id_ged_selection="Div_00364";$id_inc_ged="Div_00363";break;
  case "noires":$vl_c_id_fenetre="Fen_00967";$vl_c_id_ged_selection="Div_00364";$id_inc_ged="Div_00363";break;
	default:    
		fa_redirige("acces_interdit");
		break;
}
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_brk_100=fa_recup_dico("brk_100");
$vl_c_brk_101=fa_recup_dico("brk_101");
$vl_c_brk_102=fa_recup_dico("brk_102");
$vl_c_brk_103=fa_recup_dico("brk_103");
$vl_c_brk_104=fa_recup_dico("brk_104");
$vl_c_brk_105=fa_recup_dico("brk_105");
$vl_c_brk_106=fa_recup_dico("brk_106");
$vl_c_brk_107=fa_recup_dico("brk_107");
$vl_c_brk_108=fa_recup_dico("brk_108");
$vl_c_brk_109=fa_recup_dico("brk_109");
$vl_c_brk_110=fa_recup_dico("brk_110");
$vl_c_brk_111=fa_recup_dico("brk_111");
$vl_c_brk_112=fa_recup_dico("brk_112");
$vl_c_brk_113=fa_recup_dico("brk_113");
$vl_c_brk_114=fa_recup_dico("brk_114");
$vl_c_brk_115=fa_recup_dico("brk_115");
$vl_c_dico_00002=fa_recup_dico("dico_00002");
$vl_c_dico_00004=fa_recup_dico("dico_00004");
$menu_partage="";
$vl_menulist_utilisateurs='<menulist sizetopopup="none" crop="end" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" class="menuitem-iconic" flex="1" id="brk_ml_utilisateurs" oncommand="pf_approximatif();">';
$vl_menulist_utilisateurs.='<menupopup>';
$vl_nb_utilisateurs=0;
$sql_req = "SELECT uti_cleunik,CONCAT_WS(' ',_utilisateur.prenom,_utilisateur.patronyme) AS nomcomplet,param_environ as param_environ from _utilisateur where actif=1;";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
	if (is_null($row['param_environ'])==false) {
		$vl_c_xml=simplexml_load_string($row['param_environ']);
		if (isset($vl_c_xml->gesdoc_ml_zone)){$gesdoc_ml_zone=$vl_c_xml->gesdoc_ml_zone->attributes();}else{$gesdoc_ml_zone='1';}
	}
	$vl_ok=false;
	switch ($vl_c_genreaction) {
	  case "droits":if($gesdoc_ml_zone==2){$vl_ok=true;};break;
	  case "blancs":if($gesdoc_ml_zone==4){$vl_ok=true;};break;
	  case "noires":if($gesdoc_ml_zone==3){$vl_ok=true;};break;
		default:$vl_ok=false;break;
	}
	if ($vl_ok==true){
		$vl_nb_utilisateurs++;
		$vl_menulist_utilisateurs.="<menuitem crop='none' value='" .fa_remplace_quotes(fa_ent_xml($row['uti_cleunik'])). "' label='".fa_remplace_quotes(fa_ent_xml($row['nomcomplet']))."' />";		
	}
}
if ($vl_nb_utilisateurs==0){
	$vl_menulist_utilisateurs.="<menuitem crop='none' value='-1' label='$vl_c_brk_105' />";		
}
_graal_libere_requete_bd($result);
$vl_menulist_utilisateurs.='</menupopup>';
$vl_menulist_utilisateurs.='</menulist>';	
if ($vl_nb_utilisateurs!=0){
$vl_menulist_utilisateurs.=<<<EOT
<menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="brk_ml_action" oncommand="pf_approximatif();">
      <menupopup>
        <menuitem label="$vl_c_brk_102" value="1" oncommand="fa_gid('blocs_validation').selectedIndex=0;"/> <!--  Ajouter-->
        <menuitem label="$vl_c_brk_104" value="2" oncommand="fa_gid('blocs_validation').selectedIndex=1;"/> <!--  Supprimer-->
      </menupopup>
    </menulist>
EOT;
}

$menu_ouvre='<menuitem label="'.$vl_c_brk_101.'" oncommand="pf07_ouvre_ged();"/>';
$bloc_validation_suppression=<<<EOT
		<vbox >
		 <button width="40" flex="1" id="bt_supprimer" label="$vl_c_dico_00004" crop="end" dir="normal" oncommand="pf_validation('supprimer_droits_kilometres')" />
    </vbox>
EOT;
switch ($vl_c_genreaction) {
  case "droits":
$bloc_validation_ajout=<<<EOT
		<vbox >
      <groupbox flex="1">
      <caption><label value="$vl_c_bat_114" /></caption>
      <vbox flex="1">
        <description  id="des_02" />
        <checkbox id="ch_m01" label="$vl_c_brk_108" accesskey="r" />
        <checkbox id="ch_m02" label="$vl_c_brk_109" accesskey="e" />
        <checkbox id="ch_m03" label="$vl_c_brk_110" accesskey="o" />
        <checkbox id="ch_m04" label="$vl_c_brk_111" accesskey="u" />
        <checkbox id="ch_m05" label="$vl_c_brk_112" accesskey="p" disabled="true"/>
      </vbox> 
     </groupbox>
		 <button width="40" flex="1" id="bt_ajouter" label="$vl_c_dico_00002" crop="end" dir="normal" oncommand="pf_validation('ajouter_droits_kilometres')" />
    </vbox>
EOT;
	break;
  case "blancs":
$bloc_validation_ajout=<<<EOT
		<vbox >
		 <button width="40" flex="1" id="bt_ajouter" label="$vl_c_dico_00002" crop="end" dir="normal" oncommand="pf_validation('ajouter_droits_kilometres')" />
    </vbox>
EOT;
	break;
  case "noires":
$bloc_validation_ajout=<<<EOT
		<vbox >
		 <button width="40" flex="1" id="bt_ajouter" label="$vl_c_dico_00002" crop="end" dir="normal" oncommand="pf_validation('ajouter_droits_kilometres')" />
    </vbox>
EOT;
	break;
	default:
	
	break;
}
if ($vl_nb_utilisateurs==0){
	$bloc_validation_ajout="";
	$bloc_validation_suppression="";
}
include("_graal_header_winxul.inc.php");
$vl_tc_composants=array($vl_c_id_ged_selection,$id_inc_ged);
echo <<<END
<window title="$vl_c_brk_100" context="graal_cp00" id="$vl_c_id_fenetre" onload="fa_aa(this);pf_aa_init();" onunload="pf_aa_ferme();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_ged_03.js.php");
include("_graal_inc_ged_selection_01.php");
$vl_c_voir_doc="non";
include("_graal_inc_ged_01.php");
echo <<<END
<deck id="blocs_validation" selectedIndex="0">
$bloc_validation_ajout
$bloc_validation_suppression
</deck>
END;
echo("<hbox>");
echo("<button flex='1' tooltiptext ='$vl_c_brk_103' id='bt_sortir' label='$vl_c_brk_103' crop='end' dir='normal' oncommand='vf_c_renvoyer=false;window.close();' />");
echo("</hbox>");
echo("</window>");
?>
