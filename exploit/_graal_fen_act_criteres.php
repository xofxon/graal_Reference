<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_nomcomplet=fa_recup_session('vs_nomcomplet','tesquiconnard?');
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_e_act_cleunik=intval(fa_recup_param("vl_e_act_cleunik","-1"));
$vl_c_raisonsoc=fa_ent_xml(fa_recup_param("vl_c_raisonsoc",'Société inconnue !!!!'));
$vl_c_nomcommercial=fa_ent_xml(fa_recup_param("vl_c_nomcommercial",'Nom commercial inconnu !!!!'));
$vl_c_genrecritere=fa_recup_param('genrecritere','0');
$vl_c_codecache="false";
$vl_c_cache_texte2="false";
switch ($vl_c_genreacteur) {
  case "110001": $vl_c_id_fen_criteres="Fen_00260";$vl_c_id_fen_choix="Fen_00267";$vl_e_portee=2;break;  //  prospects clients
  case "110002": $vl_c_id_fen_criteres="Fen_00261";$vl_c_id_fen_choix="Fen_00268";$vl_e_portee=8;break;  //  prospects fournisseurs
  case "110003": $vl_c_id_fen_criteres="Fen_00262";$vl_c_id_fen_choix="Fen_00269";$vl_e_portee=4;break;  //  clients
  case "110004": $vl_c_id_fen_criteres="Fen_00263";$vl_c_id_fen_choix="Fen_00270";$vl_e_portee=16;break;  //  fournisseurs
  case "110005": $vl_c_id_fen_criteres="Fen_00264";$vl_c_id_fen_choix="Fen_00271";$vl_e_portee=32;break;  //  autres acteurs
  case "110006": $vl_c_id_fen_criteres="Fen_00265";$vl_c_id_fen_choix="Fen_00272";$vl_e_portee=64;break;  //  acteurs indéterminés
}
switch ($vl_c_genrecritere) {
  case "entreprise":
    switch ($vl_c_genreacteur) {
      case "110001": $vl_c_id_fenetre="Fen_00293";break;  //  prospects clients
      case "110002": $vl_c_id_fenetre="Fen_00294";break;  //  prospects fournisseurs
      case "110003": $vl_c_id_fenetre="Fen_00295";break;  //  clients
      case "110004": $vl_c_id_fenetre="Fen_00296";break;  //  fournisseurs
      case "110005": $vl_c_id_fenetre="Fen_00297";break;  //  autres acteurs
      case "110006": $vl_c_id_fenetre="Fen_00298";break;  //  acteurs indéterminés
    }
    break;
  case "moi":
    switch ($vl_c_genreacteur) {
      case "110001": $vl_c_id_fenetre="Fen_00299";break;  //  prospects clients
      case "110002": $vl_c_id_fenetre="Fen_00300";break;  //  prospects fournisseurs
      case "110003": $vl_c_id_fenetre="Fen_00301";break;  //  clients
      case "110004": $vl_c_id_fenetre="Fen_00302";break;  //  fournisseurs
      case "110005": $vl_c_id_fenetre="Fen_00303";break;  //  autres acteurs
      case "110006": $vl_c_id_fenetre="Fen_00304";break;  //  acteurs indéterminés
    }
    break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=1;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bci_101=fa_recup_dico("bci_101");
$vl_c_bci_102=fa_recup_dico("bci_102");
$vl_c_bci_103=fa_recup_dico("bci_103");
$vl_c_bci_104=fa_recup_dico("bci_104");
$vl_c_bci_105=fa_recup_dico("bci_105");
$vl_c_bci_106=fa_recup_dico("bci_106");
$vl_c_bci_107=fa_recup_dico("bci_107");
$vl_c_bci_108=fa_recup_dico("bci_108");
$vl_c_bci_109=fa_recup_dico("bci_109");
$vl_c_bci_110=fa_recup_dico("bci_110");
$vl_c_bci_111=fa_recup_dico("bci_111");
$vl_c_bci_112=fa_recup_dico("bci_112");
$vl_c_bci_113=fa_recup_dico("bci_113");
$vl_c_bci_114=fa_recup_dico("bci_114");
$vl_c_bci_115=fa_recup_dico("bci_115");
$vl_c_bci_116=fa_recup_dico("bci_116");
$vl_c_dico_00004=fa_recup_dico("dico_00004");
$vl_c_dico_00005=fa_recup_dico("dico_00005");
$vl_c_dico_00007=fa_recup_dico("dico_00007");
$vl_c_mes_00007=fa_recup_dico("mess_00007");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_dico_00149=fa_recup_dico('dico_00149');
$vl_tb_droits_choix=_graal_requete_droits_fenetre($vl_c_id_fen_choix,$vl_e_uti_cleunik); //ajout dans les choix des critères de la GED 
if ($vl_tb_droits_choix[1]==true){$vl_c_choix_menu='<menuitem label="'.$vl_c_bci_110.'" oncommand="pf_nouveaux_choix()"/>';} else {$vl_c_choix_menu='';}
$vl_tb_droits_criteres=_graal_requete_droits_fenetre($vl_c_id_fen_criteres,$vl_e_uti_cleunik); //ajout dans les critères de la GED 
if ($vl_tb_droits_criteres[1]==true){$vl_c_critere_menu='<menuitem label="'.$vl_c_bci_111.'" oncommand="pf_nouveaux_criteres()"/>';} else {$vl_c_critere_menu='';}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bci_101" id="_win_fen_act_criteres_01" onload="fa_aa(this);pf_aa_init()" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("_graal_inc_keyset_01.php");
include_once("js/_graal_01.js.php");
include("js/_graal_acteurs_criteres_01.js.php");
echo <<<END
<popupset>
  <popup id="graal_acces_choix">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_choix_criteres');" />
    $vl_c_choix_menu
  </popup>
  <popup id="graal_acces_critere">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arb_criteres');" />
    $vl_c_critere_menu
  </popup>
  <popup id="graal_criteres_retenus">
    <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','criteres_des_acteurs');" />
  </popup>
</popupset>
<description>$vl_c_raisonsoc</description>
<hbox id="bci_acteurs_02" flex="10">
   <vbox>
    <hbox>
END;
$genre="acteur";
include("_graal_inc_menulist_critere_particuliers.php");        
echo <<<END
</hbox>
   <tree flex="40" id="arb_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onclick="pf_sel_arbre_criteres();" seltype="single" context="graal_acces_critere">
     <treecols> 
      <treecol id="critere_cleunik" hidden="true" ignoreincolumnpicker="true" />
      <treecol id="critere_choixmultiples" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_code"  label="$vl_c_bci_102" sort="?critere_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_denomination"  label="$vl_c_bci_103"  sort="?critere_denomination" sortActive="true" sortDirection="ascending"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_codechoixpertinent" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template><query expr="*"/>
				<action>
       <treechildren >
         <treeitem uri="?" seltype="single">
           <treerow >
             <treecell label="?critere_cleunik"/>
             <treecell label="?critere_choixmultiples"/>
             <treecell label="?critere_code"/>
             <treecell label="?critere_denomination"/>
             <treecell label="?critere_codechoixpertinent"/>
           </treerow>
         </treeitem>
       </treechildren>
			 </action>
     </template>
   </tree>
  </vbox>
  <splitter/>
  <vbox flex="1">
  
  <hbox flex="1">
  <groupbox flex="1">
    <caption><label value="$vl_c_bci_113" /></caption>
    <radiogroup id="rdg_position" onclick="pf_affiche_choix_criteres_potentiel_acteur();" flex="1" value="2">
       <hbox flex="1">
       <radio label="$vl_c_bci_114" value="1" /><spacer flex="1"/>
       <radio label="$vl_c_bci_115" value="2" selected="true"/><spacer flex="1"/>
       <radio label="$vl_c_bci_116" value="3" />
       </hbox>
     </radiogroup>
  </groupbox>
  </hbox>

   <tree flex="40" id="arb_choix_criteres" enableColumnDrag="true" flags="" ref="*" querytype="xml" datasources="" onclick="pf_sel_arbre_choix();" seltype="single" context="graal_acces_choix">
     <treecols> 
      <treecol id="choix_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_code" hidden="$vl_c_codecache" ignoreincolumnpicker="$vl_c_codecache"  label="$vl_c_bci_104"  sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_valeur_texte_01"  label="$vl_c_bci_105" sort="?choix_valeur_texte_01" sortActive="true" sortDirection="ascending"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="nombre_entreprise"  label="$vl_c_bci_112" class="droite" sort="?nombre"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template>
		 <query expr="*"/>
			<action>
       <treechildren >
         <treeitem uri="?" seltype="single">
           <treerow >
             <treecell label="?choix_cleunik"/>
             <treecell label="?choix_code"/>
             <treecell label="?choix_valeur_texte_01"/>
             <treecell label="?nombre"/>
           </treerow>
         </treeitem>
       </treechildren>
			 </action>
     </template>
   </tree>
   <button width="40" flex="1" id="bt_enregistrer" tooltiptext="$vl_c_dico_00005 Ctrl+Shift+F5" label="$vl_c_dico_00005" keycode="k-enregistrer" crop="end" dir="normal" oncommand="pf_validation('enregistrer')" />
   </vbox>
</hbox>
<splitter/>
<hbox flex="7">
<keyset id="_graal_ks_02">
    <key id="k-recherche" modifiers="alt" keycode="VK_F3" oncommand="pf_affiche_criteres_acteur();"/>
	</keyset>
  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_mes_00007" oncommand="pf_affiche_criteres_acteur();"/>
   <tree id="criteres_des_acteurs" enableColumnDrag="true" flex="40" flags="" ref="*" querytype="xml" datasources="" seltype="multiple" onclick="pf_sel_arbre_criteres_acteur();" context="graal_criteres_retenus">
     <treecols>
       <treecol id="act_cleunik" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
       <treecol id="choix_cleunik_fixe" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
       <treecol id="critere_cleunik_fixe" hidden="true" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="critere_denomination_entreprise"  label="$vl_c_bci_108" sort="?critere_denomination"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_code_entreprise"  label="$vl_c_bci_106" sort="?choix_code"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="choix_valeur_texte_01_entreprise"  label="$vl_c_bci_107" sort="?choix_valeur_texte_01"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template>
		 	<query expr="*"/>
			<action>
       <treechildren>
         <treeitem uri="?" seltype="single">
           <treerow>
             <treecell label="?act_cleunik"/>
             <treecell label="?choix_cleunik"/>
             <treecell label="?critere_cleunik"/>
             <treecell label="?critere_denomination"/>
             <treecell label="?choix_code"/>
             <treecell label="?choix_valeur_texte_01"/>
           </treerow>
         </treeitem>
       </treechildren>
			 </action>
     </template>
   </tree>
   <vbox>
     <button tooltiptext ="$vl_c_dico_00004 Ctrl+Shift+F4" keycode="k-supprimer" flex="1" id="bt_supprimer" label="$vl_c_dico_00004" crop="end" dir="normal" oncommand="pf_validation('supprimer')" />
     <button tooltiptext ="$vl_c_dico_00007 Alt+F4" keycode="k-sortir" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
	 <button id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_win_id')" />
   </vbox> 
</hbox>
</window>
END;
?>
