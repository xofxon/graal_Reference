<?php
_graal_requete_charge_varlib($vl_c_id_inc_acteurs_relations,$vl_e_uti_cleunik);
$vl_c_bbl_001=fa_recup_dico("bbl_001");
$vl_c_bbl_002=fa_recup_dico("bbl_002");
$vl_c_bbl_003=fa_recup_dico("bbl_003");
$vl_c_bbl_004=fa_recup_dico("bbl_004");
$vl_c_bbl_019=fa_recup_dico("bbl_019");
$vl_c_bbl_020=fa_recup_dico("bbl_020");
$vl_c_bbl_021=fa_recup_dico("bbl_021");
$vl_c_bbl_022=fa_recup_dico("bbl_022");
switch ($vl_c_id_inc_acteurs_relations){
  case "Div_00197": $vl_c_id_fen_relation="000000000";$vl_c_id_fen_rempla="000000000";break;  //  Tous les acteurs On considère dans ce cas qu'il n'y a pas de test de gestion des droits
  case "Div_00198": $vl_c_id_fen_relation="000000000";$vl_c_id_fen_rempla="000000000";break;  //  Acteurs favoris On considère dans ce cas qu'il n'y a pas de test de gestion des droits
  case "Div_00199": $vl_c_id_fen_relation="Fen_00210";$vl_c_id_fen_rempla="Fen_00340";break;  //  prospects clients
  case "Div_00200": $vl_c_id_fen_relation="Fen_00211";$vl_c_id_fen_rempla="Fen_00341";break;  //  prospects fournisseurs
  case "Div_00201": $vl_c_id_fen_relation="Fen_00212";$vl_c_id_fen_rempla="Fen_00342";break;  //  clients
  case "Div_00202": $vl_c_id_fen_relation="Fen_00213";$vl_c_id_fen_rempla="Fen_00342";break;  //  fournisseurs
  case "Div_00203": $vl_c_id_fen_relation="Fen_00214";$vl_c_id_fen_rempla="Fen_00344";break;  //  autres acteurs
  case "Div_00204": $vl_c_id_fen_relation="Fen_00215";$vl_c_id_fen_rempla="Fen_00345";break;  //  acteurs indéterminés
  default:
    fa_redirige("acces_interdit");  
}
echo <<<END
<vbox id="bbl_acteurs_relations_01" flex="3">
END;
if ($vl_c_barre_presente_acteurs_relations=='ok')
{
echo <<<END
      <toolbar grippyhidden="true">
  		  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_bbl_019" oncommand="pf_affiche_donnees_relations();"/>
        <toolbarseparator />
        <hbox id="bloc_relations">
END;
if ($vl_c_id_fen_relation=="0000000") {$vl_tb_droits[0]=1;$vl_tb_droits[1]=1;} else {$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fen_relation,$vl_e_uti_cleunik);}
if ($vl_tb_droits[0]!=0)
{
if ($vl_tb_droits[1]!=0)
{
echo <<<END
          <toolbarbutton class="aa01" observes="broadcaster_01" id="tb_relation_01" tooltiptext="$vl_c_bbl_020" oncommand="pf_ouvre('relation','nouveau');"/>
          <toolbarbutton class="xx01" observes="broadcaster_01" id="tb_relation_04" tooltiptext="Ajouter un transporteur" oncommand="pf_ouvre('relation','nouveau_transporteur');"/>
END;
}
echo <<<END
          <toolbarbutton class="aa01" observes="broadcaster_01" id="tb_relation_02" tooltiptext="$vl_c_bbl_021" oncommand="pf_ouvre('relation','ouvrir');" />
END;
if ($vl_c_id_fen_rempla=="0000000") {$vl_tb_droits[0]=1;} else {$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fen_rempla,$vl_e_uti_cleunik);}
$vl_tb_droits[0]=0;
if ($vl_tb_droits[0]!=0)
{
echo <<<END
          <toolbarbutton class="aa01" observes="broadcaster_01" id="tb_relation_03" tooltiptext="$vl_c_bbl_022" oncommand="pf_ouvre('relation','remplacement');" />
END;
}
}
echo <<<END
        </hbox>
        <toolbarseparator />
      </toolbar>
END;
}
echo <<<END
  <tree id="arbre_relations" flex="1" flags="" ref="*" querytype="xml" datasources="" onselect="pf_sel_arbre_relations();" seltype="single">
      <treecols>
        <treecol hidden="true" id="tc_act_cleunik_gauche" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" id="tc_choix_cleunik_gauche" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" id="tc_choix_cleunik_droite" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" id="tc_act_cleunik_droite" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_qui_gauche_00" label="$vl_c_bbl_002" sort="?qui_gauche_00" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_choix_01_gauche" label="$vl_c_bbl_003" sort="?choix_01_gauche" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_qui_droite" label="$vl_c_bbl_002" sort="?qui_droite" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_choix_01_droite" label="$vl_c_bbl_003" sort="?choix_01_droite" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_qui_gauche_01" label="$vl_c_bbl_002" sort="?qui_gauche_01" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol id="tc_blocnotebrut" label="$vl_c_bbl_001" sort="?blocnotebrut" /><splitter class="tree-splitter" resizeafter="grow"/>
        <treecol hidden="true" id="tc_blocnoteriche" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
      </treecols>
      <template><query expr="*"/><action>
        <treechildren>
          <treeitem uri="?" seltype="single">
            <treerow>
              <treecell label="?act_cleunik_gauche"/>
              <treecell label="?choix_cleunik_gauche"/>
              <treecell label="?choix_cleunik_droite"/>
              <treecell label="?act_cleunik_droite"/>
              <treecell label="?qui_gauche_00"/>
              <treecell label="?choix_01_gauche"/>
              <treecell label="?qui_droite"/>
              <treecell label="?choix_01_droite"/>
              <treecell label="?qui_gauche_01"/>
              <treecell label="?blocnotebrut"/>
              <treecell label="?blocnoteriche"/>
            </treerow>
          </treeitem>
        </treechildren></action></template>
    </tree>
  </vbox>
END;
?>
