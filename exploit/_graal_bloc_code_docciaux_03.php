<?php
  //  Recherche informations entête
  
  $sql_req_00="SELECT action_cleunik,code as code,"._graalsql_date('a1.dateheureexpedition')." as dateexp,a2.nomcommercial as nom_commercial,";
  switch ($vl_c_fic_entete){
		case "_faccli_entetes":
			$sql_req_00.=_graalsql_date('a1.date_fact')." as datecre,";
			break;
		default:
			$sql_req_00.=_graalsql_date('a1.dateheurecreation')." as datecre,";
			break;
	}
  $sql_req_00.=" a2.codealphanum15,a3.description,"._graalsql_date('a1.dateheurelivraison')." as dateliv,reference_acteur,a1.blocnotebrut_entete,a1.blocnotebrut_pied,a1.acompte_type,";
  $sql_req_00.=" a1.acompte_taux,a2.raisonsoc as raisonsoc,a2.typeacteur,ifnull(a4.tvaintracommunautaire,'') as tvaintracommunautaire";
  $sql_req_00.=" from $vl_c_fic_entete a1 left join _acteurs a2 using(act_cleunik) left join _modereg a3 using(reg_cleunik) ";
  $sql_req_00.=" left join _act_compta a4 using(act_cleunik)";
  $sql_req_00.=" where commercial_cleunik=$vl_commercial_cleunik";
  $result_00=_graal_requete_bd($sql_req_00);
  $row_00 = mysql_fetch_assoc($result_00);
  $nom_commercial=$row_00['nom_commercial'];
	$raisonsoc=$row_00['raisonsoc'];
  $code=$row_00['code'];
  $dateexp=$row_00['dateexp'];
  $dateliv=$row_00['dateliv'];
  $action_cleunik=$row_00['action_cleunik'];
  $datecre=$row_00['datecre'];
	switch ($row_00['typeacteur']) {
		case "110001":$typeacteur="Prospect";break;	//	procli
		case "110002":$typeacteur="Prospect";break;	//	profou
		case "110003":$typeacteur="Client";break;
		case "110004":$typeacteur="Fournisseur";break;
		case "110005":$typeacteur="Autre !!";break;
		case "110006":$typeacteur="Indéterminé !!!";break;
	}
  $codealphanum15=$typeacteur." ".$row_00['codealphanum15'];
  $codealphnaum15_seul=$row_00['codealphanum15'];
  $description_reg=$row_00['description'];
  $vosreferences=$row_00['reference_acteur'];
  $blocnotebrut_entete=$row_00['blocnotebrut_entete'];
  $blocnotebrut_pied=$row_00['blocnotebrut_pied'];
  $tvaintracommunautaire=$row_00['tvaintracommunautaire'];
	$acompte_type=$row_00['acompte_type'];
	$acompte_taux=$row_00['acompte_taux'];
  _graal_libere_requete_bd($result_00);
  //  Recherche du nombre de remises de lignes pour déterminer l'affichage ou non de la colonne  
  $sql_req_01="SELECT count(*) as nb_remises_lignes from $vl_c_fic_ligne where remise_genr and remise_taux<>0 and commercial_cleunik=$vl_commercial_cleunik;";
  $result_01=_graal_requete_bd($sql_req_01);
  $row_01 = mysql_fetch_assoc($result_01);
  $nb_remises_lignes=$row_01['nb_remises_lignes'];
  _graal_libere_requete_bd($result_01);
  //  Recherche du nombre de taux de taxes différents pour déterminer l'affichage ou non de la colonne  
  $sql_req_01="select distinct(taxes_cleunik) from $vl_c_fic_ligne where commercial_cleunik=$vl_commercial_cleunik group by taxes_cleunik;";
  $result_01=_graal_requete_bd($sql_req_01);
  $nombre_taxes=mysql_num_rows($result_01);
  _graal_libere_requete_bd($result_01);
  //  Recherche du nombre de taxes parafiscales pour déterminer l'affichage ou non de la colonne  
  $sql_req_01="select distinct(tpf_cleunik) from $vl_c_fic_ligne where commercial_cleunik=$vl_commercial_cleunik and tpf_cleunik<> -1 group by taxes_cleunik;";
  $result_01=_graal_requete_bd($sql_req_01);
  $nombre_tpf=mysql_num_rows($result_01);
  _graal_libere_requete_bd($result_01);
  
  //  Recherche du nombre de 2°taxes parafiscales pour déterminer l'affichage ou non de la colonne  
  $sql_req_01="select distinct(tpf_cleunik_01) from $vl_c_fic_ligne where commercial_cleunik=$vl_commercial_cleunik and tpf_cleunik_01<> -1 group by taxes_cleunik;";
  $result_01=_graal_requete_bd($sql_req_01);
  $nombre_tpf+=mysql_num_rows($result_01);
  _graal_libere_requete_bd($result_01);
  
  $sql_req_echeance="SELECT "._graalsql_date('a1.date_echeance')." as date_echeance from _echeancier a1 where action_cleunik=$action_cleunik";
  if ($sql_req_echeance!=""){
  		$result_01=_graal_requete_bd($sql_req_echeance);
  		$row_01 = mysql_fetch_assoc($result_01);
  		$date_echeance=$row_01['date_echeance'];
  		_graal_libere_requete_bd($result_01);
  }
  
?>
