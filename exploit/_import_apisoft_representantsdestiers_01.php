<?php
include("_graal_header_txt.inc.php");
include("_import_class_data_km.php");
/* Valable pour descriptifs APISoft Version ??????????? */ 
define('EOL', "\r\n");
set_time_limit(6000);
$vl_c_base_origine=fa_recup_param('vl_c_base_origine','apisoft_bar_gc');
$vl_c_base_destination=fa_recup_param('vl_c_base_destination','graal_bar_02');
$vl_c_fic_tiers=fa_recup_param('vl_c_fic_tiers','client');
$vl_e_genre_acteur_defaut=intval(fa_recup_param('vl_e_genre_acteur_defaut','-5'));
include("_import_apisoft_sp_array_representants.php");
switch ($vl_c_fic_tiers){
  case "client"   :
    $vf_e_typeacteur=110003;
    break;
  case "tiers" :  //  Prospects
    $vf_e_typeacteur=110001;
    break;
}
include("_import_apisoft_sp_array_tiers.php");
/*
echo "-----------".EOL;
echo "nombre de clients".count($acteur_code);
echo $acteur_code.EOL;
echo "-----------".EOL;
*/
switch ($vl_c_fic_tiers){
  case "client"   :
    $sql_req = "SELECT Code as 'Code',Representant as 'Representant' FROM $vl_c_base_origine.$vl_c_fic_tiers where Representant <> '' order by Code";
    break;
  case "tiers" :  //  Prospects
    $sql_req = "SELECT Code as `Code`,Representant as `Representant` FROM $vl_c_base_origine.$vl_c_fic_tiers where Representant <> '' order by Code";
    break;
}
$o_rep=new _graal_import();
$o_rep->req="INSERT INTO $vl_c_base_destination._acteurs_representants (act_cleunik_gauche,choix_cleunik_gauche,choix_cleunik_droite,act_cleunik_droite) VALUES ";
$i=0;$i1=500;
$result = _graal_requete_bd($sql_req);
//echo $sql_req;
while ($row = mysql_fetch_assoc($result)) {
  //echo $row['Code']."-".$row['Representant'].EOL;
  $vl_e_trouve_acteur=array_search($row['Code'], $acteur_cod);
  if ($vl_e_trouve_acteur===false) {} else {
    $vf_e_act_cleunik=$acteur_cle[$vl_e_trouve_acteur];
    $vl_e_trouve_rep=array_search($row['Representant'], $rep_cod);
    if ($vl_e_trouve_rep===false) {} else {
      $act_cleunik_droite=$rep_cle[$vl_e_trouve_rep];
      $o_rep->dat.="($vf_e_act_cleunik,-28,-27,$act_cleunik_droite),";
      $i++;
    }
  }
  if ($i % $i1==0){
    $o_rep->execute();
  }
}
$o_rep->execute();
_graal_ferme_connexion();
echo("$i liaisons acteur/représentants créées.");
?>
