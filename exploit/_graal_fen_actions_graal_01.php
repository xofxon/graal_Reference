<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_genreacteur=fa_recup_param('genreacteur','tousss');
$vl_e_action_cleunik=intval(fa_recup_param('vl_e_action_cleunik','0'));
$vl_e_int_cleunik=intval(fa_recup_param('vl_e_int_cleunik','0'));
$vl_c_id_fenetre="Fen_00437";
switch ($vl_c_genreacteur) {
  case "moimoi":  //  Moi
  case "luilui":  //  Un interlocuteur déjà sélectionné
  case "offcli":  //  Interlocuteur privilégié d'une offre client
  case "cdecli":  //  Interlocuteur privilégié d'une commande client
  case "livcli":  //  Interlocuteur privilégié d'une livrisaon client
  case "faccli":  //  Interlocuteur privilégié d'une facture client
  case "demfou":  //  Interlocuteur privilégié d'une demande fournisseur
  case "cdefou":  //  Interlocuteur privilégié d'une commande fournisseur
  case "recfou":  //  Interlocuteur privilégié d'une réception fournisseur
  case "facfou":  //  Interlocuteur privilégié d'une facture fournisseur
  case "relfou":  //  Interlocuteur privilégié d'une relance fournisseur
    $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";break;  //  interlocuteurs de Tous les acteurs
    break;
  case "favori": $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";break;  //  interlocuteurs favoris
  case "tousss": $vl_c_id_inc_interlocuteurs_01="Div_00326";$vl_c_id_inc_interlocuteurs_selection_01="Div_00333";break;  //  interlocuteurs de Tous les acteurs
  case "110001": $vl_c_id_inc_interlocuteurs_01="Div_00327";$vl_c_id_inc_interlocuteurs_selection_01="Div_00334";break;  //  interlocuteurs de prospects clients
  case "110002": $vl_c_id_inc_interlocuteurs_01="Div_00328";$vl_c_id_inc_interlocuteurs_selection_01="Div_00335";break;  //  interlocuteurs de prospects fournisseurs
  case "110003": $vl_c_id_inc_interlocuteurs_01="Div_00329";$vl_c_id_inc_interlocuteurs_selection_01="Div_00336";break;  //  interlocuteurs de clients
  case "110004": $vl_c_id_inc_interlocuteurs_01="Div_00330";$vl_c_id_inc_interlocuteurs_selection_01="Div_00337";break;  //  interlocuteurs de fournisseurs
  case "110005": $vl_c_id_inc_interlocuteurs_01="Div_00331";$vl_c_id_inc_interlocuteurs_selection_01="Div_00338";break;  //  interlocuteurs de autres acteurs
  case "110006": $vl_c_id_inc_interlocuteurs_01="Div_00332";$vl_c_id_inc_interlocuteurs_selection_01="Div_00339";break;  //  interlocuteurs de acteurs indéterminés
  case "110000": $vl_c_id_inc_interlocuteurs_01="Div_00340";$vl_c_id_inc_interlocuteurs_selection_01="Div_00341";break;  //  interlocuteurs de Entreprise
}
$vl_tc_composants=array($vl_c_id_inc_interlocuteurs_01,$vl_c_id_inc_interlocuteurs_selection_01);
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bfd_100=fa_recup_dico("bfd_100");
$vl_c_bfd_101=fa_recup_dico("bfd_101");
$vl_c_bfd_102=fa_recup_dico("bfd_102");
$vl_c_bfd_103=fa_recup_dico("bfd_103");
$vl_c_bfd_104=fa_recup_dico("bfd_104");
$vl_c_bfd_105=fa_recup_dico("bfd_105");
$vl_c_dico_00002=fa_recup_dico('dico_00002');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_dico_00013=fa_recup_dico('dico_00013');
$vl_c_dico_00014=fa_recup_dico('dico_00014');
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_id_vbox_inc_interlocuteurs_01="bdq_interlocuteur_01";
$vl_c_id_arbre_inc_interlocuteurs_01="arbre_des_interlocuteurs";
$sql_req="SELECT description as description,choix_cleunik FROM _actions where _actions.action_cleunik=$vl_e_action_cleunik;";
$result=_graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$vl_c_description=fa_ent_xml($row['description']);
$vl_choix_cleunik=fa_ent_xml($row['choix_cleunik']);
_graal_libere_requete_bd($result);
$vl_relation_privilege=-110402;
switch ($vl_choix_cleunik){
  case -110106: //  Réception d'un appel téléphonique
    $vl_relation_privilege=-110406; //  Emetteur de l'appel téléphonique
    break;
  case -110125: //  Réception d'un appel téléphonique
    $vl_relation_privilege=-110431; //  Emetteur du message vocal
    break;
	case -110118: //  Chat
    $vl_relation_privilege=-110416; //  Participant de chat
    break;
  case -110114:  //  Offres Client
    switch ($vl_c_genreacteur) {
      case "offcli":  $vl_relation_privilege=-110419;break; // Interlocuteur privilégié d'une offre client
      case "cdecli":  $vl_relation_privilege=-110420;break; // Interlocuteur privilégié d'une commande client
      case "livcli":  $vl_relation_privilege=-110421;break;//  Interlocuteur privilégié d'une livrisaon client
      case "faccli":  $vl_relation_privilege=-110422;break;//  Interlocuteur privilégié d'une facture client
    }
    break;
  case -110108:  //  Commande Client
  case -110110:  //  Livraison Client
  case -110112:  //  Facture Client
    switch ($vl_c_genreacteur) {
      case "cdecli":  $vl_relation_privilege=-110420;break; // Interlocuteur privilégié d'une commande client
      case "livcli":  $vl_relation_privilege=-110421;break;//  Interlocuteur privilégié d'une livrisaon client
      case "faccli":  $vl_relation_privilege=-110422;break;//  Interlocuteur privilégié d'une facture client
    }
    break;
  case -110115:  //  Demande fournisseur
    switch ($vl_c_genreacteur) {
      case "demfou":  $vl_relation_privilege=-110423;break; // Interlocuteur privilégié d'une demande fournisseur
      case "cdefou":  $vl_relation_privilege=-110424;break; // Interlocuteur privilégié d'une commande fournisseur
      case "recfou":  $vl_relation_privilege=-110425;break;//  Interlocuteur privilégié d'une réception fournisseur
      case "facfou":  $vl_relation_privilege=-110426;break;//  Interlocuteur privilégié d'une facture fournisseur
    }
    break;
  case -110109:  //  Commande Fournisseur
  case -110111:  //  Réception fournisseur
  case -110113:  //  Facture fournisseur
  case -110135:  //  Relance fournisseur
    switch ($vl_c_genreacteur) {
      case "cdefou":  $vl_relation_privilege=-110424;break; // Interlocuteur privilégié d'une commande fournisseur
      case "recfou":  $vl_relation_privilege=-110425;break;//  Interlocuteur privilégié d'une réception fournisseur
      case "facfou":  $vl_relation_privilege=-110426;break;//  Interlocuteur privilégié d'une facture fournisseur
      case "relfou":  $vl_relation_privilege=-110442;break;//  Interlocuteur privilégié d'une relance fournisseur
    }
    break;
}
switch ($vl_choix_cleunik){
  case -110114:  //  Offres Client
  case -110108:  //  Commande Client
  case -110110:  //  Livraison Client
  case -110112:  //  Facture Client
  case -110115:  //  Demande fournisseur
  case -110109:  //  Commande Fournisseur
  case -110111:  //  Réception fournisseur
  case -110113:  //  Facture fournisseur
  case -110135:  //  Relance fournisseur
    $ml_graal=fa_brik_menulist_choix("xxx",1,-1,1,$vl_relation_privilege,'ml_graal',"broadcaster_01",$vl_relation_privilege);
    break;
  default:
    $ml_graal=fa_brik_menulist_choix(95,1,-1,1,$vl_relation_privilege,'ml_graal',"broadcaster_01",0);
    break;
}
switch ($vl_c_genreacteur) {
  case "moimoi":
	$vl_e_int_cleunik=intval(fa_recup_session('vs_int_cleunik','0'));
	$vl_e_act_cleunik=intval(fa_recup_session('vs_act_cleunik','0'));
	$vl_c_moi=fa_recup_session('vs_nomcomplet','');
    break;
  case "luilui":
    $sql_req="SELECT patronyme as `patronyme`,prenom as `prenom`,act_cleunik as act_cleunik FROM _act_interlo where int_cleunik=$vl_e_int_cleunik";
    $result = _graal_requete_bd($sql_req);
    $row = mysql_fetch_assoc($result);
    $vl_c_moi=fa_ent_xml($row['prenom'])." ".fa_ent_xml($row['patronyme']);
    $vl_e_act_cleunik=fa_ent_xml($row['act_cleunik']);
    _graal_libere_requete_bd($result);
    break;
  case "offcli":  // Interlocuteur privilégié d'une offre client
  case "cdecli":  //  Interlocuteur privilégié d'une commande client
  case "livcli":  //  Interlocuteur privilégié d'une livrisaon client
  case "faccli":  //  Interlocuteur privilégié d'une facture client
  case "demfou":  // Interlocuteur privilégié d'une demande fournisseur
  case "cdefou":  // Interlocuteur privilégié d'une commande fournisseur
  case "recfou":  //  Interlocuteur privilégié d'une réception fournisseur
  case "facfou":  //  Interlocuteur privilégié d'une facture fournisseur
  case "relfou":  //  Interlocuteur privilégié d'une relance fournisseur
    $vl_e_act_cleunik=intval(fa_recup_param('vl_e_act_cleunik','0'));
    $vl_e_int_cleunik=0;
    $vl_c_moi=_graal_requete_acteur($vl_e_act_cleunik);
    break;
  default:
    $vl_e_act_cleunik=0;
    $vl_e_int_cleunik=0;
    $vl_c_moi="";
    break;
}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" _graal_genreacteur="$vl_c_genreacteur" title="$vl_c_bfd_100" id="_graal_fen_actions_graal_01" onload="fa_aa(this);pf_aa_init()" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
<popupset>
  <popup id="pop_selections">
  <menuitem class="menuitem-iconic ai15" label="$vl_c_bfd_103" oncommand="pf_acteur_ouvre();" />
  <menuitem class="menuitem-iconic ai18" label="$vl_c_bfd_104" oncommand="pf_interlo_ouvre();" />
	<menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_interlocuteurs');" />
  </popup>
</popupset>
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_fen_actions_graal_01.js.php");
switch ($vl_c_genreacteur) {
  case "moimoi":
  case "luilui":
    break;
  case "offcli":  // Interlocuteur privilégié d'une offre client
  case "cdecli":  //  Interlocuteur privilégié d'une commande client
  case "livcli":  //  Interlocuteur privilégié d'une livrisaon client
  case "faccli":  //  Interlocuteur privilégié d'une facture client
  case "demfou":  // Interlocuteur privilégié d'une demande fournisseur
  case "cdefou":  // Interlocuteur privilégié d'une commande fournisseur
  case "recfou":  //  Interlocuteur privilégié d'une réception fournisseur
  case "facfou":  //  Interlocuteur privilégié d'une facture fournisseur
  case "relfou":  //  Interlocuteur privilégié d'une relance fournisseur
    echo ('<vbox flex="3">');
    include("_graal_inc_interlocuteurs_01.php");
    echo ('</vbox>');
    break;
  default:
    $vl_c_invisible_inc_interlocuteurs_selection_01="false";
    include("_graal_inc_interlocuteurs_selection_01.php");
    echo ('<vbox flex="3">');
    include("_graal_inc_interlocuteurs_01.php");
    echo ('</vbox>');
    break;
}
echo <<<END
  <groupbox>
  <textbox id="tb_description" disabled="true" multiline="true" value="$vl_description"/>
  <hbox>
  <label control="la_prefixe_choix_cleunik" value="$vl_c_bfd_101"/>
  $ml_graal
  </hbox>
  <textbox id="tb_interlo" value="$vl_c_moi" int_cleunik="$vl_e_int_cleunik" act_cleunik="$vl_e_act_cleunik" disabled="true" />
        <label value="$vl_c_bfd_105" />
    <radiogroup id="rdg_principal" >
       <hbox >
       <radio id="rd_principal_non" label="$vl_c_dico_00014" value="1" />
       <spacer flex="1"/>
       <radio id="rd_principal_oui" label="$vl_c_dico_00013" value="2" />
       </hbox>
     </radiogroup>
  <hbox>
        <label control="la_blocnotebrut" value="$vl_c_bfd_102"/>
        <textbox flex="1" id="tb_blocnotebrut"   multiline="true"/>
  </hbox>
  </groupbox>
  <hbox> 
    <button width="40" flex="1" id="bt_ajouter" label="$vl_c_dico_00002" crop="end" dir="normal" oncommand="pf_validation('ajouter')" />
    <button width="40" flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir')" />
  </hbox>
END;
$vl_c_inc_actions_graal_barre_invisible="true";
include("_graal_inc_actions_graal.php");
echo <<<END
</window>
END;
?>
