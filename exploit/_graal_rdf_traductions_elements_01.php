<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_obj_cleunik=intval(fa_recup_param('vl_e_obj_cleunik','0'));
$vl_e_langue=intval(fa_recup_param('vl_e_langue','120115'));  //  anglais par défaut
$vl_e_français=120131;
$vl_b_atraduireseuls=intval(fa_recup_param('vl_b_atraduireseuls','0'));
$vl_e_uti_cleunik=0;
$vl_c_dico00008=fa_recup_dico("dico_00008");
$vl_c_dico00009=fa_recup_dico("dico_00009");
$vl_c_dico00010=fa_recup_dico("dico_00010");
$vl_c_dico00011=fa_recup_dico("dico_00011");
$vl_c_dico00012=fa_recup_dico("dico_00012");
$vl_c_dico00017=fa_recup_dico("dico_00017");


//  On commence par ajouter, à partir des libellés français, les libellés étrangers
$sql_req = "insert into _elements_libelle select alias01.ele_cleunik,alias01.descriptif,alias01.commentaire,$vl_e_langue,$vl_e_uti_cleunik from _elements_libelle alias01 where alias01.ele_cleunik not in ( select _elements_libelle.ele_cleunik from _elements_libelle where langue=$vl_e_langue)";
$result = _graal_requete_bd($sql_req);


$sql_req = "SELECT _elements.ele_cleunik as ele_cleunik,_elements.titre AS titre,_elements_libelle.descriptif AS descriptif, _traduits.descriptif AS traduction,_elements_libelle.commentaire AS commentaire,_elements.type_objet as type_objet FROM _elements,_elements_libelle,_elements_libelle _traduits WHERE _elements.ele_cleunik=_elements_libelle.ele_cleunik and _traduits.ele_cleunik=_elements_libelle.ele_cleunik and _elements_libelle.langue=$vl_e_français and _traduits.langue=$vl_e_langue and _elements.fen_cleunik=$vl_e_obj_cleunik";
if ($vl_b_atraduireseuls==1)
{
  $sql_req .= " and _elements_libelle.descriptif=_traduits.descriptif"; 
}
$sql_req .= " ORDER BY descriptif;";


$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
  while ($row = mysql_fetch_assoc($result))
    {
      echo('<RDF:li>'.EOL);
      echo('<RDF:Description>');
      // parseType = indication pour le type des données, utile pour le tri sur la colonne
      echo('<row:ele_cleunik NC:parseType="Integer">'.fa_ent_xml($row['ele_cleunik']).'</row:ele_cleunik>');
      echo('<row:titre>'.fa_ent_xml($row['titre']).'</row:titre>');
      echo('<row:descriptif>'.fa_ent_xml($row['descriptif']).'</row:descriptif>');
      echo('<row:traduction>'.fa_ent_xml($row['traduction']).'</row:traduction>');
      echo('<row:commentaire>'.fa_ent_xml($row['commentaire']).'</row:commentaire>');
      switch ($row['type_objet'])
      {
        case 1:echo("<row:type_objet_clair>$vl_c_dico00008</row:type_objet_clair>");break;
        case 2:echo("<row:type_objet_clair>$vl_c_dico00009</row:type_objet_clair>");break;
        case 3:echo("<row:type_objet_clair>$vl_c_dico00011</row:type_objet_clair>");break;
        case 4:echo("<row:type_objet_clair>$vl_c_dico00012</row:type_objet_clair>");break;
        case 5:echo("<row:type_objet_clair>$vl_c_dico00017</row:type_objet_clair>");break;
        default:echo("<row:type_objet_clair>$vl_c_dico00010</row:type_objet_clair>");break;
      }
      echo('</RDF:Description>'.EOL);
      echo('</RDF:li>'.EOL);
    }
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
