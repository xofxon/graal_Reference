<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_id=intval(fa_recup_param("id","-1"));
$vl_c_sortie=fa_recup_param("sortie","das");
$sql_req = "SELECT * FROM _w_import_01 where col_001=$vl_e_id;";
/*
 * voir le format d'export dans _graal_das_acteurs_tarifs_particulier_achats
 */
$result = _graal_requete_bd($sql_req);
switch ($vl_c_sortie) {
	case "das":
		echo('<donnees>');
		while ($row = mysql_fetch_assoc($result)) {
			echo('<quoi ');
				echo(' code="'.fa_ent_xml($row['col_013']).'"');
			    echo(' description="'.fa_ent_xml($row['col_014']).'"');
			    echo(' date_dermaj="'.fa_ent_xml($row['col_011']).'"');
			    echo(' nouveau_tarif_type_vente="'.fa_ent_xml($row['col_012']).'"');
			    echo(' tar_cleunik_type_vente="'.fa_ent_xml($row['col_002']).'"');
			    echo(' code_type_vente="'.fa_ent_xml($row['col_003']).'"');
			    echo(' designation_type_vente="'.fa_ent_xml($row['col_004']).'"');
			    echo(' tarif_type_vente="'.fa_ent_xml($row['col_005']).'"');
			    echo(' datevalidite="'.fa_ent_xml($row['col_006']).'"');
			    $borne_basse=fa_reel(fa_ent_xml($row['col_007']),0);
			 	$val_borne_basse=fa_ent_xml($row['col_007'])*1000;
			  	echo(' borne_basse="'.$borne_basse.'"');
			  	printf(' val_borne_basse="%011u"',$val_borne_basse);
			  	$borne_haute=fa_reel(fa_ent_xml($row['col_008']),0);
			 	$val_borne_haute=fa_ent_xml($row['col_008'])*1000;
			  	echo(' borne_haute="'.$borne_haute.'"');
			  	printf(' val_borne_haute="%011u"',$val_borne_haute);
			echo('/>');
		}
		echo('</donnees>');
		break;
	case "inventaire_03":
		//echo $sql_req;
		echo('<donnees>');
		while ($row = mysql_fetch_assoc($result)) {
			echo('<quoi ');
				echo(' code="'.fa_ent_xml($row['col_002']).'"');
			    echo(' mnemotechnique="'.fa_ent_xml($row['col_003']).'"');
			    echo(' art_cleunik="'.fa_ent_xml($row['col_004']).'"');
			    echo(' description="'.fa_ent_xml($row['col_005']).'"');
			    echo(' qte_stock="'.fa_ent_xml($row['col_006']).'"');
			    echo(' unite="'.fa_ent_xml($row['col_007']).'"');
			    echo(' dateheure_dermvt="'.fa_ent_xml($row['col_008']).'"');
			    echo(' dateheure_dermvt_tri="'.fa_ent_xml($row['col_009']).'"');
			    
			    echo(' val_qte_stock="'.fa_ent_xml($row['col_010']).'"');
			    echo(' dateheure_invent="'.fa_ent_xml($row['col_011']).'"');
			    echo(' dateheure_invent_tri="'.fa_ent_xml($row['col_012']).'"');
			    if ($row['col_013']=="-1"){
			    	echo(' qte_inventaire=""');
			    } else {
			    	echo(' qte_inventaire="'.fa_ent_xml($row['col_013']).'"');
			    }
			    
			echo('/>');
		}
		echo('</donnees>');
		break;
	case "inventaire_04":
		//echo $sql_req;
		echo('<donnees>');
		while ($row = mysql_fetch_assoc($result)) {
			echo('<quoi ');
				echo(' code="'.fa_ent_xml($row['col_002']).'"');
			    echo(' mnemotechnique="'.fa_ent_xml($row['col_003']).'"');
			    echo(' art_cleunik="'.fa_ent_xml($row['col_004']).'"');
			    echo(' description="'.fa_ent_xml($row['col_005']).'"');
			    echo(' qte_stock="'.fa_ent_xml($row['col_006']).'"');
			    echo(' unite="'.fa_ent_xml($row['col_007']).'"');
			    echo(' dateheure_dermvt="'.fa_ent_xml($row['col_008']).'"');
			    echo(' dateheure_dermvt_tri="'.fa_ent_xml($row['col_009']).'"');
			    
			    echo(' val_qte_stock="'.fa_ent_xml($row['col_010']).'"');
			    echo(' dateheure_invent="'.fa_ent_xml($row['col_011']).'"');
			    echo(' dateheure_invent_tri="'.fa_ent_xml($row['col_012']).'"');
			    if ($row['col_013']=="-1"){
			    	echo(' qte_inventaire=""');
			    } else {
			    	echo(' qte_inventaire="'.fa_ent_xml($row['col_013']).'"');
			    }
			    echo(' code_depot="'.fa_ent_xml($row['col_014']).'"');
			    echo(' code_empla="'.fa_ent_xml($row['col_015']).'"');
			echo('/>');
		}
		echo('</donnees>');
		break;
}
_graal_libere_requete_bd($result);

$sql_req = "DELETE FROM _w_import_01 where col_001=$vl_e_id;";
//_graal_requete_bd($sql_req);

_graal_ferme_connexion();
?>
