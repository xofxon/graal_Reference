<?php
include("_graal_header_xul.inc.php");
include("_graal_var_portee.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vs_envaa=fa_recup_session('vs_envaa','0');	//	Nombre d'utilisateurs
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_e_interlo_cleunik=intval(fa_recup_param("vl_e_interlo_cleunik","-1"));
$vl_e_act_cleunik=intval(fa_recup_param("vl_e_act_cleunik","-1"));
$vl_e_nomcomplet=fa_recup_session('vs_nomcomplet','tesquiconnard?');
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
if ($vl_e_interlo_cleunik!=-1){
	/*
	 * Gestion de la liste noire des acteurs
	 * Gestion de la liste blanche des acteurs
	 */
	$vl_c_xml_uti=simplexml_load_string($_SESSION["vs_param_environ"]);
	if (isset($vl_c_xml_uti->gesacteurs_ml_zone)){$vs_gesacteurs_ml_zone=$vl_c_xml_uti->gesacteurs_ml_zone->attributes();}else{$vs_gesacteurs_ml_zone='1';}
	//echo $vs_gesacteurs_ml_zone;
	switch ($vs_gesacteurs_ml_zone){
		case '1':	//	Accès libre
			$sql_req="SELECT a2.typeacteur as genre_acteur,a1.act_cleunik FROM _act_interlo a1, _acteurs a2 where a1.act_cleunik=a2.act_cleunik and int_cleunik=$vl_e_interlo_cleunik"; 
			$result=_graal_requete_bd($sql_req);
			//echo $sql_req;
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['genre_acteur'];
			$vl_e_act_cleunik=$row['act_cleunik'];
			_graal_libere_requete_bd($result);
			break;
		case '3':	//	Accès sur liste noire
			$sql_req="SELECT a2.typeacteur as genre_acteur,a1.act_cleunik FROM _act_interlo a1, _acteurs a2 where a1.act_cleunik=a2.act_cleunik and int_cleunik=$vl_e_interlo_cleunik"; 
			$sql_req.=" and (select count(*) from _acteurs_noire where _acteurs_noire.act_cleunik=a2.act_cleunik and _acteurs_noire.uti_cleunik=$vl_e_uti_cleunik) = 0 ;"; 
			//die($sql_req);
			$result=_graal_requete_bd($sql_req);
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['genre_acteur'];
			$vl_e_act_cleunik=$row['act_cleunik'];
			_graal_libere_requete_bd($result);
		break;
		case '4':	//	Accès sur liste blanche
			$sql_req="SELECT a2.typeacteur as genre_acteur,a1.act_cleunik FROM _act_interlo a1, _acteurs a2 where a1.act_cleunik=a2.act_cleunik and int_cleunik=$vl_e_interlo_cleunik"; 
			$sql_req.=" and (select count(*) from _acteurs_blanc where _acteurs_blanc.act_cleunik=a2.act_cleunik and _acteurs_blanc.uti_cleunik=$vl_e_uti_cleunik) <> 0 ;"; 
			$result=_graal_requete_bd($sql_req);
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['genre_acteur'];
			$vl_e_act_cleunik=$row['act_cleunik'];
			_graal_libere_requete_bd($result);
			break;
	}
}
switch ($vl_c_genreacteur) {
  case "110000": $vl_c_id_fenetre="Fen_00140";$vl_c_id_inc_interlos_coordonnees_01="Div_00154";$vl_c_id_inc_interlos_adresses_01="Div_00179";$vl_c_inc_interlos_relations_01="Div_00187";$vl_c_id_inc_interlos_criteres_entreprise="Div_00065";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00293";$vl_c_id_inc_interlos_criteres_lesautres="Div_00300";$vl_c_id_inc_interlos_criteres_tous="Div_00387";$class_tabedition="ba07";break;  //  Interlocuteurs des Membres de l'entreprise
  case "110001": $vl_c_id_fenetre="Fen_00142";$vl_c_id_inc_interlos_coordonnees_01="Div_00155";$vl_c_id_inc_interlos_adresses_01="Div_00180";$vl_c_inc_interlos_relations_01="Div_00188";$vl_c_id_inc_interlos_criteres_entreprise="Div_00287";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00294";$vl_c_id_inc_interlos_criteres_lesautres="Div_00301";$vl_c_id_inc_interlos_criteres_tous="Div_00388";$class_tabedition="ba02";break;  //  Interlocuteurs des prospects clients
  case "110002": $vl_c_id_fenetre="Fen_00144";$vl_c_id_inc_interlos_coordonnees_01="Div_00156";$vl_c_id_inc_interlos_adresses_01="Div_00181";$vl_c_inc_interlos_relations_01="Div_00189";$vl_c_id_inc_interlos_criteres_entreprise="Div_00288";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00295";$vl_c_id_inc_interlos_criteres_lesautres="Div_00302";$vl_c_id_inc_interlos_criteres_tous="Div_00389";$class_tabedition="ba04";break;  //  Interlocuteurs des prospects fournisseurs
  case "110003": $vl_c_id_fenetre="Fen_00141";$vl_c_id_inc_interlos_coordonnees_01="Div_00157";$vl_c_id_inc_interlos_adresses_01="Div_00182";$vl_c_inc_interlos_relations_01="Div_00190";$vl_c_id_inc_interlos_criteres_entreprise="Div_00289";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00296";$vl_c_id_inc_interlos_criteres_lesautres="Div_00303";$vl_c_id_inc_interlos_criteres_tous="Div_00390";$class_tabedition="ba01";break;  //  Interlocuteurs des clients
  case "110004": $vl_c_id_fenetre="Fen_00143";$vl_c_id_inc_interlos_coordonnees_01="Div_00158";$vl_c_id_inc_interlos_adresses_01="Div_00183";$vl_c_inc_interlos_relations_01="Div_00191";$vl_c_id_inc_interlos_criteres_entreprise="Div_00290";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00297";$vl_c_id_inc_interlos_criteres_lesautres="Div_00304";$vl_c_id_inc_interlos_criteres_tous="Div_00391";$class_tabedition="ba03";break;  //  Interlocuteurs des fournisseurs
  case "110005": $vl_c_id_fenetre="Fen_00146";$vl_c_id_inc_interlos_coordonnees_01="Div_00159";$vl_c_id_inc_interlos_adresses_01="Div_00184";$vl_c_inc_interlos_relations_01="Div_00192";$vl_c_id_inc_interlos_criteres_entreprise="Div_00291";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00298";$vl_c_id_inc_interlos_criteres_lesautres="Div_00305";$vl_c_id_inc_interlos_criteres_tous="Div_00392";$class_tabedition="ba05";break;  //  Interlocuteurs des autres acteurs
  case "110006": $vl_c_id_fenetre="Fen_00145";$vl_c_id_inc_interlos_coordonnees_01="Div_00160";$vl_c_id_inc_interlos_adresses_01="Div_00185";$vl_c_inc_interlos_relations_01="Div_00193";$vl_c_id_inc_interlos_criteres_entreprise="Div_00292";$vl_c_id_inc_interlos_criteres_lesmiens="Div_00299";$vl_c_id_inc_interlos_criteres_lesautres="Div_00306";$vl_c_id_inc_interlos_criteres_tous="Div_00393";$class_tabedition="ba06";break;  //  Interlocuteurs des acteurs indéterminés
  default:
    die;  
}
switch ($vl_c_genreacteur) {
  case "110000": $id_inc_actions_recherche="Div_00415";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_entrep;break;  //  Interlocuteurs des Membres de l'entreprise
  case "110001": $id_inc_actions_recherche="Div_00416";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_procli;break;  //  Interlocuteurs des prospects clients
  case "110002": $id_inc_actions_recherche="Div_00417";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_profou;break;  //  Interlocuteurs des prospects fournisseurs
  case "110003": $id_inc_actions_recherche="Div_00418";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_client;break;  //  Interlocuteurs des clients
  case "110004": $id_inc_actions_recherche="Div_00419";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_fourni;break;  //  Interlocuteurs des fournisseurs
  case "110005": $id_inc_actions_recherche="Div_00420";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_autrac;break;  //  Interlocuteurs des autres acteurs
  case "110006": $id_inc_actions_recherche="Div_00421";$id_inc_ged="Div_00367";$vl_portee_fonctions=$vl_e_actind;break;  //  Interlocuteurs des acteurs indéterminés
  default:
    die;  
}
$vl_tc_composants=array($vl_c_id_inc_interlos_coordonnees_01,$vl_c_id_inc_interlos_adresses_01,$vl_c_inc_interlos_relations_01,$vl_c_id_inc_interlos_criteres_entreprise,$vl_c_id_inc_interlos_criteres_lesmiens,$vl_c_id_inc_interlos_criteres_lesautres,$vl_c_id_inc_interlos_criteres_tous,$id_inc_actions_recherche,$id_inc_ged);
$vl_c_barre_presente_interlos_relations_01='ok';
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=0;$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
if ($vl_e_interlo_cleunik==0) {$vl_b_suppr=0;}  //  on n'a pas le droit de supprimer l'interlocuteur 0
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_baz_100=fa_recup_dico("baz_100");
$vl_c_baz_101=fa_recup_dico("baz_101");
$vl_c_baz_102=fa_recup_dico("baz_102");
$vl_c_baz_103=fa_recup_dico("baz_103");
$vl_c_baz_104=fa_recup_dico("baz_104");
$vl_c_baz_105=fa_recup_dico("baz_105");
$vl_c_baz_106=fa_recup_dico("baz_106");
$vl_c_baz_107=fa_recup_dico("baz_107");
$vl_c_baz_108=fa_recup_dico("baz_108");
$vl_c_baz_109=fa_recup_dico("baz_109");
$vl_c_baz_110=fa_recup_dico("baz_110");
$vl_c_baz_111=fa_recup_dico("baz_111");
$vl_c_baz_112=fa_recup_dico("baz_112");
$vl_c_baz_113=fa_recup_dico("baz_113");
$vl_c_baz_114=fa_recup_dico("baz_114");
$vl_c_baz_115=fa_recup_dico("baz_115");
$vl_c_baz_116=fa_recup_dico("baz_116");
$vl_c_baz_117=fa_recup_dico("baz_117");
$vl_c_baz_118=fa_recup_dico("baz_118");
$vl_c_baz_119=fa_recup_dico("baz_119");
$vl_c_baz_120=fa_recup_dico("baz_120");
$vl_c_baz_121=fa_recup_dico("baz_121");
$vl_c_baz_122=fa_recup_dico("baz_122");
$vl_c_baz_123=fa_recup_dico("baz_123");$vl_c_baz_123="Ajouter à un dossier";
$vl_c_dico_00027=fa_recup_dico("dico_00027");
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00058=fa_recup_dico("dico_00058");
$vl_c_dico_00059=fa_recup_dico("dico_00059");
$vl_c_dico_00073=fa_recup_dico("dico_00073");
$tab_key=array();
$vl_k_baz_101=fa_cree_raccourcis($vl_c_baz_101,$tab_key);
$vl_k_baz_102=fa_cree_raccourcis($vl_c_baz_102,$tab_key);
$vl_k_baz_120=fa_cree_raccourcis($vl_c_baz_120,$tab_key);
$vl_k_baz_103=fa_cree_raccourcis($vl_c_baz_103,$tab_key);
$vl_k_baz_104=fa_cree_raccourcis($vl_c_baz_104,$tab_key);
$vl_k_baz_117=fa_cree_raccourcis($vl_c_baz_117,$tab_key);
$vl_k_baz_119=fa_cree_raccourcis($vl_c_baz_119,$tab_key);
$vl_k_nomcomplet=fa_cree_raccourcis($vl_e_nomcomplet,$tab_key);
$vl_k_dico_00058=fa_cree_raccourcis($vl_c_dico_00058,$tab_key);
$vl_k_dico_00059=fa_cree_raccourcis($vl_c_dico_00059,$tab_key);
$vl_k_dico_00073=fa_cree_raccourcis($vl_c_dico_00073,$tab_key);

$vl_c_cache_onglets="false";
$ml_civilites=fa_brik_menulist_choix(86,15,-1,-1,'','ml_civilites',"broadcaster_01",0);
$vl_c_genreaction="interlo";
if ($vl_e_interlo_cleunik==-1){
  $vl_c_cache_onglets="false";
  $ml_fonctions=fa_brik_menulist_choix("92",15,$vl_portee_fonctions,1,'','ml_fonctions',"broadcaster_01",-7);
} else {
  $ml_fonctions=fa_brik_menulist_choix("92A",15,$vl_portee_fonctions,1,$vl_e_interlo_cleunik,'ml_fonctions',"broadcaster_01",0);
}
$vl_c_raisonsoc=_graal_requete_acteur($vl_e_act_cleunik);
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
//$c_id_windows="";
echo <<<END
<window context="graal_cp00" title="$vl_c_baz_100" id="$c_id_windows" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("js/_graal_act_interlo_01.js.php");
include_once("js/_graal_01.js.php");
include("js/_graal_04.js.php");
include_once("js/_graal_07_ged.js.php");
include("js/_graal_actions_selection_01.js.php");
include_once("js/_graal_05_dates.js.php");
echo <<<END
<broadcasterset>
  <broadcaster id="broadcaster_01" />
</broadcasterset>
<description>$vl_c_raisonsoc</description>
  <tabbox id="tabbox_01" flex="1" orient="vertical" class="overflow_01">
    <tabs> 
       <tab class="$class_tabedition" first-tab="true" linkedpanel="tabpanel_info_gen" id="tab_info_gen" label="$vl_c_baz_101" selected="true" accesskey="$vl_k_baz_101"/>
       <tab id="tab_coordonnees" linkedpanel="tabpanel_coordonnees" label="$vl_c_baz_102" accesskey="$vl_k_baz_102"/>
       <tab class="af08" id="tab_actions" linkedpanel="tabpanel_actions" label="$vl_c_baz_120" accesskey="$vl_k_baz_120"/>
       <tab class="al01" id="tab_criteres" linkedpanel="tabpanel_critere" label="$vl_c_baz_103" accesskey="$vl_k_baz_103"/>
       <tab id="tab_adresses_postales" linkedpanel="tabpanel_adresses_post" label="$vl_c_baz_104" accesskey="$vl_k_baz_104"/>
       <tab id="tab_relations" linkedpanel="tabpanel_relations" label="$vl_c_baz_117" accesskey="$vl_k_baz_117"/>
       <tab class="ah03" linkedpanel="tabpanel_ged" id="tab_ged" label="$vl_c_baz_119" accesskey="$vl_k_baz_119"/>
    </tabs>
    <tabpanels flex="1">
  		<tabpanel id="tabpanel_info_gen" flex="1">
<vbox id="box_boite_outils_xof_03" flex="1">
<vbox id="aai_acteurs_03">
  <hbox>  
<menubar id="menu_menus" >
  <menu id="menu_02" observes="broadcaster_01" label="$vl_c_baz_113" accesskey="C" >
   <menupopup>
  <menuitem id="menu_02_01" label="$vl_c_baz_114" class="menuitem-iconic ak08" oncommand="pf_action('favoris_ajout')" />
  <menuitem id="menu_02_02" label="$vl_c_baz_115" class="menuitem-iconic ak09" oncommand="pf_action('favoris_supprimer')" />
  <menuitem id="menu_02_05" label="$vl_c_baz_123" class="menuitem-iconic aj01" oncommand="pf_action('dossier_ajouter')" />
  <menuseparator id="menu_02_03"/>
  <menuitem id="menu_02_04" disabled="true" label="$vl_c_baz_116" />
   </menupopup>
 </menu>
</menubar>
</hbox>  
</vbox>

  <grid flex="1">
    <columns flex="1">
      <column />
      <column flex="1"/>
    </columns>
    <rows>
      <row>
      <label control="la_civilite" value="$vl_c_baz_108"/>
      $ml_civilites
      </row>
      <row>
        <label control="la_prenom" value="$vl_c_baz_106"/>
        <textbox observes="broadcaster_01" id="tb_prenom"  />
      </row>
      <row>
        <label control="la_patronyme" value="$vl_c_baz_107"/>
        <textbox observes="broadcaster_01" id="tb_patronyme"  />
      </row>
      <row>
        <label control="la_fonction" value="$vl_c_baz_121"/>
        $ml_fonctions
      </row>

      <row flex= "10">
        <label control="la_blocnotebrut" value="$vl_c_baz_109"/>
        <textbox observes="broadcaster_01" id="tb_blocnotebrut"   multiline="true"/>
      </row>
      <row >
        <label control="la_dateheuremodif" value="$vl_c_baz_110"/>
        <textbox disabled="true" id="tb_dateheuremodif"  />
      </row>
      <row >
        <label control="la_infodefaut" value="$vl_c_baz_112"/>
        <radiogroup id='rdg_defaut' flex="1" name='name'>
          <hbox>
            <radio observes="broadcaster_01" id='ra_defaut_oui' label="$vl_c_dico_00013" value='1' />
            <radio observes="broadcaster_01" id='ra_defaut_non' label="$vl_c_dico_00014" value='2'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row >
        <label control="la_actif" value="$vl_c_baz_118"/>
        <radiogroup id='rdg_actif' flex="1" name='name'>
          <hbox>
            <radio observes="broadcaster_01" id='ra_actif_oui' label="$vl_c_dico_00013" value='1' />
            <radio observes="broadcaster_01" id='ra_actif_non' label="$vl_c_dico_00014" value='2'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row >
        <label control="la_dateheurevalidite" value="$vl_c_baz_111"/>
        <textbox observes="broadcaster_01" id="tb_dateheurevalidite"  />
      </row>
      <row >
        <label control="la_codealphanum15" value="$vl_c_baz_105"/>
        <textbox observes="broadcaster_01" id="tb_codealphanum15"  />
      </row>
    </rows>
  </grid>
  
</vbox>
 		</tabpanel>
      <tabpanel id="tabpanel_critere" flex="1">
        <tabbox id="tabbox_02" flex="1" orient="vertical" class="overflow_01">
          <tabs>
            <tab first-tab="true" class="ag17" linkedpanel="tabpanel_critere_entreprise" id="tab_edition_critere_entreprise" label="$vl_c_dico_00058" selected="true" accesskey="$vl_k_dico_00058"/>
            <tab class="ak15" linkedpanel="tabpanel_critere_lesmiens" id="tab_edition_critere_lesmiens" label="$vl_e_nomcomplet" accesskey="$vl_k_nomcomplet"/>
END;
if ($vs_envaa!=1){
echo <<<END
            <tab class="ak19" linkedpanel="tabpanel_critere_lesautres" id="tab_edition_critere_lesautres" label="$vl_c_dico_00059" accesskey="$vl_k_dico_00059"/>
            <tab class="bd01" id="tab_edition_critere_tous" linkedpanel="tabpanel_critere_tous" label="$vl_c_dico_00073" accesskey="$vl_k_dico_00073"/>
END;
}
echo <<<END
          </tabs>
          <tabpanels flex="1">
          	<tabpanel id="tabpanel_critere_entreprise" flex="1">
END;
include("_graal_inc_interlos_criteres_entreprise.php");
echo '</tabpanel>';
echo '<tabpanel id="tabpanel_critere_lesmiens" flex="1">';
include("_graal_inc_interlos_criteres_lesmiens.php");
echo '</tabpanel>';
if ($vs_envaa!=1){
	echo '<tabpanel id="tabpanel_critere_lesautres" flex="1">';
	include("_graal_inc_interlos_criteres_lesautres.php");
	echo '</tabpanel>';
	echo '<tabpanel id="tabpanel_critere_tous" flex="1">';
	include("_graal_inc_interlos_criteres_tous.php");
	echo '</tabpanel>';
}
echo <<<END
          </tabpanels>
        </tabbox>
      </tabpanel>
      <tabpanel id="tabpanel_coordonnees" flex="1">
END;
include("_graal_inc_interlos_coordonnees_01.php");
echo('</tabpanel><tabpanel id="tabpanel_adresses_post" flex="1">');
include("_graal_inc_interlos_adresses_02.php");
echo('</tabpanel><tabpanel id="tabpanel_relations" flex="1">');
include("_graal_inc_interlos_relations_01.php");
echo('</tabpanel><tabpanel id="tabpanel_ged" flex="1">');
$vl_c_voir_doc="non";
include("_graal_inc_ged_01.php");
echo('</tabpanel><tabpanel id="tabpanel_actions" flex="1">');
echo("<hbox flex='1'>");
echo("<vbox flex='1'>");
echo('<toolbarbutton id="tb_action_ajouter" tooltiptext="'.$vl_c_baz_122.'" class="am07" oncommand="pf_ajoute_bem(\'interlo\',\'\')" observes="broadcaster_01"/>');
echo("</vbox>");
$vl_b_bloc_action_recherche=true;$vl_c_arbre_action="arbre_actions_01";
include ("_graal_inc_actions_recherche_01.php");
echo("</hbox>");
echo('</tabpanel>');
echo <<<END
    </tabpanels>
  </tabbox> 
  <hbox flex="0" id="boutons_standards"> 
END;
include("_graal_inc_boutons_01.php");
echo <<<END
  </hbox>
</window>
END;
?>
