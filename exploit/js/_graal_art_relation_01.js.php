<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_art_relations_01.php";
const vf_c_script_relations='_graal_das_art_relations_01.php?'
var vf_c_action;
var vf_e_art_cleunik_gauche,vf_e_art_cleunik_droite;
var tree_articles,tree_relations;
function pf_aa_init(){
  var ladate=new Date()
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  vf_e_art_cleunik_gauche=fa_gid("_win_fen_art_relation").getAttribute("_graal_art_cleunik_gauche");
  tree_articles=fa_gid("arbre_des_articles");
  tree_relations=fa_gid("arbre_relations");
  fa_focusdonne("bbo_tb_rechapproxima");
  pf_affiche_donnees_relations();
  fa_value_set("tb_selvalidite",ladate.getDate()+"/"+(ladate.getMonth()+1)+"/"+ladate.getFullYear());
  fa_approximatif_bbo();
}
function pf_affiche_donnees_relations() {
  var vl_c_param=vf_c_script_relations+"vl_art_cleunik="+vf_e_art_cleunik_gauche+"&raf_random="+Math.random()+"&vf_c_genre=A&'";
	fa_das("arbre_relations",vl_c_param);
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "sortir":
      window.close();
      break;
  }
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=="-1"){alert(vl_datas);}
  pf_affiche_donnees_relations();
}
function pf_raz_fiche(){
  fa_value_set("tb_blocnotebrut",'');
}
function pf_sel_arbre_articles(){
  var rowIndex = tree_articles.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_art_cleunik_droite=tree_articles.view.getCellText( rowIndex ,tree_articles.columns.getNamedColumn("art_cleunik"));  //  Clé unique article
  fa_att_set("tb_qui_droite","_graal_art_cleunik",vf_e_art_cleunik_droite)
  fa_value_set("tb_qui_droite",tree_articles.view.getCellText( rowIndex ,tree_articles.columns.getNamedColumn("code"))+' ('+tree_articles.view.getCellText( rowIndex ,tree_articles.columns.getNamedColumn("description"))+')');
}
function pf_validation(vv_quoi){
  var vl_c_donnees;
  if (fa_gid("tb_qui_droite").getAttribute("_graal_art_cleunik")=='0') {alert("Sélectionnez un article !!");return;}
  if (fa_gid("_win_fen_art_relation").getAttribute("_graal_art_cleunik_gauche")==fa_gid("tb_qui_droite").getAttribute("_graal_art_cleunik")) {alert("Ce genre de relation ne mene à rien !!!");return;}
  vl_c_donnees="";
  vl_c_donnees+="vl_art_cleunik_gauche="+fa_enc(fa_gid("_win_fen_art_relation").getAttribute("_graal_art_cleunik_gauche"))+"&";
  vl_c_donnees+="vl_art_cleunik_droite="+fa_enc(fa_gid("tb_qui_droite").getAttribute("_graal_art_cleunik"))+"&";
  vl_c_donnees+="vl_choix_cleunik_gauche="+fa_enc(fa_mlget("ml_rel_gauche"))+"&";
  vl_c_donnees+="vl_choix_cleunik_droite="+fa_enc(fa_mlget("ml_rel_droite"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_gid("tb_blocnotebrut").value)+"&";
  vl_c_donnees+="vf_c_action=ajouter&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
