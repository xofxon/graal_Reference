<?php
$vf_c_script_cial_entete="_graal_xml_docial_entete.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_adresses_01="_graal_xml_docial_adresses_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_adresses_02="_graal_xml_docial_adresses_02.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_recap_montants="_graal_das_docial_recap_montants.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_action_cleunik=$vl_action_cleunik&";
$vf_c_script_cial_lignes="_graal_das_actions_cial_lignes.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_compta="_graal_exe_docial_comptabilise.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_action_cleunik=$vl_action_cleunik&";
$vf_c_script_cial_bdope_action="_graal_bdope_doc_cial_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_bonsdepreparation="_graal_das_actions_cial_docciaux.php?vl_action_cleunik=$vl_action_cleunik&vl_type_clair=Facture&";
$js_bon_preparation="";
$js_confirmation_cdecli="";
$vl_c_bfl_245js=fa_recup_dico_js("bfl_245");$vl_c_bfl_245js="Nouveau numéro de facture";
$param_generaux_graal_137=intval(fa_recup_session('vs_param_generaux_graal_137','0'));
$param_bp00="vl_e_action_cleunik=$vl_action_cleunik&vl_commercial_cleunik=$commercial_cleunik&vl_genre_adresse=2&";
switch ($param_generaux_graal_137) {
  case 1:$vf_c_script_modele_facfou="_graal_pdf_facfou_01.php?$param_bp00";break;  //  Modele 1
  case 2:$vf_c_script_modele_facfou="_graal_pdf_facfou_02.php?$param_bp00";break;  //  Modele 2
  case 3:$vf_c_script_modele_facfou="_graal_pdf_facfou_03.php?$param_bp00";break;  //  Modele 3
}
$param_generaux_graal_173=intval(fa_recup_session('vs_param_generaux_graal_173','0'));
switch($param_generaux_graal_173) {
	case 2:
		$affiche_adresse_livraison=<<<EOT
fa_xmlhttprequest_xml("$vf_c_script_cial_adresses_01"+"raf_random="+Math.random()+"&","",pf_cial_affiche_adresse_livraison);
EOT;
		break;
	case 1:
	default:
		$affiche_adresse_livraison="";
		break;
}
$js_confirmation_cdecli=<<<EOT
    case 'facfou':
      pf_cial_pdf("$vf_c_script_modele_facfou"+"raf_random="+Math.random()+"&");
      break;
    case 'facfou_01':
      pf_cial_pdf("_graal_pdf_facfou_01.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
    case 'facfou_02':
      pf_cial_pdf("_graal_pdf_facfou_02.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
	case 'facfou_03':
      pf_cial_pdf("_graal_pdf_facfou_03.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break
EOT;
$pf_cial_affiche_donnees_bonsdepreparation=<<<EOT
function pf_cial_affiche_donnees_bonsdepreparation() {
  fa_das("arbre_bonsdepreparation","$vf_c_script_cial_bonsdepreparation"+"raf_random="+Math.random()+"&");
}
function pf_cial_fin_chargement_pdf(){
	pf_cial_affiche_donnees_bonsdepreparation();
}
EOT;
$pf_cial_affiche_donnees=<<<EOT
function pf_cial_affiche_donnees() {
  pf_cial_entete();
  $affiche_adresse_livraison
  fa_xmlhttprequest_xml("$vf_c_script_cial_adresses_02"+"raf_random="+Math.random()+"&","",pf_cial_affiche_adresse_facturati);
  pf_cial_affiche_lignes();
  pf_cial_affiche_montants();
  pf_cial_affiche_donnees_bonsdepreparation();
}
function pf_cial_pdf(vv_quoi){
	fa_att_set('iframe_docpdf','src',vv_quoi);
}
EOT;
$pf_cial_faccli_avofin=<<<EOT
function pf_cial_faccli_avofin() {
	if (confirm("Confirmez-vous la création d'un avoir financier ?")==false) {return;}
  fa_xmlhttprequest_txt("_graal_bdope_doc_cial_01.php?vf_c_action=facfou->avofif&vl_commercial_cleunik=$commercial_cleunik&","",pf_cial_facfou_avofif_fin);
}
function pf_cial_facfou_avofif_fin(stream){
  var vl_c_datas=stream;
  if (vl_c_datas==-1) {
    alert("Problème lors de la création de l'avoir financier!!");
  } else {
    if (confirm("Voulez-vous ouvrir l'avoir financier ?")==false) {
      return;
    } else {
      var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=modifier&genreaction=jenesaispas";
      fa_ouvre(c_cial_fen_action+vl_c_donnees,1000,700);
    }
  }
}
EOT;
$pf_cial_faccli_avocli=<<<EOT
function pf_cial_facfou_avofou() {
	if (confirm("Confirmez-vous la création d'un avoir sur stock ?")==false) {return;}
  fa_xmlhttprequest_txt("_graal_bdope_doc_cial_01.php?vf_c_action=facfou->avofou&vl_commercial_cleunik=$commercial_cleunik&","",pf_cial_facfou_avofou_fin);
}
function pf_cial_facfou_avofou_fin(stream){
  var vl_c_datas=stream;
  if (vl_c_datas==-1) {
    alert("Problème lors de la création de l'avoir sur stock!!");
  } else {
    if (confirm("Voulez-vous ouvrir l'avoir sur stock ?")==false) {
      return;
    } else {
      var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=modifier&genreaction=jenesaispas";
      fa_ouvre(c_cial_fen_action+vl_c_donnees,1000,700);
    }
  }
}
EOT;
$pf_cial_affiche_donnees_bonsdepreparation=<<<EOT
function pf_cial_affiche_donnees_bonsdepreparation() {
  fa_das("arbre_bonsdepreparation","$vf_c_script_cial_bonsdepreparation"+"raf_random="+Math.random()+"&");
}
function pf_cial_fin_chargement_pdf(){
	pf_cial_affiche_donnees_bonsdepreparation();
}
EOT;
$pf_cial_faccli_compta=<<<EOT
function pf_cial_facfou_compta() {
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt("$vf_c_script_cial_compta&quoi=compta_seule&","",pf_cial_facfou_compta_fin);
}
function pf_cial_facfou_decomptabilise() {
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt("$vf_c_script_cial_compta&quoi=enleve&","",pf_cial_facfou_compta_fin);
}
function pf_cial_facfou_compta_fin(stream) {
  alert(stream);
	window.location=document.location;
}
EOT;
$vl_tb_droits_trait_00322=_graal_requete_droits_fenetre("Trait_00322",$vl_e_uti_cleunik);
if ($vl_tb_droits_trait_00322[0]==true) {
	$pf_cial_change_numero=<<<EOT
function pf_cial_change_numero(){
	var nouveau_lib=prompt("$vl_c_bfl_245js",fa_value_get('tb_cial_code'));
	var vl_c_donnees="vf_c_action=changer_numero&";
  vl_c_donnees+="code="+fa_enc(nouveau_lib)+"&";
	fa_xmlhttprequest_txt("$vf_c_script_cial_bdope_action",vl_c_donnees,pf_cial_validation_fin);
}
EOT;
}
$tb_cial_int_complement=<<<EOT
	fa_cache_oui('bt_supprimer');
EOT;
$tb_cial_int=$tb_cial_int_06.$tb_cial_int_07.$tb_cial_int_08.$tb_cial_int_complement;
$pf_cial_transformations=$pf_cial_faccli_compta.$pf_cial_faccli_avofin.$pf_cial_faccli_avocli.$pf_cial_affiche_donnees_bonsdepreparation.$pf_cial_change_numero;

$boutons_modifier="oui";

$sql_req="SELECT f2.compta_etat,f1.montant_paye from _facfou_entetes f2 left join _echeancier f1 on f1.action_cleunik=f2.action_cleunik where f2.action_cleunik=$vl_action_cleunik;";
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$compta_etat=$row['compta_etat'];
$montant_paye=$row['montant_paye'];
_graal_libere_requete_bd($result);
switch ($compta_etat){
	case 1:
		$boutons_modifier="compta";
		break;
	case 8:
		if ($montant_paye==0){	
			$boutons_modifier="non";
		}
}
switch ($vf_c_action) {
  case 'modifier' :
  	switch ("$boutons_modifier"){
  		case "oui":
  			$vl_c_ini="fa_grise_oui('bt_cial_facfou_avofin');fa_grise_oui('bt_cial_facfou_avocli');fa_grise_oui('bt_cial_enregistrer');fa_grise_oui('bt_cial_facfou_compta');fa_grise_oui('bt_cial_facfou_compta_enleve');";
  			break;
  		case "non":
  			$vl_c_ini="fa_grise_non('bt_cial_facfou_compta_enleve');";
  			break;
  		case "compta":
  			$vl_c_ini="fa_grise_oui('bt_cial_facfou_avofin');fa_grise_oui('bt_cial_facfou_avocli');fa_grise_oui('bt_cial_enregistrer');fa_grise_non('bt_cial_facfou_compta');fa_grise_oui('bt_cial_facfou_compta_enleve');";
  			break;
  	}
    break; 
  case 'ajoutermodifier' :
    $vl_c_ini="fa_grise_oui('bt_cial_facfou_avofin');fa_grise_oui('bt_cial_facfou_avocli');fa_grise_oui('bt_cial_enregistrer');fa_grise_oui('bt_cial_facfou_compta');pf_cial_etat_fen('modifier');fa_grise_oui('bt_cial_facfou_compta_enleve');";
    break;
}
$vl_cial_etat_fen="fa_grise_non('bt_cial_facfou_avofin');fa_grise_non('bt_cial_facfou_avocli');fa_grise_non('bt_cial_facfou_compta');fa_grise_non('bt_cial_enregistrer');fa_grise_non('bt_cial_facfou_compta_enleve');";
?>
