<?php
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->selection_interlocuteur)){$selection_interlocuteur=$vl_c_xml->selection_interlocuteur->attributes();}else{$selection_interlocuteur='1';}
if (isset($vl_c_xml->vl_selint_nbcaracrech)){$vl_selint_nbcaracrech=$vl_c_xml->vl_selint_nbcaracrech->attributes();}else{$vl_selint_nbcaracrech='3';}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table;
const vf_c_script_int='_graal_rech_interlo_01.php';
const vf_c_script_bdope_fen="_graal_bdope_traitements_interlocuteurs_01.php";
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const lstn_grise = {
	willRebuild : function(event){}, 
	didRebuild  : function(event){fa_ro_non("bbj_tb_rechapproxima");fa_att_rem("_graal_fen_rech_interlocuteurs_01","cursor-wait");fa_grise_fenetre(event,"non");} 
}
function pf_aa_init() {
  fa_att_set("arbre_des_interlocuteurs",'context','pop_selections');
  fa_ael('bbj_ml_qui','ValueChange',po_change_menu);
	fa_gid("arbre_des_interlocuteurs").builder.addListener(lstn_grise);
  po_change_menu();
	var vl_c_recherche=fa_value_get("bbj_tb_rechapproxima");
	if ("$vl_selint_nbcaracrech"!='-1') {
		if (vl_c_recherche.length>=$vl_selint_nbcaracrech)
  	pf_approximatif();
	} else {
		pf_approximatif();
	}
	fa_focusdonne('bbj_tb_rechapproxima');
  switch ("$vl_c_p02") {
    case 'Fen_00046':
    case 'Fen_00511':
    case 'Fen_00514':
		
	case 'Fen_00429':
	case 'Fen_00418':
	case 'Fen_00416':
	case 'Fen_00414':
	case 'Fen_00410':
	case 'Fen_00514':
	case 'Fen_00086':
	case 'Fen_00087':
	case 'Fen_00420':
	case 'Fen_00733':

    case 'Fen_00413':
    case 'Fen_00430':
    case 'Fen_00417':
	case 'Fen_00411':
	case 'Fen_00421':
	case 'Fen_00081':
	case 'Fen_00080':
	case 'Fen_00349':
	case 'Fen_00079':
	case 'Fen_00088':
	
															
      fa_cache_non("bt_renvoyer_valeur");
      break;
 		case 'rectel':
      fa_cache_non("bt_renvoyer_valeur");
			fa_att_set('bt_renvoyer_valeur','oncommand','pf_etat_fen("renvoyer_rectel");')
      break;
		case 'bascule_courriel':
      fa_cache_non("bt_renvoyer_valeur");
			fa_att_set('bt_renvoyer_valeur','oncommand','pf_etat_fen("bascule_courriel");')
      break;			
  }
}
function pf_acteur_ouvre(vv_qui) {
  switch (vv_qui) {
    case 1:vl_c_arbre="arbre_des_interlocuteurs";break;
    case 2:vl_c_arbre="arbre_des_interlocuteurs_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  var param=fa_cell_get(vl_c_arbre,i,"typeacteur")+'&act_cleunik='+fa_cell_get(vl_c_arbre,i,"act_cleunik")+'&';
  fa_ouvre(vf_c_script_fen_acteur+param,1000,800);
}
function pf_alimente_table() {
  switch (fa_value_get("bbj_ml_qui")) {
    case "000000": case "110000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006":
      fa_cache_oui("portee");break;
    case "999999": case "888888":
      fa_cache_non("portee");break;
  }
	fa_grise_fenetre("","oui");
	fa_ro_oui("bbj_tb_rechapproxima");
	fa_att_set("_graal_fen_rech_interlocuteurs_01","cursor-wait");
  fa_das("arbre_des_interlocuteurs",vf_c_url_alimente_table);
}
function pf_approximatif() {
  switch (fa_value_get("bbj_ml_qui")) {
    case "000000": case "110000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006": case "999999":
      if ( fa_value_get("bbj_tb_rechapproxima") == "" ) {return;};
      var item=fa_gid("bbj_ml_actif").selectedItem;
      vf_c_url_alimente_table=vf_c_script_int+'?sortie=das&listecles=&vl_c_recherche='+fa_enc(fa_value_get("bbj_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bbj_ml_zone")+'&vl_c_type='+fa_value_get("bbj_ml_type")+'&vl_c_qui='+fa_value_get("bbj_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bbj_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&";
      break;
    case "888888":
      vf_c_url_alimente_table=vf_c_script_int+'?sortie=das&listecles=&vl_c_recherche='+fa_enc(fa_value_get("bbj_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bbj_ml_zone")+'&vl_c_type='+fa_value_get("bbj_ml_type")+'&vl_c_qui='+fa_value_get("bbj_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs=4&';
      break;
  }
  pf_alimente_table();
}
function pf_etat_fen(vv_quoi){
  switch (vv_quoi) {
    case 'sortir' :
      close();
      break;
    case 'renvoyer' :
      var rowIndex = fa_cui("arbre_des_interlocuteurs");if(rowIndex == -1){return;}
      var vl_int_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"int_cleunik");
      var vl_qui=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"qui");
      var vl_act_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"act_cleunik");
      var vl_raisonsoc=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"raisonsoc");
      var vl_typeacteur=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"typeacteur");
      window.opener.pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui,vl_act_cleunik,vl_raisonsoc,vl_typeacteur);
      pf_etat_fen('sortir');
      break;
    case 'renvoyer_rectel' :
      var rowIndex = fa_cui("arbre_des_interlocuteurs");if(rowIndex == -1){return;}
      var vl_int_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"int_cleunik");
      var vl_qui=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"qui");
      var vl_act_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"act_cleunik");
      var vl_raisonsoc=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"raisonsoc");
      var vl_typeacteur=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"typeacteur");
      window.opener.pf_rectel_ouvre_interlo_recup(vl_int_cleunik,vl_qui,vl_act_cleunik,vl_raisonsoc,vl_typeacteur);
      pf_etat_fen('sortir');
      break;
		case 'bascule_courriel' :
      var rowIndex = fa_cui("arbre_des_interlocuteurs");if(rowIndex == -1){return;}
      var vl_int_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"int_cleunik");
      var vl_qui=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"qui");
      var vl_act_cleunik=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"act_cleunik");
      var vl_raisonsoc=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"raisonsoc");
      var vl_typeacteur=fa_cell_get("arbre_des_interlocuteurs",rowIndex,"typeacteur");
			//alert("renvoi de l'interlocuteur");		// surtout ne pas supprimer cette alerte, même si en fait elle ne fonctionne pas. Y'a un truc qui m'échappe (13/05/2009) Evite l'exécution 2 fois la fonction qui suit !!!
      window.opener.pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui,vl_act_cleunik,vl_raisonsoc,vl_typeacteur);
      pf_etat_fen('sortir');
      break;
  }
}
function pf_interlo_ouvre(vv_qui) {
  switch (vv_qui) {
    case 1:vl_c_arbre="arbre_des_interlocuteurs";break;
    case 2:vl_c_arbre="arbre_des_interlocuteurs_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  vl_c_param="genreacteur="+fa_cell_get(vl_c_arbre,i,"typeacteur")+"&vl_e_interlo_cleunik="+fa_cell_get(vl_c_arbre,i,"int_cleunik");
  vl_c_param+='&vl_e_act_cleunik='+fa_cell_get(vl_c_arbre,i,"act_cleunik")+"&";
  fa_ouvre_interlo(vl_c_param);
}
function pf_onunload(){
	fa_brl("arbre_des_interlocuteurs",lstn_grise);	
}
function pf_sel_ligne(vv_qui) {}
]]></script>
END;
?>
