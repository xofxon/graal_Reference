<?php
$vl_c_brm_132_js=fa_recup_dico_js("brm_132");
$vl_c_brm_134_js=fa_recup_dico_js("brm_134");
$vl_c_brm_135_js=fa_recup_dico_js("brm_135");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_act_interlo_01.php";
const vf_c_script_bdope_fen_tel="_graal_bdope_act_interlo_tel_01.php";
const c_script_tableau_tel="_graal_fen_rech_tel_01.php?genreacteur=plusie&reftel=";

var vf_c_action;
function pf_aa_init(){
  pf_etat_fen("ajouter");
}
function pf_alimente_defaut(){
  fa_att_set('ra_actif_oui_interlo','selected', 'true');
  fa_gid("ml_civilites").selectedIndex=0;
	fa_value_set("rdg_defaut_interlo",2);
  fa_att_set('ra_choix_actif_tel_00_oui','selected', 'true');
  fa_value_set("rdg_portable_tel_00",2);
  fa_value_set("rdg_sms_tel_00",2);
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "ajouter":
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("ml_civilites");
      break;
    case "annuler":
      pf_etat_fen("ajouter");
      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
}
function pf_raz_fiche(){
  fa_value_set("tb_codealphanum15_interlo","")
  fa_value_set("tb_patronyme_interlo","")
  fa_value_set("tb_blocnotebrut_interlo","")
  fa_value_set("tb_prenom_interlo","")
	fa_value_set("tb_telformate_tel_00","$vl_c_tel");
	fa_att_set("tb_tel_00_verif_deja","label","$vl_c_brm_132_js");
	fa_att_set('tb_tel_00_verif_deja','tooltiptext',"$vl_c_brm_132_js");
	fa_att_rem("tb_tel_00_verif_deja","oncommand");
	fa_att_set("tb_tel_00_verif_deja","oncommand","pf_verifie_deja_tel_00();");
	fa_value_set("rdg_portable_tel_00",2);
  fa_value_set("rdg_sms_tel_00",2);
}
function pf_validation(vv_quoi) {
  var vl_c_donnees,vl_c_actif,vl_c_defaut;
  vl_c_actif=fa_value_get('rdg_actif_interlo');
  if (vl_c_actif=='') {vl_c_actif=1};
  vl_c_defaut=fa_value_get('rdg_defaut_interlo');
  if (vl_c_defaut=='') {vl_c_defaut=1};
  
  var vl_c_choix_actif;var vl_c_veuxpasdemail;var vl_c_valide;
  vl_c_choix_actif=fa_value_get('rdg_actif_courriel');
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  vl_c_veuxpasdemail=fa_value_get('rdg_veuxpasdemail_courriel');
  if (vl_c_veuxpasdemail=='') {vl_c_veuxpasdemail=3};
  vl_c_valide=fa_value_get('rdg_valide_courriel');
  if (vl_c_valide=='') {vl_c_valide=3};

  var vl_c_choix_actif_tel_00;
  vl_c_choix_actif_tel_00=fa_value_get('rdg_actif_tel_00');
  if (vl_c_choix_actif_tel_00=='') {vl_c_choix_actif_tel_00=1};

  var vl_c_choix_actif_tel_01;
  vl_c_choix_actif_tel_01=fa_value_get('rdg_actif_tel_01');
  if (vl_c_choix_actif_tel_01=='') {vl_c_choix_actif_tel_01=1};

  vl_c_donnees="";
  //  Données interlocuteur
  vl_c_donnees+="vf_c_action=ajouter_simple_courriel_tel_tel&";vf_c_action='ajout';
  vl_c_donnees+="vl_act_cleunik=$vl_e_act_cleunik&";
  vl_c_donnees+="vl_c_genreacteur=$vl_c_genreacteur&"
  vl_c_donnees+="vl_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15_interlo"))+"&";
  vl_c_donnees+="vl_patronyme="+fa_enc(fa_value_get("tb_patronyme_interlo"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut_interlo"))+"&";
  vl_c_donnees+="vl_prenom="+fa_enc(fa_value_get("tb_prenom_interlo"))+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_civilites"))+"&";
  vl_c_donnees+="vl_infodefaut="+fa_enc(vl_c_defaut)+"&";
  vl_c_donnees+="vl_actif="+fa_enc(vl_c_actif)+"&";
  vl_c_donnees+="vl_fonction="+fa_enc(fa_mlget("ml_fonctions"))+"&";
  //  Données téléphone 01
  vl_c_donnees+="vl_telformate_tel="+fa_enc(fa_value_get("tb_telformate_tel_00"))+"&";
  vl_c_donnees+="vl_blocnotebrut_tel="+fa_enc(fa_value_get("tb_blocnotebrut_tel_00"))+"&";
  vl_c_donnees+="vl_infofavori_tel="+fa_enc(vl_c_choix_actif_tel_00)+"&";
  vl_c_donnees+="vl_choix_cleunik_tel="+fa_enc(fa_mlget("ml_tel_00"))+"&";
  vl_c_donnees+="vl_prefixe_choix_cleunik_tel="+fa_enc(fa_mlget("ml_prefixe_tel_00"))+"&";
  vl_c_donnees+="vl_portable_tel="+fa_enc(fa_value_get('rdg_portable_tel_00'))+"&";
  vl_c_donnees+="vl_sms_tel="+fa_enc(fa_value_get('rdg_sms_tel_00'))+"&";
  fa_xhr_validation(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_validation_fin(stream){
  var vl_datas = stream;
  if (window.opener!=null) {
    switch ("$vl_c_p02") {
      case "Fen_00425":
        try {
          window.opener.pf_cree_interlo_ok(vl_datas);
          } catch(e){}
        break;
    }
  }
  pf_etat_fen("sortir");
}
function pf_voir_deja_reftel(vv_quoi){
	fa_ouvre(c_script_tableau_tel+fa_enc(fa_value_get(vv_quoi)));
}
function pf_verifie_deja_tel_00(){
	fa_grise_fenetre("","oui");
	var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_telformate="+fa_enc(fa_value_get('tb_telformate_tel_00'))+"&";
	vl_c_donnees+="vf_c_action=existe&"
	fa_xhr_txt(vf_c_script_bdope_fen_tel,vl_c_donnees,pf_verifie_deja_reftel_00_fin);
}
function pf_verifie_deja_reftel_00_fin(stream){
	switch (stream){
		case "0":
			fa_att_set("tb_tel_00_verif_deja","label","$vl_c_brm_134_js");
			fa_att_set('tb_tel_00_verif_deja','tooltiptext',"$vl_c_brm_134_js");
			fa_att_rem("tb_tel_00_verif_deja","oncommand");
			fa_att_set("tb_tel_00_verif_deja","oncommand","pf_verifie_deja_tel_00();");
			break;
		default:
			fa_att_set("tb_tel_00_verif_deja","label",stream+" $vl_c_brm_135_js");
			fa_att_set('tb_tel_00_verif_deja','tooltiptext',"$vl_c_brm_135_js");
			fa_att_rem("tb_tel_00_verif_deja","oncommand");
			fa_att_set("tb_tel_00_verif_deja","oncommand","pf_voir_deja_reftel('tb_telformate_tel_00');");
			break;
	}
	fa_grise_fenetre("","non");
}
]]></script>
END;
?>
