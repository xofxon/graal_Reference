<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_acteurs_01.php";
const c_script_verif="_graal_verifie_mail_02.php?";
var vf_c_action;
function pf_aa_init(){
  pf_etat_fen("ajouter");
}
function pf_alimente_defaut(){
  fa_att_set('ra_actif_oui_interlo','selected', 'true');
  fa_att_set('ra_defaut_non_interlo','selected', 'true');
  fa_gid("ml_civilites").selectedIndex=0;
  fa_value_set("tb_refweb_courriel","$vl_c_refweb");
  fa_value_set("tb_blocnotebrut_courriel","")
  fa_att_set('ra_choix_actif_oui_courriel','selected', 'true');
	fa_value_set("rdg_veuxpasdemail_courriel",3);
  fa_value_set("rdg_valide_courriel",3);
  fa_gid("ml_mail_00").selectedIndex=0;
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "ajouter":
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("tb_raisonsoc")
      break;
    case "annuler":
      pf_raz_fiche();
      pf_etat_fen("ajouter");
      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
}
function pf_raz_fiche(){
  fa_value_set("tb_codealphanum15_interlo","");
  fa_value_set("tb_patronyme_interlo","");
  fa_value_set("tb_blocnotebrut_interlo","");
  fa_value_set("tb_prenom_interlo","");

  fa_gid('ra_actif_oui_interlo').removeAttribute('selected');
  fa_gid('ra_defaut_oui_interlo').removeAttribute('selected');
  fa_gid('ra_actif_non_interlo').removeAttribute('selected');
  fa_gid('ra_defaut_non_interlo').removeAttribute('selected');
  
  
  fa_value_set("tb_refweb_courriel","");
  fa_value_set("tb_blocnotebrut_courriel","");
  fa_att_set('ra_choix_actif_oui_courriel','selected', 'false');
  fa_att_set('ra_choix_actif_non_courriel','selected', 'false');
	fa_value_set("tb_cr_verification","");
  pf_alimente_defaut();


}
function pf_validation(vv_quoi) {
  var vl_c_donnees,vl_c_actif,vl_c_defaut;
  vl_c_actif=fa_value_get('rdg_actif_interlo');
  if (vl_c_actif=='') {vl_c_actif=1};
  vl_c_defaut=fa_value_get('rdg_defaut_interlo');
  if (vl_c_defaut=='') {vl_c_defaut=1};
  
  var vl_c_choix_actif;var vl_c_veuxpasdemail;var vl_c_valide;
  vl_c_choix_actif=fa_gid('rdg_actif_courriel').value;
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  vl_c_veuxpasdemail=fa_gid('rdg_veuxpasdemail_courriel').value;
  if (vl_c_veuxpasdemail=='') {vl_c_veuxpasdemail=3};
  vl_c_valide=fa_gid('rdg_valide_courriel').value;
  if (vl_c_valide=='') {vl_c_valide=3};

  vl_c_donnees="";
  vl_c_donnees+="vl_act_cleunik=-1&vf_c_action=ajouter_simple_courriel&";vf_c_action='ajout';
  // Données acteur
  vl_c_donnees+="vl_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15"))+"&";
  vl_c_donnees+="vl_raisonsoc="+fa_enc(fa_value_get("tb_raisonsoc"))+"&";
  vl_c_donnees+="vl_nomcommercial="+fa_enc(fa_value_get("tb_nomcommercial"))+"&";
  vl_c_donnees+="vl_siret="+fa_enc(fa_value_get("tb_siret"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut_acteur"))+"&";
  vl_c_donnees+="vl_typeacteur="+fa_enc($vl_c_genreacteur)+"&";
  vl_c_donnees+="vl_mnemotechnique="+fa_enc(fa_value_get("tb_mnemotechnique"))+"&";
  vl_c_donnees+="vl_modegestion="+fa_enc(fa_mlget("ml_mode"))+"&";
  vl_c_donnees+="vl_devise="+fa_enc(fa_mlget("ml_devise"))+"&";
  vl_c_donnees+="vl_actif=1&";
  //  Données interlocuteur
  vl_c_donnees+="vl_codealphanum15_interlo="+fa_enc(fa_value_get("tb_codealphanum15_interlo"))+"&";
  vl_c_donnees+="vl_patronyme="+fa_enc(fa_value_get("tb_patronyme_interlo"))+"&";
  vl_c_donnees+="vl_blocnotebrut_interlo="+fa_enc(fa_value_get("tb_blocnotebrut_interlo"))+"&";
  vl_c_donnees+="vl_prenom="+fa_enc(fa_value_get("tb_prenom_interlo"))+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_civilites"))+"&";
  vl_c_donnees+="vl_infodefaut="+fa_enc(vl_c_defaut)+"&";
  vl_c_donnees+="vl_actif_interlo="+fa_enc(vl_c_actif)+"&";
  vl_c_donnees+="vl_fonction="+fa_enc(fa_mlget("ml_fonctions"))+"&";
  // Données courriel
  vl_c_donnees+="vl_refweb="+fa_enc(fa_gid("tb_refweb_courriel").value)+"&";
  vl_c_donnees+="vl_blocnotebrut_courriel="+fa_enc(fa_gid("tb_blocnotebrut_courriel").value)+"&";
  vl_c_donnees+="vl_infofavori="+fa_enc(vl_c_choix_actif)+"&";
  vl_c_donnees+="vl_choix_cleunik_courriel="+fa_enc(fa_mlget("ml_mail_00"))+"&";
  vl_c_donnees+="vl_veuxpasdemail="+fa_enc(vl_c_veuxpasdemail)+"&";
  vl_c_donnees+="vl_valide="+fa_enc(vl_c_valide)+"&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
  }
function pf_validation_fin(stream){
  var vl_datas = stream;
  if (window.opener!=null) {try {window.opener.pf_affiche_donnees_interlo();} catch(e){}}
  pf_etat_fen("sortir");
}
function pf_verifie(){
  var vl_t_mail=[];
  var vl_c_param="";
  vl_t_mail[0]=window.btoa(fa_value_get("tb_refweb_courriel"));
  vl_c_param+='vl_t_listemail='+fa_enc(fa_jsarray2php_00(vl_t_mail))+"&";
  vl_c_param+='vl_type_sortie=texte'+"&raf="+Math.random()+'vl_modif=non&';
	fa_grise_fenetre("","oui");
	fa_xmlhttprequest_txt(c_script_verif+vl_c_param,"",pf_verifie_fin);
}
function pf_verifie_fin(stream){
	var vl_c_sortie=stream;
	vl_c_sortie=vl_c_sortie.replace(/&nbsp;/g,' ');
	vl_c_sortie=vl_c_sortie.replace(/<br>/g,'\\r\\n');
	vl_c_sortie=vl_c_sortie.replace(/<BR>/g,'\\r\\n');
	fa_value_set("tb_cr_verification",vl_c_sortie);
	fa_grise_fenetre("","non");
}
]]></script>
END;
?>
