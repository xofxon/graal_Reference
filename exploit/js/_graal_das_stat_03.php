<?php
include("_graal_header_xml.inc.php");
include("_graal_fonctions_stats.php");
require_once ('calc/classes/OpenOfficeSpreadsheet.class.php');
require_once "sources_excel/class.writeexcel_workbook.inc.php";
require_once "sources_excel/class.writeexcel_worksheet.inc.php";
$date_deb=fa_recup_param('date_deb','20610123');
$date_fin=fa_recup_param('date_fin','19610123');
$ml_art_01=intval(fa_recup_param('ml_art_01',1));
$ml_art_02=intval(fa_recup_param('ml_art_02',2));
$ml_art_03=intval(fa_recup_param('ml_art_03',4));
$ml_art_04=intval(fa_recup_param('ml_art_04',4));
$ml_panier_acteurs_01=intval(fa_recup_param('ml_panier_acteurs_01',1));
$nombre=intval(fa_recup_param('nombre',0));
$genre=fa_recup_param('genre','');
$vl_e_panier=intval(fa_recup_param('panier',-1));
$vl_e_art_cleunik=intval(fa_recup_param('vl_e_art_cleunik',-1));
$sortie=fa_recup_param("sortie","das");
$sql_condition_panier_acteurs="";
stats_rectif_dates($ml_art_03);
define('EOL', "\r\n");
switch ($ml_art_02) {
  case 1:	//	Quantités
  case 2:	//	Valeur brute ((PU*Qté) (Offerts compris)
  case 3:	// 	Nombre de lignes
  case 5:	//	Volume (Quantité * Capacité)
  case 6:	//	Poids net (Quantité * Poids net)
		switch ($ml_art_03) {
		  case  1: $fic_cial="offcli";$coeff="1";break;
		  case  2: $fic_cial="cdecli";$coeff="1";break;
		  case  3: $fic_cial="livcli";$coeff="1";break;
		  case  4: $fic_cial="faccli";$coeff="1";break;
		  case  5: $fic_cial="demfou";$coeff="1";break;
		  case  6: $fic_cial="cdefou";$coeff="1";break;
		  case  7: $fic_cial="recfou";$coeff="1";break;
		  case  8: $fic_cial="facfou";$coeff="1";break;
		  case  9: $fic_cial="faccli";$coeff="1";break;
		  case 10: $fic_cial="avocli";$coeff="-1";break;
		  case 11: $fic_cial="retcli";$coeff="1";break;
		  case 12: $fic_cial="retfou";$coeff="1";break;
		}
		$uuid=_graal_requete_uuid();
		if ($vl_e_art_cleunik!=-1){
			$vl_conart=" and f1.art_cleunik in($vl_e_art_cleunik)";
		}
		if ($ml_panier_acteurs_01!=1){
			$vl_e_panier=$ml_panier_acteurs_01;
			include("_graal_req_panier_acteurs.php");
		  	if ($vl_act_cleunik=="") {$vl_act_cleunik=-3;}  //  Impossible
			$sql_condition_panier_acteurs = " and f3.act_cleunik IN($vl_act_cleunik)";
		}
		switch ($ml_art_03) {
		  case  1:
		  case  2:
		  case  3:
		  case  5:
		  case  6:
		  case  7:
		  case  8:
		  case  9:
		  case 10:
		  case 11:
		  case 12:
				switch ($ml_art_02) {
				  case 1: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 2: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*f1.pu*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 3: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,count(*) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 5: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.capacite) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				  case 6: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.poids_net) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				}
				$sql_req.=" from _".$fic_cial."_lignes f1,_".$fic_cial."_entetes f3,_".$fic_cial."_lignes_qte f5 $condimen_sion";
				$sql_req.=" where f1.commercial_cleunik=f3.commercial_cleunik and f1.commercial_ligne_cleunik=f5.commercial_ligne_cleunik and (f5.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart $where_dim_ension";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,f1.art_cleunik";
				break;
			case 4:
				switch ($ml_art_02) {
				  case 1: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 2: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*f1.pu*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 3: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,count(*) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 5: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.capacite) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				  case 6: $sql_req="insert into _temp_stat_01 select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.poids_net) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				}
				$sql_req.=" from _".$fic_cial."_lignes f1,_".$fic_cial."_entetes f3,_".$fic_cial."_lignes_qte f5 $condimen_sion";
				$sql_req.=" where f1.commercial_cleunik=f3.commercial_cleunik and f1.commercial_ligne_cleunik=f5.commercial_ligne_cleunik and (f5.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart $where_dim_ension";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,f1.art_cleunik";
				$sql_req.=" union all ";

				$fic_cial="avocli";$coeff="-1";

				switch ($ml_art_02) {
				  case 1: $sql_req.=" select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 2: $sql_req.=" select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*f1.pu*($coeff)) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 3: $sql_req.=" select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,count(*) as z01,NULL";$condimen_sion="";$where_dim_ension="";break;
				  case 5: $sql_req.=" select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.capacite) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				  case 6: $sql_req.=" select f1.art_cleunik,'$uuid',f5.dateheure_confirm as z03,sum(f5.qte*($coeff)*f6.poids_net) as z01,NULL";$condimen_sion=",_art_dimensions f6";$where_dim_ension=" and f6.art_cleunik=f1.art_cleunik";break;
				}
				$sql_req.=" from _".$fic_cial."_lignes f1,_".$fic_cial."_entetes f3,_".$fic_cial."_lignes_qte f5 $condimen_sion";
				$sql_req.=" where f1.commercial_cleunik=f3.commercial_cleunik and f1.commercial_ligne_cleunik=f5.commercial_ligne_cleunik and (f5.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart $where_dim_ension";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,f1.art_cleunik";
		}
		break;
  case 4:	//	Valeur nette (PU*Qté)- % Remises(ligne, bas)(Offerts exclus)
		switch ($ml_art_03) {
		  case  1: $fic_cial_01="_offcli_entetes";$fic_cial_02="_vue_offcli_ht_02";$fic_cial_03="_vue_offcli_ht_00_inter";break;
		  case  2: $fic_cial_01="_cdecli_entetes";$fic_cial_02="_vue_cdecli_ht_02";$fic_cial_03="_vue_cdecli_ht_00_inter";break;
		  case  3: $fic_cial_01="_livcli_entetes";$fic_cial_02="_vue_livcli_ht_02";$fic_cial_03="_vue_livcli_ht_00_inter";break;
		  case  4: $fic_cial_01="_faccli_entetes";$fic_cial_02="_vue_faccli_ht_02";$fic_cial_03="_vue_faccli_ht_00_inter";break; //  Factures et avoirs (-110116,-110117) regroupés
		  case  5: $fic_cial_01="_demfou_entetes";$fic_cial_02="_vue_demfou_ht_02";$fic_cial_03="_vue_demfou_ht_00_inter";break;
		  case  6: $fic_cial_01="_cdefou_entetes";$fic_cial_02="_vue_cdefou_ht_02";$fic_cial_03="_vue_cdefou_ht_00_inter";break;
		  case  7: $fic_cial_01="_recfou_entetes";$fic_cial_02="_vue_recfou_ht_02";$fic_cial_03="_vue_recfou_ht_00_inter";break;
		  case  8: $fic_cial_01="_facfou_entetes";$fic_cial_02="_vue_facfou_ht_02";$fic_cial_03="_vue_facfou_ht_00_inter";break;
		  case  9: $fic_cial_01="_faccli_entetes";$fic_cial_02="_vue_faccli_ht_02";$fic_cial_03="_vue_faccli_ht_00_inter";break;
		  case 10: $fic_cial_01="_avocli_entetes";$fic_cial_02="_vue_avocli_ht_02";$fic_cial_03="_vue_avocli_ht_00_inter";break;
		  case 11: $fic_cial_01="_retcli_entetes";$fic_cial_02="_vue_retcli_ht_02";$fic_cial_03="_vue_retcli_ht_00_inter";break;
		  case 12: $fic_cial_01="_retfou_entetes";$fic_cial_02="_vue_retfou_ht_02";$fic_cial_03="_vue_retfou_ht_00_inter";break;
		}
		if ($vl_e_art_cleunik!=-1){
			$vl_conart=" and a1.art_cleunik in($vl_e_art_cleunik)";
		}
		if ($ml_panier_acteurs_01!=1){
			$vl_e_panier=$ml_panier_acteurs_01;
			include("_graal_req_panier_acteurs.php");
		  	if ($vl_act_cleunik=="") {$vl_act_cleunik=-3;}  //  Impossible
			$sql_condition_panier_acteurs = " and a3.act_cleunik IN($vl_act_cleunik)";
		}
		switch ($ml_art_03) {
		  case  1:
		  case  2:
		  case  3:
		  case  5:
		  case  6:
		  case  7:
		  case  8:
		  case  9:
		  case 10:
		  case 11:
		  case 12:
				$uuid=_graal_requete_uuid();
				$sql_req="insert into _temp_stat_01 select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else round(sum(a1.htbrutremise*a3.remise_taux/100),2) end) else round(sum(round(a1.htbrutremise*100/a2.total_doc,2)*a3.remise_taux/100),2) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2) AS z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=2 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				$sql_req.=" union all ";
				$sql_req.=" select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else sum(a1.htbrutremise*a3.remise_taux/100) end) else sum(a3.remise_taux*a1.nombredelignes) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2) as z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=1 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				break;
		}
		switch ($ml_art_03) {
		  case  4:
				$uuid=_graal_requete_uuid();
				$sql_req="insert into _temp_stat_01 select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else round(sum(a1.htbrutremise*a3.remise_taux/100),2) end) else round(sum(round(a1.htbrutremise*100/a2.total_doc,2)*a3.remise_taux/100),2) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2) AS z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=2 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				$sql_req.=" union all ";
				$sql_req.=" select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else sum(a1.htbrutremise*a3.remise_taux/100) end) else sum(a3.remise_taux*a1.nombredelignes) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2) as z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=1 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				$sql_req.=" union all ";

				$fic_cial_01="_avocli_entetes";$fic_cial_02="_vue_avocli_ht_02";$fic_cial_03="_vue_avocli_ht_00_inter";$coeff="1";

				$sql_req.=" select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,(round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else round(sum(a1.htbrutremise*a3.remise_taux/100),2) end) else round(sum(round(a1.htbrutremise*100/a2.total_doc,2)*a3.remise_taux/100),2) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2)*-1) AS z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=2 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				$sql_req.=" union all ";
				$sql_req.=" select a1.art_cleunik,'$uuid',a1.dateheure_confirm as z03,(round(sum(a1.htbrutremise)+((case a3.remise_type when 1 then (case a3.remise_taux when 0 then 0 else sum(a1.htbrutremise*a3.remise_taux/100) end) else sum(a3.remise_taux*a1.nombredelignes) end) * (case a3.remise_natu when 1 then -(1) else 1 end)),2)*-1) as z01,NULL";
				$sql_req.=" from $fic_cial_02 a1 left join $fic_cial_03 a2 using(commercial_cleunik) left join $fic_cial_01 a3 using(commercial_cleunik) ";
				$sql_req.=" where a3.remise_genr=1 and (a1.dateheure_confirm between '$date_deb' and '$date_fin') $vl_conart";
				$sql_req.=$sql_condition_panier_acteurs;
				$sql_req.=" group by z03,a1.art_cleunik";
				break;

		}
		break;
}
$req_sortie_sql=$sql_req.EOL;
$vf_c_echo=_graal_exec_requete($sql_req);
//case 1: $sql_req="Select @rang:=@rang+1 AS z00,sum(f5.qte*($coeff)) as z01,f2.act_cleunik as z02,f2.codealphanum15 as z03,f2.raisonsoc as z04,f2.typeacteur as z05";break;
$sql_req="Select @rang:=@rang+1 AS z00,sum(a1.montant) AS z01";
switch ($ml_art_04) {
  case 1: $sql_req.=",DATE_FORMAT(a1.dateheure,GET_FORMAT(DATE,'EUR')) as z06,a1.dateheure as z07";break;
  case 2: $sql_req.=",concat(WEEK(a1.dateheure),'-',Year(a1.dateheure)) as z06,concat(year(a1.dateheure),'-',week(a1.dateheure)) as z07";break;
  case 3: $sql_req.=",DATE_FORMAT(a1.dateheure,'%m-%Y') as z06,DATE_FORMAT(a1.dateheure,'%Y-%m') as z07";break;
  case 4: $sql_req.=",concat(quarter(a1.dateheure),'-',Year(a1.dateheure)) as z06,concat(year(a1.dateheure),'-',quarter(a1.dateheure)) as z07";break;
  case 5: $sql_req.=",Year(a1.dateheure) as z06,Year(a1.dateheure) as z07";break;
  case 6: $sql_req.=",'période' as z06,'période' as z07";break;
}
$sql_req.=",f2.art_cleunik as z02,f2.code as z03,f2.description as z04";
$sql_req.=" from _temp_stat_01 a1 left join _article f2 on a1.cleunik_reference=f2.art_cleunik";
$sql_req.=" where a1.c_uuid='$uuid'";
if ($vl_e_art_cleunik!=-1){$sql_req.=" and f2.art_cleunik=$vl_e_art_cleunik";}
$sql_req.=" group by f2.art_cleunik,z06";
switch ($ml_art_01) {
  case 1: $sql_req.=" order by z01 desc";break;
  case 2: $sql_req.=" order by z01 asc";break;
	/*
	case 3:  // Sélection d'acteurs dans panier
    include("_graal_req_panier_acteurs.php");
    $sql_req.=" and f2.act_cleunik in($vl_act_cleunik)";
    $sql_req.=" order by z01 desc";
		break;
	*/
}
if ($nombre!=0) {$sql_req.=" limit $nombre;";}
/*
echo $sql_req;
die("aa");
*/
_graal_requete_bd("SET @rang=0;");
$req_sortie_sql.="SET @rang=0;".EOL;
$req_sortie_sql.=$sql_req.EOL;
switch ($sortie){
	case "sql":
		case "sql":
	    header('Content-type: text/plain; charset=utf-8');
	    header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
	    header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); // Date in the past
	    echo $req_sortie_sql;
	    break;
	case "das":
		$result = _graal_requete_bd($sql_req);
		$vl_e_nombre_types=mysql_num_rows($result);
		echo('<donnees>');
		if ($vl_e_nombre_types!=0) {
			while ($row = mysql_fetch_assoc($result)) {
				if ($vl_e_art_cleunik==-1){
					echo('<quoi ');
			   		echo(' z00="'.fa_ent_xml($row['z00']).'"');
			   		$z00_trie=fa_ent_xml($row['z00'])*1000;
					printf(' z00_tri="%011u"',$z00_trie);
					$z01_trie=fa_ent_xml($row['z01'])*1000;
					printf(' z01_tri="%011u"',$z01_trie);
				    echo(' z01="'.fa_ent_xml(number_format(round($row['z01'],2), 2, ',', ' ')).'"');
				    echo(' z02="'.fa_ent_xml($row['z02']).'"');
				    echo(' z03="'.fa_ent_xml($row['z03']).'"');
				    echo(' z04="'.fa_ent_xml($row['z04']).'"');
				    echo(' periode="'.fa_ent_xml($row['z06']).'"');
				    echo('/>');
				} else {
					echo('<quoi ');
				    echo(' z00="'.fa_ent_xml($row['z00']).'"');
				    $z00_trie=fa_ent_xml($row['z00'])*1000;
					printf(' z00_tri="%011u"',$z00_trie);
				    $z01_trie=fa_ent_xml($row['z01'])*1000;
						printf(' z01_tri="%011u"',$z01_trie);
				    echo(' z01="'.fa_ent_xml(number_format(round($row['z01'],2), 2, ',', ' ')).'"');
				    echo(' periode="'.fa_ent_xml($row['z06']).'"');
				    echo(' z03="'.fa_ent_xml($row['z07']).'"');
				    echo('/>');
				}
		  }
		} else {
		    echo('<quoi ');
		    echo(' z00="0"');
		    echo(' z01="0"');
				$z01_trie=0;
				printf(' z01_tri="%011u"',$z01_trie);
		    echo(' z02="pas de données"');
		    echo(' z03="pas de données"');
		    echo(' z04="pas de données"');
		     echo('/>');
		}
		echo('</donnees>');
		_graal_libere_requete_bd($result);
		$sql_req="delete from _temp_stat_01 where c_uuid='$uuid';";
		$vf_c_echo=_graal_exec_requete($sql_req);
		//echo $sql_req;
		break;
	case "xls":
		$vl_c_nom_fichier_xls="stat_03.xls";
		$fname = tempnam("mail", "$vl_c_nom_fichier_xls");
		$workbook =new writeexcel_workbook($fname);
		$worksheet =& $workbook->addworksheet('Exportation XsOFt-Graal');
		$result = _graal_requete_bd($sql_req);
		$nfields = mysql_num_fields($result);
		$vl_e_noligne=1;
		for ($i=0; $i<$nfields; $i++)
		{
		    $fieldname = mysql_field_name($result, $i);
		    $worksheet->write($vl_e_noligne, $i, "$fieldname");
		}
		//  Lecture des résultats de la requête

		while ($line = mysql_fetch_array($result, MYSQL_ASSOC))
		{
		  $j = 0;
		  $vl_e_noligne++;
		  foreach ($line as $field)
		  {
		      $worksheet->write($vl_e_noligne, $j, "$field");
		      $j++;
		  }
		}
		_graal_libere_requete_bd($result);
		$sql_req="delete from _temp_stat_01 where c_uuid='$uuid';";
		$vf_c_echo=_graal_exec_requete($sql_req);
		$workbook->close();
		header("Content-Type: application/x-msexcel; name=\"$vl_c_nom_fichier_xls\"");
		header("Content-Disposition: inline; filename=\"$vl_c_nom_fichier_xls\"");
		$fh=fopen($fname, "rb");
		fpassthru($fh);
		break;
}



_graal_ferme_connexion();
?>
