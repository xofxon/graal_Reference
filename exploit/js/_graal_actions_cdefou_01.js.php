<?php
$vl_c_bvk_106_js=fa_recup_dico_js("bvk_106");
$vl_c_bvk_108_js=fa_recup_dico_js("bvk_108");
$vl_c_bvk_109_js=fa_recup_dico_js("bvk_109");
$vl_c_bvk_110_js=fa_recup_dico_js("bvk_110");
switch ($vl_c_destination){
	case "relfou":	//	Relance fournisseur
$param_bp00="vl_commercial_cleunik=-2&vl_genre_adresse=1&vl_c_fichier_seul=oui&vl_e_action_cleunik=";
$pf_validation=<<<EOT
function pf_validation(){
	var nombre=vf_t_panier.length;
	if (nombre==0){alert("$vl_c_bvk_108_js");return;}
	if (!confirm("$vl_c_bvk_106_js")){return;}
	//fa_cache_oui("bt_enregistrer");
	//fa_cache_non("pm_evolution_01");
	//fa_grise_fenetre("","oui");
	var vl_adresse="";
	var vl_complement_01="";
	var vl_complement_02="";
	if (fa_value_get("rdg_modif_date_livraison")==1){
		vl_complement_01="&vl_nouvelle_date_liv="+fa_enc(fa_value_get("dp_dat_liv"));
	}
	vl_adresse="&vf_c_action=cdefou->relfou"+vl_complement_01+"&vl_t_listecles="+fa_jsarray2php_00(vf_t_panier)+"&";
	fa_xmlhttprequest_txt("_graal_bdope_doc_cial_01.php?",vl_adresse,pf_validation_fin);
    
	fa_grise_fenetre("","non");	
}
function pf_validation_fin(stream){
	alert(stream);
}
EOT;
		break;
	
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_action_lignes_doc';
const vf_c_script_das_action='_graal_das_art_lignes_cdefou_01.php?vl_c_particulier=4&';
const vf_c_script_das_action_panier='_graal_das_art_lignes_cdefou_01.php?vl_c_particulier=5&var=vs_tempo_panier_action_lignes_doc&limit=-1&';
var vf_t_panier=[],vf_t_livcli_retour=[],vf_t_faccli_retour=[],vf_t_doc_faccli_retour=[],vf_t_doc_livcli_retour=[];
const vf_c_script_fen_action='_graal_fen_actions_02.php?';
var vf_e_action_cleunik=-1,vf_e_choix_cleunik;
const lstn_grise = { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("non");} 
};
function pf_aa_init_bfp(vv_choix_date){
	fa_badl("$arbre_cdefou",lstn_grise);
	fa_att_set("$arbre_cdefou","context","pop_selections");
	fa_att_set("$arbre_cdefou_panier","context","pop_panier");
	  fa05_sel_date(vv_choix_date,'bfp_tb_deb','bfp_tb_fin');
	  fa_att_set("ml_genre_action_rech","oncommand","pf_approximatif_bfp()");
	  fa_gid("bfp_cp01").selectedIndex=12;
	  fa_grise_oui('ml_genre_action_rech');
	  pf_approximatif_bfp();
}
function pf_action_ouvre(vv_qui){
  var rowIndex = fa_cui(vv_qui);if(rowIndex == -1){return;}
  var vl_e_action_cleunik=fa_cell_get(vv_qui,rowIndex,"tc_cdefou_action_cleunik");
  vl_c_genre="cdefou";
  vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_e_action_cleunik)+"&vf_c_action=modifier&genreaction="+fa_enc(vl_c_genre)+"&";
  fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
}
function pf_approximatif_bfp() {
	var vl_c_param=vf_c_script_das_action+"raf_random="+Math.random()+"&vl_c_dateheuredebut="+fa_enc(fa_date_formate(fa_value_get("bfp_tb_deb"),"AAAAMMJJ"))+"&vl_c_dateheurefin="+fa_enc(fa_date_formate(fa_value_get("bfp_tb_fin"),"AAAAMMJJ"))+"&statut="+fa_enc(fa_mlget("ml_statut_action_cial_rech"))+"&limit="+fa_value_get("bfp_tb_limit")+"&";
	vl_c_param+='&vl_operat_statut='+fa_mlget("bfp_ml_operat_statut","value");
	vl_c_param+='&vl_type_recherche='+fa_mlget("bfp_ml_type_recherche","value");
	vl_c_param+='&vl_c_recherche='+fa_enc(fa_value_get("bfp_tb_rechapproxima"));
	fa_grise_fenetre("oui");
	fa_das("$arbre_cdefou",vl_c_param);
}
function pf_dblclick_arbre_actions_bem(){
  if($vl_b_modif==false) {return};
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
  vf_e_choix_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_choix_cleunik");
  pf_etat_fen_bem("modifier");
}
function pf_etat_fen_bem(vv_quoi){
  var vl_c_donnees="";
  switch(vv_quoi) {
    case "sortir":
      window.close();
      break;   
  }
}


function pf_onunload(){
	fa_brl("$arbre_cdefou",lstn_grise);
}
function pf_ouvre_acteur(vv_qui,vv_quoi) {
  vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_livcli&";
  fa_ouvre(c_script_recherche_acteurs+vl_c_param+"vl_e_genreacteur="+vv_qui+"&",800,600);
}
function pf_recup_requete(vv_export) {
	fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_recup_requete_suite,vv_export);
}
function pf_recup_requete_suite(stream,vv_export){
	var vl_c_nom_fichier_xls=prompt("Nom du fichier","Relances fournisseurs.xls");
	fa_ouvre(vf_c_script_das_action_panier+'&vl_c_lesquelles=selection&sortie=xls&raf_random='+Math.random()+"&vl_c_nom_fichier_xls="+vl_c_nom_fichier_xls+"&");
}
function pf_recup_requete_fin(stream,vv_export){
	fa_exporte_requete_vers_xls(stream);
}
function pf_panier_ajoute() {
  var vl_t_action=pf_tab_actions();
  if (vl_t_action.length==0) {return;}
  var vl_t_panier=[];
  vl_t_panier=vf_t_panier;
  vf_t_panier=vl_t_panier.concat(vl_t_action);
  fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
}
function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("$arbre_cdefou_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_action=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_action[i]=fa_cell_get("$arbre_cdefou_panier",vl_t_tableau[i],"tc_cdefou_commercial_ligne_cleunik");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier.length;i++) {
      if (vl_t_action.indexOf(vf_t_panier[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier[i];
      }  
    }
    vf_t_panier=vl_t_panier
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
  }
}
function pf_tab_actions(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_action=[];
  vl_t_tableau=fa_lignes_selectionnees("$arbre_cdefou");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_action[i]=fa_cell_get("$arbre_cdefou",vl_t_tableau[i],"tc_cdefou_commercial_ligne_cleunik");
    }
  }
  return vl_t_action;
} 
function pf_tableau_donnees_fin(stream) {
  fa_das("$arbre_cdefou_panier",vf_c_script_das_action_panier+'vl_c_lesquelles=selection&raf_random='+Math.random())
}
function pf_sel_ligne_bem()  {
  vf_e_action_cleunik=-1;
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
	vf_e_choix_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_choix_cleunik");
}
$pf_validation
function pf_voir_action(){
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
	var vl_c_donnees="vf_e_action_cleunik="+fa_enc(fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik"))+"&vf_c_action=modifier&genreaction=jenesaispas&";
	fa_att_set("graal_iframe_visu_action","src",vf_c_script_fen_action+vl_c_donnees);
}
]]></script>
END;
?>
