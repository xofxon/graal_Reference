<?php
include("_graal_var_portee.php");
$vl_c_dico_00104_js=fa_recup_dico_js("dico_00104");
switch ($_graal_typedoc) {
  case 2:
    $vl_c_affiche_suite="pf_affiche_donnees_criteres();pf_affiche_iframe_commentaires();pf_affiche_donnees_connexions();pf_affiche_donnees_ged();";
$vl_c_affiche_suite=<<<EOT
	if (vl_c_nombre_criteres!="") {pf_affiche_donnees_criteres();}
  if (vl_c_nombre_rattachements!="") {pf_affiche_donnees_ged();}
  if (vl_c_nombre_connexions!="") {pf_affiche_donnees_connexions();}
  if (vl_c_nombre_commentaires!="") {pf_affiche_iframe_commentaires();}
EOT;
	$vl_c_ajout_suite="fa_cache_non('hb_modeles');fa_focusdonne('hb_modeles');";
    //  Il faudra poser la question : pourquoi ce type de syntaxe me fait perdre le https ?

    $src_ajout="data:text/html;base64,".base64_encode('<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"<title>Note</title></head><body></body></html>');
    $src_ajout="_graal_page_blanche_01.php";
    $vl_c_raz_suite="fa_cache_oui('hb_modeles');";
    $vl_c_verif_proprio=<<<EOT
    if ((vf_e_droits_proprio & 4) == 4) {fa_grise_non("bt_modifier");}
    if ((vf_e_droits_proprio & 8) == 8) {fa_grise_non("bt_supprimer");}
    //alert($_graal_typedoc);
EOT;
    break;
  case 101:
  case 102:
  case 111:
  case 112:
  case 121:
  case 122:
  case 123:
  case 124:
  case 131:
  case 132:
  case 141:
  case 142:
  case 151:
  case 152:
  case 161:
  case 162:
  case 171:
  case 172:
  case 181:
  case 182:
  case 191:
  case 192:

  case 900:
  case 901:
	case 902:
case 903:
	case 904:
    $vl_c_affiche_suite="";
    $vl_c_ajout_suite="fa_focusdonne('tb_titre');";
    $vl_c_raz_suite="";
    $vl_c_verif_proprio="fa_grise_non('bt_modifier')";
    break;
  case 10:
    $vl_c_affiche_suite="";
    $src_ajout="data:text/html;base64,".base64_encode('<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"<title>Note</title></head><body></body></html>');
    $src_ajout="_graal_page_blanche_01.php";
    $vl_c_ajout_suite="fa_focusdonne('tb_titre');";
    $vl_c_raz_suite=<<<EOT
		fa_value_set("tb_origine","2");
EOT;
$vl_c_verif_proprio=<<<EOT
    if ((vf_e_droits_proprio & 4) == 4) {fa_grise_non("bt_modifier");}
    if ((vf_e_droits_proprio & 8) == 8) {fa_grise_non("bt_supprimer");}
    //alert($_graal_typedoc);
EOT;
		break;
  case 11:
    $vl_c_affiche_suite="";
    $src_ajout="data:text/html;base64,".base64_encode('<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"<title>Note</title></head><body></body></html>');
    $src_ajout="_graal_page_blanche_01.php";
    $vl_c_ajout_suite="fa_focusdonne('tb_titre');";
    $vl_c_raz_suite="";
$vl_c_verif_proprio=<<<EOT
    if ((vf_e_droits_proprio & 4) == 4) {fa_grise_non("bt_modifier");}
    if ((vf_e_droits_proprio & 8) == 8) {fa_grise_non("bt_supprimer");}
    //alert($_graal_typedoc);
EOT;
    break;
}
$param_generaux_graal_169=fa_recup_session('vs_param_generaux_graal_169',0); //  Adresse pour désinscriptions
$param_generaux_graal_198=fa_recup_session('vs_param_generaux_graal_198',0); //  Adresse pour sondage
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
********************************************************************************************************************************
**********  Fenêtre de gestion des notes                  (_graal_fen_notes_01.php)                              ********
**********  Fenêtre de gestion des modeles de courriels   (_gral_fen_modeles_courriels_01.php)                  ********
*********** Fenêtre de gestion des modeles de notes      (_gral_fen_modeles_notes_01.php)                  ********
********************************************************************************************************************************
*/
var vf_e_doc_cleunik;
var vf_c_action;
var vf_e_droits_proprio=0;
var vf_c_url_alimente_table='_graal_das_note_01.php?';
var vf_c_script_bdope_doc="_graal_bdope_note_01.php?genre=$vl_c_genre&portee_cleunik=$vl_e_portee_cleunik&";
var vf_c_script_bdope_doc_liaison="_graal_bdope_note_01.php?";
var vf_c_script_edite="_graal_xml_doc_01.php";
const vf_c_script_edite_note='_graal_bdope_note_03.php?doc_cleunik=';
const vf_c_script_critere_ged_entreprise='_graal_das_ged_criteres_entreprise.php?';
const vf_c_script_critere_ged_lesmiens='_graal_das_ged_criteres_lesmiens.php?';
const vf_c_script_critere_ged_lesautres='_graal_das_ged_criteres_lesautres.php?';
const vf_c_script_critere_ged_tous='_graal_das_ged_criteres_tous.php?';
const vf_c_fen_criteres='_graal_fen_ged_criteres.php?';
const vf_c_script_favoris='_graal_bdope_ged_favoris_01.php?';
const c_fen_commentaires='_graal_fen_documents_commentaires_01.php?genreacteur=tousss&genredoc=not&';
const c_iframe_commentaires_menu='_graal_fen_iframe_documents_commentaires_01.php?vl_doc_cleunik=';
const c_fen_selection_doc='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=docs&retour=oui&';
const c_fen_selection_notes='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=notes&retour=oui&';
const c_fen_selection_pseudodocs='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=pseudodocs&retour=oui&';
const c_script_connecte="_graal_bdope_doc_connexions.php?";
const c_das_connecte='_graal_rech_ged_03.php?sortie=das&vl_e_doc_cleunik_pere=';
const c_script_liens="_graal_fen_pseudodocs_01.php?genre=$vl_c_genre&quelsdocs=unlien&";
const c_script_notes="_graal_fen_note_01.php?genre=$vl_c_genre&quelsdocs=unenot_acteur&";
const vf_c_script_ged='_graal_rech_ged_01.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=liaisons&';
const c_script_fen_visu_acteurs='_graal_fen_rech_acteurs.php?vl_c_origine=selection&vl_c_proc_retour=pf_ouvre_acteur_recup&';
const c_script_choix_interlo="_graal_fen_rech_interlocuteurs_01.php?p02=$vl_c_id_fenetre&";
const c_script_choix_actions="_graal_fen_rech_actions_01.php?p02=$vl_c_id_fenetre&genreaction=toutes&";
const c_script_choix_article="_graal_fen_rech_articles_01.php?p02=$vl_c_id_fenetre&";
const vf_c_script_fen_action='_graal_fen_actions_02.php?';
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?act_cleunik=";
const c_fen_selection_dossiers='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=dossiers&retour=oui&';
const c_bdope_dossiers='_graal_bdope_note_01.php?vf_c_action=insere_dans_dossier&type_insertion_dossier=note&vf_e_doc_cleunik=';
const lstn_grise= {
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");}
};

function pf_action(vv_quoi){
  switch (vv_quoi) {
    case 'droits' :
      fa_ouvre("_graal_fen_droits_01.php?vl_c_genredoc=Notes&vl_e_doc_cleunik="+vf_e_doc_cleunik,400,400)
      break;
    case 'favoris_ajout':
      vl_c_param="vf_c_action=ajouter&vf_c_quoi=1&vl_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
      fa_xmlhttprequest_txt(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'favoris_supprimer':
      vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&vl_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
      fa_xmlhttprequest_txt(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'dossier_ajouter':
    	fa_ouvre(c_fen_selection_dossiers,1000,800);
      break;
  }
}
function pf_action_fin_01(vv_message) {
  alert(vv_message)
}
function pf_affiche_commentaire(vl_commentaire_cleunik) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+='vf_e_doc_cleunik='+vf_e_doc_cleunik+'&';
  vl_c_param+='vf_e_commentaire_cleunik='+vl_commentaire_cleunik+'&';
  vl_c_param+='genreacteur=favori&';
  fa_ouvre(c_fen_commentaires+vl_c_param,800,650);
}
function pf_affiche_datas(stream){
  var vl_c_datas;
  pf_raz_fiche()
  vl_c_datas = stream;
  vf_e_doc_cleunik=fa_xml_get(vl_c_datas,'doc_cleunik');
  fa_att_set("content","src",vf_c_script_edite_note+vf_e_doc_cleunik+'&raf_random='+Math.random()+'&');
  fa_value_set('tb_titre',fa_xml_get(vl_c_datas,'titre'));
  fa_value_set('tb_descriptif_sommaire',fa_xml_get(vl_c_datas,'descriptif_sommaire'));
  fa_value_set("tb_origine",fa_xml_get(vl_c_datas,'origine'));
  fa_value_set("tb_dateheurecreation",fa_xml_get(vl_c_datas,'dateheurecreation'));
  fa_value_set("tb_dateheuremodif",fa_xml_get(vl_c_datas,'dateheuremodif'));

  vf_e_nombre=fa_xml_get(vl_c_datas,'nombre');
  vf_c_typedoc=fa_xml_get(vl_c_datas,'typedoc');
  fa_cache_non("tab_appartenance");
  var vl_c_nombre_criteres=fa_xml_get(vl_c_datas,'nombre_criteres');
  var vl_c_nombre_commentaires=fa_xml_get(vl_c_datas,'nombre_commentaires');
  var vl_c_nombre_connexions=fa_xml_get(vl_c_datas,'nombre_connexions');
  var vl_c_nombre_rattachements=fa_xml_get(vl_c_datas,'nombre_rattachements');
	fa_att_set("tab_criteres","label","$vl_c_baf_137"+vl_c_nombre_criteres);
	fa_att_set("tab_commentaires","label","$vl_c_baf_139"+vl_c_nombre_commentaires);
	fa_att_set("tab_connexions","label","$vl_c_baf_145"+vl_c_nombre_connexions);
	fa_att_set("tab_appartenance","label","$vl_c_baf_170"+vl_c_nombre_rattachements);
  if (vf_e_nombre!=1) {
  	fa_est_grise('bt_supprimer');
    fa_att_set("bt_supprimer","oncommand","if(fa_est_grise('bt_supprimer')==true){return};pf_validation('detacher');")
  } else {
    fa_att_set("bt_supprimer","label","$vl_c_dico_00004");
    fa_att_set("bt_supprimer","tooltiptext","$vl_c_dico_00004 Ctrl+Shift+F4")
    fa_att_set("bt_supprimer","oncommand","if(fa_est_grise('bt_supprimer')==true){return};pf_validation('supprimer');")
  }
  $vl_c_affiche_suite
}
function pf_affiche_donnees_connexions() {
  var vl_c_param=c_das_connecte+vf_e_doc_cleunik+'&raf_random='+Math.random()+'&';
  fa_das("arbre_des_connexions",vl_c_param);
}
function pf_affiche_donnees_criteres(){
  pf_affiche_donnees_criteres_entreprise();
  pf_affiche_donnees_criteres_lesautres();
  pf_affiche_donnees_criteres_lesmiens();
  pf_affiche_donnees_criteres_tous();
}
function pf_affiche_donnees_criteres_entreprise() {
  var vl_c_param=vf_c_script_critere_ged_entreprise+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_ged_entreprise",vl_c_param);
}
function pf_affiche_donnees_criteres_lesautres() {
  var vl_c_param=vf_c_script_critere_ged_lesautres+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_lesautres",vl_c_param);
}
function pf_affiche_donnees_criteres_lesmiens() {
  var vl_c_param=vf_c_script_critere_ged_lesmiens+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_lesmiens",vl_c_param);
}
function pf_affiche_donnees_criteres_tous() {
  var vl_c_param=vf_c_script_critere_ged_tous+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_tous",vl_c_param);
}
function pf_affiche_donnees_ged() {
  var vl_c_param=vf_c_script_ged+'vl_e_portee_cleunik='+vf_e_doc_cleunik+'&raf_random='+Math.random()+'&';
  fa_das("arbre_des_ged",vl_c_param);
}
function pf_affiche_iframe_commentaires() {
  fa_att_set("if_commentaires_doc","src",c_iframe_commentaires_menu+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&");
}
function pf_ajoute_liaison(vv_qui){
	var vl_c_param='&raf_random='+Math.random()+'&';
	switch (vv_qui){
		case "acteur":
			vl_c_param+="vl_e_genreacteur=tousss&";
			fa_ouvre(c_script_fen_visu_acteurs+vl_c_param,800,650);
			break;
		case "interlocuteur":
			fa_ouvre(c_script_choix_interlo+"genreacteur=tousss&",800,600);
			break;
		case "article":
			fa_ouvre(c_script_choix_article+"genreacteur=tousss&",800,600);
			break;
		case "action":
			fa_ouvre(c_script_choix_actions+vl_c_param,1000,800);
			break;
	}
}
function pf_alimente_defaut(){}
function pf_alimente_table(){
  fa_das("arbre_des_notes",vf_c_url_alimente_table+"&raf="+Math.random());
}
function pf_cache_tab(){
  var vl_tab=fa_gid("vb_tableau");
  if(vl_tab.hidden == true){vl_tab.hidden=false;}else {vl_tab.hidden=true;}
}
function pf_connecte(vv_quoi_01){
  switch (vv_quoi_01) {
    case 'doc':
      vf_c_retour="connexion";
      fa_ouvre(c_fen_selection_doc,1000,800);
      break;
		case 'note':
      vf_c_retour="connexion";
      fa_ouvre(c_fen_selection_notes,1000,800);
      break;
		case 'pseudodocs':
      vf_c_retour="connexion";
      fa_ouvre(c_fen_selection_pseudodocs,1000,800);
      break;
  }
}
function pf_deconnecte(vv_quoi_01){
  switch (vv_quoi_01) {
    case 'doc':
		case 'note':
		case 'pseudodocs':
      var rowIndex=fa_cui("arbre_des_connexions");if(rowIndex == -1){return;}
      if (confirm("Confirmez-vous la suppression de cette connexion ?")==false) {return;}
      var s ="vf_c_action=deconnecter&vl_e_doc_cleunik_gauche="+fa_enc(vf_e_doc_cleunik)+"&vl_e_doc_cleunik_droite="+fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_doc_cleunik");
      fa_xmlhttprequest_txt(c_script_connecte,s,pf_affiche_donnees_connexions);
      break;
  }
}
function pf_duplication() {
	fa_value_set("tb_titre",prompt("Nouveau titre",fa_value_get("tb_titre")));
	vf_e_doc_cleunik=0;
	pf_validation("enregistrer");
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
	   fa_badl("arbre_des_notes",lstn_grise);
       vf_c_url_alimente_table+='lesquels='+fa_att_get("bt_actualiser","_graal_lesquels");
       vf_c_url_alimente_table+="&vf_e_typedoc=$_graal_typedoc";
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       pf_raz_fiche();
       fa_grise_groupe_oui('broadcaster_01');
       switch ("$vl_e_doc_cleunik") {
        case "A" : pf_alimente_table();break;
        case "-1":pf_etat_fen("ajouter");break;
        default:
          vf_e_doc_cleunik=$vl_e_doc_cleunik;
          fa_grise_oui("bt_ajouter");
          fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik=$vl_e_doc_cleunik&",pf_affiche_datas);
       }
       break;
    case "selectionner":
      pf_verif_acces();
      break;
    case "selectionner_suite":
      vf_c_action="selectionner"
      fa_grise_groupe_oui('broadcaster_01');
      $vl_c_verif_proprio
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
	  if (vf_e_nombre!=1) {
  		fa_grise_oui('bt_supprimer');
    	fa_att_set("bt_supprimer","oncommand","if(fa_est_grise('bt_supprimer')==true){return};pf_validation('detacher');")
  		} else {
  		fa_grise_non("bt_supprimer");
    	fa_att_set("bt_supprimer","label","$vl_c_dico_00004");
    	fa_att_set("bt_supprimer","tooltiptext","$vl_c_dico_00004 Ctrl+Shift+F4")
    	fa_att_set("bt_supprimer","oncommand","if(fa_est_grise('bt_supprimer')==true){return};pf_validation('supprimer');")
  		}
      if (vf_e_doc_cleunik <0) {fa_grise_oui("bt_supprimer");}
      break;
     case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      if ((vf_e_droits_proprio & 1) == 1) {fa_grise_non("menu_gestion_des_droits");} else {fa_grise_oui("menu_gestion_des_droits");}
/*
 * On autorise l'édition de l'éditeur
*/
		  fa_gid("content").contentDocument.designMode="on";
      fa_focusdonne('content');
      break;
    case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_att_set("content","onload","fa_gid('content').contentDocument.designMode='on'");
      fa_att_set("content","src","$src_ajout");
      fa_grise_groupe_non('broadcaster_01');
      fa_cache_oui("tab_criteres");fa_cache_oui("tab_commentaires");fa_cache_oui("tab_connexions");
      fa_sel_index("tab_infogene",0)
      fa_grise_oui("menu_02");
      $vl_c_ajout_suite

      break;
    case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      fa_cache_non("tab_criteres");fa_cache_non("tab_commentaires");fa_cache_non("tab_connexions");
      pf_raz_fiche();
      fa_grise_groupe_oui('broadcaster_01');
      fa_focusdonne("tb_descriptif_sommaire");
      switch ("$vl_e_doc_cleunik") {
        case "A" : pf_alimente_table();break;
        case "-1":pf_etat_fen("ajouter");break;
        default:
          vf_e_doc_cleunik=$vl_e_doc_cleunik;
          fa_grise_oui("bt_ajouter");
          fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik=$vl_e_doc_cleunik&",pf_affiche_datas);
       }
      break;
     case "sortir":
      window.close();
     break;
 default:
 break;
}
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (window.opener!=null) {
  	try {
			window.opener.pf_affiche_donnees_ged();
		} catch(e) {
			//	On vient d'ailleurs
		}
	}
  if (vl_datas.substring(0,3)!="-1-") {
    switch (vf_c_action) {
      case 'ajouter':
      pf_alimente_table();
      	switch ("$_graal_typedoc") {
          case "2":
          case "10":
          case "11":
            vf_c_action="modifier";
            vf_e_doc_cleunik=vl_datas;
            fa_cache_non("tab_criteres");fa_cache_non("tab_commentaires");fa_cache_non("tab_connexions");
            fa_grise_non("menu_02");
          	break;
          case "101":
          case "102":
          case "111":
          case "112":
          case "121":
          case "122":
          case "131":
          case "132":
          case "141":
          case "142":
          case "151":
          case "152":
          case "123":
          case "124":
          case "161":
          case "162":
          case "171":
          case "172":
          case "181":
          case "182":
          case "191":
          case "192":
		  case "900":
		  case "901":
		  case "902":
		  case "903":
		  case "904":
            pf_etat_fen('annuler');
			fa_grise_fenetre("","non");
            return;
            break;
        }
        break;
      case 'modifier':
        break;
       case 'supprimer':
        pf_etat_fen('annuler');
        pf_etat_fen("sortir");
        break;
      default :
        alert('gestion mal gérée');
    }
  }
  else {
    fa_erreur(vl_datas)
  }
	fa_grise_fenetre("","non");
}
function pf_insere_desinscription(){
  var url = "$param_generaux_graal_169";
  if((url!=null) && (url!="") && (url!="http://")){
  var e = fa_gid("content");
    var range = e.contentWindow.getSelection().getRangeAt(0);
    var container = range.startContainer;
    var contenu=container.innerHTML;
    if (contenu==undefined){
    	contenu=e.contentWindow.getSelection();
    }
    var desinscription=e.contentWindow.document.createElement("a");
  desinscription.setAttribute("href", url);
  desinscription.innerHTML=contenu;
  insertNodeAtSelection(e.contentWindow, desinscription);
  }

}
function pf_insere_sondage(){
  var url = "$param_generaux_graal_198";
  if((url!=null) && (url!="") && (url!="http://")){
  var e = fa_gid("content");
    var range = e.contentWindow.getSelection().getRangeAt(0);
    var container = range.startContainer;
    var contenu=container.innerHTML;
    if (contenu==undefined){
    	contenu=e.contentWindow.getSelection();
    }
    var sondage=e.contentWindow.document.createElement("a");
  sondage.setAttribute("href", url);
  sondage.innerHTML=contenu;
  insertNodeAtSelection(e.contentWindow,sondage);
  }

}

function pf_ouvre(vv_quoi_01,vv_quoi_02) {
  var vl_c_param;
  vl_c_param="typedoc=$_graal_typedoc"+"&vl_e_doc_cleunik="+vf_e_doc_cleunik+'&vl_c_titre='+fa_enc(fa_value_get("tb_titre"))+"&vl_c_lien="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&+genrecritere=";
  switch (vv_quoi_01) {
    case "critere_entreprise":
      vl_c_param+='entreprise';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "critere_lesmiens":
      vl_c_param+='moi';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "commentaires":
      vl_c_param='vf_e_doc_cleunik='+vf_e_doc_cleunik+'&';
      vl_c_param+='vf_e_commentaire_cleunik=-1&';
      vl_c_param+='genreacteur=favori&';
      fa_ouvre(c_fen_commentaires+vl_c_param,800,650);
      break;
  }
}
function pf_ouvre_acteur_recup(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
	var s="genre=acteur&portee_cleunik="+vl_act_cleunik+"&";
	s +="vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
	s +="vf_c_action=attacher&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_doc_liaison,s,pf_affiche_donnees_ged);
}
function pf_ouvre_action_recup(vl_action_cleunik,vf_c_sujet) {
	var s="genre=action&portee_cleunik="+vl_action_cleunik+"&";
	s +="vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
	s +="vf_c_action=attacher&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_doc_liaison,s,pf_affiche_donnees_ged);
}
function pf_ouvre_article_recup(vl_art_cleunik,vl_code,vl_description){
	var s="genre=articl&portee_cleunik="+vl_art_cleunik+"&";
	s +="vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
	s +="vf_c_action=attacher&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_doc_liaison,s,pf_affiche_donnees_ged);
}
function pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui,vl_act_cleunik,vl_raisonsoc,vl_portee) {
	var s="genre=interl&portee_cleunik="+vl_int_cleunik+"&";
	s +="vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
	s +="vf_c_action=attacher&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_doc_liaison,s,pf_affiche_donnees_ged);
}
function pf_ouvre_ged() {
  var rowIndex = fa_cui("arbre_des_connexions");
  if(rowIndex == -1){return;}
  var vl_e_doc_cleunik=fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_doc_cleunik")
  var vl_e_portee=fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_rattachement")
  var vl_c_param="doc_cleunik="+vl_e_doc_cleunik+"&";
  vl_c_param+="portee_cleunik="+vl_e_portee+"&";
  switch (fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_portee")) {
    case "$vl_e_articl":vl_c_param+="genre=articl&";break;
    case "$vl_e_action":vl_c_param+="genre=action&";break;
    case "$vl_e_interl":vl_c_param+="genre=interl&";break;
    case "$vl_e_acteur":vl_c_param+="genre=acteur&";break;
    case "$vl_e_utilis":vl_c_param+="genre=utilis&";break;
    case "$vl_e_entrep":vl_c_param+="genre=entrep&";break;
  }
  switch (fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_typedoc")) {
    case '1': fa_ouvre(c_script_liens+vl_c_param,800,300);break;
    case '2': fa_ouvre(c_script_notes+vl_c_param,800,600);break;
    case '3': //  Documents
    case '13':  //  Pièces jointes
      switch (fa_cell_get("arbre_des_connexions",rowIndex,"arbre_des_connexions_portee")) {
        case "$vl_e_articl":vl_c_param+="quelsdocs=undoc_articl&";break;
        case "$vl_e_action":vl_c_param+="quelsdocs=undoc_action&";break;
        case "$vl_e_interl":vl_c_param+="quelsdocs=undoc_interl&";break;
        case "$vl_e_acteur":vl_c_param+="quelsdocs=undoc_acteur&";break;
        case "$vl_e_utilis":vl_c_param+="quelsdocs=undoc_utilis&";break;
        case "$vl_e_entrep":vl_c_param+="quelsdocs=undoc_entrep&";break;
        default:vl_c_param+="quelsdocs=undoc&";break;
      }
		pf07_ouvre_doc("genre=$vl_c_genre&"+vl_c_param);
  }
}
function pf_ouvre_liaison() {
  var rowIndex = fa_cui("arbre_des_ged");
  if(rowIndex == -1){return;}
  var vl_e_cleunik=fa_cell_get("arbre_des_ged",rowIndex,"arbre_des_ged_rattachement");
  var vl_e_portee=fa_cell_get("arbre_des_ged",rowIndex,"arbre_des_ged_portee");
  switch (vl_e_portee) {
    case "$vl_e_articl":
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_e_cleunik+"&","");
			break;
    case "$vl_e_action":
		case "$vl_e_piejoi":
			var vl_c_donnees="vf_e_action_cleunik="+vl_e_cleunik+"&vf_c_action=modifier&genreaction=jenesaispas&";
			fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
			break;
    case "$vl_e_interl":
			fa_ouvre_interlo("vl_e_interlo_cleunik="+vl_e_cleunik);
			break;
    case "$vl_e_acteur":
			fa_ouvre(vf_c_script_fen_acteur+vl_e_cleunik,1200,800);
			break;
    case "$vl_e_utilis":
			break;
    case "$vl_e_entrep":
			break;
  }
}
function pf_maj_rss(){
  s='vf_c_quelsdocs=leurnot&raf='+Math.random()+"&";
  fa_xmlhttprequest_txt('_graal_rss_notes_01.php',s,'');
  s='vf_c_quelsdocs=menot&raf='+Math.random()+"&";
  fa_xmlhttprequest_txt('_graal_rss_notes_01.php',s,'');
}
function pf_raz_fiche(){
  fa_value_set("tb_titre","");
  fa_value_set("tb_descriptif_sommaire","");
  fa_value_set("tb_origine","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("tb_dateheuremodif","");
  vf_e_doc_cleunik=0;
  fa_ds("criteres_des_ged_entreprise","");
  fa_ds("criteres_des_ged_lesautres","");
  fa_ds("criteres_des_ged_lesmiens","");
  fa_ds("criteres_des_ged_tous","");
  fa_att_set("content","onload","event.stopPropagation()");
  fa_att_set("content","src","_graal_page_blanche_01.php");
	fa_att_set("tab_criteres","label","$vl_c_baf_137");
	fa_att_set("tab_commentaires","label","$vl_c_baf_139");
	fa_att_set("tab_connexions","label","$vl_c_baf_145");
  $vl_c_raz_suite
}
function pf_retour_fenetre_docs(vv_t_tableau_cleunik,vv_t_tableau_nom) {
  vl_e_nb_sel=vv_t_tableau_cleunik.length;
  alert(vl_e_nb_sel+" "+vf_c_retour)
  if (vl_e_nb_sel!=0) {
    switch (vf_c_retour) {
      case "connexion":
        fa_xmlhttprequest_xml(c_script_connecte,"vf_c_action=connecter&vl_e_doc_cleunik_gauche="+vf_e_doc_cleunik+"&vl_e_doc_cleunik_droite="+vv_t_tableau_cleunik[0]+"&",pf_affiche_donnees_connexions);
        break;
    }
  }
}
function pf_retour_fenetre_dossiers(vv_t_tableau_cleunik) {
  var vl_e_nb_sel=vv_t_tableau_cleunik.length;
  if (vl_e_nb_sel!=0) {
	for(var i=0;i<vl_e_nb_sel;i++){                      /* loop 'em */
      var vl_c_donnees=vv_t_tableau_cleunik[i]+"&cleunik_insertion_dossier="+fa_enc(vf_e_doc_cleunik)+"&label_insertion_dossier="+fa_enc(fa_value_get("tb_titre"));
      fa_xmlhttprequest_txt(c_bdope_dossiers+vl_c_donnees,"",pf_retour_fenetre_dossiers_fin);
    }
  }
}
function pf_retour_fenetre_dossiers_fin(stream){
	alert(stream)
}
function pf_retour_fenetre_notes(vv_t_tableau_cleunik,vv_t_tableau_nom) {
  vl_e_nb_sel=vv_t_tableau_cleunik.length;
  alert(vl_e_nb_sel+" "+vf_c_retour)
  if (vl_e_nb_sel!=0) {
    switch (vf_c_retour) {
      case "connexion":
        fa_xmlhttprequest_xml(c_script_connecte,"vf_c_action=connecter&vl_e_doc_cleunik_gauche="+vf_e_doc_cleunik+"&vl_e_doc_cleunik_droite="+vv_t_tableau_cleunik[0]+"&",pf_affiche_donnees_connexions);
        break;
    }
  }
}
function pf_retour_fenetre_pseudodocs(vv_t_tableau_cleunik,vv_t_tableau_nom) {
  vl_e_nb_sel=vv_t_tableau_cleunik.length;
  alert(vl_e_nb_sel+" "+vf_c_retour)
  if (vl_e_nb_sel!=0) {
    switch (vf_c_retour) {
      case "connexion":
        fa_xmlhttprequest_xml(c_script_connecte,"vf_c_action=connecter&vl_e_doc_cleunik_gauche="+vf_e_doc_cleunik+"&vl_e_doc_cleunik_droite="+vv_t_tableau_cleunik[0]+"&",pf_affiche_donnees_connexions);
        break;
    }
  }
}
function pf_retro(){
	//fa_gid("content").innerHTML=fa_value_get("tb_source");//	ne fonctionne pas (fonctionne pourtant dans fenêtre emailing !!)
	fa_gid("content").appendChild(document.createTextNode(fa_value_get("tb_source")));
}
function pf_sel_ligne(vv_qui) {
  if(fa_est_grise("bt_detailler")==true){return};
  var rowIndex = fa_cui("arbre_des_notes");if(rowIndex == -1){
    return;
  }
  vf_e_doc_cleunik=fa_cell_get("arbre_des_notes",rowIndex,"doc_cleunik");
  fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&",pf_affiche_datas);
}
function pf_top_model(vv_qui){
  fa_att_set("content","onload","fa_gid('content').contentDocument.designMode='on'");
  fa_att_set("content","src",vf_c_script_edite_note+vv_qui+'&raf_random='+Math.random()+'&');
}
function pf_validation(vv_quoi){
  var s="",texte="" ;
	switch ("$_graal_typedoc") {
    case "2":
    case "10":
    case "11":
	  case "122":
    case "123":
    case "900":
    	texte = fa_gid("content").contentWindow.document.documentElement.innerHTML;
    	break;
    case "101":
    case "102":
    case "111":
    case "112":
    case "121":
    case "122":
    case "131":
    case "132":
    case "141":
    case "142":
    case "151":
    case "152":
    case "161":
          case "162":
          case "171":
          case "172":
          case "181":
          case "182":
          case "191":
          case "192":
    case "901":
		case "902":
	case "903":
		case "904":
      texte = fa_gid("content").contentWindow.document.body.innerHTML;
      break;
  }
  s="vf_e_typedoc=$_graal_typedoc&";
  s +="vf_e_doc_cleunik="+vf_e_doc_cleunik+"&";
  s +="titre="+fa_enc(fa_value_get("tb_titre"))+"&";
  s +="blocnote_riche="+fa_enc(texte)+"&";
  s +="descriptif_sommaire="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
  s +="origine="+fa_enc(fa_value_get("tb_origine"))+"&";
  switch(vv_quoi) {
    case "enregistrer":
      if (vf_e_doc_cleunik!=0) {
        s +="vf_c_action=modifier&";
        vf_c_action="modifier";
      } else {
        s +="vf_c_action=ajouter&";
        vf_c_action="ajouter";
      }
      break;
    case "supprimer":
      if(confirm("Confirmez-vous la suppression de cet élément ?") == false) return;
      s="vf_e_doc_cleunik="+vf_e_doc_cleunik+"&";
			s +="vf_c_action=supprimer&";
      vf_c_action="supprimer";
    break;
  }
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_fin_requete);
}
function pf_verif_acces(){
	if ("$vl_c_tab_hidden"=="false") {
		var rowIndex = fa_cui("arbre_des_notes");if(rowIndex == -1){return;}
	}
  var s ="vf_c_action=verifier_droits_acces&vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&"
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_verif_acces_fin);
}
function pf_verif_acces_fin(stream) {
  var vl_c_datas=stream;
  vf_e_droits_proprio=vl_c_datas;
  pf_etat_fen("selectionner_suite");
}
function pf_voir_plein_ecran(){
  fa_ouvre(vf_c_script_edite_note+vf_e_doc_cleunik+'&raf_random='+Math.random()+'&',0,0)
}
]]></script>
END;
?>
