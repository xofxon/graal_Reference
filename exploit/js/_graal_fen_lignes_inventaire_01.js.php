<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_lignes_inventaire_01.php?";
const vf_c_script_bdope_sau="_graal_bdope_lignes_inventaire_02.php?";
var vf_e_nombre,vf_inv_cleunik,vf_dateheureinv;
function pf_aa_init(){
  vf_e_nombre=fa_att_get("_graal_fen_lignes_inventaire","_graal_nombre");
  vf_inv_cleunik=fa_att_get("_graal_fen_lignes_inventaire","_graal_inv_cleunik");
  var vl_date=fa_att_get("_graal_fen_lignes_inventaire","_graal_dateheureinv");
  vf_dateheureinv=fa_date_formate(vl_date,"AAAAMMJJ");
}
function pf_clavier(e,qui) {
	try {
		switch(e.keyCode){
      case 13: // 'Enter'
        var vl_e_i=fa_att_get(qui,"_graal_numero");
        vl_e_i++;
        var vl_id="ligne_"+vl_e_i;
        fa_focusdonne(vl_id);
        break;
      default:
        /*
        alert(fa_value_get(qui));
        */
        
        if (IsNumeric(fa_value_get(qui))==false) {
          alert("Numérique seulement !!!");
          //fa_value_set(qui,"");
        }
        break;
    }
 	} catch (e) {
    //raf;
  }
}
function IsNumeric(strString)
   //  check for valid numeric strings	
   {
   var strValidChars = "0123456789.,- ";
   var strChar;
   var blnResult = true;

   if (strString.length == 0) return true;

   //  test strString consists of valid characters listed above
   for (i = 0; i < strString.length && blnResult == true; i++)
      {
      strChar = strString.charAt(i);
      if (strValidChars.indexOf(strChar) == -1)
         {
         blnResult = false;
         }
      }
   return blnResult;
   }
function pf_sauvegarde(){
  if (vf_e_nombre==0) {return;}
  var vl_tableau_qte = [];
  var vl_tableau_cle = [];
  var vl_id,vl_qte,vl_art_cleunik,vl_e_j=-1,vl_c_tableau_js;
  for(var i=1;i<=vf_e_nombre;i++) {
    vl_id="ligne_"+i;
    vl_art_cleunik=fa_gid(vl_id).getAttribute("_graal_cleunik");
    vl_qte=fa_value_get(vl_id);
    vl_qte=parseFloat(fa_dec(fa_se(vl_qte)))
    if (vl_qte!=NaN) {
      if (vl_art_cleunik!=-1 && vl_qte!=-1) {
        vl_e_j++;
        vl_tableau_qte[vl_e_j]=vl_qte;
        vl_tableau_cle[vl_e_j]=vl_art_cleunik;
      }
    }
  }
  vl_c_donnees="";
  vl_c_donnees+="vl_tableau_cle="+fa_enc(fa_jsarray2php_00(vl_tableau_cle))+"&";
  vl_c_donnees+="vl_tableau_qte="+fa_enc(fa_jsarray2php_00(vl_tableau_qte))+"&";
  vl_c_donnees+="vl_inv_cleunik="+vf_inv_cleunik+"&";
  if (vl_e_j==-1) {alert("Rien à sauvegarder ...");return;}
  //fa_xmlhttprequest_txt(vf_c_script_bdope_sau+vl_c_donnees,"",pf_sauvegarde_fin);
  fa_xmlhttprequest_txt(vf_c_script_bdope_sau,vl_c_donnees,pf_sauvegarde_fin);
}
function pf_sauvegarde_fin(stream){
  vl_c_datas=stream;
  alert(stream)
}
function pf_validation(){
  alert("Disponible la prochaine fois...");return;
  if (vf_e_nombre==0) {return;}
  var vl_tableau_qte = [];
  var vl_tableau_cle = [];
  var vl_id,vl_qte,vl_art_cleunik,vl_e_j=-1,vl_c_tableau_js;
  for(var i=1;i<=vf_e_nombre;i++){
    vl_id="ligne_"+i;
    vl_art_cleunik=fa_gid(vl_id).getAttribute("_graal_cleunik");
    vl_qte=fa_value_get(vl_id);
        vl_qte=parseFloat(fa_dec(fa_se(vl_qte)));
    if (vl_qte!=NaN) {
      if (vl_art_cleunik!=-1 && vl_qte!=-1) {
        fa_att_set(vl_id,"_graal_cleunik","-1");
        fa_att_set(vl_id,"disabled","true");
        vl_e_j++;
        vl_tableau_qte[vl_e_j]=vl_qte;
        vl_tableau_cle[vl_e_j]=vl_art_cleunik;
        //alert("bingo")
      }
    }
  }
  vl_c_donnees="";
  vl_c_donnees+="vl_tableau_cle="+fa_enc(fa_jsarray2php_00(vl_tableau_cle))+"&";
  vl_c_donnees+="vl_tableau_qte="+fa_enc(fa_jsarray2php_00(vl_tableau_qte))+"&";
  vl_c_donnees+="vl_inv_cleunik="+vf_inv_cleunik+"&";
  if (vl_e_j==-1) {alert("Rien à valider ...");return;}
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_validation_fin(stream){
  vl_c_datas=stream;
  alert(stream)
}
]]></script>
END;
?>
