<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table,vf_valeur="";
var vf_c_renvoyer=false;
const vf_c_script_act="_graal_rech_ged_01.php?selection=$vl_c_selection&genre_droits=$vl_c_genreaction&";
const vf_c_script_bdope="_graal_bdope_droits_doc_01.php?&genre_droits=$vl_c_genreaction&";
const lstn_grise = {
	willRebuild : function(event){}, 
	didRebuild  : function(event){fa_grise_fenetre(event,"non");} 
};
function pf_aa_ferme() {
  if (vf_c_renvoyer==true) {
    var vl_t_tableau=[];
    var vl_e_nb_sel;
    vl_t_tableau=fa_lignes_selectionnees("arbre_des_ged");
    vl_e_nb_sel=vl_t_tableau.length;
    if (vl_e_nb_sel!=0) {
      var vl_t_doc_cleunik=[];
      var vl_t_doc_nom=[];
      for(i=0;i<vl_e_nb_sel;i++) {
        vl_t_doc_cleunik[i]=fa_cell_get("arbre_des_ged",vl_t_tableau[i],"doc_cleunik");
        vl_t_doc_nom[i]=fa_cell_get("arbre_des_ged",vl_t_tableau[i],"emplacement");
      }
      switch ("$vl_c_quelsdocs") { 
        case "notes" :
          window.opener.pf_retour_fenetre_notes(vl_t_doc_cleunik);
          break;
        case "docs" :
          window.opener.pf_retour_fenetre_docs(vl_t_doc_cleunik,vl_t_doc_nom);
          break;
				case "pseudodocs" :
          window.opener.pf_retour_fenetre_pseudodocs(vl_t_doc_cleunik);
          break;
      }  
    }
  }
}
function pf_aa_init() {
	fa_att_set("arbre_des_ged","seltype","multiple");
  fa_value_set("bem_tb_deb",c_date_defaut_deb);fa_att_set("bem_tb_deb","label",c_date_defaut_deb);
  fa_value_set("bem_tb_fin",c_date_defaut_fin);fa_att_set("bem_tb_deb","label",c_date_defaut_fin);
  vf_valeur=fa_mlget("bek_ml_qui","value");
	fa_badl("arbre_des_ged",lstn_grise);
  pf_approximatif();
  fa_ael("bek_ml_qui","ValueChange",po_change_menu);
  fa_ael("bek_tb_limit","input",pf_approximatif);
  po_change_menu();
}
function pf_affiche_donnees_ged() {
  pf_approximatif();
}
function pf_alimente_table() {
  fa_das("arbre_des_ged",vf_c_url_alimente_table);
}
function pf_approximatif() {
  if ( fa_value_get("bek_tb_rechapproxima") == "" ) {return;}
	fa_grise_fenetre("","oui");
  var item=fa_gid("bek_ml_actif").selectedItem; 
  vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc(fa_value_get("bek_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bek_ml_zone");
	vf_c_url_alimente_table+='&vl_c_type='+fa_value_get("bek_ml_type")+'&vl_c_qui='+vf_valeur+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bek_ml_actif");
	vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&vl_e_limit="+fa_value_get("bek_tb_limit")+"&";
  vf_c_url_alimente_table+='vl_c_quelleplage=debut&vl_c_dateheuredebut='+fa_enc(fa_date_formate(fa_value_get("bem_tb_deb"),"AAAAMMJJ"));
	vf_c_url_alimente_table+='&vl_c_dateheurefin='+fa_enc(fa_date_formate(fa_value_get("bem_tb_fin"),"AAAAMMJJ"));
	vf_c_url_alimente_table+='&uti_cleunik_droits='+fa_value_get("brk_ml_utilisateurs");
	vf_c_url_alimente_table+='&gestion_droits='+fa_value_get("brk_ml_action");
  pf_alimente_table();
}
function pf_assigne(vv_valeur,vv_label,vv_class) {
  vf_valeur=vv_valeur;
  fa_att_set("bek_ml_qui","label",vv_label);
}
function pf_sel_arbre_ged(){}
function pf_tab_documents(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_docs=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_ged");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_docs[i]=fa_cell_get("arbre_des_ged",vl_t_tableau[i],"doc_cleunik");
    }
  }
  return vl_t_docs;
} 
function pf_validation(vv_type){
	var vl_t_docs=pf_tab_documents();
	var vl_e_droits_proprio=0;
  if (fa_est_coche('ch_m01')==true) {vl_e_droits_proprio+=1;};
  if (fa_est_coche('ch_m02')==true) {vl_e_droits_proprio+=2;};
  if (fa_est_coche('ch_m03')==true) {vl_e_droits_proprio+=4;};
  if (fa_est_coche('ch_m04')==true) {vl_e_droits_proprio+=8;};
	var vl_c_param='vl_t_listecles='+fa_jsarray2php_00(vl_t_docs)+"&";
	vl_c_param+="vf_c_action="+vv_type+"&";
  vl_c_param+="vl_e_uti_cleunik="+fa_enc(fa_value_get("brk_ml_utilisateurs"))+"&";
  vl_c_param+="vl_e_droits_proprio="+fa_enc(vl_e_droits_proprio)+"&";
	fa_xmlhttprequest_txt(vf_c_script_bdope,vl_c_param,pf_validation_fin);
}
function pf_validation_fin(vv_retour){
	alert(vv_retour)
	pf_approximatif();
}
]]></script>
END;
?>
