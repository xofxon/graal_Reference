<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_url_alimente_table_01="_graal_das_treso_journal_01.php";
const _c_script_edite="_graal_xml_treso_journal_01.php?";
const _c_script_bdope_fen="_graal_bdope_treso_journal_01.php";
const c_script_pc="_graal_fen_rech_param_pc_01.php?";
const c_script_verif="_graal_verifie_rib.php";
var vf_c_action="",vf_journal_cleunik=-2;
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  fa_value_set("tb_code",fa_xml_get(vl_c_datas,"code"));
  fa_value_set("tb_nom",fa_xml_get(vl_c_datas,"nom"));
  fa_value_set("tb_type",fa_xml_get(vl_c_datas,"type"));
  fa_value_set("tb_compte",fa_xml_get(vl_c_datas,"compte"));
  fa_value_set("tb_domiciliation",fa_xml_get(vl_c_datas,"domiciliation"));
  fa_value_set("tb_etablissement",fa_xml_get(vl_c_datas,"etablissement"));
  fa_value_set("rdg_caisse_oui_non",fa_xml_get(vl_c_datas,"caisse_oui_non"));
  vf_e_utilisations=fa_xml_get(vl_c_datas,"utilisations");
  vf_journal_cleunik=fa_xml_get(vl_c_datas,"journal_cleunik");
  fa_value_set("tb_guichet",fa_xml_get(vl_c_datas,"guichet"));
  fa_value_set("tb_cle",fa_xml_get(vl_c_datas,"cle"));
  fa_value_set("tb_code_compte",fa_xml_get(vl_c_datas,"code_comptable"));
  fa_att_set("tb_code_compte","compte_comptable",fa_xml_get(vl_c_datas,'compte_comptable'));
  fa_value_set("tb_intitule_compte",fa_xml_get(vl_c_datas,"intitule_comptable"));
}
function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui("broadcaster_01");
  pf_raz_fiche();
  pf_alimente_table("arbre_journal");
}
function pf_alimente_defaut(){
  vf_journal_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_nom","");
  fa_value_set("tb_type","T");
  fa_value_set("tb_compte","");
  fa_value_set("tb_domiciliation","");
  fa_value_set("tb_etablissement","");
  fa_value_set("rdg_caisse_oui_non",1);
  vf_e_utilisations=0;
  fa_value_set("tb_guichet","");
  fa_value_set("tb_cle","");
  fa_value_set("tb_code_compte","");
  fa_att_set("tb_code_compte","compte_comptable",-1);
  fa_value_set("tb_intitule_compte","");
}
function pf_alimente_table(vv_qui){
  fa_das(vv_qui,_c_url_alimente_table_01+"?raf="+Math.random());
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      var i=fa_cui("arbre_journal");if(i==-1){return;}
      if (vf_e_utilisations==0 && vf_journal_cleunik>0) {fa_grise_non("bt_supprimer");} else {fa_grise_oui("bt_supprimer");}
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    fa_focusdonne("tb_code")
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_focusdonne("tb_code")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_groupe_oui("broadcaster_01");
    pf_raz_fiche();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=="ok") {pf_alimente_table("arbre_journal");} else {alert(vl_datas)}
  pf_etat_fen("annuler");
}
function pf_gere_suivant(vv_qui) {
  var vl_c_valeur=fa_value_get(vv_qui);
  if (fa_att_get(vv_qui,"maxlength")==vl_c_valeur.length) {fa_focusdonne(fa_att_get(vv_qui,"_graal_suivant"));}
}
function pf_ouvre(vv_quoi) {
  switch (vv_quoi) {
    case "pc_journal":
      fa_ouvre(c_script_pc+"vl_c_quellerecherche=pc_journal&",600,350);
      break;
  }
}
function pf_raz_fiche(){
  vf_journal_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_nom","");
  fa_value_set("tb_type","T");
  fa_value_set("tb_compte","");
  fa_value_set("tb_domiciliation","");
  fa_value_set("tb_etablissement","");
  fa_value_set("rdg_caisse_oui_non",1);
  vf_e_utilisations=0;
  fa_value_set("tb_guichet","");
  fa_value_set("tb_cle","");
  fa_value_set("tb_code_compte","");
  fa_att_set("tb_code_compte","compte_comptable",-1);
  fa_value_set("tb_intitule_compte","");
}
function pf_retour_param_pc(vl_e_pc_cleunik,vl_c_code,vl_c_intitule,vv_quoi) {
  switch (vv_quoi) {
    case "pc_journal":
      fa_value_set("tb_code_compte",vl_c_code);
      fa_att_set("tb_code_compte","compte_comptable",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_compte",vl_c_intitule);
      break;
  }
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return}
  var i=fa_cui(vv_qui);if(i==-1){return;}
  var s ="journal_cleunik="+fa_cell_get(vv_qui,i,"tc_journal_cleunik")+"&";
  fa_xmlhttprequest_xml(_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi) {
    var vl_c_donnees;
    vl_c_donnees="";
    vl_c_donnees+="vl_journal_cleunik="+fa_enc(vf_journal_cleunik)+"&";
    vl_c_donnees+="vl_code="+fa_enc(fa_value_get("tb_code"))+"&";
    vl_c_donnees+="vl_nom="+fa_enc(fa_value_get("tb_nom"))+"&";
    vl_c_donnees+="vl_type="+fa_enc(fa_value_get("tb_type"))+"&";
    vl_c_donnees+="vl_compte="+fa_enc(fa_value_get("tb_compte"))+"&";
    vl_c_donnees+="vl_domiciliation="+fa_enc(fa_value_get("tb_domiciliation"))+"&";
    vl_c_donnees+="vl_etablissement="+fa_enc(fa_value_get("tb_etablissement"))+"&";
		vl_c_donnees+="vl_caisse_oui_non="+fa_enc(fa_value_get("rdg_caisse_oui_non"))+"&";
    vl_c_donnees+="vl_guichet="+fa_enc(fa_value_get("tb_guichet"))+"&";
    vl_c_donnees+="vl_cle="+fa_enc(fa_value_get("tb_cle"))+"&";
    vl_c_donnees+="vl_compte_comptable="+fa_enc(fa_att_get("tb_code_compte","compte_comptable"))+"&";
    switch(vv_quoi) {
      case "enregistrer":
        if (vf_journal_cleunik!=-2)
          {vl_c_donnees+="vf_c_action=modifier&";}
        else
          {vl_c_donnees+="vf_c_action=ajouter&";}
        break;
      case "supprimer":
          if(confirm("Confirmez-vous la suppression de ce journal ?")==false) return;
          vl_c_donnees+="vf_c_action=supprimer&";
        break;
    }
    fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
function pf_verif_rib(){
  var vl_c_donnees="";
  vl_c_donnees+="vl_etablissement="+fa_enc(fa_value_get("tb_etablissement"))+"&";
  vl_c_donnees+="vl_guichet="+fa_enc(fa_value_get("tb_guichet"))+"&";
  vl_c_donnees+="vl_compte="+fa_enc(fa_value_get("tb_compte"))+"&";
  vl_c_donnees+="vl_cle="+fa_enc(fa_value_get("tb_cle"))+"&";
  fa_xmlhttprequest_txt(c_script_verif,vl_c_donnees,pf_verif_rib_fin);
}
function pf_verif_rib_fin(stream) {
  var vl_c_data=stream;
  alert(vl_c_data);
}
]]></script>
END;
?>
