<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_act_interlo_relations_01.php";
const vf_c_script_interlo_relation='_graal_xml_act_interlo_relations_02.php';
var vf_c_action;
var vf_e_interlo_cleunik_gauche,vf_e_interlo_cleunik_droite,vf_e_choix_cleunik_gauche,vf_e_choix_cleunik_droite;
function pf_aa_init(){
  var vl_c_param;
  var raf_random=Math.random();
  var i;
  fa_grise_non("bt_supprimer");
  fa_grise_non("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  vf_e_interlo_cleunik_gauche=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_gauche");
  vf_e_interlo_cleunik_droite=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_droite");
  vf_e_choix_cleunik_gauche=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_choix_cleunik_gauche");
  vf_e_choix_cleunik_droite=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_choix_cleunik_droite");
  fa_mlsel("ml_rel_gauche",vf_e_choix_cleunik_gauche)
  fa_mlsel("ml_rel_droite",vf_e_choix_cleunik_droite)
  vl_c_param="";
  vl_c_param+="vl_interlo_cleunik_gauche="+vf_e_interlo_cleunik_gauche+"&";
  vl_c_param+="vl_interlo_cleunik_droite="+vf_e_interlo_cleunik_droite+"&"
  vl_c_param+="vl_choix_cleunik_gauche="+vf_e_choix_cleunik_gauche+"&"
  vl_c_param+="vl_choix_cleunik_droite="+vf_e_choix_cleunik_droite+"&"
  vl_c_param+="raf_random="+raf_random+"&";
  fa_xmlhttprequest_xml(vf_c_script_interlo_relation,vl_c_param,pf_alimente_blocnote);
  fa_focusdonne("tb_blocnotebrut");
}

function pf_alimente_blocnote(stream){
var vl_c_datas = stream;
fa_value_set("tb_blocnotebrut",fa_xml_get(vl_c_datas,'blocnotebrut'));
}
function pf_etat_fen(vv_quoi)
  {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      break;
    case "sortir":
      window.close();
      break;
  }
  }
function pf_fin_requete(stream)
{
  var vl_datas = stream;
  if (vl_datas!="-1") 
    {
    }
  else
    {
    alert(vl_datas);
    }
window.opener.pf_affiche_donnees_relations();    
pf_etat_fen('sortir');
}

function pf_validation(vv_quoi) {
  var vl_c_donnees;
  vf_e_interlo_cleunik_gauche=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_gauche");
  vf_e_interlo_cleunik_droite=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_droite");
  vf_e_choix_cleunik_gauche=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_choix_cleunik_gauche");
  vf_e_choix_cleunik_droite=fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_choix_cleunik_droite");
  vl_c_donnees="";
  vl_c_donnees+="vl_interlo_cleunik_gauche="+vf_e_interlo_cleunik_gauche+"&";
  vl_c_donnees+="vl_interlo_cleunik_droite="+vf_e_interlo_cleunik_droite+"&";
  vl_c_donnees+="vl_choix_cleunik_gauche="+vf_e_choix_cleunik_gauche+"&";
  vl_c_donnees+="vl_choix_cleunik_droite="+vf_e_choix_cleunik_droite+"&";
  vl_c_donnees+="vf_c_action=supprimer&";
    switch(vv_quoi){
      case "enregistrer":
        fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,""); //  Suppression préalable
        vl_c_donnees="";
        vl_c_donnees+="vl_interlo_cleunik_gauche="+fa_enc(fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_gauche"))+"&";
        vl_c_donnees+="vl_interlo_cleunik_droite="+fa_enc(fa_gid("_win_fen_act_interlo_relation").getAttribute("_graal_interlo_cleunik_droite"))+"&";
        vl_c_donnees+="vl_choix_cleunik_gauche="+fa_enc(fa_mlget("ml_rel_gauche"))+"&";
        vl_c_donnees+="vl_choix_cleunik_droite="+fa_enc(fa_mlget("ml_rel_droite"))+"&";
        vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
        vl_c_donnees+="vf_c_action=ajouter&";
        break;
      case "supprimer":
          if(confirm("Confirmez-vous la suppression de cet élément ?") == false) return;
          vl_c_donnees+="vf_c_action=supprimer&";
        break;
    }
//  alert(vl_c_donnees)
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
