<?php
$vl_c_bvl_114=fa_recup_dico_js("bvl_114");
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_export="";
const vf_c_script_bdope_fen="_graal_bdope_traitements_articles_01.php";
const lstn_grise = { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");} 
};
function pf_aa_init() {
	fa_badl("arbre_des_articles",lstn_grise);
}
function pf_ouvre(vv_quoi_01) {
  var i=fa_cui("arbre_des_articles");if(i==-1){return;}
  var vl_e_art_cleunik=fa_cell_get("arbre_des_articles",i,"art_cleunik");
  switch (vv_quoi_01) {
    case "art":
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_e_art_cleunik+"&","");
      break;
    case "docciaux":
          var vl_c_param='vl_e_art_cleunik='+vl_e_art_cleunik+'&genre=$vl_c_genre&';
          fa_ouvre("_graal_fen_articles_docciaux_01.php?"+vl_c_param,1000,400);
      break;
    case "docciaux_ligne":
          vl_c_param="genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&commercial_ligne_cleunik="+fa_cell_get("arbre_des_articles",i,"commercial_ligne_cleunik")+"&";
          vl_c_param="genreaction=$vl_c_genre&commercial_ligne_cleunik="+fa_cell_get("arbre_des_articles",i,"commercial_ligne_cleunik")+"&";
          vl_c_param+="vl_commercial_cleunik="+fa_cell_get("arbre_des_articles",i,"commercial_cleunik")+"&";
		  fa_ouvre_ligne_doccial(vl_c_param,"");
      break;
    case "excel_01":
    	var vl_c_nom_fichier_xls=prompt("Nom du fichier","Dernier PA $vl_c_genre.xls");
    	fa_ouvre(vf_c_export+"&vl_c_nom_fichier_xls="+fa_enc(vl_c_nom_fichier_xls)+"&");
    	break;
  }
}
function pf_validation_maj_derpa(){
var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_article=[];
  var vl_t_derpa=[];
  var vl_t_date=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_articles");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_article[i]=fa_cell_get("arbre_des_articles",vl_t_tableau[i],"art_cleunik");
      vl_t_derpa[i]=fa_cell_get("arbre_des_articles",vl_t_tableau[i],"pu");
      vl_t_date[i]=fa_cell_get("arbre_des_articles",vl_t_tableau[i],"dateheure_reception");
    }
    if (confirm("$vl_c_bvl_114("+vl_e_nb_sel+")")!=true) {return};
    fa_grise_fenetre("","oui");
    var vl_c_donnees="vf_c_action=kilometres_maj_derpa";
    vl_c_donnees+="&vl_t_article="+fa_enc(fa_jsarray2php_00(vl_t_article))+"&";
    vl_c_donnees+="&vl_t_derpa="+fa_enc(fa_jsarray2php_00(vl_t_derpa))+"&";
    vl_c_donnees+="&vl_t_date="+fa_enc(fa_jsarray2php_00(vl_t_date))+"&";
    fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_maj_derpa_fin);
  }
}
function pf_validation_maj_derpa_fin(stream){
	fa_approximatif_bbo();
	alert(stream);
}
]]></script>
END;
?>
