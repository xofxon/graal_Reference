<?php
include("_graal_var_portee.php");
$vl_c_ben_147=fa_recup_dico_js("ben_147");
$vl_c_ben_148=fa_recup_dico_js("ben_148");
$vl_c_ben_149=fa_recup_dico_js("ben_149");
$vl_c_ben_150=fa_recup_dico_js("ben_150");
$vl_c_ben_151=fa_recup_dico_js("ben_151");
$vl_c_ben_190=fa_recup_dico_js("ben_190");
$vl_c_ben_191=fa_recup_dico_js("ben_191");
$var_rc='\r\n';
switch ($vl_c_genreaction){
	case "fabrica":
		$pf_unload="pf_fabr_onunload();";
		break;
  default:
		$pf_unload="";
    break;  //  Toutes les actions génériques
}
if ($rss_accès=="restreint"){
	$bloc_00=<<<EOT
const vf_c_script_xml_action='_graal_xml_actions_01.php';
const vf_c_script_bdope_action='pagesparticulieres/acces_restreint.php?';
const vf_c_script_favoris='pagesparticulieres/acces_restreint.php?';
const vf_c_script_ged='_graal_rech_ged_01.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=555555&';
const vf_c_fen_pseudosliens="_pagesparticulieres/acces_restreint.php?";
const vf_c_fen_notes="pagesparticulieres/acces_restreint.php?";
const vf_c_fen_criteres='pagesparticulieres/acces_restreint.php?';
const vf_c_script_critere_actions_entreprise='_graal_das_actions_criteres_entreprise.php?';
const vf_c_script_critere_actions_lesmiens='_graal_das_actions_criteres_lesmiens.php?';
const vf_c_script_critere_actions_lesautres='_graal_das_actions_criteres_lesautres.php?';
const vf_c_script_critere_actions_tous='_graal_das_actions_criteres_tous.php?';
const vf_c_script_graal='_graal_das_actions_graal_01.php?';
const vf_c_fen_graal_selection_interlo="pagesparticulieres/acces_restreint.php?";
const vf_c_fen_graal_selection_acteur="pagesparticulieres/acces_restreint.php?";
const vf_c_fen_graal_modificat="pagesparticulieres/acces_restreint.php?";
const vf_c_script_cartes_visites='pagesparticulieres/acces_restreint.php?';
const vf_c_iframe_commentaires_menu='_graal_fen_iframe_actions_commentaires_01.php?vl_action_cleunik=';
const vf_c_fen_commentaires='pagesparticulieres/acces_restreint.php?';
const vf_c_script_relations='_graal_das_actions_relations_01.php?'
const vf_c_fen_relations_fiche="pagesparticulieres/acces_restreint.php?";
const vf_c_script_fen_action='pagesparticulieres/acces_restreint.php?';
const vl_c_script_pdf_action="pagesparticulieres/acces_restreint.php?";
const c_script_acteur_simple_02="pagesparticulieres/acces_restreint.php?";
const c_script_fen_interlo_simple_02="pagesparticulieres/acces_restreint.php?";
const c_script_fen_visu_acteurs='pagesparticulieres/acces_restreint.php?';
const c_script_graal_principal="pagesparticulieres/acces_restreint.php?";
EOT;
} else {
$bloc_00=<<<EOT
const vf_c_script_xml_action='_graal_xml_actions_01.php';
const vf_c_script_bdope_action='_graal_bdope_actions_01.php?$vl_e_uti_cleunik&';
const vf_c_script_favoris='_graal_bdope_actions_favorites_01.php';
const vf_c_script_ged='_graal_rech_ged_01.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=555555&';
const vf_c_fen_pseudosliens="_graal_fen_pseudodocs_01.php?quelsdocs=unlien_action&genre=action&";
const vf_c_fen_notes="_graal_fen_note_01.php?quelsdocs=unenot_action&genre=action&";
const vf_c_fen_criteres='_graal_fen_actions_criteres.php?';
const vf_c_script_critere_actions_entreprise='_graal_das_actions_criteres_entreprise.php?';
const vf_c_script_critere_actions_lesmiens='_graal_das_actions_criteres_lesmiens.php?';
const vf_c_script_critere_actions_lesautres='_graal_das_actions_criteres_lesautres.php?';
const vf_c_script_critere_actions_tous='_graal_das_actions_criteres_tous.php?';
const vf_c_script_graal='_graal_das_actions_graal_01.php?';
const vf_c_fen_graal_selection_interlo="_graal_fen_actions_graal_01.php?";
const vf_c_fen_graal_selection_acteur="_graal_fen_actions_graal_03.php?";
const vf_c_fen_graal_modificat="_graal_fen_actions_graal_02.php?";
const vf_c_script_cartes_visites='_graal_rech_interlo_01.php?sortie=xul&';
const vf_c_iframe_commentaires_menu='_graal_fen_iframe_actions_commentaires_01.php?vl_action_cleunik=';
const vf_c_fen_commentaires='_graal_fen_actions_commentaires_01.php?genreacteur=tousss&';
const vf_c_script_relations='_graal_das_actions_relations_01.php?'
const vf_c_fen_relations_fiche="_graal_fen_actions_relations_01.php?";
const vf_c_script_fen_action='_graal_fen_actions_02.php?';
const vl_c_script_pdf_action="_graal_pdf_action_01.php?vf_c_genre=$vl_c_genreaction&";
const c_script_acteur_simple_02="_graal_fen_acteurs_simple_02.php?genreacteur=";
const c_script_fen_interlo_simple_02="_graal_fen_act_interlo_simple_02.php?";
const c_script_fen_visu_acteurs='_graal_fen_rech_acteurs.php?vl_c_origine=selection&vl_c_proc_retour=pf_ouvre_acteur_recup&';
const c_script_graal_principal="_graal_bdope_graal_01.php?vf_c_action=inverser_principal&";
const c_fen_selection_dossiers='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=dossiers&retour=oui&';
const c_bdope_dossiers='_graal_bdope_note_01.php?vf_c_action=insere_dans_dossier&type_insertion_dossier=action&vf_e_doc_cleunik=';
const c_fen_action_dupliq='_graal_fen_action_06_dupliq.php?';
EOT;
}

echo <<<END
<script type="application/x-javascript"><![CDATA[
$bloc_00
var vf_c_script_edite_modeles_entete_pied='_graal_xml_modeles_courriels_01.php?';
var vf_b_commenter=false,vf_c_action="",vf_e_action_cleunik=0,vf_c_qui="",vf_nb_graal=0;
function pf_aa_init() {
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui('broadcaster_01');
  vf_e_action_cleunik=$vl_action_cleunik;
  switch ($vl_action_cleunik) {
    case -1:
      pf_etat_fen("ajouter");break;
    default:
      vf_c_action="$vf_c_action";
END;
switch ("$vl_c_genreaction"){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
  case "avofin":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "retcli":
  case "retfou":
  case "relfou":
  case "avofou":
  case "avofif":
    echo('fa_gid("tab_infogene").selectedIndex=1;fa_gid("tab_act_cial").selectedIndex=2;pf_cial_etat_fen(\'ini\');');
    break;
  case "chat":
    echo('pf_chat_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
    break;
  case "emimail":
  case "emimail_ar":
  case "emimail_brouillon":
    echo('pf_emimail_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
    break;
  case "emailing":
    echo('pf_emailing_aa_init();fa_gid("tab_infogene").selectedIndex=1;');
    break;
  case "recmail":
  case "recmail_lecture":
  case "recmail_erreur":
    echo('pf_recmail_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
    break;
	case "fabrica":
    echo('fa_gid("tab_infogene").selectedIndex=1;fa_gid("tab_act_fabr").selectedIndex=0;pf_fabr_etat_fen(\'ini\');');
    break;
	case "recvoc":
    echo('pf_recvoc_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
    break;
	case "recfax":
    echo('pf_recfax_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
    break;
  case "remban":
		echo('pf_remban_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;fa_cache_oui("bt_supprimer");');
		break;
	case "emifax":
	    echo('pf_emifax_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
		break;
	case "emisms":
	    echo('pf_emisms_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
		break;
	case "bordex":
	    echo('pf_bordex_etat_fen(\'ini\');pf_bordex_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
		break;
	case "alertes":
	    echo('pf_alertes_affiche_donnees();fa_gid("tab_infogene").selectedIndex=1;');
		break;
	default:
    break;  //  Toutes les actions génériques
}
echo <<<END
      fa_xmlhttprequest_xml(vf_c_script_xml_action,"vl_e_action_cleunik=$vl_action_cleunik&",pf_affiche_donnees_actions_infogene);
  }
}
function toto(){
	alert("toto");
}
function pf_action(vv_quoi) {
  var vl_c_param;
  var raf_random=Math.random();
  switch (vv_quoi) {
    case 'favoris_ajout':
      vl_c_param="vf_c_action=ajouter&vf_c_quoi=1&";
      vl_c_param+="vl_action_cleunik="+vf_e_action_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'favoris_supprimer':
      vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&";
      vl_c_param+="vl_action_cleunik="+vf_e_action_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_02,'');
      break;
    case 'dossier_ajouter':
    	fa_ouvre(c_fen_selection_dossiers,1000,800);
      break;
  }
}
function pf_action_fin_01(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("$vl_c_ben_148");} else {alert("$vl_c_ben_149");}
}
function pf_action_fin_02(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("$vl_c_ben_150");} else {alert("$vl_c_ben_151");}
}
function pf_affiche_arbre_graal() {
	if (vf_nb_graal>500){
		if (confirm("Confirmez-vous l'affichage des "+vf_nb_graal+" interlocteurs/acteurs liés à cette action ?")==false){return;}
	}
  var vl_c_param=vf_c_script_graal+"vl_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("arbre_graal",vl_c_param);
}
function pf_affiche_commentaire(vl_commentaire_cleunik) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+='vf_e_action_cleunik='+vf_e_action_cleunik+'&';
  vl_c_param+='vf_e_commentaire_cleunik='+vl_commentaire_cleunik+'&';
  fa_ouvre(vf_c_fen_commentaires+vl_c_param,800,650);
}
function pf_affiche_donnees_actions_infogene(stream) {
  var vl_c_datas=stream,vl_e_nombre=0,nombre_commentaires=fa_xml_get(vl_c_datas,'nombre_commentaires'),nombre_criteres=fa_xml_get(vl_c_datas,'nombre_criteres'),nombre_rattachements=fa_xml_get(vl_c_datas,'nombre_rattachements'),nombre_graal_act=fa_xml_get(vl_c_datas,'nombre_graal_act');
  pf_raz_fiche();
  vf_e_action_cleunik=fa_xml_get(vl_c_datas,'action_cleunik');
  fa_value_set('tb_description',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('dp_dat_deb',fa_xml_get(vl_c_datas,'datedebut'));
  fa_value_set('dp_dat_fin',fa_xml_get(vl_c_datas,'datefin'));
  fa_value_set('tb_heu_deb',fa_xml_get(vl_c_datas,'heuredebut'));
  fa_value_set('tb_heu_fin',fa_xml_get(vl_c_datas,'heurefin'));
  fa_value_set('tb_lieu',fa_xml_get(vl_c_datas,'lieu'));
  fa_value_set('tb_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set('la_dateheurecreation',fa_xml_get(vl_c_datas,'dateheurecreation'));
  fa_value_set('la_dateheuremodification',fa_xml_get(vl_c_datas,'dateheuremodification'));
  fa_value_set('tb_sujet',fa_xml_get(vl_c_datas,'sujet'));
  fa_value_set('tb_reference',fa_xml_get(vl_c_datas,'reference'));
  fa_mlsel("ml_genre_action",fa_xml_get(vl_c_datas,'genre'));
  fa_mlsel("ml_statut_action",fa_xml_get(vl_c_datas,'statut'));
  fa_mlsel("ml_confidentialite_action",fa_xml_get(vl_c_datas,'confidentialite'));
  fa_mlsel("ml_priorite_action",fa_xml_get(vl_c_datas,'priorite'));
	fa_value_set('rdg_duree',fa_xml_get(vl_c_datas,'duree'));
	vf_nb_graal=fa_xml_get(vl_c_datas,'nombre_graal_brut');
	fa_att_set("tab_graal","label","$vl_c_ben_103"+fa_xml_get(vl_c_datas,'nombre_graal'));
	fa_att_set("tab_graal_actions","label","$vl_c_ben_125"+nombre_graal_act);
	fa_att_set("tab_criteres","label","$vl_c_ben_102"+nombre_criteres);
	fa_att_set("tab_ged","label","$vl_c_ben_104"+nombre_rattachements);
  if (nombre_commentaires!=0){pf_affiche_iframe_commentaires();}
  if (nombre_criteres!=0) {pf_affiche_donnees_criteres();}
  	if(nombre_rattachements!=0) {pf_affiche_donnees_ged()};
	fa_att_set("tb_affiche_graal","_graal_nombre",vf_nb_graal);
	if (vf_nb_graal<500){
		fa_att_set("tb_affiche_graal","label","");
	  if (vf_nb_graal!=0) {pf_affiche_arbre_graal()};
	} else {
		fa_att_set("tb_affiche_graal","label","Trop nombreux pour automatisme ...");
	}
	if (nombre_graal_act!=0) {pf_affiche_donnees_relations();}
  switch (vf_c_action) {
    case "ajout":
    case "ajoutermodifier":
    case "modifier":
      fa_cache_non("tab_graal");fa_cache_non("tab_ged");fa_cache_non("tab_criteres");fa_cache_non("tab_graal_actions");fa_cache_non("tb_aller_commentaires");fa_cache_non("tb_aller_commentaires_moi");fa_cache_non("tb_aller_commentaires_principal");
      pf_etat_fen("modifier");
      if (vf_b_commenter==true) {pf_ouvre("commentaires","");}
      break;
    default:
        pf_etat_fen("selectionner");
        break;
  }
}
function pf_affiche_donnees_criteres() {
  pf_affiche_donnees_criteres_entreprise();pf_affiche_donnees_criteres_lesmiens();pf_affiche_donnees_criteres_lesautres();pf_affiche_donnees_criteres_tous();
}
function pf_affiche_donnees_criteres_entreprise() {
  var vl_c_param=vf_c_script_critere_actions_entreprise+"vl_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_actions_entreprise",vl_c_param);
}
function pf_affiche_donnees_criteres_lesautres() {
  var vl_c_param=vf_c_script_critere_actions_lesautres+"vl_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_actions_lesautres",vl_c_param);
}
function pf_affiche_donnees_criteres_lesmiens() {
  var vl_c_param=vf_c_script_critere_actions_lesmiens+"vl_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_actions_lesmiens",vl_c_param);
}
function pf_affiche_donnees_criteres_tous() {
  var vl_c_param=vf_c_script_critere_actions_tous+"vl_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_actions_tous",vl_c_param);
}
function pf_affiche_donnees_ged() {
  var vl_c_param=vf_c_script_ged+'vl_e_portee_cleunik='+vf_e_action_cleunik+'&raf_random='+Math.random()+'&'
  fa_das("arbre_des_ged",vl_c_param);
}
function pf_affiche_donnees_relations() {
  var vl_c_param=vf_c_script_relations+"vl_e_action_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&vf_c_genre=A&'";
  fa_das("arbre_relations",vl_c_param);
}
function pf_affiche_iframe_commentaires() {
  fa_att_set("if_commentaires","src",vf_c_iframe_commentaires_menu+vf_e_action_cleunik+"&raf_random="+Math.random()+"&");
}
function pf_ajoute_rss(vv_qui,vv_quoi){
	fa_ajoute_rss(vv_qui,vv_quoi,vf_e_action_cleunik);
}
function pf_alerte(vv_quoi){
	if (vf_e_action_cleunik==-1){return;}
	var vl_c_donnees="";
	vl_c_donnees+="vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&";
	vl_c_donnees+="vf_c_action=alerter&";
	vl_c_donnees+="vf_c_delai_alerte="+vv_quoi+"&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_action,vl_c_donnees,pf_alerte_fin);
}
function pf_alerte_fin(stream){
	alert("Alerte enregistrée");
}

function pf_changement(quoi){}
function pf_cree_acteur(vv_qui) {
  vf_c_qui=vv_qui;
  fa_ouvre(c_script_acteur_simple_02+vv_qui+"&p02=Fen_00425",1000,800);
}
function pf_cree_acteur_ok(vv_act_cleunik) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
  vl_c_param+="genreacteur=luilui&";
  vl_c_param+="vl_e_act_cleunik="+vv_act_cleunik+"&";
  fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);
}

function pf_cree_interlo(vv_qui) {
  vf_c_qui=vv_qui;
  fa_ouvre(c_script_fen_visu_acteurs+"vl_e_genreacteur="+vv_qui+"&",800,600);
}
function pf_cree_interlo_ok(vv_int_cleunik) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
  vl_c_param+="genreacteur=luilui&";
  vl_c_param+="vl_e_int_cleunik="+vv_int_cleunik+"&";
  fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);
}
function pf_dblclick_arbre_graal(){
  if(fa_est_grise("bt_enregistrer")==true) {return};
  var i=fa_cui("arbre_graal");
  if(i==-1){return;}
  vl_e_act_cleunik=fa_cell_get("arbre_graal",i,"act_cleunik_graal");
  vl_e_int_cleunik=fa_cell_get("arbre_graal",i,"int_cleunik_graal");
  vl_e_action_cleunik=fa_cell_get("arbre_graal",i,"action_cleunik_graal");
  vl_e_choix_cleunik=fa_cell_get("arbre_graal",i,"choix_cleunik_graal");
  var param="vl_e_act_cleunik="+vl_e_act_cleunik+"&vl_e_int_cleunik="+vl_e_int_cleunik+"&vl_e_action_cleunik="+vl_e_action_cleunik+"&vl_e_choix_cleunik="+vl_e_choix_cleunik+"&";
  fa_ouvre(vf_c_fen_graal_modificat+param,400,250);
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  var vl_portee;
  switch(vv_quoi) {
    case "ini":
      break;
    case "dupliquer":
    if (vf_e_action_cleunik==-1){
    	return;
    }
    	var genre_action=fa_mlget("ml_genre_action");
    switch (genre_action) {
    // case "-110107":	Appels téléphoniques duplicables
        case "-110101": case "-110102": case "-110103": case "-110104": case "-110106":case "-110108": case "-110109":case "-110110": case "-110111":case "-110112":
        case "-110113":case "-110114": case "-110115":case "-110116": case "-110117": case "-110118": case "-110120": case "-110121": case "-110122": case "-110123":
		case "-110124": case "-110125": case "-110126": case "-110127": case "-110128": case "-110129": case "-110130": case "-110131": case "-110132": case "-110133":
		case "-110134": case "-110135": case "-110136": case "-110137": case "-110138": case "-110139": case "-110140": case "-110141":
          alert("Pas de duplication possible, de cette manière, de ce genre d'action");
          return;
      }
      var vl_c_param='&raf_random='+Math.random()+'&';
	  vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
		fa_ouvre(c_fen_action_dupliq+vl_c_param,800,40);
      break;
      case "selectionner":
      fa_grise_non("bt_modifier");fa_grise_non("bt_supprimer");fa_grise_non("bt_annuler");
      fa_grise_oui("bt_detailler");fa_grise_oui("bt_ajouter");fa_grise_oui("bt_enregistrer");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "modifier":
      fa_grise_oui("bt_modifier");fa_grise_non("bt_supprimer");fa_grise_oui("bt_detailler");fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");fa_grise_non("bt_annuler");
      fa_grise_groupe_non('broadcaster_01');
      var genre_action=fa_mlget("ml_genre_action");
      switch (genre_action) {

        case "-110101": case "-110102": case "-110103": case "-110104": case "-110106": case "-110107":case "-110108": case "-110109":case "-110110": case "-110111":case "-110112":
        case "-110113":case "-110114": case "-110115":case "-110116": case "-110117": case "-110118": case "-110120": case "-110121": case "-110122": case "-110123":
		case "-110124": case "-110125": case "-110126": case "-110127": case "-110128": case "-110129": case "-110130": case "-110131": case "-110132": case "-110133":
		case "-110134": case "-110135": case "-110136": case "-110137": case "-110138": case "-110139": case "-110140": case "-110141":
          fa_grise_oui("ml_genre_action");
      }
      fa_focusdonne('tb_sujet');
      break;
    case "ajouter":
      vf_b_commenter=false;
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");
      fa_grise_non("bt_annuler");
      fa_cache_oui("tab_graal");fa_cache_oui("tab_ged");fa_cache_oui("tab_criteres");fa_cache_oui("tab_graal_actions");
      pf_raz_fiche();
      fa_grise_groupe_non('broadcaster_01');
      fa_cache_oui("tb_aller_commentaires");fa_cache_oui("tb_aller_commentaires_moi");fa_cache_oui("tb_aller_commentaires_principal");
      fa_focusdonne('tb_sujet');
      break;
    case "annuler":
      pf_aa_init()
      break;
    case "sortir":
      try { window.opener.pf_approximatif_bem()} catch (e) {}
      window.close();
      break;
    default:
      break;
}
  }
function pf_fin_requete(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") {
    switch (vf_c_action) {
      case "ajout":
        vf_e_action_cleunik=vl_datas;
        var s =fa_enc("vl_e_action_cleunik")+"="+fa_enc(vf_e_action_cleunik)+"&";
        fa_xmlhttprequest_xml(vf_c_script_xml_action,s,pf_affiche_donnees_actions_infogene);
        break;
      case "modification":
        break;
      case "suppression":
        alert("$vl_c_ben_190")
        pf_etat_fen("sortir");
        break;
    }
    switch ("$vl_c_genreaction"){
      case "offcli":
      case "cdecli":
      case "livcli":
      case "faccli":
      case "avocli":
      case "avofin":
      case "demfou":
      case "cdefou":
      case "recfou":
      case "facfou":
      case "relfou":
      case "avofou":
      case "avofif":
        //pf_cial_validation();
        break;
      case "chat":
        pf_chat_validation();
        break;
      default:
        break;  //  Toutes les actions génériques
    }
  }
  else {alert(vl_datas);pf_etat_fen("annuler");}
}

function pf_formulaire_repondre(vv_genre,vv_type){
  var vl_c_fen_courriel_texte="_graal_fen_courriel_01.php?type="+vv_type+"&genre="+vv_genre+"&action_cleunik="+vf_e_action_cleunik+"&";
  fa_ouvre(vl_c_fen_courriel_texte,0,0);
}
function pf_ged_ajout(vv_quoi_01) {
  var vl_c_param='portee_cleunik='+vf_e_action_cleunik+'&doc_cleunik=-1&';
  switch (vv_quoi_01){
    case "ged_lien":
      fa_ouvre(vf_c_fen_pseudosliens+vl_c_param,800,300);
      break;
    case "ged_note":
      fa_ouvre(vf_c_fen_notes+vl_c_param,800,500);
      break;
    case "ged_doc":
			pf07_ouvre_doc("quelsdocs=undoc_action&genre=action&"+vl_c_param);
      break;
    case "ged_image":
      fa_ouvre(vf_c_fen_image+vl_c_param,800,300);
      break;
  }
}
function pf_grise_boutons_interlo() {
  fa_grise_oui("tb_interlo_01");fa_grise_oui("tb_interlo_02");
  fa_grise_oui("tb_tel_01");fa_grise_oui("tb_tel_02");fa_grise_oui("tb_tel_03");fa_grise_oui("tb_tel_04");
  fa_grise_oui("tb_fax_01");fa_grise_oui("tb_fax_02");fa_grise_oui("tb_fax_03");
  fa_grise_oui("tb_courriel_01");fa_grise_oui("tb_courriel_02");fa_grise_oui("tb_courriel_03");fa_grise_oui("tb_courriel_04");
}
function pf_inverse_etat_principal(){
  if(fa_est_grise("bt_enregistrer")==true) {return};
  var i=fa_cui("arbre_graal");if(i==-1){return;}
  vl_act_cleunik=fa_cell_get("arbre_graal",i,"act_cleunik_graal");
  vl_int_cleunik=fa_cell_get("arbre_graal",i,"int_cleunik_graal");
  vl_action_cleunik=fa_cell_get("arbre_graal",i,"action_cleunik_graal");
  vl_ancien_choix_cleunik=fa_cell_get("arbre_graal",i,"choix_cleunik_graal");
	vl_principal=fa_cell_get("arbre_graal",i,"val_principal");
  var param="vl_act_cleunik="+vl_act_cleunik+"&vl_int_cleunik="+vl_int_cleunik+"&vl_action_cleunik="+vl_action_cleunik+"&vl_ancien_choix_cleunik="+vl_ancien_choix_cleunik+"&vl_principal="+vl_principal+"&";
	fa_xmlhttprequest_txt(c_script_graal_principal,param,pf_inverse_etat_principal_fin);
}
function pf_inverse_etat_principal_fin(){
	pf_affiche_arbre_graal();
}
function pf_lie_lambda() {
  var vl_c_script_bdope_action=vf_c_script_bdope_action+"vf_c_action=lielambda&vl_action_cleunik_liee="+vf_e_action_cleunik+"&";
  var http = new XMLHttpRequest();
  http.open("GET",vl_c_script_bdope_action,true);
  http.onreadystatechange=function(){
    if(http.readyState==4){
      var vl_c_datas=http.responseText;
      if (vl_c_datas!=-1) {
        var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=modifier&";
        pf_affiche_donnees_relations();
        fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
      }
    }
  };
  http.send(null);
}
function pf_maintenant(vv_qui) {
  var ladate_deb=new Date();
  var vl_c_date=ladate_deb.getFullYear()+"-"+(ladate_deb.getMonth()+1)+"-"+ladate_deb.getDate();
  var vl_c_heur=ladate_deb.getHours()+":"+fa_padleft('0', 2,ladate_deb.getMinutes().toString())+":"+fa_padleft('0', 2,ladate_deb.getSeconds().toString());
  switch (vv_qui) {
    case "tb_debut_maintenant" :
      fa_value_set('dp_dat_deb',vl_c_date);
      fa_value_set('tb_heu_deb',vl_c_heur);
      break;
    case "tb_debut_maintenant_fabriq" :
      fa_value_set('dp_dat_deb_fabriq',vl_c_date);
      fa_value_set('tb_heu_deb_fabriq',vl_c_heur);
      break;
    case "tb_fin_maintenant" :
      fa_value_set('dp_dat_fin',vl_c_date);
      fa_value_set('tb_heu_fin',vl_c_heur);
      break;
	case "tb_debut_maintenant_fabriq_ligne":
      fa_value_set('dp_dat_deb_fabriq_ligne',vl_c_date);
      fa_value_set('tb_heu_deb_fabriq_ligne',vl_c_heur);
      break;
  }
}
function pf_ouvre_acteur_recup(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  var vl_c_param="vl_e_act_cleunik="+vl_act_cleunik+"&genreacteur="+vf_c_qui+"&p02=Fen_00425";
  fa_ouvre(c_script_fen_interlo_simple_02+vl_c_param,1024,630)
}
function pf_ouvre(vv_quoi_01,vv_quoi_02) {
  if (pf_validation('enregistrer')==false) {return;};
  var vl_c_param='&raf_random='+Math.random()+'&';
  switch (vv_quoi_01) {
    case "commentaires":
      vl_c_param+='vf_e_action_cleunik='+vf_e_action_cleunik+'&';
      vl_c_param+='vf_e_commentaire_cleunik=-1&';
      vl_c_param+='genreacteur='+vv_quoi_02+"&";
      vl_c_param+='vf_c_datedebut='+fa_enc(fa_value_get("dp_dat_deb"))+"&";
      vl_c_param+='vf_c_heuredebut='+fa_enc(fa_value_get("tb_heu_deb"))+"&";
      //alert(vl_c_param)
      switch (vv_quoi_02) {
        case 'moimoi':fa_ouvre(vf_c_fen_commentaires+vl_c_param,400,350);break;
        case 'princi':fa_ouvre(vf_c_fen_commentaires+vl_c_param,400,350);break;
        case 'favori':fa_ouvre(vf_c_fen_commentaires+vl_c_param,800,650);break;
      }
      break;
    case "critere_entreprise":
      vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
      vl_c_param+='genrecritere=entreprise&';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600)
      break;
    case "critere_lesmiens":
      if (pf_validation('enregistrer')==false) {return;};
      vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
      vl_c_param+='genrecritere=moi&';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600)
      break;
    case "graal":
      if (pf_validation('enregistrer')==false) {return;};
      vl_c_param+='vl_e_action_cleunik='+vf_e_action_cleunik+'&';
      switch (vv_quoi_02){
        case "moi":           vl_c_param+="genreacteur=moimoi&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_888888":vl_c_param+="genreacteur=favori&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_999999":vl_c_param+="genreacteur=tousss&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110000":vl_c_param+="genreacteur=110000&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110001":vl_c_param+="genreacteur=110001&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110002":vl_c_param+="genreacteur=110002&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110003":vl_c_param+="genreacteur=110003&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110004":vl_c_param+="genreacteur=110004&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110005":vl_c_param+="genreacteur=110005&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,650);break;
        case "interlo_110006":vl_c_param+="genreacteur=110006&";fa_ouvre(vf_c_fen_graal_selection_interlo+vl_c_param,800,550);break;
        case "acteur_888888":vl_c_param+="genreacteur=favori&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_999999":vl_c_param+="genreacteur=tousss&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110000":vl_c_param+="genreacteur=110000&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110001":vl_c_param+="genreacteur=110001&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110002":vl_c_param+="genreacteur=110002&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110003":vl_c_param+="genreacteur=110003&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110004":vl_c_param+="genreacteur=110004&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110005":vl_c_param+="genreacteur=110005&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        case "acteur_110006":vl_c_param+="genreacteur=110006&";fa_ouvre(vf_c_fen_graal_selection_acteur+vl_c_param,800,650);break;
        }
      break;
    case "lieu":
      if (fa_value_get('tb_lieu')!="") {fa_ouvre(fa_value_get('tb_lieu'));}
      break;
    case "relation":
      if (pf_validation('enregistrer')==false) {return;};
      switch (vv_quoi_02){
        case "nouveau":
          alert("Fonctionnalité en développement...");
          return;
          break;
        case "ouvrir":
          vl_c_param+='vl_e_action_cleunik_droite='+vf_e_action_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_droite='+vf_e_choix_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_gauche='+vf_e_choix_cleunik_gauche+'&';
          vl_c_param+='vl_e_action_cleunik_gauche='+vf_e_action_cleunik_gauche+'&';
          fa_ouvre(vf_c_fen_relations_fiche+vl_c_param,600,330);
          break;
        case "liee":
          var vl_e_action_cleunik="";
          if (vf_e_action_cleunik!=vf_e_action_cleunik_droite) {vl_e_action_cleunik=vf_e_action_cleunik_droite;} else {vl_e_action_cleunik=vf_e_action_cleunik_gauche;}
          var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_e_action_cleunik)+"&vf_c_action=modifier&genreaction=jenesaispas&";
          fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
          break;
				case "voir":
          var vl_e_action_cleunik="";
          if (vf_e_action_cleunik!=vf_e_action_cleunik_droite) {vl_e_action_cleunik=vf_e_action_cleunik_droite;} else {vl_e_action_cleunik=vf_e_action_cleunik_gauche;}
		      var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_e_action_cleunik)+"&vf_c_action=modifier&genreaction=jenesaispas&";
		      fa_att_set("graal_iframe_visu_action_relation","src",vf_c_script_fen_action+vl_c_donnees);
          break;
      }
      break;
  }
}
function pf_parcours_fichier_xml_nomenclature_fab(noeudxml,xulnode){
  var treeItem = fa_crexul("treeitem");
  var treeRow  = fa_crexul("treerow");
  var treeCell_01 = fa_crexul("treecell");
  var treeCell_02 = fa_crexul("treecell");
  treeCell_01.setAttribute("label",noeudxml.getAttribute("label"));
  treeCell_01.setAttribute("properties",noeudxml.getAttribute("properties"));
  treeCell_01.setAttribute("value",noeudxml.getAttribute("_graal_cleunik_fils"));
  treeCell_02.setAttribute("value",noeudxml.getAttribute("_graal_cleunik_pere"));
  treeCell_02.setAttribute("label",noeudxml.getAttribute("_graal_cleunik_noligne"));
  treeRow.appendChild(treeCell_01);
  treeRow.appendChild(treeCell_02);
  treeItem.appendChild(treeRow);
  xulnode.appendChild(treeItem);
  if(noeudxml.hasChildNodes){                                                           /* encore des noeuds à lire ?*/
    for(var i=0;i<noeudxml.childNodes.length;i++){                                      /* bouclons */
      if(noeudxml.childNodes[i].nodeType==1){                                           /* On ne lit que les éléments */
        if(!fa_est_conteneur(treeItem)){ fa_nouvelle_branche(treeItem); }               /* Il y a des enfants, on crèe une nouvelle branche */
        pf_parcours_fichier_xml_nomenclature_fab(noeudxml.childNodes[i],treeItem.childNodes[1]); /* parcours récursif */
      }
    }
  }
}
function pf_pdf() {
  fa_ouvre(vl_c_script_pdf_action+"vl_e_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&");
}
function pf_raz_fiche() {
  vf_e_action_cleunik=-1;
  fa_value_set('tb_sujet',"");
  fa_value_set('tb_reference',"");
  fa_value_set('tb_description',"");
  fa_value_set('dp_dat_deb',"");
  fa_value_set('dp_dat_fin',"");
  fa_value_set('tb_heu_deb',"");
  fa_value_set('tb_heu_fin',"");
  fa_value_set('tb_lieu',"");
  fa_value_set('tb_blocnotebrut',"");
  fa_value_set('la_dateheurecreation',"");
  fa_value_set('la_dateheuremodification',"");
  fa_das("criteres_des_actions_entreprise","");fa_das("criteres_des_actions_lesautres","");fa_das("criteres_des_actions_lesmiens","");fa_das("criteres_des_actions_tous","");
  fa_das("arbre_des_ged", '');
  //fa_att_set("if_commentaires","src","_graal_page_blanche_01.php");
	fa_att_set("tab_graal","label","$vl_c_ben_103");
	fa_att_set("tab_graal_actions","label","$vl_c_ben_125");
	fa_att_set("tab_criteres","label","$vl_c_ben_102");
	fa_att_set("tab_ged","label","$vl_c_ben_104");
}
function pf_retour_fenetre_dossiers(vv_t_tableau_cleunik) {
  var vl_e_nb_sel=vv_t_tableau_cleunik.length;
  if (vl_e_nb_sel!=0) {
	for(var i=0;i<vl_e_nb_sel;i++){                      /* loop 'em */
      var vl_c_donnees=vv_t_tableau_cleunik[i]+"&cleunik_insertion_dossier="+fa_enc(vf_e_action_cleunik)+"&label_insertion_dossier="+fa_enc(fa_value_get("tb_sujet"));
      fa_xmlhttprequest_txt(c_bdope_dossiers+vl_c_donnees,"",pf_retour_fenetre_dossiers_fin);
    }
  }
}
function pf_retour_fenetre_dossiers_fin(stream){
	alert(stream)
}
function pf_sel_arbre_actions() {
  var i=fa_cui("arbre_des_actions");if(i==-1){return;}
  if(fa_est_grise("bt_detailler")==true) {return};
  vf_e_action_cleunik=fa_cell_get("arbre_des_actions",i,"action_cleunik");
  var s =fa_enc("vl_e_action_cleunik")+"="+fa_enc(vf_e_action_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml_art,s,pf_affiche_donnees_actions_infogene);
}
function pf_sel_arbre_ged() {}
function pf_sel_arbre_relations() {
  var i=fa_cui("arbre_relations");if(i==-1){return;}
  vf_e_action_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_action_cleunik_droite");
  vf_e_action_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_action_cleunik_gauche");
  vf_e_choix_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_droite");
  vf_e_choix_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_gauche");
}
function pf_sel_ligne_arbre_graal() {
  var vl_t_interlocuteur=[];
  var vl_t_acteur=[];
  var i=fa_cui("arbre_graal");if(i==-1){return;}
  var vl_portee=fa_cell_get("arbre_graal",i,"portee_graal");
  switch (vl_portee) {
    case "$vl_e_interl" :
      vl_t_interlocuteur[0]=fa_cell_get("arbre_graal",i,"int_cleunik_graal");
      fa_att_set("if_carteviste","src",vf_c_script_cartes_visites+'vl_c_type=0&vl_c_actif=5&vl_t_listecles='+fa_jsarray2php_00(vl_t_interlocuteur)+'&'+"vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&");
      break;
    case "$vl_e_acteur" :
      vl_t_acteur[0]=fa_cell_get("arbre_graal",i,"act_cleunik_graal");
      fa_att_set("if_carteviste","src",vf_c_script_cartes_visites+'vl_c_type=2&vl_c_actif=6&vl_t_listecles='+fa_jsarray2php_00(vl_t_acteur)+'&'+"vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&");
      break;
  }
}
function pf_telecharge(){
	pf07_telecharge()
}
function pf_top_model(vv_quoi,vv_qui) {
  if (vv_quoi==-1) {return;}
  var s ="vl_e_modele="+vv_quoi+"&raf="+Math.random();
  switch (vv_qui) {
    case "ente":fa_xmlhttprequest_xml(vf_c_script_edite_modeles_entete_pied,s,pf_top_model_fin_ente);break;
    case "pied":fa_xmlhttprequest_xml(vf_c_script_edite_modeles_entete_pied,s,pf_top_model_fin_pied);break;
  }
}
function pf_top_model_fin_ente(stream) {
  var vl_c_datas=stream;
  var vl_c_chaine=fa_xml_get(vl_c_datas,'blocnote_riche');
  var vl_c_sortie=vl_c_chaine.replace(/<br>/g, "$var_rc");
  fa_value_set("tb_blocnotebrut_entete",vl_c_sortie);
}
function pf_top_model_fin_pied(stream) {
  var vl_c_datas=stream;
  var vl_c_chaine=fa_xml_get(vl_c_datas,'blocnote_riche');
  var vl_c_sortie=vl_c_chaine.replace(/<br>/g, "$var_rc");
  fa_value_set("tb_blocnotebrut_pied",vl_c_sortie);
}
function pf_unload(){
	$pf_unload
}
function pf_validation(vv_quoi) {
  var vl_c_donnees="";
  var vl_c_nature_action="";
  vl_c_donnees+="vl_description="+fa_enc(fa_value_get("tb_description"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_sujet="+fa_enc(fa_value_get("tb_sujet"))+"&";
  vl_c_donnees+="vl_reference="+fa_enc(fa_value_get("tb_reference"))+"&";
  vl_c_donnees+="vl_dat_deb="+fa_enc(fa_value_get("dp_dat_deb")+" "+fa_value_get("tb_heu_deb"))+"&";
  vl_c_donnees+="vl_dat_fin="+fa_enc(fa_value_get("dp_dat_fin")+" "+fa_value_get("tb_heu_fin"))+"&";

  vl_c_donnees+="vl_lieu="+fa_enc(fa_value_get("tb_lieu"))+"&";
  vl_c_donnees+="vl_genre="+fa_enc(fa_mlget("ml_genre_action"))+"&";
  vl_c_donnees+="vl_statut="+fa_enc(fa_mlget("ml_statut_action"))+"&";
  vl_c_donnees+="vl_confidentialite="+fa_enc(fa_mlget("ml_confidentialite_action"))+"&";
  vl_c_donnees+="vl_priorite="+fa_enc(fa_mlget("ml_priorite_action"))+"&";
	vl_c_donnees+="vl_gestion_duree="+fa_enc(fa_value_get("rdg_duree"))+"&";
  switch(vv_quoi) {
    case "enregistrer":
      if ((fa_value_get("dp_dat_deb")=='') && (fa_value_get("dp_dat_fin")=='')){alert("$vl_c_ben_191");return false;}
      if (vf_e_action_cleunik!=-1){
        vf_c_action="modification";
        vl_c_nature_action="&vf_c_action=modifier&vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&";
        }
      else {
      	vl_c_nature_action="&vf_c_action=ajouter&vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&";
      	vf_c_action="ajout";
      }
      break;
    case "supprimer":
        if(confirm("$vl_c_ben_147") == false) return;
        vl_c_nature_action="&vf_c_action=supprimer&vl_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&";
        vf_c_action="suppression";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_action+vl_c_nature_action,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
