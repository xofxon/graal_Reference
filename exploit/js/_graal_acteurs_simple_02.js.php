<?php
$vl_c_bnv_156_js=fa_recup_dico_js("bnv_156");
$vl_c_bnv_157_js=fa_recup_dico_js("bnv_157");

echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_acteurs_01.php";
const c_script_verif="_graal_verifie_mail_02.php?";
const c_script_tableau="_graal_fen_rech_courriel_01.php?genreacteur=plusie&refweb=";
const c_script_verif_deja="_graal_bdope_act_interlo_mail_01.php";
const vf_c_script_bdope_fen_tel="_graal_bdope_act_interlo_tel_01.php";
const c_script_tableau_tel="_graal_fen_rech_tel_01.php?genreacteur=plusie&reftel=";
const vf_c_script_bdope_fen_fax="_graal_bdope_act_interlo_fax_01.php";
const c_script_tableau_fax="_graal_fen_rech_fax_01.php?genreacteur=plusie&reftel=";

var vf_c_action;
function pf_aa_init(){
  fa_sep("tb_adr_latitude");
  fa_sep("tb_adr_longitude");
  pf_etat_fen("ajouter");
}
function pf_alimente_defaut(){
  fa_gid("ml_mail_00").selectedIndex=0;
  fa_gid("ml_civilites").selectedIndex=0;
  fa_value_set("tb_refweb_courriel","$vl_c_refweb");
  fa_value_set("tb_blocnotebrut_courriel","")
  fa_value_set("rdg_actif_interlo",1);
  fa_value_set("rdg_defaut_interlo",1) 
  fa_value_set("rdg_actif_courriel",1);
  fa_value_set("rdg_veuxpasdemail_courriel",3);  
  fa_value_set("rdg_actif_fax",1);
  fa_value_set("rdg_actif_tel",1);
  fa_value_set("rdg_valide_courriel",3);
  fa_value_set("rdg_portable_tel",2);
  fa_value_set("rdg_sms_tel",2);
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "ajouter":
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("tb_raisonsoc");
      break;
    case "annuler":
      pf_raz_fiche();
      pf_etat_fen("ajouter");
      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
}
function pf_raz_fiche(){
  fa_value_set("tb_codealphanum15","");
  fa_value_set("tb_raisonsoc","");
  fa_value_set("tb_blocnotebrut_acteur","");
  fa_value_set("tb_siret","");
  fa_value_set("tb_nomcommercial","");
  fa_value_set("tb_mnemotechnique","");
  fa_value_set("tb_codealphanum15_interlo","");
  fa_value_set("tb_patronyme_interlo","");
  fa_value_set("tb_blocnotebrut_interlo","");
  fa_value_set("tb_prenom_interlo","");

  fa_value_set("tb_telformate_tel","");
  fa_value_set("tb_blocnotebrut_tel","");

  fa_value_set("tb_telformate_fax","");
  fa_value_set("tb_blocnotebrut_fax","");
  fa_value_set("rdg_portable_tel",2);
  fa_value_set("rdg_sms_tel",2);
	pf_alimente_defaut();

}
function pf_validation(vv_quoi) {
  if (fa_value_get("tb_raisonsoc")+fa_value_get("tb_nomcommercial")=="") {alert("Il faut renseigner un minimum l'acteur.");fa_focusdonne("tb_raisonsoc");return;}
  if (fa_value_get("tb_patronyme_interlo")+fa_value_get("tb_prenom_interlo")=="" && (fa_value_get("tb_refweb_courriel")!="" || fa_value_get("tb_telformate_tel")!="" || fa_value_get("tb_telformate_fax"))) {alert("Il faut renseigner un minimum l'interlocuteur");fa_focusdonne("tb_prenom_interlo");return;}
  if (fa_value_get("tb_adr_ligne1")+fa_value_get("tb_adr_ligne2")+fa_value_get("tb_adr_ligne3")!=""){
  	if (parseInt(fa_att_get("cb_adresse_00","_graal_adr_typecoordonnees"))==0) {
        	if (!confirm("Vous n'avez pas déterminé de type d'adresse. Souhaitez-vous continuer ?")){return;}
    }
  }
  vl_c_donnees="";
  vl_c_donnees+="vl_act_cleunik=-1&vf_c_action=ajouter_simple_courriel_tel_fax&";vf_c_action='ajout';
  // Données acteur
  vl_c_donnees+="vl_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15"))+"&";
  vl_c_donnees+="vl_raisonsoc="+fa_enc(fa_value_get("tb_raisonsoc"))+"&";
  vl_c_donnees+="vl_nomcommercial="+fa_enc(fa_value_get("tb_nomcommercial"))+"&";
  vl_c_donnees+="vl_siret="+fa_enc(fa_value_get("tb_siret"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut_acteur"))+"&";
  vl_c_donnees+="vl_typeacteur="+fa_enc($vl_c_genreacteur)+"&";
  vl_c_donnees+="vl_mnemotechnique="+fa_enc(fa_value_get("tb_mnemotechnique"))+"&";
  vl_c_donnees+="vl_modegestion="+fa_enc(fa_mlget("ml_mode","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_devise="+fa_enc(fa_mlget("ml_devise","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_actif=1&";
  //  Données Adresse postale
  vl_c_donnees+="vl_adr_cod="+fa_enc(fa_value_get("tb_adr_cod"))+"&";
  vl_c_donnees+="vl_adr_complementnom="+fa_enc(fa_value_get("tb_adr_complementnom"))+"&";
  vl_c_donnees+="vl_adr_ligne1="+fa_enc(fa_value_get("tb_adr_ligne1"))+"&";
  vl_c_donnees+="vl_adr_ligne2="+fa_enc(fa_value_get("tb_adr_ligne2"))+"&";
  vl_c_donnees+="vl_adr_ligne3="+fa_enc(fa_value_get("tb_adr_ligne3"))+"&";
  vl_c_donnees+="vl_adr_cp="+fa_enc(fa_value_get("tb_adr_cp"))+"&";
  vl_c_donnees+="vl_adr_ville="+fa_enc(fa_value_get("tb_adr_ville"))+"&";
  vl_c_donnees+="vl_choix_cleunik_pays="+fa_enc(fa_mlget("ml_pays","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_adr_latitude="+fa_enc(fa_value_get("tb_adr_latitude"))+"&";
  vl_c_donnees+="vl_adr_longitude="+fa_enc(fa_value_get("tb_adr_longitude"))+"&";
  vl_c_donnees+="vl_adr_typecoordonnees="+fa_enc(fa_att_get("cb_adresse_00","_graal_adr_typecoordonnees"))+"&";
  //  Données interlocuteur
  vl_c_donnees+="vl_codealphanum15_interlo="+fa_enc(fa_value_get("tb_codealphanum15_interlo"))+"&";
  vl_c_donnees+="vl_patronyme="+fa_enc(fa_value_get("tb_patronyme_interlo"))+"&";
  vl_c_donnees+="vl_blocnotebrut_interlo="+fa_enc(fa_value_get("tb_blocnotebrut_interlo"))+"&";
  vl_c_donnees+="vl_prenom="+fa_enc(fa_value_get("tb_prenom_interlo"))+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_civilites","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_infodefaut="+fa_enc(fa_value_get('rdg_defaut_interlo'))+"&";
  vl_c_donnees+="vl_actif_interlo="+fa_enc(fa_value_get('rdg_actif_interlo'))+"&";
  vl_c_donnees+="vl_fonction="+fa_enc(fa_mlget("ml_fonctions","_graal_cleunik"))+"&";
  // Données courriel
  vl_c_donnees+="vl_refweb="+fa_enc(fa_value_get("tb_refweb_courriel"))+"&";
  vl_c_donnees+="vl_blocnotebrut_courriel="+fa_enc(fa_value_get("tb_blocnotebrut_courriel"))+"&";
  vl_c_donnees+="vl_infofavori="+fa_enc(fa_value_get('rdg_actif_courriel'))+"&";
  vl_c_donnees+="vl_choix_cleunik_courriel="+fa_enc(fa_mlget("ml_mail_00","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_veuxpasdemail="+fa_enc(fa_value_get('rdg_veuxpasdemail_courriel'))+"&";
  vl_c_donnees+="vl_valide="+fa_enc(fa_value_get('rdg_valide_courriel'))+"&";
  //  Données téléphone
  vl_c_donnees+="vl_telformate_tel="+fa_enc(fa_value_get("tb_telformate_tel"))+"&";
  vl_c_donnees+="vl_blocnotebrut_tel="+fa_enc(fa_value_get("tb_blocnotebrut_tel"))+"&";
  vl_c_donnees+="vl_infofavori_tel="+fa_enc(fa_value_get('rdg_actif_tel'))+"&";
  vl_c_donnees+="vl_choix_cleunik_tel="+fa_enc(fa_mlget("ml_tel_00","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_prefixe_choix_cleunik_tel="+fa_enc(fa_mlget("ml_prefixe_tel_00","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_portable_tel="+fa_enc(fa_value_get("rdg_portable_tel"))+"&";
  vl_c_donnees+="vl_sms_tel="+fa_enc(fa_value_get("rdg_sms_tel"))+"&";
  //  Données fax
  vl_c_donnees+="vl_telformate_fax="+fa_enc(fa_value_get("tb_telformate_fax"))+"&";
  vl_c_donnees+="vl_blocnotebrut_fax="+fa_enc(fa_value_get("tb_blocnotebrut_fax"))+"&";
  vl_c_donnees+="vl_infofavori_fax="+fa_enc(fa_value_get('rdg_actif_fax'))+"&";
  vl_c_donnees+="vl_choix_cleunik_fax="+fa_enc(fa_mlget("ml_fax_00","_graal_cleunik"))+"&";
  vl_c_donnees+="vl_prefixe_choix_cleunik_fax="+fa_enc(fa_mlget("ml_prefixe_fax_00","_graal_cleunik"))+"&";
  fa_bgc("bt_enregistrer",'red')
  fa_grise_oui("bt_enregistrer");
  fa_xhr_validation(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
  }
function pf_validation_fin(stream){
  var vl_datas = stream;
  if (window.opener!=null) {
    switch ("$vl_c_p02") {
      case "Fen_00425":
        try {
          window.opener.pf_cree_acteur_ok(vl_datas);
          } catch(e){}
        break;
        
    }
    pf_etat_fen("sortir");  
  }
  fa_bgc("bt_enregistrer",'init')
  fa_grise_non("bt_enregistrer")
  pf_etat_fen("ajouter")

}
function pf_verifie(){
  var vl_t_mail=[];
  var vl_c_param="";
  vl_t_mail[0]=window.btoa(fa_value_get("tb_refweb_courriel"));
  vl_c_param+='vl_t_listemail='+fa_enc(fa_jsarray2php_00(vl_t_mail))+"&";
  vl_c_param+='vl_type_sortie=texte'+"&raf="+Math.random()+'vl_modif=non&';
	fa_grise_fenetre("","oui");
	fa_xmlhttprequest_txt(c_script_verif+vl_c_param,"",pf_verifie_fin);
}
function pf_verifie_fin(stream){
	var vl_c_sortie=stream;
	vl_c_sortie=vl_c_sortie.replace(/&nbsp;/g,' ');
	vl_c_sortie=vl_c_sortie.replace(/<br>/g,'\\r\\n');
	vl_c_sortie=vl_c_sortie.replace(/<BR>/g,'\\r\\n');
	fa_value_set("tb_cr_verification",vl_c_sortie);
	fa_grise_fenetre("","non");
}
function pf_verifie_deja_refweb(){
	fa_grise_fenetre("","oui");
	var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_refweb="+fa_enc(fa_value_get("tb_refweb_courriel"))+"&";
	vl_c_donnees+="vf_c_action=existe&"
	fa_xhr_validation(c_script_verif_deja,vl_c_donnees,pf_verifie_deja_refweb_fin);
}
function pf_verifie_deja_refweb_fin(stream){
	switch (stream){
		case "0":
			fa_att_set("tb_courriel_verif_deja","label","$vl_c_bnv_156_js");
			fa_att_set('tb_courriel_verif_deja','tooltiptext',"$vl_c_bnv_156_js");
			fa_att_rem("tb_courriel_verif_deja","oncommand");
			fa_att_set("tb_courriel_verif_deja","oncommand","pf_verifie_deja_refweb();");
			break;
		default:
			fa_att_set("tb_courriel_verif_deja","label",stream+" $vl_c_bnv_157_js");
			fa_att_set('tb_courriel_verif_deja','tooltiptext',"$vl_c_bnv_157_js");
			fa_att_rem("tb_courriel_verif_deja","oncommand");
			fa_att_set("tb_courriel_verif_deja","oncommand","pf_voir_deja_refweb(1);");									
			break;
	}
	fa_grise_fenetre("","non");
}
function pf_voir_deja_refweb(vv_quoi){
	switch (vv_quoi){
		case 1:
			fa_ouvre(c_script_tableau+fa_enc(fa_value_get("tb_refweb_courriel")));
			break;
		default:
			break;
	}
}
function pf_verifie_deja_tel_01(){
	fa_grise_fenetre("","oui");
	var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_telformate="+fa_enc(fa_value_get('tb_telformate_tel'))+"&";
	vl_c_donnees+="vf_c_action=existe&"
	fa_xhr_validation(vf_c_script_bdope_fen_tel,vl_c_donnees,pf_verifie_deja_reftel_01_fin);
}
function pf_verifie_deja_reftel_01_fin(stream){
	switch (stream){
		case "0":
			fa_att_set("tb_tel_01_verif_deja","label","$vl_c_bnv_156_js");
			fa_att_set('tb_tel_01_verif_deja','tooltiptext',"$vl_c_bnv_156_js");
			fa_att_rem("tb_tel_01_verif_deja","oncommand");
			fa_att_set("tb_tel_01_verif_deja","oncommand","pf_verifie_deja_tel_01();");
			break;
		default:
			fa_att_set("tb_tel_01_verif_deja","label",stream+" $vl_c_bnv_157_js");
			fa_att_set('tb_tel_01_verif_deja','tooltiptext',stream+" $vl_c_bnv_157_js");
			fa_att_rem("tb_tel_01_verif_deja","oncommand");
			fa_att_set("tb_tel_01_verif_deja","oncommand","pf_voir_deja_reftel('tb_telformate_tel');");
			break;
	}
	fa_grise_fenetre("","non");
}
function pf_voir_deja_reftel(vv_quoi){
	fa_ouvre(c_script_tableau_tel+fa_enc(fa_value_get(vv_quoi)));
}
function pf_verifie_deja_fax_01(){
	fa_grise_fenetre("","oui");
	var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_telformate="+fa_enc(fa_value_get('tb_telformate_fax'))+"&";
	vl_c_donnees+="vf_c_action=existe&"
	fa_xhr_validation(vf_c_script_bdope_fen_fax,vl_c_donnees,pf_verifie_deja_reffax_01_fin);
}
function pf_verifie_deja_reffax_01_fin(stream){
	switch (stream){
		case "0":
			fa_att_set("tb_fax_01_verif_deja","label","$vl_c_bnv_156_js");
			fa_att_set('tb_fax_01_verif_deja','tooltiptext',"$vl_c_bnv_156_js");
			fa_att_rem("tb_fax_01_verif_deja","oncommand");
			fa_att_set("tb_fax_01_verif_deja","oncommand","pf_verifie_deja_fax_01();");
			break;
		default:
			fa_att_set("tb_fax_01_verif_deja","label",stream+" $vl_c_bnv_157_js");
			fa_att_set('tb_fax_01_verif_deja','tooltiptext',"$vl_c_bnv_157_js");
			fa_att_rem("tb_fax_01_verif_deja","oncommand");
			fa_att_set("tb_fax_01_verif_deja","oncommand","pf_voir_deja_reffax('tb_telformate_fax');");
			break;
	}
	fa_grise_fenetre("","non");
}
function pf_voir_deja_reffax(vv_quoi){
	fa_ouvre(c_script_tableau_fax+fa_enc(fa_value_get(vv_quoi)));
}
]]></script>
END;
?>
