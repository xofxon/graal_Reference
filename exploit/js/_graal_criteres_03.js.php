<?php
$vl_c_00002=fa_recup_session('mess_00002','');
switch ($vl_e_cleunik_critere){
  case 94 : $vl_c_id_fenetre="Fen_00208";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Genres d'actions
  case 95 : $vl_c_id_fenetre="Fen_00436";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Nature des Relations entre actions et interlocuteurs/acteurs
  case 122: $vl_c_id_fenetre="Fen_00422";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Confidentialités d'actions
  case 123: $vl_c_id_fenetre="Fen_00423";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Priorités d'actions
  case 124: $vl_c_id_fenetre="Fen_00424";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Statuts d'actions
  case 125: $vl_c_id_fenetre="Fen_00443";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Relations entre actions
  case 129: $vl_c_id_fenetre="Fen_00488";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Statuts des lignes d'actions commerciales
  case 137: $vl_c_id_fenetre="Fen_00647";$vl_c_focusdonne="tb_choix_code";break; //Modes de paiement
  case 138: $vl_c_id_fenetre="Fen_00648";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Types de paiement
  case 139: $vl_c_id_fenetre="Fen_00658";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Types de ports
  case 141: $vl_c_id_fenetre="Fen_00716";$vl_c_focusdonne="tb_choix_code";break; //Intitulés des demandes sur formulaires internet
  case 145: $vl_c_id_fenetre="Fen_00941";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Options de remises en banque
  case 146: $vl_c_id_fenetre="Fen_00943";$vl_c_focusdonne="tb_choix_valeur_texte_01";break; //Types d'écarts de réglement
}
switch ($vl_e_cleunik_critere){
  case 94 : //Genres d'actions
  	case 122: //Confidentialité des actions
  case 123: //Priorités d'actions
  case 124: //Statuts d'actions
  case 129: //Statuts de lignes commerciales
$js_bloc_couleur_01=<<<EOT
fa_value_set('tb_choix_couleur',fa_xml_get(vl_c_datas,'choix_couleur'));
  fa_gid("tb_choix_couleur").inputField.style.backgroundColor=fa_value_get("tb_choix_couleur");
EOT;
$js_bloc_couleur_02=<<<EOT
function pf_selectionne_couleur(vv_qui){
	switch (vv_qui) {
		case "cp_choix_couleur":
		  fa_value_set("tb_choix_couleur",fa_att_get("cp_choix_couleur","color"));
		  //fa_gid("tb_choix_couleur").inputField.style.backgroundColor=fa_value_get("tb_choix_couleur");
		break;
	}
}
EOT;
$js_bloc_couleur_03=<<<EOT
s +="vl_c_choix_couleur="+fa_enc(fa_value_get('tb_choix_couleur'))+"&";
EOT;
$js_bloc_couleur_04=<<<EOT
window.location=document.location;
EOT;
  	break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
****************************************************************
**********  Fenêtre de gestion des critères d'actions  ********
****************************************************************
*/
const vf_c_url_arbre='_graal_das_choix_critere_01.php?genre=graal&';
const vf_c_script_edite='_graal_xml_choix_criteres_01.php?';
const vf_c_script_stats="_graal_fen_graphiques_stat_01.php?critere_cleunik=$vl_e_cleunik_critere&genre=criteres&";
const vf_c_script_bdope_criteres='_graal_bdope_choix_criteres_01.php?';
const vf_e_critere_cleunik="$vl_e_cleunik_critere";
var vf_e_nombre_utilisations,vf_e_choix_cleunik;
var vf_c_arbre;

function pf_affiche_datas(stream){
  var vl_c_datas,vl_c_type_acteurs;
  var vl_e_nombre,vl_e_portee;
  pf_raz_fiche()
  vl_c_datas = stream;
  fa_value_set('tb_choix_valeur_texte_01',fa_xml_get(vl_c_datas,'choix_valeur_texte_01'));
  fa_value_set('tb_choix_code',fa_xml_get(vl_c_datas,'choix_code'));
  $js_bloc_couleur_01
  vf_e_choix_cleunik=fa_xml_get(vl_c_datas,'choix_cleunik');
  switch(fa_xml_get(vl_c_datas,'choix_actif')) {
   case "1": fa_att_set('ra_choix_actif_oui',"selected", 'true');break;
   case "2": fa_att_set('ra_choix_actif_non','selected', 'true');break;
  }
  vf_e_nombre_utilisations=fa_xml_get(vl_c_datas,'nombre_utilisations_1');
  fa_value_set("la_nbutilisations",fa_att_get("la_nbutilisations","_graal_value")+" :"+vf_e_nombre_utilisations);
}
function pf_alimente_defaut(){
  fa_att_set('ra_choix_actif_oui',"selected", 'true');
}
function pf_etat_fen(vv_quoi){
   var vl_e_rowIndex;
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_c_arbre = fa_gid('arb_choix_criteres');
       fa_value_set('rdg_etat',"2");
       fa_value_set('rdg_position',"2");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf06_alimente_table_bbb();
       break;
     case "selectionner":
       vl_e_rowIndex=vf_c_arbre.currentIndex;
      if(vl_e_rowIndex == -1){
        return;
      }
     if ((vf_e_nombre_utilisations==0) && (vf_e_choix_cleunik > 0)) {
      fa_grise_non("bt_supprimer");
     }
     else{
     fa_grise_oui("bt_supprimer");
     }
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     fa_grise_groupe_oui('broadcaster_01');
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf_raz_fiche();
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("$vl_c_focusdonne");
       break;
     case "modifier":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("$vl_c_focusdonne");
       break;
     case "sortir":
     window.close();
     break;   
}
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  $js_bloc_couleur_04
  if (vl_datas=='ok') {pf06_alimente_table_bbb();}else{fa_erreur(vl_datas);}
  pf_etat_fen('annuler');
}
function pf_ouvre_stats() {
  fa_ouvre(vf_c_script_stats)
}
function pf_raz_fiche(){
  fa_att_rem('ra_choix_actif_oui','selected');
  fa_att_rem('ra_choix_actif_non','selected');
  fa_value_set('tb_choix_code','');
  fa_value_set('tb_choix_valeur_texte_01','');
  fa_value_set('tb_choix_couleur','');
  vf_e_choix_cleunik=0;
}
$js_bloc_couleur_02
function pf_validation(vv_quoi){
  var s;
  var vl_c_portee,vl_c_choix_actif;
  vl_c_portee=2048;
  vl_c_choix_actif=fa_value_get('rdg_actif');
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  switch(vv_quoi) {
    case "enregistrer":
      s ="vl_c_action="+fa_enc(vf_c_action)+"&";
      s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
      s +="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
      s +="vl_c_choix_actif="+fa_enc(vl_c_choix_actif)+"&";
      s +="vl_c_portee="+vl_c_portee+"&";
      s +="vl_c_code="+fa_enc(fa_value_get('tb_choix_code'))+"&";
      s +="vl_c_choix_valeur_texte_01="+fa_enc(fa_value_get('tb_choix_valeur_texte_01'))+"&";
      $js_bloc_couleur_03
      break;
    case "supprimer":
      Check = confirm("$vl_c_00002");
      if(Check == false) return;
      s ="vl_c_action=supprimer&";
      s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
