<?php
$vl_c_00002=fa_recup_session('mess_00002','');
$vl_c_dico00019=fa_recup_dico_js("dico_00019");
$vl_c_dico00031=fa_recup_dico_js("dico_00031");
$vl_c_dico00032=fa_recup_dico_js("dico_00032");
$vl_c_dico00033=fa_recup_dico_js("dico_00033");
$vl_c_dico00034=fa_recup_dico_js("dico_00034");
$vl_c_dico00035=fa_recup_dico_js("dico_00035");
$vl_c_dico00036=fa_recup_dico_js("dico_00036");
$vl_tb_droits_01=_graal_requete_droits_fenetre("Fen_00259",$vl_e_uti_cleunik);$vl_e_ajout_01=$vl_tb_droits_01[1];$vl_e_modif_01=$vl_tb_droits_01[2];//Membres de l'entreprise
$vl_tb_droits_02=_graal_requete_droits_fenetre("Fen_00281",$vl_e_uti_cleunik);$vl_e_ajout_02=$vl_tb_droits_02[1];$vl_e_modif_02=$vl_tb_droits_02[2];//Prospects clients
$vl_tb_droits_03=_graal_requete_droits_fenetre("Fen_00283",$vl_e_uti_cleunik);$vl_e_ajout_03=$vl_tb_droits_03[1];$vl_e_modif_03=$vl_tb_droits_03[2];//Clients
$vl_tb_droits_04=_graal_requete_droits_fenetre("Fen_00282",$vl_e_uti_cleunik);$vl_e_ajout_04=$vl_tb_droits_04[1];$vl_e_modif_04=$vl_tb_droits_04[2];//Prospects fournisseurs
$vl_tb_droits_05=_graal_requete_droits_fenetre("Fen_00284",$vl_e_uti_cleunik);$vl_e_ajout_05=$vl_tb_droits_05[1];$vl_e_modif_05=$vl_tb_droits_05[2];//fournisseurs
$vl_tb_droits_06=_graal_requete_droits_fenetre("Fen_00285",$vl_e_uti_cleunik);$vl_e_ajout_06=$vl_tb_droits_06[1];$vl_e_modif_06=$vl_tb_droits_06[2];//Autres acteurs
$vl_tb_droits_07=_graal_requete_droits_fenetre("Fen_00286",$vl_e_uti_cleunik);$vl_e_ajout_07=$vl_tb_droits_07[1];$vl_e_modif_07=$vl_tb_droits_07[2];//Acteurs indéterminés
switch ($vl_e_fausseportee){
  case '4096': //Critères de tous les interlocuteurs
		$vl_c_defaut_portee="";
    break; 
  case '1'  : $vl_c_defaut_portee="fa_check('ch_n01');";break; //Membres de l'entreprise
  case '2'  : $vl_c_defaut_portee="fa_check('ch_n02');";break; //Prospects clients
  case '4'  : $vl_c_defaut_portee="fa_check('ch_n03');";break; //Clients
  case '8'  : $vl_c_defaut_portee="fa_check('ch_n04');";break; //Prospects fournisseurs
  case '16' : $vl_c_defaut_portee="fa_check('ch_n05');";break; //fournisseurs
  case '32' : $vl_c_defaut_portee="fa_check('ch_n06');";break; //Autres acteurs
  case '64' : $vl_c_defaut_portee="fa_check('ch_n07');";break; //Acteurs indéterminés
  default :
    fa_redirige("acces_interdit");
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_url_arbre='_graal_das_criteres_interlocuteurs.php?';
const vf_c_script_edite='_graal_xml_criteres_00.php';
const vf_c_script_bdope_criteres='_graal_bdope_criteres_00.php';
var vf_e_critere_cleunik;
var vf_e_nombre_utilisations;
function pf_alimente_defaut(){
  fa_value_set('rdg_actif',"1");
  fa_value_set('rdg_multiple',"2");
  fa_value_set('rdg_horsliste',"2");
  fa_value_set('rdg_perso',"2");
  fa_value_set('rdg_codepertinent',2);
  if ($vl_e_ajout_01==0) {fa_grise_oui('ch_n01')}
  if ($vl_e_ajout_02==0) {fa_grise_oui('ch_n02')}
  if ($vl_e_ajout_03==0) {fa_grise_oui('ch_n03')}
  if ($vl_e_ajout_04==0) {fa_grise_oui('ch_n04')}
  if ($vl_e_ajout_05==0) {fa_grise_oui('ch_n05')}
  if ($vl_e_ajout_06==0) {fa_grise_oui('ch_n06')}
  if ($vl_e_ajout_07==0) {fa_grise_oui('ch_n07')}
	$vl_c_defaut_portee
}
function pf_alimente_table(){
  var raf_random=Math.random();
  var vl_c_param="";
  vl_c_param+=vf_c_url_arbre+'vl_e_portee='+fa_value_get("bcb_ml_qui");
  vl_c_param+='&raf01='+raf_random;
  vl_c_param+='&vl_c_etat='+fa_value_get('rdg_etat');
  vl_c_param+='&vl_c_position='+fa_value_get('rdg_position');
  fa_das("arb_criteres",vl_c_param);
}
function pf_change_menu() {
  var vo_list = fa_gid("bcb_ml_qui")
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"))
}
function pf_etat_fen(vv_quoi) {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_value_set('rdg_etat',2);
       fa_value_set('rdg_position',2);
       pf_alimente_defaut();
       pf_change_menu();
       pf_alimente_table();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "selectionner":
       var rowIndex = fa_cui("arb_criteres");if((rowIndex == -1) || (vf_e_critere_cleunik==0) ){return;}
     if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_ajouter");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_sortir");
       pf_raz_fiche();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_critere_code");
       break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      if ($vl_e_modif_01==0) {fa_grise_oui('ch_n01')}
      if ($vl_e_modif_02==0) {fa_grise_oui('ch_n02')}
      if ($vl_e_modif_03==0) {fa_grise_oui('ch_n03')}
      if ($vl_e_modif_04==0) {fa_grise_oui('ch_n04')}
      if ($vl_e_modif_05==0) {fa_grise_oui('ch_n05')}
      if ($vl_e_modif_06==0) {fa_grise_oui('ch_n06')}
      if ($vl_e_modif_07==0) {fa_grise_oui('ch_n07')}
      if (fa_att_get("ch_n01","_graal_nombre")!=0) {fa_grise_oui('ch_n01');}
      if (fa_att_get("ch_n02","_graal_nombre")!=0) {fa_grise_oui('ch_n02');}
      if (fa_att_get("ch_n03","_graal_nombre")!=0) {fa_grise_oui('ch_n03');}
      if (fa_att_get("ch_n04","_graal_nombre")!=0) {fa_grise_oui('ch_n04');}
      if (fa_att_get("ch_n05","_graal_nombre")!=0) {fa_grise_oui('ch_n05');}
      if (fa_att_get("ch_n06","_graal_nombre")!=0) {fa_grise_oui('ch_n06');}
      if (fa_att_get("ch_n07","_graal_nombre")!=0) {fa_grise_oui('ch_n07');}

      fa_focusdonne("tb_critere_denomination");
      break;
    case "sortir":
     window.close();
     break;   
}
}

function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!='-1') {pf_alimente_table();} else {fa_erreur(vl_datas)}
  if (window.opener!=null) { 
	  try {
	  	window.opener.pf_affiche_criteres_potentiel_interlo();
	  }
	  catch (e) {
	    try {
	  		window.opener.pf_affiche_criteres_potentiel();
	  	} catch (e) {
	    //alert(e)
	  	}
	  }
  }
  pf_etat_fen('annuler');
}
function pf_raz_fiche(){
  fa_value_set('tb_critere_code',"");
  fa_value_set('tb_critere_denomination',"");
  fa_gid("bcc_ml_type").selectedIndex=0;
  fa_value_set('rdg_actif',1);
  fa_value_set('tb_blocnotebrut',"");
  fa_value_set('rdg_multiple',2);
  fa_value_set('rdg_horsliste',2);
  fa_value_set('rdg_perso',2);
  fa_value_set('rdg_codepertinent',2);
  fa_value_set('la_dateheurecreation',"");
  fa_value_set('la_dateheuremodif',"");
  fa_uncheck('ch_n01');
  fa_uncheck('ch_n02');
  fa_uncheck('ch_n03');
  fa_uncheck('ch_n04');
  fa_uncheck('ch_n05');
  fa_uncheck('ch_n06');
  fa_uncheck('ch_n07');
  /*
  fa_grise_non('ch_n01');
  fa_grise_non('ch_n02');
  fa_grise_non('ch_n03');
  fa_grise_non('ch_n04');
  fa_grise_non('ch_n05');
  fa_grise_non('ch_n06');
  fa_grise_non('ch_n07');
  */
  fa_label('ch_n01',"$vl_c_dico00019");
  fa_label('ch_n02',"$vl_c_dico00031");
  fa_label('ch_n03',"$vl_c_dico00033");
  fa_label('ch_n04',"$vl_c_dico00032");
  fa_label('ch_n05',"$vl_c_dico00034");
  fa_label('ch_n06',"$vl_c_dico00035");
  fa_label('ch_n07',"$vl_c_dico00036");
  vf_e_critere_cleunik=0;
}
function pf_sel_ligne(vv_objet) {
  if (fa_est_grise("bt_detailler")==true) {return};
  var arbre = fa_gid(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_critere_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("critere_cleunik"));
  s ="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
  s+="vl_c_portee=acteurs&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,bcc_interlo_pf_affiche_datas);
}
function pf_validation(vv_quoi){
  var s;
  var vl_c_portee;
  vl_c_portee=4096;
  if (fa_est_coche("ch_n01")==true) {vl_c_portee+=  1};
  if (fa_est_coche("ch_n02")==true) {vl_c_portee+=  2};
  if (fa_est_coche("ch_n03")==true) {vl_c_portee+=  4};
  if (fa_est_coche("ch_n04")==true) {vl_c_portee+=  8};
  if (fa_est_coche("ch_n05")==true) {vl_c_portee+= 16};
  if (fa_est_coche("ch_n06")==true) {vl_c_portee+= 32};
  if (fa_est_coche("ch_n07")==true) {vl_c_portee+= 64};
	if (vl_c_portee==4096){alert("Vous devez sélectionner au moins une portée.");return;}
  switch(vv_quoi) {
      case "enregistrer":
         s ="vl_c_action="+fa_enc(vf_c_action)+"&";
         s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
         s +="vl_critere_code="+fa_enc(fa_value_get('tb_critere_code'))+"&";
         s +="vl_critere_denomination="+fa_enc(fa_value_get('tb_critere_denomination'))+"&"
         s +="vl_critere_type="+fa_enc(fa_gid("bcc_ml_type").selectedItem.value)+"&"
         s +="vl_critere_choixmultiples="+fa_enc(fa_value_get('rdg_multiple'))+"&"
         s +="vl_critere_blocnotebrut="+fa_enc(fa_value_get('tb_blocnotebrut'))+"&"
         s +="vl_critere_actif="+fa_enc(fa_value_get('rdg_actif'))+"&"
         s +="vl_critere_portee="+fa_enc(vl_c_portee)+"&"
         s +="vl_critere_hl="+fa_enc(fa_value_get('rdg_horsliste'))+"&"
         s +="vl_critere_perso="+fa_enc(fa_value_get('rdg_perso'))+"&"
         s +="vl_critere_codechoixpertinent="+fa_enc(fa_value_get('rdg_codepertinent'))+"&"
      break;
     case "supprimer":
       Check = confirm("$vl_c_00002");
       if(Check == false) return;
       s ="vl_c_action=supprimer&";
       s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
      break;
}
fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
