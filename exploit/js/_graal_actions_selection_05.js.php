<?php
$vl_c_bda_107_js=fa_recup_dico_js("bda_107");
$vl_c_bda_108_js=fa_recup_dico_js("bda_108");

if ("$vl_c_visu"=="oui") {
$pf_sel_ligne_visu=<<<EOT
		switch (vf_e_choix_cleunik) {
        case "-110114" : vl_c_genre="offcli";break;
        case "-110115" : vl_c_genre="demfou";break;
        case "-110108" : vl_c_genre="cdecli";break;
        case "-110109" : vl_c_genre="cdefou";break;
        case "-110110" : vl_c_genre="livcli";break;
        case "-110111" : vl_c_genre="recfou";break;
        case "-110112" : vl_c_genre="faccli";break;
        case "-110113" : vl_c_genre="facfou";break;
        case "-110116" : vl_c_genre="avocli";break;
        case "-110117" : vl_c_genre="avofin";break;
        case "-110118" : vl_c_genre="chat";break;
		case "-110119" : vl_c_genre="fabrica";break;
        case "-110103" : vl_c_genre="emimail";break;
        case "-110121" : vl_c_genre="emimail_ar";break;
        case "-110122" : vl_c_genre="emailing";break;
        case "-110102" : vl_c_genre="recmail";break;
        case "-110120" : vl_c_genre="recmail_lecture";break;
        case "-110104" : vl_c_genre="recmail_erreur";break;
        case "-110123" : vl_c_genre="formul";break;
		case "-110124" : vl_c_genre="desins_mail";break;
		case "-110125" : vl_c_genre="recvoc";break;
		case "-110126" : vl_c_genre="recfax";break;
		case "-110127" : vl_c_genre="remban";break;
		case "-110128" : vl_c_genre="emifax";break;
		case "-110129" : vl_c_genre="emisms";break;
		case "-110130" : vl_c_genre="post_it";break;
		case "-110131" : vl_c_genre="bordex";break;
		case "-110132" : vl_c_genre="emailing_track";break;
		case "-110133" : vl_c_genre="retcli";break;
        case "-110134" : vl_c_genre="retfou";break;
        case "-110135" : vl_c_genre="relfou";break;
        case "-110137" : vl_c_genre="avofou";break;
        case "-110138" : vl_c_genre="avofif";break;
        case "-110139" : vl_c_genre="alertes";break;	
        default : vl_c_genre="$vl_c_genreaction";break;
      }
      vl_c_donnees="vf_e_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&vf_c_action=modifier&genreaction="+fa_enc(vl_c_genre)+"&";
      fa_att_set("graal_iframe_visu_action","src",vf_c_script_fen_action+vl_c_donnees);
EOT;
} else {
	$pf_sel_ligne_visu="";
}		
echo <<<END
<script type="application/x-javascript"><![CDATA[

const c_script_calend_mensuel="_graal_fen_actions_calendrier_mensuel.php?detail=$vl_c_detail_action&";


const vf_c_script_fen_action='_graal_fen_actions_02.php?';
const vf_c_script_sel_tel='_graal_fen_rech_tel_01.php?action=emitel&genreacteur=';
const vf_c_script_bdope_action='_graal_bdope_actions_01.php?';
const vf_c_script_favoris_actions='_graal_bdope_actions_favorites_01.php';
const c_script_favoris_partage='_graal_fen_favoris_partage_01.php?vf_c_type_favori=1&';
const c_script_prepa_creation_cial="_graal_bdope_doc_cial_01.php?vf_c_action=ajouter_doc&";
const c_script_recherche_acteurs='_graal_fen_rech_acteurs.php?vl_c_origine=selection&';
var vf_e_action_cleunik=-1,vf_e_choix_cleunik;
function pf_aa_init_bem(vv_choix_date){
  fa_att_set("ml_genre_action_rech","oncommand","pf_approximatif_bem()");
  pf_approximatif_bem();
}
function pf_ajoute_bem(vv_quoi,vv_qui) {
  switch (vv_quoi) {
    case 'acteur' :
      switch (vv_qui) {
        case "":
          fa_xmlhttprequest_txt(vf_c_script_bdope_action+"vf_c_action=ajouteracteur&vl_act_cleunik="+vf_e_act_cleunik+"&","",pf_ajoute_fin_bem);
          break;
        case "offcli":
				case "cdecli":
        case "livcli":
        case "faccli":
        case "avocli":
				case "avofin":
        case "demfou":
        case "cdefou":
				case "profor":
          fa_xmlhttprequest_txt(c_script_prepa_creation_cial,"genreaction="+vv_qui+"&act_cleunik="+vf_e_act_cleunik+"&raf="+Math.random(),pf_ajoute_fin_bem_cial,vv_qui);
          break;
        case "recfou":
        case "facfou":
          alert('En développement');
          break;
      }
      break;
    case 'interlo' :
      fa_xmlhttprequest_txt(vf_c_script_bdope_action+"vf_c_action=ajouterinterl&vl_act_cleunik="+vf_e_act_cleunik+"&vl_int_cleunik="+vf_e_int_cleunik+"&","",pf_ajoute_fin_bem);
      break;
    case 'rectel' :
      fa_xmlhttprequest_txt(vf_c_script_bdope_action+"vf_c_action=ajouterrectel&","",pf_ajoute_fin_bem);
      break;
    case 'tel' :
      fa_ouvre(vf_c_script_sel_tel+vv_qui,1000,600);
      break;
    case 'emimail_texte' :
      pf04_emimail_texte(0);
      break;
    case 'emimail_html' :
      pf04_emimail_html(0);
      break;
  }
}
function pf_ajoute_fin_bem(stream) {
  var vl_c_datas=stream;
  if (vl_c_datas!=-1) {
    var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=ajoutermodifier&genreaction=jenesaispas&";
    fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
  }
}
function pf_ajoute_fin_bem_cial(stream,vv_qui) {
  switch (stream) {
    case "0":alert("Impossible de créer ce document.");break
    case "":
    case "-1":
    case "-2":
    case "-3":
    case "-4":
    case "-5":
    case "-6":
    case "-7":
    case "-8":
    case "-9":
    case "-13":
      alert("Erreur de creation ("+stream+").");
      break;
    case "-10":
      alert("Informations comptables non renseignées. Création impossible");
      break;
    case "-11":
      alert("Catégorie fiscale non renseignée. Création impossible");
      break;
    case "-12":
      alert("Compte imputation comptable non renseigné. Création impossible");
      break;
    case "-13":
      alert("Eléments de gestion non renseignés (remise etc). Création impossible");
      break;
    default:
			if (vv_qui=="profor"){vv_qui="faccli";}
      var vl_c_donnees="vf_e_action_cleunik="+fa_enc(stream)+"&vf_c_action=ajoutermodifier&genreaction="+vv_qui+"&";
      fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
      break;
  }
}
function pf_approximatif_bem() {
	if ( fa_value_get("bem_tb_rechapproxima") == "" ) {return;}
	fa_grise_fenetre("","oui");
	var vl_c_statuts=fa_mlget_check("ml_statut_action_rech");
	var vl_c_priorit=fa_mlget_check("ml_priori_action_rech");
	var vl_c_genress=fa_mlget_check("ml_genre_action_rech");
	var vl_c_concerne_qui="&vl_c_concerne_qui="+fa_mlget("bem_ml_concerne_qui","value")+'&';
	var vl_c_donnees="vl_c_mm="+fa_value_get("bem_tb_deb")+"&";
	vl_c_donnees+="genreaction=$vl_c_genreaction&";
	vl_c_donnees+="vl_c_aa="+fa_value_get("bem_tb_fin")+"&";
	vl_c_donnees+="vl_c_aff_we="+fa_value_get("bem_tb_aff_we")+"&";
	vl_c_donnees+='&vl_c_recherche='+fa_enc(fa_value_get("bem_tb_rechapproxima"))+'&vl_e_genre='+vl_c_genress;
	vl_c_donnees+='&vl_e_statut='+vl_c_statuts+'&vl_operat='+fa_mlget("bem_ml_operat","value")+'&vl_operat_genre='+fa_mlget("bem_ml_operat_genre","value");
	vl_c_donnees+="&vl_zone="+fa_mlget("bem_ml_zone","value")+"&vl_type_recherche="+fa_mlget("bem_ml_type_recherche","value")+"&vl_e_priorite="+vl_c_priorit+"&vl_operat_priorite="+fa_mlget("bem_ml_operat_priori","value")+'&';
	vl_c_donnees+=vl_c_concerne_qui;
	vl_c_donnees+="&vl_operat_confiden="+fa_mlget("bem_ml_operat_confid","value")+'&vl_e_confiden='+fa_mlget_check("ml_confid_action_rech");
  switch ("$vl_c_genreaction"){
    case "toutes_principales":
    case "offcli"   :
    case "demfou" :
    case "cdecli"   :
    case "cdefou"   :
    case "livcli"    :
    case "recfou"    :
    case "faccli"   :
    case "facfou"   :
		case "avocli"   :
		case "profor":
			vl_c_donnees+='&vl_c_lesquelles=toutes_principales&raf_random='+Math.random();
      break;
    case "toutes":
    case "emitel":
    case "rectel":
    case "emimail"  :
    case "emailing"  :
    case "recmail"  :
    case "recmail_lecture"  :
    case "recmail_erreur"  :
    case "recmail_erreur_massif"  :
    case "chat"   :
    case "formul":
    case "fabrica":
    case "toutes_traitements":
	case "desins_mail":
	case "contenu_courriels_recus":
	case "contenu_courriels_recus_masse":
	case "contenu_chats":
			vl_c_donnees+='&vl_c_lesquelles=toutes&raf_random='+Math.random();
      break;
    case "recmail_ar":
			vl_c_donnees+='&vl_c_lesquelles=avecar&raf_random='+Math.random();
      break;
    case "acteurs":
			vl_c_donnees+='&vl_c_lesquelles=acteurs&raf_random='+Math.random();
      break;
    case "interlo":
			vl_c_donnees+='&vl_c_lesquelles=interlo&raf_random='+Math.random();
      break;
    case "favorites":
			vl_c_donnees+='&vl_c_lesquelles=favorites&raf_random='+Math.random();
      break;
    case "avecpj":
			vl_c_donnees+='&vl_c_lesquelles=avecpj&raf_random='+Math.random();
      break;
  }
	fa_att_set("graal_iframe_calend_mensuel","src",c_script_calend_mensuel+vl_c_donnees);
}
function pf_bascule_recmail_retour_erreur(){
	vf_e_action_cleunik=-1;
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
	var vl_c_choix_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_choix_cleunik");
	switch (vl_c_choix_cleunik) {
		case "-110102" : 
			fa_xmlhttprequest_txt(vf_c_script_bdope_action+"vf_c_action=bascule_recmail_retour_erreur&vl_action_cleunik="+vf_e_action_cleunik+"&","",pf_bascule_recmail_retour_erreur_fin);
			break;
		default:
			alert("Bascule impossible");
			return;
	}
}
function pf_bascule_recmail_retour_erreur_fin(stream) {
  switch (stream) {
    case "-1":
			alert("Erreur");
			break;
    default:
			alert("Bascule faite");
      break;
  }
}
function pf_dblclick_arbre_actions_bem(){
  if($vl_b_modif==false) {return};
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
  vf_e_choix_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_choix_cleunik");
  pf_etat_fen_bem("modifier");
}
function pf_deselectionne_choix_tous_confidentialite(){
	var k=fa_gid("ml_confid_action_rech").selectedIndex;
	fa_gid("ml_confid_action_rech").selectedIndex=0;
	fa_gid("ml_confid_action_rech").selectedItem.removeAttribute("checked");
	fa_gid("ml_confid_action_rech").selectedIndex=k;
}
function pf_deselectionne_choix_tous_genres(){
	var k=fa_gid("ml_genre_action_rech").selectedIndex;
	fa_gid("ml_genre_action_rech").selectedIndex=0;
	fa_gid("ml_genre_action_rech").selectedItem.removeAttribute("checked");
	fa_gid("ml_genre_action_rech").selectedIndex=k;
}
function pf_deselectionne_choix_tous_priorite(){
	var k=fa_gid("ml_priori_action_rech").selectedIndex;
	fa_gid("ml_priori_action_rech").selectedIndex=0;
	fa_gid("ml_priori_action_rech").selectedItem.removeAttribute("checked");
	fa_gid("ml_priori_action_rech").selectedIndex=k;
}
function pf_deselectionne_choix_tous_statuts(){
	var k=fa_gid("ml_statut_action_rech").selectedIndex;
	fa_gid("ml_statut_action_rech").selectedIndex=0;
	fa_gid("ml_statut_action_rech").selectedItem.removeAttribute("checked");
	fa_gid("ml_statut_action_rech").selectedIndex=k;
}
function pf_etat_fen_bem(vv_quoi){
  var vl_c_donnees="";
  switch(vv_quoi) {
    case "modifier":
      switch (vf_e_choix_cleunik) {
        case "-110114" : vl_c_genre="offcli";break;
        case "-110115" : vl_c_genre="demfou";break;
        case "-110108" : vl_c_genre="cdecli";break;
        case "-110109" : vl_c_genre="cdefou";break;
        case "-110110" : vl_c_genre="livcli";break;
        case "-110111" : vl_c_genre="recfou";break;
        case "-110112" : vl_c_genre="faccli";break;
        case "-110113" : vl_c_genre="facfou";break;
        case "-110116" : vl_c_genre="avocli";break;
        case "-110117" : vl_c_genre="avofin";break;
        case "-110118" : vl_c_genre="chat";break;
				case "-110119" : vl_c_genre="fabrica";break;
        case "-110103" : vl_c_genre="emimail";break;
        case "-110121" : vl_c_genre="emimail_ar";break;
        case "-110122" : vl_c_genre="emailing";break;
        case "-110102" : vl_c_genre="recmail";break;
        case "-110120" : vl_c_genre="recmail_lecture";break;
        case "-110104" : vl_c_genre="recmail_erreur";break;
        case "-110123" : vl_c_genre="formul";break;
				case "-110124" : vl_c_genre="desins_mail";break;
        default : vl_c_genre="$vl_c_genreaction";break;
      }
      vl_c_donnees="vf_e_action_cleunik="+fa_enc(vf_e_action_cleunik)+"&vf_c_action=modifier&genreaction="+fa_enc(vl_c_genre)+"&";
      fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
      break;
    case "ajouter":
      vl_c_donnees="vf_e_action_cleunik=-1&vf_c_action=ajouter&";
      fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
      break;
    case "sortir":
      window.close();
      break;   
  }
}
function pf_favoris_partager() {
  var vl_c_param;
  vl_c_param="vf_e_cleunik="+vf_e_action_cleunik+"&raf_random="+Math.random()+"&";
  fa_ouvre(c_script_favoris_partage+vl_c_param,500,60);
}
function pf_favoris_supprimer() {
  var vl_c_param;
  var raf_random=Math.random();
  vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&";
  vl_c_param+="vl_action_cleunik="+vf_e_action_cleunik+"&";
  vl_c_param+="raf_random="+raf_random+"&";
  fa_xmlhttprequest_xml(vf_c_script_favoris_actions,vl_c_param,pf_favoris_supprimer_fin,'');
}
function pf_favoris_supprimer_fin(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") {pf_approximatif_bem();alert("$vl_c_bda_107_js");} else {alert("$vl_c_bda_108_js");}
}
function pf_grise_fenetre_non(){
	fa_grise_non("bem_tb_limit");
	fa_grise_non("bem_ml_operat_genre");
	fa_grise_non("ml_genre_action_rech");
	fa_grise_non("ml_statut_action_rech");
	fa_grise_non("bem_ml_operat");
	fa_grise_non("bem_ml_actif");
	fa_grise_non("bem_ml_zone");
	fa_grise_non("bem_tb_rechapproxima");fa_ro_non("bem_tb_rechapproxima");
	fa_grise_non("bem_ml_type_recherche");
	fa_grise_non("bem_tb_deb");
	fa_grise_non("bem_tb_fin");
	fa_grise_non("bem_tb_limit");
	fa_grise_non("bem_tb_rafraichir");
	fa_grise_fenetre("","non");
}
function pf_grise_fenetre_oui(){
	fa_grise_oui("bem_tb_limit");
	fa_grise_oui("bem_ml_operat_genre");
	fa_grise_oui("ml_genre_action_rech");
	fa_grise_oui("ml_statut_action_rech");
	fa_grise_oui("bem_ml_operat");
	fa_grise_oui("bem_ml_actif");
	fa_grise_oui("bem_ml_zone");
	fa_grise_oui("bem_tb_rechapproxima");fa_ro_oui("bem_tb_rechapproxima");
	fa_grise_oui("bem_ml_type_recherche");
	fa_grise_oui("bem_tb_deb");
	fa_grise_oui("bem_tb_fin");
	fa_grise_oui("bem_tb_limit");
	fa_grise_oui("bem_tb_rafraichir");
	fa_grise_fenetre("","oui");
}
function pf_mois_suivant(){
	if (fa_value_get("bem_tb_deb")==12) {
		fa_value_set("bem_tb_deb",1);
		var annee=fa_value_get("bem_tb_fin");
		annee=annee*1;
		annee=annee+1;
		fa_value_set("bem_tb_fin",annee);
	} else {
		var mois=fa_value_get("bem_tb_deb");
		mois=mois*1;
		mois=mois+1;
		if (mois<10){mois="0"+mois;}
		fa_value_set("bem_tb_deb",mois);
	}
	pf_approximatif_bem();
}
function pf_mois_precedent(){
	if (fa_value_get("bem_tb_deb")==1) {
		fa_value_set("bem_tb_deb",12);
		var annee=fa_value_get("bem_tb_fin");
		annee=annee*1;
		annee=annee-1;
		fa_value_set("bem_tb_fin",annee);
	} else {
		var mois=fa_value_get("bem_tb_deb");
		mois=mois*1;
		mois=mois-1;
		if (mois<10){mois="0"+mois;}
		fa_value_set("bem_tb_deb",mois);
	}
	pf_approximatif_bem();
}
function pf_onunload(){
}
function pf_ouvre_acteur(vv_qui,vv_quoi) {
  var vl_c_param="";
  switch (vv_quoi){
    case "avocli":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_avocli&";
      break;
    case "avofin":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_avofin&";
      break;
    case "cdecli":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_cdecli&";
      break;
    case "cdefou":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_cdefou&";
      break;
    case "demfou":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_demfou&";
      break;
    case "faccli":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_faccli&";
      break;
    case "livcli":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_livcli&";
      break;
    case "offcli":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_offcli&";
      break;
		case "profor":
      vl_c_param="&vl_c_proc_retour=pf_ouvre_acteur_recup_profor&";
      break;
  }
  fa_ouvre(c_script_recherche_acteurs+vl_c_param+"vl_e_genreacteur="+vv_qui+"&",800,600);
}
function pf_ouvre_acteur_recup_avocli(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','avocli');
}
function pf_ouvre_acteur_recup_avofin(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','avofin');
}
function pf_ouvre_acteur_recup_cdecli(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','cdecli');
}
function pf_ouvre_acteur_recup_cdefou(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','cdefou');
}
function pf_ouvre_acteur_recup_demfou(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','demfou');
}
function pf_ouvre_acteur_recup_faccli(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','faccli');
}
function pf_ouvre_acteur_recup_livcli(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','livcli');
}
function pf_ouvre_acteur_recup_offcli(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','offcli');
}
function pf_ouvre_acteur_recup_profor(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  vf_e_act_cleunik=vl_act_cleunik;
  pf_ajoute_bem('acteur','profor');
}

function pf_ouvre_action(vl_c_datas)  {
	var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=ajoutermodifier&genreaction=jenesaispas&";
  fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
}

function pf_sel_ligne_bem()  {
  vf_e_action_cleunik=-1;
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
	vf_e_choix_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_choix_cleunik");
	$pf_sel_ligne_visu
}
function pf_voir_action(){
  var rowIndex = fa_cui("arbre_actions_01");if(rowIndex == -1){return;}
	var vl_c_donnees="vf_e_action_cleunik="+fa_enc(fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik"))+"&vf_c_action=modifier&genreaction=jenesaispas&";
	fa_att_set("graal_iframe_visu_action","src",vf_c_script_fen_action+vl_c_donnees);
}
]]></script>
END;
?>
