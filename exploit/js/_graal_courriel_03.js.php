<?php
$var_rc='\r\n';
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_edite='_graal_xml_modeles_courriels_01.php';
const vf_c_script_envoie_courriel="_graal_exe_courriel_envoie.php?"
function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  var vl_c_chaine=fa_xml_get(vl_c_datas,'blocnote_riche');
  var vl_c_sortie=vl_c_chaine.replace(/<br>/g, "$var_rc"); 
  vl_c_sortie=vl_c_sortie.replace(/#date#/g,fa05_dates_en_clair("date"));
  vl_c_sortie=vl_c_sortie.replace(/#heure#/g,fa05_dates_en_clair("heure"));
  vl_c_sortie=vl_c_sortie.replace(/#dateheure#/g,fa05_dates_en_clair("dateheure"));
  fa_value_set("tb_message",vl_c_sortie);
}
function pf_alimente_defaut(){
  fa_value_set("tb_message","");
  fa_value_set('ml_modeles',0);
  pf_top_model(fa_mlget('ml_modeles'));

}
function pf_etat_fen(vv_quoi){
  switch(vv_quoi) {
    case "ini":
      pf_alimente_defaut();
      fa_focusdonne('ml_modeles');
      break;
    case "annuler":
      pf_raz_fiche();
      pf_alimente_defaut();
      break;
    case "sortir":
      window.close();
      break;   
  }
}
function pf_raz_fiche(){}
function pf_top_model(vv_qui){
  fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_modele="+vv_qui+"&",pf_affiche_datas);
}
function pf_validation(){
  var s="";
  if (fa_value_get("tb_message")=="") {if (!confirm("Il n'y a pas de message. Confirmez-vous l'envoi de l\'accusé de réception' ?")) {fa_focusdonne("tb_message");return;}}
  fa_bgc("bt_enregistrer",'red')
  s+="vl_e_sendmail_from="+fa_enc(fa_mlget("ml_emetteur"))+"&";
  s+="raf="+Math.random()+"&";
  s+="vl_c_message="+fa_enc(fa_value_get("tb_message"))+"&";
  s+="vl_c_sujet="+fa_enc(fa_value_get("tb_sujet"))+"&";
  s+="vl_c_type_courriel=3&"; //  Ar Texte seul
  s+="vl_c_type_envoi=1&"; //  Un seul courriel
  s+="vl_c_genre=ar&";
  s+="vl_e_action_cleunik=$vl_e_action_cleunik&"
  fa_xmlhttprequest_txt(vf_c_script_envoie_courriel,s,pf_validation_fin);
}
function pf_validation_fin(stream){
  var vl_c_datas = stream;
  var tableau_retour=vl_c_datas.split('|');
  if (tableau_retour[0]!='0') {
    fa_value_set("tb_cr",tableau_retour[0]+tableau_retour[1])
    fa_gid('dk_01').selectedIndex=1
  }
  fa_bgc("bt_enregistrer",'init')
  fa_grise_non("bt_enregistrer")
}
]]></script>
END;
?>
