<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
********************************************************************************************************************************
**********  Fenêtre de gestion des traductions des objets                  (_graal_fen_objets_traductions_01.php)                             ********
********************************************************************************************************************************
*/
var vf_o_tree;
var vf_e_sel_cleunik;
var vf_c_action;
var vf_c_url_alimente_table;
var vf_c_script_bdope_fen;
var vf_button;
var vf_c_ValRetour;
//  Affectations
  vf_c_script_bdope_fen='_graal_bdope_traductions_01.php';
function pf_alimente_defaut()
{
}
function pf_alimente_table()
{
  var raf_random=Math.random();
  var s;
  vf_o_tree.setAttribute('datasources', '');
  s=vf_c_url_alimente_table+"?raf="+raf_random+"&vl_e_langue="+fa_mlget("ml_langue");
  s+="&vl_e_type="+fa_gid("_graal_trad_objets_01").getAttribute("_graal_type");
  if (fa_est_coche('ch_01')==true) 
  {
    s+="&vl_b_atraduireseuls=1&";
  }
  else
  {s+="&vl_b_atraduireseuls=0&";}
  vf_o_tree.setAttribute('datasources',s);
}
function pf_etat_fen(vv_quoi)
  {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_c_url_alimente_table='_graal_das_traductions_01.php';
       vf_o_tree = fa_gid("arbre_des_objets");
       fa_grise_non("bt_modifier");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       pf_raz_fiche();
       break;
     case "selectionner_langue":
        pf_alimente_table();
        break;
     case "modifier":
      var rowIndex = vf_o_tree.currentIndex;
      if(rowIndex == -1){return;}
      fa_att_set("tb_descriptif_francais","_graal_cleunik",vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("fen_cleunik")));
      fa_gid("tb_descriptif_francais").value = vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("descriptif") );
      fa_gid("tb_descriptif_traduit").value = vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("descriptif_traduit") );

      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_focusdonne('tb_descriptif_traduit');
      break;
     case "annuler":
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      pf_raz_fiche();
      vf_o_tree.focus();
      break;
     case "sortir":
     window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
     //window.history.back(); //  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre

     break;   
 default:
 break;
}
  }
function pf_fin_requete(stream)
{
var vl_datas = stream;
if (vl_datas=='ok') 
{pf_alimente_table();}
else
{fa_erreur(vl_datas)}
pf_etat_fen('annuler');


}
function pf_raz_fiche()
{
  fa_gid("tb_descriptif_francais").value = "";
  fa_gid("tb_descriptif_traduit").value = "";
  fa_att_set("tb_descriptif_francais","_graal_cleunik","-1");
}
function pf_sel_ligne(vv_qui) 
 {
      if(fa_est_grise("bt_modifier")==true){return};
      var rowIndex = vf_o_tree.currentIndex;
      if(rowIndex == -1){return;}
      var rowIndex = vf_o_tree.currentIndex;
      var vl_e_fen_cleunik=vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("fen_cleunik"));
      fa_att_set("tb_descriptif_francais","_graal_cleunik",vl_e_fen_cleunik);
      fa_gid("tb_descriptif_francais").value = vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("descriptif") );
      fa_gid("tb_descriptif_traduit").value = vf_o_tree.view.getCellText( rowIndex ,vf_o_tree.columns.getNamedColumn("descriptif_traduit") );
  }

function pf_validation(vv_quoi)
  {
  var s;
   var vl_e_fen_cleunik=fa_gid("tb_descriptif_francais").getAttribute("_graal_cleunik");
   s ="vl_e_fen_cleunik="+vl_e_fen_cleunik+"&";
   s+="vl_c_traduction="+fa_enc(fa_gid("tb_descriptif_traduit").value)+"&";
   s+="vl_e_langue="+fa_mlget("ml_langue");
   fa_xmlhttprequest_txt(vf_c_script_bdope_fen,s,pf_fin_requete);
}
]]></script>
END;
?>
