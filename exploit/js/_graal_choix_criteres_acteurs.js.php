<?php
$vl_c_00002=fa_recup_session('mess_00002','');
$vl_c_dico00020=fa_recup_dico_js("dico_00020");
$vl_c_dico00021=fa_recup_dico_js("dico_00021");
$vl_c_dico00022=fa_recup_dico_js("dico_00022");
$vl_c_dico00023=fa_recup_dico_js("dico_00023");
$vl_c_dico00024=fa_recup_dico_js("dico_00024");
$vl_c_dico00025=fa_recup_dico_js("dico_00025");
$vl_c_bcd_101=fa_echap_quotes(fa_recup_dico("bcd_101"));
$vl_c_bcd_102=fa_echap_quotes(fa_recup_dico("bcd_102"));
$vl_c_bcd_103=fa_echap_quotes(fa_recup_dico("bcd_103"));
$vl_c_bcd_104=fa_echap_quotes(fa_recup_dico("bcd_104"));
$vl_c_bcd_105=fa_echap_quotes(fa_recup_dico("bcd_105"));
$vl_c_bcd_106=fa_echap_quotes(fa_recup_dico("bcd_106"));
$vl_c_bcd_107=fa_echap_quotes(fa_recup_dico("bcd_107"));
$vl_c_bcd_108=fa_echap_quotes(fa_recup_dico("bcd_108"));
$vl_c_bcd_109=fa_echap_quotes(fa_recup_dico("bcd_109"));
$vl_c_bcd_110=fa_echap_quotes(fa_recup_dico("bcd_110"));
$vl_c_bcd_111=fa_echap_quotes(fa_recup_dico("bcd_111"));
$vl_c_bcd_112=fa_echap_quotes(fa_recup_dico("bcd_112"));
$vl_c_bcd_113=fa_echap_quotes(fa_recup_dico("bcd_113"));
$vl_c_bcd_114=fa_echap_quotes(fa_recup_dico("bcd_114"));
$vl_c_bcd_115=fa_echap_quotes(fa_recup_dico("bcd_115"));
$vl_c_bcd_116=fa_echap_quotes(fa_recup_dico("bcd_116"));
$vl_c_bcd_117=fa_echap_quotes(fa_recup_dico("bcd_117"));
$vl_c_bcd_118=fa_echap_quotes(fa_recup_dico("bcd_118"));
$vl_c_bcd_119=fa_echap_quotes(fa_recup_dico("bcd_119"));
$vl_c_bcd_120=fa_echap_quotes(fa_recup_dico("bcd_120"));
$vl_c_bcd_121=fa_echap_quotes(fa_recup_dico("bcd_121"));
$vl_c_bcd_122=fa_echap_quotes(fa_recup_dico("bcd_122"));
$vl_c_bcd_123=fa_echap_quotes(fa_recup_dico("bcd_123"));
$vl_c_bcd_124=fa_echap_quotes(fa_recup_dico("bcd_124"));
$vl_tb_droits_110001=_graal_requete_droits_fenetre("Fen_00346",$vl_e_uti_cleunik);
$vl_tb_droits_110002=_graal_requete_droits_fenetre("Fen_00347",$vl_e_uti_cleunik);
$vl_tb_droits_110003=_graal_requete_droits_fenetre("Fen_00348",$vl_e_uti_cleunik);
$vl_tb_droits_110004=_graal_requete_droits_fenetre("Fen_00349",$vl_e_uti_cleunik);
$vl_tb_droits_110005=_graal_requete_droits_fenetre("Fen_00350",$vl_e_uti_cleunik);
$vl_tb_droits_110006=_graal_requete_droits_fenetre("Fen_00351",$vl_e_uti_cleunik);
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_url_arbre='_graal_das_choix_critere_01.php?genre=acteurs&vl_c_nombre=acteurs&';
const vf_c_script_edite_critere='_graal_xml_criteres_00.php';
const vf_c_script_edite='_graal_xml_choix_criteres_01.php?genre=acteurs&';
const vf_c_script_bdope_criteres='_graal_bdope_choix_criteres_01.php';
const vf_c_script_fen_visu_acteurs='_graal_fen_rech_acteurs.php?';
const c_c_script_fen_traitements_acteurs='_graal_traitements_acteurs_01.php?p02=$vl_c_id_fenetre&genreacteur=';
const vf_e_critere_cleunik="$vl_e_critere_cleunik";
const vf_c_script_stats="_graal_fen_graphiques_stat_01.php?critere_cleunik=$vl_e_critere_cleunik&genre=criteres_acteurs&";
var vf_e_nombre_utilisations,vf_e_choix_cleunik;
t_intitule=new Array("raf","$vl_c_bcd_101","$vl_c_bcd_102","$vl_c_bcd_103","$vl_c_bcd_104","$vl_c_bcd_105","$vl_c_bcd_106","$vl_c_bcd_107","$vl_c_bcd_108","$vl_c_bcd_109","$vl_c_bcd_110","$vl_c_bcd_111","$vl_c_bcd_112","$vl_c_bcd_113","$vl_c_bcd_114","$vl_c_bcd_115","$vl_c_bcd_116","$vl_c_bcd_117","$vl_c_bcd_118","$vl_c_bcd_119","$vl_c_bcd_120","$vl_c_bcd_121","$vl_c_bcd_122","$vl_c_bcd_123","$vl_c_bcd_124");
function pf_affiche_datas(stream) {
var vl_c_datas,vl_c_type_acteurs;
var vl_e_nombre,vl_e_choix_actif,vl_e_portee,vl_c_nombre;
pf_raz_fiche_bis();
vl_c_datas = stream;
fa_value_set('tb_choix_code',fa_xml_get(vl_c_datas,'choix_code'));
fa_value_set('tb_choix_valeur_texte_01',fa_xml_get(vl_c_datas,'choix_valeur_texte_01'));
fa_value_set('rdg_choix_actif',fa_xml_get(vl_c_datas,'choix_actif'));
vf_e_choix_cleunik=fa_xml_get(vl_c_datas,'choix_cleunik');
vl_e_portee=fa_att_get("tb_critere_code",'_graal_critere_portee');
if ((vl_e_portee &   2) ==   2) {fa_grise_non('bt_n02')}
if ((vl_e_portee &   4) ==   4) {fa_grise_non('bt_n03')}
if ((vl_e_portee &   8) ==   8) {fa_grise_non('bt_n04')}
if ((vl_e_portee &  16) ==  16) {fa_grise_non('bt_n05')}
if ((vl_e_portee &  32) ==  32) {fa_grise_non('bt_n06')}
if ((vl_e_portee &  64) ==  64) {fa_grise_non('bt_n07')}
vf_e_nombre_utilisations=0;
for (i=1; i<=7; i++){
	try {
		vl_e_nombre=fa_xml_get(vl_c_datas,('nombre_utilisations_'+i));
		vf_e_nombre_utilisations+=vl_e_nombre;
    vl_c_type_acteurs=fa_xml_get(vl_c_datas,('typeacteur_'+i));
		if (vl_e_nombre==0) {
			vl_c_nombre="";
		} else {
			vl_c_nombre="("+vl_e_nombre+")";
		}
		pf_affiche_nombre_portee(vl_c_type_acteurs,vl_c_nombre);
	} catch (e) {
		vl_e_nombre=0;
	}
}
}
function pf_affiche_nombre_portee(vv_c_type_acteurs,vv_e_nombre){
  switch(vv_c_type_acteurs) {
   case '110001':  fa_label('bt_n02',"$vl_c_dico00020 "+vv_e_nombre);break;
   case '110003':  fa_label('bt_n03',"$vl_c_dico00021 "+vv_e_nombre);break;
   case '110002':  fa_label('bt_n04',"$vl_c_dico00022 "+vv_e_nombre);break;
   case '110004':  fa_label('bt_n05',"$vl_c_dico00023 "+vv_e_nombre);break;
   case '110005':  fa_label('bt_n06',"$vl_c_dico00024 "+vv_e_nombre);break;
   case '110006':  fa_label('bt_n07',"$vl_c_dico00025 "+vv_e_nombre);break;
  }
}
function pf_alimente_defaut(){
  fa_value_set('rdg_choix_actif',1);
}
function pf_etat_fen(vv_quoi){
  var vl_e_rowIndex;
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      vf_e_choix_cleunik=0;
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_value_set('rdg_etat',1);
      fa_value_set('rdg_position',1);
      pf_alimente_defaut();
      pf06_alimente_table_bbb();
      s ="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&vl_c_portee=acteurs&";
      fa_xmlhttprequest_xml(vf_c_script_edite_critere,s,bcc_pf_affiche_datas);
      fa_grise_groupe_oui('broadcaster_01');
      fa_grise_groupe_oui('broadcaster_02');
      break;
     case "selectionner":
     if((fa_cui('arb_choix_criteres')== -1)) {return;}
     if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_ajouter");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     fa_grise_groupe_oui('broadcaster_02');
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_sortir");
       pf_raz_fiche_bis();
       fa_grise_groupe_oui('broadcaster_02');
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche_bis();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_02');
       if ($vl_c_codecache_criteres_acteurs_choix==false) {fa_focusdonne("tb_choix_code");} else {fa_focusdonne("tb_choix_valeur_texte_01");} 
       break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_02');
      fa_focusdonne("tb_choix_valeur_texte_01");
      break;
    case "sortir":
     window.close();
     break;   
}
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!='-1'){pf06_alimente_table_bbb();}else{fa_erreur(vl_datas);}
  if (window.opener!=null) { window.opener.pf_affiche_choix_criteres_potentiel_acteur();}
  pf_etat_fen('annuler');
}
function pf_ouvre(vv_qui,vv_enclair,vv_quoi,vv_quoi_encore){
  var vl_c_param,vl_b_traitement;
  vl_c_param='vl_e_genreacteur='+fa_enc(vv_qui)+"&";
  vl_c_param+='vl_e_critere_cleunik='+fa_enc(vf_e_critere_cleunik)+"&";
  vl_c_param+='vl_c_quoi='+fa_enc(vv_quoi)+"&";
  vl_c_param+='vl_c_enclair='+fa_enc(t_intitule[vv_enclair])+"&";
  vl_c_param+='vl_c_code_critere='+fa_enc(fa_value_get('tb_critere_code'))+"&";
  vl_c_param+='vl_c_code_choix='+fa_enc(fa_value_get('tb_choix_code'))+"&";
  vl_c_param+='vl_c_deno_critere='+fa_enc(fa_value_get('tb_critere_denomination'))+"&";
  vl_c_param+='vl_c_deno_choix='+fa_enc(fa_value_get('tb_choix_valeur_texte_01'))+"&";
  switch (vv_quoi_encore) {
    case "choix":
      if (vf_e_choix_cleunik==0) {alert("Pas de choix sélectionné !!! Visualisation impossible!!");return;}
      vl_c_param+='vl_e_choix_cleunik='+fa_enc(vf_e_choix_cleunik)+"&";
      vl_c_param+='type=2&';
      break;
    case "critere":
      switch (vv_quoi){
      	case "in":
		  vl_c_param+='vl_e_choix_cleunik=0&';
	      vl_c_param+='type=3&';
	      break;
		case "notin":
			vl_c_param+='vl_e_choix_cleunik='+fa_enc(vf_e_choix_cleunik)+"&";
	      	vl_c_param+='type=4&';
	      	break;
		
		}
		break;
	}
  switch (vv_qui) {
    case "110001": vl_b_traitement=$vl_tb_droits_110001[0];break;
    case "110002": vl_b_traitement=$vl_tb_droits_110002[0];break;
    case "110003": vl_b_traitement=$vl_tb_droits_110003[0];break;
    case "110004": vl_b_traitement=$vl_tb_droits_110004[0];break;
    case "110005": vl_b_traitement=$vl_tb_droits_110005[0];break;
    case "110006": vl_b_traitement=$vl_tb_droits_110006[0];break;
  }
  if (vl_b_traitement==false) {
    fa_ouvre(vf_c_script_fen_visu_acteurs+vl_c_param+"vl_c_origine=critere&",600,400)
  } else {
    fa_ouvre(c_c_script_fen_traitements_acteurs+vv_qui+"&"+vl_c_param,1000,800)
  }
}
function pf_ouvre_stats() {
  fa_ouvre(vf_c_script_stats)
}
function pf_raz_fiche(){
  fa_label('ch_n02',"$vl_c_dico00020");
  fa_label('ch_n03',"$vl_c_dico00021");
  fa_label('ch_n04',"$vl_c_dico00022");
  fa_label('ch_n05',"$vl_c_dico00023");
  fa_label('ch_n06',"$vl_c_dico00024");
  fa_label('ch_n07',"$vl_c_dico00025");
}
function pf_raz_fiche_bis(){
  fa_value_set('rdg_choix_actif',2);
  fa_grise_oui('bt_n02')
  fa_grise_oui('bt_n03')
  fa_grise_oui('bt_n04')
  fa_grise_oui('bt_n05')
  fa_grise_oui('bt_n06')
  fa_grise_oui('bt_n07')
  pf_raz_fiche();
}
function pf_validation(vv_quoi) {
  var s;
  switch(vv_quoi) {
    case "enregistrer":
       s ="vl_c_action="+fa_enc(vf_c_action)+"&";
       s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
       s +="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
       s +="vl_c_choix_actif="+fa_enc(fa_value_get('rdg_choix_actif'))+"&";
       s +="vl_c_portee=126&";
       s +="vl_c_choix_valeur_texte_01="+fa_enc(fa_value_get('tb_choix_valeur_texte_01'))+"&"
       s +="vl_c_code="+fa_enc(fa_value_get('tb_choix_code'))+"&"
    break;
   case "supprimer":
     if(confirm("$vl_c_00002") == false) return;
     s ="vl_c_action=supprimer&";
     s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
    break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
