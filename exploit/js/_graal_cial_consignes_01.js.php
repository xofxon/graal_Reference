<?php
$vl_c_bph_108=fa_recup_dico_js("bph_108");
$vl_c_bph_109=fa_recup_dico_js("bph_109");
switch ($vl_c_genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
	case "avofin":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
    $vf_c_script_bdope_fen="_graal_bdope_cial_consignes_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_e_act_cleunik=$act_cleunik&";
    break;
}
if ($action_consi_cleunik==0) {
  $vl_c_champ_focus="selart_consigne";
  $vl_c_init="pf_param_choix_selart_consigne();";
} else {
  $vl_c_champ_focus="tb_qte";
  $vl_c_init="";
}
$vl_c_fin_requete="if (window.opener!=null) {try {window.opener.pf_cial_affiche_colisage();close();} catch(e){}}";
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c_script_xml_art_pour_consigne='_graal_xml_articles_02.php?vl_e_art_cleunik=';
const c_script_recherche_article_nomencfab="_graal_das_art_selection.php?actif=1&type_recherche=2&";  //  Recherche des articles actifs gérés en fabrication
var vf_c_action,vf_c_url_alimente_table;
function pf_aa_init() {
  fa_sep("tb_qte");
  fa_focusdonne("$vl_c_champ_focus");
  $vl_c_init
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "sortir":
      window.close();
      break;
  }
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!="-1") {
    //alert(vl_datas);
    }
  else{
    //alert(vl_datas);
  }
  $vl_c_fin_requete
}
function pf_param_choix_selart_consigne() {
  fa_att_set("selart_consigne","autosuggestsearch",c_script_recherche_article_nomencfab+"zone="+fa_value_get("selart_consigne_ml_zone")+"&");
}
function pf_sel_article_pour_consigne() {
  var vl_e_cleunik=fa_gid('selart_consigne').getAttribute('_graal_cleunik');
  fa_xmlhttprequest_xml(c_script_xml_art_pour_consigne+vl_e_cleunik,"",pf_sel_article_pour_consigne_fin);
}
function pf_sel_article_pour_consigne_fin(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_art_description',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_art_code',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_art_code',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik'));
  fa_focusdonne("tb_qte");
}
function pf_validation(vv_quoi){
  var vl_c_donnees;
  switch (vv_quoi) {
    case "enregistrer":
      if (fa_att_get("tb_art_code","_graal_cleunik")=='') {alert("$vl_c_bph_108");return;}
      vl_c_donnees="";
      vl_c_donnees+="vl_art_cleunik="+fa_enc(fa_att_get("tb_art_code","_graal_cleunik"))+"&";
      vl_c_donnees+="vl_qte="+fa_enc(fa_value_get("tb_qte"))+"&";
      vl_c_donnees+="vl_qte_colis="+fa_enc(fa_value_get("tb_qte_colis"))+"&";
      vl_c_donnees+="vf_c_action=ajouter&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
    case "modifier":
      vl_c_donnees="";
      vl_c_donnees+="vl_action_consi_cleunik=$action_consi_cleunik&";
      vl_c_donnees+="vl_qte="+fa_enc(fa_value_get("tb_qte"))+"&";
      vl_c_donnees+="vl_qte_colis="+fa_enc(fa_value_get("tb_qte_colis"))+"&";
      vl_c_donnees+="vf_c_action=modifier&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
    case "supprimer":
      if(confirm("$vl_c_bph_109") == false) return;
      vl_c_donnees="";
      vl_c_donnees+="vl_action_consi_cleunik=$action_consi_cleunik&";
      vl_c_donnees+="vf_c_action=supprimer&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
  }
}
]]></script>
END;
?>
