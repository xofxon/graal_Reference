<?php
$vl_c_bos_112_js=fa_recup_dico_js("bos_112");
$vl_c_bos_113_js=fa_recup_dico_js("bos_113");
$vl_c_bos_114_js=fa_recup_dico_js("bos_114");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_script_das='_graal_das_modes_reglements_01.php?';
const vf_c_script_bdope_fen="_graal_bdope_modes_reglements_01.php";
const vf_c_script_edite="_graal_xml_modes_reglements_01.php?";
const vf_c_script_metatags="_graal_fen_metatags_02.php?";
var vf_c_action;
var vf_e_reg_cleunik;

function pf_aa_init(){
  pf_etat_fen('ini');
}

function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  fa_value_set('rdg_moisentier',fa_xml_get(vl_c_datas,'moisentier'));
  fa_value_set('rdg_mode_reglement_actif',fa_xml_get(vl_c_datas,'actif'));
  fa_value_set("tb_nbjour",fa_xml_get(vl_c_datas,'nbjour'));
  fa_value_set("tb_jour",fa_xml_get(vl_c_datas,'jour'));
  fa_value_set("tb_codealphanum15",fa_xml_get(vl_c_datas,'codealphanum15'));
  fa_value_set("tb_description",fa_xml_get(vl_c_datas,'description'));
  fa_value_set("tb_blocnotebrut",fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set("la_utilisations","$vl_c_bos_112_js"+fa_xml_get(vl_c_datas,'utilisations'));
  fa_value_set("ml_base",fa_xml_get(vl_c_datas,'base'));
  vf_e_nombre_utilisations=fa_xml_get(vl_c_datas,'utilisations');
	fa_mlsel("ml_mode_paiement",fa_xml_get(vl_c_datas,'mode_paiement'));
	fa_mlsel("ml_type_paiement",fa_xml_get(vl_c_datas,'mode_paiement'));
}
function pf_alimente_table() {
  fa_das("arb_modesreglements",_c_script_das+"raf="+Math.random());
}
function pf_etat_fen(vv_quoi)  {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      fa_cache_oui("id_calcule_echeance");
      fa_grise_groupe_oui('broadcaster_01');
      pf_alimente_table();
      break;
    case "selectionner":
      if(fa_cui('arb_modesreglements') == -1){return;}
      if ((vf_e_nombre_utilisations==0) && (vf_e_reg_cleunik > 0)) {
        fa_grise_non("bt_supprimer");
      } else {
        fa_grise_oui("bt_supprimer");
      }
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_sortir");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_groupe_oui('broadcaster_01');
      fa_cache_non("id_calcule_echeance");
      break;

    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_cache_oui("id_calcule_echeance");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("tb_codealphanum15");
      break;
    case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_cache_oui("id_calcule_echeance");
      pf_raz_fiche();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("tb_codealphanum15");
      break;
    case "annuler":
      pf_etat_fen("ini");
      break    
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
  }
function pf_raz_fiche(){
  vf_e_reg_cleunik=-2;
  fa_value_set('rdg_moisentier',1);
  fa_value_set('rdg_mode_reglement_actif',1);
  fa_value_set("tb_nbjour",0);
  fa_value_set("tb_jour",0);
  fa_value_set("tb_codealphanum15","");
  fa_value_set("tb_description","");
  fa_value_set("la_utilisations","$vl_c_bos_112_js");
  vf_e_nombre_utilisations=0;
  fa_gid("ml_mode_paiement").selectedIndex=0;
  fa_gid("ml_type_paiement").selectedIndex=0;
  fa_value_set("tb_blocnotebrut","");
}
function pf_sel_ligne(vv_id){
  if (fa_est_grise("bt_detailler")==true) {return;}
  var i=fa_cui(vv_id);if(i==-1){return;}
  vf_e_reg_cleunik=fa_cell_get(vv_id,i,"reg_cleunik");
  var s ="vl_e_reg_cleunik="+vf_e_reg_cleunik+"&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi){
  vl_c_donnees="";
  vl_c_donnees+="vl_nbjour="+fa_enc(fa_value_get("tb_nbjour"))+"&";
  vl_c_donnees+="vl_jour="+fa_enc(fa_value_get("tb_jour"))+"&";
  vl_c_donnees+="vl_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15"))+"&";
  vl_c_donnees+="vl_description="+fa_enc(fa_value_get("tb_description"))+"&";
  vl_c_donnees+="vl_mode_paiement="+fa_enc(fa_mlget("ml_mode_paiement"))+"&";
  vl_c_donnees+="vl_type_paiement="+fa_enc(fa_mlget("ml_type_paiement"))+"&";
  vl_c_donnees+="vl_moisentier="+fa_enc(fa_value_get('rdg_moisentier'))+"&";
  vl_c_donnees+="vl_reg_cleunik="+fa_enc(vf_e_reg_cleunik)+"&";
  vl_c_donnees+="vl_actif="+fa_enc(fa_value_get("rdg_mode_reglement_actif"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_base="+fa_enc(fa_value_get("ml_base"))+"&";
  switch(vv_quoi)  {
    case "enregistrer":
      if (vf_e_reg_cleunik!=-2){
        vl_c_donnees+="vf_c_action=modifier&";
        vf_c_action="modification";
      } else {
        vl_c_donnees+="vf_c_action=ajouter&";
        vf_c_action="ajout";
      }
      break;
    case "supprimer":
        Check = confirm("$vl_c_bos_114_js");
        if(Check == false) return;
        vl_c_donnees+="vf_c_action=supprimer&"
        vf_c_action="suppression";
      break;
  }
	//alert(vl_c_donnees)
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_validation_fin(stream){
	var vl_datas = stream;
  if (vl_datas!="-2") {
      switch (vf_c_action){
        case "ajout":
        case "modification":
          break;
        case "suppression":
          alert("$vl_c_bos_113_js")
          break;
      }
  } else {
    alert(vl_datas);
  }
  pf_etat_fen("annuler");
}
function pf_verifier(){
	vl_c_donnees="";
    vl_c_donnees+="vf_c_action=verifier&";
    vl_c_donnees+="vl_reg_cleunik="+fa_enc(vf_e_reg_cleunik)+"&";
    vl_c_donnees+="vl_dat_fac="+fa_enc(fa_value_get("tb_cial_date_facture"))+"&";
	fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_verifier_fin);
}
function pf_verifier_fin(stream){
	alert(stream);
}
]]></script>
END;
?>
