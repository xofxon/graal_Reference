<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_xml_libeart="_graal_xml_art_libelle_01.php?vl_e_art_cleunik=$vl_e_art_cleunik&vl_e_langue=$vl_e_langue&vl_e_genre=$vl_e_genre&";
const vf_c_script_bdope_action="_graal_bdope_art_libelles_01.php?vl_art_cleunik=$vl_e_art_cleunik&";
function pf_aa_init() {
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui('broadcaster_01');
  switch ($vl_e_genre) {
    case -1:
      pf_etat_fen("ajouter");
      break;
    default:
      fa_xmlhttprequest_xml(vf_c_script_xml_libeart,"",pf_affiche_donnees_libelle);
  }
}
function pf_affiche_donnees_libelle(stream) {
  var vl_c_datas=stream;
  pf_etat_fen("selectionner");
  pf_raz_fiche();
  fa_value_set('tb_descriptif_brut',fa_xml_get(vl_c_datas,'descriptif_brut'));
	fa_mlsel("ml_langue",fa_xml_get(vl_c_datas,'langue'));
	fa_mlsel("ml_genre",fa_xml_get(vl_c_datas,'genre'),"value");
	pf_etat_fen("modifier");
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  var vl_portee;
  switch(vv_quoi) {
    case "ini":
      break;
    case "modifier":
      fa_grise_oui("bt_modifier");fa_grise_oui("bt_supprimer");fa_grise_oui("bt_detailler");fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");fa_grise_non("bt_annuler");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne('tb_descriptif_brut');
      break;
    case "ajouter":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");
      fa_grise_non("bt_annuler");
      pf_raz_fiche();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("ml_genre");
      break;
    case "annuler":
      pf_aa_init()
      break;
    case "sortir":
      window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
      break;   
    default:
      break;
}
  }
function pf_fin_requete(stream) {
  window.opener.pf_affiche_donnees_libelles();
  var vl_datas = stream;
  if (vl_datas!="-1") {
    switch (vf_c_action) {
      case "suppression":
        alert("Libellé supprimé.");
        break;
      default:
        //pf_raz_fiche();
    }
  } 
  else {alert(vl_datas);}
	pf_etat_fen("sortir");
}
function pf_raz_fiche() {
  fa_value_set('tb_descriptif_brut',"");
}
function pf_validation(vv_quoi) {
  var vl_c_donnees="";
  vl_c_donnees+="vl_e_genre="+fa_mlget("ml_genre","value")+"&";
  vl_c_donnees+="vl_e_langue="+fa_mlget("ml_langue")+"&";
  vl_c_donnees+="vl_descriptif_brut="+fa_enc(fa_value_get("tb_descriptif_brut"))+"&";
  switch(vv_quoi) {
    case "enregistrer":
      if ($vl_e_genre!=-1)
        {vl_c_donnees+="vf_c_action=modifier&";vf_c_action="modification";}
      else
        {vl_c_donnees+="vf_c_action=ajouter&";vf_c_action="ajout"}
      break;
    case "supprimer":
        if(confirm("Confirmez-vous la suppression de ce libellé ?") == false) return;
        vl_c_donnees+="vf_c_action=supprimer&";
        vf_c_action="suppression";
      break;
  }
  //  Enregistrement données action
  fa_xmlhttprequest_txt(vf_c_script_bdope_action,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
