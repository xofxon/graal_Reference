<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_o_tree_01,vf_inv_cleunik;
const vf_c_url_alimente_table_01="_graal_das_inventaire_01.php?";
const vf_c_script_bdope_fen="_graal_bdope_inventaire_01.php";
const vf_c_script_xml_inventaire='_graal_xml_inventaire_01.php';
const vf_c_script_das_lignes_inventaire='_graal_das_lignes_inventaire_01.php?';
const c_fen_panier_article='_graal_traitements_articles_01.php';
const c_script_pdf_inventaire="_graal_pdf_inventaire_01.php";
var vf_c_action;
function pf_aa_init(){
  vf_o_tree_01=fa_gid("arbre_inventaire");
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_oui("bt_voir_articles");
  fa_grise_oui("bt_sele_articles");
  fa_grise_groupe_oui('broadcaster_01');
  pf_raz_fiche();
  pf_alimente_table("arbre_receptacle");
}
function pf_affiche_detail_lignes() {
  fa_das("arbre_lignes_inventaire",vf_c_script_das_lignes_inventaire+"raf="+Math.random()+"&vl_e_inv_cleunik="+vf_inv_cleunik);
}
function pf_affiche_donnees(stream){
  var vl_c_datas=stream;
  pf_raz_fiche()
  vf_inv_cleunik=fa_xml_get(vl_c_datas,'inv_cleunik')
  fa_value_set('tb_description',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set('tb_dateheurecreation',fa_xml_get(vl_c_datas,'dateheurecreation'));
  fa_value_set("tb_dateheureinventaire",fa_xml_get(vl_c_datas,'dateheureinventaire'));
  fa_value_set('rdg_etat',fa_xml_get(vl_c_datas,'etat'));
  fa_value_set('rdg_gestdepemp',fa_xml_get(vl_c_datas,'gestion_depemp'));
	fa_mlsel("ml_tarif_reference",fa_xml_get(vl_c_datas,'tarif_reference'),"value");
	fa_mlsel("ml_criteres",fa_xml_get(vl_c_datas,'critere_cleunik'),"value");
}
function pf_alimente_defaut(){
  fa_value_set("tb_description","");
  fa_value_set("tb_dateheureinventaire",c_date_defaut_deb);
  fa_att_set('ra_etat_non','selected', 'true');
}
function pf_alimente_table(){
	fa_das("arbre_inventaire",vf_c_url_alimente_table_01+"raf="+Math.random());
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      var rowIndex = vf_o_tree_01.currentIndex;
      if(rowIndex == -1){alert("Il faut selectionner un élément dans la liste.");return;}
      fa_grise_non("bt_supprimer");
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_non("bt_voir_articles");
    fa_grise_non("bt_sele_articles");
    pf_affiche_detail_lignes();
    fa_grise_groupe_non('broadcaster_01');
    fa_focusdonne("tb_description");
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_grise_groupe_non('broadcaster_01');
    fa_focusdonne("tb_description")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_oui("bt_voir_articles");
    fa_grise_oui("bt_sele_articles");
    pf_raz_fiche();
    fa_grise_groupe_oui('broadcaster_01');
    vf_o_tree_01.focus();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vf_inv_cleunik==-1) {
    vf_inv_cleunik=stream;
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_non("bt_voir_articles");
    fa_grise_non("bt_sele_articles");
    pf_sele_articles();
  } else {
    if (vl_datas!='ok') {
      //alert(vl_datas);
    }
    pf_alimente_table();
    pf_etat_fen("annuler");
  }
}
function pf_ouvre(vv_quoi_01) {
  var i=fa_cui("arbre_lignes_inventaire");if(i==-1){return;}
  var vl_e_art_cleunik=fa_cell_get("arbre_lignes_inventaire",i,"tc_art_cleunik");
  switch (vv_quoi_01) {
    case "art":
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_art_vl_e_art_cleunikcleunik+"&","");
      break;
  }
}
function pf_pdf() {
  fa_ouvre(c_script_pdf_inventaire+"?vl_e_inv_cleunik="+fa_enc(vf_inv_cleunik)+"&");
}
function pf_raz_fiche(){
  vf_inv_cleunik=-1;
  fa_value_set("tb_description","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("tb_dateheureinventaire",c_date_defaut_deb);
  fa_value_set('tb_blocnotebrut',"");
  fa_value_set('tb_heu_deb',"00:00:05");
  fa_att_set('ra_etat_oui','selected', 'false');
  fa_att_set('ra_etat_non','selected', 'false');
  fa_value_set('rdg_etat',2);
  fa_att_set('ra_gestdepemp_oui','selected', 'false');
  fa_att_set('ra_gestdepemp_non','selected', 'false');
  fa_value_set('rdg_gestdepemp',2);
	fa_mlsel("ml_criteres",0,"value");
}
function pf_retour_selection_articles(vl_t_art_cleunik) {
  vf_c_tableau_retour=vl_t_art_cleunik;
  setTimeout(pf_retour_selection_articles_suite, 0);
}
function pf_retour_selection_articles_suite() {
  var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_inv_cleunik="+fa_enc(vf_inv_cleunik)+"&";
  vl_c_donnees+="vf_c_action=articles_kilometre&";
  vl_c_donnees+="vl_t_listecles="+fa_enc(fa_jsarray2php_00(vf_c_tableau_retour))+"&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return}
  var rowIndex = vf_o_tree_01.currentIndex;
  if(rowIndex == -1){alert("Il faut selectionner un élément dans la liste.");return;}
  vf_e_inv_cleunik=vf_o_tree_01.view.getCellText( rowIndex ,vf_o_tree_01.columns.getNamedColumn("tc_inv_cleunik"));
  var s ="vl_e_inv_cleunik="+fa_enc(vf_e_inv_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml_inventaire,s,pf_affiche_donnees);
}
function pf_sele_articles() {
  fa_ouvre(c_fen_panier_article,1000,800);
}
function pf_validation(vv_quoi){
  var vl_c_donnees,vl_c_date;
  vl_c_donnees="";
  vl_c_donnees+="vl_inv_cleunik="+fa_enc(vf_inv_cleunik)+"&";
  vl_c_donnees+="vl_description="+fa_enc(fa_value_get("tb_description"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_dateheureinventaire="+fa_enc(fa_value_get("tb_dateheureinventaire"))+" "+fa_value_get("tb_heu_deb"))+"&";
  vl_c_donnees+="vl_etat="+fa_enc(fa_value_get('rdg_etat'))+"&";
  vl_c_donnees+="vl_gestion_depemp="+fa_enc(fa_value_get('rdg_gestdepemp'))+"&";
  vl_c_donnees+="vl_tarif_reference="+fa_enc(fa_value_get('ml_tarif_reference'))+"&";
  vl_c_donnees+="vl_critere_cleunik="+fa_enc(fa_value_get('ml_criteres'))+"&";
  switch(vv_quoi){
    case "enregistrer":
      if (vf_inv_cleunik!=-1)
        {vl_c_donnees+="vf_c_action=modifier&";}
      else
        {vl_c_donnees+="vf_c_action=ajouter&";}
      break;
    case "supprimer":
        Check = confirm("Confirmez-vous la suppression de cet inventaire ?");
        if(Check == false) return;
        vl_c_donnees+="vf_c_action=supprimer&";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
function pf_voir_articles() {
  pf_voir_deck(1);
}
function pf_voir_deck(vv_lequel) {
  fa_gid("dk_01").selectedIndex=vv_lequel;
}

]]></script>
END;
?>
