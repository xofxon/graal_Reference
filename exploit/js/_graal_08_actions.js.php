<?php
switch ($vl_c_genreaction){
	case "recmail":
		$pf08_traitement_adresse="";
		break;
	case "recmail_erreur":
$pf08_tratement_action=<<<EOT
function pf08_traitement_action(){
  var vl_t_action=[];
	vl_t_action[0]=vf_e_action_cleunik;
  if (vl_t_action.length==0) {return;}
	pf08_grise_fenetre("oui");
  var vl_c_donnees="vf_c_action=kilometres_statut&";
  vl_c_donnees+="vl_t_actions="+fa_enc(fa_jsarray2php_00(vl_t_action))+"&";
	vl_c_donnees+="nouveau_statut="+fa_enc(fa_mlget("ml_statut_action_modi"))+"&";
  fa_xmlhttprequest_txt(c_script_bdope_statut_action,vl_c_donnees,pf08_traitement_action_fin);
}
function pf08_traitement_action_fin(){
	pf08_grise_fenetre("non");
}
EOT;
$pf08_traitement_adresse=<<<EOT
function pf08_traitement_adresse() {
  if (fa_value_get("tb_adresse_courriel")=="") {return;}
	pf08_grise_fenetre("oui");
  var vl_c_donnees="vf_c_action=changer_actif_message&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
	vl_c_donnees+="vl_refweb="+fa_enc(fa_value_get("tb_adresse_courriel"))+"&";
	vl_c_donnees+="vl_valide="+fa_enc(fa_value_get("rdg_valide"))+"&";
  fa_xmlhttprequest_txt(c_script_bdope_courriel,vl_c_donnees,pf08_traitement_adresse_fin);
}
function pf08_traitement_adresse_fin(vv_retour){
	fa_value_set("la_retour_modif",vv_retour);
	fa_value_set("tb_adresse_courriel","");
	pf08_grise_fenetre("non");
}
EOT;
		break;
	case "recmail_erreur_massif":
	case "contenu_courriels_recus_masse":
$pf08_tratement_action=<<<EOT
function pf08_traitement_action(){
  var vl_t_action=[]=pf08_tab_actions();
  if (vl_t_action.length==0) {return;}
	pf08_grise_fenetre("oui");
  var vl_c_donnees="vf_c_action=kilometres_statut&";
  vl_c_donnees+="vl_t_actions="+fa_enc(fa_jsarray2php_00(vl_t_action))+"&";
	vl_c_donnees+="nouveau_statut="+fa_enc(fa_mlget("ml_statut_action_modi"))+"&";
  fa_xmlhttprequest_txt(c_script_bdope_statut_action,vl_c_donnees,pf08_traitement_action_fin);
}
function pf08_traitement_action_fin(){
	pf08_grise_fenetre("non");
}
EOT;
		$pf08_traitement_adresse=<<<EOT
function pf08_traitement_adresse() {
	var vl_t_action=pf08_tab_courriels();
  if (vl_t_action.length==0) {return;}
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(c08_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_action),pf08_traitement_adresse_suite);
}
function pf08_traitement_adresse_suite(vv_retour) {
  var vl_c_donnees="vf_c_action=changer_actif_message_kilometre&vs_tempo_panier_action=vs_tempo_panier_action&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
	vl_c_donnees+="vl_valide="+fa_enc(fa_value_get("rdg_valide"))+"&";
  fa_xmlhttprequest_txt(c_script_bdope_courriel,vl_c_donnees,pf08_traitement_adresse_fin);
}
function pf08_traitement_adresse_fin(vv_retour){
	alert(vv_retour);
	pf08_grise_fenetre("non");
}
EOT;
	break;
}

echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_e_action_cleunik=0;
const c_script_bdope_statut_action="_graal_bdope_traitements_actions_01.php";
const c_script_bdope_courriel="_graal_bdope_act_interlo_mail_01.php";
const c08_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_action&';
const c08_script_recupera="_graal_das_import_adresses_courriels_03.php?quoi=sources_courriels&var=vs_tempo_panier_action&";
function pf08_aa_init() {
	fa_att_set("$vl_c_arbre_action","onselect","pf08_sel_ligne_bem();");
}
function pf08_grise_fenetre(vv_quoi){
	switch (vv_quoi){
		case "oui":
			fa_grise_fenetre("","oui");
			break;
		case "non":
			fa_grise_fenetre("","non");
			break;
	}
}
function pf08_recmail_erreur_massif(){
	var vl_t_action=pf08_tab_actions();
  if (vl_t_action.length==0) {return;}
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(c08_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_action),pf08_recmail_erreur_massif_suite);
}
function pf08_recmail_erreur_massif_suite(stream) {
  fa_das("arbre_recupera_das_courriel",c08_script_recupera+'raf_random='+Math.random());
	fa_grise_fenetre("","non");
}
function pf08_sel_ligne_bem()  {
  var rowIndex = fa_cui("$vl_c_arbre_action");if(rowIndex == -1){return;}
  vf_e_action_cleunik=fa_cell_get("arbre_actions_01",rowIndex,"tc_action_cleunik");
	pf_recmail_affiche_donnees();
}
function pf08_tab_actions(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_action=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_actions_01");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_action[i]=fa_cell_get("arbre_actions_01",vl_t_tableau[i],"tc_action_cleunik");
    }
  }
  return vl_t_action;
} 
function pf08_tab_courriels(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_action=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_recupera_das_courriel");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_action[i]=fa_cell_get("arbre_recupera_das_courriel",vl_t_tableau[i],"tc_recupera_das_refweb");
    }
  }
  return vl_t_action;
} 
$pf08_tratement_action
$pf08_traitement_adresse
]]></script>
END;
?>
