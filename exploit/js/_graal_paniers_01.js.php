<?php
$vl_c_mes01='Cette fonctionnalité est en développement ...\nMerci pour votre patience.';
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
****************************************************************
**********  Fenêtre de gestion des Requêtes personnelles  ********
****************************************************************
*/
var vf_e_panier_cleunik=-1;
var vf_c_action;
var vl_c_script_meta,vl_c_script_titre;
var vf_c_genre;
var vf_c_ValRetour;
var vf_c_requete_en_cours;
const vf_c_url_execute_requete="_admin_fen_bd_select_lambda_01.php?";
const vf_c_script_xml="_graal_xml_paniers_01.php?"
const vf_c_url_alimente_table="_graal_das_paniers_01.php?vl_e_type=1&vl_c_quelspaniers=$vl_c_quelsdocs&"
const vf_c_script_bdope_doc="_graal_bdope_paniers_01.php";
const c_script_droits='_graal_fen_paniers_droits_01.php?';
function pf_action(vv_quoi){
  switch (vv_quoi){
    case 'atteindre' :
      alert("$vl_c_mes01");
      return;
      break;
    case 'droits' :
      if (vf_e_panier_cleunik!=0)
      {
        fa_ouvre("_graal_fen_droits_01.php?vl_c_genredoc=Docus&vl_e_doc_cleunik="+vf_e_sel_cleunik,400,400)
      }
      else
      {
        alert('Vous ne pouvez pas gérer les droits de cette manière !!');
      }
      break;
  }
}
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  pf_raz_fiche()
  vf_e_panier_cleunik=fa_xml_get(vl_c_datas,'panier_cleunik');
  fa_value_set('tb_titre',fa_xml_get(vl_c_datas,'panier_titre'));
  fa_value_set('tb_descriptif_sommaire',fa_xml_get(vl_c_datas,'blocnote_brut'));
  fa_value_set('la_dateheurecreation',fa_xml_get(vl_c_datas,'dateheurecreation'));
  fa_value_set('la_dateheuremodif',fa_xml_get(vl_c_datas,'dateheuremodif'));
  fa_value_set('req_manu_edition',fa_xml_get(vl_c_datas,'panier_requete_selection'));
}
function pf_affiche_datas_suite(stream){
  fa_value_set('req_manu_edition',stream);
}
function pf_alimente_defaut(){}
function pf_alimente_table() {
  fa_das("arbre_des_paniers",vf_c_url_alimente_table+"raf01="+Math.random())
}
function pf_droits() {
  if (vf_e_panier_cleunik==-1) {return;}
  fa_ouvre(c_script_droits+"vl_e_panier_cleunik="+vf_e_panier_cleunik,400,400);
}
function pf_etat_fen(vv_quoi){
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_gid("la_genre").getAttribute("_graal_lesquels")
       fa_grise_non("bt_ajouter");
       fa_grise_non("bt_annuler");
       fa_grise_non("bt_detailler");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_non("bt_sortir");
       fa_grise_oui("bt_supprimer");
       pf_alimente_table();
       break;
     case "selectionner":  //   à affiner, en fonction des droits
       fa_grise_oui("bt_ajouter");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_detailler");
       fa_grise_oui("bt_enregistrer");
       fa_grise_non("bt_modifier");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_supprimer");
       fa_att_set("menu_02_01","disabled","false");
       //fa_grise_non("menu_02_01");  Ne fonctionne pas pour un menu
       break;
     case "modifier":
       fa_grise_non("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_att_set("menu_02_01","disabled","false");
       //fa_grise_non("menu_02_01");  Ne fonctionne pas pour un menu
       fa_focusdonne('tb_titre');
       break;
     case "annuler":
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_detailler");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_non("bt_sortir");
       fa_grise_oui("bt_supprimer");
       fa_att_set("menu_02_01","disabled","true");
       //fa_grise_oui("menu_02_01");  Ne fonctionne pas pour un menu
       fa_focusdonne('arbre_des_paniers');
       pf_raz_fiche()
       break;
     case "sortir":
       window.history.back(); //  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre
       break;   
    default:
      alert("Cas"+vv_quoi+" pas géré ...")
      break;
}
  }
function pf_lance(){
  var vl_c_action="";
  var vl_c_url=vf_c_url_execute_requete;
  vl_c_action=fa_gid("req_manu_edition").value;
  vl_c_url+="vl_e_panier_cleunik="+vf_e_panier_cleunik+"&";
  fa_gid('tabpan_03').selectedIndex=1
  fa_att_set("req_manu_resultat","src",vl_c_url);
}
function pf_raz_fiche()
{
  fa_value_set('tb_titre',"");
  fa_value_set('tb_descriptif_sommaire',"");
  fa_value_set('la_dateheurecreation',"");
  fa_value_set('la_dateheuremodif',"");
  fa_value_set('req_manu_edition',"");
  vf_e_panier_cleunik=-1;
}  
function pf_sel_ligne(vv_objet) {
  if (fa_est_grise("bt_detailler")==true) {return};
  var arbre = fa_gid(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_panier_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("panier_cleunik"));
  var s ="vl_e_panier_cleunik="+fa_enc(vf_e_panier_cleunik)+"&raf01="+Math.random()+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml,s,pf_affiche_datas);
}

function pf_validation(vv_quoi){
var s;
switch(vv_quoi){
  case "supprimer":
    var Check = confirm("Confirmez-vous la suppression de ce panier ?");
    if(Check == false) return;
    vf_c_action="supprimer";
    break;
  case "enregistrer":
    switch (vf_e_panier_cleunik) {
      case -1:
        return;
      default:
      vf_c_action="modifier_infos_gene";
    }
    break;
  default:
    alert(vv_quoi+" imprévu !!!")
    return;
    break;
  }     
  vf_c_requete_en_cours=vf_c_action;
  s="";
  s+="vl_panier_cleunik="+fa_enc(vf_e_panier_cleunik)+"&";
  s+="vl_panier_titre="+fa_enc(fa_value_get("tb_titre"))+"&";
  s+="vl_blocnote_brut="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
  s+="vl_c_action="+fa_enc(vf_c_action)+"&";
  fa_att_set("_graal_fen_panier_01","wait-cursor","true");
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_validation_fin);
}
function pf_validation_fin(stream){
  var vl_datas = stream;
  fa_gid("_graal_fen_panier_01").removeAttribute("wait-cursor");
  pf_raz_fiche();
  pf_alimente_table();
  pf_etat_fen('annuler');
}
function pf_voir_plein_ecran(){
  var arbre = fa_gid("arbre_des_paniers");
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_panier_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("panier_cleunik"));
  var s ="vl_e_panier_cleunik="+fa_enc(vf_e_panier_cleunik)+"&raf01="+Math.random()+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml,s,pf_voir_plein_ecran_suite);
}
function pf_voir_plein_ecran_suite(stream){
  var vl_c_datas=stream;
  var vl_c_url=vf_c_url_execute_requete;
  vl_c_url+="vl_c_requete="+fa_xml_get(vl_c_datas,'panier_requete_selection')+"&";
  fa_ouvre(vl_c_url,0,0)
}  
]]></script>
END;
?>
