<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c_script_edite_emimail="_graal_xml_emimail_01.php?action_cleunik=$vl_action_cleunik";
const c_script_edite_emimail_texte="_graal_xml_emimail_03.php?action_cleunik=$vl_action_cleunik";
const c_script_edite_html="_graal_xml_emimail_02.php?action_cleunik=$vl_action_cleunik";
const c_script_downl_pj="_graal_tel_doc_03.php?vl_e_doc_cleunik=";
var vf_emimail_type="";
function pf_emimail_affiche_donnees() {
  fa_xmlhttprequest_xml(c_script_edite_emimail+"&raf="+Math.random(),"",pf_emimail_affiche_datas);
}
function pf_emimail_affiche_datas(stream){
  var vl_c_datas = stream;
  fa_att_set("emimail_tb_sujet","_graal_cleunik",fa_xml_get(vl_c_datas,'courriel_en_mes_cleunik'));
  fa_value_set("emimail_tb_sujet",fa_xml_get(vl_c_datas,'sujet'));
  fa_value_set("tb_emimail_destinataires",fa_xml_get(vl_c_datas,'destinataires'));
  fa_value_set("tb_emimail_destinataires_cc",fa_xml_get(vl_c_datas,'destinataires_cc'));
  fa_value_set("tb_emimail_destinataires_cci",fa_xml_get(vl_c_datas,'destinataires_cci'));
  vf_emimail_type=fa_xml_get(vl_c_datas,'type');
  if (vf_emimail_type==1) {
  	fa_att_set("tb_message_text","src",c_script_edite_emimail_texte+"&raf="+Math.random());
    fa_gid('dk_01_emimail').selectedIndex=0;

  } else {
    fa_att_set("tb_message_html","src",c_script_edite_html+"&raf="+Math.random());
    fa_gid('dk_01_emimail').selectedIndex=1;
  }
  var vl_nb_pj=fa_xml_get(vl_c_datas,'pj_nombre');
  for (i=0; i<vl_nb_pj; i++){
    var vl_c_label=fa_xml_get(vl_c_datas,'nom_pj_'+i);
    var vl_cleunik=fa_xml_get(vl_c_datas,'cleunik_pj_'+i);
		var vl_titre=fa_xml_get(vl_c_datas,'titre_'+i);
    var vl_nombre_criteres=fa_xml_get(vl_c_datas,'nombre_criteres_'+i);
		if (vl_nombre_criteres!="0"){
			vl_nombre_criteres=" ["+fa_xml_get(vl_c_datas,'nombre_criteres_'+i)+" critÃ¨res.]";
		} else {
			vl_nombre_criteres="";
		}
    var row = document.createElement('listitem');
    var cell = document.createElement('listcell');
		if (vl_titre!=""){
			cell.setAttribute('label', vl_c_label+" ("+vl_titre+") "+vl_nombre_criteres);
		} else {
			cell.setAttribute('label', vl_c_label+vl_nombre_criteres);
		}
    cell.setAttribute('_graal_cleunik',vl_cleunik);
    row.appendChild( cell );
    fa_gid("li_pj").appendChild( row );
  }
  if (fa_xml_get(vl_c_datas,'destinataires_cc')!="") {fa_cache_non("tab_dest_cc");}
  if (fa_xml_get(vl_c_datas,'destinataires_cci')!="") {fa_cache_non("tab_dest_cci");}
  if (vl_nb_pj!=0) {fa_cache_non("tab_pj");}
  switch ("$vl_c_genreaction"){
    case "emimail":
    case "emimail_brouillon":
      fa_cache_non("bt_emimail_renvoie");
      break;
  }
}
function pf_emimail_imprime_html() {
  document.getElementById("tb_message_html").contentWindow.window.print();
}
function pf_emimail_imprime_text() {
  document.getElementById("tb_message_text").contentWindow.window.print();
}
function pf_emimail_ouvre_criteres_doc(){
	var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
	pf07_ouvre_criteres_doc(item1.childNodes[0].getAttribute('_graal_cleunik'),13,item1.childNodes[0].getAttribute('label'));
}
function pf_emimail_ouvre_doc(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
	var vl_c_param="doc_cleunik="+item1.childNodes[0].getAttribute('_graal_cleunik')+"&";
  vl_c_param+="portee_cleunik=$vl_action_cleunik&";
	vl_c_param+="quelsdocs=undoc_action&genre=action&";
	pf07_ouvre_doc(vl_c_param);
}
function pf_emimail_renvoie() {
  var vl_c_fen_courriel_texte="_graal_fen_courriel_01.php?&action_cleunik=$vl_action_cleunik&genre=renvoi&type=";
  if (vf_emimail_type==1) {
    vl_c_fen_courriel_texte+="texte";
  } else {
    vl_c_fen_courriel_texte+="html";
  }
  fa_ouvre(vl_c_fen_courriel_texte,0,0)
}
function pf_emimail_renvoie_brouillon() {
  var vl_c_fen_courriel_texte="_graal_fen_courriel_01.php?&action_cleunik=$vl_action_cleunik&genre=brouillon&type=";
  if (vf_emimail_type==1) {
    vl_c_fen_courriel_texte+="texte";
  } else {
    vl_c_fen_courriel_texte+="html";
  }
  fa_ouvre(vl_c_fen_courriel_texte,0,0)
}

function pf_emimail_sel_pj(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
  fa_ouvre(c_script_downl_pj+item1.childNodes[0].getAttribute('_graal_cleunik'),400,400);
}
function pf_emimail_voir_pj(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
  pf07_visualise(item1.childNodes[0].getAttribute('_graal_cleunik'));
}
]]></script>
END;
?>
