<?php
include("_graal_var_portee.php");
$vl_e_portee=$vl_e_articl;
$vl_c_bdl_102=fa_recup_dico_js("bdl_102");
$pf_alimente_table="function pf_alimente_table() {fa_approximatif_bbo();}";
$pf_aa_init_01="fa_ael('bbo_ml_qui','ValueChange',po_change_menu);po_change_menu();";
switch ($vl_e_laquelle){
	case 1:
		$script_km="kilometres_remplace_tpf";
		break;
	case 2:
		$script_km="kilometres_remplace_tpf_01";
		break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_t_panier=[];
const vf_c_script_bdope_fen="_graal_bdope_traitements_articles_01.php";
const vf_c_script_das_article='_graal_das_articles_tpf_01.php?vl_e_laquelle=$vl_e_laquelle&';
const vf_c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_article';
const vf_c_script_bdope_panier='_graal_bdope_paniers_01.php';
function pf_aa_init() {
  fa_att_set("arbre_des_articles",'seltype','multiple');
  fa_att_set("arbre_des_articles",'context','pop_selections');
  fa_att_set("arbre_des_articles",'onselect','');
  fa_att_set("arbre_des_articles_panier",'seltype','multiple');
  fa_att_set("arbre_des_articles_panier",'context','pop_panier');
  fa_att_set("arbre_des_articles_panier",'onselect','');
  $pf_aa_init_01
  pf_alimente_table();
}
$pf_alimente_table
function pf_article_ouvre() {
  var i=fa_cui("arbre_des_articles");if(i==-1){return;}
  var vl_e_art_cleunik=fa_cell_get("arbre_des_articles",i,"art_cleunik");
	fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_e_art_cleunik+"&","");
}
function pf_panier_ajoute() {
  var vl_t_article=pf_tab_articles();
  if (vl_t_article.length==0) {return;}
  var vl_t_panier=[];
  vl_t_panier=vf_t_panier;
  vf_t_panier=vl_t_panier.concat(vl_t_article);
  fa_remove_attribute("bt_voir_panier","collapsed");
  fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
}
function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_articles_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_article=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_article[i]=fa_cell_get("arbre_des_articles_panier",vl_t_tableau[i],"art_cleunik_panier");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier.length;i++) {
      if (vl_t_article.indexOf(vf_t_panier[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier[i];
      }  
    }
    vf_t_panier=vl_t_panier;
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
  }
}
function pf_remplace_tpf() {
  var vl_t_article=[];
  vl_t_article=pf_tab_articles();
  vl_e_nb_sel=vl_t_article.length;
  if (vl_e_nb_sel!=0) {
    if (confirm("$vl_c_bdl_102("+vl_e_nb_sel+")")!=true) {return};
    vl_c_donnees="vf_c_action=$script_km";
    vl_c_donnees+='&vl_e_compta_cleunik='+fa_mlget("ml_categorie_compta");
    vl_c_donnees+='&vl_e_tpf_cleunik='+fa_mlget("ml_tpf");
    vl_c_donnees+='&vl_e_tpf_cleunik_new='+fa_mlget("ml_tpf_new");
    vl_c_donnees+="&vl_t_article="+fa_enc(fa_jsarray2php_00(vl_t_article))+"&";
    fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
  }
}
function pf_tab_articles(){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_article=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_articles");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_article[i]=fa_cell_get("arbre_des_articles",vl_t_tableau[i],"art_cleunik");
    }
  }
  return vl_t_article;
} 
function pf_tableau_donnees_fin(stream) {
	var s="";	
	s+='&vl_e_compta_cleunik='+fa_mlget("ml_categorie_compta");
    s+='&vl_e_tpf_cleunik='+fa_mlget("ml_tpf");
  fa_das("arbre_des_articles_panier",vf_c_script_das_article+'vl_c_type=0&vl_e_actif=0&raf_random='+Math.random()+'&'+s)
}
function pf_validation_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
  fa_approximatif_bbo();
  pf_panier_enleve();
}
function pf_valide_danspanier() {
  var vl_e_nb=fa_cl("arbre_des_articles_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_liste=""
  for(i=0;i<vl_e_nb;i++) { 
    vl_c_liste+=fa_cell_get("arbre_des_articles_panier",i,"art_cleunik_panier")+","
  }
  vl_c_liste=vl_c_liste.substring(0,vl_c_liste.length-1)
  var vl_c_titrepanier=prompt("Titre du nouveau panier : ");
  if (vl_c_titrepanier==null) {alert("Création du panier abandonnée.");return}
  vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vl_c_titrepanier)+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=1&";
  vl_c_donnees+="vl_actif=1&";
  vl_c_donnees+="vl_panier_resultat="+vl_c_liste+"&";
  vl_c_donnees+="vl_c_action=ajouter_panier&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
function pf_valide_danspanier_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
}
function pf_voir_deck(vv_lequel) {
  fa_gid("deck_articles").selectedIndex=vv_lequel;
}

]]></script>
END;
?>
