<?php
include("_graal_var_portee.php");
$vl_c_bdp_102=fa_recup_dico_js("bdp_102");
$vl_e_portee=$vl_e_interl;
switch ($vl_c_genreacteur) {
  case "tousss": $vl_e_portee+=000000000000;break;  //  Tous les acteurs
  case "110001": $vl_e_portee+=$vl_e_procli;break;  //  prospects clients
  case "110002": $vl_e_portee+=$vl_e_profou;break;  //  prospects fournisseurs
  case "110003": $vl_e_portee+=$vl_e_client;break;  //  clients
  case "110004": $vl_e_portee+=$vl_e_fourni;break;  //  fournisseurs
  case "110005": $vl_e_portee+=$vl_e_autrac;break;  //  autres acteurs
  case "110006": $vl_e_portee+=$vl_e_actind;break;  //  acteurs indéterminés
  case "110000": $vl_e_portee+=$vl_e_entrep;break;  //  membres de l'entreprise
}
$vl_tb_droits_110000_int=_graal_requete_droits_fenetre("Fen_00140",$vl_e_uti_cleunik);
$vl_tb_droits_110001_int=_graal_requete_droits_fenetre("Fen_00142",$vl_e_uti_cleunik);
$vl_tb_droits_110002_int=_graal_requete_droits_fenetre("Fen_00144",$vl_e_uti_cleunik);
$vl_tb_droits_110003_int=_graal_requete_droits_fenetre("Fen_00141",$vl_e_uti_cleunik);
$vl_tb_droits_110004_int=_graal_requete_droits_fenetre("Fen_00143",$vl_e_uti_cleunik);
$vl_tb_droits_110005_int=_graal_requete_droits_fenetre("Fen_00146",$vl_e_uti_cleunik);
$vl_tb_droits_110006_int=_graal_requete_droits_fenetre("Fen_00145",$vl_e_uti_cleunik);
echo <<<END
<script type="application/x-javascript"><![CDATA[
var tree;
var vf_c_url_alimente_table,vf_c_recup_requete;
const vf_c_script_int='_graal_rech_interlo_01.php';
const vf_c_script_bdope_fen="_graal_bdope_traitements_interlocuteurs_01.php";
const vf_c_script_bdope_panier='_graal_bdope_paniers_01.php';
const cf_fen_civilites='_graal_fen_civilites.php';
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const cf_fen_choix_critere="_graal_fen_sel_choix_criteres.php?vl_e_domaine=$vl_e_interl&genre=$vl_c_genreacteur&genrecritere=";
const vf_c_script_bdope_fen_criteres="_graal_bdope_act_interlo_criteres_01.php?genreacteur=$vl_c_genreacteur&";
var vf_t_panier=[];
var vf_e_cleunik_civilite=null;
const c_genre_acteur="$vl_c_genreacteur";
const lstn_grise_acteurs= { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");} 
};
function pf_aa_init() {
  tree=fa_gid("arbre_des_interlocuteurs");
  fa_att_set("arbre_des_interlocuteurs",'seltype', 'multiple');
  fa_att_set("arbre_des_interlocuteurs",'context','pop_selections');
  fa_att_set("arbre_des_interlocuteurs_panier",'seltype', 'multiple');
  fa_att_set("arbre_des_interlocuteurs_panier",'context','pop_panier');
  fa_badl("arbre_des_interlocuteurs",lstn_grise_acteurs);
  fa_badl("arbre_des_interlocuteurs_panier",lstn_grise_acteurs);
  switch ($vl_c_type) {
  	case 1:
  		fa_ael("bbj_ml_qui","ValueChange",po_change_menu);
  		po_change_menu();
  		break;
  }
  pf_approximatif();
	fa_focusdonne('bbj_tb_rechapproxima');
}
function pf_acteur_ouvre(vv_qui) {
  switch (vv_qui) {
    case 1:vl_c_arbre="arbre_des_interlocuteurs";break;
    case 2:vl_c_arbre="arbre_des_interlocuteurs_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  var param=fa_cell_get(vl_c_arbre,i,"typeacteur")+'&act_cleunik='+fa_cell_get(vl_c_arbre,i,"act_cleunik")+'&';
  fa_ouvre(vf_c_script_fen_acteur+param,1000,800)
}
function pf_alimente_table() {
  switch (fa_value_get("bbj_ml_qui")) {
    case "000000": case "110000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006":
      fa_cache_oui("portee");break;
    case "999999": case "888888":
      fa_cache_non("portee");break;
  }
  fa_grise_fenetre("","oui");
  fa_das("arbre_des_interlocuteurs",vf_c_url_alimente_table);
}
function pf_approximatif() {
var vl_c_limit=""
if (fa_value_get("bbj_tb_limit")==null){
	vl_c_limit="&vl_e_limit=100000&";
} else {
	vl_c_limit="&vl_e_limit="+fa_value_get("bbj_tb_limit")+"&";
}
switch ($vl_c_type) {
    case 1:
	  switch (fa_value_get("bbj_ml_qui")) {
	    case "000000": case "110000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006": case "999999":
	      if ( fa_value_get("bbj_tb_rechapproxima") == "" ) {return;};
	      item=fa_gid("bbj_ml_actif").selectedItem;
	      vf_c_url_alimente_table=vf_c_script_int+'?listecles=&vl_c_recherche='+fa_enc(fa_value_get("bbj_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bbj_ml_zone");
	      vf_c_url_alimente_table+='&vl_c_type='+fa_value_get("bbj_ml_type")+'&vl_c_qui='+fa_value_get("bbj_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bbj_ml_actif");
	      vf_c_url_alimente_table+='&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&";
	      vf_c_recup_requete=vf_c_url_alimente_table+'&sortie=sql&';
      	  vf_c_url_alimente_table+=vl_c_limit+'&sortie=das&';
	      break;
	    case "888888":
	      vf_c_url_alimente_table=vf_c_script_int+'?listecles=&vl_c_recherche='+fa_enc(fa_value_get("bbj_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bbj_ml_zone");
	      vf_c_url_alimente_table+='&vl_c_type='+fa_value_get("bbj_ml_type")+'&vl_c_qui='+fa_value_get("bbj_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs=4&';
	      vf_c_recup_requete=vf_c_url_alimente_table+'&sortie=sql&';
      	  vf_c_url_alimente_table+=vl_c_limit+'&sortie=das&';
	      break;
	  }
	  break;
	case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_int+'?vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui=$vl_e_genreacteur&raf_random="+Math.random();
      vf_c_url_alimente_table+="&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik");
      vf_c_url_alimente_table+="&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      if (fa_est_coche("cb_actifs_oui")==true){vf_c_url_alimente_table+="vl_c_actifs=1&";}
      if (fa_est_coche("cb_actifs_non")==true){vf_c_url_alimente_table+="vl_c_inactifs=2&";}
      vf_c_recup_requete=vf_c_url_alimente_table+'&sortie=sql&';
      vf_c_url_alimente_table+=vl_c_limit+'&sortie=das&';
      break;
	case 4:// sans le critere avec la possibilité d'en ajouter un
      vf_c_url_alimente_table=vf_c_script_int+'?vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui=$vl_e_genreacteur&raf_random="+Math.random();
      vf_c_url_alimente_table+="&vl_e_choix_cleunik=0";
      vf_c_url_alimente_table+="&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      if (fa_est_coche("cb_actifs_oui")==true){vf_c_url_alimente_table+="vl_c_actifs=1&";}
      if (fa_est_coche("cb_actifs_non")==true){vf_c_url_alimente_table+="vl_c_inactifs=2&";}
      vf_c_recup_requete=vf_c_url_alimente_table+'&sortie=sql&';
      vf_c_url_alimente_table+=vl_c_limit+'&sortie=das&';
      break;
      
    case 6:// Sélections de critères "simples"
    var vl_c_t01;
    if ( fa_value_get("bbj_tb_rechapproxima") == "" ) {return;};
      var item=fa_gid("bbj_ml_actif").selectedItem;
      var vl_e_int_choix_cleunik="";
	  var vl_e_int_critere_cleunik="";
	  vl_e_int_choix=fa_value_get("rdg_cherche_choix");
	  if (vl_e_int_choix==3){
	  	vl_e_int_choix_cleunik=0;
		vl_e_int_choix=0;
		vl_e_int_critere_cleunik=0;
	  } else {
		  var vl_arbre=fa_gid('tb_choix_interlocuteurs');
		  if(vl_arbre.currentIndex>=0) {	
				var vl_t_tableau=fa_lignes_selectionnees("tb_choix_interlocuteurs");
				var vl_e_nb_sel=vl_t_tableau.length;
			  	if (vl_e_nb_sel!=0) {
			    	for(i=0;i<vl_e_nb_sel;i++) {
			    		var selected  = vl_arbre.contentView.getItemAtIndex(vl_t_tableau[i]);
						if (i!=0) {
							vl_e_int_choix_cleunik+=",";
							vl_e_int_critere_cleunik+=",";
						}
	    				vl_e_int_choix_cleunik+= selected.firstChild.childNodes[0].getAttribute("_graal_choix_cleunik");
						vl_e_int_critere_cleunik+= selected.firstChild.childNodes[0].getAttribute("_graal_critere_cleunik");
			    	}
				}
				
		  } else {
		  	vl_e_int_choix_cleunik=0;
			vl_e_int_choix=0;
			vl_e_int_critere_cleunik=0;
		  }
	  }
	  vf_c_url_alimente_table=vf_c_script_int+'?sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone="+fa_value_get("bbj_ml_zone");
	  vf_c_url_alimente_table+='&vl_c_type='+fa_value_get("bbj_ml_type");
	  vf_c_url_alimente_table+="&vl_c_qui=$vl_c_genreacteur&raf_random="+Math.random();
	  vf_c_url_alimente_table+='&vl_c_actifs='+fa_value_get("bbj_ml_actif");
      vf_c_url_alimente_table+="&vl_e_int_choix="+vl_e_int_choix;
	  vf_c_url_alimente_table+="&vl_e_int_choix_cleunik="+vl_e_int_choix_cleunik;
	  vf_c_url_alimente_table+="&vl_e_int_critere_cleunik="+vl_e_int_critere_cleunik;
      vf_c_recup_requete=vf_c_url_alimente_table+'&sortie=sql&';
      vf_c_url_alimente_table+=vl_c_limit+'&sortie=das&';

      break;
}
  pf_alimente_table();
}
function pf_enleve_choix_critere() {
	if (!confirm("Confirmez-vous la suppression de ce choix de critère pour les interlocuteurs sélectionnés ?")){return;}
	pf_valide_criteres('suppression');
    fa_cache_oui("bt_sup_choix");
}

function pf_interlo_ouvre(vv_qui) {
  switch (vv_qui) {
    case 1:vl_c_arbre="arbre_des_interlocuteurs";break;
    case 2:vl_c_arbre="arbre_des_interlocuteurs_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  vl_c_param="genreacteur="+fa_cell_get(vl_c_arbre,i,"typeacteur")+"&vl_e_interlo_cleunik="+fa_cell_get(vl_c_arbre,i,"int_cleunik");
  vl_c_param+='&vl_e_act_cleunik='+fa_cell_get(vl_c_arbre,i,"act_cleunik")+"&";
  fa_ouvre_interlo(vl_c_param);
}

function pf_interlo_supprime() {
  alert("Fonction en développement...");
}
function pf_ouvre_choix_critere(vv_quoi) {
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_critere_qui",vv_quoi);
  fa_ouvre(cf_fen_choix_critere+vv_quoi+"&",800,400);
}
function pf_ouvre_choix_critere_recup(vv_critere_cleunik,vv_choix_cleunik,vv_c_critere_denomination,vv_c_choix_valeur_texte_01) {
  fa_cache_non("vb_criteres_panier");
  fa_cache_non("bt_sup_choix");
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_choix_cleunik",vv_choix_cleunik);
  fa_att_set("_graal_ajout_ove_bdc_datas","_graal_critere_cleunik",vv_critere_cleunik);
	fa_value_set("tb_ajout_critere_denomination",vv_c_critere_denomination);
  fa_value_set("tb_ajout_choix_valeur_texte_01",vv_c_choix_valeur_texte_01);
}
function pf_ouvre_civilites() {
  fa_ouvre(cf_fen_civilites,100,100);
}
function pf_ouvre_civilites_recup(vv_cleunik,vv_civilite) {
  vf_e_cleunik_civilite=vv_cleunik;
  vf_c_civilite=vv_civilite;
}
function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_interlocuteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_interlocuteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_interlocuteur[i]=fa_cell_get("arbre_des_interlocuteurs_panier",vl_t_tableau[i],"int_cleunik");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier.length;i++) {
      if (vl_t_interlocuteur.indexOf(vf_t_panier[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier[i];
      }  
    }
    vf_t_panier=vl_t_panier;
    fa_ds("arbre_des_interlocuteurs_panier","");
    fa_ds("arbre_des_interlocuteurs_panier",vf_c_script_int+'?vl_c_type=0&vl_c_qui=888888&vl_t_listecles='+fa_jsarray2php_00(vf_t_panier)+'&');
  }
}
function pf_recup_requete(vv_export) {
  vf_c_export=vv_export;
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_interlocuteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_interlocuteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_interlocuteur[i]=fa_cell_get("arbre_des_interlocuteurs_panier",vl_t_tableau[i],"int_cleunik");
    }
    fa_xmlhttprequest_txt(vf_c_script_int,'sortie=sql&vl_c_type=0&vl_c_actif=5&vl_t_listecles='+fa_jsarray2php_00(vl_t_interlocuteur)+'&',pf_recup_requete_fin);
  }
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
}
function pf_sel_ligne(vv_qui) {
  var vl_c_arbre="",vl_t_tableau=[],vl_e_nb_sel=0;
  vl_c_arbre=vv_qui.getAttribute("id");
  switch (vl_c_arbre) {
    case "arbre_des_interlocuteurs":vl_c_menu="mi_ouvre_interlo";break
    case "arbre_des_interlocuteurs_panier":vl_c_menu="mi_ouvre_interlo_panier";break
  }
  var i=vv_qui.currentIndex;
  if(i==-1){return;}
  vl_t_tableau=fa_lignes_selectionnees(vl_c_arbre);
  vl_e_nb_sel=vl_t_tableau.length;
  switch (vl_e_nb_sel) {
    case 0:
      fa_grise_oui(vl_c_menu);alert("Complètement impossible comme cas non ?");
      break;
    case 1:
      switch (c_genre_acteur) {
        case "tousss":
          vl_c_typeacteur=fa_cell_get(vl_c_arbre,i,"typeacteur");
          break;
        default:
          vl_c_typeacteur=c_genre_acteur;
          break;
      }
      switch (vl_c_typeacteur) {
        case "110001": if ($vl_tb_droits_110001_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110002": if ($vl_tb_droits_110002_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110003": if ($vl_tb_droits_110003_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110004": if ($vl_tb_droits_110004_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110005": if ($vl_tb_droits_110005_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110006": if ($vl_tb_droits_110006_int[0]==true) {fa_grise_non(vl_c_menu);}break;
        case "110000": if ($vl_tb_droits_110000_int[0]==true) {fa_grise_non(vl_c_menu);}break;
      }
      break;
    default:
      fa_grise_oui(vl_c_menu);
      break;
  } 
}
function pf_validation() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_e_no;
  vl_e_no=fa_value_get("ml_traitements");
  if (vl_e_no==5) {pf_ouvre_civilites();return;}
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_interlocuteurs");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    switch (vl_e_no) {
      case "0" : return;break; //  Aucun traitement
      case "1" :  //  Rendre actifs les acteurs sélectionnés
      case "2" :  //  Rendre inactifs les acteurs sélectionnés
        var vl_b_rep=confirm("$vl_c_bdp_102("+vl_e_nb_sel+")");
        if(vl_b_rep == false) return;
        break;
      case "3":
        break;
      case "4": //  Affecter une civilité
        break;
      case "5": //  Sélectionner une civilité
        break;
    }
    var vl_t_interlocuteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_interlocuteur[i]=fa_cell_get("arbre_des_interlocuteurs",vl_t_tableau[i],"int_cleunik");
    }
    switch (vl_e_no) {
      case "0" : break; //  Aucun traitement
      case "1" :  //  Rendre actifs les acteurs sélectionnés
        vl_c_donnees="vf_c_action=kilometres_activer&";
        vl_c_donnees+="vl_t_interlocuteur="+fa_enc(fa_jsarray2php_00(vl_t_interlocuteur))+"&";
        fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
        break;      
      case "2" :  //  Rendre inactifs les acteurs sélectionnés
        vl_c_donnees="vf_c_action=kilometres_desactiver&";
        vl_c_donnees+="vl_t_interlocuteur="+fa_enc(fa_jsarray2php_00(vl_t_interlocuteur))+"&";
        fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
        break;      
      case "3" :  //  Mettre les acteurs sélectionnés dans un panier
        var vl_t_panier=[];
        vl_t_panier=vf_t_panier;
        vf_t_panier=vl_t_panier.concat(vl_t_interlocuteur);
        fa_remove_attribute("bt_voir_panier","collapsed");
        fa_ds("arbre_des_interlocuteurs_panier","");
        fa_ds("arbre_des_interlocuteurs_panier",vf_c_script_int+'?vl_c_type=0&vl_c_actifs=5&sortie=rdf&vl_t_listecles='+fa_jsarray2php_00(vf_t_panier)+'&');
        //pf_voir_deck(1);
        break;
      case "4" :  //  affecter une civilité à des acteurs
        if (vf_e_cleunik_civilite==null) {return;}
        var vl_b_rep=confirm("$vl_c_bdp_102("+vl_e_nb_sel+")( "+vf_c_civilite+")");
        if(vl_b_rep == false) return;
        vl_c_donnees="vf_c_action=kilometres_civilites&";
        vl_c_donnees+="vl_t_interlocuteur="+fa_enc(fa_jsarray2php_00(vl_t_interlocuteur))+"&";
        vl_c_donnees+="vl_e_civilite="+vf_e_cleunik_civilite+"&";
        fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
        break;
    } 
  }
}
function pf_validation_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
  pf_approximatif();
}
function pf_valide_criteres(vv_quoi) {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_interlocuteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    var vl_t_interl=[];
    var vl_te_choix_cleunik=[];
    var vl_te_critere_cleunik=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_interlocuteurs_panier",vl_t_tableau[i],"act_cleunik");
      vl_t_interl[i]=fa_cell_get("arbre_des_interlocuteurs_panier",vl_t_tableau[i],"int_cleunik");
      vl_te_choix_cleunik[i]=fa_att_get("_graal_ajout_ove_bdc_datas","_graal_choix_cleunik");
      vl_te_critere_cleunik[i]=fa_att_get("_graal_ajout_ove_bdc_datas","_graal_critere_cleunik");
    }
    var vl_c_donnees="genrecritere="+fa_enc(fa_att_get("_graal_ajout_ove_bdc_datas","_graal_critere_qui"))+"&";
    vl_c_donnees+="vl_te_act_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
    vl_c_donnees+="vl_te_int_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_interl))+"&";
    vl_c_donnees+="vl_te_choix_cleunik="+fa_enc(fa_jsarray2php_00(vl_te_choix_cleunik))+"&";
    vl_c_donnees+="vl_te_critere_cleunik="+fa_enc(fa_jsarray2php_00(vl_te_critere_cleunik))+"&";
    switch (vv_quoi) {
    	case "ajout":
    		vl_c_donnees+="vf_c_action=enregistrer_kilometre_bis&";
    		break;
    	case "suppression":
    		vl_c_donnees+="vf_c_action=supprimer_kilometre&";
    		break;
    }
	fa_grise_fenetre("","oui");
    fa_xmlhttprequest_txt(vf_c_script_bdope_fen_criteres,vl_c_donnees,pf_valide_criteres_fin);
  }
}
function pf_valide_criteres_fin(stream) {
  alert(stream);
  //alert("toto")
  fa_vide_arbre("arbre_des_interlocuteurs_panier");
  vf_t_panier=[];
  pf_voir_deck(0);
  pf_alimente_table();
  fa_grise_fenetre("","non");
}

function pf_valide_danspanier() {
  var vl_e_nb=fa_cl("arbre_des_interlocuteurs_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_titrepanier=prompt("Titre du nouveau panier : ");
  if (vl_c_titrepanier==null) {alert("Création du panier abandonnée.");return;}
  var vl_c_liste=""
  for(i=0;i<vl_e_nb;i++) { 
    vl_c_liste+=fa_cell_get("arbre_des_interlocuteurs_panier",i,"int_cleunik")+","
  }
  vl_c_liste=vl_c_liste.substring(0,vl_c_liste.length-1);
  vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vl_c_titrepanier)+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=1&";
  vl_c_donnees+="vl_actif=1&";
  vl_c_donnees+="vl_panier_resultat="+vl_c_liste+"&";
  vl_c_donnees+="vl_c_action=ajouter_panier&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
function pf_valide_danspanier_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
}
function pf_valide_requete() {
  vf_titre_requete=prompt("Donnez un titre à votre requete ...");
  if(vf_titre_requete==null) {alert("Requête abandonnée.");return;}
  fa_xmlhttprequest_txt(vf_c_recup_requete,'',pf_valide_requete_01);
}
function pf_valide_requete_01(stream) {
  var vl_c_requete=stream,vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_blocnote_brut="+fa_enc(fa_value_get("tb_enclair")+" : "+fa_value_get("tb_critere_denomination")+" ("+fa_value_get("tb_choix_valeur_texte_01")+")")+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=2&";
  vl_c_donnees+="vl_panier_requete_selection="+vl_c_requete+"&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vf_titre_requete)+"&";
  vl_c_donnees+="vl_c_action=ajouter&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}

function pf_voir_deck(vv_lequel) {
  fa_gid("deck_acteurs").selectedIndex=vv_lequel;
}
]]></script>
END;
?>
