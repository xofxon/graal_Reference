<?php
$vl_c_00011=fa_recup_session('mess_00011','');
$vl_c_00017=fa_recup_session('mess_00017','');
$vl_c_dico00020=fa_recup_dico_js("dico_00020");
$vl_c_dico00021=fa_recup_dico_js("dico_00021");
$vl_c_dico00022=fa_recup_dico_js("dico_00022");
$vl_c_dico00023=fa_recup_dico_js("dico_00023");
$vl_c_dico00024=fa_recup_dico_js("dico_00024");
$vl_c_dico00025=fa_recup_dico_js("dico_00025");
$vl_tb_droits_02=_graal_requete_droits_fenetre("Fen_00260",$vl_e_uti_cleunik);$vl_e_ajout_02=$vl_tb_droits_02[1];$vl_e_modif_02=$vl_tb_droits_02[2];//Prospects clients
$vl_tb_droits_03=_graal_requete_droits_fenetre("Fen_00262",$vl_e_uti_cleunik);$vl_e_ajout_03=$vl_tb_droits_03[1];$vl_e_modif_03=$vl_tb_droits_03[2];//Clients
$vl_tb_droits_04=_graal_requete_droits_fenetre("Fen_00261",$vl_e_uti_cleunik);$vl_e_ajout_04=$vl_tb_droits_04[1];$vl_e_modif_04=$vl_tb_droits_04[2];//Prospects fournisseurs
$vl_tb_droits_05=_graal_requete_droits_fenetre("Fen_00263",$vl_e_uti_cleunik);$vl_e_ajout_05=$vl_tb_droits_05[1];$vl_e_modif_05=$vl_tb_droits_05[2];//fournisseurs
$vl_tb_droits_06=_graal_requete_droits_fenetre("Fen_00264",$vl_e_uti_cleunik);$vl_e_ajout_06=$vl_tb_droits_06[1];$vl_e_modif_06=$vl_tb_droits_06[2];//Autres acteurs
$vl_tb_droits_07=_graal_requete_droits_fenetre("Fen_00265",$vl_e_uti_cleunik);$vl_e_ajout_07=$vl_tb_droits_07[1];$vl_e_modif_07=$vl_tb_droits_07[2];//Acteurs indéterminés
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_url_arbre='_graal_das_criteres_acteurs.php?';
const vf_c_script_edite='_graal_xml_criteres_00.php';
const vf_c_script_bdope_criteres='_graal_bdope_criteres_00.php';
var vf_e_critere_cleunik;
var vf_e_nombre_utilisations;
function pf_alimente_defaut(){
fa_value_set('rdg_actif',"1");
fa_value_set('rdg_multiple',"2");
fa_value_set('rdg_horsliste',"2");
fa_value_set('rdg_perso',"2");
fa_value_set('rdg_codepertinent',2);
if ($vl_e_ajout_02==0) {fa_grise_oui('ch_n02')}
if ($vl_e_ajout_02==0) {fa_grise_oui('ch_n03')}
if ($vl_e_ajout_04==0) {fa_grise_oui('ch_n04')}
if ($vl_e_ajout_05==0) {fa_grise_oui('ch_n05')}
if ($vl_e_ajout_06==0) {fa_grise_oui('ch_n06')}
if ($vl_e_ajout_07==0) {fa_grise_oui('ch_n07')}
}
function pf_alimente_table_bcb(){
  var vl_c_param=vf_c_url_arbre+'vl_e_portee='+fa_value_get("bcb_ml_qui")+'&raf01='+Math.random()+'&vl_c_etat='+fa_value_get('rdg_etat_critere')+'&vl_c_position='+fa_value_get('rdg_position_critere');
  fa_das("arb_criteres",vl_c_param);
}
function pf_change_menu() {
  var vo_list = fa_gid("bcb_ml_qui");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
}
function pf_etat_fen(vv_quoi){
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_ael('bcb_ml_qui','ValueChange',pf_change_menu);
       pf_change_menu();
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_value_set('rdg_etat_critere',2);
       fa_value_set('rdg_position_critere',2);
       pf_alimente_defaut();
       pf_alimente_table_bcb();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "selectionner":
      var rowIndex = fa_cui("arb_criteres");if((rowIndex == -1) || (vf_e_critere_cleunik==0) ){return;}
     if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_ajouter");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_sortir");
       pf_raz_fiche();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_critere_code");
       break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      if ($vl_e_modif_02==0) {fa_grise_oui('ch_n02')}
      if ($vl_e_modif_02==0) {fa_grise_oui('ch_n03')}
      if ($vl_e_modif_04==0) {fa_grise_oui('ch_n04')}
      if ($vl_e_modif_05==0) {fa_grise_oui('ch_n05')}
      if ($vl_e_modif_06==0) {fa_grise_oui('ch_n06')}
      if ($vl_e_modif_07==0) {fa_grise_oui('ch_n07')}
      if (fa_att_get("ch_n02","_graal_nombre")!=0) {fa_grise_oui('ch_n02');}
      if (fa_att_get("ch_n03","_graal_nombre")!=0) {fa_grise_oui('ch_n03');}
      if (fa_att_get("ch_n04","_graal_nombre")!=0) {fa_grise_oui('ch_n04');}
      if (fa_att_get("ch_n05","_graal_nombre")!=0) {fa_grise_oui('ch_n05');}
      if (fa_att_get("ch_n06","_graal_nombre")!=0) {fa_grise_oui('ch_n06');}
      if (fa_att_get("ch_n07","_graal_nombre")!=0) {fa_grise_oui('ch_n07');}
      fa_focusdonne("tb_critere_denomination");
      break;
    case "sortir":
     window.close();
     break;   
}
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!='-1') {pf_alimente_table_bcb();} else {fa_erreur(vl_datas);}
  if (window.opener!=null) { window.opener.pf_affiche_criteres_potentiel_acteur();}
  pf_etat_fen('annuler');
}
function pf_raz_fiche(){
fa_value_set('tb_critere_code',"");
fa_value_set('tb_critere_denomination',"");
fa_gid("bcc_ml_type").selectedIndex=0;
fa_value_set('rdg_actif',1);
fa_value_set('tb_blocnotebrut',"");
fa_value_set('rdg_multiple',2);
fa_value_set('rdg_horsliste',2);
fa_value_set('rdg_perso',2);
fa_value_set('rdg_codepertinent',2);
fa_value_set('la_dateheurecreation',"");
fa_value_set('la_dateheuremodif',"");
fa_uncheck('ch_n02')
fa_uncheck('ch_n03')
fa_uncheck('ch_n04')
fa_uncheck('ch_n05')
fa_uncheck('ch_n06')
fa_uncheck('ch_n07')
fa_att_set('ch_n02',"_graal_nombre",0);
fa_att_set('ch_n03',"_graal_nombre",0);
fa_att_set('ch_n04',"_graal_nombre",0);
fa_att_set('ch_n05',"_graal_nombre",0);
fa_att_set('ch_n06',"_graal_nombre",0);
fa_att_set('ch_n07',"_graal_nombre",0);
/*
fa_grise_non('ch_n02');
fa_grise_non('ch_n03');
fa_grise_non('ch_n04');
fa_grise_non('ch_n05');
fa_grise_non('ch_n06');
fa_grise_non('ch_n07');
*/
fa_label('ch_n02',"$vl_c_dico00020");
fa_label('ch_n03',"$vl_c_dico00021");
fa_label('ch_n04',"$vl_c_dico00022");
fa_label('ch_n05',"$vl_c_dico00023");
fa_label('ch_n06',"$vl_c_dico00024");
fa_label('ch_n07',"$vl_c_dico00025");
vf_e_critere_cleunik=0;
}
function pf_sel_ligne(vv_objet) {
  if (fa_est_grise("bt_detailler")==true) {return};
  var arbre = fa_gid(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_critere_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("critere_cleunik"));
  s ="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
  s+="vl_c_portee=acteurs&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,bcc_pf_affiche_datas);
}
function pf_validation(vv_quoi) {
  var s;
  var vl_c_portee;
  vl_c_portee=8192;
  if (fa_est_coche("ch_n02")==true) {vl_c_portee+=  2};
  if (fa_est_coche("ch_n03")==true) {vl_c_portee+=  4};
  if (fa_est_coche("ch_n04")==true) {vl_c_portee+=  8};
  if (fa_est_coche("ch_n05")==true) {vl_c_portee+= 16};
  if (fa_est_coche("ch_n06")==true) {vl_c_portee+= 32};
  if (fa_est_coche("ch_n07")==true) {vl_c_portee+= 64};
  if (vl_c_portee==8192) {alert("$vl_c_00011");return;}
  switch(vv_quoi) {
    case "enregistrer":
       s ="vl_c_action="+fa_enc(vf_c_action)+"&";
       s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
       s +="vl_critere_code="+fa_enc(fa_value_get('tb_critere_code'))+"&";
       s +="vl_critere_denomination="+fa_enc(fa_value_get('tb_critere_denomination'))+"&"
       s +="vl_critere_type="+fa_enc(fa_gid("bcc_ml_type").selectedItem.value)+"&"
       s +="vl_critere_choixmultiples="+fa_enc(fa_value_get('rdg_multiple'))+"&"
       s +="vl_critere_blocnotebrut="+fa_enc(fa_value_get('tb_blocnotebrut'))+"&"
       s +="vl_critere_actif="+fa_enc(fa_value_get('rdg_actif'))+"&"
       s +="vl_critere_portee="+fa_enc(vl_c_portee)+"&"
       s +="vl_critere_hl="+fa_enc(fa_value_get('rdg_horsliste'))+"&"
       s +="vl_critere_perso="+fa_enc(fa_value_get('rdg_perso'))+"&"
       s +="vl_critere_codechoixpertinent="+fa_enc(fa_value_get('rdg_codepertinent'))+"&"
    break;
   case "supprimer":
     Check = confirm("$vl_c_00017");
     if(Check == false) return;
     s ="vl_c_action=supprimer&";
     s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
    break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
