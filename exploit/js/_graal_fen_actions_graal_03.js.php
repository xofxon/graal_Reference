<?php
include("_graal_var_portee.php");
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table;
const vf_c_script_act='_graal_rech_acteurs_01.php?';
const vf_c_script_bdope_graal="_graal_bdope_graal_01.php";
const vf_c_script_graal='_graal_das_actions_graal_01.php?';
function pf_aa_init() {
  pf_affiche_arbre_graal();
  fa_att_set("rd_principal_non","selected", 'true');
  fa_value_set("rdg_principal",1);
END;
if ($vl_c_genreacteur!='110000') {
echo <<<END
  fa_ael('bao_ml_qui','ValueChange',po_change_menu);
  po_change_menu();
  pf_approximatif();
END;
}
echo <<<END
}
function pf_affiche_arbre_graal() {
  var vl_c_param=vf_c_script_graal+"vl_action_cleunik=$vl_e_action_cleunik&raf_random="+Math.random()+"&";
  fa_das("arbre_graal",vl_c_param);
}
function pf_alimente_table() {
  switch (fa_value_get("bao_ml_qui")) {
    case "000000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006":
      fa_cache_oui("portee");
      break;
    case "999999": case "888888":
      fa_cache_non("portee");
      break;
  }
  fa_das("arbre_des_acteurs",vf_c_url_alimente_table);
}
function pf_approximatif() {
  var raf_random=Math.random();
  if ( fa_value_get("aai_tb_rechapproxima") == "" ) {return;}
  vf_c_url_alimente_table =  vf_c_script_act+'sortie=das&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+raf_random+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+fa_mlget('bao_ml_actif')+"&";
  pf_alimente_table();
}
function pf_etat_fen(vv_quoi){
  switch (vv_quoi) {
    case 'sortir' :
      close();
      break;
  }
}
function pf_fin_requete(vv_stream) {
  var vl_c_data=vv_stream;
  if (vl_c_data!='ok') {alert(vl_c_data);}
  window.opener.pf_affiche_arbre_graal();
  pf_affiche_arbre_graal();
}
function pf_sel_ligne(vv_qui) {
  var i=fa_cui("$vl_c_id_arbre_inc_acteurs_01");if(i==-1){return;}
  fa_value_set("tb_interlo",fa_cell_get("$vl_c_id_arbre_inc_acteurs_01",i,"nomcom"));
  fa_att_set("tb_interlo","int_cleunik","0");
  fa_att_set("tb_interlo","act_cleunik",fa_cell_get("$vl_c_id_arbre_inc_acteurs_01",i,"act_cleunik"));
}
function pf_sel_arbre_adresses(){}
function pf_validation(vv_quoi) {
  var vl_c_donnees="";
  vl_c_donnees+="vl_portee=$vl_e_acteur&";
  vl_c_donnees+="vl_action_cleunik=$vl_e_action_cleunik&";
  vl_c_donnees+="vl_act_cleunik="+fa_gid("tb_interlo").getAttribute("act_cleunik")+"&";
  vl_c_donnees+="vl_int_cleunik="+fa_gid("tb_interlo").getAttribute("int_cleunik")+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_graal"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_principal="+fa_enc(fa_value_get('rdg_principal'))+"&";
  switch(vv_quoi) {
    case "ajouter":
      vl_c_donnees+="vf_c_action=ajouter&";vf_c_action="ajout";
      break;
    case "modifier":
      vl_c_donnees+="vf_c_action=modifier&";vf_c_action="modification";
      break;
    case "supprimer":
        if(confirm("Confirmez-vous la suppression de cette relation ?")== false) return;
        vl_c_donnees+="vf_c_action=supprimer&";
        vf_c_action="suppression";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_graal,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
