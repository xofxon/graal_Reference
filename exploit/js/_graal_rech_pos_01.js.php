<?php
if ($vl_e_act_cleunik==-1){
	$vf_c_script_adrpost_act="const vf_c_script_adrpost_act='_graal_das_acteurs_adresses_01.php?sortie=das&';";
	$vf_c_genre="vf_c_genre=B";
} else {
	$vf_c_script_adrpost_act="const vf_c_script_adrpost_act='_graal_das_acteurs_adresses_01.php?sortie=das&vl_e_act_cleunik=$vl_e_act_cleunik';";
	$vf_c_genre="vf_c_genre=A";
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table;
$vf_c_script_adrpost_act
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const vf_c_fen_adr="_graal_fen_act_adresses_01.php?genreacteur=";
const lstn_grise = { 
	willRebuild : function(event){fa_grise_oui("aai_tb_rechapproxima");fa_grise_fenetre(event,"oui");},
	didRebuild  : function(event){fa_grise_non("aai_tb_rechapproxima");fa_grise_fenetre(event,"non");} 
};
//  Affectations
function pf_adresse_ouvre() {
  var rowIndex = fa_cui("adressespostales_des_acteurs");if(rowIndex == -1){return;}
  var param=fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_typeacteur")+"&vl_e_act_cleunik="+fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_act_cleunik")+"&vl_e_adr_cleunik="+fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_cleunik")+"&";
  fa_ouvre(vf_c_fen_adr+param,600,350);
}
function pf_acteur_ouvre() {
  var rowIndex = fa_cui("adressespostales_des_acteurs");if(rowIndex == -1){return;}
  var param=fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_typeacteur")+"&act_cleunik="+fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_act_cleunik")+"&";
  fa_ouvre(vf_c_script_fen_acteur+param,1000,800);
}
function pf_alimente_table() {
  switch (fa_value_get("aao_ml_qui")){
    case "9":
      fa_cache_non("portee");
      break;
    default:
      fa_cache_oui("portee");
      break;
  }
  fa_das("adressespostales_des_acteurs",vf_c_url_alimente_table);
	//fa_ouvre(vf_c_url_alimente_table)
}
function pf_approximatif(){
    var vl_e_typeacteur=0;
    var vl_c_texte=fa_value_get("aai_tb_rechapproxima");
		fa_grise_oui("aai_tb_rechapproxima");
		fa_grise_fenetre("","oui"); 
    item=fa_gid("bao_ml_actif").selectedItem;  
    vf_c_url_alimente_table =vf_c_script_adrpost_act+'vl_c_difzero=N&$vf_c_genre&listecles=&vl_c_recherche='+fa_enc(vl_c_texte)+'&vl_e_typeacteur='+fa_value_get("bao_ml_qui")+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&limit="+fa_value_get("bao_tb_limit")+"&";
    pf_alimente_table();
}
function pf_etat_fen(vv_quoi){
   var vl_portee;
   switch(vv_quoi) {
     case "ini":
       fa_att_rem("adressespostales_des_acteurs","onselect");
			 fa_badl("adressespostales_des_acteurs",lstn_grise);
       fa_ael("bao_ml_qui","ValueChange",po_change_menu);
       po_change_menu();
       fa_att_rem("adr_raison_soc","hidden");
       pf_approximatif()
       break;
     case "sortir":
       window.close();  //  Ne fonctionne que si c'est une nouvelle fenÃªtre
     break;
     case "renvoyer":
			var rowIndex = fa_cui("adressespostales_des_acteurs");if(rowIndex == -1){return;}
  			var complementnom=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"complementnom"));
  			var adr_ligne1=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_ligne1"));
  			var adr_ligne2=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_ligne2"));
  			var adr_ligne3=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_ligne3"));
  			var adr_cp=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_cp"));
  			var adr_ville=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_ville"));
  			var adr_choix_cleunik=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_choix_cleunik"));
  			var adr_latitude=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_latitude"));
  			var adr_longitude=btoa(fa_cell_get("adressespostales_des_acteurs",rowIndex,"adr_longitude"));
  			if (window.opener!=null) {
      		try {
         		window.opener.$vl_c_fonction_retour(complementnom,adr_ligne1,adr_ligne2,adr_ligne3,adr_cp,adr_ville,adr_choix_cleunik,adr_latitude,adr_longitude);
        		 window.close();
		      } catch(e) {
		         alert(e)
		      }
		    }
			break; 
	}
 }
function pf_onunload(){
	fa_brl("adressespostales_des_acteurs",lstn_grise);	
}
]]></script>
END;
?>
