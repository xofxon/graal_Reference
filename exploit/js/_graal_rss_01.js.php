<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
****************************************************************************************
**********  Fenêtre de gestion des flux RSS gérés par graal  ********
****************************************************************************************
*/
var vf_c_arbre;
var vf_e_doc_cleunik=0;
var vf_e_droits_proprio=0;
var vf_c_action;
var vf_c_script_edite="_graal_xml_rss_01.php";
var vf_c_script_bdope_doc='_graal_bdope_rss_01.php';
var vf_c_url_alimente_table="_graal_das_doc_01.php?quelsdocs=$vl_c_quelsdocs&vs_typedoc=7";
function pf_action(vv_quoi){
	switch (vv_quoi){
	  case 'atteindre' :
	    fa_ouvre(fa_value_get('tb_emplacement'),0,0);
	    return;
	    break;
	  case 'droits' :
	    if (vf_e_doc_cleunik!=0)    {
	      fa_ouvre("_graal_fen_droits_01.php?vl_c_genredoc=Flrss&vl_e_doc_cleunik="+vf_e_doc_cleunik,400,400);
	    } else {
		    alert('Vous ne pouvez pas gérer les droits de cette manière !!');
	    }
	    break;
	}
}
function pf_affiche_datas(stream){
	var vl_c_datas=stream;
	pf_raz_fiche()
	vf_e_doc_cleunik=fa_xml_get(vl_c_datas,'doc_cleunik')
	fa_value_set('tb_emplacement_prive',fa_xml_get(vl_c_datas,'emplacement_prive'));
	fa_value_set('tb_emplacement_publi',fa_xml_get(vl_c_datas,'emplacement_publi'));	
	fa_value_set('tb_titre',fa_xml_get(vl_c_datas,'titre'));
	fa_value_set('tb_descriptif_sommaire',fa_xml_get(vl_c_datas,'descriptif_sommaire'));
	fa_value_set("la_dateheurecreation",fa_xml_get(vl_c_datas,'dateheurecreation'));
	fa_value_set("la_dateheuremodif",fa_xml_get(vl_c_datas,'dateheuremodif'));
	fa_value_set("tb_nb_affichages",fa_xml_get(vl_c_datas,'nb_affiche'));
	fa_value_set("ml_genre",fa_xml_get(vl_c_datas,'genre'));
	fa_value_set("ml_type",fa_xml_get(vl_c_datas,'typeacces'));
	fa_value_set("ml_niveau",fa_xml_get(vl_c_datas,'niveauacces'));
	fa_mlsel("ml_utilisateur",fa_xml_get(vl_c_datas,'uti_cleunik'));
}
function pf_alimente_defaut(){
	fa_value_set("tb_nb_affichages",10);
	fa_value_set("ml_genre",1);
	fa_value_set("ml_type",1);
	fa_value_set("ml_niveau",2);
}
function pf_alimente_table(){
  var raf_random=Math.random();
  fa_das("arbre_des_docs", vf_c_url_alimente_table+"&raf01="+raf_random);
}
function pf_etat_fen(vv_quoi) {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_c_arbre = fa_gid("arbre_des_docs");
       fa_grise_non("bt_ajouter");
       fa_grise_non("bt_annuler");
       fa_grise_non("bt_detailler");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_non("bt_sortir");
       fa_grise_oui("bt_supprimer");
       fa_grise_groupe_oui('broadcaster_01');
       pf_alimente_table();
       break;
     case "selectionner":
      pf_verif_acces();
      break;
    case "selectionner_suite":
      vf_c_action="selectionner"
      fa_grise_groupe_oui('broadcaster_01');
      if ((vf_e_droits_proprio & 4) == 4) {fa_grise_non("bt_modifier");}
      if ((vf_e_droits_proprio & 8) == 8) {fa_grise_non("bt_supprimer");}
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      break;
     case "modifier":
       fa_grise_non("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_focusdonne('tb_titre');
       fa_grise_groupe_non('broadcaster_01');
       break;
     case "ajouter":
       fa_grise_oui("bt_ajouter");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_sortir");
       fa_grise_oui("bt_supprimer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_titre");
       break;
     case "annuler":
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_detailler");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_modifier");
       fa_grise_non("bt_sortir");
       fa_grise_oui("bt_supprimer");
       pf_raz_fiche();
       fa_focusdonne('arbre_des_docs');
       break;
     case "sortir":
     window.history.back(); //  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre

     break;   
 default:
 break;
}
  }
function pf_fin_requete(stream){
	var vl_datas = stream;
	if (vl_datas=='ok') {
	  pf_alimente_table();
	} else {
		fa_erreur(vl_datas)
	}
	pf_etat_fen('annuler');
}
function pf_raz_fiche(){
	vf_e_doc_cleunik=0;
	vf_e_droits_proprio=0;
	fa_value_set('tb_emplacement_prive',"");
	fa_value_set('tb_emplacement_publi',"");	
	fa_value_set('tb_titre',"");
	fa_value_set('tb_descriptif_sommaire',"");
	fa_value_set("la_dateheurecreation","");
	fa_value_set("la_dateheuremodif","");
}  
function pf_sel_ligne(vv_objet) {
  if (fa_est_grise("bt_detailler")==true) {return};
  var arbre = fa_gid(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_doc_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("doc_cleunik"));
  s ="vl_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi){
var s;
switch(vv_quoi){
  case "enregistrer":
     if (vf_e_doc_cleunik==0) {
       if (fa_value_get("tb_titre")==''){
         alert('Votre saisie n\'a pas de sens!');
         fa_focusdonne("tb_titre");
         return;
       }
      vf_c_action="ajouter";
    } else {
      vf_c_action="modifier";
    }
    break;
  case "supprimer":
    Check = confirm("Confirmez-vous la suppression de ce flux ?");
    if(Check == false) return;
    vf_c_action="supprimer";
    break;
}     
 s="";
 s +="vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
 s +="vf_c_titre="+fa_enc(fa_value_get("tb_titre"))+"&";
 s +="vf_c_descriptif_sommaire="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
	s +="vf_c_nb_affichages="+fa_enc(fa_value_get("tb_nb_affichages"))+"&";
	s +="vf_c_genre="+fa_enc(fa_value_get("ml_genre"))+"&";
	s +="vf_c_type="+fa_enc(fa_value_get("ml_type"))+"&";
	s +="vf_c_niveau="+fa_enc(fa_value_get("ml_niveau"))+"&";
	s +="vf_c_uti_cleunik="+fa_enc(fa_mlget("ml_utilisateur"))+"&";
 s +="vf_c_action="+fa_enc(vf_c_action)+"&";
fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_fin_requete);
}
function pf_verif_acces(){
	if (vf_e_doc_cleunik==0){return;}
  var s ="vf_c_action=verifier_droits_acces&vf_e_doc_cleunik="+vf_e_doc_cleunik+"&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_verif_acces_fin);
}
function pf_verif_acces_fin(stream) {
  var vl_c_datas=stream;
  vf_e_droits_proprio=vl_c_datas;
  pf_etat_fen("selectionner_suite");
}
]]></script>
END;
?>
