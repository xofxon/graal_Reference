<?php
include("_graal_var_portee.php");
$vl_e_portee=$vl_e_gedged;
$vl_mess_00003=fa_recup_session('mess_00003','');
$vl_mess_00004=fa_recup_session('mess_00004','');
$vl_mess_00005=fa_recup_session('mess_00005','');
$vl_mess_00006=fa_recup_session('mess_00006','');
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table,vf_c_recup_requete,vf_titre_requete,vf_valeur="";
var vf_c_renvoyer=false;
const vf_c_script_act="_graal_rech_ged_01.php?selection=$vl_c_selection&";
const c_script_favoris_partage='_graal_fen_favoris_partage_01.php?vf_c_type_favori=3&';
const vf_c_script_bdope_panier='_graal_bdope_paniers_01.php';
const lstn_grise = {
	willRebuild : function(event){}, 
	didRebuild  : function(event){fa_grise_fenetre(event,"non");} 
};
function pf_aa_ferme() {
  if (vf_c_renvoyer==true) {
    var vl_t_tableau=[];
    var vl_e_nb_sel;
    vl_t_tableau=fa_lignes_selectionnees("arbre_des_ged");
    vl_e_nb_sel=vl_t_tableau.length;
    if (vl_e_nb_sel!=0) {
      var vl_t_doc_cleunik=[];
      var vl_t_doc_nom=[];
      for(i=0;i<vl_e_nb_sel;i++) {
        vl_t_doc_cleunik[i]=fa_cell_get("arbre_des_ged",vl_t_tableau[i],"doc_cleunik");
        vl_t_doc_nom[i]=fa_cell_get("arbre_des_ged",vl_t_tableau[i],"emplacement");
      }
      switch ("$vl_c_quelsdocs") { 
        case "notes" :
          window.opener.pf_retour_fenetre_notes(vl_t_doc_cleunik);
          break;
        case "docs" :
          window.opener.pf_retour_fenetre_docs(vl_t_doc_cleunik,vl_t_doc_nom);
          break;
				case "pseudodocs" :
          window.opener.pf_retour_fenetre_pseudodocs(vl_t_doc_cleunik);
          break;
      }  
    }
  }
}
function pf_aa_init() {
  switch ("$vl_c_retour") {
    case "oui":
      switch ("$vl_c_quelsdocs") {
        case "docs" :fa_att_set("arbre_des_ged","seltype","multiple");
				case "notes" :fa_att_set("arbre_des_ged","seltype","multiple");
        break;
      }
  }
  fa_value_set("bem_tb_deb",c_date_defaut_deb);fa_att_set("bem_tb_deb","label",c_date_defaut_deb);
  fa_value_set("bem_tb_fin",c_date_defaut_fin);fa_att_set("bem_tb_deb","label",c_date_defaut_fin);
  vf_valeur=fa_mlget("bek_ml_qui","value");
	fa_badl("arbre_des_ged",lstn_grise);
  pf_approximatif();
	switch ($vl_c_type) {
    case 1:
		  fa_ael("bek_ml_qui","ValueChange",po_change_menu);
		  fa_ael("bek_tb_limit","input",pf_approximatif);
		  po_change_menu();
      break;
    case 2:
    case 3:
      break;
  }
  pf_alimente_table();	
}	
function pf_affiche_donnees_ged() {
  pf_approximatif();
}
function pf_alimente_table() {
  fa_das("arbre_des_ged",vf_c_url_alimente_table);
}
function pf_approximatif() {
switch ($vl_c_type) {
    case 1:
		  if ( fa_value_get("bek_tb_rechapproxima") == "" ) {return;}
			fa_grise_fenetre("","oui");
		  var item=fa_gid("bek_ml_actif").selectedItem; 
		  vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc(fa_value_get("bek_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bek_ml_zone")+'&vl_c_type='+fa_value_get("bek_ml_type")+'&vl_c_qui='+vf_valeur+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bek_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&vl_e_limit="+fa_value_get("bek_tb_limit")+"&";
		  vf_c_url_alimente_table+='vl_c_quelleplage=debut&vl_c_dateheuredebut='+fa_enc(fa_date_formate(fa_value_get("bem_tb_deb"),"AAAAMMJJ"))+'&vl_c_dateheurefin='+fa_enc(fa_date_formate(fa_value_get("bem_tb_fin"),"AAAAMMJJ"));
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=vf_c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      vf_c_recup_requete=vf_c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      break;
  }
  pf_alimente_table();	
}
function pf_assigne(vv_valeur,vv_label,vv_class) {
  vf_valeur=vv_valeur;
  fa_att_set("bek_ml_qui","label",vv_label);
}
function pf_favoris_partager() {
  var vl_c_param;
  var rowIndex = fa_cui("arbre_des_ged");if(rowIndex == -1){return;}
  vl_c_param="vf_e_cleunik="+fa_cell_get("arbre_des_ged",rowIndex,"doc_cleunik")+"&";
  vl_c_param+="raf_random="+Math.random()+"&";
  fa_ouvre(c_script_favoris_partage+vl_c_param,500,60);
}
function pf_sel_arbre_ged(){}
function pf_valide_danspanier_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
}
function pf_valide_requete() {
  vf_titre_requete=prompt("Donnez un titre à votre requête ...");
  if(vf_titre_requete==null) {alert("Requête abandonnée.");return;}
  fa_xmlhttprequest_txt(vf_c_recup_requete,'',pf_valide_requete_01);
}
function pf_valide_requete_01(stream) {
  var vl_c_requete=stream,vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_blocnote_brut="+fa_enc(fa_value_get("tb_enclair")+" : "+fa_value_get("tb_critere_denomination")+" ("+fa_value_get("tb_choix_valeur_texte_01")+")")+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=2&";
  vl_c_donnees+="vl_panier_requete_selection="+vl_c_requete+"&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vf_titre_requete)+"&";
  vl_c_donnees+="vl_c_action=ajouter&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
]]></script>
END;
?>
