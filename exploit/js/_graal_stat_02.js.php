<?php
switch ($vl_genre) {
  case "toutes_commerciales":
  case "offcli":
  case "demfou":
  case "cdecli":
  case "cdefou":
  case "livcli":
  case "recfou":
  case "faccli_avocli":
  case "faccli":
  case "avocli":
  case "facfou":
$js_init=<<<EOT
fa_badl('arbre_des_stats_cial',lstn_grise);
EOT;
$js_unload=<<<EOT
function pf_onunload(){
	fa_brl("arbre_des_stats_cial",lstn_grise);
}
EOT;
$vf_c_url_alimente_table='var vf_c_url_alimente_table="_graal_das_stat_05.php?vl_e_art_cleunik=-1&";';  
$vl_c_calcul=<<<EOT
	var vl_c_datedeb=fa_value_get("stat_tb_deb");
	var vl_c_datefin=fa_value_get("stat_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
      vl_c_param=vf_c_url_alimente_table+"raf_random="+Math.random()+"&";
      vl_c_param+="nombre="+fa_value_get("tb_nombre_sel")+"&";
      vl_c_param+="ml_art_01="+fa_value_get("ml_art_01")+"&";
      vl_c_param+="ml_art_02="+fa_value_get("ml_art_02")+"&";
      vl_c_param+="ml_art_03="+fa_value_get("ml_art_03")+"&";
      vl_c_param+="ml_art_04="+fa_value_get("ml_art_04")+"&";
      vl_c_param+="date_deb="+fa_enc(vl_c_datedeb)+"&";
      vl_c_param+="date_fin="+fa_enc(vl_c_datefin)+"&";
      fa_grise_fenetre("","oui");
      fa_das("arbre_des_stats_cial",vl_c_param);
EOT;
$vl_c_dessin=<<<EOT
      var wTree = fa_gid("arbre_des_stats_cial");
			var nb=fa_cl("arbre_des_stats_cial");
      for(var i=0;i<nb;i++){
        vl_donnes+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_brut"] ))))+';';
        vl_affichage+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_formatte"] ))))+';';
        vl_noms+=wTree.view.getCellText( i ,wTree.columns["periode"] )+';';
       }
EOT;
    break;
  case "article_un":
$js_init=<<<EOT
fa_badl('arbre_des_stats_cial_art',lstn_grise);
fa_value_set("stat_tb_deb","$vl_c_dateheuredebut");
fa_value_set("stat_tb_fin","$vl_c_dateheurefin");
EOT;
$js_unload=<<<EOT
function pf_onunload(){
	fa_brl("arbre_des_stats_cial_art",lstn_grise);
}
EOT;
$vf_c_url_alimente_table='var vf_c_url_alimente_table="_graal_das_stat_03.php?vl_e_art_cleunik='.$vl_art_cleunik.'&";';  
$vl_c_calcul=<<<EOT
	var vl_c_datedeb=fa_value_get("stat_tb_deb");
	var vl_c_datefin=fa_value_get("stat_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
      vl_c_param=vf_c_url_alimente_table+"raf_random="+Math.random()+"&";
      vl_c_param+="nombre="+fa_value_get("tb_nombre_sel")+"&";
      vl_c_param+="ml_art_01="+fa_value_get("ml_art_01")+"&";
      vl_c_param+="ml_art_02="+fa_value_get("ml_art_02")+"&";
      vl_c_param+="ml_art_03="+fa_value_get("ml_art_03")+"&";
      vl_c_param+="ml_art_04="+fa_value_get("ml_art_04")+"&";
      vl_c_param+="date_deb="+fa_enc(vl_c_datedeb)+"&";
      vl_c_param+="date_fin="+fa_enc(vl_c_datefin)+"&";
      fa_grise_fenetre("","oui");
      fa_das("arbre_des_stats_cial_art",vl_c_param);
EOT;
$vl_c_dessin=<<<EOT
      var wTree = fa_gid("arbre_des_stats_cial_art");
			var nb=fa_cl("arbre_des_stats_cial_art");
      for(var i=0;i<nb;i++){
        vl_donnes+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_brut"] ))))+';';
        vl_affichage+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_formatte"] ))))+';';
        vl_noms+=wTree.view.getCellText( i ,wTree.columns["periode"] )+';';
       }
EOT;
    break;
  case "article_tous":
$js_init=<<<EOT
fa_badl('arbre_des_stats_cial_art_tous',lstn_grise);
EOT;
$js_unload=<<<EOT
function pf_onunload(){
	fa_brl("arbre_des_stats_cial_art_tous",lstn_grise);
}
EOT;
$vf_c_url_alimente_table='var vf_c_url_alimente_table="_graal_das_stat_06.php?";var vf_c_requete="";var vf_c_url_recup_requete="_graal_das_stat_06.php?genre='.$vl_genre.'&";';
$vl_c_calcul=<<<EOT
	var vl_c_datedeb=fa_value_get("stat_tb_deb");
	var vl_c_datefin=fa_value_get("stat_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
      vl_c_param=vf_c_url_alimente_table+"raf_random="+Math.random()+"&";
      //vl_c_param+="nombre="+fa_value_get("tb_nombre_sel")+"&";
      //vl_c_param+="ml_art_01="+fa_value_get("ml_art_01")+"&";
      vl_c_param+="ml_art_01=1&";
      vl_c_param+="ml_art_02="+fa_value_get("ml_art_02")+"&";
      vl_c_param+="ml_art_03="+fa_value_get("ml_art_03")+"&";
      vl_c_param+="ml_art_04="+fa_value_get("ml_art_04")+"&";
      vl_c_param+="date_deb="+fa_enc(vl_c_datedeb)+"&";
      vl_c_param+="date_fin="+fa_enc(vl_c_datefin)+"&";
      vl_c_param+="ml_panier_acteurs_01="+fa_mlget("ml_panier_acteurs_01")+"&";
      vl_c_param+="ml_panier_articles_01="+fa_mlget("ml_panier_articles_01")+"&";
      vf_c_requete=vf_c_url_recup_requete+vl_c_param;
      fa_grise_fenetre("","oui");
      fa_das("arbre_des_stats_cial_art_tous",vl_c_param);
EOT;
$vl_c_dessin=<<<EOT
      var wTree = fa_gid("arbre_des_stats_cial_art_tous");
			var nb=fa_cl("arbre_des_stats_cial_art_tous");
      for(var i=0;i<nb;i++){
        vl_donnes+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_nombre_brut"] ))))+';';
        vl_affichage+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_nombre_formatte"] ))))+';';
        vl_noms+=wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_designation"] )+';';
       }
EOT;
$vl_c_recup_requete=<<<EOT
function pf_recup_requete(vv_export) {
	switch (vv_export) {
	    case "ods":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
	    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
	    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
	    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
	    case "xls":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
	    case "accorest":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
    }
  //fa_xmlhttprequest_txt(vf_c_requete,'sortie='+vv_export,pf_recup_requete_fin);
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
  	alert(stream)
/*
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
*/
}
EOT;
    break;
  case "client_tous":
  case "procli_tous":
  case "fourni_tous":
  case "profou_tous":
  case "accorest":
$js_init=<<<EOT
fa_badl('arbre_des_stats_cial_art_tous',lstn_grise);
EOT;
$js_unload=<<<EOT
function pf_onunload(){
	fa_brl("arbre_des_stats_cial_art_tous",lstn_grise);
}
EOT;
$vf_c_url_alimente_table='var vf_c_url_alimente_table="_graal_das_stat_06.php?";var vf_c_requete="";var vf_c_url_recup_requete="_graal_das_stat_06.php?genre='.$vl_genre.'&";';
$vl_c_calcul=<<<EOT
	var vl_c_datedeb=fa_value_get("stat_tb_deb");
	var vl_c_datefin=fa_value_get("stat_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
      vl_c_param=vf_c_url_alimente_table+"raf_random="+Math.random()+"&";
      //vl_c_param+="nombre="+fa_value_get("tb_nombre_sel")+"&";
      //vl_c_param+="ml_art_01="+fa_value_get("ml_art_01")+"&";
      vl_c_param+="ml_art_01=2&";
      vl_c_param+="ml_art_02="+fa_value_get("ml_art_02")+"&";
      vl_c_param+="ml_art_03="+fa_value_get("ml_art_03")+"&";
      vl_c_param+="ml_art_04="+fa_value_get("ml_art_04")+"&";
      vl_c_param+="date_deb="+fa_enc(vl_c_datedeb)+"&";
      vl_c_param+="date_fin="+fa_enc(vl_c_datefin)+"&";
      vl_c_param+="ml_panier_acteurs_01="+fa_mlget("ml_panier_acteurs_01")+"&";
      vl_c_param+="ml_panier_articles_01="+fa_mlget("ml_panier_articles_01")+"&";
      vf_c_requete=vf_c_url_recup_requete+vl_c_param;
      fa_grise_fenetre("","oui");
      fa_das("arbre_des_stats_cial_art_tous",vl_c_param);
EOT;
$vl_c_dessin=<<<EOT
      var wTree = fa_gid("arbre_des_stats_cial_art_tous");
      var nb=fa_cl("arbre_des_stats_cial_art_tous");
      for(var i=0;i<nb;i++){
        vl_donnes+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_nombre_brut"] ))))+';';
        vl_affichage+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_nombre_formatte"] ))))+';';
        vl_noms+=wTree.view.getCellText( i ,wTree.columns["arbre_des_stats_cial_art_tous_designation"] )+';';
       }
EOT;
$vl_c_recup_requete=<<<EOT
function pf_recup_requete(vv_export) {
	switch (vv_export) {
	    case "ods":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
	    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
	    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
	    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
	    case "xls":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
	    case "accorest":fa_ouvre(vf_c_requete+'sortie='+vv_export,0,0);break;
    }
  //fa_xmlhttprequest_txt(vf_c_requete,'sortie='+vv_export,pf_recup_requete_fin);
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
  	alert(stream)
/*
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
*/
}
EOT;

    break;
  case "client_un":
  case "procli_un":
  case "fourni_un":
  case "profou_un":
$js_init=<<<EOT
fa_badl('arbre_des_stats_cial_act_un',lstn_grise);
EOT;
$js_unload=<<<EOT
function pf_onunload(){
	fa_brl("arbre_des_stats_cial_act_un",lstn_grise);
}
EOT;
$vf_c_url_alimente_table='var vf_c_url_alimente_table="_graal_das_stat_05.php?vl_e_act_cleunik='.$vl_act_cleunik.'&"';
$vl_c_calcul=<<<EOT
	var vl_c_datedeb=fa_value_get("stat_tb_deb");
	var vl_c_datefin=fa_value_get("stat_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
      vl_c_param=vf_c_url_alimente_table+"raf_random="+Math.random()+"&";
      vl_c_param+="nombre="+fa_value_get("tb_nombre_sel")+"&";
      vl_c_param+="ml_art_01="+fa_value_get("ml_art_01")+"&";
      vl_c_param+="ml_art_02="+fa_value_get("ml_art_02")+"&";
      vl_c_param+="ml_art_03="+fa_value_get("ml_art_03")+"&";
      vl_c_param+="ml_art_04="+fa_value_get("ml_art_04")+"&";
      vl_c_param+="date_deb="+fa_enc(vl_c_datedeb)+"&";
      vl_c_param+="date_fin="+fa_enc(vl_c_datefin)+"&";
      fa_grise_fenetre("","oui");
			fa_das("arbre_des_stats_cial_act_un",vl_c_param);
EOT;
$vl_c_dessin=<<<EOT
      var wTree = fa_gid("arbre_des_stats_cial_act_un");
      var nb=fa_cl("arbre_des_stats_cial_act_un");
      for(var i=0;i<nb;i++){
        vl_donnes+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_brut"] )))/1000)+';';
        vl_affichage+=parseFloat(fa_dec(fa_se(wTree.view.getCellText( i ,wTree.columns["nombre_formatte"] ))))+';';
        vl_noms+=wTree.view.getCellText( i ,wTree.columns["periode"] )+';';
       }
EOT;
    break;
}  
switch ($vl_genre) {
  case "toutes_commerciales":
  case "offcli":
  case "demfou":
  case "cdecli":
  case "cdefou":
  case "livcli":
  case "recfou":
  case "faccli_avocli":
  case "faccli":
  case "avocli":
  case "facfou":
  
  case "article_tous":
  case "client_tous":
  case "procli_tous":
  case "fourni_tous":
  case "profou_tous":
  case "client_un":
  case "procli_un":
  case "fourni_un":
  case "profou_un":
  	case "accorest":
$vl_c_init=<<<EOT
	$js_init
  fa_check("-me_tb_deb_21");
  fa_value_set("stat_tb_deb",c_date_defaut_deb);
  fa_value_set("stat_tb_fin",c_date_defaut_fin);
EOT;
    break;
}  
echo <<<END
<script type="application/x-javascript"><![CDATA[
$vf_c_url_alimente_table;
const vf_c_fen_stat_art_un='_graal_fen_graphiques_stat_01.php?genre=article_un&';
const vf_c_fen_stat_act_un='_graal_fen_graphiques_stat_01.php?';
const c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const vf_c_fen_stat='_graal_fen_graphiques_stat_01.php?';
const lstn_grise= { 
	willRebuild : function(event){},
	didRebuild  : function(event){pf_grise_fenetre_non();} 
};

function pf_acteur_ouvre(){
  var rowIndex = fa_cui("arbre_des_stats_cial_act_tous");if(rowIndex == -1){return;}
  var param=fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"typeacteur")+"&act_cleunik="+fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"act_cleunik")+"&";
  fa_ouvre(c_script_fen_acteur+param,1000,800);
}
function pf_acteur_ouvre_stats(){
	
  var vl_c_param="";
  var rowIndex = fa_cui("arbre_des_stats_cial_act_tous");if(rowIndex == -1){return;}
	var typeacteur=fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"typeacteur");
	switch (typeacteur) {
    case "110003" :vl_c_param="genre=client_un&";break; 
    case "110001" :vl_c_param="genre=procli_un&";break;
    case "110004" :vl_c_param="genre=fourni_un&";break;
    case "110002" :vl_c_param="genre=profou_un&";break;
  }
	vl_c_param+='vl_e_act_cleunik='+fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"act_cleunik")+'&';
  fa_ouvre(vf_c_fen_stat+vl_c_param);
}
function pf_article_ouvre(vv_arbre) {
  var rowIndex=0,vl_e_art_cleunik=-1,vl_c_param=""; 
  switch (vv_arbre) {
    case "arbre_des_stats_cial_art_tous":
      rowIndex=fa_cui("arbre_des_stats_cial_art_tous");if(rowIndex == -1){return;}
      vl_e_art_cleunik=fa_cell_get("arbre_des_stats_cial_art_tous",rowIndex,"art_cleunik");
      vl_c_param=vf_c_fen_stat_art_un+'vl_e_art_cleunik='+vl_e_art_cleunik+'&';
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_e_art_cleunik+"&",""); 
      break;
  }    
}
function pf_calcule(){
  var vl_c_param="";
  $vl_c_calcul
}
function pf_change_menu(vv_qui) {
  var vo_list = fa_gid(vv_qui);
  var vo_item = vo_list.selectedItem;
	fa_att_set(vv_qui,"class",vo_item.getAttribute("class"));
}

function pf_couleur(num, color){
  fa_gid("colorpicker" + num).hidePopup();
  fa_gid("tb_0" + num).value =color;
  fa_gid("tb_0" + num).inputField.style.backgroundColor=color; 
}
function pf_dessin(){
  var vl_donnes="";
  var vl_affichage="";
  var vl_noms="";
  $vl_c_dessin
  fa_value_set("datas",vl_affichage);  
  lien='_graal_svg_histo_01.php?large='+fa_enc(fa_value_get("large"));
  lien=lien+'&haut='+fa_enc(fa_value_get("haut"));
  lien=lien+'&titre='+fa_enc(fa_value_get("titre"));
  lien=lien+'&donnees='+fa_enc(vl_donnes);
  lien=lien+'&noms='+fa_enc(vl_noms);
  lien=lien+'&type='+fa_enc(fa_value_get("type"));
  lien=lien+'&col1='+fa_enc(fa_value_get("tb_01"));
  lien=lien+'&col2='+fa_enc(fa_value_get("tb_02"));
  lien=lien+'&col3='+fa_enc(fa_value_get("tb_03"));
  lien=lien+'&col4='+fa_enc(fa_value_get("tb_04"));
  fa_att_set("webFrame","src",lien);
}
function pf_init(){
  $vl_c_init
}
function pf_grise_fenetre_non(){
	fa_grise_fenetre("","non");
}
function pf_ouvre_stat(vv_arbre) {
  var rowIndex=0,vl_e_art_cleunik=-1,vl_c_param=""; 
  switch (vv_arbre) {
    case "arbre_des_stats_cial_art_tous":
      rowIndex=fa_cui("arbre_des_stats_cial_art_tous");if(rowIndex == -1){return;}
      vl_e_art_cleunik=fa_cell_get("arbre_des_stats_cial_art_tous",rowIndex,"art_cleunik")
      vl_c_param=vf_c_fen_stat_art_un+'vl_e_art_cleunik='+vl_e_art_cleunik+'&';
      switch (fa_value_get("ml_art_03")) {
        case 0: vl_c_param+='cial=offcli';break;
        case 1: vl_c_param+='cial=cdecli';break;
        case 2: vl_c_param+='cial=livcli';break;
        case 3: vl_c_param+='cial=faccli';break;
        case 4: vl_c_param+='cial=demfou';break;
        case 5: vl_c_param+='cial=cdefou';break;
        case 6: vl_c_param+='cial=recfou';break;
        case 7: vl_c_param+='cial=facfou';break;
      }
      break;
    case "arbre_des_stats_cial_act_tous":
      rowIndex=fa_cui("arbre_des_stats_cial_act_tous");if(rowIndex == -1){return;}
      vl_e_act_cleunik=fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"act_cleunik")
      vl_c_param=vf_c_fen_stat_act_un+'vl_e_act_cleunik='+vl_e_act_cleunik+'&';
      switch (fa_cell_get("arbre_des_stats_cial_act_tous",rowIndex,"typeacteur")) {
        case "110003" :vl_c_param+="genre=client_un&";break; 
        case "110001" :vl_c_param+="genre=procli_un&";break;
        case "110004" :vl_c_param+="genre=fourni_un&";break;
        case "110002" :vl_c_param+="genre=profou_un&";break;
      }
      break;
    default:
      return;
  }
  fa_ouvre(vl_c_param)
}
$vl_c_recup_requete
$js_unload
]]></script>
END;
?>
