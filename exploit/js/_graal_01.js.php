<?php
include("_graal_fonctions_url_absolue.php");
$vl_c_url_absolue=fa_url_absolue();
$vl_c_date_defaut_deb="1961-01-23";
$vl_c_date_defaut_fin="2061-01-23";
$vs_nomcommercial_entreprise=fa_recup_session('vs_nomcommercial_entreprise','');
$param_generaux_graal_044=intval(fa_recup_session('vs_param_generaux_graal_044','0'));
//$vl_c_dico000xx=fa_recup_dico_js("dico_00019");
$vl_c_dico000xx="L'apparence de la table est mémorisée.";
$vl_c_sep=fa_recup_session('vs_separateur','.');
$tableau_JS="tableau_composants_fenetre";
$vl_e_uti_cleunik_cosmetique=intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_c_script="";
$sql_req_cosmetique="SELECT * FROM _uti_fen_cosmetique where uti_cleunik=$vl_e_uti_cleunik_cosmetique and titre='$vl_c_id_fenetre';";
$result_cosmetique = _graal_requete_bd($sql_req_cosmetique);
while ($row_cosmetique = mysql_fetch_assoc($result_cosmetique)){
  $vl_c_script.=$row_cosmetique['cosmetique'];
}
//$vl_c_script.="alert('".$vl_c_id_fenetre." ".$vl_e_uti_cleunik_cosmetique."');";
//$vl_c_script.='alert("'.$row_cosmetique['cosmetique'].'");';
_graal_libere_requete_bd($result_cosmetique);


$fa_ouvre_interlo=<<<EOT
function fa_ouvre_interlo(vv_param){
	fa_ouvre("_graal_fen_act_interlo_02.php?"+vv_param,1000,600);
}
function fa_visu_interlo(){
	return "_graal_fen_act_interlo_02.php";
}
EOT;
$fa_ouvre_acteur=<<<EOT
function fa_ouvre_acteur(vv_param){
	fa_ouvre("_graal_fen_acteurs_01.php?act_cleunik="+vv_param,1050,800);
}
EOT;
switch ($param_generaux_graal_044) {
	case 1://	Services
$fa_ouvre_article=<<<EOT
function fa_ouvre_article(vv_param,vv_quel){
	var vl_c_script_fen_article01="_graal_fen_articles_01.php?";
	var vl_c_script_fen_article02="_graal_fen_articles_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_article02+vv_param,1100,600);
			break;
	}
}
function fa_visu_article(vv_param,vv_quel){
	return "_graal_fen_articles_02.php?";
}
EOT;
$fa_ouvre_ligne_doccial=<<<EOT
function fa_ouvre_ligne_doccial(vv_param,vv_quel){
	var vl_c_script_fen_doccial01="_graal_fen_cial_ligne_01.php?";
	var vl_c_script_fen_doccial02="_graal_fen_cial_ligne_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_doccial02+vv_param,1000,800);
			break;
	}
}
EOT;
		break;
	case 2://	Négoce
$fa_ouvre_article=<<<EOT
function fa_ouvre_article(vv_param,vv_quel){
	var vl_c_script_fen_article01="_graal_fen_articles_01.php?";
	var vl_c_script_fen_article02="_graal_fen_articles_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_article01+vv_param,1100,600);
			break;
	}
}
function fa_visu_article(vv_param,vv_quel){
	return "_graal_fen_articles_01.php?";
}
EOT;
$fa_ouvre_ligne_doccial=<<<EOT
function fa_ouvre_ligne_doccial(vv_param,vv_quel){
	var vl_c_script_fen_doccial01="_graal_fen_cial_ligne_01.php?";
	var vl_c_script_fen_doccial02="_graal_fen_cial_ligne_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_doccial01+vv_param,1000,800);
			break;
	}
}
EOT;
		break;
	case 3://	Mixte
$fa_ouvre_article=<<<EOT
function fa_ouvre_article(vv_param,vv_quel){
	var vl_c_script_fen_article01="_graal_fen_articles_01.php?";
	var vl_c_script_fen_article02="_graal_fen_articles_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_article01+vv_param,1100,600);
			break;
	}
}
function fa_visu_article(vv_param,vv_quel){
	return "_graal_fen_articles_01.php?";
}
EOT;
$fa_ouvre_ligne_doccial=<<<EOT
function fa_ouvre_ligne_doccial(vv_param,vv_quel){
	var vl_c_script_fen_doccial01="_graal_fen_cial_ligne_01.php?";
	var vl_c_script_fen_doccial02="_graal_fen_cial_ligne_02.php?";
	switch (vv_quel){
		case "service":
			break;
		case "negoce":
			break;
		case "mixte":
			break;
		default:
			fa_ouvre(vl_c_script_fen_doccial01+vv_param,1000,800);
			break;
	}
}
EOT;
		break;
}
if ($rss_accès=="restreint"){
	$bloc_00=<<<EOT
const va_c_script_export_req_xls="pagesparticulieres/acces_restreint.php?";
const va_c_script_export_req_ods="pagesparticulieres/acces_restreint.php?";
const va_c_script_lambda_req_rdf='pagesparticulieres/acces_restreint.php?';
const va_c_script_export_req_htm="pagesparticulieres/acces_restreint.php?";
EOT;
$fa_ouvre_article=<<<EOT
function fa_ouvre_article(vv_param,vv_quel){
	fa_ouvre("pagesparticulieres/acces_restreint.php?"+vv_param,1100,600);
}	
EOT;
$fa_ouvre_ligne_doccial=<<<EOT
function fa_ouvre_ligne_doccial(vv_param,vv_quel){
	fa_ouvre("pagesparticulieres/acces_restreint.php?"+vv_param,1000,800);
}
EOT;
$fa_ouvre=<<<EOT
function fa_ouvre(vv_fen,vv_lar,vv_hau) {}
function fa_ouvre_fenetre(vv_fen,vv_lar,vv_hau) {}
EOT;
} else {
$bloc_00=<<<EOT
const va_c_script_export_req_xls="_graal_exporte_requete_vers_xls.php";
const va_c_script_export_req_ods="_graal_exporte_requete_vers_ods.php";
const va_c_script_lambda_req_rdf='_admin_bd_rdf_lambda_01.php';
const va_c_script_export_req_htm="_graal_exporte_requete_vers_htm.php";
EOT;
$fa_ouvre=<<<EOT
function fa_ouvre(vv_fen,vv_lar,vv_hau) {
  switch (vv_lar) {
    case 0    : window.open(vv_fen);break;
    default   : 
    	var vl_e_haut = (screen.height / 2) - (vv_hau / 2);
    	var vl_e_gauche = (screen.width / 2) - (vv_lar / 2);
      window.open(vv_fen, "",'"'+ca_c_ouvre+',width='+vv_lar+',height='+vv_hau+',left='+vl_e_gauche +',top='+vl_e_haut+'"');
      break;  
  }
}
function fa_ouvre_fenetre(vv_fen,vv_lar,vv_hau) {
  switch (vv_lar) {
    case 0    : window.open(vv_fen);break;
    default   : 
    	var vl_e_haut = (screen.height / 2) - (vv_hau / 2);
    	var vl_e_gauche = (screen.width / 2) - (vv_lar / 2);
      window.open(vv_fen, "mafenetre",'"'+ca_c_ouvre+',width='+vv_lar+',height='+vv_hau+',left='+vl_e_gauche +',top='+vl_e_haut+'"');
      break;  
  }
}
EOT;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
$bloc_00
const onlyxul   = "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
const _MAX_INT = 256*256*256*16-1;
const ca_c_ouvre='chrome,hidechrome,centerscreen,modal,resizable';
const c_date_defaut_deb="$vl_c_date_defaut_deb";
const c_date_defaut_fin="$vl_c_date_defaut_fin";
END;
// Déclaration du tableau JavaScript pour composants
printf("var %s = [];\n",$tableau_JS);
$i=-1;
if (isset($vl_tc_composants)) {
  foreach($vl_tc_composants as $keyItems){
		$i++;
    printf("%s[%s] =%s;\n",$tableau_JS, $i,"\"".addslashes($keyItems)."\"");
  }
}
echo <<<END
function fa_aa(vv_qui) {
  try {
    $vl_c_script;
    vv_qui.addEventListener('contextmenu', fa_aa_suite, true);
		var vl_c_titre=document.title;
		if (vl_c_titre.indexOf("-$vs_nomcommercial_entreprise")==-1){
			document.title=document.title+"-$vs_nomcommercial_entreprise";
		}
  }
  catch (e) {
    alert(e)
  }
	try {
		if (vv_qui.opener!=null){
			fa_cache_non("bt_sortir");
		}
	} catch (e){
		alert(e);
	}
}
function fa_aa_suite(event) {
  if (event.target.localName=='textbox') {
    event.preventDefault();
    event.stopPropagation();
  }
}
function fa_ael(vv_qui,vv_quoi,vv_proc){
	try {
		fa_gid(vv_qui).addEventListener(vv_quoi,vv_proc,false);
	} catch(e) {
		var erreur="Erreur ->"+vv_qui+" : "+vv_quoi;
	}
}
function fa_ajoute_ligne_dans_arbre(fields,icon){
  var treeItem  = fa_crexul("treeitem"); 
  var treeRow   = fa_crexul("treerow");
  var count     = fields.length;
  var cells     = new Array(count);
  for(i=0;i<count;i++){
    cells[i] = document.createElementNS(onlyxul,"treecell");
    cells[i].setAttribute("label"," "+fields[i]);
  }
  if(icon!="") { cells[0].setAttribute("src",icon); }
  treeItem.setAttribute("container","true");
  for(i=0;i<count;i++) { treeRow.appendChild(cells[i]); }
  treeItem.appendChild(treeRow);
  return treeItem;
}
function fa_ajoute_rss(vv_qui,vv_quoi,vv_cle){
	var vl_c_script_bdope_rss='_graal_bdope_rss_01.php';
	var s="";
	switch (vv_quoi) {
		case "action":
			s="vf_c_action=ajouter_action&vf_e_doc_cleunik="+vv_qui+"&detail_rss="+vv_cle+"&";
			break;
	}
	fa_xmlhttprequest_txt(vl_c_script_bdope_rss,s,fa_ajoute_rss_fin,vv_quoi);
}
function fa_ajoute_rss_fin(vv_texte,vv_quoi){
	switch (vv_quoi) {
		case "action":
			if (vv_texte=="ok"){
				alert("Action ajoutée au flux");
			} else {
				alert("Problème lors de la tentative d'ajout au flux !!!");
				alert(vv_texte);
			}
			break;
	}
}
function fa_att_get(vv_qui,vv_quoi){
 try {
  return fa_gid(vv_qui).getAttribute(vv_quoi);
  } catch (e) {
		//return null;
	}
}
function fa_att_rem(vv_qui,vv_quoi){
 try {
  fa_gid(vv_qui).removeAttribute(vv_quoi);
  } catch (e) {
		var erreur="Erreur ->"+vv_qui+" : "+vv_quoi;
	}
}
function fa_att_set(vv_qui,vv_quoi,vv_valeur){
 try {
	fa_gid(vv_qui).setAttribute(vv_quoi,vv_valeur);
  } catch (e) {
  	var erreur="Erreur ->"+vv_qui+" : "+vv_quoi;
	}
}
function fa_badl(vv_qui,vv_quoi){
	try {
		fa_gid(vv_qui).builder.addListener(vv_quoi);
	} catch(e) {
		var erreur="Erreur ->"+vv_qui+" : "+vv_quoi;
	}
}
function fa_brl(vv_qui,vv_quoi){
	try {
    fa_gid(vv_qui).builder.removeListener(vv_quoi);
  }
  catch (e) {
    //alert(e);
  }
}
function fa_bgc(vv_qui,vv_cou) {
  try {
		fa_gid(vv_qui).setAttribute("style",'-moz-appearance: none;')
	  switch (vv_cou) {
	    case 'init':
	      fa_gid(vv_qui).removeAttribute('style');
	      break;
	    default:
	      fa_gid(vv_qui).style.background=vv_cou;
	      break;    
  	}
	} catch(e) {
		var erreur="Erreur ->"+vv_qui+" : "+vv_cou;
	}
}
function fa_cache_non(vv_qui) {
 try {
  //fa_gid(vv_qui).hidden=false; jusqu'au 24 novembre 2006
  fa_att_set(vv_qui,"collapsed","false");  //  depuis le 25 novembre 2006
  } catch (e) {
		//alert(e)
	}
}
function fa_cache_oui(vv_qui){
 try {
  //fa_gid(vv_qui).hidden=true; jusqu'au 24 novembre 2006
  fa_att_set(vv_qui,"collapsed","true");  //  depuis le 25 novembre 2006
  } catch (e) {
  	//alert(e);
		// raf
	}
}
function fa_cell_get(vv_qui,vv_indice,vv_quoi) {
  try {
    var t=fa_gid(vv_qui);
    return t.view.getCellText(vv_indice,t.columns.getNamedColumn(vv_quoi));
  } catch (e) {
		return null;
	}
}
function fa_cell_val(vv_qui,vv_indice,vv_quoi) {
  try {
    var t=fa_gid(vv_qui);
    return t.view.getCellValue(vv_indice,t.columns.getNamedColumn(vv_quoi));
  } catch (e) {
		return "";
	}
}
function fa_check(vv_qui){
 try {
  //fa_gid(vv_qui).checked=true;
  fa_gid(vv_qui).setAttribute("checked","true");
  } catch (e) {
		// raf
	}
}
function fa_collapse_tree(vv_qui) {
  try {  
    var vol_arbre=fa_gid(vv_qui);
    var vl_e_nbligne=fa_cl(vv_qui);
    vl_e_nbligne--;
    for(var i=vl_e_nbligne;i>0;i--) {
      if(vol_arbre.view.isContainer(i)){
        if(vol_arbre.view.isContainerOpen(i)) {vol_arbre.view.toggleOpenState(i);}
      }
    }
    vol_arbre.view.toggleOpenState(0);
  } catch (e) {
    //raf
    alert(e)
	}
}
function fa_crexul(vv_quoi) { 
  return document.createElementNS(onlyxul,vv_quoi); 
}
function fa_cl(vv_quoi) {
  try {
  	return fa_gid(vv_quoi).view.rowCount;   
  } catch (e) {
		return -1
	}
}
function fa_cui(vv_quoi) {
  try {    
    return fa_gid(vv_quoi).currentIndex;
  } catch (e) {
		return -1
	}
}
function fa_das(vv_qui,vv_valeur) {
  try {
		//fa_vide_arbre(vv_qui); // -> vide mais ensuite, ce n'est pas rempli !!! 
		fa_att_set(vv_qui,"datasources",vv_valeur);
		fa_lignes_arbre_deselectionne(vv_qui);
  } catch (e) {
		// raf
		alert(e)
	}
}
function fa_das_obsolete(vv_qui,vv_valeur) {
  try {
	  var http = new XMLHttpRequest();
	  http.open("GET","_graal_txt_ping_01.php",true);
		http.onreadystatechange=function(){
			if(http.readyState==4){
				if(http.responseText!="1"){
					alert("Inactif depuis trop longtemps. Reconnectez-vous, s'il vous plaît.");
					return;
				} else {
					fa_att_set(vv_qui,"datasources",vv_valeur);
					fa_lignes_arbre_deselectionne(vv_qui);
				}
			}	
		};
	  http.send("");
  } catch (e) {
		// raf
	}
}
function fa_date_formate(input,vv_format){
try {
	if (input=='') {return '';}
	var regex = new RegExp("[/.-]");  //  Attention de bien laisser le - en dernier sinon considéré comme caractère d'exclusion
	var date = input.split(regex);
	var nbJours = new Array('',31,28,31,30,31,30,31,31,30,31,30,31);
	var result = true;
	var vl_c_date_retournee="";
	if ( date['2'].length==1) {date['2']='200'+date['2']}
	if ( date['2'].length==2) {date['2']='20'+date['2']}
	if ( date['2'].length==3) {date['2']='2'+date['2']}
	if ( date['2']%4 == 0 && date['2']%100 > 0 || date['2']%400 == 0 )
	nbJours['2'] = 29;
	if( isNaN(date['2']) )
	result=false;
	if ( isNaN(date['1']) || date['1'] > 12 || date['1'] < 1 )
	result=false;
	if ( date['1'].length==1) {date['1']='0'+date['1']}
	if ( isNaN(date['0']) || date['0'] > nbJours[Math.round(date['1'])] || date['0'] < 1 )
	result=false;
	if ( date['0'].length==1) {date['0']='0'+date['0']}
	    switch (vv_format){
	    case "AAAAMMJJ":
			vl_c_date_retournee=input.replace("-", "", "gi");
	      break;
	    case "AAAA-MM-JJ":
	      vl_c_date_retournee=date['2']+"-"+date['1']+"-"+date['0'];
	      break;
	
	    }
	    return vl_c_date_retournee;
} catch (e) {
	return "";
}
}
function fa_date_verif(input)
// Fonction de vérification de date avec les années bissextile par jerome.o 
//  http://www.editeurjavascript.com/scripts/scripts_temps_3_479.php
// Accepte en entrée les dates sous la forme : 02/02/2004, 2-2-2004 avec des / ou - ou .
// Retourne false si la date est fausse ou érronée
{
var vl_c_sep;
for (var i=0;i<input.length;i++)
{
  if ( isNaN(input.charAt(i))) {vl_c_sep=input.charAt(i);}
}
var regex = new RegExp("[/.-]");  //  Attention de bien laisser le - en dernier sinon considéré comme caractère d'exclusion
var date = input.split(regex);
var nbJours = new Array('',31,28,31,30,31,30,31,31,30,31,30,31);
var result = true;

if ( date['2'].length==1) {date['2']='200'+date['2'];}
if ( date['2'].length==2) {date['2']='20'+date['2'];}
if ( date['2'].length==3) {date['2']='2'+date['2'];}
if ( date['2']%4 == 0 && date['2']%100 > 0 || date['2']%400 == 0 )
nbJours['2'] = 29;

if( isNaN(date['2']) )
result=false;

if ( isNaN(date['1']) || date['1'] > 12 || date['1'] < 1 )
result=false;
if ( date['1'].length==1) {date['1']='0'+date['1'];}

if ( isNaN(date['0']) || date['0'] > nbJours[Math.round(date['1'])] || date['0'] < 1 )
result=false;
if ( date['0'].length==1) {date['0']='0'+date['0'];}
if (result==false)
{
return result;
}
else
{
return date['0']+vl_c_sep+date['1']+vl_c_sep+date['2'];
}
}

function fa_dec(vv_chaine) {
  //  Remplacement des virgules par des points
  return vv_chaine.replace(/[,]/gi,".");
}
function fa_deploie_tree(vv_qui) {
  var treeView=fa_gid(vv_qui);
	var nb=fa_cl(vv_qui);
  for (var i = 0; i < nb; i++) { if (treeView.isContainer(i) && !treeView.isContainerOpen(i)) treeView.toggleOpenState(i); } 
}
function fa_ds(vv_qui,vv_valeur) {
  try {    
    fa_att_set(vv_qui,"datasources",vv_valeur);
  } catch (e) {
		// raf
	}
}
function fa_enc(vv_quoi) {
  return encodeURIComponent(vv_quoi);
}
function fa_expand_tree(vv_qui){
  try 
  {  
    var vol_arbre=fa_gid(vv_qui);
    var vl_e_nbligne=fa_cl(vv_qui);;
    for(var i=0;i<vl_e_nbligne;i++)
    {
      if(!vol_arbre.view.isContainerOpen(i)){vol_arbre.view.toggleOpenState(i);}
    }
  } catch (e) {
		// raf
	}
}
function fa_erreur(vv_quoi){
alert(vv_quoi);
}
function fa_est_coche(vv_qui){
 try {
  if(fa_gid(vv_qui).checked==true)
  {return true;}
  else
  {return false;}
  } catch (e) {
		return false;
	}
}
function fa_est_conteneur(noeud){ return noeud.getAttribute("container")=="true"; }
function fa_est_grise(vv_qui){
 try {
  if(fa_gid(vv_qui).disabled==true)
  {return true;}
  else
  {return false;}
  } catch (e) {
		return false;
	}
}
function fa_est_numerique(vv_data){
var numchars = ".0123456789";
var isnum = true;
var index = 0;
while ((index < vv_data.length) && (isnum)){
  isnum = (numChars.indexOf(vv_data.charAt(index)) != -1);
  index ++;
}
if (!isnum){window.alert("Erreur ! Saisissez un nombre entier");}
}
function fa_exporte_requete_vers_htm(vl_c_requete){
  var vl_c_url=va_c_script_export_req_htm;
  vl_c_url+="?vl_c_requete="+fa_enc(vl_c_requete)+"&";
  fa_ouvre(vl_c_url,0,0);
}
function fa_exporte_requete_vers_ods(vl_c_requete){
  var vl_c_url=va_c_script_export_req_ods;
  var vl_c_nom_fichier_ods=prompt("Nom du fichier","essai");
  vl_c_url+="?vl_c_requete="+fa_enc(vl_c_requete)+"&";
  vl_c_url+="vl_c_nom_fichier_ods="+fa_enc(vl_c_nom_fichier_ods)+"&";
  fa_ouvre(vl_c_url,0,0);
}
function fa_exporte_requete_vers_rdf(vl_c_requete){
  var vl_c_url=va_c_script_lambda_req_rdf;
  vl_c_url+="?vl_c_requete="+fa_enc(vl_c_requete)+"&";
  fa_ouvre(vl_c_url,0,0);
}
function fa_exporte_requete_vers_xls(vl_c_requete){
  var vl_c_url=va_c_script_export_req_xls;
	var vl_c_nom_fichier_xls=prompt("Nom du fichier","essai.xls");
  vl_c_url+="?vl_c_requete="+fa_enc(btoa(vl_c_requete))+"&";
  vl_c_url+="vl_c_nom_fichier_xls="+fa_enc(vl_c_nom_fichier_xls)+"&";
  vl_c_url+="vl_c_no_requete=0-0&";
  fa_ouvre(vl_c_url,0,0);
}
function fa_exporte_requete_systeme_vers_xls(vl_c_requete){
  var vl_c_url=va_c_script_export_req_xls;
	var vl_c_nom_fichier_xls=prompt("Nom du fichier","export.xls");
  vl_c_url+="?vl_c_no_requete="+vl_c_requete+"&";
  vl_c_url+="vl_c_nom_fichier_xls="+fa_enc(vl_c_nom_fichier_xls)+"&";
  fa_ouvre(vl_c_url,0,0);
}
function fa_ferme(){
   if (confirm ("Voulez-vous vraiment quitter?")) {
    var http = new XMLHttpRequest();
		http.open("GET","_graal_exe_reinit_session.php",true);
	  http.onreadystatechange=function(){
  	if(http.readyState==4){
  		window.location="http://www.lemonde.fr/";
			}
		};
	  http.send("");
    return true;
   } else {
      return false;
   } 
}


function fa_focusdonne(vv_qui){
 try {
 	if (fa_gid(vv_qui).type=="number"){fa_gid(vv_qui).setSelectionRange(0,10);}
  fa_gid(vv_qui).focus();
  } catch (e) {
		//alert("impossible prendre le focus");
	}
}
function fa_focus_gere_menulist(vv_qui) {
    var range = document.createRange();
    range.selectNode(vv_qui);
    var selection = window.getSelection();
    selection.addRange(range);
    selection.collapseToStart();
}
function fa_focusperte_ml(aMenulist) {
	/*
	 * suggestion faite ici
	 * http://groups.google.com/group/mozilla.dev.tech.xul/browse_thread/thread/5ca2ddd34b3c73c/c41a39c0a61882a1#c41a39c0a61882a1
	 */
		//alert(aMenulist.id)
    var range = document.createRange();
    range.selectNode(aMenulist);
    var selection = window.getSelection();
    selection.addRange(range);
    selection.collapseToStart();
} 
function fa_getvar (nomVariable){
  var infos = location.href.substring(location.href.indexOf("?")+1, location.href.length)+"&";
  if (infos.indexOf("#")!=-1)
      infos = infos.substring(0,infos.indexOf("#"))+"&";
  var variable=0;
  {
    nomVariable = nomVariable + "=";
    var taille = nomVariable.length;
    if (infos.indexOf(nomVariable)!=-1)
        variable = infos.substring(infos.indexOf(nomVariable)+taille,infos.length).substring(0,infos.substring(infos.indexOf(nomVariable)+taille,infos.length).indexOf("&"));
  }
  return unescape(variable)
}
function fa_gid(vv_quoi){
  try {
    return document.getElementById(vv_quoi);
    } catch (e) {
		return null;
	}
}
function fa_grise_fenetre(vv_event,vv_quoi){
	try {
		switch (vv_quoi){
			case "oui":
				fa_att_set("html_qui_grise","class","montr_couvre_fenetre");
				break;
			case "non":
				fa_att_set("html_qui_grise","class","cache_couvre_fenetre")
				break;
		}
		return true;
	} catch (e) {
		return false;
	}
}
function fa_grise_non(vv_qui){
 try {
 	//fa_gid(vv_qui).disabled=false;
  fa_att_rem(vv_qui,"disabled");
  } catch (e) {
		//alert(e)
	}
}
function fa_grise_oui(vv_qui){
 try {
  //fa_gid(vv_qui).disabled=true;
  if (fa_att_get(vv_qui,"disabled")!=true) {fa_att_set(vv_qui,"disabled","true");}
  } catch (e) {
		//alert(e)
	}
}
function fa_grise_groupe_non(vv_qui){
 try {
  fa_att_rem(vv_qui,"disabled");
  fa_gid(vv_qui).style.color="";
  } catch (e) {
		// raf
	}
}
function fa_grise_groupe_oui(vv_qui){
 try {
  fa_att_set(vv_qui,'disabled','true');
  fa_gid(vv_qui).style.color='black';
  } catch (e) {
		//alert(e)
	}
}

function fa_heure_verif(valeur) {
var ctl = /^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/;
if (valeur.search(ctl) != -1) return true;
else return false;
} 
function fa_infos_fenetre(vv_qui){
  var s="";
  s+='p01='+fa_enc(vv_qui)+"&";
  s+='p02='+fa_enc(document.documentURI)+"&";
  s+='p03='+fa_enc(document.location.pathname)+"&";
  s+='p04='+fa_enc(document.title)+"&";
  s+='p05='+fa_enc(fa_jsarray2php_00($tableau_JS))+"&";
  fa_ouvre('_graal_fen_infos.php?'+s,400,400);
}
function fa_infos_colonnes_arbre_recup(vv_fen,vv_quoi) {
  var vl_c_label_table=fa_att_get(vv_quoi,'label');
  var colonnes = fa_gid(vv_quoi).getElementsByTagNameNS(onlyxul,"treecol");
  var colonne;
  var vl_c_width,vl_c_hidden,vl_c_ordinal,vl_c_id,vl_c_label,vl_c_chaine="",vl_c_sortDirection="",vl_c_sortActive="",vl_c_sort="";
  if (colonnes.length!=0) {
    var i=0;
    colonne=colonnes[0];
    while (colonne!=null) {
      vl_c_id=colonne.id;
      i++;
      colonne=colonnes[i];
      vl_c_width=fa_att_get(vl_c_id,'width');
      vl_c_ordinal=fa_att_get(vl_c_id,'ordinal');
      vl_c_hidden=fa_att_get(vl_c_id,'hidden');
      vl_c_label=fa_att_get(vl_c_id,'label');
      vl_c_sort=fa_att_get(vl_c_id,'sort');
      vl_c_sortDirection=fa_att_get(vl_c_id,'sortDirection');
      vl_c_sortActive=fa_att_get(vl_c_id,'sortActive');
      if (vl_c_width!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','width',"+vl_c_width+");";
      }
      if (vl_c_ordinal!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','ordinal',"+vl_c_ordinal+");";
      }
      if (vl_c_hidden!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','hidden',"+vl_c_hidden+");";
      }
      if (vl_c_sort!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','sort','"+vl_c_sort+"');";
      }
      if (vl_c_sortDirection!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','sortDirection','"+vl_c_sortDirection+"');";
      }
      if (vl_c_sortActive!="") {
        vl_c_chaine+="fa_att_set('"+vl_c_id+"','sortActive','"+vl_c_sortActive+"');";
      }
    }
    //alert(vl_c_chaine)
    var vl_c_donnees="vf_c_action=remplacer&";
    vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik_cosmetique&";
    vl_c_donnees+="vl_titre="+fa_enc(vv_fen)+"&";
    vl_c_donnees+="vl_objet="+fa_enc(vv_quoi)+"&";
    vl_c_donnees+="vl_description="+fa_enc(vl_c_label_table)+"&";
    vl_c_donnees+="vl_cosmetique="+fa_enc(vl_c_chaine)+"&";
    fa_xmlhttprequest_txt("_graal_bdope_uti_fen_cosmetique_01.php",vl_c_donnees,fa_infos_colonnes_arbre_recup_fin);
  }
}
function fa_infos_colonnes_arbre_recup_fin(stream) {
  //alert(stream);
	alert("$vl_c_dico000xx");
}
function fa_jsarray2php_00(tab) {
   // script pompé le 20 décembre 2006 sur http://www.aidejavascript.com/article155.html
   
   /*
   Voir cela en php pour désérialiser les caractères accentués et autres
   
    $vl_t_listecles="a:1:{i:0;s:20:\"Christophe é Charron\";}";
    echo $vl_t_listecles.$eol;
    fa_remplace(&$vl_t_listecles);
    $vl_t_listecles=unserialize(stripslashes($vl_t_listecles));
    var_dump($vl_t_listecles);
    echo $eol;

   function fa_remplace(&$vv_quoi) {
    $vv_quoi = preg_replace('!s:(\d+):"(.*?)";!se', "'s:'.strlen('$2').':\"$2\";'", $vv_quoi );
    }
    Truc donné sur http://www.developpez.net/forums/showthread.php?t=423751
   */
   
   var chaine = "";
   var idx = 0;
   for (i in tab) {
       if (isNaN(i)) chaine += "s:" + i.length + ":\"" + i + "\";";
       else chaine += "i:" + i + ";";
       var valeur = tab[i];
       switch (typeof valeur) {
           case "string" :
               valeur = fa_jsarray2php_01(valeur);
               chaine += "s:" + valeur.length + ":\"" + valeur + "\";";
               break;
           case "number" :
               if (valeur > parseInt(valeur)) chaine += "d:" + valeur + ";";
               else if (valeur > _MAX_INT) chaine += "d:" + valeur + ";";
               else chaine += "i:" + valeur + ";";
               break;
           case "boolean" :
               chaine += "b:" + ((valeur === true) ? 1 : 0) + ";";
               break;
           case "object" :
               if (valeur === null) chaine += "N;";
               else chaine += fa_jsarray2php_00(valeur);
               break;
           default :
               chaine += "N;";
       }
       idx++;
   }
   return "a:" + idx + ":{" + chaine + "}";
}
function fa_jsarray2php_01(chaine) {
   return chaine.replace(/\"/g, "&quot;");
}
function fa_jsarray2php_01(chaine) {
   return chaine.replace(/\"/g, "&quot;");
}
function fa_label(vv_qui,vv_label){
 try {
  fa_gid(vv_qui).label=vv_label;
  } catch (e) {
		// raf
	}
}
function fa_lignes_arbre(vv_qui){
  try {
    var tree = fa_gid(vv_qui);
    while (tree.hasChildNodes()) { tree.removeChild(tree.lastChild); }
  }  catch (e) {
		// raf
	}
}
function fa_lignes_arbre_deselectionne(vv_qui){
  try {
  	fa_gid(vv_qui).view.selection.select(-1);
  }  catch (e) {
		var erreur="Erreur ->"+vv_qui;
	}
}
function fa_lignes_selectionnees(vv_qui){
  var tree=fa_gid(vv_qui);
  var vl_o_start = new Object();
  var vl_o_end = new Object();
  var vl_t_tableau=[];
  var vl_e_j=0;
  var numRanges = tree.view.selection.getRangeCount();
  for (var t=0; t<numRanges; t++){
    tree.view.selection.getRangeAt(t,vl_o_start,vl_o_end);
    for (var v=vl_o_start.value; v<=vl_o_end.value; v++){
      vl_t_tableau[vl_e_j]=v;
      vl_e_j++;
    }
  }
  return vl_t_tableau;
}
function fa_mlget(vv_qui,vv_quoi) {
 try {
  if (!vv_quoi) {vv_quoi="_graal_cleunik";}
  return fa_gid(vv_qui).selectedItem.getAttribute(vv_quoi);
  } catch (e) {
		//alert(e)
    return null
	}
}
function fa_mlget_check(vv_qui,vv_quoi) {
 try {
  if (!vv_quoi) {vv_quoi="_graal_cleunik";}
	var k=fa_gid(vv_qui).selectedIndex;
	  var vl_e_nombre=fa_gid(vv_qui).itemCount;
		var vv_valeurs="";
		var j=0;
	  for(var i=0;i<vl_e_nombre;i++){
			fa_gid(vv_qui).selectedIndex=i;
	    if (fa_gid(vv_qui).selectedItem.getAttribute("checked")=="true") {
				if (j!=0){vv_valeurs+=',';}
				vv_valeurs+=fa_mlget(vv_qui,vv_quoi);
		    j++;
			}
	  }
		fa_gid(vv_qui).selectedIndex=k;
		return vv_valeurs;
  } catch (e) {
		//alert(e)
    return vv_valeurs;
	}
}

function fa_mlsel(vv_qui,vv_valeur,vv_quoi) {
  try {
    if (!vv_quoi) {vv_quoi="_graal_cleunik";}
    var vl_e_nombre=fa_gid(vv_qui).itemCount;
    for(var i=0;i<vl_e_nombre;i++){
      fa_gid(vv_qui).selectedIndex=i;
      if (vv_valeur==fa_mlget(vv_qui,vv_quoi)){break;}
    }
  } catch(e) {
    //  raf
  }
}
function fa_nbdec(vv_qui,vv_quoi){
	fa_att_set(vv_qui,"decimalplaces",vv_quoi);
}
function fa_nouvelle_branche(noeud){
    noeud.setAttribute("container","true");
    noeud.setAttribute("open","true");
    noeud.appendChild(document.createElementNS(onlyxul,"treechildren"));
}
function fa_ouvre_action(url,vv_quoi){
	switch (vv_quoi){
		case "rectel":
		  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
		  var http = new XMLHttpRequest();
		  var mode;
			mode="POST";
		  http.open(mode,url,true);
		  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
		  http.onreadystatechange=function(){if(http.readyState==4){
				var vl_c_datas=http.responseText;
		  	if (vl_c_datas!=-1) {
			  	var vf_c_script_fen_action='_graal_fen_actions_02.php?';
			    var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=ajoutermodifier&";
			    fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,600);
			  }
			}
			};
		  http.send(null);
			break;
		case "email_html":
		case "email_text":
			fa_ouvre(url);
			break;
		case "emitel":
			var vl_c_script_bdope_action="_graal_bdope_actions_01.php?vf_c_action=ajouteremitel&vl_act_cleunik=-1&vl_int_cleunik=-1&";
		  var http = new XMLHttpRequest();
		  http.open("GET",vl_c_script_bdope_action,true);
		  http.onreadystatechange=function(){
		    if(http.readyState==4){
		      var vl_c_datas=http.responseText;
		      if (vl_c_datas!=-1) {
		        var vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_c_datas)+"&vf_c_action=modifier&";
		        fa_ouvre('_graal_fen_actions_02.php?'+vl_c_donnees,1000,600);
		      }
		    }
		  };
		  http.send(null);
			break;
		case "lambda":
			var vl_c_donnees="vf_e_action_cleunik=-1&vf_c_action=ajouter&";
      fa_ouvre('_graal_fen_actions_02.php?'+vl_c_donnees,1000,600);
			break;
	}
}
$fa_ouvre
$fa_ouvre_acteur
$fa_ouvre_article
$fa_ouvre_interlo
$fa_ouvre_ligne_doccial
function fa_padleft(strChar, intLength,val)
{
 var str = val + '';
 while (str.length != intLength) {
  str = strChar + str;
 }
 return str;
}
function fa_popup_cache(vv_popup,vv_surquoi) {
  fa_gid(vv_popup).hidePopup(vv_surquoi, -1, -1);
}
function fa_popup_montre(vv_popup,vv_surquoi) {
  fa_gid(vv_popup).showPopup(vv_surquoi, -1, -1);
}
function fa_remove_attribute(vv_qui,vv_quoi){
 try {
  fa_gid(vv_qui).removeAttribute(vv_quoi);
  } catch (e) {
		// raf
	}
}
function fa_ro_non(vv_qui){
 try {
  fa_gid(vv_qui).removeAttribute("readonly");
  } catch (e) {
		//alert(e);
	}
}
function fa_ro_oui(vv_qui){
 try {
  fa_gid(vv_qui).setAttribute("readonly","true");
  } catch (e) {
		// raf
	}
}
function fa_se(vv_chaine){
  //  Remplacement des espaces par rien du tout
  return vv_chaine.replace(/[ ]/gi,"");
}
function fa_sel_index(vv_qui,vv_lequel) {
 try {fa_gid(vv_qui).selectedIndex=vv_lequel;} catch (e) {}
}
function fa_sep(vv_qui) {
  try {    
    fa_gid(vv_qui).decimalSymbol="$vl_c_sep";
  } catch (e) {
		//  raf
	}
}
function fa_slashes_date(eve,vv_qui) {
  try {
    var new_val="",val="";
    val=fa_gid(vv_qui).value;
    if ( val.length==2) {
      new_val=val+"/";
      } else {
      if ( val.length==5) {
        new_val=val+"/";
      } else {
        new_val=val;
      }
    }
    fa_value_set(vv_qui,new_val);
		return new_val;
  } catch (e) {
		alert(e);
    return null;
	}
}
function fa_value_get(vv_qui){
  try {
    return fa_gid(vv_qui).value;
  } catch (e) {
		return null;
	}
}
function fa_value_set(vv_qui,vv_valeur){
  try {    
    var control = fa_gid(vv_qui);
    if(control) {control.value = vv_valeur;}
  } catch (e) {
		// raf
	}
}
function fa_uncheck(vv_qui){
 try {
  fa_gid(vv_qui).checked=false;
  } catch (e) {
		// raf
	}
}

//---------------------------------------------------------------------    
function fa_httppost_txt(url,request,callback){
  var http = new XMLHttpRequest();
  http.open("POST", url, true);
  http.onreadystatechange=function(){if(http.readyState==4){callback(http.responseText);}};
  http.send(request);
}
//---------------------------------------------------------------------
function fa_vide_arbre(vv_qui){
/* attention les 2 fonctions, si elles ont apparement un résultat identique, ne fonctionnent pas de la même manière et on donc leur raison d'être TOUTES LES DEUX */
  try {
    var tree = fa_gid(vv_qui);
    while (tree.hasChildNodes()) { tree.removeChild(tree.lastChild); }
  }  catch (e) {
		// raf
	}
}
function fa_vide_arbre_bis(vv_qui){
/* attention les 2 fonctions, si elles ont apparement un résultat identique, ne fonctionnent pas de la même manière et on donc leur raison d'être TOUTES LES DEUX */	
  try {
    var vl_e_nb=fa_gid(vv_qui).view.rowCount;
	  if (vl_e_nb!=0) {
	    for(var i=vl_e_nb-1;i>=0;i--) {
				selected = fa_gid(vv_qui).contentView.getItemAtIndex(i);
				selected.parentNode.removeChild(selected);
	    }
	  }
	  fa_lignes_arbre_deselectionne(vv_qui);
  }  catch (e) {
		// raf
	}
}
function fa_vide_liste(vv_qui){
  try {
    var list = fa_gid(vv_qui);
    while (list.getRowCount()>0) list.removeItemAt(0);
  }  catch (e) {
		// raf
	}
}
function fa_xml_get(vv_data,vv_qui){
  try {
    return vv_data.getElementsByTagName(vv_qui)[0].getAttribute('data');
    //return vv_data.getElementsByTagNameNS("http://www.w3.org/2001/XInclude",vv_qui)[0].getAttribute('data'); //  changé le 23/06/2008 pour essayer d'enrayer les plantages FF3 -> ne donne rien
  } catch (e) {
		return null;
		//return "";//  changé le 21/06/2008 pour essayer d'enrayer les plantages FF3 ->23 juin 2008 : vraisemblablement inutile 
		
	}
}
//---------------------------------------------------------------------
function fa_xmlhttprequest_txt(url,request,callback,target){
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,true);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){
  	if(http.readyState==4){
  		if(callback!=""){
  			var reponse=http.responseText;
  			var tableau_retour=reponse.split('|');
				if (tableau_retour[0]=="interditdacces"){
					fa_ouvre(tableau_retour[1]);
				} else {
					callback(http.responseText,target,http.responseText.length);}
				}
			}
		};
  http.send(request);
}
function fa_xhr_txt(url,request,callback,target){
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,true);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){
  	if(http.readyState==4){
  		if(callback!=""){
  			var reponse=http.responseText;
  			var tableau_retour=reponse.split('|');
				if (tableau_retour[0]=="interditdacces"){
					fa_ouvre(tableau_retour[1]);
				} else {
					callback(http.responseText,target,http.responseText.length);}
				}
			}
		};
  http.send(request);
}
function fa_xhr_validation(url,request,callback,target){
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,true);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){
  	if(http.readyState==4){
  		if(callback!=""){
  			var reponse=http.responseText;
  			var tableau_retour=reponse.split('|');
				if (tableau_retour[0]=="interditdacces"){
					fa_ouvre(tableau_retour[1]);
				} else {
					callback(http.responseText,target,http.responseText.length);}
				}
			}
		};
  http.send(request);
}
function fa_xmlhttprequest_head(url,request,callback,target){
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  http.open("HEAD",url,true);
  http.onreadystatechange=function(){if(http.readyState==4){if(callback!=""){callback(http.responseText,target,http.responseText.length);}}};
  http.send(null);
}
function fa_xmlhttprequest_txt_sync(url,request,callback,target){
  //  Attention appel synchrone
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,false);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){if(http.readyState==4){if(callback!=""){callback(http.responseText,target,http.responseText.length);}}};
  http.send(request);
}
function fa_xmlhttprequest_xml(url,request,callback,target){
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,true);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){if(http.readyState==4){if(callback!=""){callback(http.responseXML,target);}}};
  http.send(request);
}
function fa_xmlhttprequest_xml_sync(url,request,callback,target){
  //  Attention appel synchrone
  if (url=='') {alert("heu ... faudrait peut-être donner un nom au script !!! Grosse erreur de programmation !!");return;}
  var http = new XMLHttpRequest();
  var mode;
  if(!request){mode="GET";} else {mode="POST";}
  http.open(mode,url,false);
  if(mode=="POST"){http.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
  http.onreadystatechange=function(){if(http.readyState==4){if(callback!=""){callback(http.responseXML,target);}}};
  http.send(request);
}
//  Fonctions récupérées à explorer
//---------------------------------------------------------------------    
// sample on how to get last modified date
// good for checking RSS feeds
// url = "http://geekswithblogs.net/rebelgeekz/rss.xml"
//--------------------------------------------------------------------- 
function httpLastModified(url,callback){
    var http = new XMLHttpRequest();
    http.open("HEAD", url, true);
    http.onreadystatechange=function(){if(http.readyState==4){callback(http.getResponseHeader("Last-Modified"));}};
    http.send(null);
}
]]></script>
END;
?>
