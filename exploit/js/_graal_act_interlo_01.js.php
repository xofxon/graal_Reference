<?php
$vl_c_baz_123js=fa_recup_dico_js("baz_123");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_act_interlo_01.php";
const vf_c_script_edite="_graal_xml_act_interlo_01.php";
const vf_c_script_interlo='_graal_xml_acteurs_interlo_02.php?';
const vf_c_script_adrpost='_graal_das_interlos_adresses_01.php?sortie=xul&';
const vf_c_script_relations='_graal_das_interlos_relations_01.php?'
const vf_c_script_favoris='_graal_bdope_act_interlo_favoris_01.php';
const vf_c_script_critere_interlos_entreprise='_graal_das_interlos_criteres_entreprise.php?';
const vf_c_script_critere_interlos_lesmiens='_graal_das_interlos_criteres_lesmiens.php?';
const vf_c_script_critere_interlos_lesautres='_graal_das_interlos_criteres_lesautres.php?';
const vf_c_script_critere_interlos_tous='_graal_das_interlos_criteres_tous.php?';
const vf_c_fen_interlo_tel="_graal_fen_act_interlo_tel_01.php?";
const vf_c_fen_interlo_fax="_graal_fen_act_interlo_fax_01.php?";
const vf_c_fen_interlo_mail="_graal_fen_act_interlo_mail_01.php?";
const vf_c_fen_interlo_adrp="_graal_fen_interlo_adresses_01.php?";
const vf_c_fen_interlo_adrp_02="_graal_fen_interlo_adresses_02.php?";
const vf_c_fen_interlo_mesinst="_graal_fen_act_interlo_mesinst_01.php?";
const vf_c_fen_interlo_relations="_graal_fen_act_interlo_relation_01.php?";
const vf_c_fen_interlo_relations_fiche="_graal_fen_act_interlo_relation_02.php?";
const vf_c_fen_criteres='_graal_fen_interlo_criteres.php?'
const vf_c_script_ged='_graal_rech_ged_01.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=666666&';
const vf_c_fen_pseudosliens="_graal_fen_pseudodocs_01.php?quelsdocs=unlien_interl&genre=interl&"
const vf_c_fen_notes="_graal_fen_note_01.php?quelsdocs=unenot_interl&genre=interl&"
var vf_c_action,vf_e_int_cleunik,vf_e_tel_cleunik,vf_e_adr_cleunik,vf_e_int_cleunik_droite,vf_e_int_cleunik_gauche,vf_e_choix_cleunik_droite,vf_e_choix_cleunik_gauche;
var vf_e_act_cleunik="$vl_e_act_cleunik",vf_e_nombre_utilisations=0,vf_e_mesinst_cleunik;
const c_fen_selection_dossiers='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=dossiers&retour=oui&';
const c_bdope_dossiers='_graal_bdope_note_01.php?vf_c_action=insere_dans_dossier&type_insertion_dossier=interlo&vf_e_doc_cleunik=';
function pf_aa_init(){
  vf_e_int_cleunik="$vl_e_interlo_cleunik";
  pf_grise_boutons_interlo();
  pf_aa_init_bem('21');
  switch ("$vl_e_interlo_cleunik") {
    case "-1":  //  création
      pf_etat_fen("ajouter");
      break;
    default:
      pf_etat_fen("ini");
      pf_selectionne_interlo();
      break;    
  }
}
function pf_action(vv_quoi){
  var vl_c_param;
  var raf_random=Math.random();
  switch (vv_quoi) {
    case 'favoris_ajout':
      vl_c_param="vf_c_action=ajouter&vf_c_quoi=1&";
      vl_c_param+="vl_int_cleunik="+vf_e_int_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'favoris_supprimer':
      vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&";
      vl_c_param+="vl_int_cleunik="+vf_e_int_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_02,'');
      break;
    case 'dossier_ajouter':
    	fa_ouvre(c_fen_selection_dossiers,1000,800);
      break;
  }
}
function pf_action_fin_01(stream){
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("Interlocuteur d\'acteur ajouté à vos favoris.");} else {alert('Erreur lors de l\'ajout de l\'interlocuteur d\'acteur à vos favoris !!!');}
}
function pf_action_fin_02(stream){
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("Interlocuteur d\'acteur enlevé de vos favoris.");} else {alert('Erreur lors de la suppression de l\interlocuteur d\'acteur de vos favoris !!!');}
}
function pf_affiche_datas(stream){
/* **********  Affichage des données sur fiche interlocuteur ******** */
var vl_c_datas = stream;
vf_e_int_cleunik=fa_xml_get(vl_c_datas,'int_cleunik');
fa_value_set("tb_codealphanum15",fa_xml_get(vl_c_datas,'codealphanum15'));
fa_value_set("tb_patronyme",fa_xml_get(vl_c_datas,'patronyme'));
fa_value_set("tb_blocnotebrut",fa_xml_get(vl_c_datas,'blocnotebrut'));
fa_value_set("tb_prenom",fa_xml_get(vl_c_datas,'prenom'));
fa_value_set("tb_dateheuremodif",fa_xml_get(vl_c_datas,'dateheuremodif'));
fa_value_set("rdg_defaut",fa_xml_get(vl_c_datas,'infodefaut'));
fa_value_set("rdg_actif",fa_xml_get(vl_c_datas,'actif'));
fa_value_set("tb_dateheurevalidite",fa_xml_get(vl_c_datas,'dateheurevalidite'));
fa_mlsel("ml_civilites",fa_xml_get(vl_c_datas,'choix_cleunik'));
fa_mlsel("ml_fonctions",fa_xml_get(vl_c_datas,'fonction'));
var nb_coordonnes=fa_xml_get(vl_c_datas,'nb_coordonnes');
var nombre_actions=fa_xml_get(vl_c_datas,'nombre_actions');
var nb_criteres=fa_xml_get(vl_c_datas,'nb_criteres');
var nb_ged=fa_xml_get(vl_c_datas,'nb_ged');
var nb_adrpos=fa_xml_get(vl_c_datas,'nb_adrpos');
var nb_relations=fa_xml_get(vl_c_datas,'nb_relations');
if (nb_coordonnes!=0){fa_att_set("tab_coordonnees","label","$vl_c_baz_102 ("+fa_xml_get(vl_c_datas,'nb_coordonnes')+")");}
if (nombre_actions!=0){fa_att_set("tab_actions","label","$vl_c_baz_120 ("+fa_xml_get(vl_c_datas,'nombre_actions')+")");}
if (nb_criteres!=0){fa_att_set("tab_criteres","label","$vl_c_baz_103 ("+fa_xml_get(vl_c_datas,'nb_criteres')+")");}
if (nb_adrpos!=0){fa_att_set("tab_adresses_postales","label","$vl_c_baz_104 ("+fa_xml_get(vl_c_datas,'nb_adrpos')+")");}
if (nb_relations!=0){fa_att_set("tab_relations","label","$vl_c_baz_117 ("+fa_xml_get(vl_c_datas,'nb_relations')+")");}
if (nb_ged!=0){fa_att_set("tab_ged","label","$vl_c_baz_119 ("+fa_xml_get(vl_c_datas,'nb_ged')+")");}

vf_e_nombre_utilisations=fa_xml_get(vl_c_datas,'nombre_actions');

if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
if (vf_e_int_cleunik==0) {fa_grise_oui("bt_supprimer");fa_grise_oui("bt_modifier");}
}
function pf_affiche_donnees_adresses(){
  var vl_c_param;
  vl_c_param=vf_c_script_adrpost;
  vl_c_param+="vl_e_int_cleunik="+vf_e_int_cleunik+"&";
  vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
  vl_c_param+="raf_random="+Math.random()+"&vf_c_genre=A&'";
  fa_att_set("if_adressespostales","src",vl_c_param);
}
function pf_affiche_donnees_criteres_entreprise(){
  var vl_c_param;
  var raf_random=Math.random();
  vl_c_param=vf_c_script_critere_interlos_entreprise;
  vl_c_param+="int_cleunik="+vf_e_int_cleunik+"&";
  vl_c_param+="raf_random="+raf_random;
  fa_das("criteres_des_interlos_entreprise",vl_c_param);
}
function pf_affiche_donnees_criteres_lesautres(){
  var vl_c_param;
  var raf_random=Math.random();
  vl_c_param=vf_c_script_critere_interlos_lesautres;
  vl_c_param+="int_cleunik="+vf_e_int_cleunik+"&";
  vl_c_param+="raf_random="+raf_random;
  fa_das("criteres_des_interlos_lesautres",vl_c_param);
}
function pf_affiche_donnees_criteres_lesmiens(){
  var vl_c_param;
  var raf_random=Math.random();
  vl_c_param=vf_c_script_critere_interlos_lesmiens;
  vl_c_param+="int_cleunik="+vf_e_int_cleunik+"&";
  vl_c_param+="raf_random="+raf_random;
  fa_das("criteres_des_interlos_lesmiens",vl_c_param);
}
function pf_affiche_donnees_criteres_tous() {
  var vl_c_param=vf_c_script_critere_interlos_tous+"int_cleunik="+vf_e_int_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_interlos_tous",vl_c_param);
}
function pf_affiche_donnees_ged() {
  var vl_c_param=vf_c_script_ged+'vl_e_portee_cleunik='+vf_e_int_cleunik+'&raf_random='+Math.random()+'&';
  fa_das("arbre_des_ged",vl_c_param);
}
function pf_affiche_donnees_ged_actions() {
  var vl_c_param=vf_c_script_ged+'vl_e_portee_cleunik='+vf_e_int_cleunik+'&raf_random='+Math.random()+'&vl_e_tout=1&';
  fa_das("arbre_des_ged",vl_c_param);
}
function pf_affiche_donnees_interlo(){
  var vl_c_param;
  vl_c_param="vl_c_liste_act_cleunik="+$vl_e_act_cleunik+"&vl_c_liste_int_cleunik="+vf_e_int_cleunik+"&raf_random="+Math.random()+"&";
  fa_xmlhttprequest_xml(vf_c_script_interlo,vl_c_param,pf_alimente_arbre_interlos,'');
  if (window.opener!=null) {try {window.opener.pf_affiche_donnees_interlo();} catch(e){}}
}
function pf_affiche_donnees_relations(){
  var vl_c_param;
  vl_c_param=vf_c_script_relations+"vl_e_int_cleunik="+vf_e_int_cleunik+"&raf_random="+Math.random()+"&vf_c_genre=A&'";
  fa_das("arbre_relations",vl_c_param);
}
function pf_alimente_arbre_interlos(xml){
  fa_vide_arbre("fils_arbre_interlo");
  pf_parcours_fichier_xml_interlo(xml.documentElement,fa_gid("fils_arbre_interlo"));
}
function pf_alimente_defaut(){
  fa_att_set('ra_actif_oui','selected', 'true');
  fa_att_set('ra_defaut_non','selected', 'true');
  fa_gid("ml_civilites").selectedIndex=0;
}
function pf_cache_onglets(vv_quoi) {
  switch (vv_quoi) {
    case "non":
      fa_cache_non("tab_coordonnees");fa_cache_non("tab_criteres");fa_cache_non("tab_adresses_postales");fa_cache_non("tab_relations");fa_cache_non("tab_ged");fa_cache_non("tab_actions");
      break;
    case "oui":
      fa_cache_oui("tab_coordonnees");fa_cache_oui("tab_criteres");fa_cache_oui("tab_adresses_postales");fa_cache_oui("tab_relations");fa_cache_oui("tab_ged");fa_cache_oui("tab_actions");
      break;
  }
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      //fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
		  pf_grise_boutons_interlo();
		  pf_grise_boutons_interlo_ajout_non();
      fa_focusdonne("tb_prenom");
      break;
    case "ajouter":
      pf_cache_onglets("oui");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("ml_civilites");
      break;
    case "annuler":
      pf_raz_fiche();
      switch (vf_e_int_cleunik) {
        case "-1":  //  création
          pf_etat_fen("ajouter");
          break;
        default:
          pf_cache_onglets("non");
          pf_etat_fen("ini");
          pf_selectionne_interlo();
					//pf_etat_fen("modifier");
          break    
      }
    case "suite_creation":
      pf_raz_fiche();
      pf_cache_onglets("non");
      fa_grise_non("bt_sortir");
      pf_selectionne_interlo();
			fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
		  pf_grise_boutons_interlo();
		  pf_grise_boutons_interlo_ajout_non();
			fa_value_set("tabbox_01",1);
			fa_gid("tabbox_01").selectedIndex=1;
      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
}
function pf_ged_ajout(vv_quoi_01) {
  var vl_c_param='portee_cleunik='+vf_e_int_cleunik+'&doc_cleunik=-1&'
  switch (vv_quoi_01){
    case "ged_lien":
      fa_ouvre(vf_c_fen_pseudosliens+vl_c_param,800,300);
      break;
    case "ged_note":
      fa_ouvre(vf_c_fen_notes+vl_c_param,800,500);
      break;
    case "ged_doc":
			pf07_ouvre_doc("quelsdocs=undoc_interl&genre=interl&"+vl_c_param);
      break;
  }
}
function pf_grise_boutons_interlo_ajout_non(){
  fa_grise_non("tb_tel_01");//  On peut ajouter un téléphone
  fa_grise_non("tb_fax_01");//  on peut ajouter un fax
  fa_grise_non("tb_courriel_01");//  on peut ajouter un courriel
	fa_grise_non("tb_mesinst_01");
}
function pf_grise_boutons_interlo(){
  fa_grise_oui("tb_tel_01");fa_grise_oui("tb_tel_02");fa_grise_oui("tb_tel_03");fa_grise_oui("tb_tel_04");
  fa_grise_oui("tb_fax_01");fa_grise_oui("tb_fax_02");fa_grise_oui("tb_fax_03");
  fa_grise_oui("tb_courriel_01");fa_grise_oui("tb_courriel_02");fa_grise_oui("tb_courriel_03");fa_grise_oui("tb_courriel_04");
  fa_grise_oui("tb_chat_01");
  fa_grise_oui("tb_mesinst_01");fa_grise_oui("tb_mesinst_02");
	if (vf_e_int_cleunik!=-1){
	  pf_grise_boutons_interlo_ajout_non();
	}
}
function pf_ouvre(vv_quoi_01,vv_quoi_02){
  var vl_c_param,rowIndex;
  vl_c_param="genreacteur=$vl_c_genreacteur&";
  switch (vv_quoi_01) {
    case "chat":
      switch (vv_quoi_02) {
        case "nouveau":
          pf04_emichat(vf_e_int_cleunik);
          break;
      }
      break;
    case "critere_entreprise":
      vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
      vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
      vl_c_param+='genrecritere=entreprise&';
      vl_c_param+='vl_c_raisonsoc='+fa_enc(fa_value_get("tb_raisonsoc"))+"&";
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "critere_lesmiens":
      vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
      vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
      vl_c_param+='genrecritere=moi&';
      vl_c_param+='vl_c_raisonsoc='+fa_enc(fa_value_get("tb_raisonsoc"))+"&";
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "relation":
      switch (vv_quoi_02){
        case "nouveau":
          vl_c_param+='vl_e_int_cleunik_gauche='+vf_e_int_cleunik+'&';
          fa_ouvre(vf_c_fen_interlo_relations+vl_c_param,800,450);
          break;
        case "ouvrir":
          var i=fa_cui("arbre_relations");if(i==-1){return;}
          vf_e_int_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_int_cleunik_droite");  //  Clé unique interlocuteur droite
          vf_e_int_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_int_cleunik_gauche");  //  Clé unique interlocuteur gauche
          vf_e_choix_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_droite");  //  Clé unique du choix de la relation
          vf_e_choix_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_gauche");  //  Clé unique du choix de la relation
          vl_c_param+='vl_e_int_cleunik_droite='+vf_e_int_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_droite='+vf_e_choix_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_gauche='+vf_e_choix_cleunik_gauche+'&';
          vl_c_param+='vl_e_int_cleunik_gauche='+vf_e_int_cleunik_gauche+'&';
          fa_ouvre(vf_c_fen_interlo_relations_fiche+vl_c_param,600,250);
          break;
      }
      break;
    case "adresse":
      switch (vv_quoi_02){
        case "nouveau":
          vl_c_param+='vl_e_adr_cleunik=-1&';
          vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
          vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
          break;
        case "ouvrir":
          vl_c_param+='vl_e_adr_cleunik='+fa_enc(vf_e_adr_cleunik)+"&";
          vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
          vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
          break;
      }
      fa_ouvre(vf_c_fen_interlo_adrp+vl_c_param,600,260);
      break;
    case "adres02":
      switch (vv_quoi_02){
        case "nouveau":
          vl_c_param+='vl_e_adr_cleunik=-1&';
          vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
          vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
          break;
        case "ouvrir":
          vl_c_param+='vl_e_adr_cleunik='+fa_enc(vf_e_adr_cleunik)+"&";
          vl_c_param+="vl_e_act_cleunik=$vl_e_act_cleunik&";
          vl_c_param+='vl_e_int_cleunik='+vf_e_int_cleunik+'&';
          break;
      }
      fa_ouvre(vf_c_fen_interlo_adrp_02+vl_c_param,600,260);
      break;
    case "courriel":
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_intweb_cleunik=-1&';
          vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vf_e_int_cleunik)+"&";
          fa_ouvre(vf_c_fen_interlo_mail+vl_c_param,700,600)
          break;
        case "ouvrir":
          vl_c_param+='vl_e_intweb_cleunik='+fa_enc(vf_e_courriel_cleunik)+"&";
		  fa_ouvre(vf_c_fen_interlo_mail+vl_c_param,700,600)
          break;
        case "envoyer_texte":
          pf04_emimail_texte(vf_e_courriel_cleunik);
          break;
        case "envoyer_html":
          pf04_emimail_html(vf_e_courriel_cleunik);
          break;
      }
      break;
    case "fax":
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_tel_cleunik=-1&';
          vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vf_e_int_cleunik)+"&";
          break;
        case "ouvrir":
          vl_c_param+='vl_e_intel_cleunik='+fa_enc(vf_e_intel_cleunik)+"&";
          break;
      }
      fa_ouvre(vf_c_fen_interlo_fax+vl_c_param,400,400);
      break;
    case "mesinst":
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_mesinst_cleunik=-1&vl_e_interlo_cleunik='+fa_enc(vf_e_int_cleunik)+"&";
          fa_ouvre(vf_c_fen_interlo_mesinst+vl_c_param,600,600);
          break;
        case "ouvrir":
          vl_c_param+='vl_e_mesinst_cleunik='+fa_enc(vf_e_mesinst_cleunik)+"&";
          fa_ouvre(vf_c_fen_interlo_mesinst+vl_c_param,600,350);
          break;
      }
      break;
    case "telephone":
      switch (vv_quoi_02) {
        case "telephoner":
          pf04_emitel($vl_e_act_cleunik,vf_e_int_cleunik,0,'raf',0);          
          return;
          break;
        case "nouveau":
          vl_c_param+='vl_e_tel_cleunik=-1&';
          vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vf_e_int_cleunik)+"&";
          break;
        case "ouvrir":
          vl_c_param+='vl_e_intel_cleunik='+fa_enc(vf_e_intel_cleunik)+"&";
          break;
        default : return;
      }
      fa_ouvre(vf_c_fen_interlo_tel+vl_c_param,500,480);
      break;
  }
}
function pf_parcours_fichier_xml_interlo(noeudxml,xulnode){
  var treeItem = fa_crexul("treeitem");
  var treeRow  = fa_crexul("treerow");
  var treeCell_01 = fa_crexul("treecell");
  var treeCell_02 = fa_crexul("treecell");
	var treeCell_03 = fa_crexul("treecell");
  treeCell_01.setAttribute("label",noeudxml.getAttribute("label"));
  treeCell_01.setAttribute("properties",noeudxml.getAttribute("properties"));
  treeCell_01.setAttribute("value",noeudxml.getAttribute("_graal_genre"));
	treeCell_02.setAttribute("value",noeudxml.getAttribute("_graal_cleunik"));
	treeCell_02.setAttribute("label",noeudxml.getAttribute("_graal_genre"));
	treeCell_03.setAttribute("value",noeudxml.getAttribute("_graal_int_cleunik"));
  treeRow.setAttribute("tooltiptext",noeudxml.getAttribute("label"));
  treeRow.appendChild(treeCell_01);
  treeRow.appendChild(treeCell_02);
  treeRow.appendChild(treeCell_03);	
  treeItem.appendChild(treeRow);
  xulnode.appendChild(treeItem);                                                       
  if(noeudxml.hasChildNodes){                                                           /* encore des noeuds à lire ?*/
    for(var i=0;i<noeudxml.childNodes.length;i++){                                      /* bouclons */
      if(noeudxml.childNodes[i].nodeType==1){                                           /* On ne lit que les éléments */
        if(!fa_est_conteneur(treeItem)){ fa_nouvelle_branche(treeItem); }               /* Il y a des enfants, on crèe une nouvelle branche */
        pf_parcours_fichier_xml_interlo(noeudxml.childNodes[i],treeItem.childNodes[1]); /* parcours récursif */
      }
    }
  }
}
function pf_raz_fiche(){
  fa_value_set("tb_codealphanum15","");
  fa_value_set("tb_patronyme","");
  fa_value_set("tb_blocnotebrut","");
  fa_value_set("tb_prenom","");
  fa_value_set("tb_dateheuremodif","");
  fa_value_set("tb_dateheurevalidite","");
  fa_att_rem('ra_actif_oui','selected');
  fa_att_rem('ra_defaut_oui','selected');
  fa_att_rem('ra_actif_non','selected');
  fa_att_rem('ra_defaut_non','selected');
	fa_att_set("tab_coordonnees","label","$vl_c_baz_102");
	fa_att_set("tab_actions","label","$vl_c_baz_120");
	fa_att_set("tab_criteres","label","$vl_c_baz_103");
	fa_att_set("tab_adresses_postales","label","$vl_c_baz_104");
	fa_att_set("tab_relations","label","$vl_c_baz_117");
	fa_att_set("tab_ged","label","$vl_c_baz_119");
  pf_affiche_donnees_criteres_entreprise();pf_affiche_donnees_criteres_lesautres();pf_affiche_donnees_criteres_lesmiens();
}
function pf_retour_fenetre_dossiers(vv_t_tableau_cleunik) {
  var vl_e_nb_sel=vv_t_tableau_cleunik.length;
  if (vl_e_nb_sel!=0) {
	for(var i=0;i<vl_e_nb_sel;i++){                      /* loop 'em */
      var vl_c_donnees=vv_t_tableau_cleunik[i]+"&cleunik_insertion_dossier="+fa_enc(vf_e_int_cleunik)+"&label_insertion_dossier="+fa_enc(fa_value_get("tb_prenom")+" "+fa_value_get("tb_patronyme"));
      fa_xmlhttprequest_txt(c_bdope_dossiers+vl_c_donnees,"",pf_retour_fenetre_dossiers_fin);
    }
  }
}
function pf_retour_fenetre_dossiers_fin(stream){
	alert(stream)
}
function pf_sel_arbre_adresses(){
  var rowIndex = tree_adrpost.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_adr_cleunik=tree_adrpost.view.getCellText( rowIndex ,tree_adrpost.columns.getNamedColumn("adr_cleunik"));  //  Clé unique adresse postale
}
function pf_sel_arbre_ged() {}
function pf_sel_arbre_interlo(){
  pf_grise_boutons_interlo();
  var i=fa_cui("arbre_interlo");if(i==-1){return;}
  var vl_c_genre=fa_cell_val("arbre_interlo",i,"arbre_interlo_col01") //  Genre
	fa_grise_non("tb_chat_01");// On peut chatter
  switch (vl_c_genre) {
    case "": return;break;
    case "0": // Acteurs
      break;
    case "1": // Interlocuteurs
      fa_grise_non("tb_tel_01");//  On peut ajouter un téléphone
      fa_grise_non("tb_fax_01");//  on peut ajouter un fax
      fa_grise_non("tb_courriel_01");//  on peut ajouter un courriel
			fa_grise_non("tb_mesinst_01");
      break;
    case "2": // Téléphones
      fa_grise_non("tb_tel_02");//  on peut modifier un téléphone
      fa_grise_non("tb_tel_03");//  on peut téléphoner (à développer)
      fa_grise_non("tb_tel_04");//  on peut envoyer un SMS (à développer)
      vf_e_intel_cleunik=fa_cell_val("arbre_interlo",i,"arbre_interlo_col02"); //  cleunik
      break;
    case "3": // Fax
      fa_grise_non("tb_fax_02");//  on peut modifier un fax
      fa_grise_non("tb_fax_03");//  on peut faxer ( à développer)
      vf_e_intel_cleunik=fa_cell_val("arbre_interlo",i,"arbre_interlo_col02"); //  cleunik
      break;
    case "4": // Courriels
      fa_grise_non("tb_courriel_02");//  on peut modifier un courriel
      fa_grise_non("tb_courriel_03");//  on peut envoyer un courriel texte (si on a un compte)
      fa_grise_non("tb_courriel_04");//  on peut envoyer un courriel html (si on a un compte)
      vf_e_courriel_cleunik=fa_cell_val("arbre_interlo",i,"arbre_interlo_col02"); //  cleunik
      break;
    case "5": // Messagerie instantanée
      fa_grise_non("tb_mesinst_02");//  on peut modifier un identifiant de messagerie instantané
      vf_e_mesinst_cleunik=fa_cell_val("arbre_interlo",i,"arbre_interlo_col02"); //  cleunik
      break;
  }
}
function pf_sel_arbre_relations(){
  var i=fa_cui("arbre_relations");if(i==-1){return;}
  vf_e_int_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_int_cleunik_droite");  //  Clé unique interlocuteur droite
  vf_e_int_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_int_cleunik_gauche");  //  Clé unique interlocuteur gauche
  vf_e_choix_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_droite");  //  Clé unique du choix de la relation
  vf_e_choix_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_gauche");  //  Clé unique du choix de la relation
}
function pf_selectionne_interlo(){
  var s ="vl_e_int_cleunik="+vf_e_int_cleunik+"&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
  pf_approximatif_bem();
  pf_affiche_donnees_interlo();
  pf_affiche_donnees_adresses();
  pf_affiche_donnees_relations();
  pf_affiche_donnees_criteres_entreprise();pf_affiche_donnees_criteres_lesautres();pf_affiche_donnees_criteres_lesmiens();pf_affiche_donnees_criteres_tous();
  pf_affiche_donnees_ged();
}
function pf_sel_ligne(){
//  rien mais nécessaire pour etre propre sur sélection ligne table relation
}
function pf_telecharge(){
	pf07_telecharge();
}
function pf_validation(vv_quoi) {
  var vl_c_donnees,vl_c_actif,vl_c_defaut;
  vl_c_actif=fa_value_get('rdg_actif');
  if (vl_c_actif=='') {vl_c_actif=1};
  vl_c_defaut=fa_value_get('rdg_defaut');
  if (vl_c_defaut=='') {vl_c_defaut=1};
  vl_c_donnees="";
  vl_c_donnees+="vl_int_cleunik="+fa_enc(vf_e_int_cleunik)+"&";
  vl_c_donnees+="vl_act_cleunik=$vl_e_act_cleunik&";
  vl_c_donnees+="vl_c_genreacteur=$vl_c_genreacteur&"
  vl_c_donnees+="vl_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15"))+"&";
  vl_c_donnees+="vl_patronyme="+fa_enc(fa_value_get("tb_patronyme"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_prenom="+fa_enc(fa_value_get("tb_prenom"))+"&";
  vl_c_donnees+="vl_dateheurevalidite="+fa_enc(fa_value_get("tb_dateheurevalidite"))+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_civilites"))+"&";
  vl_c_donnees+="vl_infodefaut="+fa_enc(vl_c_defaut)+"&";
  vl_c_donnees+="vl_actif="+fa_enc(vl_c_actif)+"&";
  vl_c_donnees+="vl_fonction="+fa_enc(fa_mlget("ml_fonctions"))+"&";
  switch(vv_quoi){
    case "enregistrer":
      if (vf_e_int_cleunik!=-1)
        {vl_c_donnees+="vf_c_action=modifier&";vf_c_action='modification';}
      else
        {vl_c_donnees+="vf_c_action=ajouter&";vf_c_action='ajout';}
      break;
    case "supprimer":
        Check = confirm("$vl_c_baz_123js");
        if(Check == false) return;
        vl_c_donnees+="vf_c_action=supprimer&";vf_c_action='suppression';
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}
function pf_validation_fin(stream){
  var vl_datas = stream;
  if (vl_datas!="-1") {
    if (window.opener!=null) {try {window.opener.pf_affiche_donnees_interlo();} catch(e){}}
    switch (vf_c_action) {
      case "ajout":
        vf_e_int_cleunik=vl_datas;
        pf_etat_fen("suite_creation");
        break;
      case "modification":
        pf_etat_fen("annuler");
        break;
      case "suppression":
        alert("Interlocuteur supprimé.")
        pf_etat_fen("sortir");
        break;
    }
  } 
  else {
    alert(vl_datas);
    pf_etat_fen("annuler");
    }
}
  
  
]]></script>
END;
?>
