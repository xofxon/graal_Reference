<?php
$vl_c_00002=fa_recup_session('mess_00002','');
$js_c_aaj_157="";$js_c_aaj_157="Fenêtre des Post it ©";
if ($vl_b_modif==true) {$pf_acces_id="function pf_acces_id() {
  var vl_uti_cleunik=fa_att_get('tb_codealphanum15','_graal_cleunik');
  if (vl_uti_cleunik==-1) {return;}
  var param='vf_qui='+vl_uti_cleunik+'&';
  fa_ouvre('_graal_fen_modif_idcon_01.php?'+param,500,120);
}
";}
$pf_init_01="";
$pf_ouvre_01="";
$pf_ouvre_02="";
$pf_ouvre_03="";
$pf_ouvre_04="";
$pf_ouvre_05="";
if ($vl_c_qui!="eux") {   
  $pf_init_01=<<<EOT
  var s ="uti_cleunik=$vl_e_uti_cleunik&";
  fa_ael("aaq_tb_limit","input",pf_approximatif);
  fa_xmlhttprequest_xml(vf_c_script_edite,s,aaj_pa_affiche_datas);
  pf_etat_fen("modifier");
EOT;
if ($vl_tb_droits_comptes_courriels[0]==true) {
$pf_ouvre_01=<<<EOT
  function pf_ouvre_mes_comptes_courriels() {
    fa_ouvre('_graal_fen_comptes_courriels.php?qui=moi');
  }
EOT;
}
$pf_ouvre_02=<<<EOT
  function pf_ouvre_mes_libelles() {
    alert("Fonction en développement. Merci de votre patience ...")
  }
EOT;
if ($vl_tb_droits_menus[0]==true) {
$pf_ouvre_03=<<<EOT
  function pf_ouvre_mes_menus() {
    fa_ouvre('_graal_fen_utilisateurs_menu_01.php');
  }
  function pf_ouvre_mes_menus_pages() {
    fa_ouvre('_graal_fen_utilisateurs_menu_02.php');
  }
EOT;
}
if ($vl_tb_droits_comptes_fax[0]==true) {
$pf_ouvre_04=<<<EOT
  function pf_ouvre_mes_comptes_fax() {
    fa_ouvre('_graal_fen_comptes_fax.php?qui=moi');
  }
EOT;
}
if ($vl_tb_droits_comptes_sms[0]==true) {
$pf_ouvre_05=<<<EOT
  function pf_ouvre_mes_comptes_sms() {
    fa_ouvre('_graal_fen_comptes_sms.php?qui=moi');
  }
EOT;
}
} else {
if ($vl_tb_droits_comptes_courriels[0]==true) {
$pf_ouvre_01=<<<EOT
  function pf_ouvre_mes_comptes_courriels() {
    fa_ouvre('_graal_fen_comptes_courriels.php?qui=lui&vl_e_uti_cleunik='+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&");
  }
EOT;
}
$pf_ouvre_02=<<<EOT
  function pf_ouvre_mes_libelles() {
    alert("Fonction en développement. Merci de votre patience ...")
  }
EOT;
if ($vl_tb_droits_menus[0]==true) {
$pf_ouvre_03=<<<EOT
  function pf_ouvre_mes_menus() {
    fa_ouvre('_graal_fen_utilisateurs_menu_01.php?qui=lui&vl_e_uti_cleunik='+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&");
  }
  function pf_ouvre_mes_menus_pages() {
    fa_ouvre('_graal_fen_utilisateurs_menu_02.php?qui=lui&vl_e_uti_cleunik='+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&");
  }
EOT;
}
if ($vl_tb_droits_comptes_fax[0]==true) {
$pf_ouvre_04=<<<EOT
  function pf_ouvre_mes_comptes_fax() {
    fa_ouvre('_graal_fen_comptes_fax.php?qui=lui&vl_e_uti_cleunik='+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&");
  }
EOT;
}
if ($vl_tb_droits_comptes_sms[0]==true) {
$pf_ouvre_05=<<<EOT
  function pf_ouvre_mes_comptes_sms() {
    fa_ouvre('_graal_fen_comptes_sms.php?qui=moi');
  }
EOT;
}
	
	
}

if ($vl_tb_droits_onglet_admin[0]==true) {
  $valid_js_01=<<<EOT
	s+="admin=ok&"
	s+="gesdoc_ml_zone="+fa_enc(fa_value_get("gesdoc_ml_zone"))+"&";
	s+="gesacteurs_ml_zone="+fa_enc(fa_value_get("gesacteurs_ml_zone"))+"&";
	s+="gesinterlo_ml_zone="+fa_enc(fa_value_get("gesinterlo_ml_zone"))+"&";
	s+="gesactions_ml_zone="+fa_enc(fa_value_get("gesactions_ml_zone"))+"&";
	s+="aut_admin="+fa_enc(fa_value_get("rdg_admin"))+"&";
	s+="aut_crypte_docs="+fa_enc(fa_value_get("rdg_crypte_docs"))+"&";
EOT;
}

echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_action;
const vf_c_script_bdope='_graal_bdope_utilisateurs_01.php';
const vf_c_script_edite='_graal_xml_utilisateurs_01.php?';
const vf_c_script_edite_note='_graal_xml_doc_02.php';
const vf_c_script_alim_table01='_graal_das_utilisateurs_01.php';
const c_script_choix_interlo='_graal_fen_rech_interlocuteurs_01.php?p02=Fen_00046&';
const c_script_das_connexions="_graal_das_connexions_01.php?uti_cleunik=";
const c_fen_selection_notes="_graal_fen_ged_01.php?genreged=tousss&quelsdocs=notes&retour=oui&";
var vf_b_deja_arbre_des_connexions=false;
$pf_acces_id
function pf_action(vv_quoi) {
	fa_ouvre(c_script_choix_interlo+"genreacteur="+vv_quoi+"&",800,600);
}
function pf_alimente_defaut() {
  fa_att_set('ra_actif_oui','selected', 'true');
}
function pf_alimente_table() {
  fa_das("arbre_des_utilisateurs",vf_c_script_alim_table01+'?&raf01='+Math.random());
}
function pf_approximatif() {
	if (vf_b_deja_arbre_des_connexions==false) {
	  var vl_c_url_alimente_table=c_script_das_connexions+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&vl_e_limit="+fa_value_get("aaq_tb_limit")+"&raf="+Math.random()+"&";
	  vl_c_url_alimente_table+='vl_c_quelleplage=debut&vl_c_dateheuredebut='+fa_enc(fa_date_formate(fa_value_get("bem_tb_deb"),"AAAAMMJJ"))+'&vl_c_dateheurefin='+fa_enc(fa_date_formate(fa_value_get("bem_tb_fin"),"AAAAMMJJ"));
	  fa_das("arbre_des_connexions",vl_c_url_alimente_table);
		vf_b_deja_arbre_des_connexions=true;
	}
}
function pf_cache_tab(){
  var vl_tab=fa_gid("aaj_utilisateurs_01");
  if(vl_tab.collapsed == true){vl_tab.collapsed=false;}else {vl_tab.collapsed=true;}
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      pf_alimente_table();
      fa_att_rem("bem_tb_deb","observes");
      fa_att_rem("bem_tb_fin","observes");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      pf_raz_fiche();
      fa_grise_groupe_oui('broadcaster_01');
      fa_check("-me_tb_deb_21");
      fa_value_set("bem_tb_deb",c_date_defaut_deb);
      fa_value_set("bem_tb_fin",c_date_defaut_fin);
      $pf_init_01
      break;
    case "selectionner":
      var rowIndex = fa_cui("arbre_des_utilisateurs");if(rowIndex == -1){return;}
      if (fa_att_get("tb_codealphanum15","_graal_cleunik")!=0) {fa_grise_non("bt_supprimer")};
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_oui('tb_motdepasse');
      fa_grise_groupe_non('broadcaster_01');
      fa_grise_oui("tb_identifiant");fa_grise_oui("tb_motdepasse");
      fa_focusdonne('tb_codealphanum15');
      break;
    case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_grise_oui('modif_id');
      fa_focusdonne('tb_codealphanum15');
      break;
    case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      fa_grise_non('tb_motdepasse');
      pf_raz_fiche();
      fa_grise_groupe_oui('broadcaster_01');
      $pf_init_01
      break;
    case "sortir":
     window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
     break;   
}
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=='ok') {pf_alimente_table();}else{fa_erreur(vl_datas)}
  pf_etat_fen('annuler');
}
function pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui,vl_act_cleunik,vl_raisonsoc,vl_portee) {
  fa_value_set("tb_interlo",vl_qui);
  fa_att_set("tb_interlo","_graal_cleunik",vl_int_cleunik);
}
$pf_ouvre_01
$pf_ouvre_02
$pf_ouvre_03
$pf_ouvre_04
$pf_ouvre_05
function pf_ouvre_selection_note(vv_quoi) {
	switch (vv_quoi) {
		case "ged":
		  fa_ouvre(c_fen_selection_notes);
			break;
		case "def":
			fa_att_set("tb_page_accueil","_graal_cleunik",0);
			fa_value_set("tb_page_accueil","Page par défaut");
			break;
		case "pos":
			fa_att_set("tb_page_accueil","_graal_cleunik",'post_it');
			fa_value_set("tb_page_accueil","$js_c_aaj_157");
			break;	
	}

}
function pf_raz_fiche(){
  fa_att_set("tb_codealphanum15","_graal_cleunik","-1");
  fa_value_set("tb_uuid","");
  fa_value_set("tb_prenom","");
  fa_value_set("tb_patronyme","");
  fa_value_set("tb_codealphanum15","");
  fa_value_set("la_dateheurevalidite","");
  fa_value_set("la_borne_mini","");
  fa_value_set("la_borne_maxi","");
  fa_value_set("tb_identifiant","");
  fa_value_set("tb_motdepasse","");
  fa_value_set("tb_blocnotebrut","");
  fa_value_set("tb_interlo","");
	fa_value_set("ml_genre",2);
  fa_att_set("tb_interlo","_graal_cleunik",0);
  fa_att_rem('ra_actif_oui','selected');
  fa_att_rem('ra_actif_non','selected');
	vf_b_deja_arbre_des_connexions=false;
}
function pf_retour_fenetre_notes(vv_t_tableau_cleunik) {
  vl_e_nb_sel=vv_t_tableau_cleunik.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      pf_retour_fenetre_notes_suite(vv_t_tableau_cleunik[i]);
    }
  }
}
function pf_retour_fenetre_notes_suite(vv_doc_cleunik) {
	fa_xmlhttprequest_xml(vf_c_script_edite_note,"vl_e_doc_cleunik="+vv_doc_cleunik,pf_retour_fenetre_notes_fin);
}
function pf_retour_fenetre_notes_fin(stream){
	var vl_c_datas = stream;
  fa_value_set("tb_page_accueil",fa_xml_get(vl_c_datas,'titre'));
	fa_att_set("tb_page_accueil","_graal_cleunik",fa_xml_get(vl_c_datas,'doc_cleunik'));
}
function pf_selectionne_couleur(vv_qui){
	switch (vv_qui) {
		case "cp_focus_background_color":
		  fa_value_set("tb_focus_background_color",fa_gid("cp_focus_background_color").color);
		  fa_gid("tb_focus_background_color").inputField.style.backgroundColor=fa_gid("cp_focus_background_color").color;
			break;
		case "cp_focus_color":
		  fa_value_set("tb_focus_color",fa_gid("cp_focus_color").color);
		  fa_gid("tb_focus_color").inputField.style.backgroundColor=fa_gid("cp_focus_color").color;
			break;
		case "cp_window_background_color":
		  fa_value_set("tb_window_background_color",fa_gid("cp_window_background_color").color);
		  fa_gid("tb_window_background_color").inputField.style.backgroundColor=fa_gid("cp_window_background_color").color;
			break;
		case "cp_table_ligne_paire_color":
		  fa_value_set("tb_table_ligne_paire_color",fa_gid("cp_table_ligne_paire_color").color);
		  fa_gid("tb_table_ligne_paire_color").inputField.style.backgroundColor=fa_gid("cp_table_ligne_paire_color").color;
			break;
		case "cp_table_ligne_impaire_color":
		  fa_value_set("tb_table_ligne_impaire_color",fa_gid("cp_table_ligne_impaire_color").color);
		  fa_gid("tb_table_ligne_impaire_color").inputField.style.backgroundColor=fa_gid("cp_table_ligne_impaire_color").color;
			break;
		case "cp_table_ligne_selectionnee_color":
		  fa_value_set("tb_table_ligne_selectionnee_color",fa_gid("cp_table_ligne_selectionnee_color").color);
		  fa_gid("tb_table_ligne_selectionnee_color").inputField.style.backgroundColor=fa_gid("cp_table_ligne_selectionnee_color").color;
			break;			
	}
}
function pf_sel_ligne() {
  if(fa_est_grise("bt_detailler")==true){return};
  var rowIndex = fa_cui("arbre_des_utilisateurs");if(rowIndex == -1){return;}
  var s ="uti_cleunik="+fa_enc(fa_cell_get("arbre_des_utilisateurs",rowIndex,"uti_cleunik"))+"&";
  pf_raz_fiche()
  fa_xmlhttprequest_xml(vf_c_script_edite,s,aaj_pa_affiche_datas);
}
function pf_validation(vv_quoi){
  var s="";
  switch(vv_quoi) {
     case "enregistrer":
      s+="vl_e_int_cleunik="+fa_enc(fa_att_get("tb_interlo","_graal_cleunik"))+"&";
      s+="vl_e_langue_cleunik="+fa_mlget("ml_langue")+"&";
      s+="vl_e_uti_cleunik="+fa_att_get("tb_codealphanum15","_graal_cleunik")+"&";
      s+="vl_c_prenom="+fa_enc(fa_value_get("tb_prenom"))+"&";
      s+="vl_c_patronyme="+fa_enc(fa_value_get("tb_patronyme"))+"&";
      s+="vl_c_codealphanum15="+fa_enc(fa_value_get("tb_codealphanum15"))+"&";
      s+="vl_dh_dateheurevalidite="+fa_enc(fa_value_get("la_dateheurevalidite"))+"&";
      s+="vl_e_borne_mini="+fa_enc(fa_value_get("la_borne_mini"))+"&";
      s+="vl_e_borne_maxi="+fa_enc(fa_value_get("la_borne_maxi"))+"&";
      s+="vl_c_identifiant="+fa_enc(fa_value_get("tb_identifiant"))+"&";
      s+="vl_c_motdepasse="+fa_enc(fa_value_get("tb_motdepasse"))+"&";
      s+="vl_c_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
			s+="vl_c_genre="+fa_enc(fa_value_get("ml_genre"))+"&";
      s+="vl_c_css="+fa_enc(fa_mlget("ml_css","value"))+"&";
      s+="vl_c_focus_background_color="+fa_enc(fa_value_get("tb_focus_background_color"))+"&";
      s+="vl_c_focus_color="+fa_enc(fa_value_get("tb_focus_color"))+"&";
			s+="vl_c_window_background_color="+fa_enc(fa_value_get("tb_window_background_color"))+"&";
      s+="vl_c_actif="+fa_enc(fa_value_get('rdg_actif'))+"&";
      s+="vl_selection_article="+fa_enc(fa_mlget("selart_ml_zone","value"))+"&";
      s+="vl_selection_acteur="+fa_enc(fa_mlget("selact_ml_zone","value"))+"&";
      
			s+="vl_police_generale="+fa_enc(fa_mlget("ml_police_generale","value"))+"&";
			s+="vl_c_table_ligne_selectionnee_color="+fa_enc(fa_value_get("tb_table_ligne_paire_color"))+"&";			
			s+="vl_c_table_ligne_impaire_color="+fa_enc(fa_value_get("tb_table_ligne_impaire_color"))+"&";			
			s+="vl_c_table_ligne_paire_color="+fa_enc(fa_value_get("tb_table_ligne_paire_color"))+"&";			

			s+="vl_selection_interlocuteur="+fa_enc(fa_mlget("selint_ml_zone","value"))+"&";
			s+="vl_selection_telephone="+fa_enc(fa_mlget("seltel_ml_zone","value"))+"&";
			s+="vl_selection_fax="+fa_enc(fa_mlget("selfax_ml_zone","value"))+"&";
			s+="vl_selection_courriel="+fa_enc(fa_mlget("selmel_ml_zone","value"))+"&";
			s+="vl_selection_postale="+fa_enc(fa_mlget("selpos_ml_zone","value"))+"&";
			s+="vl_selection_geophysique="+fa_enc(fa_mlget("selgeo_ml_zone","value"))+"&";
			s+="vl_selection_site="+fa_enc(fa_mlget("selweb_ml_zone","value"))+"&";
			s+="vl_selection_note="+fa_enc(fa_mlget("selnot_ml_zone","value"))+"&";
			s+="vl_selection_document="+fa_enc(fa_mlget("seldoc_ml_zone","value"))+"&";
			s+="vl_selection_pseudodocument="+fa_enc(fa_mlget("sellie_ml_zone","value"))+"&";
			s+="vl_c_activite_background_color="+fa_enc(fa_value_get("tb_activite_background_color"))+"&";	
			s+="vl_page_accueil="+fa_att_get("tb_page_accueil","_graal_cleunik")+"&";
			
      s+="vl_selart_nbcaracrech="+fa_enc(fa_value_get("tb_selart_nbcaracrech"))+"&";
      s+="vl_selact_nbcaracrech="+fa_enc(fa_value_get("tb_selact_nbcaracrech"))+"&";
			s+="vl_selint_nbcaracrech="+fa_enc(fa_value_get("tb_selint_nbcaracrech"))+"&";
			s+="vl_seltel_nbcaracrech="+fa_enc(fa_value_get("tb_seltel_nbcaracrech"))+"&";
			s+="vl_selfax_nbcaracrech="+fa_enc(fa_value_get("tb_selfax_nbcaracrech"))+"&";
			s+="vl_selmel_nbcaracrech="+fa_enc(fa_value_get("tb_selmel_nbcaracrech"))+"&";
			s+="vl_selpos_nbcaracrech="+fa_enc(fa_value_get("tb_selpos_nbcaracrech"))+"&";
			s+="vl_selgeo_nbcaracrech="+fa_enc(fa_value_get("tb_selgeo_nbcaracrech"))+"&";
			s+="vl_selweb_nbcaracrech="+fa_enc(fa_value_get("tb_selweb_nbcaracrech"))+"&";
			s+="vl_selnot_nbcaracrech="+fa_enc(fa_value_get("tb_selnot_nbcaracrech"))+"&";
			s+="vl_seldoc_nbcaracrech="+fa_enc(fa_value_get("tb_seldoc_nbcaracrech"))+"&";
			s+="vl_sellie_nbcaracrech="+fa_enc(fa_value_get("tb_sellie_nbcaracrech"))+"&";
			s+="vl_modele_recherche_articles="+fa_enc(fa_value_get("ml_modele_recherche_articles"))+"&";
			s+="vl_selaction_nbcaracrech="+fa_enc(fa_value_get("tb_selaction_nbcaracrech"))+"&";
			s+="vl_selection_action="+fa_enc(fa_value_get("selaction_ml_zone"))+"&";
			s+="vl_selection_action_fenetre="+fa_enc(fa_value_get("selaction_ml_fenetre"))+"&";
			$valid_js_01
      if (fa_att_get("tb_codealphanum15","_graal_cleunik")!=-1) {
        s+="vl_c_action=modifier&";
      } else {
        s+="vl_c_action=ajouter&";
      }
      break;
     case "supprimer":
       if(confirm("$vl_c_00002") == false) return;
       s =fa_enc("vl_c_action")+"="+fa_enc('supprimer')+"&";
       s+=fa_enc("vl_e_uti_cleunik")+"="+fa_enc(fa_att_get("tb_codealphanum15","_graal_cleunik"));
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope,s,pf_fin_requete);
}
]]></script>
END;
?>
