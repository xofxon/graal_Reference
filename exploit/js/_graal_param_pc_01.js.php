<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_url_alimente_table_01="_graal_das_param_pc_01.php";
const _c_script_edite="_graal_xml_param_pc_01.php?";
const _c_script_bdope_fen="_graal_bdope_param_pc_01.php";
var vf_c_donnees_validation,vf_c_action,vf_c_url_alimente_table;
const lstn_grise_saisie= { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");} 
};

function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui('broadcaster_01');
  fa_badl("arbre_param_pc",lstn_grise_saisie);
  pf_raz_fiche();
  pf_approximatif();
}
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  vf_e_utilisations=fa_xml_get(vl_c_datas,"utilisations");
  vf_pc_cleunik=fa_xml_get(vl_c_datas,"pc_cleunik");
  fa_value_set("tb_code",fa_xml_get(vl_c_datas,"code"));
  fa_value_set("tb_intitule",fa_xml_get(vl_c_datas,"intitule"));
  fa_value_set("tb_dateheuremodification",fa_xml_get(vl_c_datas,"dateheuremodification"));
  fa_value_set("tb_dateheurecreation",fa_xml_get(vl_c_datas,"dateheurecreation"));
  fa_value_set("rdg_compte_actif",fa_xml_get(vl_c_datas,"actif"));
}
function pf_alimente_defaut(){
  fa_value_set("tb_code","");
  fa_value_set("tb_intitule","");
  fa_value_set("tb_dateheuremodification","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("rdg_compte_actif",1);
}
function pf_alimente_table(){
  fa_grise_fenetre("","oui");
  var raf_random=Math.random();
  fa_das("arbre_param_pc",vf_c_url_alimente_table+'&raf_random='+raf_random+'&');
}
function pf_approximatif() {
  if ( fa_value_get("bou_tb_rechapproxima") == "" ) {return;}
  vf_c_url_alimente_table=_c_url_alimente_table_01+'?vl_c_recherche='+fa_enc(fa_value_get("bou_tb_rechapproxima"))+'&vl_c_type='+fa_value_get("bou_ml_type");
  pf_alimente_table();
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      var i=fa_cui("arbre_param_pc");if(i==-1){return;}
      if (vf_e_utilisations==0 && vf_pc_cleunik>0) {fa_grise_non("bt_supprimer");} else {fa_grise_oui("bt_supprimer");}
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non('broadcaster_01');
    fa_focusdonne("tb_code")
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non('broadcaster_01');
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_focusdonne("tb_code")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_groupe_oui('broadcaster_01');
    pf_raz_fiche();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  pf_etat_fen("annuler");
  if (vl_datas=="ok") {alert("toto");pf_alimente_table();} else {alert(vl_datas);}
  
}
function pf_onunload(){
	fa_brl("arbre_param_pc",lstn_grise_saisie);
}
function pf_raz_fiche(){
  vf_e_utilisations=0;
  vf_pc_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_intitule","");
  fa_value_set("tb_dateheuremodification","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("rdg_compte_actif",1);
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return}
  var i=fa_cui("arbre_param_pc");if(i==-1){return;}
  var s ="pc_cleunik="+fa_cell_get("arbre_param_pc",i,"tc_pc_cleunik")+"&";
  fa_xmlhttprequest_xml(_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi){
  vf_c_donnees_validation="";
  vf_c_donnees_validation+="vl_pc_cleunik="+fa_enc(vf_pc_cleunik)+"&";
  vf_c_donnees_validation+="vl_code="+fa_enc(fa_value_get("tb_code"))+"&";
  vf_c_donnees_validation+="vl_intitule="+fa_enc(fa_value_get("tb_intitule"))+"&";
  vf_c_donnees_validation+="vl_actif="+fa_enc(fa_value_get("rdg_compte_actif"))+"&";
  switch(vv_quoi){
    case "enregistrer":
      if (vf_pc_cleunik!=-2) {vf_c_donnees_validation+="vf_c_action=modifier&";} else {vf_c_donnees_validation+="vf_c_action=ajouter&";}
      pf_verifie("validation");
      break;
    case "supprimer":
      if(confirm("Confirmez-vous la suppression de cet élément ?")==false) {return;}
      vf_c_donnees_validation+="vf_c_action=supprimer&";
      fa_xmlhttprequest_txt(_c_script_bdope_fen,vf_c_donnees_validation,pf_fin_requete);
      break;
  }
}
function pf_verifie(vv_genre){
  var vl_c_donnees="vl_code="+fa_enc(fa_value_get("tb_code"));
  if (vf_pc_cleunik==-2) {
    vl_c_donnees+="&vf_c_action=verifier_nouveau&";
  } else {
    vl_c_donnees+="&vf_c_action=verifier_existant&";
    vl_c_donnees+="&vl_pc_cleunik="+fa_enc(vf_pc_cleunik)+"&";
  }
  fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_verifie_fin,vv_genre);
}
function pf_verifie_fin(stream,vv_genre){
  switch (vv_genre) {
    case "prolixe":
      if (stream!='ok') {
        alert("Ce compte existe déjà.");
      }
      break;
    case "silencieux":
      if (stream!='ok') {
      }
      break;
    case "validation":
      if (stream!='ok') {
        alert("Ce compte existe déjà.");
      } else {
        fa_xmlhttprequest_txt(_c_script_bdope_fen,vf_c_donnees_validation,pf_fin_requete);
      }
      break;
  } 
}
]]></script>
END;
?>

