<?php
error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);  //  Pour éviter les warnings éventuels générés par simplexml_load_string
$vl_c_bfl_215=fa_recup_dico_js("bfl_215");
$vl_c_bfl_217=fa_recup_dico_js("bfl_217");
$vl_c_bfl_218=fa_recup_dico_js("bfl_218");
$vl_c_bfl_222=fa_recup_dico_js("bfl_222");
$vl_c_bfl_231=fa_recup_dico_js("bfl_231");
$vl_c_bfl_245=fa_recup_dico_js("bfl_245");
$vl_c_bfl_246=fa_recup_dico_js("bfl_246");
switch ($vl_c_genreaction){
  case "offcli":$fic_lignes="_offcli_lignes";$fic_ligqte="_offcli_lignes_qte";break;
  case "cdecli":$fic_lignes="_cdecli_lignes";$fic_ligqte="_cdecli_lignes_qte";break;
  case "livcli":$fic_lignes="_livcli_lignes";$fic_ligqte="_livcli_lignes_qte";break;
  case "faccli":$fic_lignes="_faccli_lignes";$fic_ligqte="_faccli_lignes_qte";break;
  case "avocli":$fic_lignes="_avocli_lignes";$fic_ligqte="_avocli_lignes_qte";break;
  case "avofin":$fic_lignes="_avocli_lignes";$fic_ligqte="_avocli_lignes_qte";break;
  case "demfou":$fic_lignes="_demfou_lignes";$fic_ligqte="_demfou_lignes_qte";break;
  case "cdefou":$fic_lignes="_cdefou_lignes";$fic_ligqte="_cdefou_lignes_qte";break;
  case "recfou":$fic_lignes="_recfou_lignes";$fic_ligqte="_recfou_lignes_qte";break;
  case "facfou":$fic_lignes="_facfou_lignes";$fic_ligqte="_facfou_lignes_qte";break;
  case "retcli":$fic_lignes="_retcli_lignes";$fic_ligqte="_retcli_lignes_qte";break;
  case "retfou":$fic_lignes="_retfou_lignes";$fic_ligqte="_retfou_lignes_qte";break;
  case "relfou":$fic_lignes="_relfou_lignes";$fic_ligqte="_relfou_lignes_qte";break;
  case "avofou":$fic_lignes="_avofou_lignes";$fic_ligqte="_avofou_lignes_qte";break;
  case "avofif":$fic_lignes="_avofou_lignes";$fic_ligqte="_avofou_lignes_qte";break;
}
$sql_req="select count(*) as nombre from $fic_lignes f1 left join $fic_ligqte f2 using(commercial_ligne_cleunik) where f1.commercial_cleunik=$commercial_cleunik;";
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$nombre_lignes=$row['nombre'];
if ($nombre_lignes==""){$nombre_lignes=0;}
_graal_libere_requete_bd($result);
$tb_cial_int_01='fa_value_set("tb_cial_int_privilegie_offcli",fa_xml_get(vl_c_datas,"int_privilegie_offcli"));fa_att_set("tb_cial_int_privilegie_offcli","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_offcli_cleunik"));';
$tb_cial_int_02='fa_value_set("tb_cial_int_privilegie_cdecli",fa_xml_get(vl_c_datas,"int_privilegie_cdecli"));fa_att_set("tb_cial_int_privilegie_cdecli","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_cdecli_cleunik"));';
$tb_cial_int_03='fa_value_set("tb_cial_int_privilegie_livcli",fa_xml_get(vl_c_datas,"int_privilegie_livcli"));fa_att_set("tb_cial_int_privilegie_livcli","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_livcli_cleunik"));';
$tb_cial_int_04='fa_value_set("tb_cial_int_privilegie_faccli",fa_xml_get(vl_c_datas,"int_privilegie_faccli"));fa_att_set("tb_cial_int_privilegie_faccli","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_faccli_cleunik"));';
$tb_cial_int_05='fa_value_set("tb_cial_int_privilegie_demfou",fa_xml_get(vl_c_datas,"int_privilegie_demfou"));fa_att_set("tb_cial_int_privilegie_demfou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_demcli_cleunik"));';
$tb_cial_int_06='fa_value_set("tb_cial_int_privilegie_cdefou",fa_xml_get(vl_c_datas,"int_privilegie_cdefou"));fa_att_set("tb_cial_int_privilegie_cdefou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_cdefou_cleunik"));';
$tb_cial_int_07='fa_value_set("tb_cial_int_privilegie_recfou",fa_xml_get(vl_c_datas,"int_privilegie_recfou"));fa_att_set("tb_cial_int_privilegie_recfou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_recfou_cleunik"));';
$tb_cial_int_08='fa_value_set("tb_cial_int_privilegie_facfou",fa_xml_get(vl_c_datas,"int_privilegie_facfou"));fa_att_set("tb_cial_int_privilegie_facfou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_facfou_cleunik"));';
$tb_cial_int_09='fa_value_set("tb_cial_int_privilegie_retcli",fa_xml_get(vl_c_datas,"int_privilegie_retcli"));fa_att_set("tb_cial_int_privilegie_retcli","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_retcli_cleunik"));';
$tb_cial_int_10='fa_value_set("tb_cial_int_privilegie_retfou",fa_xml_get(vl_c_datas,"int_privilegie_retfou"));fa_att_set("tb_cial_int_privilegie_retfou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_retfou_cleunik"));';
$tb_cial_int_11='fa_value_set("tb_cial_int_privilegie_cdefou",fa_xml_get(vl_c_datas,"int_privilegie_relfou"));fa_att_set("tb_cial_int_privilegie_cdefou","graal_cleunik",fa_xml_get(vl_c_datas,"int_privilegie_relfou_cleunik"));';
switch ($vl_c_genreaction){
  case "offcli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_045','3'));
  include('_graal_actions_cial_offcli.js.php');
  break;
  case "cdecli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_046','3'));include('_graal_actions_cial_cdecli.js.php');break;
  case "livcli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_047','3'));include('_graal_actions_cial_livcli.js.php');break;
  case "faccli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_048','3'));include('_graal_actions_cial_faccli.js.php');break;
  case "avocli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_048','3'));include('_graal_actions_cial_avocli.js.php');break;
  case "avofin":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_048','3'));include('_graal_actions_cial_avocli.js.php');break;
  case "demfou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_049','3'));include('_graal_actions_cial_demfou.js.php');break;
  case "cdefou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_050','3'));include('_graal_actions_cial_cdefou.js.php');break;
  case "recfou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_125','3'));include('_graal_actions_cial_recfou.js.php');break;
  case "facfou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_136','3'));include('_graal_actions_cial_facfou.js.php');break;
  case "retcli":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_103','3'));include('_graal_actions_cial_retcli.js.php');break;
  case "retfou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_114','3'));include('_graal_actions_cial_retfou.js.php');break;
  case "relfou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_183','3'));include('_graal_actions_cial_relfou.js.php');break;
  case "avofou":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_136','3'));include('_graal_actions_cial_avofou.js.php');break;
  case "avofif":$type_gestion_doc=intval(fa_recup_session('vs_param_generaux_graal_136','3'));include('_graal_actions_cial_avofou.js.php');break;
}
switch ($type_gestion_doc){
	case 1:
		break;
	case 2:
	case 3:
		break;
}
switch ($vl_c_genreaction){
  case "avofin":
$bloc_js_verif_dates=<<<EOT
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de l'avoir invalide. Enregistrement non effectué");return false;}
EOT;
	break;
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
  case "retcli":
switch ($type_gestion_doc){
	case 1:
$bloc_js_verif_dates=<<<EOT
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de livraison invalide. Enregistrement non effectué");return false;}
EOT;
		break;
	case 2:
	case 3:
$bloc_js_verif_dates=<<<EOT
  if (fa_value_get('tb_cial_date_expedition')=="") {alert("Date d'expédition invalide. Enregistrement non effectué");return false;}
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de livraison invalide. Enregistrement non effectué");return false;}
EOT;
		break;
}
	break;
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "avofou":
  case "avofif":
switch ($type_gestion_doc){
	case 1:
$bloc_js_verif_dates=<<<EOT
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de réception invalide. Enregistrement non effectué");return false;}
EOT;
		break;
	case 2:
	case 3:
$bloc_js_verif_dates=<<<EOT
  if (fa_value_get('tb_cial_date_expedition')=="") {alert("Date de départ invalide. Enregistrement non effectué");return false;}
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de réception invalide. Enregistrement non effectué");return false;}
EOT;
		break;
}
	case "retcli":
	case "retfou":
switch ($type_gestion_doc){
	case 1:
$bloc_js_verif_dates=<<<EOT
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de retour invalide. Enregistrement non effectué");return false;}
EOT;
		break;
	case 2:
	case 3:
$bloc_js_verif_dates=<<<EOT
  if (fa_value_get('tb_cial_date_expedition')=="") {alert("Date de retour invalide. Enregistrement non effectué");return false;}
	if (fa_value_get('tb_cial_date_livraison')=="") {alert("Date de retour invalide. Enregistrement non effectué");return false;}
EOT;
		break;
}
	break;
}

if ($rss_accès=="restreint"){
	$bloc_00=<<<EOT
const c_cial_fen_graal_selection_interlo="pagesparticulieres/acces_restreint.php?";
const c_cial_fen_representants="pagesparticulieres/acces_restreint.php?";
const c_cial_fen_consignes="pagesparticulieres/acces_restreint.php?";
const c_cial_fen_visu_acteurs='pagesparticulieres/acces_restreint.php?';
const c_cial_fen_action='pagesparticulieres/acces_restreint.php?';
const c_fen_panier_intweb='pagesparticulieres/acces_restreint.php?';
const c_cial_fen_panier_intfax='pagesparticulieres/acces_restreint.php?';
const c_cial_fen_adresses='pagesparticulieres/acces_restreint.php?';
EOT;
$vf_c_script_cial_bdope_action="pagesparticulieres/acces_restreint.php?";
$js_bon_preparation="";
$js_confirmation_cdecli="";
$pf_cial_transformations="";
} else {
$bloc_00=<<<EOT
const c_cial_fen_graal_selection_interlo="_graal_fen_actions_graal_01.php?vl_e_action_cleunik=$vl_action_cleunik&";
const c_cial_fen_representants="_graal_fen_cial_representant_01.php?vl_e_action_cleunik=$vl_action_cleunik&vl_commercial_cleunik=$commercial_cleunik&";
const c_cial_fen_consignes="_graal_fen_cial_consignes_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
const c_cial_fen_visu_acteurs='_graal_fen_rech_acteurs.php?vl_c_origine=selection&';
const c_cial_fen_action='_graal_fen_actions_02.php?';
const c_cial_fen_panier_intweb='_graal_traitements_courriel_01.php?genreacteur=tousss&vl_c_renvoyer_unseul=oui&vl_c_fonction_retour=pf_cial_retour_fenetre_intweb&';
const c_cial_fen_panier_intfax='_graal_fen_rech_fax_01.php?p02=emifax&genreacteur=tousss&vl_c_renvoyer_unseul=oui&vl_c_fonction_retour=pf_cial_retour_fenetre_intfax&';
const c_cial_fen_adresses='_graal_fen_rech_pos_01.php?genreacteur=tousss&';
const c_script_bdope_doc="_graal_bdope_doc_02.php?vf_c_action=supprimer_doc_cial&vf_e_doc_cleunik=";
var vf_c_cial_quel_retour="";
EOT;
$vf_c_script_cial_bdope_action="_graal_bdope_doc_cial_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
$bloc_00
$vl_complement_constantes_et_variables
function pf_cial_affiche_adresse_livraison(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_liv_adr_nom',fa_xml_get(vl_c_datas,'adr_nom'));
  fa_att_set('tb_liv_adr_complementnom',"adr_cleunik",fa_xml_get(vl_c_datas,'adr_cleunik'));
  fa_att_set('tb_liv_adr_complementnom',"adr_type",fa_xml_get(vl_c_datas,'adr_type'));
  fa_value_set('tb_liv_adr_complementnom',fa_xml_get(vl_c_datas,'adr_complementnom'));
  fa_value_set('tb_liv_adr_ligne1',fa_xml_get(vl_c_datas,'adr_ligne1'));
  fa_value_set('tb_liv_adr_ligne2',fa_xml_get(vl_c_datas,'adr_ligne2'));
  fa_value_set('tb_liv_adr_ligne3',fa_xml_get(vl_c_datas,'adr_ligne3'));
  fa_value_set('tb_liv_adr_cp',fa_xml_get(vl_c_datas,'adr_cp'));
  fa_value_set('tb_liv_adr_ville',fa_xml_get(vl_c_datas,'adr_ville'));
  fa_mlsel("ml_pays_liv",fa_xml_get(vl_c_datas,'choix_cleunik'));
  fa_value_set('tb_liv_adr_latitude',fa_xml_get(vl_c_datas,'adr_latitude'));
  fa_value_set('tb_liv_adr_longitude',fa_xml_get(vl_c_datas,'adr_longitude'));
}
function pf_cial_affiche_adresse_facturati(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_fac_adr_nom',fa_xml_get(vl_c_datas,'adr_nom'));
  fa_att_set('tb_fac_adr_complementnom',"adr_cleunik",fa_xml_get(vl_c_datas,'adr_cleunik'));
  fa_att_set('tb_fac_adr_complementnom',"adr_type",fa_xml_get(vl_c_datas,'adr_type'));
  fa_value_set('tb_fac_adr_complementnom',fa_xml_get(vl_c_datas,'adr_complementnom'));
  fa_value_set('tb_fac_adr_ligne1',fa_xml_get(vl_c_datas,'adr_ligne1'));
  fa_value_set('tb_fac_adr_ligne2',fa_xml_get(vl_c_datas,'adr_ligne2'));
  fa_value_set('tb_fac_adr_ligne3',fa_xml_get(vl_c_datas,'adr_ligne3'));
  fa_value_set('tb_fac_adr_cp',fa_xml_get(vl_c_datas,'adr_cp'));
  fa_value_set('tb_fac_adr_ville',fa_xml_get(vl_c_datas,'adr_ville'));
  fa_mlsel("ml_pays_fac",fa_xml_get(vl_c_datas,'choix_cleunik'));
  fa_value_set('tb_fac_adr_latitude',fa_xml_get(vl_c_datas,'adr_latitude'));
  fa_value_set('tb_fac_adr_longitude',fa_xml_get(vl_c_datas,'adr_longitude'));
}
$pf_cial_affiche_colisage
$pf_cial_affiche_donnees
$pf_cial_affiche_donnees_bonsdepreparation
function pf_cial_affiche_entete(stream) {
  var vl_c_datas=stream;
  fa_value_set("tb_blocnotebrut_entete",fa_xml_get(vl_c_datas,"blocnotebrut_entete"));
  fa_value_set("tb_blocnotebrut_pied",fa_xml_get(vl_c_datas,"blocnotebrut_pied"));
  fa_value_set("tb_reference_acteur",fa_xml_get(vl_c_datas,"reference_acteur"));
  fa_mlsel("ml_devise",fa_xml_get(vl_c_datas,'devise'));
  fa_mlsel("ml_tarif",fa_xml_get(vl_c_datas,'tarif_cleunik'));
  fa_value_set("tb_remise_taux",fa_xml_get(vl_c_datas,'remise_taux'));   
  fa_value_set("tb_escompte_taux",fa_xml_get(vl_c_datas,'escompte_taux'));
  fa_value_set("ml_remise_natu",fa_xml_get(vl_c_datas,'remise_natu'));
  fa_value_set("ml_remise_type",fa_xml_get(vl_c_datas,'remise_type'));
  fa_value_set("ml_remise_genr",fa_xml_get(vl_c_datas,'remise_genr'));
  fa_value_set("ml_escompte_type",fa_xml_get(vl_c_datas,'escompte_type'));
  if (fa_xml_get(vl_c_datas,'catcompta_cleunik')=="") {
  	fa_mlsel("ml_categorie_compta",-1);
  	fa_gid("tab_act_cial").selectedIndex=1;
  } else {
  	fa_mlsel("ml_categorie_compta",fa_xml_get(vl_c_datas,'catcompta_cleunik'));
  }
  //alert(fa_xml_get(vl_c_datas,'assujetti_tpf'))
  fa_value_set("ml_assujetti_tpf",fa_xml_get(vl_c_datas,'assujetti_tpf'));
  fa_mlsel("ml_modereglement",fa_xml_get(vl_c_datas,'reg_cleunik'));
  fa_value_set("tb_cial_code",fa_xml_get(vl_c_datas,"code"));
  fa_att_set("tb_cial_code","_graal_act_cleunik",fa_xml_get(vl_c_datas,"act_cleunik"));
  fa_value_set("tb_cial_rendezvous",fa_xml_get(vl_c_datas,"rendezvous"));
  fa_value_set("tb_cial_nomcommercial",fa_xml_get(vl_c_datas,"nomcommercial"));
  fa_value_set("tb_cialdateheurecreation",fa_xml_get(vl_c_datas,"datecreation")+" "+fa_xml_get(vl_c_datas,"heurecreation"));
  fa_value_set("tb_cialdateheuremodif",fa_xml_get(vl_c_datas,"datemodif")+" "+fa_xml_get(vl_c_datas,"heuremodif"));
  fa_value_set("tb_cial_date_expedition",fa_xml_get(vl_c_datas,"dateexpedition"));
  fa_value_set("tb_cial_date_livraison",fa_xml_get(vl_c_datas,"datelivraison"));
  fa_value_set("tb_cial_heur_livraison",fa_xml_get(vl_c_datas,"heurelivraison"));
  fa_value_set("tb_cial_heur_expedition",fa_xml_get(vl_c_datas,"heureexpedition"));
  fa_mlsel("ml_modliv",fa_xml_get(vl_c_datas,'modliv'));
  fa_mlsel("ml_modliv_bis",fa_xml_get(vl_c_datas,'modliv_bis'));
  fa_mlsel("ml_typpor",fa_xml_get(vl_c_datas,'typpor'));
  fa_value_set("tb_cialdate_fact",fa_xml_get(vl_c_datas,'datedoc'));
	fa_value_set("tb_cial_echeance",fa_xml_get(vl_c_datas,'date_echeance'));
	
  fa_value_set("tb_pds_bru_calcul",fa_xml_get(vl_c_datas,"poidsbrut"));
  fa_value_set("tb_pds_net_calcul",fa_xml_get(vl_c_datas,"poidsnet"));
  fa_value_set("tb_conditionnement_calcul",fa_xml_get(vl_c_datas,"qte_condi"));
  fa_value_set("tb_port_taux",fa_xml_get(vl_c_datas,"port_taux"));
  fa_value_set("tb_frais_taux",fa_xml_get(vl_c_datas,"frais_taux"));
  fa_value_set("tb_acompte_taux",fa_xml_get(vl_c_datas,"acompte_taux"));
  fa_value_set("ml_port_type",fa_xml_get(vl_c_datas,'port_type'));
  fa_value_set("ml_frais_type",fa_xml_get(vl_c_datas,'frais_type'));
  fa_value_set("ml_acompte_type",fa_xml_get(vl_c_datas,'acompte_type'));
  $tb_cial_int
}
function pf_cial_affiche_lignes() {
	$cial_affiche_lignes_doc_origine
  fa_das("arbre_act_cial_lignes","$vf_c_script_cial_lignes"+"raf_random="+Math.random()+"&");
  
}
function pf_cial_affiche_montants() {
  fa_das("arbre_recap_montant","$vf_c_script_cial_recap_montants"+"raf_random="+Math.random()+"&");
}
$pf_cial_affiche_representants
$pf_cial_affiche_transporteur
$pf_cial_transformations
function pf_cial_entete(){
  fa_xmlhttprequest_xml("$vf_c_script_cial_entete"+"raf_random="+Math.random()+"&","",pf_cial_affiche_entete);
}
function pf_cial_etat_fen(vv_quoi) {
  switch(vv_quoi) {
    case "ini":
      fa_sep("tb_conditionnement_calcul");
      fa_sep("tb_conditionnement_memo");
      fa_sep("tb_pds_bru_calcul");
      fa_sep("tb_pds_net_calcul");
      fa_sep("tb_pds_bru");
      fa_sep("tb_pds_net");
      fa_sep("tb_sur_bru_calcul");
      fa_sep("tb_sur_net_calcul");
      fa_sep("tb_sur_bru");
      fa_sep("tb_sur_net");
      fa_sep("tb_vol_bru_calcul");
      fa_sep("tb_vol_net_calcul");
      fa_sep("tb_vol_bru");
      fa_sep("tb_vol_net");
      fa_sep("tb_liv_adr_latitude");
      fa_sep("tb_liv_adr_longitude");
      fa_sep("tb_fac_adr_latitude");
      fa_sep("tb_fac_adr_longitude");
      fa_sep("tb_port_taux");
      fa_sep("tb_remise_taux");
      fa_sep("tb_escompte_taux");
      fa_sep("tb_frais_taux");
      fa_sep("tb_acompte_taux");
      pf_cial_affiche_donnees();
      
        fa_grise_oui("dp_dat_deb");
		fa_grise_oui("tb_debut_maintenant");
		fa_grise_oui("tb_heu_deb");
		fa_grise_oui("tb_fin_maintenant");
		fa_grise_oui("dp_dat_fin");
		fa_grise_oui("tb_heu_fin");
		
		fa_att_set("dp_dat_deb","observes","");
		fa_att_set("tb_debut_maintenant","observes","");
		fa_att_set("tb_heu_deb","observes","");
		fa_att_set("tb_fin_maintenant","observes","");
		fa_att_set("dp_dat_fin","observes","");
		fa_att_set("tb_heu_fin","observes","");
      
      
      fa_grise_groupe_oui('broadcaster_02');
      fa_grise_groupe_non('broadcaster_01');
	  fa_ael("iframe_docpdf","load",pf_cial_fin_chargement_pdf);
      $vl_c_ini
      break;
    case "selectionner":
      fa_grise_non("bt_cial_modifier");fa_grise_non("bt_cial_annuler");fa_grise_oui("bt_cial_enregistrer");
      fa_grise_groupe_oui('broadcaster_02');
      if ($nombre_lignes!=0){
  		fa_grise_oui("ml_categorie_compta");
  		fa_grise_oui("ml_assujetti_tpf");
  		fa_cache_non("tob_cial_acces_compta");
	  } else {
  		fa_grise_non("ml_categorie_compta");
  		fa_grise_non("ml_assujetti_tpf");
  		fa_cache_oui("tob_cial_acces_compta");
 	  }
      break;
    case "modifier":
      fa_grise_oui("bt_cial_modifier");fa_grise_non("bt_cial_enregistrer");fa_grise_non("bt_cial_annuler");
      fa_grise_groupe_non('broadcaster_02');
      if ($nombre_lignes!=0){
  		fa_grise_oui("ml_categorie_compta");
  		fa_grise_oui("ml_assujetti_tpf");
  		fa_cache_non("tob_cial_acces_compta");
	  } else {
  		fa_grise_non("ml_categorie_compta");
  		fa_grise_non("ml_assujetti_tpf");
  		fa_cache_oui("tob_cial_acces_compta");
 	  }
 	  $vl_cial_etat_fen
      break;
    case "annuler":
      pf_aa_init()
      break;
    case "sortir":
      try { window.opener.pf_approximatif_bem()} catch (e) {}
      window.close();
      break;   
    default:
      break;
  }
}
function pf_cial_graal(vv_qui) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+="genreacteur="+vv_qui+"&vl_e_act_cleunik="+fa_att_get("tb_cial_code","_graal_act_cleunik")+"&";
  fa_ouvre(c_cial_fen_graal_selection_interlo+vl_c_param,800,650);
}
function pf_cial_graal_retour(vv_qui,vv_nom) {
  switch (vv_qui) {
    case "offcli":fa_value_set("tb_cial_int_privilegie_offcli",vv_nom);break;
    case "cdecli":fa_value_set("tb_cial_int_privilegie_cdecli",vv_nom);break;
    case "livcli":fa_value_set("tb_cial_int_privilegie_livcli",vv_nom);break;
    case "faccli":fa_value_set("tb_cial_int_privilegie_faccli",vv_nom);break;
    case "avocli":fa_value_set("tb_cial_int_privilegie_faccli",vv_nom);break;
    case "demfou":fa_value_set("tb_cial_int_privilegie_demfou",vv_nom);break;
    case "cdefou":fa_value_set("tb_cial_int_privilegie_cdefou",vv_nom);break;
    case "recfou":fa_value_set("tb_cial_int_privilegie_recfou",vv_nom);break;
    case "facfou":fa_value_set("tb_cial_int_privilegie_facfou",vv_nom);break;
    case "retcli":fa_value_set("tb_cial_int_privilegie_retcli",vv_nom);break;
    case "retfou":fa_value_set("tb_cial_int_privilegie_retfou",vv_nom);break;
    case "relfou":fa_value_set("tb_cial_int_privilegie_cdefou",vv_nom);break;
    case "avofou":fa_value_set("tb_cial_int_privilegie_faccli",vv_nom);break;
  }
}
function pf_cial_modifie_compta(){
	fa_grise_non("ml_categorie_compta");
  	fa_grise_non("ml_assujetti_tpf");
  	fa_cache_oui("tob_cial_acces_compta");
  	fa_cache_non("tob_cial_modif_compta");
}
function pf_cial_modifie_compta_fin(){
	fa_grise_oui("ml_categorie_compta");
  	fa_grise_oui("ml_assujetti_tpf");
  	fa_cache_non("tob_cial_acces_compta");
  	fa_cache_oui("tob_cial_modif_compta");
  	var vl_c_donnees="vf_c_action=modifier_doc_compta&";
  	vl_c_donnees+="assujetti_tpf="+fa_enc(fa_value_get("ml_assujetti_tpf"))+"&";
  	vl_c_donnees+="catcompta_cleunik="+fa_enc(fa_mlget("ml_categorie_compta"))+"&";
  	fa_xmlhttprequest_txt("$vf_c_script_cial_bdope_action",vl_c_donnees,pf_cial_modifie_compta_fin_fin);
}
function pf_cial_modifie_compta_fin_fin(stream) {
var vl_c_datas = stream;
  var tableau_retour=vl_c_datas.split('|');
  switch (tableau_retour[0]) {
//alert(stream)
		case "-6":
		case "-5":
		case "-4":
		case "-3":
		case "-2":
		case "-1":
			alert("Modification document impossible ("+vl_c_datas+").");
			break;
		default:
			//alert("Modification réussie.");
			window.location=document.location;
	}
}
function pf_cial_ouvre(vv_param_01,vv_param_02){
	//alert(vv_param_01+"01")
	if (pf_cial_validation()==false) {return;}
	//alert(vv_param_01+"02")
  switch (vv_param_01) {
  
    $js_bon_preparation
    $js_confirmation_cdecli
    case 'adresse_livcli':
          vl_c_param="&vl_e_act_cleunik="+fa_att_get("tb_cial_code","_graal_act_cleunik")+"&vl_c_fonction_retour=pf_cial_retour_fenetre_adresse_livcli&";
          fa_ouvre(c_cial_fen_adresses+vl_c_param,1000,800);
      break;
    case 'adresse_faccli':
          vl_c_param="&vl_e_act_cleunik="+fa_att_get("tb_cial_code","_graal_act_cleunik")+"&vl_c_fonction_retour=pf_cial_retour_fenetre_adresse_faccli&";
          fa_ouvre(c_cial_fen_adresses+vl_c_param,1000,800);
      break;
    case 'colisage':
      switch (vv_param_02) {
        case 'nouveau_client':
          vl_c_param="&act_cleunik="+fa_att_get("tb_cial_code","_graal_act_cleunik")+"&"
          fa_ouvre(c_cial_fen_consignes+vl_c_param,500,230);
          break;
        case 'nouveau_transporteur':
          if (fa_att_get("tb_transporteur","_act_cleunik")==""){alert("$vl_c_bfl_217");return;}
          vl_c_param="&act_cleunik="+fa_att_get("tb_transporteur","_act_cleunik")+"&"
          fa_ouvre(c_cial_fen_consignes+vl_c_param,500,230);
          break;
        case 'ouvrir':
          if (fa_est_grise('tb_colisage_02')==true){return;}
          var i=fa_cui("arbre_colisage","");if(i==-1){alert("$vl_c_bfl_218");return;}
          vl_c_param="action_consi_cleunik="+fa_cell_get("arbre_colisage",i,"tc_action_consi_cleunik")+"&"
          fa_ouvre(c_cial_fen_consignes+vl_c_param,500,230);
          break;
      }
      break;
    case "emimail_texte":
    case "emimail_html":
    	var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("Aucun document n'est sélectionné");return;}
    	var vl_doc_cleunik=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik");
    	var vl_int_cleunik=-1;
    	var vl_fenetre="";
    	vf_c_cial_quel_retour=vv_param_01;
	    switch (vv_param_02) {
		    case "offcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_offcli","graal_cleunik");break;
		    case "cdecli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdecli","graal_cleunik");break;
		    case "livcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_livcli","graal_cleunik");break;
		    case "faccli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_faccli","graal_cleunik");break;
		    case "avocli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_avocli","graal_cleunik");break;
		    case "demfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_demfou","graal_cleunik");break;
		    case "cdefou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdefou","graal_cleunik");break;
		    case "recfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_recfou","graal_cleunik");break;
		    case "facfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_facfou","graal_cleunik");break;
		    case "retcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_retcli","graal_cleunik");break;
		    case "retfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_retfou","graal_cleunik");break;
		    case "relfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdefou","graal_cleunik");break;
		    case "avofou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_avocli","graal_cleunik");break;
		    case "acteur":vl_int_cleunik=-2;break;
		   	case "lambda":vl_int_cleunik=-3;break;
		   	default:
		   		alert("Erreur de programmation");
		   		return;
		  }
	    switch (vl_int_cleunik){
	    	case -1:
	    	case '-1':
	    	case undefined:
	    	case "":
	    		alert("Aucun interlocuteur ne correspond");
	    		return;
	    		break;
	    	case -3:
	    		fa_ouvre(c_cial_fen_panier_intweb,800,800);
	    		break;
	    	case -2:
	    		vl_fenetre=c_cial_fen_panier_intweb+"vl_e_act_cleunik=$commercial_act_cleunik";
	    		fa_ouvre(vl_fenetre,800,800);
	    		break;
	    	default:
	    		vl_fenetre=c_cial_fen_panier_intweb+"vl_e_int_cleunik="+vl_int_cleunik;
	    		fa_ouvre(vl_fenetre,800,800);
	    		break;
	      }
	      break;
	case "emifax":
    	var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("Aucun document n'est sélectionné");return;}
    	var vl_doc_cleunik=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik");
    	var vl_int_cleunik=-1;
    	var vl_fenetre="";
    	vf_c_cial_quel_retour=vv_param_01;
	    switch (vv_param_02) {
		    case "offcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_offcli","graal_cleunik");break;
		    case "cdecli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdecli","graal_cleunik");break;
		    case "livcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_livcli","graal_cleunik");break;
		    case "faccli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_faccli","graal_cleunik");break;
		    case "avocli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_avocli","graal_cleunik");break;
		    case "demfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_demfou","graal_cleunik");break;
		    case "cdefou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdefou","graal_cleunik");break;
		    case "recfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_recfou","graal_cleunik");break;
		    case "facfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_facfou","graal_cleunik");break;
		    case "retcli":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_retcli","graal_cleunik");break;
		    case "retfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_retfou","graal_cleunik");break;
		    case "relfou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_cdefou","graal_cleunik");break;
		    case "avofou":vl_int_cleunik=fa_att_get("tb_cial_int_privilegie_avofou","graal_cleunik");break;
		    case "acteur":vl_int_cleunik=-2;break;
		   	case "lambda":vl_int_cleunik=-3;break;
		   	default:
		   		alert("Erreur de programmation");
		   		return;
		  }
	    switch (vl_int_cleunik){
	    	case -1:
	    	case '-1':
	    	case undefined:
	    	case "":
	    		alert("Aucun interlocuteur ne correspond");
	    		return;
	    		break;
	    	case -3:
	    		fa_ouvre(c_cial_fen_panier_intfax,800,800);
	    		break;
	    	case -2:
	    		vl_fenetre=c_cial_fen_panier_intfax+"vl_e_act_cleunik=$commercial_act_cleunik";
	    		fa_ouvre(vl_fenetre,800,800);
	    		break;
	    	default:
	    		vl_fenetre=c_cial_fen_panier_intfax+"vl_e_int_cleunik="+vl_int_cleunik;
	    		fa_ouvre(vl_fenetre,800,800);
	    		break;
	      }
	      break;	     
    case 'imprimer':
          var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("$vl_c_bfl_231");return;}
          pf07_voir_iframe_doc(fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik"),"iframe_docpdf")
          break;
    case 'ligne':
      if (fa_mlget('ml_categorie_compta')==-1) {
        alert("Catégorie fiscale incompatible avec la saisie des lignes.");
        return
      }
      switch (vv_param_02) {
        case 'nouveau':
          vl_c_param="genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&commercial_ligne_cleunik=0&"
		  fa_ouvre_ligne_doccial(vl_c_param,"");
          break;
        case 'ouvrir':
          if (fa_est_grise('tb_ligne_02')==true) {return;}
          var i=fa_cui("arbre_act_cial_lignes","");if(i==-1){alert("$vl_c_bfl_222");return;}
          vl_c_param="genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&commercial_ligne_cleunik="+fa_cell_get("arbre_act_cial_lignes",i,"tc_commercial_ligne_cleunik")+"&"
		  fa_ouvre_ligne_doccial(vl_c_param,"");
          break;
      }
      break;
    case 'ligne_origine':
      if (fa_mlget('ml_categorie_compta')==-1) {
        alert("Catégorie fiscale incompatible avec la saisie des lignes.");
        return
      }
      switch (vv_param_02) {
        case 'ouvrir':
          if (fa_est_grise('tb_ligne_02')==true) {return;}
          var i=fa_cui("arbre_act_cial_lignes_origine","");if(i==-1){alert("$vl_c_bfl_222");return;}
          vl_c_param="vl_c_specificite=$vl_c_specificite&genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&commercial_ligne_cleunik="+fa_cell_get("arbre_act_cial_lignes_origine",i,"tc_commercial_ligne_cleunik")+"&"
		  fa_ouvre_ligne_doccial(vl_c_param,"");
          break;
      }
      break;
    case 'representant':
      switch (vv_param_02) {
        case 'nouveau':
          vl_c_param="&vl_e_action_rep_cleunik=0&"
          fa_ouvre(c_cial_fen_representants+vl_c_param,800,650);
          break;
        case 'ouvrir':
        if (fa_est_grise('tb_representant_02')==true){return;}
          var i=fa_cui("arbre_representants","");if(i==-1){alert("$vl_c_bfl_215");return;}
          vl_c_param="&vl_e_action_rep_cleunik="+fa_cell_get("arbre_representants",i,"tr_action_rep_cleunik")+"&"
          fa_ouvre(c_cial_fen_representants+vl_c_param,800,170);
          break;
      }
    case 'article':
    	var i=fa_cui(vv_param_02,"");if(i==-1){alert("$vl_c_bfl_222");return;}
    	var vl_art_cleunik=fa_cell_get(vv_param_02,i,"tc_art_cleunik");
		fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_art_cleunik+"&","");
      break;
  }
}
function pf_cial_retour_fenetre_intfax(vl_intfax_cleunik){
	var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("$vl_c_bfl_231");return;}
    vl_t_doc_cleunik=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik");
    vl_t_doc_nom=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_code");
	pf04_emifax_doccial($vl_action_cleunik,vl_t_doc_cleunik,vl_intfax_cleunik,vl_t_doc_nom);
}
function pf_cial_retour_fenetre_intweb(vl_intweb_cleunik){
	var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("$vl_c_bfl_231");return;}
    vl_t_doc_cleunik=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik");
    vl_t_doc_nom=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_code");
    switch (vf_c_cial_quel_retour){
    	case "emimail_texte":
			pf04_emimail_doccial_texte($vl_action_cleunik,vl_t_doc_cleunik,vl_intweb_cleunik,vl_t_doc_nom);
			break;
		case "emimail_html":
			pf04_emimail_doccial_html($vl_action_cleunik,vl_t_doc_cleunik,vl_intweb_cleunik,vl_t_doc_nom);
			break;
	}
}
function pf_cial_retour_fenetre_adresse_faccli(complementnom,adr_ligne1,adr_ligne2,adr_ligne3,adr_cp,adr_ville,adr_choix_cleunik,adr_latitude,adr_longitude) {
  fa_value_set('tb_fac_adr_complementnom',atob(complementnom));
  fa_value_set('tb_fac_adr_ligne1',atob(adr_ligne1));
  fa_value_set('tb_fac_adr_ligne2',atob(adr_ligne2));
  fa_value_set('tb_fac_adr_ligne3',atob(adr_ligne3));
  fa_value_set('tb_fac_adr_cp',atob(adr_cp));
  fa_value_set('tb_fac_adr_ville',atob(adr_ville));
  fa_mlsel("ml_pays_fac",atob(adr_choix_cleunik));
  fa_value_set('tb_fac_adr_latitude',atob(adr_latitude));
  fa_value_set('tb_fac_adr_longitude',atob(adr_longitude));
}
function pf_cial_retour_fenetre_adresse_livcli(complementnom,adr_ligne1,adr_ligne2,adr_ligne3,adr_cp,adr_ville,adr_choix_cleunik,adr_latitude,adr_longitude) {
  fa_value_set('tb_liv_adr_complementnom',atob(complementnom));
  fa_value_set('tb_liv_adr_ligne1',atob(adr_ligne1));
  fa_value_set('tb_liv_adr_ligne2',atob(adr_ligne2));
  fa_value_set('tb_liv_adr_ligne3',atob(adr_ligne3));
  fa_value_set('tb_liv_adr_cp',atob(adr_cp));
  fa_value_set('tb_liv_adr_ville',atob(adr_ville));
  fa_mlsel("ml_pays_liv",atob(adr_choix_cleunik));
  fa_value_set('tb_liv_adr_latitude',atob(adr_latitude));
  fa_value_set('tb_liv_adr_longitude',atob(adr_longitude));
}
function pf_cial_sel_transporteur(){
  fa_ouvre(c_cial_fen_visu_acteurs+"vl_e_genreacteur=transp&vl_c_proc_retour=pf_cial_sel_transporteur_retour&",800,600);
}
function pf_cial_sel_transporteur_retour(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  fa_value_set("tb_transporteur",vl_c_raisonsoc);
  fa_att_set("tb_transporteur","_act_cleunik",vl_act_cleunik);
}
function pf_cial_suppression(){
	try {
   		vl_e_nb=fa_gid("arbre_act_cial_lignes").view.rowCount;
		if (vl_e_nb!=0) {return;}
	}  catch (e) {
		//return;
	}
	if (confirm("$vl_c_bfl_245")!=true) {return};
	fa_xmlhttprequest_txt(c_cial_script_bdope_action,"",pf_cial_suppression_fin);
}
function pf_cial_suppression_fin(stream){
	if (stream=="ok") {alert("$vl_c_bfl_246");}
	if (window.opener==null){
		window.location="pagesparticulieres/page_blanche.php";
	} else {
		window.close();
	}
}
function pf_cial_supprime_donnees_bonsdepreparation(){
	var i=fa_cui("arbre_bonsdepreparation","");if(i==-1){alert("Aucun document n'est sélectionné");return;}
    var vl_doc_cleunik=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_cleunik");
    var vl_nombre=fa_cell_get("arbre_bonsdepreparation",i,"tr_bonsdepreparation_nombre");
    if (vl_nombre>1){alert("Document rattaché ... Suppression impossible.");return;}
    fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(c_script_bdope_doc+vl_doc_cleunik,"",pf_cial_supprime_donnees_bonsdepreparation_fin);
}
function pf_cial_supprime_donnees_bonsdepreparation_fin(stream){
	pf_affiche_donnees_ged();
	pf_cial_affiche_donnees_bonsdepreparation();
	fa_grise_fenetre("","non");
	alert(stream);
}
function pf_cial_validation() {
	$bloc_js_verif_dates
	if (fa_mlget("ml_categorie_compta")==-1){
		alert("La catégorie fiscale est incorrecte. Problèmes en perspective ... Vérifiez toutes les informations comptables ...");
		return;
	}
  var vl_c_donnees="vf_c_action=modifier_doc&vl_action_cleunik=$vl_action_cleunik&";
  vl_c_donnees+="devise="+fa_enc(fa_mlget("ml_devise"))+"&";
  vl_c_donnees+="code="+fa_enc(fa_value_get("tb_cial_code"))+"&";
  vl_c_donnees+="tarif_cleunik="+fa_enc(fa_mlget("ml_tarif"))+"&";
  vl_c_donnees+="remise_taux="+fa_enc(fa_value_get("tb_remise_taux"))+"&";
  vl_c_donnees+="remise_type="+fa_mlget("ml_remise_type","value")+"&";
  vl_c_donnees+="remise_genr="+fa_mlget("ml_remise_genr","value")+"&";
  vl_c_donnees+="remise_natu="+fa_mlget("ml_remise_natu","value")+"&";
  vl_c_donnees+="escompte_taux="+fa_enc(fa_value_get("tb_escompte_taux"))+"&";
  vl_c_donnees+="escompte_type="+fa_mlget("ml_escompte_type","value")+"&";
  vl_c_donnees+="catcompta_cleunik="+fa_enc(fa_mlget("ml_categorie_compta"))+"&";
  vl_c_donnees+="reg_cleunik="+fa_enc(fa_mlget("ml_modereglement"))+"&";
  vl_c_donnees+="blocnotebrut_entete="+fa_enc(fa_value_get("tb_blocnotebrut_entete"))+"&";
  vl_c_donnees+="blocnotebrut_pied="+fa_enc(fa_value_get("tb_blocnotebrut_pied"))+"&";
  vl_c_donnees+="reference_acteur="+fa_enc(fa_value_get("tb_reference_acteur"))+"&";
  vl_c_donnees+="rendezvous="+fa_enc(fa_value_get("tb_cial_rendezvous"))+"&";
  vl_c_donnees+="modliv="+fa_enc(fa_mlget("ml_modliv"))+"&";
  vl_c_donnees+="modliv_bis="+fa_enc(fa_mlget("ml_modliv_bis"))+"&";
  vl_c_donnees+="typpor="+fa_enc(fa_mlget("ml_typpor"))+"&";
  vl_c_donnees+="dateheureexpedition="+fa_enc(fa_value_get("tb_cial_date_expedition")+" "+fa_value_get("tb_cial_heur_expedition"))+"&";
  vl_c_donnees+="dateheurelivraison="+fa_enc(fa_value_get("tb_cial_date_livraison")+" "+fa_value_get("tb_cial_heur_livraison"))+"&";
	vl_c_donnees+="datedoc="+fa_enc(fa_value_get("tb_cialdate_fact"))+"&";
  vl_c_donnees+="port_taux="+fa_enc(fa_value_get("tb_port_taux"))+"&";
  vl_c_donnees+="frais_taux="+fa_enc(fa_value_get("tb_frais_taux"))+"&";
  vl_c_donnees+="acompte_taux="+fa_enc(fa_value_get("tb_acompte_taux"))+"&";
  vl_c_donnees+="port_type="+fa_value_get("ml_port_type")+"&";
  vl_c_donnees+="frais_type="+fa_value_get("ml_frais_type")+"&";
  vl_c_donnees+="acompte_type="+fa_value_get("ml_acompte_type")+"&";
  vl_c_donnees+="dateecheance="+fa_enc(fa_value_get("tb_cial_echeance"))+"&";
  vl_c_donnees+="assujetti_tpf="+fa_enc(fa_value_get("ml_assujetti_tpf"))+"&";
  var vl_c_donnees_liv="";
  vl_c_donnees_liv+="liv_adr_cleunik="+fa_enc(fa_att_get("tb_liv_adr_complementnom","adr_cleunik"))+"&";
  vl_c_donnees_liv+="liv_pays_cleunik="+fa_enc(fa_mlget("ml_pays_liv"))+"&";
  vl_c_donnees_liv+="liv_adr_nom="+fa_enc(fa_value_get("tb_liv_adr_nom"))+"&";
  vl_c_donnees_liv+="liv_adr_complementnom="+fa_enc(fa_value_get("tb_liv_adr_complementnom"))+"&";
  vl_c_donnees_liv+="liv_adr_ligne1="+fa_enc(fa_value_get("tb_liv_adr_ligne1"))+"&";
  vl_c_donnees_liv+="liv_adr_ligne2="+fa_enc(fa_value_get("tb_liv_adr_ligne2"))+"&";
  vl_c_donnees_liv+="liv_adr_ligne3="+fa_enc(fa_value_get("tb_liv_adr_ligne3"))+"&";
  vl_c_donnees_liv+="liv_adr_cp="+fa_enc(fa_value_get("tb_liv_adr_cp"))+"&";
  vl_c_donnees_liv+="liv_adr_ville="+fa_enc(fa_value_get("tb_liv_adr_ville"))+"&";
  vl_c_donnees_liv+="liv_adr_latitude="+fa_enc(fa_value_get("tb_liv_adr_latitude"))+"&";
  vl_c_donnees_liv+="liv_adr_longitude="+fa_enc(fa_value_get("tb_liv_adr_longitude"))+"&";
  vl_c_donnees_liv+="liv_adr_type="+fa_enc(fa_att_get("tb_liv_adr_complementnom","adr_type"))+"&";
  
  var vl_c_donnees_fac="";
  vl_c_donnees_liv+="fac_adr_cleunik="+fa_enc(fa_att_get("tb_fac_adr_complementnom","adr_cleunik"))+"&";
  vl_c_donnees_liv+="fac_pays_cleunik="+fa_enc(fa_mlget("ml_pays_fac"))+"&";
  vl_c_donnees_liv+="fac_adr_nom="+fa_enc(fa_value_get("tb_fac_adr_nom"))+"&";
  vl_c_donnees_liv+="fac_adr_complementnom="+fa_enc(fa_value_get("tb_fac_adr_complementnom"))+"&";
  vl_c_donnees_liv+="fac_adr_ligne1="+fa_enc(fa_value_get("tb_fac_adr_ligne1"))+"&";
  vl_c_donnees_liv+="fac_adr_ligne2="+fa_enc(fa_value_get("tb_fac_adr_ligne2"))+"&";
  vl_c_donnees_liv+="fac_adr_ligne3="+fa_enc(fa_value_get("tb_fac_adr_ligne3"))+"&";
  vl_c_donnees_liv+="fac_adr_cp="+fa_enc(fa_value_get("tb_fac_adr_cp"))+"&";
  vl_c_donnees_liv+="fac_adr_ville="+fa_enc(fa_value_get("tb_fac_adr_ville"))+"&";
  vl_c_donnees_liv+="fac_adr_latitude="+fa_enc(fa_value_get("tb_fac_adr_latitude"))+"&";
  vl_c_donnees_liv+="fac_adr_longitude="+fa_enc(fa_value_get("tb_fac_adr_longitude"))+"&";
vl_c_donnees_liv+="fac_adr_type="+fa_enc(fa_att_get("tb_fac_adr_complementnom","adr_type"))+"&";

  var vl_c_donnees_tra="";
  vl_c_donnees_tra+="action_trans_cleunik="+fa_enc(fa_att_get("tb_transporteur","_graal_cleunik"))+"&";
  vl_c_donnees_tra+="act_cleunik_trans="+fa_enc(fa_att_get("tb_transporteur","_act_cleunik"))+"&";
  vl_c_donnees_tra+="poids_net="+fa_enc(fa_value_get("tb_pds_net"))+"&";
  vl_c_donnees_tra+="poids_bru="+fa_enc(fa_value_get("tb_pds_bru"))+"&";
  vl_c_donnees_tra+="volum_net="+fa_enc(fa_value_get("tb_vol_net"))+"&";
  vl_c_donnees_tra+="volum_bru="+fa_enc(fa_value_get("tb_vol_bru"))+"&";
  vl_c_donnees_tra+="surfa_net="+fa_enc(fa_value_get("tb_sur_net"))+"&";
  vl_c_donnees_tra+="surfa_bru="+fa_enc(fa_value_get("tb_sur_bru"))+"&";
  vl_c_donnees_tra+="nombre_colis="+fa_enc(fa_value_get("tb_conditionnement_memo"))+"&";
  fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt("$vf_c_script_cial_bdope_action",vl_c_donnees+vl_c_donnees_liv+vl_c_donnees_fac+vl_c_donnees_tra,pf_cial_validation_fin);
	return true;
}
function pf_cial_validation_fin(stream) {
	fa_grise_fenetre("","non");
var vl_c_datas = stream;
  var tableau_retour=vl_c_datas.split('|');
  switch (tableau_retour[0]) {
//alert(stream)
		case "-6":
		case "-5":
		case "-4":
		case "-3":
		case "-2":
		case "-1":
			alert("Modification document impossible ("+vl_c_datas+").");
			break;
		default:
			//alert("Modification réussie.");
	}
  pf_cial_affiche_montants();
}
]]></script>
END;
?>
