<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_script_edite="_graal_xml_art_compta_01.php?catcompta_cleunik=$vl_e_catcompta_cleunik&art_cleunik=$vl_e_art_cleunik&";
const _c_script_bdope_fen="_graal_bdope_art_compta_01.php?vl_art_cleunik=$vl_e_art_cleunik&";
const c_script_pc="_graal_fen_rech_param_pc_01.php?";
const c_script_taxe="_graal_fen_rech_param_taxes_01.php?";
const c_script_tpf="_graal_fen_rech_param_tpf_01.php?";
var vf_c_action;
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  fa_value_set("tb_code_vente",fa_xml_get(vl_c_datas,"code_vente"));
  fa_att_set("tb_code_vente","compte_vente",fa_xml_get(vl_c_datas,'pc_cleunik_vente'));
  fa_value_set("tb_intitule_vente",fa_xml_get(vl_c_datas,"intitule_vente"));
  fa_value_set("tb_code_achat",fa_xml_get(vl_c_datas,"code_achat"));
  fa_att_set("tb_code_achat","compte_achat",fa_xml_get(vl_c_datas,'pc_cleunik_achat'));
  fa_value_set("tb_intitule_achat",fa_xml_get(vl_c_datas,"intitule_achat"));
  fa_value_set("tb_code_taxes",fa_xml_get(vl_c_datas,"code_taxes"));
  fa_att_set("tb_code_taxes","compte_taxes",fa_xml_get(vl_c_datas,'taxes_cleunik'));
  fa_value_set("tb_intitule_taxes",fa_xml_get(vl_c_datas,"intitule_taxes"));
  fa_value_set("tb_code_tpf",fa_xml_get(vl_c_datas,"code_tpf"));
  fa_att_set("tb_code_tpf","compte_tpf",fa_xml_get(vl_c_datas,'tpf_cleunik'));
  fa_value_set("tb_intitule_tpf",fa_xml_get(vl_c_datas,"intitule_tpf"));
  fa_value_set("tb_code_tpf_01",fa_xml_get(vl_c_datas,"code_tpf_01"));
  fa_att_set("tb_code_tpf_01","compte_tpf_01",fa_xml_get(vl_c_datas,'tpf_cleunik_01'));
  fa_value_set("tb_intitule_tpf_01",fa_xml_get(vl_c_datas,"intitule_tpf_01"));
  fa_mlsel("ml_categorie_compta","$vl_e_catcompta_cleunik");
}
function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui("broadcaster_01");
  pf_raz_fiche();
  if ("$vl_e_catcompta_cleunik"==-1) {
    pf_etat_fen("ajouter")
  } else {
    pf_etat_fen("selectionner");
    fa_xmlhttprequest_xml(_c_script_edite,"",pf_affiche_datas);
    //fa_ouvre(_c_script_edite)
  }
}
function pf_alimente_defaut(){
  fa_value_set("tb_art_cleunik","");
  fa_value_set("tb_catcompta_cleunik","");
  fa_value_set("tb_pc_cleunik_vente","");
  fa_value_set("tb_pc_cleunik_achat","");
  fa_value_set("tb_taxes_cleunik","");
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      fa_grise_non("bt_supprimer");
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    fa_grise_oui("ml_categorie_compta");
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_focusdonne("ml_categorie_compta")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_groupe_oui("broadcaster_01");
    pf_raz_fiche();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (window.opener!=null) {try {window.opener.pf_affiche_donnees_compta();} catch (e) {}}
  if (vl_datas=="ok") {
    if ("$vl_e_catcompta_cleunik"==-1) {
      window.location=document.location;
    } else {
      pf_etat_fen("sortir");
    }
  } else {alert(vl_datas)}
  pf_etat_fen("annuler");
}
function pf_ouvre(vv_quoi) {
  switch (vv_quoi) {
    case "pc_vente":
      fa_ouvre(c_script_pc+"vl_c_quellerecherche=pc_vente&",600,350);
      break;
    case "pc_achat":
      fa_ouvre(c_script_pc+"vl_c_quellerecherche=pc_achat&",600,350);
      break;
    case "pc_taxes":
      fa_ouvre(c_script_taxe+"vl_c_quellerecherche=taxe&",600,350);
      break;
	case "pc_tpf":
      fa_ouvre(c_script_tpf+"vl_c_quellerecherche=tpf&",600,350);
      break;
    case "pc_tpf_01":
      fa_ouvre(c_script_tpf+"vl_c_quellerecherche=tpf_01&",600,350);
      break;
  }
}
function pf_raz_fiche(){
  fa_value_set("tb_art_cleunik","");
  fa_value_set("tb_catcompta_cleunik","");
  fa_value_set("tb_pc_cleunik_vente","");
  fa_value_set("tb_pc_cleunik_achat","");
  fa_value_set("tb_taxes_cleunik","");
}
function pf_retour_param_pc(vl_e_pc_cleunik,vl_c_code,vl_c_intitule,vv_quoi) {
  switch (vv_quoi) {
    case "pc_vente":
      fa_value_set("tb_code_vente",vl_c_code);
      fa_att_set("tb_code_vente","compte_vente",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_vente",vl_c_intitule);
      break;
    case "pc_achat":
      fa_value_set("tb_code_achat",vl_c_code);
      fa_att_set("tb_code_achat","compte_achat",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_achat",vl_c_intitule);
      break;
    case "taxe":
      fa_value_set("tb_code_taxes",vl_c_code);
      fa_att_set("tb_code_taxes","compte_taxes",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_taxes",vl_c_intitule);
      break;
    case "tpf":
      fa_value_set("tb_code_tpf",vl_c_code);
      fa_att_set("tb_code_tpf","compte_tpf",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_tpf",vl_c_intitule);
      break;
    case "tpf_01":
      fa_value_set("tb_code_tpf_01",vl_c_code);
      fa_att_set("tb_code_tpf_01","compte_tpf_01",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_tpf_01",vl_c_intitule);
      break;
  }
}
function pf_validation(vv_quoi) {
  var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_catcompta_cleunik="+fa_enc(fa_mlget("ml_categorie_compta"))+"&";
  vl_c_donnees+="vl_pc_cleunik_vente="+fa_enc(fa_att_get("tb_code_vente","compte_vente"))+"&";
  vl_c_donnees+="vl_pc_cleunik_achat="+fa_enc(fa_att_get("tb_code_achat","compte_achat"))+"&";
  vl_c_donnees+="vl_taxes_cleunik="+fa_enc(fa_att_get("tb_code_taxes","compte_taxes"))+"&";
  vl_c_donnees+="vl_tpf_cleunik="+fa_enc(fa_att_get("tb_code_tpf","compte_tpf"))+"&";
  vl_c_donnees+="vl_tpf_cleunik_01="+fa_enc(fa_att_get("tb_code_tpf_01","compte_tpf_01"))+"&";
  switch(vv_quoi) {
    case "enregistrer":
      if ("$vl_e_catcompta_cleunik"!="-1")
        {vl_c_donnees+="vf_c_action=modifier&";}
      else
        {vl_c_donnees+="vf_c_action=ajouter&";}
      break;
    case "supprimer":
        if(confirm("Confirmez-vous la suppression de cet élément ?")==false) return;
        vl_c_donnees+="vf_c_action=supprimer&";
      break;
  }
  fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
