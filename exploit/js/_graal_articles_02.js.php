<?php
if ($vl_e_art_cleunik==-1) {
  $js_aa_init_01="fa_approximatif_bbo();fa_ael('bbo_ml_qui','ValueChange',po_change_menu);po_change_menu();";
  $js_annuler_01="fa_focusdonne('arbre_des_articles');";
	$js_validation_01="fa_approximatif_bbo();";
} else {
  $js_aa_init_01="vf_e_art_cleunik=$vl_e_art_cleunik;var s =fa_enc('vl_e_art_cleunik')+'='+fa_enc($vl_e_art_cleunik)+'&';fa_xmlhttprequest_xml(vf_c_script_xml_art,s,pf_affiche_donnees_articles_infogene);";
  $js_annuler_01="pf_aa_init()";
	$js_validation_01="";
}
$js_popup_arbre_article="";
switch ($vl_c_genre){
  case "favori":     
      $js_popup_arbre_article="fa_att_set('arbre_des_articles','context','pop_favoris');";
    break;
}
$param_generaux_graal_025=intval(fa_recup_session('vs_param_generaux_graal_025','0'));
$param_generaux_graal_167=intval(fa_recup_session('vs_param_generaux_graal_167','0'));
$vl_c_bbo_122js=fa_recup_dico_js("bbo_122");
$vl_c_bbo_123js=fa_recup_dico_js("bbo_123");
$vl_c_bbo_124js=fa_recup_dico_js("bbo_124");
$vl_c_bbo_125js=fa_recup_dico_js("bbo_125");
$vl_c_bbo_126js=fa_recup_dico_js("bbo_126");
$vl_c_bbo_127js=fa_recup_dico_js("bbo_127");
$vl_c_bbo_128js=fa_recup_dico_js("bbo_128");
$vl_c_bbo_129js=fa_recup_dico_js("bbo_129");
$vl_c_bbo_130js=fa_recup_dico_js("bbo_130");
$vl_c_bbo_131js=fa_recup_dico_js("bbo_131");
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_e_art_cleunik,vf_e_art_depemp_cleunik,vf_e_choix_depot,vf_e_choix_empla,vf_e_art_fournis_cleunik;
var vf_c_action;
var vf_e_art_cleunik_droite,vf_e_art_cleunik_gauche,vf_e_choix_cleunik_droite,vf_e_choix_cleunik_gauche;
var vf_c_url_alimente_table;
var vf_e_nombre_utilisations_fab=new Number(0),vf_e_nombre_utilisations_cial=new Number(0),vf_saisie_nomencach_encours=false,vf_c_nomencach="",vf_saisie_nomencven_encours=false,vf_c_nomencven="";
const vf_c_script_xml_art='_graal_xml_articles_01.php?';
const c_script_xml_art_pour_nomencach='_graal_xml_articles_02.php?vl_e_art_cleunik=';
const c_script_xml_art_pour_nomencven='_graal_xml_articles_02.php?vl_e_art_cleunik=';
const vf_c_script_favoris='_graal_bdope_articles_favoris_01.php';
const vf_c_script_bdope_art='_graal_bdope_articles_01.php';
const vf_c_script_bdope_art_achats='_graal_bdope_articles_achats_01.php';
const vf_c_script_das_art_four='_graal_das_art_fournis_01.php?';
const vf_c_script_das_art_cli='_graal_das_art_client_01.php?';
const vf_c_script_relations='_graal_das_art_relations_01.php?';
const vf_c_script_critere_art_entreprise='_graal_das_articles_criteres_entreprise.php?';
const vf_c_script_critere_art_lesmiens='_graal_das_articles_criteres_lesmiens.php?';
const vf_c_script_critere_art_lesautres='_graal_das_articles_criteres_lesautres.php?';
const vf_c_script_critere_art_tous='_graal_das_articles_criteres_tous.php?';
const vf_c_script_das_tarifs_type_ventes='_graal_das_art_tarifs_type_ventes.php?';
const vf_c_script_das_tarifs_particulier_ventes='_graal_das_art_tarifs_particulier_ventes.php?';
const vf_c_script_das_tarifs_type_achats='_graal_das_art_tarifs_type_achats.php?';
const vf_c_script_das_tarifs_particulier_achats='_graal_das_art_tarifs_particulier_achats.php?';
const vf_c_script_das_nomenclatures_ach='_graal_das_art_nomenclatures_ach_01.php?';
const vf_c_script_das_nomenclatures_ven='_graal_das_art_nomenclatures_ven_01.php?';
const vf_c_fen_art_acteur='_graal_fen_art_acteur_01.php?';
const vf_c_fen_art_tarifs='_graal_fen_art_tarifs_01.php?';
const vf_c_fen_relations="_graal_fen_art_relation_01.php?";
const vf_c_fen_relations_fiche="_graal_fen_art_relation_02.php?";
const vf_c_fen_criteres='_graal_fen_art_criteres.php?';
const vf_c_script_ged='_graal_rech_ged_01.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=777777&';
const vf_c_script_images='_graal_rech_ged_02.php?sortie=das&vl_c_actifs=0&vl_c_type=1&vl_c_qui=777777&';
const vf_c_fen_pseudosliens="_graal_fen_pseudodocs_01.php?quelsdocs=unlien_articl&genre=articl&";
const vf_c_fen_notes="_graal_fen_note_01.php?quelsdocs=unenot_articl&genre=articl&";
const vf_c_script_affiche_image="_graal_bdope_affiche_image_01.php?";
const vf_c_script_fen_action='_graal_fen_actions_02.php?';
const vf_c_script_das_offcli="_graal_das_art_actions_offcli_01.php?";
const vf_c_script_das_cdecli="_graal_das_art_actions_cdecli_01.php?";
const vf_c_script_das_faccli="_graal_das_art_actions_faccli_01.php?";
const vf_c_script_das_demfou="_graal_das_art_actions_demfou_01.php?";
const vf_c_script_das_cdefou="_graal_das_art_actions_cdefou_01.php?";
const vf_c_script_das_recfou="_graal_das_art_actions_recfou_01.php?";
const vf_c_script_das_facfou="_graal_das_art_actions_facfou_01.php?";
const vf_c_script_das_fabriq="_graal_das_art_actions_fabriq_01.php?";
const vf_c_script_das_retcli="_graal_das_art_actions_retcli_01.php?";
const vf_c_script_das_retfou="_graal_das_art_actions_retfou_01.php?";
const vf_c_fen_stat='_graal_fen_graphiques_stat_01.php?genre=article_un&';
const c_script_xml_nomenclature_fab="_graal_xml_art_nomenclatures_fab_01.php?";
const c_script_xml_nomenclature_ach="_graal_xml_art_nomenclatures_ach_01.php?";
const c_script_xml_nomenclature_ven="_graal_xml_art_nomenclatures_ven_01.php?";
const c_script_recherche_article_nomencach="_graal_das_art_selection.php?actif=1&portee=-1&type_recherche=1&";  //  Recherche des articles actifs
const c_script_recherche_article_nomencven="_graal_das_art_selection.php?actif=1&portee=-1&type_recherche=1&";  //  Recherche des articles actifs
const c_nolignemax_ach="_graal_xml_nolignemax_nomencach.php?vl_e_art_cleunik=";
const c_nolignemax_ven="_graal_xml_nolignemax_nomencven.php?vl_e_art_cleunik=";
const c_script_tar_valorisation_nomenc_ach="_graal_das_art_tarifs_type_nomenc.php?";
const c_script_tar_valorisation_nomenc_ven="_graal_das_art_tarifs_type_nomenc.php?";
const c_script_favoris_partage='_graal_fen_favoris_partage_01.php?vf_c_type_favori=4&';
const c_script_das_compta="_graal_das_art_compta_01.php?vl_e_art_cleunik=";
const c_fen_compta="_graal_fen_art_compta_01.php?";
const c_fen_duplication="_graal_fen_art_duplication.php?";
const c_script_bdope_nomenclature_ach='_graal_bdope_nomenclatures_ach_01.php';
const c_script_bdope_nomenclature_ven='_graal_bdope_nomenclatures_ven_01.php';
const c_script_libart="_graal_das_art_libelles_01.php?vl_e_art_cleunik=";
const c_script_fen_libart="_graal_fen_art_libelles_01.php?vl_e_art_cleunik=";
const c_fen_selection_dossiers='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=dossiers&retour=oui&';
const c_bdope_dossiers='_graal_bdope_note_01.php?vf_c_action=insere_dans_dossier&type_insertion_dossier=article&vf_e_doc_cleunik=';
var lstn_ml_nomencach_base_valorisation = { 
    willRebuild : function(event){},
    didRebuild  : function(event){pf_nomclatureach_base_valorisation_faite(event);} 
  };
var lstn_ml_nomencven_base_valorisation = { 
    willRebuild : function(event){},
    didRebuild  : function(event){pf_nomclatureven_base_valorisation_faite(event);} 
  };
const lstn_grise = { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");} 
};
function pf_aa_init() {
  fa_sep("tb_delai_reappro");
  fa_sep("tb_der_pa");
  fa_sep("tb_pamp");
  fa_sep("tb_pr_generique");
  fa_sep("tb_pr");
  fa_sep("tb_nbdec_pr");
  
	fa_sep("tb_nomencach_noligne");
  fa_sep("tb_nomencach_quantite");
  fa_sep("tb_nomencach_nbdecimales");
  fa_sep("tb_nomencach_valorisation");
  fa_sep("tb_nomencach_valeur_complement");
  fa_sep("tb_nomencach_valeurligne");
  
	
	
  var ladate=new Date();
  fa_value_set("tb_selvalidite",ladate.getDate()+"/"+(ladate.getMonth()+1)+"/"+ladate.getFullYear());
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui('broadcaster_01');
  vf_e_art_cleunik=-1;
  pf_param_choix_selart_nomenc_ach();
  vf_saisie_nomencach_encours=true;
	fa_badl("ml_nomencach_base_valorisation",lstn_ml_nomencach_base_valorisation);
	pf_param_choix_selart_nomenc_ven();
  vf_saisie_nomencven_encours=true;
	fa_badl("ml_nomencven_base_valorisation",lstn_ml_nomencven_base_valorisation);
	fa_badl("arbre_des_articles",lstn_grise);
	fa05_sel_date('21','bfp_tb_deb','bfp_tb_fin');fa_check("-me_tb_deb_21");
  $js_aa_init_01
  $js_popup_arbre_article
}
function pf_action(vv_quoi) {
  var vl_c_param;
  var raf_random=Math.random();
  switch (vv_quoi) {
    case 'duplication':
      vl_c_param="vl_art_cleunik="+vf_e_art_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_ouvre(c_fen_duplication+vl_c_param,400,400);
      break;
    case 'favoris_ajout':
      vl_c_param="vf_c_action=ajouter&vf_c_quoi=1&";
      vl_c_param+="vl_art_cleunik="+vf_e_art_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'favoris_supprimer':
      vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&";
      vl_c_param+="vl_art_cleunik="+vf_e_art_cleunik+"&";
      vl_c_param+="raf_random="+raf_random+"&";
      fa_xmlhttprequest_xml(vf_c_script_favoris,vl_c_param,pf_action_fin_02,'');
      break;
    case 'dossier_ajouter':
    	fa_ouvre(c_fen_selection_dossiers,1000,800);
      break;
  }
}
function pf_action_fin_01(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("$vl_c_bbo_126js");} else {alert("$vl_c_bbo_127js");}
}
function pf_action_fin_02(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") { alert("$vl_c_bbo_128js");} else {alert("$vl_c_bbo_129js");}
}
function pf_affiche_donnees_articles_infogene(stream) {
var vl_e_types_gestion,vl_e_choix_cleunik,vl_e_unite_stock,vl_e_unite_condi;
var vl_c_datas=stream;
pf_raz_fiche();
fa_cache_non("tab_relations");fa_cache_non("tab_tarifs");
vf_e_art_cleunik=fa_xml_get(vl_c_datas,'art_cleunik')
fa_value_set('tb_mnemotechnique',fa_xml_get(vl_c_datas,'mnemotechnique'));
fa_value_set('tb_mnemotechnique_bis',fa_xml_get(vl_c_datas,'mnemotechnique'));
fa_value_set('tb_description',fa_xml_get(vl_c_datas,'description'));
fa_value_set('tb_description_bis',fa_xml_get(vl_c_datas,'description'));
fa_value_set('tb_code',fa_xml_get(vl_c_datas,'code'));
fa_value_set('tb_code_bis',fa_xml_get(vl_c_datas,'code'));
fa_value_set('tb_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
fa_value_set('la_dateheurecreation',fa_xml_get(vl_c_datas,'dateheurecreation'));
fa_value_set('la_dateheuremodification',fa_xml_get(vl_c_datas,'dateheuremodif'));
fa_value_set('rdg_acteur_actif',fa_xml_get(vl_c_datas,'actif'));
fa_value_set('tb_pr_generique',fa_xml_get(vl_c_datas,'pr_generique'));
pf_affiche_donnees_libelles();
  fa_value_set('tb_multiple_base',fa_xml_get(vl_c_datas,'multiple_base'));
  fa_value_set('tb_pr',fa_xml_get(vl_c_datas,'pr'));
  fa_value_set('tb_nbdec_pr',fa_xml_get(vl_c_datas,'nbdec_pr'));

fa_mlsel("ml_nbdec_prix",fa_xml_get(vl_c_datas,'nbdec_prix'),"value");
fa_mlsel("ml_nbdec_qte",fa_xml_get(vl_c_datas,'nbdec_qte'),"value");
fa_mlsel("ml_unite_capacite",fa_xml_get(vl_c_datas,'unite_capacite'));
fa_value_set('tb_capacite',fa_xml_get(vl_c_datas,'capacite'));
fa_value_set("tb_dateheurevalidite",fa_xml_get(vl_c_datas,'dateheurevalidite'));
fa_mlsel("ml_unite_vente",fa_xml_get(vl_c_datas,'unite_vente'));
pf_affiche_donnees_criteres_entreprise();pf_affiche_donnees_criteres_lesmiens();pf_affiche_donnees_criteres_lesautres();pf_affiche_donnees_criteres_tous();
pf_affiche_donnees_relations();
pf_affiche_donnees_compta();
fa_cache_non("tab_ged");fa_cache_non("tab_images");
pf_affiche_donnees_ged();pf_affiche_donnees_images();
vl_e_types_gestion=fa_xml_get(vl_c_datas,'types_gestion');
vf_e_nombre_utilisations_cial=fa_xml_get(vl_c_datas,'t0');
if (fa_xml_get(vl_c_datas,'t0')=="0") {fa_cache_oui("tab_actions");} else {fa_cache_non("tab_actions");}
if (fa_xml_get(vl_c_datas,'t1')=="0") {fa_cache_oui("tab_cial_offcli");} else {fa_cache_non("tab_cial_offcli");}
if (fa_xml_get(vl_c_datas,'t2')=="0") {fa_cache_oui("tab_cial_cdecli");} else {fa_cache_non("tab_cial_cdecli");}
if (fa_xml_get(vl_c_datas,'t4')=="0") {fa_cache_oui("tab_cial_faccli");} else {fa_cache_non("tab_cial_faccli");}
if (fa_xml_get(vl_c_datas,'t5')=="0") {fa_cache_oui("tab_cial_demfou");} else {fa_cache_non("tab_cial_demfou");}
if (fa_xml_get(vl_c_datas,'t6')=="0") {fa_cache_oui("tab_cial_cdefou");} else {fa_cache_non("tab_cial_cdefou");}
if (fa_xml_get(vl_c_datas,'t7')=="0") {fa_cache_oui("tab_cial_recfou");} else {fa_cache_non("tab_cial_recfou");}
if (fa_xml_get(vl_c_datas,'t8')=="0") {fa_cache_oui("tab_cial_facfou");} else {fa_cache_non("tab_cial_facfou");}
if (fa_xml_get(vl_c_datas,'t11')=="0") {fa_cache_oui("tab_cial_retfou");} else {fa_cache_non("tab_cial_retfou");}
fa_cache_oui("bdg_articles_tarifs_achats_02");
fa_cache_oui("bdg_articles_tarifs_ventes_02");
if ((vl_e_types_gestion & 1)==1) {
  //  Gestion des achats
  pf_affiche_donnees_art_four();
	fa_cache_non("bdg_articles_tarifs_achats_02");
  pf_affiche_donnees_tarif_type_achat();
  pf_affiche_donnees_tarif_particulier_achat();
  fa_check('ch_n01');
  fa_cache_non("tab_achats");  
  fa_value_set('tb_delai_reappro',fa_xml_get(vl_c_datas,'delai_reappro'));
  fa_value_set('tb_der_pa',fa_xml_get(vl_c_datas,'der_pa'));
  fa_value_set('tb_pamp',fa_xml_get(vl_c_datas,'pamp'));
  fa_value_set('dateheure_der_achat',fa_xml_get(vl_c_datas,'dateheure_der_achat'));
  fa_mlsel("ml_unite_reappro",fa_xml_get(vl_c_datas,'unite_reappro'));
  fa_mlsel("ml_unite_achat",fa_xml_get(vl_c_datas,'unite_achat'));
  pf_affiche_donnees_nomenclature_ach();
}
if ((vl_e_types_gestion & 2)==2) {
  //  Gestion des ventes
	fa_cache_non("bdg_articles_tarifs_ventes_02");
  pf_affiche_donnees_tarif_type_vente();
  pf_affiche_donnees_art_client();
  pf_affiche_donnees_tarif_particulier_vente();
	pf_affiche_donnees_nomenclature_ven();
  fa_cache_non("tab_ventes");
  fa_check('ch_n02');
}
fa_grise_fenetre("","non");
}
function pf_affiche_donnees_art_four() {
  var vl_c_param=vf_c_script_das_art_four+"vl_e_act_cleunik=-1&vl_e_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("arbre_art_fournisseurs",vl_c_param);
}
function pf_affiche_donnees_art_client() {
  var vl_c_param=vf_c_script_das_art_cli+"vl_e_act_cleunik=-1&vl_e_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("arbre_art_clients",vl_c_param);
}
function pf_affiche_donnees_compta() {
  var vl_c_param=c_script_das_compta+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("arbre_compta",vl_c_param);
}
function pf_affiche_donnees_criteres_entreprise() {
  var vl_c_param=vf_c_script_critere_art_entreprise+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_articles_entreprise",vl_c_param);
}
function pf_affiche_donnees_criteres_lesautres() {
  var vl_c_param=vf_c_script_critere_art_lesautres+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_articles_lesautres",vl_c_param);
}
function pf_affiche_donnees_criteres_lesmiens() {
  var vl_c_param=vf_c_script_critere_art_lesmiens+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_articles_lesmiens",vl_c_param);
}
function pf_affiche_donnees_criteres_tous() {
  var vl_c_param=vf_c_script_critere_art_tous+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_articles_tous",vl_c_param);
}
function pf_affiche_donnees_ged() {
  var vl_c_param=vf_c_script_ged+'vl_e_portee_cleunik='+vf_e_art_cleunik+'&raf_random='+Math.random()+'&';
  fa_das("arbre_des_ged",vl_c_param);
}
function pf_affiche_donnees_images() {
  var vl_c_param=vf_c_script_images+'vl_e_portee_cleunik='+vf_e_art_cleunik+'&raf_random='+Math.random()+'&';
  fa_das("arbre_des_images",vl_c_param);
}
function pf_affiche_donnees_libelles(){
	fa_das("ml_lib_art",c_script_libart+vf_e_art_cleunik+'&raf_random='+Math.random()+'&');
}
function pf_affiche_donnees_mousto() {
  var vl_c_param=c_script_das_mousto+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_ds("arbre_des_mousto",vl_c_param);
}
function pf_affiche_donnees_nomenclature_ach() {
  var vl_c_param="vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_xmlhttprequest_xml(vf_c_script_das_nomenclatures_ach,vl_c_param,pf_alimente_arbre_nomenclatures_ach,'');
}
function pf_affiche_donnees_nomenclature_ven() {
  var vl_c_param="vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&";
  fa_xmlhttprequest_xml(vf_c_script_das_nomenclatures_ven,vl_c_param,pf_alimente_arbre_nomenclatures_ven,'');
}
function pf_affiche_donnees_nomenclature_ach_detail(vv_stream) {
  var vl_c_datas=vv_stream;
  fa_value_set('tb_nomencach_noligne',fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencach_codefils',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_nomencach_codefils',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik_fils'));
  fa_att_set('tb_nomencach_codefils',"_graal_noligne",fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencach_descourfils',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_nomencach_quantite',fa_xml_get(vl_c_datas,'quantite'));
  fa_value_set('tb_nomencach_nbdecimales',fa_xml_get(vl_c_datas,'nb_decimales_qte'));
  fa_value_set('tb_nomencach_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set('tb_nomencach_valorisation',fa_xml_get(vl_c_datas,'base_valorisation'));
  fa_value_set('tb_nomencach_valeur_complement',fa_xml_get(vl_c_datas,'valeur_complement'));
  var vl_e_nombre=2;
  for(var i=0;i<vl_e_nombre;i++){
    fa_gid("ml_nomencach_valeur_complement_type").selectedIndex=i;
    if (fa_xml_get(vl_c_datas,'valeur_complement_type')==fa_value_get("ml_nomencach_valeur_complement_type")){break;}
  }
  fa_att_set("tb_nomencach_valorisation","_graal_base_valorisation",fa_xml_get(vl_c_datas,'base_valorisation'));
}
function pf_affiche_donnees_nomenclature_fab_detail(vv_stream) {
  var vl_c_datas=vv_stream;
  fa_value_set('tb_nomencfab_noligne',fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencfab_codefils',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_nomencfab_codefils',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik_fils'));
  fa_att_set('tb_nomencfab_codefils',"_graal_noligne",fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencfab_descourfils',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_nomencfab_quantite',fa_xml_get(vl_c_datas,'quantite'));
  fa_value_set('tb_nomencfab_nbdecimales',fa_xml_get(vl_c_datas,'nb_decimales_qte'));
  fa_value_set('tb_nomencfab_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set('tb_nomencfab_valorisation',fa_xml_get(vl_c_datas,'base_valorisation'));
  fa_value_set('tb_nomencfab_valeur_complement',fa_xml_get(vl_c_datas,'valeur_complement'));
  var vl_e_nombre=2;
  for(var i=0;i<vl_e_nombre;i++){
    fa_gid("ml_nomencfab_valeur_complement_type").selectedIndex=i;
    if (fa_xml_get(vl_c_datas,'valeur_complement_type')==fa_value_get("ml_nomencfab_valeur_complement_type")){break;}
  }
  fa_att_set("tb_nomencfab_valorisation","_graal_base_valorisation",fa_xml_get(vl_c_datas,'base_valorisation'));
}
function pf_affiche_donnees_nomenclature_ven_detail(vv_stream) {
  var vl_c_datas=vv_stream;
  fa_value_set('tb_nomencven_noligne',fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencven_codefils',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_nomencven_codefils',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik_fils'));
  fa_att_set('tb_nomencven_codefils',"_graal_noligne",fa_xml_get(vl_c_datas,'noligne'));
  fa_value_set('tb_nomencven_descourfils',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_nomencven_quantite',fa_xml_get(vl_c_datas,'quantite'));
  fa_value_set('tb_nomencven_nbdecimales',fa_xml_get(vl_c_datas,'nb_decimales_qte'));
  fa_value_set('tb_nomencven_blocnotebrut',fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set('tb_nomencven_valorisation',fa_xml_get(vl_c_datas,'base_valorisation'));
  fa_value_set('tb_nomencven_valeur_complement',fa_xml_get(vl_c_datas,'valeur_complement'));
  var vl_e_nombre=2;
  for(var i=0;i<vl_e_nombre;i++){
    fa_gid("ml_nomencven_valeur_complement_type").selectedIndex=i;
    if (fa_xml_get(vl_c_datas,'valeur_complement_type')==fa_value_get("ml_nomencven_valeur_complement_type")){break;}
  }
  fa_att_set("tb_nomencven_valorisation","_graal_base_valorisation",fa_xml_get(vl_c_datas,'base_valorisation'));
}
function pf_affiche_donnees_relations() {
  var vl_c_param=vf_c_script_relations+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&vf_c_genre=A&";
  fa_das("arbre_relations",vl_c_param);
}
function pf_affiche_donnees_tarif_particulier_achat() {
  var vl_c_param=vf_c_script_das_tarifs_particulier_achats+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&actif="+fa_value_get("ml_tpa_actif")+"&";
  fa_ds("arbre_tarif_particulier_achat","");
  fa_ds("arbre_tarif_particulier_achat",vl_c_param);
}
function pf_affiche_donnees_tarif_type_achat() {
  var vl_c_param=vf_c_script_das_tarifs_type_achats+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&actif="+fa_value_get("ml_tta_actif")+"&";
  fa_ds("arbre_tarif_type_achat","");
  fa_ds("arbre_tarif_type_achat",vl_c_param);
}
function pf_affiche_donnees_tarif_particulier_vente() {
  var vl_c_param=vf_c_script_das_tarifs_particulier_ventes+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&actif="+fa_value_get("ml_tpv_actif")+"&";
  fa_ds("arbre_tarif_particulier_vente","");
  fa_ds("arbre_tarif_particulier_vente",vl_c_param);
}
function pf_affiche_donnees_tarif_type_vente() {
  var vl_c_param=vf_c_script_das_tarifs_type_ventes+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&actif="+fa_value_get("ml_ttv_actif")+"&";
  fa_ds("arbre_tarif_type_vente","");
  fa_ds("arbre_tarif_type_vente",vl_c_param);
}
function pf_affiche_image() {
  var i=fa_cui("arbre_des_images");if(i==-1){return;}
  vl_e_doc_cleunik=fa_cell_get("arbre_des_images",i,"image_doc_cleunik");
  fa_att_set("ifr_image","src",vf_c_script_affiche_image+'doc_cleunik='+vl_e_doc_cleunik );
}
function pf_alimente_arbre_nomenclatures_ach(xml) {
  fa_vide_arbre("fils_arbre_nomenc_ach");
  try {
    pf_parcours_fichier_xml_nomenclature(xml.documentElement,fa_gid("fils_arbre_nomenc_ach"));
  } catch(e) {}
}
function pf_alimente_arbre_nomenclatures_ven(xml) {
	fa_vide_arbre("fils_arbre_nomenc_ven");
  try {
    pf_parcours_fichier_xml_nomenclature(xml.documentElement,fa_gid("fils_arbre_nomenc_ven"));
  } catch(e) {}
}
function pf_approximatif_bfp() {
  var vl_c_script="",vl_c_arbre="";
  switch (fa_value_get("tabs_cial")) {
    case "1": vl_c_script=vf_c_script_das_offcli;vl_c_arbre="tr_art_actions_offcli_01";break;
    case "2": vl_c_script=vf_c_script_das_cdecli;vl_c_arbre="tr_art_actions_cdecli_01";break;
    case "3": vl_c_script=vf_c_script_das_livcli;vl_c_arbre="tr_art_actions_livcli_01";break;
    case "4": vl_c_script=vf_c_script_das_retcli;vl_c_arbre="tr_art_actions_retcli_01";break;
    case "5": vl_c_script=vf_c_script_das_faccli;vl_c_arbre="tr_art_actions_faccli_01";break;
    case "6": vl_c_script=vf_c_script_das_demfou;vl_c_arbre="tr_art_actions_demfou_01";break;
    case "7": vl_c_script=vf_c_script_das_cdefou;vl_c_arbre="tr_art_actions_cdefou_01";break;
    case "8": vl_c_script=vf_c_script_das_recfou;vl_c_arbre="tr_art_actions_recfou_01";break;
    case "9": vl_c_script=vf_c_script_das_retfou;vl_c_arbre="tr_art_actions_retfou_01";break;
    case "10": vl_c_script=vf_c_script_das_facfou;vl_c_arbre="tr_art_actions_facfou_01";break;
  }
  var vl_c_param=vl_c_script+"vl_art_cleunik="+vf_e_art_cleunik+"&raf_random="+Math.random()+"&vl_c_dateheuredebut="+fa_enc(fa_date_formate(fa_value_get("bfp_tb_deb"),"AAAAMMJJ"))+"&vl_c_dateheurefin="+fa_enc(fa_date_formate(fa_value_get("bfp_tb_fin"),"AAAAMMJJ"))+"&statut="+fa_enc(fa_mlget("ml_statut_action_cial_rech"))+"&limit="+fa_value_get("bfp_tb_limit")+"&";
  fa_das(vl_c_arbre,vl_c_param);
}
function pf_boutons_nomenc_ach(i) { 
  fa_grise_oui("bt_val_nomencach");
  fa_grise_oui('bt_nomclatureach_modifier');
  fa_grise_oui('bt_nomclatureach_supprimer');
  fa_grise_oui('bt_nomclatureach_ajouter');
  fa_grise_oui('bt_nomencfab_annuler');
  if (!fa_est_grise("bt_enregistrer")) {
    if (((fa_cell_get("arbre_nomenc_ach",i,"arbre_nomenc_ach_modifiable") == 0) & (i!=0))) {
      fa_grise_non('bt_nomclatureach_modifier');
      fa_grise_non('bt_nomclatureach_supprimer');
      fa_grise_non('bt_nomclatureach_ajouter');
      fa_grise_non("bt_val_nomencach");
      fa_grise_non('bt_nomencach_annuler');
    }
    if (i==0) {
      fa_grise_non('bt_nomclatureach_ajouter');
      fa_grise_non("bt_val_nomencach");
      fa_grise_non('bt_nomencach_annuler');
    }
  }  
}
function pf_boutons_nomenc_ven(i) { 
  fa_grise_oui("bt_val_nomencven");
  fa_grise_oui('bt_nomclatureven_modifier');
  fa_grise_oui('bt_nomclatureven_supprimer');
  fa_grise_oui('bt_nomclatureven_ajouter');
  fa_grise_oui('bt_nomencven_annuler');
  if (!fa_est_grise("bt_enregistrer")) {
    if (((fa_cell_get("arbre_nomenc_ven",i,"arbre_nomenc_ven_modifiable") == 0) & (i!=0))) {
      fa_grise_non('bt_nomclatureven_modifier');
      fa_grise_non('bt_nomclatureven_supprimer');
      fa_grise_non('bt_nomclatureven_ajouter');
      fa_grise_non("bt_val_nomencven");
      fa_grise_non('bt_nomencven_annuler');
    }
    if (i==0) {
      fa_grise_non('bt_nomclatureven_ajouter');
      fa_grise_non("bt_val_nomencven");
      fa_grise_non('bt_nomencven_annuler');
    }
  }  
}
function pf_dblclick_arbre_art_actions(vv_arbre) {
  var vl_e_action_cleunik=-1,vl_c_donnees="",vl_c_nom="";
  var rowIndex = fa_cui(vv_arbre);if(rowIndex == -1){return;}
  switch (vv_arbre) {
    case "tr_art_actions_cdecli_01":vl_c_nom="tc_cdecli_action_cleunik";break;
    case "tr_art_actions_cdefou_01":vl_c_nom="tc_cdefou_action_cleunik";break;
    case "tr_art_actions_demfou_01":vl_c_nom="tc_demfou_action_cleunik";break;
    case "tr_art_actions_faccli_01":vl_c_nom="tc_faccli_action_cleunik";break;
    case "tr_art_actions_facfou_01":vl_c_nom="tc_facfou_action_cleunik";break;
    case "tr_art_actions_livcli_01":vl_c_nom="tc_livcli_action_cleunik";break;
    case "tr_art_actions_offcli_01":vl_c_nom="tc_offcli_action_cleunik";break;
    case "tr_art_actions_recfou_01":vl_c_nom="tc_recfou_action_cleunik";break;
    case "tr_art_actions_retcli_01":vl_c_nom="tc_retcli_action_cleunik";break;
    case "tr_art_actions_retfou_01":vl_c_nom="tc_retfou_action_cleunik";break;
  }
  vl_e_action_cleunik=fa_cell_get(vv_arbre,rowIndex,vl_c_nom);
  vl_c_donnees="vf_e_action_cleunik="+fa_enc(vl_e_action_cleunik)+"&vf_c_action=modifier&genreaction=jenesaispas&";
  fa_ouvre(vf_c_script_fen_action+vl_c_donnees,1000,700)
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  var vl_portee;
  switch(vv_quoi) {
    case "ini":
      break;
    case "selectionner":
      //  créer l'algo pour empêcher la suppression si utilisé
      if (vf_e_art_cleunik==-1) {return;}
      fa_grise_non("bt_modifier");
      //if (vf_e_nombre_utilisations_fab==0) {fa_grise_non("bt_supprimer");}
      {((vf_e_nombre_utilisations_fab+vf_e_nombre_utilisations_cial)==0) ? fa_grise_non("bt_supprimer") : fa_grise_oui("bt_supprimer")} 
      if (vf_e_art_cleunik==0){
      	fa_grise_oui("bt_supprimer");
      }
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "modifier":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");
      fa_grise_non("bt_annuler");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne('tb_description');
			var i=fa_cui("arbre_nomenc_ach");if(i==-1){return;} else {pf_boutons_nomenc_ach(i);}
			i=fa_cui("arbre_nomenc_ven");if(i==-1){return;} else {pf_boutons_nomenc_ven(i);}
      break;
    case "old_ajouter":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");
      fa_grise_non("bt_annuler");
      fa_cache_oui("tab_achats");fa_cache_oui("tab_ventes");fa_cache_oui("tab_relations");fa_cache_oui("tab_tarifs");
      fa_cache_oui("tab_criteres");fa_cache_oui("tab_actions");fa_cache_oui("tab_ged");fa_cache_oui("tab_images");
      pf_raz_fiche();
      fa_gid("tab_infogene").selectedIndex=0;
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne('tb_code');
      break;
    case "ajouter":
   	  fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_enregistrer");
      fa_grise_non("bt_annuler");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne('tb_description')
          fa_grise_fenetre("","oui");
          var vl_c_param='vf_c_action=dupliquer_ajouter&';
          fa_xmlhttprequest_txt(vf_c_script_bdope_art,vl_c_param,pf_retour_dupliq);
          break;
      
    case "annuler":
      pf_raz_fiche()
      fa_gid("tab_infogene").selectedIndex=0;
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_supprimer");
      fa_grise_non("bt_detailler");
      fa_grise_non("bt_ajouter");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_groupe_oui('broadcaster_01');
      $js_annuler_01
      fa_cache_non("tab_achats");fa_cache_non("tab_ventes");fa_cache_non("tab_relations");fa_cache_non("tab_tarifs");
      fa_cache_non("tab_criteres");fa_cache_non("tab_actions");fa_cache_non("tab_ged");fa_cache_non("tab_images");
      break;
    case "sortir":
      window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
      break;   
    default:
      break;
}
  }
function pf_favoris_partager() {
  var vl_c_param;
  vl_c_param="vf_e_cleunik="+vf_e_art_cleunik+"&";
  vl_c_param+="raf_random="+Math.random()+"&";
  fa_ouvre(c_script_favoris_partage+vl_c_param,500,60);
}
function pf_ged_ajout(vv_quoi_01) {
  var vl_c_param='portee_cleunik='+vf_e_art_cleunik+'&doc_cleunik=-1&';
  switch (vv_quoi_01){
    case "ged_lien":
      fa_ouvre(vf_c_fen_pseudosliens+vl_c_param,800,300);
      break;
    case "ged_note":
      fa_ouvre(vf_c_fen_notes+vl_c_param,800,500);
      break;
    case "ged_doc":
			pf07_ouvre_doc("quelsdocs=undoc_articl&genre=articl&"+vl_c_param);
      break;
    case "ged_image":
			pf07_ouvre_doc("quelsdocs=uneimg_articl&genre=articl&"+vl_c_param);
      break;
  }
}
function pf_ged_image_ouvre(vv_quoi_01) {
  var rowIndex = fa_cui("arbre_des_images");if(rowIndex == -1){return;}
  var vl_e_doc_cleunik=fa_cell_get("arbre_des_images",rowIndex,"image_doc_cleunik");
  var vl_c_param='portee_cleunik='+vf_e_art_cleunik+"&doc_cleunik="+vl_e_doc_cleunik+"&";
  if (fa_gid("tb_ged_image_02")!=null) {fa_ouvre(vf_c_fen_image+vl_c_param,800,300);}
}
function pf_grise_boutons_interlo() {
  fa_grise_oui("tb_interlo_01");fa_grise_oui("tb_interlo_02");
  fa_grise_oui("tb_tel_01");fa_grise_oui("tb_tel_02");fa_grise_oui("tb_tel_03");fa_grise_oui("tb_tel_04");
  fa_grise_oui("tb_fax_01");fa_grise_oui("tb_fax_02");fa_grise_oui("tb_fax_03");
  fa_grise_oui("tb_courriel_01");fa_grise_oui("tb_courriel_02");fa_grise_oui("tb_courriel_03");fa_grise_oui("tb_courriel_04");
}
function pf_libart(){
	if (vf_e_art_cleunik==-1) {return;}
	var vo_list = document.getElementById("ml_lib_art");
  var vo_item = vo_list.selectedItem;
  var vl_langue=vo_item.getAttribute("_graal_langue");
  var vl_genre=vo_item.getAttribute("_graal_genre");
	switch (vl_langue) {
		case "":return;break;
		default:
			fa_ouvre(c_script_fen_libart+vf_e_art_cleunik+"&vl_e_langue="+vl_langue+"&vl_e_genre="+vl_genre,600,600);
			break;
	}
}
function pf_nomclatureach_ajouter() {
  pf_nomclatureach_raz();
  fa_grise_oui('bt_nomclatureach_modifier');
  fa_grise_oui('bt_nomclatureach_supprimer');
  fa_grise_oui('bt_nomclatureach_ajouter');
	fa_grise_non('bt_nomencach_annuler');
  vf_saisie_nomencach_encours=true;
  vf_c_nomencach="ajouter";
  fa_att_set("tb_nomencach_valorisation","_graal_base_valorisation","$param_generaux_graal_025");
  fa_xmlhttprequest_xml(c_nolignemax_ach+vf_e_art_cleunik,"",pf_nomclatureach_ajouter_fin);
}
function pf_nomclatureach_ajouter_fin(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_nomencach_noligne',fa_xml_get(vl_c_datas,'maxnoligne'));
  fa_grise_groupe_non('broadcaster_03');
  fa_focusdonne('selart_nomenc_ach');
}
function pf_nomclatureach_annuler() {
  pf_nomclatureach_raz();
  fa_grise_non('bt_nomclatureach_modifier');
  fa_grise_non('bt_nomclatureach_supprimer');
  fa_grise_non('bt_nomclatureach_ajouter');
}
function pf_nomclatureach_base_valorisation_faite(event) {
  fa_gid("ml_nomencach_base_valorisation").selectedIndex=0;
  var vl_e_nombre=fa_mlget("ml_nomencach_base_valorisation","_graal_nombre");
  var base_valorisation=fa_att_get("tb_nomencach_valorisation","_graal_base_valorisation");
  for(var i=0;i<vl_e_nombre;i++){
    fa_gid("ml_nomencach_base_valorisation").selectedIndex=i;
    fa_att_set("ml_nomencach_base_valorisation","class",fa_mlget("ml_nomencach_base_valorisation","class"));
    if (base_valorisation==fa_mlget("ml_nomencach_base_valorisation","_graal_cleunik")){
      fa_value_set("tb_nomencach_valorisation",fa_mlget("ml_nomencach_base_valorisation","_graal_base_valorisation"));
      break;
    }
  }
  pf_nomenclatureach_valorise();
}
function pf_nomclatureach_change_menu_actifs_base_valorisation() {
  var vo_list = fa_gid("ml_nomencach_base_valorisation");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
  fa_value_set("tb_nomencach_valorisation",vo_item.getAttribute("_graal_base_valorisation"));
  pf_nomenclatureach_valorise();
}
function pf_nomclatureach_modifier() {
	if (fa_att_get('tb_nomencach_codefils',"_graal_cleunik")==-1) {return;}
  fa_grise_oui('bt_nomclatureach_modifier');
  fa_grise_oui('bt_nomclatureach_supprimer');
  fa_grise_oui('bt_nomclatureach_ajouter');
	fa_grise_non('bt_nomencach_annuler');
  vf_saisie_nomencach_encours=true;
  vf_c_nomencach="modifier";
  fa_grise_groupe_non('broadcaster_03');
  fa_grise_oui("tb_nomencach_noligne");
  fa_grise_oui("selart_nomenc_ach_ml_zone");
  fa_grise_oui("selart_nomenc_ach");
  fa_focusdonne("tb_nomencach_quantite");
}
function pf_nomclatureach_raz() {
  fa_grise_groupe_oui('broadcaster_03');
  fa_value_set('selart_nomenc_ach',"");
  fa_value_set('tb_nomencach_codefils',"");
  fa_value_set('tb_nomencach_descourfils',"");
  fa_value_set('tb_nomencach_quantite',"");
  fa_value_set('tb_nomencach_nbdecimales',"");
  fa_value_set('tb_nomencach_blocnotebrut',"");
  vf_saisie_nomencach_encours=false;
  fa_att_set('tb_nomencach_codefils',"_graal_cleunik",-1);
  fa_value_set("tb_nomencach_valeur_complement","");
  fa_value_set("tb_nomencach_valeurligne","");
  fa_value_set("tb_nomencach_valorisation","");
}
function pf_nomclatureach_sel_article_pour_ligne() {
  var vl_e_cleunik=fa_att_get('selart_nomenc_ach','_graal_cleunik');
  fa_das("ml_nomencach_base_valorisation",c_script_tar_valorisation_nomenc_ach+"actif=1&vl_art_cleunik="+vl_e_cleunik+"&");
  fa_xmlhttprequest_xml(c_script_xml_art_pour_nomencach+vl_e_cleunik,"",pf_nomclatureach_sel_article_pour_ligne_fin);
}
function pf_nomclatureach_sel_article_pour_ligne_fin(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_nomencach_descourfils',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_nomencach_codefils',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_nomencach_codefils',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik'));
	fa_focusdonne('tb_nomencach_quantite');
}
function pf_nomclatureach_supprimer() {
	if (fa_att_get('tb_nomencach_codefils',"_graal_cleunik")==-1) {return;}
  if (confirm("$vl_c_bbo_122js")==false) {return;}
  var vl_c_donnees="";
  vl_c_donnees+="vl_art_cleunik_pere="+fa_enc(vf_e_art_cleunik)+"&";
  vl_c_donnees+="vl_art_cleunik_fils="+fa_enc(fa_att_get('tb_nomencach_codefils',"_graal_cleunik"))+"&";
  vl_c_donnees+="vl_noligne="+fa_enc(fa_att_get('tb_nomencach_codefils',"_graal_noligne"))+"&";
  vl_c_donnees+="vf_c_action=supprimer";
  fa_xmlhttprequest_txt(c_script_bdope_nomenclature_ach,vl_c_donnees,pf_nomclatureach_valider_suite);
}
function pf_nomclatureach_valider() {
  if (fa_att_get('tb_nomencach_codefils',"_graal_cleunik")==-1) {return;}
  var vl_c_donnees="";
  vl_c_donnees+="vl_art_cleunik_pere="+fa_enc(vf_e_art_cleunik)+"&";
  vl_c_donnees+="vl_art_cleunik_fils="+fa_enc(fa_att_get('tb_nomencach_codefils',"_graal_cleunik"))+"&";
  vl_c_donnees+="vl_noligne="+fa_enc(fa_att_get('tb_nomencach_codefils',"_graal_noligne"))+"&";
  vl_c_donnees+="vl_noligne_nouvelle="+fa_enc(fa_value_get("tb_nomencach_noligne"))+"&";
  vl_c_donnees+="vl_quantite="+fa_enc(fa_value_get("tb_nomencach_quantite"))+"&";
  vl_c_donnees+="vl_nb_decimales_qte="+fa_enc(fa_value_get("tb_nomencach_nbdecimales"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_nomencach_blocnotebrut"))+"&";
  vl_c_donnees+="vl_valeur_complement="+fa_enc(fa_value_get("tb_nomencach_valeur_complement"))+"&";
  vl_c_donnees+="vl_valeur_complement_type="+fa_enc(fa_gid("ml_nomencach_valeur_complement_type").selectedItem.value)+"&";
  vl_c_donnees+="vl_base_valorisation="+fa_enc(fa_mlget("ml_nomencach_base_valorisation"))+"&";
  vl_c_donnees+="vl_ajout_pa_pere="+fa_enc(fa_value_get("rdg_nomencach_ajout_pa_pere"))+"&";
  vl_c_donnees+="vl_ajout_pr_pere="+fa_enc(fa_value_get("rdg_nomencach_ajout_pr_pere"))+"&";
  vl_c_donnees+="vl_gestion_stock="+fa_enc(fa_value_get("rdg_nomencach_gere_stock"))+"&";
  vl_c_donnees+="vl_gestion_norma="+fa_enc(fa_value_get("rdg_nomencach_gere_classique"))+"&";
  vl_c_donnees+="vf_c_action="+vf_c_nomencach;
  fa_xmlhttprequest_txt(c_script_bdope_nomenclature_ach,vl_c_donnees,pf_nomclatureach_valider_suite);
}
function pf_nomclatureach_valider_suite(stream) {
  var vl_c_datas=stream;
  if (vl_c_datas!="") {alert(vl_c_datas);}
  pf_affiche_donnees_nomenclature_ach();
  pf_raz_fiche_nomencach();
  pf_sel_arbre_nomenc_ach();
}
function pf_nomenclatureach_valorise() {
  var vl_valeur_ref=Number(fa_value_get("tb_nomencach_valorisation"));
  var vl_quantite=Number(fa_value_get("tb_nomencach_quantite"));
  var vl_valeur_complement=Number(fa_value_get("tb_nomencach_valeur_complement"));
  var vl_valeur_complement_type=fa_gid("ml_nomencach_valeur_complement_type").selectedItem.value;
  var vl_valeur_ligne_01= new Number(vl_valeur_ref*vl_quantite);
  var vl_valeur_ligne_02= new Number(0);
  switch (vl_valeur_complement_type) {
    case "1" : // unitaire
      vl_valeur_ligne_02=(vl_valeur_complement*vl_quantite);
      break;
    case "2" : // Forfaitaire
      vl_valeur_ligne_02=(vl_valeur_complement);
      break;
  }
  var vl_valeur_ligne=(vl_valeur_ligne_01+vl_valeur_ligne_02);
  fa_value_set("tb_nomencach_valeurligne",vl_valeur_ligne);
}
function pf_nomclatureven_ajouter() {
  pf_nomclatureven_raz();
  fa_grise_oui('bt_nomclatureven_modifier');
  fa_grise_oui('bt_nomclatureven_supprimer');
  fa_grise_oui('bt_nomclatureven_ajouter');
	fa_grise_non('bt_nomencven_annuler');
  vf_saisie_nomencven_encours=true;
  vf_c_nomencven="ajouter";
  fa_att_set("tb_nomencven_valorisation","_graal_base_valorisation","$param_generaux_graal_025");
  fa_xmlhttprequest_xml(c_nolignemax_ven+vf_e_art_cleunik,"",pf_nomclatureven_ajouter_fin);
}
function pf_nomclatureven_ajouter_fin(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_nomencven_noligne',fa_xml_get(vl_c_datas,'maxnoligne'));
  fa_grise_groupe_non('broadcaster_03');
  fa_focusdonne('selart_nomenc_ven');
}
function pf_nomclatureven_annuler() {
  pf_nomclatureven_raz();
  fa_grise_non('bt_nomclatureven_modifier');
  fa_grise_non('bt_nomclatureven_supprimer');
  fa_grise_non('bt_nomclatureven_ajouter');
}
function pf_nomclatureven_base_valorisation_faite(event) {
  fa_gid("ml_nomencven_base_valorisation").selectedIndex=0;
  var vl_e_nombre=fa_mlget("ml_nomencven_base_valorisation","_graal_nombre");
  var base_valorisation=fa_att_get("tb_nomencven_valorisation","_graal_base_valorisation");
  for(var i=0;i<vl_e_nombre;i++){
    fa_gid("ml_nomencven_base_valorisation").selectedIndex=i;
    fa_att_set("ml_nomencven_base_valorisation","class",fa_mlget("ml_nomencven_base_valorisation","class"));
    if (base_valorisation==fa_mlget("ml_nomencven_base_valorisation","_graal_cleunik")){
      fa_value_set("tb_nomencven_valorisation",fa_mlget("ml_nomencven_base_valorisation","_graal_base_valorisation"));
      break;
    }
  }
  pf_nomenclatureven_valorise();
}
function pf_nomclatureven_change_menu_actifs_base_valorisation() {
  var vo_list = fa_gid("ml_nomencven_base_valorisation");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
  fa_value_set("tb_nomencven_valorisation",vo_item.getAttribute("_graal_base_valorisation"));
  pf_nomenclatureven_valorise();
}
function pf_nomclatureven_modifier() {
	if (fa_att_get('tb_nomencven_codefils',"_graal_cleunik")==-1) {return;}
  fa_grise_oui('bt_nomclatureven_modifier');
  fa_grise_oui('bt_nomclatureven_supprimer');
  fa_grise_oui('bt_nomclatureven_ajouter');
	fa_grise_non('bt_nomencven_annuler');
  vf_saisie_nomencven_encours=true;
  vf_c_nomencven="modifier";
  fa_grise_groupe_non('broadcaster_03');
  fa_grise_oui("tb_nomencven_noligne");
  fa_grise_oui("selart_nomenc_ven_ml_zone");
  fa_grise_oui("selart_nomenc_ven");
  fa_focusdonne("tb_nomencven_quantite");
}
function pf_nomclatureven_raz() {
  fa_grise_groupe_oui('broadcaster_03');
  fa_value_set('selart_nomenc_ven',"");
  fa_value_set('tb_nomencven_codefils',"");
  fa_value_set('tb_nomencven_descourfils',"");
  fa_value_set('tb_nomencven_quantite',"");
  fa_value_set('tb_nomencven_nbdecimales',"");
  fa_value_set('tb_nomencven_blocnotebrut',"");
  vf_saisie_nomencven_encours=false;
  fa_att_set('tb_nomencven_codefils',"_graal_cleunik",-1);
  fa_value_set("tb_nomencven_valeur_complement","");
  fa_value_set("tb_nomencven_valeurligne","");
  fa_value_set("tb_nomencven_valorisation","");
}
function pf_nomclatureven_sel_article_pour_ligne() {
  var vl_e_cleunik=fa_att_get('selart_nomenc_ven','_graal_cleunik');
  fa_das("ml_nomencven_base_valorisation",c_script_tar_valorisation_nomenc_ven+"actif=1&vl_art_cleunik="+vl_e_cleunik+"&");
  fa_xmlhttprequest_xml(c_script_xml_art_pour_nomencven+vl_e_cleunik,"",pf_nomclatureven_sel_article_pour_ligne_fin);
}
function pf_nomclatureven_sel_article_pour_ligne_fin(stream) {
  var vl_c_datas=stream;
  fa_value_set('tb_nomencven_descourfils',fa_xml_get(vl_c_datas,'description'));
  fa_value_set('tb_nomencven_codefils',fa_xml_get(vl_c_datas,'code'));
  fa_att_set('tb_nomencven_codefils',"_graal_cleunik",fa_xml_get(vl_c_datas,'art_cleunik'));
	fa_focusdonne('tb_nomencven_quantite');
}
function pf_nomclatureven_supprimer() {
	if (fa_att_get('tb_nomencven_codefils',"_graal_cleunik")==-1) {return;}
  if (confirm("$vl_c_bbo_124js")==false) {return;}
  var vl_c_donnees="";
  vl_c_donnees+="vl_art_cleunik_pere="+fa_enc(vf_e_art_cleunik)+"&";
  vl_c_donnees+="vl_art_cleunik_fils="+fa_enc(fa_att_get('tb_nomencven_codefils',"_graal_cleunik"))+"&";
  vl_c_donnees+="vl_noligne="+fa_enc(fa_att_get('tb_nomencven_codefils',"_graal_noligne"))+"&";
  vl_c_donnees+="vf_c_action=supprimer";
  fa_xmlhttprequest_txt(c_script_bdope_nomenclature_ven,vl_c_donnees,pf_nomclatureven_valider_suite);
}
function pf_nomclatureven_valider() {
  if (fa_att_get('tb_nomencven_codefils',"_graal_cleunik")==-1) {return;}
  var vl_c_donnees="";
  vl_c_donnees+="vl_art_cleunik_pere="+fa_enc(vf_e_art_cleunik)+"&";
  vl_c_donnees+="vl_art_cleunik_fils="+fa_enc(fa_att_get('tb_nomencven_codefils',"_graal_cleunik"))+"&";
  vl_c_donnees+="vl_noligne="+fa_enc(fa_att_get('tb_nomencven_codefils',"_graal_noligne"))+"&";
  vl_c_donnees+="vl_noligne_nouvelle="+fa_enc(fa_value_get("tb_nomencven_noligne"))+"&";
  vl_c_donnees+="vl_quantite="+fa_enc(fa_value_get("tb_nomencven_quantite"))+"&";
  vl_c_donnees+="vl_nb_decimales_qte="+fa_enc(fa_value_get("tb_nomencven_nbdecimales"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_nomencven_blocnotebrut"))+"&";
  vl_c_donnees+="vl_valeur_complement="+fa_enc(fa_value_get("tb_nomencven_valeur_complement"))+"&";
  vl_c_donnees+="vl_valeur_complement_type="+fa_enc(fa_gid("ml_nomencven_valeur_complement_type").selectedItem.value)+"&";
  vl_c_donnees+="vl_base_valorisation="+fa_enc(fa_mlget("ml_nomencven_base_valorisation"))+"&";
  vl_c_donnees+="vl_ajout_pv_pere="+fa_enc(fa_value_get("rdg_nomencven_ajout_pv_pere"))+"&";
  vl_c_donnees+="vl_ajout_pr_pere="+fa_enc(fa_value_get("rdg_nomencven_ajout_pr_pere"))+"&";
  vl_c_donnees+="vl_gestion_stock="+fa_enc(fa_value_get("rdg_nomencven_gere_stock"))+"&";
  vl_c_donnees+="vl_gestion_norma="+fa_enc(fa_value_get("rdg_nomencven_gere_classique"))+"&";
  vl_c_donnees+="vf_c_action="+vf_c_nomencven;
  fa_xmlhttprequest_txt(c_script_bdope_nomenclature_ven,vl_c_donnees,pf_nomclatureven_valider_suite);
}
function pf_nomclatureven_valider_suite(stream) {
  var vl_c_datas=stream;
  if (vl_c_datas!="") {alert(vl_c_datas);}
  pf_affiche_donnees_nomenclature_ven();
  pf_raz_fiche_nomencven();
  pf_sel_arbre_nomenc_ven();
}
function pf_nomenclatureven_valorise() {
  var vl_valeur_ref=Number(fa_value_get("tb_nomencven_valorisation"));
  var vl_quantite=Number(fa_value_get("tb_nomencven_quantite"));
  var vl_valeur_complement=Number(fa_value_get("tb_nomencven_valeur_complement"));
  var vl_valeur_complement_type=fa_gid("ml_nomencven_valeur_complement_type").selectedItem.value;
  var vl_valeur_ligne_01= new Number(vl_valeur_ref*vl_quantite);
  var vl_valeur_ligne_02= new Number(0);
  switch (vl_valeur_complement_type) {
    case "1" : // unitaire
      vl_valeur_ligne_02=(vl_valeur_complement*vl_quantite);
      break;
    case "2" : // Forfaitaire
      vl_valeur_ligne_02=(vl_valeur_complement);
      break;
  }
  var vl_valeur_ligne=(vl_valeur_ligne_01+vl_valeur_ligne_02);
  fa_value_set("tb_nomencven_valeurligne",vl_valeur_ligne);
}
function pf_onunload(){
	fa_brl("ml_nomencach_base_valorisation",lstn_ml_nomencach_base_valorisation);
	fa_brl("ml_nomencven_base_valorisation",lstn_ml_nomencven_base_valorisation);
}
function pf_ouvre(vv_quoi_01,vv_quoi_02) {
  var vl_c_param="",i=-1;
  switch (vv_quoi_01) {
    case "art_client":
      vl_c_param+='vl_e_type=110003&';
      vl_c_param+='vl_c_genre=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=-1&';
          fa_ouvre(vf_c_fen_art_acteur+vl_c_param,1000,650);
          break;
        case "ouvrir":
          i=fa_cui("arbre_art_clients");if(i==-1){return;}
          vl_c_param+='vl_e_act_cleunik='+vf_e_act_cleunik+'&';
          vl_c_param+='vl_e_art_cleunik='+fa_cell_get("arbre_art_clients",i,"art_cleunik_client")+'&';
          vl_c_param+='vl_e_art_acteur_cleunik='+fa_cell_get("arbre_art_clients",i,"art_acteur_cleunik_client")+'&';
          fa_ouvre(vf_c_fen_art_acteur+vl_c_param,1000,400);
          break;
      }
      break;
    case "art_fournis":
      vl_c_param+='vl_e_type=110004&';
      vl_c_param+='vl_c_genre=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=-1&';
          fa_ouvre(vf_c_fen_art_acteur+vl_c_param,1000,650);
          break;
        case "ouvrir":
          i=fa_cui("arbre_art_fournisseurs");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik='+fa_cell_get("arbre_art_fournisseurs",i,"act_cleunik_fournis")+'&';
          vl_c_param+='vl_e_art_acteur_cleunik='+fa_cell_get("arbre_art_fournisseurs",i,"art_acteur_cleunik_fournis")+'&';
          fa_ouvre(vf_c_fen_art_acteur+vl_c_param,1000,400);
          break;
      }
      break;
    case "compta":
      vl_c_param+='vl_e_type=110004&';
      vl_c_param+='vl_c_genre=article&';
      switch (vv_quoi_02) {
        case "nouveau":
		  if (vf_e_art_cleunik==-1) {return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_catcompta_cleunik=-1&';
          fa_ouvre(c_fen_compta+vl_c_param,800,300);
          break;
        case "ouvrir":
          i=fa_cui("arbre_compta");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_catcompta_cleunik='+fa_cell_get("arbre_compta",i,"tc_catcompta_cleunik")+'&';
          fa_ouvre(c_fen_compta+vl_c_param,800,300);
          break;
        case "dupliquer_reference":
          vl_c_param='vl_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vf_c_action=dupliquer_compta_reference&';
          fa_xmlhttprequest_txt(vf_c_script_bdope_art,vl_c_param,pf_affiche_donnees_compta);
          break;
      }
      break;
    
    case "critere_entreprise":
      vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
      vl_c_param+='genrecritere=entreprise&';
      vl_c_param+='vl_c_description='+fa_enc(fa_value_get("tb_description"))+"&";
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "critere_lesmiens":
      vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
      vl_c_param+='genrecritere=moi&';
      vl_c_param+='vl_c_description='+fa_enc(fa_value_get("tb_description"))+"&";
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600);
      break;
    case "nomenc_ach":
      var i=fa_cui("arbre_nomenc_ach");if(i==-1){return;}
      var vl_art_cleunik_fils=fa_cell_get("arbre_nomenc_ach",i,"arbre_nomenc_ach_art_cleunik_fils");
			if (vl_art_cleunik_fils=="") {return;}
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_art_cleunik_fils+"&","");
      break;
    case "nomenc_ven":
      var i=fa_cui("arbre_nomenc_ven");if(i==-1){return;}
      var vl_art_cleunik_fils=fa_cell_get("arbre_nomenc_ven",i,"arbre_nomenc_ven_art_cleunik_fils");
			if (vl_art_cleunik_fils=="") {return;}
			fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_art_cleunik_fils+"&","");			
      break;
    case "relation":
      switch (vv_quoi_02){
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik_gauche='+vf_e_art_cleunik+'&';
          fa_ouvre(vf_c_fen_relations+vl_c_param,800,450);
          break;
        case "ouvrir":
          vl_c_param+='vl_e_art_cleunik_droite='+vf_e_art_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_droite='+vf_e_choix_cleunik_droite+'&';
          vl_c_param+='vl_e_choix_cleunik_gauche='+vf_e_choix_cleunik_gauche+'&';
          vl_c_param+='vl_e_art_cleunik_gauche='+vf_e_art_cleunik_gauche+'&';
          fa_ouvre(vf_c_fen_relations_fiche+vl_c_param,600,250);
          break;
      }
      break;
    case "tarif_particulier_achat":
      vl_c_param+='vl_e_type=110004&';
      vl_c_param+='vl_c_genre=2&';
      vl_c_param+='vl_c_origine=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=-1&';
          vl_c_param+='vl_e_tar_cleunik=0&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,1000,650);
          break;
        case "ouvrir":
          i=fa_cui("arbre_tarif_particulier_achat");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik='+fa_cell_get("arbre_tarif_particulier_achat",i,"tc_act_cleunik_particulier_achat")+'&';
          vl_c_param+='vl_e_tar_cleunik='+fa_cell_get("arbre_tarif_particulier_achat",i,"tc_tar_cleunik_particulier_achat")+'&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,1000,400);
          break;
      }
      break;
    case "tarif_particulier_vente":
      vl_c_param+='vl_e_type=110003&';
      vl_c_param+='vl_c_genre=1&';
      vl_c_param+='vl_c_origine=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=-1&';
          vl_c_param+='vl_e_tar_cleunik=0&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,800,800);
          break;
        case "ouvrir":
          i=fa_cui("arbre_tarif_particulier_vente");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik='+fa_cell_get("arbre_tarif_particulier_vente",i,"tc_act_cleunik_particulier_vente")+'&';
          vl_c_param+='vl_e_tar_cleunik='+fa_cell_get("arbre_tarif_particulier_vente",i,"tc_tar_cleunik_particulier_vente")+'&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,800,400);
          break;
      }
      break;
    case "tarif_type_achat":
      vl_c_param+='vl_e_type=110000&';
      vl_c_param+='vl_c_genre=2&';
      vl_c_param+='vl_c_origine=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=0&';
          vl_c_param+='vl_e_tar_cleunik=0&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,1000,650);
          break;
        case "ouvrir":
          i=fa_cui("arbre_tarif_type_achat");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=0&';
          vl_c_param+='vl_e_tar_cleunik='+fa_cell_get("arbre_tarif_type_achat",i,"tc_tar_cleunik_type_achat")+'&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,1000,400);
          break;
      }
      break;
    case "tarif_type_vente":
      vl_c_param+='vl_e_type=110000&';
      vl_c_param+='vl_c_genre=1&';
      vl_c_param+='vl_c_origine=article&';
      switch (vv_quoi_02) {
        case "nouveau":
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=0&';
          vl_c_param+='vl_e_tar_cleunik=0&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,800,500);
          break;
        case "ouvrir":
          i=fa_cui("arbre_tarif_type_vente");if(i==-1){return;}
          vl_c_param+='vl_e_art_cleunik='+vf_e_art_cleunik+'&';
          vl_c_param+='vl_e_act_cleunik=0&';
          vl_c_param+='vl_e_tar_cleunik='+fa_cell_get("arbre_tarif_type_vente",i,"tc_tar_cleunik_type_vente")+'&';
          fa_ouvre(vf_c_fen_art_tarifs+vl_c_param,800,500);
          break;
      }
      break;

  }
}
function pf_ouvre_stats() {
var vl_c_param=vf_c_fen_stat+'vl_e_art_cleunik='+vf_e_art_cleunik+'&';
  switch (fa_gid("tabs_cial").selectedIndex) {
    case 0: vl_c_param+='cial=offcli';break;
    case 1: vl_c_param+='cial=cdecli';break;
    case 2: vl_c_param+='cial=faccli';break;
    case 3: vl_c_param+='cial=demfou';break;
    case 4: vl_c_param+='cial=cdefou';break;
    case 5: vl_c_param+='cial=recfou';break;
    case 6: vl_c_param+='cial=facfou';break;
  }
  fa_ouvre(vl_c_param)
}
function pf_param_choix_selart_nomenc_ach() {
  fa_att_set("selart_nomenc_ach","autosuggestsearch",c_script_recherche_article_nomencach+"zone="+fa_value_get("selart_nomenc_ach_ml_zone")+"&");
}
function pf_param_choix_selart_nomenc_ven() {
  fa_att_set("selart_nomenc_ven","autosuggestsearch",c_script_recherche_article_nomencven+"zone="+fa_value_get("selart_nomenc_ven_ml_zone")+"&");
}
function pf_parcours_fichier_xml_nomenclature(noeudxml,xulnode){
  var treeItem = fa_crexul("treeitem");
  var treeRow  = fa_crexul("treerow");
  var treeCell_01 = fa_crexul("treecell");
  var treeCell_02 = fa_crexul("treecell");
  var treeCell_03 = fa_crexul("treecell");
  var treeCell_04 = fa_crexul("treecell");
  var treeCell_05 = fa_crexul("treecell");
  var treeCell_06 = fa_crexul("treecell");
  var treeCell_07 = fa_crexul("treecell");
  treeCell_01.setAttribute("value",noeudxml.getAttribute("_graal_cleunik_noligne"));
  treeCell_01.setAttribute("label",noeudxml.getAttribute("_graal_cleunik_noligne"));
  treeCell_07.setAttribute("label",noeudxml.getAttribute("code"));
  treeCell_07.setAttribute("value",noeudxml.getAttribute("code"));
  treeCell_07.setAttribute("properties",noeudxml.getAttribute("_graal_prop"));
  treeCell_06.setAttribute("value",noeudxml.getAttribute("quantite"));
  treeCell_06.setAttribute("label",noeudxml.getAttribute("quantite"));
  treeCell_02.setAttribute("label",noeudxml.getAttribute("label"));
  treeCell_02.setAttribute("value",noeudxml.getAttribute("label"));
  treeCell_02.setAttribute("properties",noeudxml.getAttribute("_graal_prop"));
  treeCell_03.setAttribute("value",noeudxml.getAttribute("_graal_cleunik_pere"));
  treeCell_03.setAttribute("label",noeudxml.getAttribute("_graal_cleunik_pere"));
  treeCell_04.setAttribute("label",noeudxml.getAttribute("_graal_cleunik_fils"));
  treeCell_04.setAttribute("value",noeudxml.getAttribute("_graal_cleunik_fils"));
  treeCell_05.setAttribute("label",noeudxml.getAttribute("modifiable"));
  treeCell_05.setAttribute("value",noeudxml.getAttribute("modifiable"));
  treeRow.appendChild(treeCell_01);
  treeRow.appendChild(treeCell_07);
  treeRow.appendChild(treeCell_06);
  treeRow.appendChild(treeCell_02);
  treeRow.appendChild(treeCell_03);
  treeRow.appendChild(treeCell_04);
  treeRow.appendChild(treeCell_05);
  treeItem.appendChild(treeRow);
  xulnode.appendChild(treeItem);                                                       
  if(noeudxml.hasChildNodes){                                                           /* encore des noeuds à lire ?*/
    for(var i=0;i<noeudxml.childNodes.length;i++){                                      /* bouclons */
      if(noeudxml.childNodes[i].nodeType==1){                                           /* On ne lit que les éléments */
        if(!fa_est_conteneur(treeItem)){ fa_nouvelle_branche(treeItem); }               /* Il y a des enfants, on crèe une nouvelle branche */
        pf_parcours_fichier_xml_nomenclature(noeudxml.childNodes[i],treeItem.childNodes[1]); /* parcours récursif */
      }
    }
  }
}
function pf_raz_fiche() {
  vf_e_art_cleunik=-1;
  fa_value_set("tb_code","");
  fa_value_set("tb_mnemotechnique","");
  fa_value_set("tb_description","");
  fa_value_set("tb_blocnotebrut","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("la_dateheuremodif","");
  fa_value_set("la_dateheurevalidite","");
  fa_value_set("ml_nbdec_prix",2);
  fa_value_set("tb_pr_generique","");
  fa_uncheck('ch_n01');
  fa_uncheck('ch_n02');
  fa_uncheck('ch_n03');
  fa_uncheck('ch_n04');
  fa_value_set('tb_pu_reference',"");
  fa_value_set('tb_nb_decimales_qte',"$param_generaux_graal_167");
  fa_value_set('tb_delai_reappro',"");
  fa_value_set('tb_der_pa',"");
  fa_value_set('tb_pamp',"");
  fa_value_set('dateheure_der_achat',"");
  fa_gid("ml_unite_reappro").selectedIndex=0;
  fa_value_set('rdg_acteur_actif',"1");
  fa_cache_oui("tab_achats");fa_cache_oui("tab_ventes");fa_cache_oui("tab_fabrication");fa_cache_oui("tab_tarifs");
  fa_vide_arbre("fils_arbre_nomenc_ach");fa_vide_arbre("fils_arbre_nomenc_ven");
  fa_ds("arbre_art_fournisseurs","");fa_ds("criteres_des_articles_entreprise","");fa_ds("criteres_des_articles_lesautres","");fa_ds("criteres_des_articles_lesmiens","");fa_ds("arbre_tarif_type_vente","");
  fa_ds("criteres_des_articles_tous","");fa_ds("arbre_des_ged", '');fa_ds("arbre_des_images", '');fa_ds("arbre_relations","");fa_ds("arbre_tarif_particulier_vente","");
  fa_ds("arbre_compta","");
  fa_att_set("ifr_image","src","_graal_page_blanche_01.php");
  fa_value_set('tb_multiple_base',"");
	pf_raz_fiche_nomencach();
	pf_raz_fiche_nomencven();
  pf_raz_arbres_commerciaux();
}
function pf_raz_fiche_nomencach() {
  fa_grise_groupe_oui('broadcaster_03');
  fa_value_set('selart_nomenc_ach',"");
  fa_value_set('tb_nomencach_codefils',"");
  fa_value_set('tb_nomencach_descourfils',"");
  fa_value_set('tb_nomencach_quantite',"");
  fa_value_set('tb_nomencach_nbdecimales',"");
  fa_value_set('tb_nomencach_blocnotebrut',"");
  vf_saisie_nomencach_encours=false;
  fa_att_set('tb_nomencach_codefils',"_graal_cleunik",-1);
  fa_value_set("tb_nomencach_valeur_complement","");
  fa_value_set("tb_nomencach_valeurligne","");
  fa_value_set("tb_nomencach_valorisation","");
}
function pf_raz_fiche_nomencven() {
  fa_grise_groupe_oui('broadcaster_04');
  fa_value_set('selart_nomenc_ven',"");
  fa_value_set('tb_nomencven_codefils',"");
  fa_value_set('tb_nomencven_descourfils',"");
  fa_value_set('tb_nomencven_quantite',"");
  fa_value_set('tb_nomencven_nbdecimales',"");
  fa_value_set('tb_nomencven_blocnotebrut',"");
  vf_saisie_nomencven_encours=false;
  fa_att_set('tb_nomencven_codefils',"_graal_cleunik",-1);
  fa_value_set("tb_nomencven_valeur_complement","");
  fa_value_set("tb_nomencven_valeurligne","");
  fa_value_set("tb_nomencven_valorisation","");
}
function pf_raz_arbres_commerciaux() {
  fa_das("tr_art_actions_offcli_01","");
  fa_das("tr_art_actions_cdecli_01","");
  fa_das("tr_art_actions_faccli_01","");
  fa_das("tr_art_actions_demfou_01","");
  fa_das("tr_art_actions_cdefou_01","");
  fa_das("tr_art_actions_recfou_01","");
  fa_das("tr_art_actions_facfou_01","");
}
function pf_retour_dupliq(vl_datas) {
  vf_e_art_cleunik=vl_datas;
  var s =fa_enc("vl_e_art_cleunik")+"="+fa_enc(vf_e_art_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml_art,s,pf_affiche_donnees_articles_infogene);
}
function pf_retour_fenetre_dossiers(vv_t_tableau_cleunik) {
  var vl_e_nb_sel=vv_t_tableau_cleunik.length;
  if (vl_e_nb_sel!=0) {
	for(var i=0;i<vl_e_nb_sel;i++){                      /* loop 'em */
      var vl_c_donnees=vv_t_tableau_cleunik[i]+"&cleunik_insertion_dossier="+fa_enc(vf_e_art_cleunik)+"&label_insertion_dossier="+fa_enc(fa_value_get("tb_description")+" ("+fa_value_get("tb_code")+")");
      fa_xmlhttprequest_txt(c_bdope_dossiers+vl_c_donnees,"",pf_retour_fenetre_dossiers_fin);
    }
  }
}
function pf_retour_fenetre_dossiers_fin(stream){
	alert(stream)
}
function pf_sel_arbre_articles() {
  var i=fa_cui("arbre_des_articles");if(i==-1){return;}
  if(fa_est_grise("bt_detailler")==true) {return};
  var vl_e_art_cleunik=fa_cell_get("arbre_des_articles",i,"art_cleunik");
  if (vl_e_art_cleunik==vf_e_art_cleunik){return;}
  vf_e_art_cleunik=vl_e_art_cleunik;
  var s =fa_enc("vl_e_art_cleunik")+"="+fa_enc(vf_e_art_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml_art,s,pf_affiche_donnees_articles_infogene);
}
function pf_sel_arbre_art_fournis() {}
function pf_sel_arbre_dep_emp() {
  var i=fa_cui("arbre_dep_emp");if(i==-1){return;}
  vf_e_art_depemp_cleunik=fa_cell_get("arbre_dep_emp",i,"tc_art_depemp_cleunik");//  Clé unique article /dépot emplacement
  vf_e_choix_depot=fa_cell_get("arbre_dep_emp",i,"tc_choix_depot");//  Clé unique dépôt
  vf_e_choix_empla=fa_cell_get("arbre_dep_emp",i,"tc_choix_empla");//  Clé unique Emplacement
}
function pf_sel_arbre_ged() {}
function pf_sel_arbre_nomenc_ach() {
  var i=fa_cui("arbre_nomenc_ach");if(i==-1){return;}
  if (vf_saisie_nomencach_encours==true) {return;}
  var vl_art_cleunik_pere=fa_cell_get("arbre_nomenc_ach",i,"arbre_nomenc_ach_art_cleunik_pere");
  var vl_art_cleunik_fils=fa_cell_get("arbre_nomenc_ach",i,"arbre_nomenc_ach_art_cleunik_fils");
  var vl_noligne=fa_cell_get("arbre_nomenc_ach",i,"arbre_nomenc_ach_col01");
  var s=""
  s+="&vl_art_cleunik_pere="+vl_art_cleunik_pere;
  s+="&vl_art_cleunik_fils="+vl_art_cleunik_fils;
  s+="&vl_noligne="+vl_noligne;
  fa_xmlhttprequest_xml(c_script_xml_nomenclature_ach,s,pf_affiche_donnees_nomenclature_ach_detail);
  s="";
  s+="actif=1&vl_art_cleunik="+vl_art_cleunik_fils+"&";
  fa_das("ml_nomencach_base_valorisation",c_script_tar_valorisation_nomenc_ach+s);
  if (fa_est_grise('bt_enregistrer')) {return;}
  pf_boutons_nomenc_ach(i);
}
function pf_sel_arbre_nomenc_ven() {
  var i=fa_cui("arbre_nomenc_ven");if(i==-1){return;}
  if (vf_saisie_nomencven_encours==true) {return;}
  var vl_art_cleunik_pere=fa_cell_get("arbre_nomenc_ven",i,"arbre_nomenc_ven_art_cleunik_pere");
  var vl_art_cleunik_fils=fa_cell_get("arbre_nomenc_ven",i,"arbre_nomenc_ven_art_cleunik_fils");
  var vl_noligne=fa_cell_get("arbre_nomenc_ven",i,"arbre_nomenc_ven_col01");
  var s=""
  s+="&vl_art_cleunik_pere="+vl_art_cleunik_pere;
  s+="&vl_art_cleunik_fils="+vl_art_cleunik_fils;
  s+="&vl_noligne="+vl_noligne;
  fa_xmlhttprequest_xml(c_script_xml_nomenclature_ven,s,pf_affiche_donnees_nomenclature_ven_detail);
  s="";
  s+="actif=1&vl_art_cleunik="+vl_art_cleunik_fils+"&";
  fa_das("ml_nomencven_base_valorisation",c_script_tar_valorisation_nomenc_ven+s);
  if (fa_est_grise('bt_enregistrer')) {return;}
  pf_boutons_nomenc_ven(i);
}


function pf_sel_arbre_relations() {
  var i=fa_cui("arbre_relations");if(i==-1){return;}
  vf_e_art_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_art_cleunik_droite");
  vf_e_art_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_art_cleunik_gauche");
  vf_e_choix_cleunik_droite=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_droite");
  vf_e_choix_cleunik_gauche=fa_cell_get("arbre_relations",i,"tc_choix_cleunik_gauche");
}
function pf_telecharge(){
	pf07_telecharge();
}
function pf_validation(vv_quoi) {
    var vl_c_donnees,vl_e_types_gestion,vl_c_date;
    vl_e_types_gestion=0;
    if (fa_est_coche("ch_n01")==true) {vl_e_types_gestion+=  1};
    if (fa_est_coche("ch_n02")==true) {vl_e_types_gestion+=  2};
    if (fa_est_coche("ch_n03")==true) {vl_e_types_gestion+=  4};
    if (fa_est_coche("ch_n04")==true) {vl_e_types_gestion+=  8};
    vl_c_donnees="";
    vl_c_donnees+="vl_art_cleunik="+fa_enc(vf_e_art_cleunik)+"&";
    vl_c_donnees+="vl_code="+fa_enc(fa_value_get("tb_code"))+"&";
    vl_c_donnees+="vl_mnemotechnique="+fa_enc(fa_value_get("tb_mnemotechnique"))+"&";
    vl_c_donnees+="vl_description="+fa_enc(fa_value_get("tb_description"))+"&";
    vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
    vl_c_donnees+="vl_dateheurevalidite="+fa_enc(fa_value_get("tb_dateheurevalidite"))+"&";
    vl_c_donnees+="vl_types_gestion="+fa_enc(vl_e_types_gestion)+"&";
    vl_c_donnees+="vl_actif="+fa_enc(fa_value_get("rdg_acteur_actif"))+"&";  
    vl_c_donnees+="vl_nbdec_prix="+fa_enc(fa_gid("ml_nbdec_prix").selectedItem.getAttribute("value"))+"&";
		vl_c_donnees+="vl_nbdec_qte="+fa_enc(fa_gid("ml_nbdec_qte").selectedItem.getAttribute("value"))+"&";
    vl_c_donnees+="vl_pr_generique="+fa_enc(fa_value_get("tb_pr_generique"))+"&";
    vl_c_donnees+="vl_unite_capacite="+fa_enc(fa_mlget("ml_unite_capacite"))+"&";
    vl_c_donnees+="vl_unite_vente="+fa_enc(fa_mlget("ml_unite_vente"))+"&";
    vl_c_donnees+="vl_capacite="+fa_enc(fa_value_get("tb_capacite"))+"&";
    vl_c_donnees+="vl_unite_poids="+fa_enc(fa_mlget("ml_unite_poids"))+"&";
    vl_c_donnees+="vl_poids_brut="+fa_enc(fa_value_get("tb_poids_brut"))+"&";
    vl_c_donnees+="vl_poids_net="+fa_enc(fa_value_get("tb_poids_net"))+"&";
    switch(vv_quoi) {
      case "enregistrer":
        if (vl_e_types_gestion==0) {alert("$vl_c_bbo_130js");return;}
        if (vf_e_art_cleunik!=-1)
          {vl_c_donnees+="vf_c_action=modifier&";vf_c_action="modification";}
        else
          {vl_c_donnees+="vf_c_action=ajouter&";vf_c_action="ajout"}
        break;
      case "supprimer":
          Check = confirm("$vl_c_bbo_125js");
          if(Check == false) return;
          vl_c_donnees+="vf_c_action=supprimer&"
          vf_c_action="suppression";
        break;
    }
    //  Enregistrement données article
    fa_xmlhttprequest_txt(vf_c_script_bdope_art,vl_c_donnees,pf_validation_suite);
    //  Toutes les autres informations sont disponibles après avoir créé l'article, donc on est en modification dans ce cas !
    switch(vf_c_action) {
      case "modification":
        if (fa_est_coche("ch_n01")==true) {
          //  Gestion des achats
          vl_c_donnees="";
          vl_c_donnees+="vl_art_cleunik="+fa_enc(vf_e_art_cleunik)+"&";
          vl_c_donnees+="vl_delai_reappro="+fa_enc(fa_value_get("tb_delai_reappro"))+"&";
          vl_c_donnees+="vl_unite_reappro="+fa_enc(fa_mlget("ml_unite_reappro"))+"&";
          vl_c_donnees+="vl_unite_achat="+fa_enc(fa_mlget("ml_unite_achat"))+"&";
          vl_c_donnees+="vf_c_action=modifier&";
          fa_xmlhttprequest_txt(vf_c_script_bdope_art_achats,vl_c_donnees,'');
        }
    }
}
function pf_validation_suite(stream) {
  var vl_datas = stream;
  if (vl_datas!="-1") {
      switch (vf_c_action) {
        case "ajout":
          vf_e_art_cleunik=vl_datas;
          var s =fa_enc("vl_e_art_cleunik")+"="+fa_enc(vf_e_art_cleunik)+"&";
          fa_xmlhttprequest_xml(vf_c_script_xml_art,s,pf_affiche_donnees_articles_infogene);
          pf_etat_fen("modifier");
          break;
        case "modification":
          pf_etat_fen("annuler");
          break;
        case "suppression":
          alert("$vl_c_bbo_131js")
          pf_etat_fen("annuler");
          break;
      }
    } 
  else {
    alert(vl_datas);
    pf_etat_fen("annuler");
    }
  $js_validation_01
}
]]></script>
END;
?>
