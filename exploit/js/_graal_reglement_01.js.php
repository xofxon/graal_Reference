<?php
$vl_c_brg_109=fa_recup_dico_js("brg_109");
$vl_c_brg_129=fa_recup_dico_js("brg_129");$vl_c_brg_129="Il faut renseigner la date de réglement.";
switch ($vl_c_fichier_echeance){
	case "_faccli_echeancier";
			$fichier_compta="faccli";
			break;
		case "_avocli_echeancier";
			$fichier_compta="avocli";
			break;
		case "_facfou_echeancier";
			$fichier_compta="facfou";
			break;
		case "_avofou_echeanci";
			$fichier_compta="avofou";
			break;
}
$vf_c_script_cial_compta="_graal_exe_docial_comptabilise.php?genreaction=$fichier_compta&quoi=compta_seule&";
switch ($vl_c_genre){
	case "5" :
	case "12":
		$js_01="fa_focusdonne('tb_piece');fa_xmlhttprequest_xml(_c_script_edite,'',pf_affiche_datas);";
	break;
	case "7" :
		$js_01="fa_focusdonne('tb_piece');fa_grise_oui('ml_etat');fa_grise_oui('tb_montant_pointe');";
		break;
	case "8" :
	case "C8" :
	case "15":
		$js_01="fa_focusdonne('tb_dat_reglement');fa_xmlhttprequest_xml(_c_script_edite,'',pf_affiche_datas);";
	break;
	case "10":
		$js_01="fa_focusdonne('tb_dat_reglement');fa_grise_oui('ml_etat');fa_grise_oui('tb_montant_pointe');";
	break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
END;
switch ($vl_c_genre){
	case "5" :
	case "8" :
	case "C8" :
	case "12" :
	case "15" :
		$js_00="const _c_script_edite='_graal_xml_echeance_01.php?echeance_cleunik=$vl_e_echeance_cleunik&type=$vl_c_type&fichier_echeance=$vl_c_fichier_echeance&';";
		$js_00.="const _c_script_bdope_fen='_graal_bdope_reglement_01.php?echeance_cleunik=$vl_e_echeance_cleunik&vf_c_action=$vl_c_genre&vl_journal_cleunik=$vl_e_journal_cleunik&fichier_echeance=$vl_c_fichier_echeance&';";
		$js_02="";
$js_03=<<<EOT
function pf_raz(){
	window.parent.pf_approximatif();
	window.location="pagesparticulieres/page_blanche.php";
}
EOT;
		break;
	case "7" :
	case "10":
	case "14" :
	case "17":
		$js_00="const _c_script_bdope_fen='_graal_bdope_reglement_01.php?&vf_c_action=$vl_c_genre&vl_journal_cleunik=$vl_e_journal_cleunik&';";
		$js_02 ="&vf_t_panier_echeancier=$vf_t_panier_echeancier&";
$js_03=<<<EOT
function pf_raz(){
	//window.parent.pf_panier_retour();
	window.parent.window.location=window.parent.document.location;
	window.location="pagesparticulieres/page_blanche.php";
}
EOT;
	break;
}
echo <<<END
$js_00
var vf_c_action="";
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  fa_att_set("tb_blocnotebrut","_graal_pc_cleunik",fa_xml_get(vl_c_datas,"pc_cleunik"));
  fa_value_set("tb_date_paiement",fa_xml_get(vl_c_datas,"date_paiement"));
  fa_value_set("tb_date_echeance",fa_xml_get(vl_c_datas,"date_echeance"));
  fa_value_set("tb_montant_du",fa_xml_get(vl_c_datas,"montant_du"));
  fa_value_set("tb_montant_deja_paye",fa_xml_get(vl_c_datas,"montant_paye"));
  fa_value_set("tb_devise_du",fa_xml_get(vl_c_datas,"devise_du"));
  fa_value_set("tb_devise_paye",fa_xml_get(vl_c_datas,"devise_paye"));
  fa_att_set("tb_blocnotebrut","_graal_mode_paiement",fa_xml_get(vl_c_datas,"mode_paiement"));
  fa_value_set("tb_blocnotebrut",fa_xml_get(vl_c_datas,"blocnotebrut"));
	fa_value_set("tb_nodoc",fa_xml_get(vl_c_datas,"code_document"));
  fa_value_set("tb_nom_acteur",fa_xml_get(vl_c_datas,"nomcommercial"));
	fa_value_set("tb_montant_paye",fa_xml_get(vl_c_datas,"montant_restant"));
	fa_value_set("tb_montant_pointe",fa_xml_get(vl_c_datas,"montant_restant"));
	fa_value_set("tb_domiciliation",fa_xml_get(vl_c_datas,"domiciliation"));
	fa_att_set("tb_domiciliation","_graal_nombre_rib",fa_xml_get(vl_c_datas,"nombre_rib"));
	fa_att_set("tb_domiciliation","_graal_act_cleunik",fa_xml_get(vl_c_datas,"act_cleunik"));
	var compta_etat=fa_xml_get(vl_c_datas,"compta_etat");
	var commercial_cleunik=fa_xml_get(vl_c_datas,"commercial_cleunik");
	var vl_action_cleunik=fa_xml_get(vl_c_datas,"action_cleunik");
	/*
	if (fa_value_get("tb_montant_du") == 0.0 ) {
		if (!confirm("Le montant à payer est réputé nul. Confirmez-vous la saisie ?")) {
			//pf_etat_fen("annuler");
			pf_raz();
		}
	}
	*/
	if (compta_etat=="1" ) {
		if (confirm("Le document n'est pas comptabilisé. Souhaitez-vous le comptabiliser ?")) {
		fa_grise_fenetre("","oui");
			fa_xmlhttprequest_txt("$vf_c_script_cial_compta&vl_commercial_cleunik="+commercial_cleunik+"&vl_action_cleunik="+vl_action_cleunik+"&","",pf_fin_requete_compta);
		}
	}
}
function pf_aa_init(){
	fa_sep("tb_montant_pointe");
	fa_sep("tb_montant_paye");
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_non("bt_enregistrer");
  fa_grise_non("bt_annuler");
  fa_grise_groupe_oui("broadcaster_01");
$js_01
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "annuler":
			window.parent.pf_sel_ligne();
//			window.location="";
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
	fa_grise_fenetre("","non");
  var vl_datas = stream;
  if (vl_datas=="ok") {
  	pf_raz();
  } else {
  	alert(vl_datas)
	}
}
function pf_fin_requete_compta(stream){
	fa_grise_fenetre("","non");
	//alert(stream)
	fa_xmlhttprequest_xml(_c_script_edite,'',pf_affiche_datas);
}
$js_03
function pf_onunload(){}
function pf_validation(vv_quoi) {
	if (fa_value_get('tb_dat_reglement')=="") {alert("$vl_c_brg_129");return;}
  if(confirm("$vl_c_brg_109")==false) return;
		fa_grise_fenetre("","oui");
		var vl_c_donnees="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
    vl_c_donnees+="vl_pc_cleunik="+fa_enc(fa_att_get("tb_blocnotebrut","_graal_pc_cleunik"))+"&";
    vl_c_donnees+="vl_mode_paiement="+fa_enc(fa_att_get("tb_blocnotebrut","_graal_mode_paiement"))+"&";
		vl_c_donnees+="vl_piece="+fa_enc(fa_value_get("tb_piece"))+"&";
    vl_c_donnees+="vl_ref_piece="+fa_enc(fa_value_get("tb_ref_piece"))+"&";
		vl_c_donnees+="vl_domiciliation="+fa_enc(fa_value_get("tb_domiciliation"))+"&";
		vl_c_donnees+="vl_nombre_rib="+fa_enc(fa_att_get("tb_domiciliation","_graal_nombre_rib"))+"&";
		vl_c_donnees+="vl_act_cleunik="+fa_enc(fa_att_get("tb_domiciliation","_graal_act_cleunik"))+"&";		
    vl_c_donnees+="vl_dateheurereglemen="+fa_enc(fa_value_get("tb_dat_reglement"))+"&";
    vl_c_donnees+="vl_montant_paye="+fa_enc(fa_value_get("tb_montant_paye"))+"&";
    vl_c_donnees+="vl_montant_pointe="+fa_enc(fa_value_get("tb_montant_pointe"))+"&";
    vl_c_donnees+="vl_devise_paye="+fa_enc(fa_mlget("ml_devise"))+"&";
		
    vl_c_donnees+="vl_coef=1&";
    vl_c_donnees+="vl_acompte=0&";
    vl_c_donnees+="vl_transfert=0&";
    vl_c_donnees+="vl_impaye=0&";
    vl_c_donnees+="vl_remboursement=0&";
    vl_c_donnees+="vl_option_remise=-131&";
    vl_c_donnees+="vl_accepte=0&";
    vl_c_donnees+="vl_type_ecart="+fa_enc(fa_mlget("ml_ecart"))+"&";
		vl_c_donnees+="vl_etat="+fa_enc(fa_value_get("ml_etat"))+"&";
		vl_c_donnees+="$js_02";
  	fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
	
}
]]></script>
END;
?>
