<?php
$vl_c_url_absolue=fa_url_absolue();
$vl_c_bsl_116js=fa_recup_dico_js("bsl_116");
$vl_c_bsl_117js=fa_recup_dico_js("bsl_117");
$vl_c_bsl_118js=fa_recup_dico_js("bsl_118");

switch ($vl_c_genre) {
	case "page":
$pf_recupera=<<<EOT
function pf_recupera(){
	fa_grise_fenetre("","oui");
	fa_das("arbre_recupera_das_courriel",c_script_recupera+fa_value_get("tb_recupera")+"&raf="+Math.random()+"&");
}
EOT;
	break;
	case "fich":
$pf_recupera=<<<EOT
function pf_recupera(){
	if (fa_value_get('tb_recupera')=="") {return;}
	var vl_graal_cleunik=fa_att_get('tb_recupera','_graal_cleunik');
	switch (vl_graal_cleunik) {
		case '-1':
			fa_grise_fenetre("","oui");
			var vl_texte=fa03_fichier_lit(fa_value_get('tb_recupera'));
      fa_xmlhttprequest_txt(c_script_var_texte,'vl_texte='+fa_enc(vl_texte),pf_recupera_suite_fich);
			break;
		default:
			alert("Erreur de programmation");
			break;
	}
}
function pf_recupera_suite_fich(){
	fa_das("arbre_recupera_das_courriel",c_script_recupera+"vl_texte_fichier&raf="+Math.random()+"&");
}
EOT;
	break;
	case "text":
$pf_recupera=<<<EOT
function pf_recupera(){
	if (fa_value_get('tb_recupera')=="") {return;}
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(c_script_var_texte,'vl_texte='+fa_enc(fa_value_get('tb_recupera')),pf_recupera_suite_fich);
}
function pf_recupera_suite_fich(){
	fa_das("arbre_recupera_das_courriel",c_script_recupera+"vl_texte_fichier&raf="+Math.random()+"&");
}
EOT;

	break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c_script_recupera="_graal_das_import_adresses_courriels_03.php?quoi=$vl_c_genre&ou=";
const c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_refweb&';
const c_script_var_texte='_graal_cree_variable_session_tempo_texte.php?var=vl_texte_fichier&';
const c_script_traitement="_graal_bdope_act_interlo_mail_01.php?vf_c_action=changer_veuxpasdemail_message_kilometre&";
const c_fen_selection_doc='_graal_fen_ged_01.php?genreged=tousss&quelsdocs=docs&retour=oui&';
const lstn_grise = { 
	willRebuild : function(event){fa_grise_fenetre(event,"oui");},
	didRebuild  : function(event){pf_traite_deja_dans_table();fa_grise_fenetre(event,"non");} 
};
function pf_etat_fen(vv_quoi)  {
  switch(vv_quoi) {
    case "ini":
			fa_badl("arbre_recupera_das_courriel",lstn_grise);
      break;
    case "annuler":
      fa_das("arbre_recupera_das_courriel","");
      break;
    case "sortir":
       window.history.back(); //  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre
      break;   
    default:
      break;
  }
}
function pf_onunload(){
	fa_brl("arbre_recupera_das_courriel",lstn_grise);
}
function pf_ouvre_fichier(vv_quoi_01){
  switch (vv_quoi_01) {
    case 'disque':
      fa_value_set("tb_recupera",fa03_sel_fichier("",""));
			fa_att_set('tb_recupera','_graal_cleunik','-1');
      break;
    case 'ged':
      vf_c_retour="ouverture";
      fa_ouvre(c_fen_selection_doc,1000,800);
      break;
  }
}
$pf_recupera
function pf_recupera_panier_ajoute() {
	var vl_t_tableau=[];
	var vl_refweb="",vl_syntax="";
  vl_t_tableau=fa_lignes_selectionnees("arbre_recupera_courriel");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
	    vl_refweb=fa_cell_get("arbre_recupera_courriel",vl_t_tableau[i],"tc_recupera_refweb");
	    vl_syntax=fa_cell_get("arbre_recupera_courriel",vl_t_tableau[i],"tc_recupera_controle_01");
			pf_recupera_panier_ajoute_ligne(vl_refweb,vl_syntax);
    }
	}
}
function pf_recupera_panier_supprime() {
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_recupera_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
		j=-1;
    for(var i=vl_e_nb_sel-1;i>=0;i--) {
			selected = fa_gid("arbre_recupera_panier").contentView.getItemAtIndex(vl_t_tableau[i]);
			selected.parentNode.removeChild(selected);
    }
  }
}
function pf_recupera_panier_ajoute_ligne(vv_refweb,vv_syntax){
	var treeItem = fa_crexul("treeitem");
  var treeRow  = fa_crexul("treerow");
  var treeCell_01 = fa_crexul("treecell");
  var treeCell_02 = fa_crexul("treecell");
  treeCell_01.setAttribute("label",vv_refweb);
  treeCell_02.setAttribute("label",vv_syntax);
  treeRow.appendChild(treeCell_01);
  treeRow.appendChild(treeCell_02);
  treeItem.appendChild(treeRow);
  fa_gid("fils_recupera_panier_destination").appendChild(treeItem);
}
function pf_retour_fenetre_docs(vv_t_tableau_cleunik,vv_t_tableau_nom) {
  vl_e_nb_sel=vv_t_tableau_cleunik.length
  if (vl_e_nb_sel!=0) {
    switch (vf_c_retour) {
      case "ouverture":
        fa_gid("dk_02").selectedIndex=1;
        fa_cache_non("tab_criteres");fa_cache_non("tab_commentaires");fa_cache_non("tab_appartenance");
        fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik="+vv_t_tableau_cleunik[0]+"&",pf_affiche_datas);
        break;
      case "connexion":
        fa_xmlhttprequest_xml(c_script_connecte,"vf_c_action=connecter&vl_e_doc_cleunik_gauche="+vf_e_doc_cleunik+"&vl_e_doc_cleunik_droite="+vv_t_tableau_cleunik[0]+"&",pf_affiche_donnees_connexions);
        break;
    }
  }
}
function pf_traite_deja_dans_table(){
	if (fa_value_get("rdg_vide")==1){
		fa_vide_arbre_bis("arbre_recupera_courriel");
	}
	var vl_refweb="",vl_syntax="";
	var treeItem="",treeRow="",treeCell_01="",treeCell_02 = "";
	try {
		var vl_e_nbligne=fa_cl("arbre_recupera_das_courriel");
	  if (vl_e_nbligne!=0) {
	    for(i=0;i<vl_e_nbligne;i++) {
		    vl_refweb=fa_cell_get("arbre_recupera_das_courriel",i,"tc_recupera_das_refweb");
		    vl_syntax=fa_cell_get("arbre_recupera_das_courriel",i,"tc_recupera_das_controle_01");
				treeItem = fa_crexul("treeitem");
	  		treeRow  = fa_crexul("treerow");
	  		treeCell_01 = fa_crexul("treecell");
	  		treeCell_02 = fa_crexul("treecell");
			  treeCell_01.setAttribute("label",vl_refweb);
			  treeCell_02.setAttribute("label",vl_syntax);
			  treeRow.appendChild(treeCell_01);
			  treeRow.appendChild(treeCell_02);
			  treeItem.appendChild(treeRow);
			  fa_gid("fils_recupera_destination").appendChild(treeItem);
	    }
		}
	} catch (e) {
		//alert(e)
    //return null
	}
}
function pf_validation(){
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_recupera_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    var j=-1;
    for(i=0;i<vl_e_nb_sel;i++) {
      j++;
      vl_t_web[j]=window.btoa(fa_cell_get("arbre_recupera_panier",vl_t_tableau[i],"tc_recupera_panier_refweb"));
    }
    if (vl_t_web.length!=0) {
      fa_grise_oui("bt_valider_dans_fichier");
	  fa_grise_fenetre("","oui");
      fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_validation_suite);
    } else {
      alert("$vl_c_bsl_117js");
    }
  } else {
    alert("$vl_c_bsl_117js");
    return;
  }  
}
function pf_validation_suite(){
  var vl_c_donnee="";
  vl_c_donnee+="vl_veuxpasdemail="+fa_value_get("rdg_veuxpasdemail")+"&";
  //vl_c_donnee+="vl_valide="+fa_value_get("rdg_valide")+"&";
  vl_c_donnee+="vl_valide=-1&";
  fa_xmlhttprequest_txt(c_script_traitement,vl_c_donnee,pf_validation_fin);
}
function pf_validation_fin(stream){
  var vl_c_datas = stream;
  alert(vl_c_datas);
  fa_grise_non("bt_valider_dans_fichier");
  fa_grise_fenetre("","non");
}
]]></script>
END;
?>
