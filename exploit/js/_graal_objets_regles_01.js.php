<?php
switch ($vl_c_mode) {
  case "":
    $brik_js_01="fa_focusdonne('rdg_oui_non');";
    break;
  case "superbigboss":
    $brik_js_01="fa_focusdonne('tb_titre');";
    break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
********************************************************************************************************************************
**********  Fenêtre de gestion des règles                  (_graal_fen_regles_application_01.php)                       ********
********************************************************************************************************************************
*/
var vf_o_tree;
var vf_e_sel_cleunik;
var vf_c_action;
const cf_c_script_bdope_fen='_graal_bdope_objets_01.php';
const cf_c_script_edite='_graal_xml_objets_fenetres_01.php';
const cf_c_das_regles='_graal_das_objets_01.php?vl_e_type=5&';
function pf_affiche_datas(stream) {
  var vl_c_datas = stream;
  fa_value_set('rdg_oui_non',fa_xml_get(vl_c_datas,'acces'));
}
function pf_alimente_defaut() {
  fa_value_set('rdg_oui_non',"1");
  fa_value_set("tb_titre","Reg_");
}
function pf_alimente_table() {
  fa_das("arbre_des_objets",cf_c_das_regles+"raf="+Math.random());
}
function pf_etat_fen(vv_quoi)  {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_o_tree = fa_gid("arbre_des_objets");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       pf_raz_fiche();
       pf_alimente_table();
       break;
     case "selectionner": 
      var rowIndex = vf_o_tree.currentIndex;
      if(rowIndex == -1){return;}
      fa_att_set("tb_titre","_graal_cleunik",fa_cell_get("arbre_des_objets",rowIndex,"fen_cleunik"));
      fa_value_set("tb_titre",fa_cell_get("arbre_des_objets",rowIndex,"titre"));
      fa_value_set("tb_descriptif_sommaire",fa_cell_get("arbre_des_objets",rowIndex,"descriptif"))
      fa_grise_non("bt_supprimer");
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
       break;
     case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_focusdonne('tb_titre');
      break;
     case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_focusdonne('tb_titre');
       break;
     case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      pf_raz_fiche();
      vf_o_tree.focus();
      break;
     case "sortir":
     window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
     //window.history.back(); //  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre

     break;   
}
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=='ok') {pf_alimente_table();} else {fa_erreur(vl_datas)}
  pf_etat_fen('annuler');
}
function pf_raz_fiche() {
  fa_value_set("tb_titre","");
  fa_value_set("tb_descriptif_sommaire","");
  fa_att_set("tb_titre","_graal_cleunik","-1");
}
function pf_sel_ligne(vv_qui) {
  if(fa_est_grise("bt_detailler")==true){return};
  var rowIndex = vf_o_tree.currentIndex;
  if(rowIndex == -1){return;}
  var vl_e_fen_cleunik=fa_cell_get("arbre_des_objets",rowIndex,"fen_cleunik")
  fa_att_set("tb_titre","_graal_cleunik",vl_e_fen_cleunik);
  fa_value_set("tb_titre",fa_cell_get("arbre_des_objets",rowIndex,"titre"));
  fa_value_set("tb_descriptif_sommaire",fa_cell_get("arbre_des_objets",rowIndex,"descriptif"))
  s ="fen_cleunik="+vl_e_fen_cleunik+"&";
  fa_xmlhttprequest_xml(cf_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi) {
  var s;
  var vl_e_fen_cleunik=fa_att_get("tb_titre","_graal_cleunik");
  s ="vl_e_fen_cleunik="+vl_e_fen_cleunik+"&";
  s +="vl_e_type=5&";  //  Objet Règle
  s +="vl_c_titre="+fa_enc(fa_value_get("tb_titre"))+"&";
  s +="vl_c_descriptif="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
  s +="vl_e_acces="+fa_enc(fa_value_get("rdg_oui_non"))+"&";
  switch(vv_quoi) {
   case "enregistrer":
      if (vl_e_fen_cleunik!=-1) {s +="vf_c_action=modifier&";}
      else
      {s +="vf_c_action=ajouter&";}
    break;
   case "supprimer":
     Check = confirm("Confirmez-vous la suppression de cette règle ?");
     if(Check == false) return;
     s +="vf_c_action=supprimer&";
    break;
 }     
 fa_xmlhttprequest_txt(cf_c_script_bdope_fen,s,pf_fin_requete);
}
]]></script>
END;
?>
