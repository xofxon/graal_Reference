<?php
$vl_c_beb_101=fa_recup_dico_js("beb_101");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_url_arbre='_graal_das_criteres_ged.php?';
const vf_c_script_edite='_graal_xml_criteres_00.php?vl_c_portee=ged&';
const vf_c_script_bdope_criteres='_graal_bdope_criteres_00.php';
var vf_e_critere_cleunik;
var vf_e_nombre_utilisations;
function pf_alimente_defaut(){
  fa_value_set('rdg_actif',"1");
  fa_value_set('rdg_multiple',"2");
  fa_value_set('rdg_horsliste',"2");
  fa_value_set('rdg_perso',"2");
  fa_value_set('rdg_codepertinent',2);
}
function pf_alimente_table(){
  var vl_c_param="";
  vl_c_param+=vf_c_url_arbre;
  vl_c_param+='&raf01='+Math.random();
  vl_c_param+='&vl_c_etat='+fa_value_get('rdg_etat');
  vl_c_param+='&vl_c_position='+fa_value_get('rdg_position');
  fa_das('arb_criteres',vl_c_param);
}
function pf_etat_fen(vv_quoi) {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_value_set('rdg_etat',2);
       fa_value_set('rdg_position',2);
       pf_alimente_defaut();
       pf_alimente_table();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "selectionner":
      if((fa_cui('arb_criteres')== -1) || (vf_e_critere_cleunik==0)) {return;}
     if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
	 if (vf_e_critere_cleunik<=9999) {fa_grise_oui("bt_supprimer");}
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_ajouter");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     fa_grise_groupe_oui('broadcaster_01');
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_non("bt_sortir");
       pf_raz_fiche();
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_critere_code");
       break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("tb_critere_denomination");
      break;
    case "sortir":
     window.close();
     break;   
}
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!='-1'){pf_alimente_table();}else{fa_erreur(vl_datas)}
  if (window.opener!=null) {window.opener.pf_affiche_criteres_potentiel_ged()}
  pf_etat_fen('annuler');
}
function pf_raz_fiche(){
  fa_value_set('tb_critere_code',"");
  fa_value_set('tb_critere_denomination',"");
  fa_gid("bed_ml_type").selectedIndex=0;
  fa_value_set('rdg_actif',1);
  fa_value_set('tb_blocnotebrut',"");
  fa_value_set('rdg_multiple',2);
  fa_value_set('rdg_horsliste',2);
  fa_value_set('rdg_perso',2);
  fa_value_set('rdg_codepertinent',2);
  fa_value_set('la_dateheurecreation',"");
  fa_value_set('la_dateheuremodif',"");
  vf_e_critere_cleunik=0;
}
function pf_sel_ligne(vv_objet){
  if (fa_est_grise("bt_detailler")==true) {return};
  var arbre = fa_gid(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_critere_cleunik=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("critere_cleunik"));
  var s ="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,bed_pf_affiche_datas);
}
function pf_validation(vv_quoi) {
  var s;
  var vl_c_portee;
  vl_c_portee=16384;
  switch(vv_quoi) {
    case "enregistrer":
     s ="vl_c_action="+fa_enc(vf_c_action)+"&";
     s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
     s +="vl_critere_code="+fa_enc(fa_value_get('tb_critere_code'))+"&";
     s +="vl_critere_denomination="+fa_enc(fa_value_get('tb_critere_denomination'))+"&"
     s +="vl_critere_type="+fa_enc(fa_gid("bed_ml_type").selectedItem.value)+"&"
     s +="vl_critere_choixmultiples="+fa_enc(fa_value_get('rdg_multiple'))+"&"
     s +="vl_critere_blocnotebrut="+fa_enc(fa_value_get('tb_blocnotebrut'))+"&"
     s +="vl_critere_actif="+fa_enc(fa_value_get('rdg_actif'))+"&"
     s +="vl_critere_portee="+fa_enc(vl_c_portee)+"&"
     s +="vl_critere_hl="+fa_enc(fa_value_get('rdg_horsliste'))+"&"
     s +="vl_critere_perso="+fa_enc(fa_value_get('rdg_perso'))+"&"
     s +="vl_critere_codechoixpertinent="+fa_enc(fa_value_get('rdg_codepertinent'))+"&"
    break;
     case "supprimer":
       Check = confirm("$vl_c_beb_101");
       if(Check == false) return;
       s ="vl_c_action=supprimer&";
       s +="vl_critere_cleunik="+vf_e_critere_cleunik+"&";
      break;
}
fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
