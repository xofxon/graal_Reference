<?php
$vl_c_bpg_113=fa_recup_dico_js("bpg_113");
$vl_c_bpg_114=fa_recup_dico_js("bpg_114");
$vl_c_bpg_115=fa_recup_dico_js("bpg_115");
switch ($vl_c_genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "avocli":
  case "avofin":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
    $vf_c_script_cial_representants="_graal_das_docial_representants.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
    $vf_c_script_bdope_fen="_graal_bdope_cial_representants_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_e_action_cleunik=$vl_action_cleunik&";
    break;
}
if ($vl_action_rep_cleunik==0) {
  $vl_c_champ_focus="bbm_tb_rechapproxima";
  $vl_c_init="pf_affiche_donnees_representants();pf_approximatif();";
  $vl_c_fin_requete="pf_affiche_donnees_representants();if (window.opener!=null) {try {window.opener.pf_cial_affiche_representants();} catch(e){}}";
} else {
  $vl_c_champ_focus="tb_taux";
$vl_c_init=<<<EOT
  vl_c_param="";
  vl_c_param+="raf_random="+Math.random()+"&";
  fa_xmlhttprequest_xml("_graal_xml_cial_representants_01.php?genreaction=$vl_c_genreaction&vl_action_rep_cleunik=$vl_action_rep_cleunik&",vl_c_param,pf_alimente_detail);
EOT;
  $vl_c_fin_requete="try {window.opener.pf_cial_affiche_representants();close();} catch(e){}";
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_recherche="_graal_rech_acteurs_01.php?";
var vf_c_action,vf_c_url_alimente_table;
function pf_aa_init() {
  fa_sep("tb_taux");
  fa_sep("tb_montant");
  fa_focusdonne("$vl_c_champ_focus");
  $vl_c_init
}
function pf_affiche_donnees_representants() {
  fa_das("arbre_representants","$vf_c_script_cial_representants"+"raf_random="+Math.random()+"&");
}
function pf_alimente_table() {
  fa_das("arbre_acteurs",vf_c_url_alimente_table);
}
function pf_alimente_detail(stream){
var vl_c_datas = stream;
  fa_mlsel("ml_commission_typ",fa_xml_get(vl_c_datas,'commission_typ'),"value");
  fa_mlsel("ml_commission_regle",fa_xml_get(vl_c_datas,'commission_regle'),"value");
  fa_value_set("tb_taux",fa_xml_get(vl_c_datas,'commission_taux'));
  fa_value_set("tb_montant",fa_xml_get(vl_c_datas,'commission_fixe'));
}
function pf_approximatif(){
  var vl_c_texte=fa_value_get("bbm_tb_rechapproxima");
  if ( vl_c_texte == "" ) {return;}
  vf_c_url_alimente_table =  vf_c_script_recherche+'sortie=das&listecles=&vl_c_recherche='+fa_enc(fa_value_get("bbm_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("bbm_ml_zone")+'&vl_c_type='+fa_value_get("bbm_ml_type")+'&vl_c_qui='+fa_value_get("bbm_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+fa_mlget("bao_ml_actif")+"&";
  pf_alimente_table();
}
function pf_etat_fen(vv_quoi) {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "sortir":
      window.close();
      break;
  }
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas!="-1") {
    //alert(vl_datas);
    }
  else{
    //alert(vl_datas);
  }
  $vl_c_fin_requete
}
function pf_sel_arbre_acteurs(){
  var i=fa_cui("arbre_acteurs","");if(i==-1){return;}
  fa_att_set("tb_qui_droite","_graal_act_cleunik",fa_cell_get("arbre_acteurs",i,"act_cleunik"));
  fa_value_set("tb_qui_droite",fa_cell_get("arbre_acteurs",i,"qui")+' ('+fa_cell_get("arbre_acteurs",i,"raisonsoc")+')');
}
function pf_validation(vv_quoi){
  var vl_c_donnees;
  switch (vv_quoi) {
    case "enregistrer":
      if (fa_att_get("tb_qui_droite","_graal_act_cleunik")=='0') {alert("$vl_c_bpg_113");return;}
      vl_c_donnees="";
      vl_c_donnees+="vl_act_cleunik_rep="+fa_enc(fa_att_get("tb_qui_droite","_graal_act_cleunik"))+"&";
      vl_c_donnees+="vl_commission_typ="+fa_enc(fa_value_get("ml_commission_typ"))+"&";
      vl_c_donnees+="vl_commission_taux="+fa_enc(fa_value_get("tb_taux"))+"&";
      vl_c_donnees+="vl_commission_fixe="+fa_enc(fa_value_get("tb_montant"))+"&";
      vl_c_donnees+="vl_commission_regle="+fa_enc(fa_value_get("ml_commission_regle"))+"&";
      vl_c_donnees+="vf_c_action=ajouter&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
    case "modifier":
      vl_c_donnees="";
      vl_c_donnees+="vl_action_rep_cleunik=$vl_action_rep_cleunik&";
      vl_c_donnees+="vl_commission_typ="+fa_enc(fa_value_get("ml_commission_typ"))+"&";
      vl_c_donnees+="vl_commission_taux="+fa_enc(fa_value_get("tb_taux"))+"&";
      vl_c_donnees+="vl_commission_fixe="+fa_enc(fa_value_get("tb_montant"))+"&";
      vl_c_donnees+="vl_commission_regle="+fa_enc(fa_value_get("ml_commission_regle"))+"&";
      vl_c_donnees+="vf_c_action=modifier&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
    case "supprimer":
      var i=fa_cui("arbre_representants","");if(i==-1){alert("$vl_c_bpg_113");return;}
      if(confirm("$vl_c_bpg_115") == false) return;
      vl_c_donnees="";
      vl_c_donnees+="vl_act_cleunik_rep="+fa_enc(fa_cell_get("arbre_representants",i,"tr_act_cleunik_rep"))+"&";
      vl_c_donnees+="vl_action_rep_cleunik="+fa_enc(fa_cell_get("arbre_representants",i,"tr_action_rep_cleunik"))+"&";
      vl_c_donnees+="vf_c_action=supprimer&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;
    case "supprimer_bis":
      if(confirm("$vl_c_bpg_115") == false) return;
      vl_c_donnees="";
      vl_c_donnees+="vl_act_cleunik_rep="+fa_enc(fa_att_get("tb_qui_droite","_graal_act_cleunik"))+"&";
      vl_c_donnees+="vl_action_rep_cleunik=$vl_action_rep_cleunik&";
      vl_c_donnees+="vf_c_action=supprimer&";
      fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      break;

    case "supprimer_kilometre":
      var vl_t_tableau=[];
      var vl_e_nb_sel;
      vl_t_tableau=fa_lignes_selectionnees("arbre_representants");
      vl_e_nb_sel=vl_t_tableau.length
      if (vl_e_nb_sel!=0) {
      var vl_b_rep=confirm("$vl_c_bpg_114 ("+vl_e_nb_sel+")");
      if(vl_b_rep == false) return;
        var vl_t_action_rep_cleunik=[];
        for(i=0;i<vl_e_nb_sel;i++){
          vl_t_action_rep_cleunik[i]=fa_cell_get("arbre_representants",vl_t_tableau[i],"tr_act_cleunik_rep");
        }
        vl_c_donnees="vf_c_action=kilometres_supprimer&";
        vl_c_donnees+="vl_t_action_rep_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_action_rep_cleunik))+"&";
        fa_xmlhttprequest_txt("$vf_c_script_bdope_fen",vl_c_donnees,pf_fin_requete);
      }
      break;
    }
}
]]></script>
END;
?>
