<?php
include("_graal_var_portee.php");
$vl_e_portee=$vl_e_articl;
$vl_c_bdl_102=fa_recup_dico_js("bdl_102");
$vl_c_bop_112js=fa_recup_dico_js("bop_112");
$vl_c_bop_113js=fa_recup_dico_js("bop_113");
$vl_c_bop_114js=fa_recup_dico_js("bop_114");
$vl_c_bop_115js=fa_recup_dico_js("bop_115");
$vl_c_bop_127js=fa_recup_dico_js("bop_127");
$vl_c_bop_128js=fa_recup_dico_js("bop_128");
$vl_c_bop_129js=fa_recup_dico_js("bop_129");
$vl_c_bop_132js=fa_recup_dico_js("bop_132");
$vl_c_bop_142js=fa_recup_dico_js("bop_142");
$vl_c_bop_143js=fa_recup_dico_js("bop_143");
$vl_c_bop_145js=fa_recup_dico_js("bop_145");
switch ("$vl_c_type") {
  case '1': //  Normal
    $pf_alimente_table=<<<EOT
function pf_alimente_table() {
}
EOT;
    $pf_aa_init_01="fa_ael('bbo_ml_qui','ValueChange',po_change_menu);po_change_menu();";
    break;
  case '2': //  Choix
  case '3': //  Critère
$pf_alimente_table=<<<EOT
function pf_alimente_table(){
  var vl_c_toto="";
  var vl_e_panier='&vl_e_panier=&';
  vl_c_toto=c_script_das_article+'?vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui=tous&vl_e_actif=0&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
  if (fa_gid("cb_actifs_oui").checked==true){vl_c_toto+="vl_e_actif=1&";}
  if (fa_gid("cb_actifs_non").checked==true){vl_c_toto+="vl_e_inactif=2&";}
  vl_c_url_alimente_table=vl_c_toto+"sortie=das&"+vl_e_panier;
  vf_c_recup_requete=vl_c_toto+"sortie=sql&"+vl_e_panier;
  fa_ds("arbre_des_articles","");fa_ds("arbre_des_articles",vl_c_url_alimente_table);
}
EOT;
$pf_aa_init_01="";
  break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_t_panier_tarifs=[];
var vf_t_panier_acteurs=[];
const c_script_edite="_graal_xml_traitements_articles_02.php?vl_e_type=$vl_c_genre&";
const c_das_casdemploi_articles="_graal_das_articles_traitements_02_articles.php?vl_e_type_tarif=$vl_c_genre&"
const c_fen_tarifs="_graal_fen_art_tarifs_01.php?vl_c_genre=$vl_c_genre&vl_c_origine=article&";
const c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_article_tarifs';
const c_script_das_article='_graal_das_articles_01.php';
const c_script_bdope_fen="_graal_bdope_traitements_articles_02.php";
const c_script_act='_graal_rech_acteurs_01.php?var=vs_tempo_panier_acteur&';
const c_script_var_acteurs='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_acteur';
function pf_aa_ferme() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_e_nbligne=fa_cl("arbre_des_articles_panier");
  if (vl_e_nbligne!=0) {
    var vl_t_art_cleunik=[];
    for(i=0;i<vl_e_nbligne;i++) {
      vl_t_art_cleunik[i]=fa_cell_get("arbre_des_articles_panier",i,"art_cleunik_panier");
    }
    if (window.opener!=null) {
      try {
        window.opener.pf_retour_selection_articles(vl_t_art_cleunik);
        //setTimeout(close, 0);
      } catch(e) {
         alert(e);
      }
    }
  }
}
function pf_aa_init() {
  fa_sep("coef_multiplicateur");
  fa_att_set("bbo_ml_actif","oncommand","po_selbbo_ml_actif();pf_rafraichir_tarif();");
  fa_att_set("bbo_ml_qui","oncommand","po_sel();pf_rafraichir_tarif();");
  fa_att_set("bbo_tb_rechapproxima","oninput","pf_rafraichir_tarif();");
  fa_att_set("bbo_ml_zone","oncommand","pf_rafraichir_tarif();");
  fa_att_set("bbo_tb_limit","oninput","pf_rafraichir_tarif();");
  fa_att_set("bbo_top_raf01","oncommand","pf_rafraichir_tarif();");
  fa_att_set("arbre_des_acteurs",'seltype','multiple');
  fa_att_set("arbre_des_acteurs",'context','pop_selections_acteurs');
  fa_att_set("arbre_des_acteurs",'onselect','');
  fa_att_set("arbre_des_acteurs_panier",'seltype','multiple');
  fa_att_set("arbre_des_acteurs_panier",'context','pop_panier_acteurs');
  fa_att_set("arbre_des_acteurs_panier",'onselect','');
  $pf_aa_init_01
  pf_alimente_table();
}
function pf_acteur_ouvre(vv_no) {
  var vl_c_arbre="",vl_c_act_cleunik,vl_c_type_acteur;
  switch (vv_no) {
    case 1 : vl_c_arbre="arbre_des_articles";vl_c_act_cleunik="act_cleunik";vl_c_type_acteur="typeacteur";break;
    case 2 : vl_c_arbre="arbre_des_articles_panier";vl_c_act_cleunik="act_cleunik_panier";vl_c_type_acteur="typeacteur_panier";break;
    case 3 : vl_c_arbre="arbre_des_acteurs";vl_c_act_cleunik="act_cleunik";vl_c_type_acteur="typeacteur";break;
    case 4 : vl_c_arbre="arbre_des_acteurs_panier";vl_c_act_cleunik="act_cleunik_panier";vl_c_type_acteur="typeacteur_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  if (fa_cell_get(vl_c_arbre,i,vl_c_act_cleunik)==0) {return;}
  var param=fa_cell_get(vl_c_arbre,i,vl_c_type_acteur)+"&"
  param+="act_cleunik="+fa_cell_get(vl_c_arbre,i,vl_c_act_cleunik)+"&";
  fa_ouvre(c_script_fen_acteur+param,1000,800);
}

function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  fa_gid("tab_articles").label=fa_xml_get(vl_c_datas,'nombre_emploi_articles')+"  $vl_c_bop_112js";
  fa_gid("tab_acteurs").label=fa_xml_get(vl_c_datas,'nombre_emploi_acteurs')+"  $vl_c_bop_113js";
  fa_gid("tab_nomenclatures").label=fa_xml_get(vl_c_datas,'nombre_emploi_nomenclatures')+"  $vl_c_bop_114js";
  fa_gid("tab_documents").label=fa_xml_get(vl_c_datas,'nombre_emploi_documents')+"  $vl_c_bop_115js";
  fa_bgc("bt_rafraichir_tarif",'init');
  fa_grise_non("bt_rafraichir_tarif");
  fa_bgc("ml_tarif",'init');
  fa_grise_non("ml_tarif");
  fa_approximatif_bbo(c_das_casdemploi_articles+"vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&raf_random="+Math.random()+"&");
  pf_approximatif();
}
$pf_alimente_table
function pf_approximatif() {
  switch ($vl_c_type) {
    case 1:
      if ( fa_value_get("aai_tb_rechapproxima") == "" ) {return;};
      vf_c_url_alimente_table=c_script_act+'sortie=das&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+fa_mlget("bao_ml_actif")+"&vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&";
      vf_c_recup_requete=c_script_act+'sortie=sql&vl_c_limit='+fa_enc(fa_value_get("bao_tb_limit"))+'&listecles=&vl_c_recherche='+fa_enc(fa_value_get("aai_tb_rechapproxima"))+'&vl_c_zone='+fa_value_get("aai_ml_zone")+'&vl_c_type='+fa_value_get("aai_ml_type")+'&vl_c_qui='+fa_value_get("bao_ml_qui")+'&raf_random='+Math.random()+'&vl_c_actifs='+fa_value_get("bao_ml_actif")+'&vl_e_panier='+fa_mlget("bao_ml_actif")+"&vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&";
      break;
    case 2:
    case 3:
      vf_c_url_alimente_table=c_script_act+'sortie=das&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      vf_c_recup_requete=c_script_act+'sortie=sql&vl_c_recherche='+fa_enc('%')+"&vl_c_zone=1&vl_c_type=1&vl_c_qui="+fa_att_get("_graal_ove_bdx_datas","_graal_genreacteur")+"&raf_random='"+Math.random()+"'&vl_e_choix_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_choix_cleunik")+"&vl_e_critere_cleunik="+fa_att_get("_graal_ove_bdx_datas","_graal_critere_cleunik")+"&vl_c_t01="+fa_att_get("_graal_ove_bdx_datas","_graal_quoi")+"&";
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_url_alimente_table+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_url_alimente_table+="vl_c_inactifs=2&";}
      if (fa_gid("cb_actifs_oui").checked==true){vf_c_recup_requete+="vl_c_actifs=1&";}
      if (fa_gid("cb_actifs_non").checked==true){vf_c_recup_requete+="vl_c_inactifs=2&";}
      break;
  }
  switch (fa_value_get("bao_ml_qui")) {
    case "000000": case "110001": case "110003": case "110002": case "110004": case "110005": case "110006":
      fa_cache_oui("portee");break;
    case "999999": case "888888":
      fa_cache_non("portee");break;
  }
  fa_das("arbre_des_acteurs",vf_c_url_alimente_table);
}
function pf_article_ouvre(vv_no) {
  var vl_c_arbre="",vl_c_art_cleunik;
  switch (vv_no) {
    case 1 : vl_c_arbre="arbre_des_articles";vl_c_art_cleunik="art_cleunik";break;
    case 2 : vl_c_arbre="arbre_des_articles_panier";vl_c_art_cleunik="art_cleunik_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  var vl_e_art_cleunik=fa_cell_get(vl_c_arbre,i,vl_c_art_cleunik);
	fa_ouvre_article('genre=tousss&vl_e_art_cleunik='+vl_e_art_cleunik+"&","");
}
function pf_critere_action(vv_quoi) {
  var vl_t_article=[];
  vl_t_article=pf_tab_articles("arbre_des_articles");
  var vl_c_donnees="";
  if (vl_t_article.length==0) {return;}
  switch (vv_quoi) {
    case 'sup':
      vl_c_donnees="vf_c_action=critere_sup&vl_e_critere_cleunik=$vl_e_critere_cleunik&";
      vl_c_donnees+="vl_t_article="+fa_enc(fa_jsarray2php_00(vl_t_article))+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
      break;
  }
}
function pf_choix_action(vv_quoi) {
  var vl_t_article=[];
  vl_t_article=pf_tab_articles("arbre_des_articles");
  var vl_c_donnees="";
  if (vl_t_article.length==0) {return;}
  switch (vv_quoi) {
    case 'sup':
      vl_c_donnees="vf_c_action=choix_sup&vl_e_choix_cleunik=$vl_e_choix_cleunik&";
      break;
    case 'ajo':
      vl_c_donnees="vf_c_action=choix_ajo&vl_e_choix_cleunik=$vl_e_choix_cleunik&vl_e_critere_cleunik=$vl_e_critere_cleunik&";
      break;
  }
  vl_c_donnees+="vl_t_article="+fa_enc(fa_jsarray2php_00(vl_t_article))+"&";
  fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_validation_fin);
}

function pf_panier_ajoute_tarifs() {
  var vl_t_tarifs=pf_tab_tarifs("arbre_des_articles");
  if (vl_t_tarifs.length==0) {return;}
  var vl_t_panier=[];
  vl_t_panier=vf_t_panier_tarifs;
  vf_t_panier_tarifs=vl_t_panier.concat(vl_t_tarifs);
  fa_remove_attribute("bt_voir_panier","collapsed");
  fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier_tarifs),pf_tableau_donnees_fin);
}
function pf_panier_ajoute_acteurs() {
  var vl_t_acteurs=pf_tab_acteurs("arbre_des_acteurs");
  if (vl_t_acteurs.length==0) {return;}
  var vl_t_panier=[];
  vl_t_panier=vf_t_panier_acteurs;
  vf_t_panier_acteurs=vl_t_panier.concat(vl_t_acteurs);
  fa_remove_attribute("bt_voir_panier_acteurs","collapsed");
  fa_xmlhttprequest_txt(c_script_var_acteurs,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier_acteurs),pf_tableau_acteurs_donnees_fin);
}

function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_articles_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_tarifs=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_tarifs[i]=fa_cell_get("arbre_des_articles_panier",vl_t_tableau[i],"tar_cleunik_panier");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier_tarifs.length;i++) {
      if (vl_t_tarifs.indexOf(vf_t_panier_tarifs[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier_tarifs[i];
      }  
    }
    vf_t_panier_tarifs=vl_t_panier;
    fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier_tarifs),pf_tableau_donnees_fin);
  }
}
function pf_panier_enleve_acteurs() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_acteurs_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_acteurs=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteurs[i]=fa_cell_get("arbre_des_acteurs_panier",vl_t_tableau[i],"act_cleunik");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier_acteurs.length;i++) {
      if (vl_t_acteurs.indexOf(vf_t_panier_acteurs[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier_acteurs[i];
      }  
    }
    vf_t_panier_acteurs=vl_t_panier;
    fa_xmlhttprequest_txt(c_script_var_acteurs,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier_acteurs),pf_tableau_acteurs_donnees_fin);
  }
}
function pf_rafraichir_tarif() {
  fa_bgc("bt_rafraichir_tarif",'red');
  fa_grise_oui("bt_rafraichir_tarif");
  fa_bgc("ml_tarif",'red');
  fa_grise_oui("ml_tarif");
  var s ="vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&raf_random="+Math.random()+"&";
  fa_xmlhttprequest_xml(c_script_edite,s,pf_affiche_datas);
}
function pf_recup_requete(vv_export) {
  vf_c_export=vv_export;
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arbre_des_articles_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_acteur=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteur[i]=fa_cell_get("arbre_des_articles_panier",vl_t_tableau[i],"art_cleunik_panier");
    }
    fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_acteur),pf_recup_requete_01);
  }
}
function pf_recup_requete_01() {
  fa_xmlhttprequest_txt(c_das_casdemploi_articles,'sortie=sql&vl_c_type=0&vl_c_qui=888888&vl_e_tarif_cleunik='+fa_mlget('ml_tarif')+"&raf_random="+Math.random()+"&",pf_recup_requete_fin);
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
}
function pf_tab_acteurs(vv_arbre){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_acteurs=[];
  vl_t_tableau=fa_lignes_selectionnees(vv_arbre);
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_acteurs[i]=fa_cell_get(vv_arbre,vl_t_tableau[i],"act_cleunik");
    }
  }
  return vl_t_acteurs;
} 
function pf_tab_articles(vv_arbre){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_article=[];
  vl_t_tableau=fa_lignes_selectionnees(vv_arbre);
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_article[i]=fa_cell_get(vv_arbre,vl_t_tableau[i],"art_cleunik");
    }
  }
  return vl_t_article;
} 
function pf_tab_tarifs(vv_arbre){
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_t_tarif=[];
  vl_t_tableau=fa_lignes_selectionnees(vv_arbre);
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_tarif[i]=fa_cell_get(vv_arbre,vl_t_tableau[i],"tar_cleunik");
    }
  }
  return vl_t_tarif;
} 
function pf_tableau_donnees_fin(stream) {
  var s ="vl_c_type=0&vl_e_actif=0&vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&raf_random="+Math.random()+'&';
  fa_das("arbre_des_articles_panier",c_das_casdemploi_articles+s);
}
function pf_tableau_acteurs_donnees_fin(stream) {
  var s ="sortie=rdf&vl_c_type=0&vl_e_actif=0&vl_e_tarif_cleunik="+fa_mlget('ml_tarif')+"&raf_random="+Math.random()+'&';
  fa_ds("arbre_des_acteurs_panier","");
  fa_ds("arbre_des_acteurs_panier",c_script_act+s);
}
function pf_tarif_ouvre(vv_no) {
  var vl_c_arbre="",vl_c_art_cleunik,vl_c_act_cleunik,vl_c_tar_cleunik;
  switch (vv_no) {
    case 1 : vl_c_arbre="arbre_des_articles";vl_c_art_cleunik="art_cleunik";vl_c_act_cleunik="act_cleunik";vl_c_tar_cleunik="tar_cleunik";break;
    case 2 : vl_c_arbre="arbre_des_articles_panier";vl_c_art_cleunik="art_cleunik_panier";vl_c_act_cleunik="act_cleunik_panier";vl_c_tar_cleunik="tar_cleunik_panier";break;
  }
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  var vl_e_art_cleunik=fa_cell_get(vl_c_arbre,i,vl_c_art_cleunik);
  var vl_e_act_cleunik=fa_cell_get(vl_c_arbre,i,vl_c_act_cleunik);
  var vl_e_tar_cleunik=fa_cell_get(vl_c_arbre,i,vl_c_tar_cleunik);
  if (vl_e_act_cleunik!=0) {
    switch ("$vl_c_genre") {
      case "1":var vl_e_type=110003;break;  // tarifs particulier clients
      case "2":var vl_e_type=110004;break;  // tarifs particulier fournisseur
    }
  } else {
    var vl_e_type=110000; //  Tarifs généraux
  }
  var vl_c_param="vl_e_art_cleunik="+vl_e_art_cleunik+"&vl_e_act_cleunik="+vl_e_act_cleunik+"&vl_e_tar_cleunik="+vl_e_tar_cleunik+"&vl_e_type="+vl_e_type+"&";
  fa_ouvre(c_fen_tarifs+vl_c_param,1000,650);
}

function pf_tarif_action_acteur(vv_no) {
  var vl_t_acteur=pf_tab_acteurs("arbre_des_acteurs_panier");
  if (vl_t_acteur.length==0) {return;}
  switch (vv_no) {
    case 1: //  Remplacement des tarifs des acteurs
      if(!confirm("$vl_c_bop_145js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_remplacement_acteurs&";
      vl_c_donnees+="vl_e_tarif_cleunik="+fa_mlget('ml_tarif_remplacement')+"&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_acteur))+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_remplacement);
      break;  
  }
}
function pf_tarif_action(vv_no) {
  var vl_t_tarif=pf_tab_tarifs("arbre_des_articles_panier");
  if (vl_t_tarif.length==0) {return;}
  switch (vv_no) {
    case 1: //  Suppression
      if(!confirm("$vl_c_bop_127js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_supprimer&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_supprime);
      break;  
    case 2: //  Désactivation
      if(!confirm("$vl_c_bop_129js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_desactiver&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_active);
      break;  
    case 3: //  Activation
      if(!confirm("$vl_c_bop_128js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_activer&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_active);
      break;  
    case 4: //  Mise à jour de la date de validité
      if(!confirm("$vl_c_bop_132js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_datevalidite&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      vl_c_donnees+='vl_c_datevalidite='+fa_enc(fa_date_formate(fa_value_get("tb_dat_deb"),"AAAA-MM-JJ")+" 00:00:00")+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_active);
      break;  
    case 5: //  Simulation
      fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_tarif),pf_tarif_fin_simulation);
      break;  
    case 6: //  Modification des tarifs
      if(!confirm("$vl_c_bop_142js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_majtarif&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      vl_c_donnees+='vl_c_datevalidite='+fa_enc(fa_date_formate(fa_value_get("tb_dat_val_01"),"AAAA-MM-JJ")+" 00:00:00")+"&";
      vl_c_donnees+='vl_c_datedermaj='+fa_enc(fa_date_formate(fa_value_get("tb_dat_val_02"),"AAAA-MM-JJ")+" 00:00:00")+"&";
      vl_c_donnees+='vl_e_coeff_maj='+fa_value_get('coef_multiplicateur')+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_active);
      break;  
    case 7: //  Duplication des tarifs
      if(!confirm("$vl_c_bop_143js")) {return;}
      var vl_c_donnees="vf_c_action=kilometres_duplicationtarif&";
      vl_c_donnees+="vl_t_tarif="+fa_enc(fa_jsarray2php_00(vl_t_tarif))+"&";
      vl_c_donnees+='vl_c_datevalidite='+fa_enc(fa_date_formate(fa_value_get("tb_dat_val_01"),"AAAA-MM-JJ")+" 00:00:00")+"&";
      vl_c_donnees+='vl_c_datedermaj='+fa_enc(fa_date_formate(fa_value_get("tb_dat_val_02"),"AAAA-MM-JJ")+" 00:00:00")+"&";
      vl_c_donnees+='vl_e_coeff_maj='+fa_value_get('coef_multiplicateur')+"&";
      fa_xmlhttprequest_txt(c_script_bdope_fen,vl_c_donnees,pf_tarif_fin_duplication);
      break;  
  }
}
function pf_tarif_fin_active(stream) {
  fa_xmlhttprequest_txt(c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier_tarifs),pf_tableau_donnees_fin);
  pf_rafraichir_tarif();
  alert(stream);
}
function pf_tarif_fin_duplication(stream) {
  alert(stream);
}
function pf_tarif_fin_remplacement(stream) {
  alert(stream);
  pf_panier_enleve_acteurs();
  pf_rafraichir_tarif();
}
function pf_tarif_fin_simulation(stream) {
  var s ="vl_e_actif=4&raf_random="+Math.random()+'&vl_e_coeff_maj='+fa_value_get('coef_multiplicateur')+"&";
  fa_ds("arbre_des_articles_panier","");
  fa_das("arbre_des_articles_panier",c_das_casdemploi_articles+s);
  alert(stream);
}
function pf_tarif_fin_supprime(stream) {
  pf_panier_enleve();
  pf_rafraichir_tarif();
  alert(stream);
}
function pf_validation_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
  fa_approximatif_bbo();
}
function pf_voir_deck(vv_lequel) {
  fa_gid("deck_articles").selectedIndex=vv_lequel;
}
function pf_voir_deck_acteurs(vv_lequel) {
  fa_gid("deck_acteurs").selectedIndex=vv_lequel;
}
]]></script>
END;
?>
