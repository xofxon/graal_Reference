<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c_script_edite_recvoc="_graal_xml_recmail_01.php?action_cleunik=";
const c_script_edite_html="_graal_xml_recmail_02.php?&sortie=xul_recvoc&action_cleunik=";
const c_script_downl_pj="_graal_tel_doc_03.php?vl_e_doc_cleunik=";
const c_recvoc_script_titre="_graal_bdope_doc_titre.php";
var vf_c_pj_cleunik_recvoc="";
function pf_recvoc_affiche_donnees() {
  fa_xmlhttprequest_xml(c_script_edite_recvoc+vf_e_action_cleunik+"&","",pf_recvoc_affiche_datas);
}
function pf_recvoc_affiche_datas(stream){
  var vl_c_datas = stream;
  fa_att_set("tb_message_html","_graal_cleunik",fa_xml_get(vl_c_datas,'courriel_en_mes_cleunik'))
  fa_value_set("tb_recvoc_destinataires_de",fa_xml_get(vl_c_datas,'expediteurs'));
  fa_value_set("tb_recvoc_destinataires_a",fa_xml_get(vl_c_datas,'destinataires'));
  fa_value_set("tb_recvoc_destinataires_cc",fa_xml_get(vl_c_datas,'destinataires_cc'));
  fa_value_set("tb_recvoc_destinataires_le",fa_xml_get(vl_c_datas,'destinataires_le'));
  fa_value_set("tb_recvoc_destinataires_re",fa_xml_get(vl_c_datas,'destinataires_re'));
  var vl_type=fa_xml_get(vl_c_datas,'type')
  
  var vl_nb_pj=fa_xml_get(vl_c_datas,'pj_nombre')
  for (i=0; i<vl_nb_pj; i++){
    var vl_c_label=fa_xml_get(vl_c_datas,'nom_pj_'+i);
    vf_c_pj_cleunik_recvoc=fa_xml_get(vl_c_datas,'cleunik_pj_'+i);
    var vl_titre=fa_xml_get(vl_c_datas,'titre_'+i);
    var vl_nombre_criteres=fa_xml_get(vl_c_datas,'nombre_criteres_'+i);
		if (vl_nombre_criteres!="0"){
			vl_nombre_criteres=" ["+fa_xml_get(vl_c_datas,'nombre_criteres_'+i)+" critères.]";
		} else {
			vl_nombre_criteres="";
		}
    var row = document.createElement('listitem');
    var cell = document.createElement('listcell');
		if (vl_titre!=""){
			cell.setAttribute('label', vl_c_label+" ("+vl_titre+") "+vl_nombre_criteres);	
		} else {
			cell.setAttribute('label', vl_c_label+vl_nombre_criteres);	
		}
    cell.setAttribute('_graal_cleunik',vf_c_pj_cleunik_recvoc);
    row.appendChild( cell );
    fa_gid("li_pj").appendChild( row );
  }
	fa_att_set("tb_message_html","src",c_script_edite_html+vf_e_action_cleunik+"&recvoc_cleunik="+vf_c_pj_cleunik_recvoc+"&");
}
function pf_recvoc_ouvre_criteres_doc(){
	var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
	pf07_ouvre_criteres_doc(item1.childNodes[0].getAttribute('_graal_cleunik'),13,item1.childNodes[0].getAttribute('label'));
}
function pf_recvoc_ouvre_doc(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
	var vl_c_param="doc_cleunik="+item1.childNodes[0].getAttribute('_graal_cleunik')+"&";
  vl_c_param+="portee_cleunik=$vl_action_cleunik&";
	vl_c_param+="quelsdocs=undoc_action&genre=action&";
	pf07_ouvre_doc(vl_c_param);
}
function pf_recvoc_ouvre_titre_doc(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
	var vl_titre=prompt("Titre de la pièce jointe");
  if(vl_titre==null) {
  	//alert("$vl_c_bap_033js");
		return;
	}
 	fa_grise_fenetre("oui","");
	item1 = listbox.getItemAtIndex(x);
	var vl_c_param="vf_c_action=Changer_titre&vl_e_doc_cleunik="+item1.childNodes[0].getAttribute('_graal_cleunik')+"&";
	vl_c_param+="vf_c_titre="+fa_enc(vl_titre);
  fa_xmlhttprequest_txt(c_recvoc_script_titre,vl_c_param,pf_recvoc_ouvre_titre_doc_fin);
}
function pf_recvoc_ouvre_titre_doc_fin(vv_retour){
	if (vv_retour!="ok"){
		alert(vv_retour);
	}
	fa_grise_fenetre("non","");
}
function pf_recvoc_sel_pj(){
  var listbox = fa_gid("li_pj");
  var x=fa_cui("li_pj");if (x==-1) {return;}
  item1 = listbox.getItemAtIndex(x);
  fa_ouvre(c_script_downl_pj+item1.childNodes[0].getAttribute('_graal_cleunik'),400,400);
}
function pf_recvoc_traite(vv_genre,vv_type,vv_intcleunik){
  var vl_c_fen_courriel_texte="_graal_fen_courriel_01.php?type="+vv_type+"&genre="+vv_genre+"&action_cleunik="+vf_e_action_cleunik+"&vl_e_int_cleunik_recvoc="+vv_intcleunik+"&";
  fa_ouvre(vl_c_fen_courriel_texte,0,0);
}
]]></script>
END;
?>
