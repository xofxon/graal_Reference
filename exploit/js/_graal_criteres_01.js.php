<?php
/*
****************************************************************
**********  Fenêtre de gestion des critères d'acteurs  ********
****************************************************************
*/
$vl_c_00002=fa_recup_session('mess_00002','');
$vl_c_dico00019=fa_recup_dico_js("dico_00019");
$vl_c_dico00020=fa_recup_dico_js("dico_00020");
$vl_c_dico00021=fa_recup_dico_js("dico_00021");
$vl_c_dico00022=fa_recup_dico_js("dico_00022");
$vl_c_dico00023=fa_recup_dico_js("dico_00023");
$vl_c_dico00024=fa_recup_dico_js("dico_00024");
$vl_c_dico00025=fa_recup_dico_js("dico_00025");
$vl_c_dico00048=fa_recup_dico_js("dico_00048");
$vl_c_dico00049=fa_recup_dico_js("dico_00049");
$vl_c_dico00050=fa_recup_dico_js("dico_00050");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_url_arbre='_graal_das_choix_critere_01.php?genre=graal&';
const vf_c_script_stats="_graal_fen_graphiques_stat_01.php?critere_cleunik=$vl_e_cleunik_critere&genre=criteres&";
const vf_e_critere_cleunik="$vl_e_cleunik_critere";
var vf_e_nombre_utilisations,vf_e_choix_cleunik;
const vf_c_script_edite='_graal_xml_choix_criteres_01.php?';
const vf_c_script_bdope_criteres='_graal_bdope_choix_criteres_01.php';


function pf_affiche_datas(stream){
  var vl_c_datas,vl_c_type_acteurs;
  var vl_e_nombre,vl_e_choix_actif,vl_e_portee;
  pf_raz_fiche()
  vl_c_datas = stream;
  fa_value_set("tb_choix_valeur_texte_01",fa_xml_get(vl_c_datas,'choix_valeur_texte_01'));
  vl_e_choix_actif=fa_xml_get(vl_c_datas,'choix_actif');
  vf_e_choix_cleunik=fa_xml_get(vl_c_datas,'choix_cleunik');
  vl_e_portee=fa_xml_get(vl_c_datas,'choix_portee');
  if ((vl_e_portee &   1) ==   1) {fa_check('ch_n01')}
  if ((vl_e_portee &   2) ==   2) {fa_check('ch_n02')}
  if ((vl_e_portee &   4) ==   4) {fa_check('ch_n03')}
  if ((vl_e_portee &   8) ==   8) {fa_check('ch_n04')}
  if ((vl_e_portee &  16) ==  16) {fa_check('ch_n05')}
  if ((vl_e_portee &  32) ==  32) {fa_check('ch_n06')}
  if ((vl_e_portee &  64) ==  64) {fa_check('ch_n07')}
  switch(vl_e_choix_actif) {
   case "1":  fa_att_set('ra_choix_actif_oui',"selected", 'true');  break;
   case "2":  fa_att_set('ra_choix_actif_non','selected', 'true');  break;
  }
  vf_e_nombre_utilisations=0;
  for (i=0; i<=6; i++){
  	try {
  		vl_e_nombre=fa_xml_get(vl_c_datas,'nombre_utilisations_'+i);
  		vl_c_type_acteurs=fa_xml_get(vl_c_datas,'typeacteur_'+i);
      vf_e_nombre_utilisations+=vl_e_nombre;
  		pf_affiche_nombre_portee(vl_c_type_acteurs,vl_e_nombre);
  	} catch (e) {
  		vl_e_nombre=0;
  	}
  }
}
function pf_affiche_nombre_portee(vv_c_type_acteurs,vv_e_nombre){
  switch(vv_c_type_acteurs) {
    case '110000':  fa_check('ch_n01');fa_label('ch_n01',"$vl_c_dico00019 ("+vv_e_nombre+")");fa_att_set('ch_n01',"_graal_nombre", vv_e_nombre);break;
    case '110001':  fa_check('ch_n02');fa_label('ch_n02',"$vl_c_dico00020 ("+vv_e_nombre+")");fa_att_set('ch_n02',"_graal_nombre", vv_e_nombre);break;
    case '110003':  fa_check('ch_n03');fa_label('ch_n03',"$vl_c_dico00021 ("+vv_e_nombre+")");fa_att_set('ch_n03',"_graal_nombre", vv_e_nombre);break;
    case '110002':  fa_check('ch_n04');fa_label('ch_n04',"$vl_c_dico00022 ("+vv_e_nombre+")");fa_att_set('ch_n04',"_graal_nombre", vv_e_nombre);break;
    case '110004':  fa_check('ch_n05');fa_label('ch_n05',"$vl_c_dico00023 ("+vv_e_nombre+")");fa_att_set('ch_n05',"_graal_nombre", vv_e_nombre);break;
    case '110005':  fa_check('ch_n06');fa_label('ch_n06',"$vl_c_dico00024 ("+vv_e_nombre+")");fa_att_set('ch_n06',"_graal_nombre", vv_e_nombre);break;
    case '110006':  fa_check('ch_n07');fa_label('ch_n07',"$vl_c_dico00025 ("+vv_e_nombre+")");fa_att_set('ch_n07',"_graal_nombre", vv_e_nombre);break;
  }
}
function pf_alimente_defaut(){
fa_att_set('ra_choix_actif_oui',"selected", 'true');
fa_check('ch_n01');
fa_check('ch_n02');
fa_check('ch_n03');
fa_check('ch_n04');
fa_check('ch_n05');
fa_check('ch_n06');
fa_check('ch_n07');
}
function pf_etat_fen(vv_quoi)  {
   var vl_e_rowIndex;
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_value_set('rdg_etat',2);
       fa_value_set('rdg_position',2);
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf06_alimente_table_bbb();
       break;
     case "selectionner":
       vl_e_rowIndex=fa_cui('arb_choix_criteres');if(vl_e_rowIndex == -1){return;}
       if (vf_e_nombre_utilisations==0) {fa_grise_non("bt_supprimer");}else{fa_grise_oui("bt_supprimer");}
       if (vf_e_choix_cleunik<0) {fa_grise_oui("bt_supprimer");}
       fa_grise_non("bt_modifier");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_oui("bt_enregistrer");
       fa_grise_groupe_oui('broadcaster_01');
       break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf_raz_fiche();
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_choix_valeur_texte_01");
       break;
     case "modifier":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       fa_grise_groupe_non('broadcaster_01');
       if (fa_att_get('ch_n01',"_graal_nombre")!=0) {fa_grise_oui("ch_n01");}
       if (fa_att_get('ch_n02',"_graal_nombre")!=0) {fa_grise_oui("ch_n02");}
       if (fa_att_get('ch_n03',"_graal_nombre")!=0) {fa_grise_oui("ch_n03");}
       if (fa_att_get('ch_n04',"_graal_nombre")!=0) {fa_grise_oui("ch_n04");}
       if (fa_att_get('ch_n05',"_graal_nombre")!=0) {fa_grise_oui("ch_n05");}
       if (fa_att_get('ch_n06',"_graal_nombre")!=0) {fa_grise_oui("ch_n06");}
       if (fa_att_get('ch_n07',"_graal_nombre")!=0) {fa_grise_oui("ch_n07");}
       fa_focusdonne("tb_choix_valeur_texte_01");
       break;
     case "sortir":
     window.close();
     break;   
  }
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=='ok'){pf06_alimente_table_bbb();}else{fa_erreur(vl_datas)}
  pf_etat_fen('annuler');
}
function pf_ouvre_stats() {
  fa_ouvre(vf_c_script_stats)
}
function pf_raz_fiche(){
  fa_gid('ra_choix_actif_oui').removeAttribute('selected');
  fa_gid('ra_choix_actif_non').removeAttribute('selected');
  fa_gid('tb_choix_valeur_texte_01').value=''
  fa_uncheck('ch_n01');
  fa_uncheck('ch_n02');
  fa_uncheck('ch_n03');
  fa_uncheck('ch_n04');
  fa_uncheck('ch_n05');
  fa_uncheck('ch_n06');
  fa_uncheck('ch_n07');
  fa_label('ch_n01',"$vl_c_dico00019");
  fa_label('ch_n02',"$vl_c_dico00020");
  fa_label('ch_n03',"$vl_c_dico00021");
  fa_label('ch_n04',"$vl_c_dico00022");
  fa_label('ch_n05',"$vl_c_dico00023");
  fa_label('ch_n06',"$vl_c_dico00024");
  fa_label('ch_n07',"$vl_c_dico00025");
  fa_att_set('ch_n01',"_graal_nombre", 0)
  fa_att_set('ch_n02',"_graal_nombre", 0)
  fa_att_set('ch_n03',"_graal_nombre", 0)
  fa_att_set('ch_n04',"_graal_nombre", 0)
  fa_att_set('ch_n05',"_graal_nombre", 0)
  fa_att_set('ch_n06',"_graal_nombre", 0)
  fa_att_set('ch_n07',"_graal_nombre", 0)
  vf_e_choix_cleunik=0;
}
function pf_validation(vv_quoi) {
  var s;
  var vl_c_portee,vl_c_choix_actif;
  vl_c_portee=0;
  if (fa_est_coche("ch_n01")==true) {vl_c_portee+=  1};
  if (fa_est_coche("ch_n02")==true) {vl_c_portee+=  2};
  if (fa_est_coche("ch_n03")==true) {vl_c_portee+=  4};
  if (fa_est_coche("ch_n04")==true) {vl_c_portee+=  8};
  if (fa_est_coche("ch_n05")==true) {vl_c_portee+= 16};
  if (fa_est_coche("ch_n06")==true) {vl_c_portee+= 32};
  if (fa_est_coche("ch_n07")==true) {vl_c_portee+= 64};
  vl_c_choix_actif=fa_gid('rdg_actif').value;
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  switch(vv_quoi) {
    case "enregistrer":
       s ="vl_c_action="+fa_enc(vf_c_action)+"&";
       s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
       s +="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
       s +="vl_c_choix_actif="+fa_enc(vl_c_choix_actif)+"&";
       s +="vl_c_portee="+vl_c_portee+"&";
       s +="vl_c_choix_valeur_texte_01="+fa_enc(fa_gid('tb_choix_valeur_texte_01').value)+"&"
    break;
   case "supprimer":
     Check = confirm("$vl_c_00002");
     if(Check == false) return;
     s ="vl_c_action=supprimer&";
     s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
    break;
}
fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
