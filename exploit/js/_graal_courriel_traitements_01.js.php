<?php
include("_graal_var_portee.php");
$vl_c_bdc_102=fa_recup_dico_js("bdc_102");
$vl_e_portee=$vl_e_acteur;
$vl_e_nbmax=intval(fa_recup_session('vs_nb007','0'));
if ($vl_c_emailing=="oui"){
$js_controlenombre=<<<EOT
	if (fa_value_get("aao_tb_limit")>$vl_e_nbmax){
		fa_value_set("aao_tb_limit",$vl_e_nbmax);
		alert("La limite de sélection est de $vl_e_nbmax enregistrements.");
	}
EOT;
}
switch ($vl_c_genreacteur) {
  case "tousss": $vl_e_portee+=000000000000;break;  //  Tous les acteurs
  case "110001": $vl_e_portee+=$vl_e_procli;break;  //  prospects clients
  case "110002": $vl_e_portee+=$vl_e_profou;break;  //  prospects fournisseurs
  case "110003": $vl_e_portee+=$vl_e_client;break;  //  clients
  case "110004": $vl_e_portee+=$vl_e_fourni;break;  //  fournisseurs
  case "110005": $vl_e_portee+=$vl_e_autrac;break;  //  autres acteurs
  case "110006": $vl_e_portee+=$vl_e_actind;break;  //  acteurs indéterminés
}
$fa05_sel_date="";
switch ($vl_c_type_recherche) {
	case "normal":
		$fa05_sel_date='fa05_sel_date("21","aao_tb_deb","aao_tb_fin");';
	$pf_approximatif=<<<EOT
	var vl_c_texte=fa_value_get("aao_tb_rechapproxima");
	if (vl_c_texte==""){return;}
  if (vv_origine!="tb_rafraichir_table") {
  	if (fa_value_get("rdg_immediat")==2) {return;}
  }
	item=fa_gid("aao_ml_actif").selectedItem;  
	if (fa_value_get("rdg_deja_dans_emailing")==2) {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=2&vl_e_action_cleunik=$vl_e_action_cleunik&";
	} else {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=-1";
	}
  vf_c_url_alimente_table=vf_c_script_recherche+'&operat_genre='+fa_value_get("aao_ml_operat_genre")+'listecles=&raisonsoc='+fa_enc(vl_c_texte)+'&typeacteur='+fa_value_get("aao_ml_qui")+'&quoi='+fa_value_get("aao_ml_zone")+'&vl_c_actifs='+fa_value_get("aao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&raf="+Math.random()+'&vl_e_limit='+fa_value_get("aao_tb_limit")+'&'+vl_c_deja_dans_emailing+"&";
  var vl_c_valide="";
  if (fa_att_get("ra_valide_oui","checked")) {vl_c_valide+="1,";}
  if (fa_att_get("ra_valide_non","checked")) {vl_c_valide+="2,";}
  if (fa_att_get("ra_valide_nsp","checked")) {vl_c_valide+="3,";}
  var vl_c_veuxpasdemail="";
  if (fa_att_get("ra_veuxpasdemail_oui","checked")) {vl_c_veuxpasdemail+="1,";}
  if (fa_att_get("ra_veuxpasdemail_non","checked")) {vl_c_veuxpasdemail+="2,";}
  if (fa_att_get("ra_veuxpasdemail_nsp","checked")) {vl_c_veuxpasdemail+="3,";}
  vf_c_url_alimente_table+="vl_c_veuxpasdemail="+fa_enc(vl_c_veuxpasdemail)+"&";
  vf_c_url_alimente_table+="vl_c_valide="+fa_enc(vl_c_valide)+"&";
  vf_c_url_alimente_table+='vl_c_quelleplage='+fa_value_get("aao_ml_date_genre")+'&vl_c_dateheuredebut='+fa_enc(fa_date_formate(fa_value_get("aao_tb_deb"),"AAAAMMJJ"))+'&vl_c_dateheurefin='+fa_enc(fa_date_formate(fa_value_get("aao_tb_fin"),"AAAAMMJJ"))+"&";
	vf_c_sql=vf_c_url_alimente_table+"sortie=sql_session&";
	vf_c_url_alimente_table+="sortie=das&";
EOT;
	break;
	case "interl":
		$pf_approximatif=<<<EOT
	vf_c_url_alimente_table=vf_c_script_recherche+"&vl_c_actifs=6&vl_e_int_cleunik=$vl_e_int_cleunik";
EOT;
	break;
	case "acteur":
		$pf_approximatif=<<<EOT
	vf_c_url_alimente_table=vf_c_script_recherche+"&vl_c_actifs=7&vl_e_act_cleunik=$vl_e_act_cleunik";
EOT;
	break;
}
switch ($vl_c_renvoyer_unseul){
	case "non":
		$bloc_renvoi_js=<<<EOT
function pf_renvoyer() {
	var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_e_nbligne=fa_cl("$vl_c_nom_arbre_courriel_panier");
  if (vl_e_nbligne!=0) {
    var vl_t_intweb=[];
    for(i=0;i<vl_e_nbligne;i++) {
      vl_t_intweb[i]=fa_cell_get("$vl_c_nom_arbre_courriel_panier",i,"intweb_cleunik_panier");
    }
		vf_t_panier=[];
		fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
    if (window.opener!=null) {
      try {
        window.opener.pf_retour_fenetre(vl_t_intweb);
      } catch(e) {
         alert(e)
      }
    }
  } else {
  	alert("Le panier est vide ...");
  }
}
EOT;
		break;
	case "oui":
$bloc_renvoi_js=<<<EOT
function pf_renvoyer() {
	var i=fa_cui("$vl_c_nom_arbre_courriel_select","");if(i==-1){alert("Rien n'est sélectionné");return;}
    var vl_intweb_cleunik=fa_cell_get("$vl_c_nom_arbre_courriel_select",i,"intweb_cleunik");
    if (window.opener!=null) {
      try {
         window.opener.$vl_c_fonction_retour(vl_intweb_cleunik);
         window.close();
      } catch(e) {
         alert(e)
      }
    }
    
}
EOT;
		break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_export;
var vf_c_url_alimente_table,vf_c_type,vf_c_sql;
const vf_c_script_bdope_fen="_graal_bdope_traitements_courriels_01.php";
const vf_c_script_bdope_panier='_graal_bdope_paniers_01.php';
const vf_c_script_fen_acteur="_graal_fen_acteurs_01.php?genreacteur=";
const c_fen_interlo_mail="_graal_fen_act_interlo_mail_01.php?";
const vf_c_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_courriel';
const vf_c_script_recherche='_graal_rech_courriel_01.php?var=vs_tempo_panier_courriel&';
const c_script_rech_interlo='_graal_fen_rech_interlocuteurs_01.php?genreacteur=tousss&p02=bascule_courriel&';
var vf_t_panier=[],vf_t_panier_bascule=[];
var vf_id_focus="";
const lstn_gri01 = { 
  willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_non("tb_rafraichir_table");fa_att_rem("_graal_fen_rech_courriel_01",'wait-cursor');fa_grise_fenetre(event,"non");} 
};
const lstn_gri02 = { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_non("tb_rafraichir_table");fa_att_rem("_graal_fen_rech_courriel_01",'wait-cursor');fa_grise_fenetre(event,"non");} 
};
function pf_aa_ferme(vv_quoi) {
  switch (vv_quoi) {
    case "renvoyer":
      var vl_t_tableau=[];
      var vl_e_nb_sel;
      var vl_e_nbligne=fa_cl("$vl_c_nom_arbre_courriel_panier");
      if (vl_e_nbligne!=0) {
        var vl_t_intweb=[];
        for(i=0;i<vl_e_nbligne;i++) {
          vl_t_intweb[i]=fa_cell_get("$vl_c_nom_arbre_courriel_panier",i,"intweb_cleunik_panier");
        }
        if (window.opener!=null) {
          try {
            window.opener.pf_retour_fenetre(vl_t_intweb);
            //setTimeout(close, 0);
          } catch(e) {
             alert(e)
          }
        }
      }
      window.close();
      break;
	case "renvoyer_requete":
		vf_c_sql=pf_construit_requete();
		fa_xmlhttprequest_txt(vf_c_sql,"",pf_aa_ferme_fin);
      break;      
    case "rien":
      window.close();
      break;
  }
}
function pf_aa_ferme_fin(vv_retour){
//alert(vv_retour)
	 window.opener.pf_retour_fenetre_requete(vv_retour);
	 window.close();
}
function pf_aa_init() {
  fa_att_set("$vl_c_nom_arbre_courriel_select",'seltype','multiple');
  fa_att_set("$vl_c_nom_arbre_courriel_panier",'seltype','multiple');
  fa_att_set("$vl_c_nom_arbre_courriel_select",'context','pop_selections');
  fa_att_set("$vl_c_nom_arbre_courriel_panier",'context','pop_panier');
	fa_badl("$vl_c_nom_arbre_courriel_select",lstn_gri01);
	fa_badl("$vl_c_nom_arbre_courriel_panier",lstn_gri02);
	fa_check("ra_requete_standard");
	fa_check("ra_requete_perso");
	try {
    	po_change_menu();
    } catch(e) {
    }
  fa_check("ra_veuxpasdemail_oui");
  if ("$vl_c_emailing"=="non") {fa_check("ra_veuxpasdemail_non");}
  fa_check("ra_veuxpasdemail_nsp");
  fa_check("ra_valide_oui");
  if ("$vl_c_emailing"=="non") {fa_check("ra_valide_non");}
  fa_check("ra_valide_nsp");
	fa_focusdonne("aao_tb_rechapproxima");
	$fa05_sel_date
  pf_approximatif();
}
function pf_acteur_ouvre() {
  var rowIndex = fa_cui("$vl_c_nom_arbre_courriel_select");if(rowIndex == -1){return;}
  var param=fa_cell_get("$vl_c_nom_arbre_courriel_select",rowIndex,"typeacteur")+"&act_cleunik="+fa_cell_get("$vl_c_nom_arbre_courriel_select",rowIndex,"act_cleunik")+"&";
  fa_ouvre(vf_c_script_fen_acteur+param,1200,800);
}
function pf_alimente_table(){
  switch (fa_value_get("aao_ml_qui")){
    case "9":
      fa_cache_non("portee");
      break;
    default:
      fa_cache_oui("portee");
      break;
  }
	fa_att_set("_graal_fen_rech_courriel_01","wait-cursor","true");
	fa_grise_oui("tb_rafraichir_table");
	fa_grise_fenetre("","oui");
	fa_lignes_arbre_deselectionne("$vl_c_nom_arbre_courriel_select");
	fa_das("$vl_c_nom_arbre_courriel_select",vf_c_url_alimente_table);
}
function pf_approximatif(vv_origine) {
$pf_approximatif
  pf_alimente_table();
}
function pf_compte() {
  var vl_c_texte=fa_value_get("aao_tb_rechapproxima");
	if (vl_c_texte==""){return;}
	item=fa_gid("aao_ml_actif").selectedItem;  
	if (fa_value_get("rdg_deja_dans_emailing")==2) {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=2&vl_e_action_cleunik=$vl_e_action_cleunik&";
	} else {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=-1";
	}
  var vl_c_url_alimente_table=vf_c_script_recherche+'&operat_genre='+fa_value_get("aao_ml_operat_genre")+'listecles=&raisonsoc='+fa_enc(vl_c_texte)+'&typeacteur='+fa_value_get("aao_ml_qui")+'&quoi='+fa_value_get("aao_ml_zone")+'&vl_c_actifs='+fa_value_get("aao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&raf="+Math.random()+'&vl_e_limit='+fa_value_get("aao_tb_limit")+'&'+vl_c_deja_dans_emailing+"&";
  var vl_c_valide="";
  if (fa_att_get("ra_valide_oui","checked")) {vl_c_valide+="1,";}
  if (fa_att_get("ra_valide_non","checked")) {vl_c_valide+="2,";}
  if (fa_att_get("ra_valide_nsp","checked")) {vl_c_valide+="3,";}
  var vl_c_veuxpasdemail="";
  if (fa_att_get("ra_veuxpasdemail_oui","checked")) {vl_c_veuxpasdemail+="1,";}
  if (fa_att_get("ra_veuxpasdemail_non","checked")) {vl_c_veuxpasdemail+="2,";}
  if (fa_att_get("ra_veuxpasdemail_nsp","checked")) {vl_c_veuxpasdemail+="3,";}
  vl_c_url_alimente_table+="vl_c_veuxpasdemail="+fa_enc(vl_c_veuxpasdemail)+"&";
  vl_c_url_alimente_table+="vl_c_valide="+fa_enc(vl_c_valide)+"&";
	vf_c_sql=vl_c_url_alimente_table+"sortie=sql_session&";
	vl_c_url_alimente_table+="sortie=comptage&";
	fa_grise_fenetre("","oui");
	fa_xmlhttprequest_txt(vl_c_url_alimente_table,"",pf_compte_fin);
}
function pf_compte_fin(vv_nombre){
 alert(vv_nombre+" adresses de courriel correspondent à cette sélection.");
 fa_grise_fenetre("","non");
}
function pf_construit_requete(){
var vl_c_texte=fa_value_get("aao_tb_rechapproxima");
	item=fa_gid("aao_ml_actif").selectedItem;  
	if (fa_value_get("rdg_deja_dans_emailing")==2) {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=2&vl_e_action_cleunik=$vl_e_action_cleunik&";
	} else {
		var vl_c_deja_dans_emailing="vl_c_deja_dans_emailing=-1";
	}
	$js_controlenombre
  vf_c_url_alimente_table=vf_c_script_recherche+'&operat_genre='+fa_value_get("aao_ml_operat_genre")+'listecles=&raisonsoc='+fa_enc(vl_c_texte)+'&typeacteur='+fa_value_get("aao_ml_qui")+'&quoi='+fa_value_get("aao_ml_zone")+'&vl_c_actifs='+fa_value_get("aao_ml_actif")+'&vl_e_panier='+item.getAttribute("_graal_cleunik")+"&raf="+Math.random()+'&vl_e_limit='+fa_value_get("aao_tb_limit")+'&'+vl_c_deja_dans_emailing+"&";
  var vl_c_valide="";
  if (fa_att_get("ra_valide_oui","checked")) {vl_c_valide+="1,";}
  if (fa_att_get("ra_valide_non","checked")) {vl_c_valide+="2,";}
  if (fa_att_get("ra_valide_nsp","checked")) {vl_c_valide+="3,";}
  var vl_c_veuxpasdemail="";
  if (fa_att_get("ra_veuxpasdemail_oui","checked")) {vl_c_veuxpasdemail+="1,";}
  if (fa_att_get("ra_veuxpasdemail_non","checked")) {vl_c_veuxpasdemail+="2,";}
  if (fa_att_get("ra_veuxpasdemail_nsp","checked")) {vl_c_veuxpasdemail+="3,";}
  vf_c_url_alimente_table+="vl_c_veuxpasdemail="+fa_enc(vl_c_veuxpasdemail)+"&";
  vf_c_url_alimente_table+="vl_c_valide="+fa_enc(vl_c_valide)+"&";
	vf_c_sql=vf_c_url_alimente_table+"sortie=sql_session&";
	vf_c_url_alimente_table+="sortie=das&";
	return vf_c_sql;
}
function pf_courriel_ouvre(vv_qui) {
  var vl_c_arbre=vv_qui;
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  switch (vv_qui){
  	case "arbre_des_courriels_interlo_act":
    	var vl_c_param="genreacteur="+fa_cell_get(vl_c_arbre,i,"typeacteur")+"&vl_e_intweb_cleunik="+fa_cell_get(vl_c_arbre,i,"intweb_cleunik");
    	break;
  case 'arbre_des_courriels_interlo_act_panier':
    	var vl_c_param="genreacteur="+fa_cell_get(vl_c_arbre,i,"typeacteur_panier")+"&vl_e_intweb_cleunik="+fa_cell_get(vl_c_arbre,i,"intweb_cleunik_panier");
   		break;
  }
  fa_ouvre(c_fen_interlo_mail+vl_c_param,700,600);
}
function pf_gere_adresse_valide() {
	if ((fa_att_get("ra_valide_non","checked"))&&("oui"=="$vl_c_emailing")) {if (!confirm("Voulez-vous vraiment sélectionner des adresses marquées comme non valides ?")) {fa_att_rem("ra_valide_non","checked");}}
}
function pf_gere_emailing_autorise() {
	if ((fa_att_get("ra_veuxpasdemail_non","checked"))&&("oui"=="$vl_c_emailing")) {if (!confirm("Voulez-vous vraiment sélectionner des adresses marquées comme non utilisables dans un e-mailing ?")) {fa_att_rem("ra_veuxpasdemail_non","checked");}}
}
function pf_interlo_ouvre() {
  var vl_c_arbre="$vl_c_nom_arbre_courriel_select";
  var i=fa_cui(vl_c_arbre);if(i==-1){return;}
  var vl_c_param="genreacteur="+fa_cell_get(vl_c_arbre,i,"typeacteur")+"&vl_e_interlo_cleunik="+fa_cell_get(vl_c_arbre,i,"int_cleunik");
  vl_c_param+='&vl_e_act_cleunik='+fa_cell_get(vl_c_arbre,i,"act_cleunik")+"&";
  fa_ouvre_interlo(vl_c_param);
}
function pf_masse(vv_param_01,vv_param_02,vv_param_03) {
  var vl_c_arbre="";
	var vl_recherche="";
  switch (vv_param_03) {
    case 1:vl_c_arbre="$vl_c_nom_arbre_courriel_select";vl_recherche="intweb_cleunik";break;
    case 2:vl_c_arbre="$vl_c_nom_arbre_courriel_panier";vl_recherche="intweb_cleunik_panier";break;
  }
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  var vl_c_donnees="";
  vl_t_tableau=fa_lignes_selectionnees(vl_c_arbre);
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_intweb=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_intweb[i]=fa_cell_get(vl_c_arbre,vl_t_tableau[i],vl_recherche);
    }
  }
  if (vl_t_intweb.length==0) {return;}

  switch (vv_param_01) {
    case 1: //  Changer l'autorisation d'utilisation dans un mailing
     	fa_grise_fenetre("","oui");
      vl_c_donnees="vf_c_action=kilometre_veutpasmail&vl_e_veutpasmail="+vv_param_02+"&";
      vl_c_donnees+="vl_t_intweb_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_intweb))+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_masse_01_fin);
      break;
    case 2: //  Changer la validité
     	fa_grise_fenetre("","oui");
      vl_c_donnees="vf_c_action=kilometre_validite&vl_e_valide="+vv_param_02+"&";
      vl_c_donnees+="vl_t_intweb_cleunik="+fa_enc(fa_jsarray2php_00(vl_t_intweb))+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_masse_01_fin);
      break;
    case 3: //  Vérifier la syntaxe
     	fa_grise_fenetre("","oui");
      fa_att_rem("bt_voir_panier","collapsed");
      fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_intweb),pf_masse_03_suite);
      break;
    case 4: //  Vérifier l'existence, l'utilisabilité
     	fa_grise_fenetre("","oui");
      fa_att_rem("bt_voir_panier","collapsed");
      fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_intweb),pf_masse_04_suite);
      break;
		case 5: //  Bascule d'adresses de courriel vers un interlocuteur
      fa_att_rem("bt_voir_panier","collapsed");
			vf_t_panier_bascule=vl_t_intweb;
			fa_ouvre(c_script_rech_interlo,800,600);
      break;			
  }
}
function pf_masse_01_fin(vv_data){
  alert(vv_data);
  pf_approximatif("tb_rafraichir_table");
}
function pf_masse_03_suite(vv_data){
  pf_voir_deck(1);
  fa_ds("$vl_c_nom_arbre_courriel_panier",vf_c_script_recherche+'sortie=das&vl_c_type=0&typeacteur=9&quoi=6&raf='+Math.random()+"&masse=3&");
}
function pf_masse_04_suite(vv_data){
  pf_voir_deck(1);
  var vl_c_param=vf_c_script_recherche+'sortie=das&vl_c_type=0&typeacteur=9&quoi=6&raf='+Math.random()+"&masse=4&";
  fa_das("$vl_c_nom_arbre_courriel_panier",vl_c_param);
}
function pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui, vl_act_cleunik,vl_raisonsoc,vl_portee) {
	if (vf_t_panier_bascule.length==0) {return;}
	var vl_c_donnees="vf_c_action=kilometre_bascule_interlo&vl_e_valide="+vl_int_cleunik+"&";
  vl_c_donnees+="vl_t_intweb_cleunik="+fa_enc(fa_jsarray2php_00(vf_t_panier_bascule))+"&";
	vf_t_panier_bascule=[];
 	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_ouvre_interlo_recup_fin);
}
function pf_ouvre_interlo_recup_fin(vv_data){
  alert(vv_data);
  pf_approximatif("tb_rafraichir_table");
	pf_panier_alimente_table();
}
function pf_onunload(){
	fa_brl("$vl_c_nom_arbre_courriel_select",lstn_gri01);
	fa_brl("$vl_c_nom_arbre_courriel_panier",lstn_gri02);
}
function pf_panier_ajoute() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("$vl_c_nom_arbre_courriel_select");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    alert("Ajout de "+vl_e_nb_sel+" lignes");
		var vl_t_intweb=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_intweb[i]=fa_cell_get("$vl_c_nom_arbre_courriel_select",vl_t_tableau[i],"intweb_cleunik");
    }
    var vl_t_panier=[];
    vl_t_panier=vf_t_panier;
    vf_t_panier=vl_t_panier.concat(vl_t_intweb);
    pf_panier_alimente_table();
  } else {
  	alert("Rien n'est sélectionné...");
  }
}
function pf_panier_alimente_table(){
	fa_att_rem("bt_voir_panier","collapsed");
	fa_grise_oui("tb_rafraichir_table");
	fa_grise_fenetre("","oui");
	fa_att_set("_graal_fen_rech_courriel_01","wait-cursor","true");
  fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
}
function pf_panier_enleve() {
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("$vl_c_nom_arbre_courriel_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_panier=[];
    var vl_t_intweb=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_intweb[i]=fa_cell_get("$vl_c_nom_arbre_courriel_panier",vl_t_tableau[i],"intweb_cleunik_panier");
    }
    var j=0;k=-1;
    for(i=0;i<vf_t_panier.length;i++) {
      if (vl_t_intweb.indexOf(vf_t_panier[i])==-1) { 
        k++;
        vl_t_panier[k]=vf_t_panier[i];
      }  
    }
    vf_t_panier=vl_t_panier;
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_tableau_donnees_fin);
  }
}
function pf_recup_requete(vv_export) {
  vf_c_export=vv_export;
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("$vl_c_nom_arbre_courriel_panier");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_intweb=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_intweb[i]=fa_cell_get("$vl_c_nom_arbre_courriel_panier",vl_t_tableau[i],"intweb_cleunik_panier");
    }
    fa_xmlhttprequest_txt(vf_c_script_var,'vl_t_listecles='+fa_jsarray2php_00(vf_t_panier),pf_recup_requete_suite);
  }
}
function pf_recup_requete_suite(){
  fa_xmlhttprequest_txt(vf_c_script_recherche+'sortie=sql&vl_c_type=0&typeacteur=9&quoi=6&raf='+Math.random()+"&",'',pf_recup_requete_fin)
}
function pf_recup_requete_fin(stream) {
  var vl_datas = stream;
	alert(vl_datas)
  switch (vf_c_export) {
    case "ods":fa_exporte_requete_vers_ods(vl_datas);break;
    case "rdf":fa_exporte_requete_vers_rdf(vl_datas);break;
    case "htm":fa_exporte_requete_vers_htm(vl_datas);break;
    case "xml":fa_exporte_requete_vers_xml(vl_datas);break;
    case "xls":fa_exporte_requete_vers_xls(vl_datas);break;
    }
}
$bloc_renvoi_js
function pf_sel_ligne() {}
function pf_tableau_donnees_fin(){
  fa_ds("$vl_c_nom_arbre_courriel_panier",vf_c_script_recherche+'sortie=das&vl_c_type=0&typeacteur=9&quoi=6&raf='+Math.random()+"&");
}
function pf_validation_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
  pf_approximatif("tb_rafraichir_table");
}
function pf_valide_danspanier() {
	var vl_titre_panier=prompt("Donnez un nom à votre panier ...");
  if(vl_titre_panier==null) {alert("Panier abandonné.");return;}
  var vl_e_nb=fa_cl("$vl_c_nom_arbre_courriel_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_liste="";
  for(i=0;i<vl_e_nb;i++) { 
    vl_c_liste+=fa_cell_get("$vl_c_nom_arbre_courriel_panier",i,"intweb_cleunik_panier")+",";
  }
  vl_c_liste=vl_c_liste.substring(0,vl_c_liste.length-1);
  vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vl_titre_panier)+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_portee&";
  vl_c_donnees+="vl_panier_type=1&";
  vl_c_donnees+="vl_actif=1&";
  vl_c_donnees+="vl_panier_resultat="+vl_c_liste+"&";
  vl_c_donnees+="vl_c_action=ajouter_panier&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
function pf_valide_danspanier_courriels() {
var vl_titre_panier=prompt("Donnez un nom à votre panier ...");
  if(vl_titre_panier==null) {alert("Panier abandonné.");return;}
  var vl_e_nb=fa_cl("$vl_c_nom_arbre_courriel_panier");
  if (vl_e_nb==0) {return;}
  var vl_c_liste="";
  for(i=0;i<vl_e_nb;i++) { 
    vl_c_liste+=fa_cell_get("$vl_c_nom_arbre_courriel_panier",i,"intweb_cleunik_panier")+",";
  }
  vl_c_liste=vl_c_liste.substring(0,vl_c_liste.length-1);
  vl_c_donnees="";
  vl_c_donnees+="vl_uti_cleunik=$vl_e_uti_cleunik&";
  vl_c_donnees+="vl_panier_titre="+fa_enc(vl_titre_panier)+"&";
  vl_c_donnees+="vl_panier_portee=$vl_e_refweb&";
  vl_c_donnees+="vl_panier_type=1&";
  vl_c_donnees+="vl_actif=1&";
  vl_c_donnees+="vl_panier_resultat="+vl_c_liste+"&";
  vl_c_donnees+="vl_c_action=ajouter_panier&";
  fa_xmlhttprequest_txt(vf_c_script_bdope_panier,vl_c_donnees,pf_valide_danspanier_fin);
}
function pf_valide_danspanier_fin(stream) {
  var vl_datas = stream;
  alert(vl_datas);
}
function pf_voir_deck(vv_lequel) {
  fa_gid("deck_courriels").selectedIndex=vv_lequel;
}
]]></script>
END;
?>
