<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
********************************************************************************************************************************
**********  Fenêtre de gestion des éléments des objets                  (_graal_fen_elements_01.php)                             ********
********************************************************************************************************************************
*/
var vf_e_obj_cleunik;
var vf_e_sel_cleunik;
var vf_c_action;
var vf_c_url_alimente_table;
var vf_c_ValRetour;
//  Affectations
const vf_c_script_bdope_fen='_graal_bdope_elements_01.php';

function pf_alimente_defaut(){
  var rowIndex = fa_cui("arbre_des_objets");
  var vl_c_complement_prefixe;
  switch ($vl_e_type) {
    case 4:vl_c_complement_prefixe="_0";break;
    case 1:vl_c_complement_prefixe="_1";break;
  }
  fa_value_set("tb_titre",fa_cell_get("arbre_des_objets",rowIndex,"prefixe")+vl_c_complement_prefixe);
}
function pf_alimente_table(vv_qui){
  var raf_random=Math.random();
  switch (vv_qui){
    case "arbre_des_objets":
			fa_das("arbre_des_objets",vf_c_url_alimente_table+"raf="+raf_random);
      break;
    case "arbre_des_elements":
			fa_das("arbre_des_elements",'_graal_das_elements_01.php?raf='+raf_random+"&vl_e_obj_cleunik="+vf_e_obj_cleunik+"&vl_e_type=$vl_e_type&");
      break;
  }
}
function pf_duplique_elements(){
  var vl_c_param="";
  vl_c_param+="?vl_e_obj_cleunik="+vf_e_obj_cleunik;
  vl_c_param+="&vl_c_id_fenetre="+fa_enc(fa_att_get("win_fen_elements","_graal_dupliq"));
  fa_ouvre("_graal_fen_duplique_elements_objets_01.php"+vl_c_param,400,150);
}
function pf_etat_fen(vv_quoi)  {
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_c_url_alimente_table='_graal_das_objets_01.php?vl_e_type='+$vl_e_type+'&';
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf_raz_fiche();
      switch ($vl_e_type) {
        case 1:
        case 2:
        case 4:
          pf_alimente_table("arbre_des_objets");
          break;
        case 11:
          vf_e_obj_cleunik=$vl_e_fen_cleunik;
          pf_alimente_table("arbre_des_elements");
					break;
      }
       break;
     case "selectionner":
			switch ($vl_e_type) {
        case 1:
        case 2:
        case 4:
					var rowIndex=fa_cui("arbre_des_objets");
          break;
        case 11:
					var rowIndex=fa_cui("arbre_des_elements");
					break;
      }
      
      if(rowIndex == -1){return;}
      fa_grise_non("bt_supprimer");
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
       break;
     case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      switch ($vl_e_type) {
        case 1:
        case 2:
        case 4:
          fa_grise_groupe_non('broadcaster_01');
          fa_focusdonne('tb_titre');
          break;
        case 11:
          fa_grise_non('tb_descriptif_sommaire');
          fa_focusdonne('tb_descriptif_sommaire');
      }
      break;
     case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne('tb_titre');
       break;
     case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      fa_grise_groupe_oui('broadcaster_01');
      pf_raz_fiche();
      break;
     case "sortir":
				if (window.opener!=null) {
					window.close();
					window.history.back();//  Ne fonctionne que si cette fenetre est une fenetre appellée dans la même fenêtre
				} else {
					window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre	
				}
	     break;	
		case "mysql":
			var chaine=fa_value_get("tb_descriptif_sommaire");
			var chaine_descriptif= chaine.replace(/'/g, "\\\'");
			var toto="update _elements_libelle set descriptif=";
			toto+="'"+chaine_descriptif+"'";
			toto+=" where ele_cleunik="+fa_att_get("tb_titre","_ele_cleunik");
			toto+=" and uti_cleunik=0 and langue=120131;";
			alert(toto);
			break;
			
 default:
 break;
}
  }
function pf_fin_requete(stream){
	var vl_datas = stream;
	if (vl_datas=='ok') {pf_alimente_table("arbre_des_elements");} else {alert(vl_datas)}
	pf_etat_fen('annuler');
}
function pf_raz_fiche(){
  fa_value_set("tb_titre","");
  fa_value_set("tb_descriptif_sommaire","");
  fa_att_set("tb_titre","_ele_cleunik","-1");
  fa_value_set("tb_commentaire","");
  fa_gid("ml_types_elements").selectedIndex=0;
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return};
  switch (vv_qui) {
    case "arbre_des_objets":
      var rowIndex = fa_cui(vv_qui);
      if(rowIndex == -1){return;}
      vf_e_obj_cleunik=fa_cell_get(vv_qui,rowIndex,"fen_cleunik");
      pf_alimente_table("arbre_des_elements");
      break;
    case "arbre_des_elements":
      var rowIndex = fa_cui(vv_qui);
      if(rowIndex == -1){return;}
      var vl_e_ele_cleunik=fa_cell_get(vv_qui,rowIndex,"tc_element_ele_cleunik");
      fa_att_set("tb_titre","_ele_cleunik",vl_e_ele_cleunik);
      fa_value_set("tb_titre",fa_cell_get(vv_qui,rowIndex,"tc_element_titre"));
      fa_value_set("tb_descriptif_sommaire",fa_cell_get(vv_qui,rowIndex,"tc_element_descriptif"));
      fa_value_set("tb_commentaire",fa_cell_get(vv_qui,rowIndex,"tc_element_commentaire"));
      fa_mlsel("ml_types_elements",fa_cell_get(vv_qui,rowIndex,"tc_element_type_objet"),"_graal_type_objet");
    break;
  }
}

function pf_validation(vv_quoi)
  {
  var s;
   var vl_e_ele_cleunik=fa_att_get("tb_titre","_ele_cleunik");
   s ="vl_e_fen_cleunik="+vf_e_obj_cleunik+"&";
   s +="vl_e_ele_cleunik="+vl_e_ele_cleunik+"&";
   s +="vl_e_type="+$vl_e_type+'&';
   s +="vl_c_titre="+fa_enc(fa_value_get("tb_titre"))+"&";
   s +="vl_c_descriptif="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
   s +="vl_c_commentaire="+fa_enc(fa_value_get("tb_commentaire"))+"&";
   s +="vl_e_type_objet="+fa_gid("ml_types_elements").selectedItem.getAttribute("_graal_type_objet")+"&";
  switch(vv_quoi) {
     case "enregistrer":
        if (vl_e_ele_cleunik!=-1) {s +="vf_c_action=modifier&";}
        else
        {s +="vf_c_action=ajouter&";}
      break;
     case "supprimer":
       Check = confirm("Confirmez-vous la suppression de cet élément ?");
       if(Check == false) return;
       s +="vf_c_action=supprimer&";
      break;
 }     
       fa_xmlhttprequest_txt(vf_c_script_bdope_fen,s,pf_fin_requete);
}
]]></script>
END;
