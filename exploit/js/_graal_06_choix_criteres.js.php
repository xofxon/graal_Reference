<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c06_script_var='_graal_cree_variable_session_tempo.php?var=vs_tempo_panier_choix&';
const c06_script_ope='_graal_bdope_choix_criteres_01.php?var=vs_tempo_panier_choix';
const c06_lstn_grise_choix= { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre("","non");} 
};

function pf06_alimente_table_bbb(vv_sel){
fa_badl("arb_choix_criteres",c06_lstn_grise_choix);
  var vl_c_param="";
  vl_c_param+=vf_c_url_arbre+'vl_c_critere_cleunik='+vf_e_critere_cleunik+'&vl_c_liste_cleunik=&raf01='+Math.random();
  vl_c_param+='&vl_c_etat='+fa_value_get('rdg_etat');
  vl_c_param+='&vl_c_position='+fa_value_get('rdg_position');
  fa_grise_fenetre("","oui");
  fa_das('arb_choix_criteres',vl_c_param);
  if (vv_sel!="undefined") {
  	//alert("sele ??")
	// il faudrait brancher un événement pour détecter la fin du chargement de la table !! Désactivé l'appel en attendant
  	//pf06_sel_ligne(fa_gid("arb_choix_criteres"));
	}
	//fa_ouvre(vl_c_param)
}
function pf06_choix_inutiles(vv_quoi) {
  switch (vv_quoi) {
    case 'oui':
      var critere_cleunik=fa_att_get("arb_choix_criteres",'_graal_cleunik');
      switch (critere_cleunik) {
        case '':
        case '11':case '12':case '13':case '14':
        case '21':case '22':case '23':case '24':case '25':
        case '31':case '32':case '33':case '34':case '35':case '36':case '37':
        case '41':case '42':case '43':
        case '51':case '52':case '53':
        case '58':case '59':
        case '60':case '61':case '62':case '63':case '64':case '65':case '66':case '67':
          return;  
      }
      fa_att_set("arb_choix_criteres",'seltype', 'multiple');
      fa_att_set("arb_choix_criteres",'context', 'pop_choix_inutiles');
      break;
    case 'non':
      fa_att_set("arb_choix_criteres",'seltype', 'single');
      fa_att_set("arb_choix_criteres",'context', '');
      break;
  }
}
function pf06_export_excel(){
	var vl_c_param="";
  vl_c_param+='vl_c_critere_cleunik='+vf_e_critere_cleunik+'&vl_c_liste_cleunik=&raf01='+Math.random();
  vl_c_param+='&vl_c_etat='+fa_value_get('rdg_etat');
  vl_c_param+='&vl_c_position='+fa_value_get('rdg_position');
  vl_c_param+='&sortie=excel';
  fa_xmlhttprequest_txt(vf_c_url_arbre,vl_c_param,pf06_export_excel_fin);
}
function pf06_export_excel_fin(stream){
	fa_exporte_requete_vers_xls(stream);
}
function pf06_sel_ligne(vv_objet){
  if (fa_est_grise("bt_detailler")==true) {return};
  var rowIndex = vv_objet.currentIndex;
  if(rowIndex == -1){return;}
  vf_e_choix_cleunik=vv_objet.view.getCellText( rowIndex ,vv_objet.columns.getNamedColumn("choix_cleunik"));
  s ="vl_e_choix_cleunik="+fa_enc(vf_e_choix_cleunik)+"&";
  s+="vl_c_portee=acteurs&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
	//fa_ouvre(vf_c_script_edite+s)
}
function pf06_supprime(){
  if (confirm("Confirmez-vous la suppression des lignes sélectionnées ?")==false) {return;}
  var vl_t_tableau=[];
  var vl_e_nb_sel;
  vl_t_tableau=fa_lignes_selectionnees("arb_choix_criteres")
  vl_e_nb_sel=vl_t_tableau.length
  if (vl_e_nb_sel!=0) {
    var vl_t_choix=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_choix[i]=fa_cell_get("arb_choix_criteres",vl_t_tableau[i],"choix_cleunik")
    }
    fa_xmlhttprequest_txt(c06_script_var,'vl_t_listecles='+fa_jsarray2php_00(vl_t_choix),pf06_supprime_suite);
  }
}
function pf06_supprime_suite() {
  fa_xmlhttprequest_txt(c06_script_ope,'vl_c_action=supprimer_en_masse',pf06_supprime_suite_fin);
}
function pf06_supprime_suite_fin(stream) {
  var vl_c_data=stream;
  alert(vl_c_data)
  pf06_alimente_table_bbb()
}
]]></script>
END;
?>
