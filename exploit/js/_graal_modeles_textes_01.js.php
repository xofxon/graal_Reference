<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_e_doc_cleunik;
var vf_c_action;
var vf_e_droits_proprio=0;
var vf_c_url_alimente_table='_graal_das_note_01.php?';
var vf_c_script_bdope_doc="_graal_bdope_note_01.php?genre=$vl_c_genre&portee_cleunik=$vl_e_portee_cleunik&";
var vf_c_script_edite="_graal_xml_doc_02.php";
const vf_c_script_critere_ged_entreprise='_graal_das_ged_criteres_entreprise.php?';
const vf_c_script_critere_ged_lesmiens='_graal_das_ged_criteres_lesmiens.php?';
const vf_c_script_critere_ged_lesautres='_graal_das_ged_criteres_lesautres.php?';
const vf_c_script_critere_ged_tous='_graal_das_ged_criteres_tous.php?';
const vf_c_fen_criteres='_graal_fen_ged_criteres.php?';
const vf_c_script_favoris='_graal_bdope_ged_favoris_01.php?';
const c_fen_commentaires='_graal_fen_documents_commentaires_01.php?genreacteur=tousss&genredoc=not&';
const c_iframe_commentaires_menu='_graal_fen_iframe_documents_commentaires_01.php?vl_doc_cleunik=';
function pf_action(vv_quoi){
  switch (vv_quoi) {
    case 'droits' :
      fa_ouvre("_graal_fen_droits_01.php?vl_c_genredoc=Notes&vl_e_doc_cleunik="+vf_e_doc_cleunik,400,400)
      break;
    case 'favoris_ajout':
      vl_c_param="vf_c_action=ajouter&vf_c_quoi=1&vl_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
      fa_xmlhttprequest_txt(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
    case 'favoris_supprimer':
      vl_c_param="vf_c_action=supprimer&vf_c_quoi=1&vl_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
      fa_xmlhttprequest_txt(vf_c_script_favoris,vl_c_param,pf_action_fin_01,'');
      break;
  }
}
function pf_action_fin_01(vv_message) {
  alert(vv_message)
}
function pf_affiche_commentaire(vl_commentaire_cleunik) {
  var vl_c_param='&raf_random='+Math.random()+'&';
  vl_c_param+='vf_e_doc_cleunik='+vf_e_doc_cleunik+'&';
  vl_c_param+='vf_e_commentaire_cleunik='+vl_commentaire_cleunik+'&';
  vl_c_param+='genreacteur=favori&';
  fa_ouvre(c_fen_commentaires+vl_c_param,800,650)
}
function pf_affiche_datas(stream){
  var vl_c_datas;
  pf_raz_fiche()
  vl_c_datas = stream;
  vf_e_doc_cleunik=fa_xml_get(vl_c_datas,'doc_cleunik');
  fa_value_set('tb_titre',fa_xml_get(vl_c_datas,'titre'));
  fa_value_set('tb_descriptif_sommaire',fa_xml_get(vl_c_datas,'descriptif_sommaire'));
  fa_value_set("tb_origine",fa_xml_get(vl_c_datas,'origine'));
  fa_value_set("tb_dateheurecreation",fa_xml_get(vl_c_datas,'dateheurecreation'));
  fa_value_set("tb_dateheuremodif",fa_xml_get(vl_c_datas,'dateheuremodif'));
  fa_value_set("tb_blocnote_riche",fa_xml_get(vl_c_datas,'blocnote_riche'));
}
function pf_affiche_donnees_criteres(){
  pf_affiche_donnees_criteres_entreprise();
  pf_affiche_donnees_criteres_lesautres();
  pf_affiche_donnees_criteres_lesmiens();
  pf_affiche_donnees_criteres_tous();
}
function pf_affiche_donnees_criteres_entreprise() {
  var vl_c_param=vf_c_script_critere_ged_entreprise+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&";
  fa_das("criteres_des_ged_entreprise",vl_c_param);
}
function pf_affiche_donnees_criteres_lesautres() {
  var vl_c_param=vf_c_script_critere_ged_lesautres+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_lesautres",vl_c_param);
}
function pf_affiche_donnees_criteres_lesmiens() {
  var vl_c_param=vf_c_script_critere_ged_lesmiens+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_lesmiens",vl_c_param);
}
function pf_affiche_donnees_criteres_tous() {
  var vl_c_param=vf_c_script_critere_ged_tous+"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&raf_random="+Math.random();
  fa_das("criteres_des_ged_tous",vl_c_param);
}
function pf_affiche_iframe_commentaires() {
  fa_att_set("if_commentaires_doc","src",c_iframe_commentaires_menu+vf_e_doc_cleunik+"&raf_random="+Math.random()+"&");
}
function pf_alimente_defaut(){}
function pf_alimente_table(){
  fa_das("arbre_des_notes",vf_c_url_alimente_table+"&raf="+Math.random());
}
function pf_cache_tab(){
  var vl_tab=fa_gid("vb_tableau");
  if(vl_tab.hidden == true){vl_tab.hidden=false;}else {vl_tab.hidden=true;}
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       vf_c_url_alimente_table+='lesquels='+fa_att_get("bt_actualiser","_graal_lesquels");
       vf_c_url_alimente_table+="&vf_e_typedoc=$_graal_typedoc";
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       pf_raz_fiche();
       fa_grise_groupe_oui('broadcaster_01');
       switch ("$vl_e_doc_cleunik") {
        case "A" : pf_alimente_table();break;
        case "-1":pf_etat_fen("ajouter");break;
        default:
          vf_e_doc_cleunik=$vl_e_doc_cleunik;
          fa_grise_oui("bt_ajouter");
          fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik=$vl_e_doc_cleunik&",pf_affiche_datas);
       }
       break;
    case "selectionner":
      pf_verif_acces();
      break;
    case "selectionner_suite":
      vf_c_action="selectionner"
      fa_grise_groupe_oui('broadcaster_01');
      if ((vf_e_droits_proprio & 4) == 4) {fa_grise_non("bt_modifier");}
      if ((vf_e_droits_proprio & 8) == 8) {fa_grise_non("bt_supprimer");}
      fa_grise_oui("bt_ajouter");
      fa_grise_non("bt_annuler");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      if (vf_e_doc_cleunik <0) {fa_grise_oui("bt_supprimer");}
      break;
     case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      if ((vf_e_droits_proprio & 1) == 1) {fa_grise_non("menu_gestion_des_droits");} else {fa_grise_oui("menu_gestion_des_droits");}
      fa_focusdonne('tb_blocnote_riche');
      break;
    case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_cache_oui("tab_criteres");fa_cache_oui("tab_commentaires");
      fa_sel_index("tab_infogene",0)
      fa_grise_oui("menu_02");
			fa_focusdonne('tb_titre');
      
      break;
    case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_ajouter");
      fa_grise_non("bt_detailler");
      fa_cache_non("tab_criteres");fa_cache_non("tab_commentaires");
      pf_raz_fiche();
      fa_grise_groupe_oui('broadcaster_01');
      fa_focusdonne("tb_descriptif_sommaire");
      switch ("$vl_e_doc_cleunik") {
        case "A" : pf_alimente_table();break;
        case "-1":pf_etat_fen("ajouter");break;
        default:
          vf_e_doc_cleunik=$vl_e_doc_cleunik;
          fa_grise_oui("bt_ajouter");
          fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik=$vl_e_doc_cleunik&",pf_affiche_datas);
       }
      break;
     case "sortir":
      window.close();
     break;   
 default:
 break;
}
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (window.opener!=null) {window.opener.pf_affiche_donnees_ged();}
  if (vl_datas.substring(0,3)!="-1-") {
    switch (vf_c_action) {
      case 'ajouter':
      	pf_alimente_table();
      	switch ("$_graal_typedoc") {
          case "2":
          case "10":
          case "11":
          case "6":
          case "12":
            vf_c_action="modifier";
            vf_e_doc_cleunik=vl_datas;
            fa_cache_non("tab_criteres");fa_cache_non("tab_commentaires");
            fa_grise_non("menu_02");
          	break;
        } 
        break;
      case 'modifier':
        //pf_raz_fiche();
        //pf_alimente_table();
        //pf_etat_fen('annuler');
        break;
       case 'supprimer':
        //pf_raz_fiche();
        pf_etat_fen('annuler');
        pf_etat_fen("sortir");
        break;
      default :
        alert('gestion mal gérée');
    }
  }
  else {
    fa_erreur(vl_datas)
  }
}
function pf_ouvre(vv_quoi_01,vv_quoi_02) {
  var vl_c_param;
  vl_c_param="typedoc=$_graal_typedoc"+"&vl_e_doc_cleunik="+vf_e_doc_cleunik+'&vl_c_titre='+fa_enc(fa_value_get("tb_titre"))+"&vl_c_lien="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&+genrecritere=";
  switch (vv_quoi_01) {
    case "critere_entreprise":
      vl_c_param+='entreprise';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600)
      break;
    case "critere_lesmiens":
      vl_c_param+='moi';
      fa_ouvre(vf_c_fen_criteres+vl_c_param,800,600)
      break;
    case "commentaires":
      vl_c_param='vf_e_doc_cleunik='+vf_e_doc_cleunik+'&';
      vl_c_param+='vf_e_commentaire_cleunik=-1&';
      vl_c_param+='genreacteur=favori&';
      fa_ouvre(c_fen_commentaires+vl_c_param,800,650)
      break;
  }
}
function pf_maj_rss(){
  s='vf_c_quelsdocs=leurnot&raf='+Math.random()+"&";
  fa_xmlhttprequest_txt('_graal_rss_notes_01.php',s,'');
  s='vf_c_quelsdocs=menot&raf='+Math.random()+"&";
  fa_xmlhttprequest_txt('_graal_rss_notes_01.php',s,'');
}
function pf_raz_fiche(){
  fa_value_set("tb_titre","");
  fa_value_set("tb_descriptif_sommaire","");
  fa_value_set("tb_origine","2");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("tb_dateheuremodif","");
  vf_e_doc_cleunik=0;
  fa_ds("criteres_des_ged_entreprise","");
  fa_ds("criteres_des_ged_lesautres","");
  fa_ds("criteres_des_ged_lesmiens","");
  fa_ds("criteres_des_ged_tous","");
  fa_ds("tb_blocnote_riche","");
}
function pf_sel_ligne(vv_qui) {
  if(fa_est_grise("bt_detailler")==true){return};
  var rowIndex = fa_cui("arbre_des_notes");
	if(rowIndex == -1){
    return;
  }
  vf_e_doc_cleunik=fa_cell_get("arbre_des_notes",rowIndex,"doc_cleunik");
  fa_xmlhttprequest_xml(vf_c_script_edite,"vl_e_doc_cleunik="+vf_e_doc_cleunik+"&",pf_affiche_datas);
}
function pf_validation(vv_quoi){
  var s="",texte="" ;
  s="vf_e_typedoc=$_graal_typedoc&";
  s +="vf_e_doc_cleunik="+vf_e_doc_cleunik+"&";
  s +="titre="+fa_enc(fa_value_get("tb_titre"))+"&";
  s +="blocnote_riche="+fa_enc(fa_value_get("tb_blocnote_riche"))+"&";
  s +="descriptif_sommaire="+fa_enc(fa_value_get("tb_descriptif_sommaire"))+"&";
  s +="origine="+fa_enc(fa_value_get("tb_origine"))+"&";
  switch(vv_quoi) {
    case "enregistrer":
      if (vf_e_doc_cleunik!=0) {
        s +="vf_c_action=modifier&";
        vf_c_action="modifier";
      } else {
        s +="vf_c_action=ajouter&";
        vf_c_action="ajouter";
      }
      break;
    case "supprimer":
      if(confirm("Confirmez-vous la suppression de ce modèle ?") == false) return;
      s="vf_e_doc_cleunik="+vf_e_doc_cleunik+"&";
			s +="vf_c_action=supprimer&";
      vf_c_action="supprimer";
    break;
  }     
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_fin_requete);
}
function pf_verif_acces(){
  var s ="vf_c_action=verifier_droits_acces&vf_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&"
  fa_xmlhttprequest_txt(vf_c_script_bdope_doc,s,pf_verif_acces_fin);
}
function pf_verif_acces_fin(stream) {
  var vl_c_datas=stream;
  vf_e_droits_proprio=vl_c_datas;
  pf_etat_fen("selectionner_suite");
}
function pf_voir_plein_ecran(){
  fa_ouvre(vf_c_script_edite_note+vf_e_doc_cleunik+'&raf_random='+Math.random()+'&',0,0)
}  
]]></script>
END;
?>
