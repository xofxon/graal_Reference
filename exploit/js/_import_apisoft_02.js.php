<?php
echo <<<END
/*
********************************************************************************************************************************
**********  Fenêtre des importations APISOFT (_import_apisoft_fen_importation_01.php)                             ********
********************************************************************************************************************************
*/
<script type="application/x-javascript"><![CDATA[
const _c_url_impor_prospe="_import_apisoft_prospect_01.php";
const _c_url_impor_secgeo="_import_apisoft_secteurs_geographiques_01.php";
const _c_url_impor_famill="_import_apisoft_familles_01.php";
const _c_url_impor_origin="_import_apisoft_origines_01.php";
const _c_url_impor_relati="_import_apisoft_liaisons_prospect_clients_01.php";
const _c_url_impor_typact="_import_apisoft_typesactions_01.php";
const _c_url_impor_action="_import_apisoft_actions_01.php";
const _c_url_impor_relrep="_import_apisoft_liaisons_procli_rep_01.php";
const _c_url_impor_comple="_import_apisoft_complement_01.php";
const _c_url_import_rep_tiers="_import_apisoft_representantsdestiers_01.php?";
function pf_etat_fen(vv_quoi){
  switch(vv_quoi){
    case "ini":
      break;
    case "sortir":
      window.close();  //  Ne fonctionne que si c'est une nouvelle fenêtre
      break;   
    default:
      break;
  }
}
function pf_importation(vv_quoi)
{
  var s="";
  var vl_c_fic_tiers,vl_c_fic_artic;
  var vl_c_base_origine=fa_gid("c_base_ori").value;
  var vl_c_base_destination=fa_gid("c_base_des").value;
  var vl_e_civilite_defaut;
  var vl_e_mail_defaut;
  var vl_e_fax_defaut;
  var vl_e_tel_defaut;
  var vl_e_portable_defaut;
  var vl_e_pays_defaut;
	fa_att_set("_graal_trad_objets_01","wait-cursor","true");
  fa_grise_fenetre("","oui");
  switch(vv_quoi)
  {
    case '1': //  Importation du fichier prospects
      vl_c_fic_tiers="tiers";
      vl_e_genre_acteur_defaut=fa_mlget("ml_genres_00");
      vl_e_civilite_defaut=fa_mlget("ml_civilite_00");
      vl_e_mail_defaut=fa_mlget("ml_courriel_00");
      vl_e_fax_defaut=fa_mlget("ml_fax_00");
      vl_e_tel_defaut=fa_mlget("ml_tel_00");
      vl_e_portable_defaut=fa_mlget("ml_por_00");
      vl_e_indicatif_tel_defaut=fa_mlget("ml_prefixe_tel_00");
      vl_e_indicatif_fax_defaut=fa_mlget("ml_prefixe_fax_00");
      vl_e_indicatif_por_defaut=fa_mlget("ml_prefixe_por_00");
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="vl_c_fic_tiers="+vl_c_fic_tiers+"&";
      s +="vl_e_civilite_defaut="+vl_e_civilite_defaut+"&";
      s +="vl_e_mail_defaut="+vl_e_mail_defaut+"&";
      s +="vl_e_fax_defaut="+vl_e_fax_defaut+"&";
      s +="vl_e_tel_defaut="+vl_e_tel_defaut+"&";
      s +="vl_e_portable_defaut="+vl_e_portable_defaut+"&";
      s +="vl_e_genre_acteur_defaut="+vl_e_genre_acteur_defaut+"&";
      s +="vl_e_indicatif_fax_defaut="+vl_e_indicatif_fax_defaut+"&";
      s +="vl_e_indicatif_tel_defaut="+vl_e_indicatif_tel_defaut+"&";
      s +="vl_e_indicatif_por_defaut="+vl_e_indicatif_por_defaut+"&";
      s +="vl_e_critere_cleunik_secteur_geo="+fa_mlget("ml_secteurs_geo_00")+"&";
      s +="vl_e_critere_cleunik_famille="+fa_mlget("ml_familles_pro_00")+"&";
      s +="vl_e_critere_cleunik_origine="+fa_mlget("ml_origine_pro_00")+"&";
      fa_xmlhttprequest_txt(_c_url_impor_prospe,s,pf_importation_retour);
      break;
    case '2': //  Importation des liaisons entre prospects et clients 
      vl_c_fic_tiers="tiers";
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="vl_c_fic_tiers="+vl_c_fic_tiers+"&";
      s +="vl_e_relation_gauche="+fa_mlget("ml_rel_gauche")+"&";
      s +="vl_e_relation_droite="+fa_mlget("ml_rel_droite")+"&";
      fa_xmlhttprequest_txt(_c_url_impor_relati,s,pf_importation_retour);
      break;
    case '3': //  Importation des types d'action
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      fa_xmlhttprequest_txt(_c_url_impor_typact,s,pf_importation_retour);
      break;
    case '4': //  Importation des actions
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      fa_xmlhttprequest_txt(_c_url_impor_action,s,pf_importation_retour);
      break;
    case '5': //  Importation des liaisons entre prospects et représentants 
      vl_c_fic_tiers="tiers";
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="vl_c_fic_tiers="+vl_c_fic_tiers+"&";
      s +="vl_e_relation_gauche="+fa_mlget("ml_rel_gauche_rep")+"&";
      s +="vl_e_relation_droite="+fa_mlget("ml_rel_droite_rep")+"&";
      fa_xmlhttprequest_txt(_c_url_impor_relrep,s,pf_importation_retour);
      break;
    case '6': //  Rattachement des représentants aux prospects
      vl_c_fic_tiers="tiers";
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="vl_c_fic_tiers="+vl_c_fic_tiers+"&";
      fa_xmlhttprequest_txt(_c_url_import_rep_tiers,s,pf_importation_retour);
      break;

    
    default:
      alert("Erreur de programmation !!!->'"+vv_quoi+"'<-!!!");
  }
}

function pf_importation_critere(vv_id)
{
  var s="";
  var vl_c_base_origine=fa_gid("c_base_ori").value;
  var vl_c_base_destination=fa_gid("c_base_des").value;
	fa_att_set("_graal_trad_objets_01","wait-cursor","true");
  fa_grise_fenetre("","oui");
  switch (vv_id)
  {
    case 'ml_secteurs_geo_00':  // Secteurs géographiques des prospects
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="quoi=Secteur&";
      s +="qui=prospect&";
      s +="vl_e_critere_cleunik="+fa_mlget("ml_secteurs_geo_00");
      fa_xmlhttprequest_txt(_c_url_impor_secgeo,s,pf_importation_retour);
      break;
    case "ml_familles_pro_00":  // Familles des prospects
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="quoi=FamilleTiers&";
      s +="qui=prospect&";
      s +="vl_e_critere_cleunik="+fa_mlget("ml_familles_pro_00");
      fa_xmlhttprequest_txt(_c_url_impor_famill,s,pf_importation_retour);
      break;
    case "ml_origine_pro_00":  // Origines
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="quoi=Origine&";
      s +="qui=prospect&";
      s +="vl_e_critere_cleunik="+fa_mlget("ml_origine_pro_00");
      fa_xmlhttprequest_txt(_c_url_impor_origin,s,pf_importation_retour);
      break;
    case "complement_procli":  //  Compléments prospect client
      s +="vl_c_base_origine="+vl_c_base_origine+"&";
      s +="vl_c_base_destination="+vl_c_base_destination+"&";
      s +="qui=prospect&";
      s +="vl_e_critere_cleunik="+fa_mlget("ml_complement_procli_critere")+"&";
      s +="quoi="+fa_gid("ml_complements_procli").selectedItem.getAttribute("value")+"&";
      fa_xmlhttprequest_txt(_c_url_impor_comple,s,pf_importation_retour);
      break;
  }
}

function pf_importation_retour(stream){
var vl_datas = stream;
	fa_att_rem("_graal_trad_objets_01","wait-cursor");
	fa_grise_fenetre("","non");
if (vl_datas=='ok') 
  alert("C'est toubon...");
else
  {fa_erreur(vl_datas);}
}
]]></script>
END;
