<?php
$vl_c_aag_107_js=fa_recup_dico_js("aag_107");
$vl_c_aag_108_js=fa_recup_dico_js("aag_108");
$vl_c_aag_109_js=fa_recup_dico_js("aag_109");
$vl_c_aag_110_js=fa_recup_dico_js("aag_110");

echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_act_interlo_tel_01.php";
const vf_c_script_edite="_graal_xml_act_interlo_tel_01.php";
const c_script_tableau="_graal_fen_rech_tel_01.php?genreacteur=plusie&reftel=";
var vf_c_action;
var vf_e_intel_cleunik;

function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  vf_e_intel_cleunik="$vl_e_intel_cleunik";
  switch (vf_e_intel_cleunik)  {
    case "-1":  //  création
      pf_etat_fen("ajouter");
      break;
    default:
      pf_etat_fen("ini");
      pf_selectionne_telephone();
      break    
  }
}
function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  vf_e_intel_cleunik=fa_xml_get(vl_c_datas,'intel_cleunik');
  fa_value_set("tb_telformate",fa_xml_get(vl_c_datas,'telformate'));
  fa_value_set("tb_blocnotebrut",fa_xml_get(vl_c_datas,'blocnotebrut'));
  fa_value_set("tb_dateheuremodif",fa_xml_get(vl_c_datas,'dateheuremodif'));
  fa_value_set("rdg_actif",fa_xml_get(vl_c_datas,'infofavori'));
  fa_mlsel("ml_tel_00",fa_xml_get(vl_c_datas,'choix_cleunik'));
  fa_mlsel("ml_prefixe_tel_00",fa_xml_get(vl_c_datas,'prefixe_choix_cleunik'));
  fa_value_set("rdg_portable",fa_xml_get(vl_c_datas,'portable'));
  fa_value_set("rdg_sms",fa_xml_get(vl_c_datas,'sms'));
}
function pf_alimente_defaut(){
  fa_value_set("tb_telformate","$vl_c_tel");
  fa_value_set("tb_blocnotebrut","");
  fa_value_set("rdg_actif",1);
  fa_value_set("rdg_portable",2);
  fa_value_set("rdg_sms",2);
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_non("bt_sortir");
      fa_grise_groupe_oui('broadcaster_01');
      break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("ml_tel_00")
      break;
    case "ajouter":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_grise_groupe_non('broadcaster_01');
      fa_focusdonne("ml_tel_00");
      break;
    case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      switch (vf_e_intel_cleunik)
      {
        case "-1":  //  création
          pf_etat_fen("ajouter");
          break;
        default:
          pf_etat_fen("ini");
          pf_selectionne_telephone();
          break    
      }

      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (window.opener!=null) {try {window.opener.pf_affiche_donnees_interlo();} catch (e) {}}
  if (vl_datas!="-1")     {
      switch (vf_c_action)      {
        case "ajout":
          break;
        case "modification":
          break;
        case "suppression":
          alert("Téléphone supprimé.")
          break;
      }
      pf_etat_fen("sortir");
    }
  else
    {
    alert(vl_datas);
    pf_etat_fen("annuler");
    }
}
function pf_raz_fiche(){
  fa_value_set("tb_telformate","");
  fa_value_set("tb_blocnotebrut","");
  fa_value_set("tb_dateheuremodif","");
  fa_value_set("rdg_actif",1);
	fa_att_set("tb_tel_01_verif_deja","label","$vl_c_aag_107_js");
	fa_att_set('tb_tel_01_verif_deja','tooltiptext',"$vl_c_aag_107_js");
	fa_att_rem("tb_tel_01_verif_deja","oncommand");
	fa_att_set("tb_tel_01_verif_deja","oncommand","pf_verifie_deja_tel_01();");
}
function pf_selectionne_telephone(){
  var s ="vl_e_intel_cleunik="+vf_e_intel_cleunik+"&";
  fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi){
  var vl_c_donnees;var vl_c_choix_actif;
  vl_c_choix_actif=fa_value_get('rdg_actif');
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  vl_c_donnees="";
  vl_c_donnees+="vl_intel_cleunik="+fa_enc(vf_e_intel_cleunik)+"&";
  vl_c_donnees+="vl_int_cleunik=$vl_e_interlo_cleunik&";
  vl_c_donnees+="vl_act_cleunik=$vl_e_act_cleunik&";
  vl_c_donnees+="vl_telformate="+fa_enc(fa_value_get("tb_telformate"))+"&";
  vl_c_donnees+="vl_blocnotebrut="+fa_enc(fa_value_get("tb_blocnotebrut"))+"&";
  vl_c_donnees+="vl_infofavori="+fa_enc(vl_c_choix_actif)+"&";
  vl_c_donnees+="vl_choix_cleunik="+fa_enc(fa_mlget("ml_tel_00"))+"&";
  vl_c_donnees+="vl_prefixe_choix_cleunik="+fa_enc(fa_mlget("ml_prefixe_tel_00"))+"&";
  vl_c_donnees+="vl_portable="+fa_enc(fa_value_get("rdg_portable"))+"&";
  vl_c_donnees+="vl_sms="+fa_enc(fa_value_get("rdg_sms"))+"&";
  switch(vv_quoi)  {
    case "enregistrer":
      if (vf_e_intel_cleunik!=-1)
        {vl_c_donnees+="vf_c_action=modifier&";}
      else
        {vl_c_donnees+="vf_c_action=ajouter&";}
      break;
    case "supprimer":
        Check = confirm("$vl_c_aag_110_js");
        if(Check == false) return;
        vl_c_donnees+="vf_c_action=supprimer&"
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
function pf_verifie_deja_tel_01(){
	fa_grise_fenetre("","oui");
	var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_telformate="+fa_enc(fa_value_get('tb_telformate'))+"&";
	vl_c_donnees+="vf_c_action=existe&"
	fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_verifie_deja_reftel_01_fin);
}
function pf_verifie_deja_reftel_01_fin(stream){
	switch (stream){
		case "0":
			fa_att_set("tb_tel_01_verif_deja","label","$vl_c_aag_108_js");
			fa_att_set('tb_tel_01_verif_deja','tooltiptext',"$vl_c_aag_108_js");
			fa_att_rem("tb_tel_01_verif_deja","oncommand");
			fa_att_set("tb_tel_01_verif_deja","oncommand","pf_verifie_deja_tel_01();");
			break;
		default:
			fa_att_set("tb_tel_01_verif_deja","label",stream+" $vl_c_aag_109_js");
			fa_att_set('tb_tel_01_verif_deja','tooltiptext',"$vl_c_aag_109_js");
			fa_att_rem("tb_tel_01_verif_deja","oncommand");
			fa_att_set("tb_tel_01_verif_deja","oncommand","pf_voir_deja_reftel('tb_telformate');");
			break;
	}
	fa_grise_fenetre("","non");
}
function pf_voir_deja_reftel(vv_quoi){
	fa_ouvre(c_script_tableau+fa_enc(fa_value_get(vv_quoi)));
}
]]></script>
END;
?>
