<?php
$vl_c_00002=fa_recup_session('mess_00002','');

$vl_tb_droits_traitement=_graal_requete_droits_fenetre("Fen_00360",$vl_e_uti_cleunik);
$vl_c_bct_101=fa_recup_dico("bct_101");
$vl_c_bct_102=fa_recup_dico("bct_102");
$vl_c_bct_103=fa_recup_dico("bct_103");
$vl_c_bct_104=fa_recup_dico("bct_104");
switch ($vl_e_cleunik_critere) {
	case 116:
		$js_complement_01=<<<EOT
		if (fa_xml_get(vl_c_datas,'choix_valeur_texte_02')==""){
			fa_value_set('rdg_principal',2);
		} else {
			fa_value_set('rdg_principal',fa_xml_get(vl_c_datas,'choix_valeur_texte_02'));
		}
EOT;

		$js_complement_02=<<<EIT
		s +="vl_c_choix_valeur_texte_02="+fa_enc(fa_value_get('rdg_principal'))+"&"
EIT;
		break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
/*
****************************************************************
**********  Fenêtre de gestion des critères articles  ********
****************************************************************
*/
const vf_c_url_arbre='_graal_das_choix_critere_01.php?genre=articles&';
const vf_c_script_edite='_graal_xml_choix_criteres_01.php?genre=articles&';
const vf_c_script_bdope_criteres='_graal_bdope_choix_criteres_01.php';
const vf_c_script_stats="_graal_fen_graphiques_stat_01.php?critere_cleunik=$vl_e_cleunik_critere&genre=criteres&";
const vf_e_critere_cleunik="$vl_e_cleunik_critere";
const c_c_script_fen_traitements_articles='_graal_traitements_articles_01.php?type=2&';
t_intitule=new Array("raf","$vl_c_bct_101","$vl_c_bct_102","$vl_c_bct_103","$vl_c_bct_104")
var vf_e_nombre_utilisations,vf_e_choix_cleunik;
function pf_affiche_datas(stream){
  var vl_c_datas,vl_c_type_acteurs;
  var vl_e_nombre,vl_e_choix_actif,vl_e_portee;
  pf_raz_fiche()
  vl_c_datas = stream;
  fa_value_set('tb_choix_code',fa_xml_get(vl_c_datas,'choix_code'));
  fa_value_set('tb_choix_valeur_texte_01',fa_xml_get(vl_c_datas,'choix_valeur_texte_01'));
  $js_complement_01
  vl_e_choix_actif=fa_xml_get(vl_c_datas,'choix_actif')
  vf_e_choix_cleunik=fa_xml_get(vl_c_datas,'choix_cleunik')
  switch(vl_e_choix_actif) {
   case "1": fa_att_set('ra_choix_actif_oui',"selected", 'true');break;
   case "2": fa_att_set('ra_choix_actif_non','selected', 'true');break;
  }
	vf_e_nombre_utilisations=fa_xml_get(vl_c_datas,'nombre_utilisations_1');
	fa_value_set("la_nbutilisations",fa_att_get("la_nbutilisations","_graal_value")+" :"+vf_e_nombre_utilisations);
}
function pf_alimente_defaut(){
  fa_att_set('ra_choix_actif_oui',"selected", 'true');
}
function pf_etat_fen(vv_quoi)
  {
   var vl_e_rowIndex;
   vf_c_action=vv_quoi;
   switch(vv_quoi) {
     case "ini":
       fa_value_set('rdg_etat',"2");
       fa_value_set('rdg_position',"2");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf06_alimente_table_bbb();
       break;
     case "selectionner":
      if(fa_cui('arb_choix_criteres') == -1){return;}
     if ((vf_e_nombre_utilisations==0) && (vf_e_choix_cleunik > 0)) {
      fa_grise_non("bt_supprimer");
     }
     else{
     fa_grise_oui("bt_supprimer");
     }
     fa_grise_non("bt_modifier");
     fa_grise_oui("bt_detailler");
     fa_grise_non("bt_annuler");
     fa_grise_oui("bt_sortir");
     fa_grise_oui("bt_enregistrer");
     fa_grise_groupe_oui('broadcaster_01');
     break;
     case "annuler":
       fa_grise_non("bt_detailler");
       fa_grise_non("bt_ajouter");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_enregistrer");
       fa_grise_oui("bt_annuler");
       fa_grise_groupe_oui('broadcaster_01');
       pf_raz_fiche();
       break;
     case "ajouter":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       pf_raz_fiche();
       pf_alimente_defaut();
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_choix_code");
       break;
     case "modifier":
       fa_grise_oui("bt_supprimer");
       fa_grise_oui("bt_modifier");
       fa_grise_oui("bt_ajouter");
       fa_grise_oui("bt_detailler");
       fa_grise_non("bt_annuler");
       fa_grise_oui("bt_sortir");
       fa_grise_non("bt_enregistrer");
       fa_grise_groupe_non('broadcaster_01');
       fa_focusdonne("tb_choix_valeur_texte_01");
       break;
     case "sortir":
     window.close();
     break;   
}
}

function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=='ok'){
    pf06_alimente_table_bbb();
  }
  else {
    fa_erreur(vl_datas);
  }
  pf_etat_fen('annuler');
}
function pf_ouvre(vv_qui,vv_enclair,vv_quoi,vv_quoi_encore){
  var vl_c_param;
  vl_c_param='vl_e_critere_cleunik='+fa_enc(vf_e_critere_cleunik)+"&";
  vl_c_param+='vl_c_quoi='+fa_enc(vv_quoi)+"&";
  vl_c_param+='vl_c_enclair='+fa_enc(t_intitule[vv_enclair])+"&";
  vl_c_param+='vl_c_code_critere='+fa_enc("$critere_code")+"&";
  vl_c_param+='vl_c_code_choix='+fa_enc(fa_value_get('tb_choix_code'))+"&";
  vl_c_param+='vl_c_deno_critere='+fa_enc("$critere_denomination")+"&";
  vl_c_param+='vl_c_deno_choix='+fa_enc(fa_value_get('tb_choix_valeur_texte_01'))+"&";
  switch (vv_quoi_encore) {
    case "choix":
      if (vf_e_choix_cleunik==0) {alert("Pas de choix sélectionné !!! Visualisation impossible!!");return;}
      vl_c_param+='vl_e_choix_cleunik='+fa_enc(vf_e_choix_cleunik)+"&type=2&";
      break;
    case "critere":
      vl_c_param+='vl_e_choix_cleunik=0&type=3&';
      break;
  }
  if ($vl_tb_droits_traitement[0]==false) {
    alert("on n'a pas le droit");
  } else {
    fa_ouvre(c_c_script_fen_traitements_articles+vl_c_param,1000,800);
  }
}

function pf_ouvre_stats() {
  fa_ouvre(vf_c_script_stats);
}
function pf_raz_fiche(){
  fa_gid('ra_choix_actif_oui').removeAttribute('selected');
  fa_gid('ra_choix_actif_non').removeAttribute('selected');
  fa_value_set('tb_choix_code','');
  fa_value_set('tb_choix_valeur_texte_01','');
  vf_e_choix_cleunik=0;
}
function pf_validation(vv_quoi) {
  var s;
  var vl_c_choix_actif;
  vl_c_choix_actif=fa_value_get('rdg_actif');
  if (vl_c_choix_actif=='') {vl_c_choix_actif=1};
  switch(vv_quoi) {
      case "enregistrer":
         s ="vl_c_action="+fa_enc(vf_c_action)+"&";
         s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
         s +="vl_e_critere_cleunik="+fa_enc(vf_e_critere_cleunik)+"&";
         s +="vl_c_choix_actif="+fa_enc(vl_c_choix_actif)+"&";
         s +="vl_c_code="+fa_enc(fa_value_get('tb_choix_code'))+"&";
         s +="vl_c_choix_valeur_texte_01="+fa_enc(fa_value_get('tb_choix_valeur_texte_01'))+"&";
         $js_complement_02
      break;
     case "supprimer":
       Check = confirm("$vl_c_00002");
       if(Check == false) return;
       s ="vl_c_action=supprimer&";
       s +="vl_e_choix_cleunik="+vf_e_choix_cleunik+"&";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_criteres,s,pf_fin_requete);       
}
]]></script>
END;
