<?php
$vf_c_script_cial_entete="_graal_xml_docial_entete.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_adresses_01="_graal_xml_docial_adresses_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_adresses_02="_graal_xml_docial_adresses_02.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_representants="_graal_das_docial_representants.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_colisage="_graal_das_docial_consignes_01.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_transporteur="_graal_xml_docial_transporteur.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_recap_montants="_graal_das_docial_recap_montants.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_action_cleunik=$vl_action_cleunik&";
$vf_c_script_cial_bonsdepreparation="_graal_das_actions_cial_docciaux.php?vl_action_cleunik=$vl_action_cleunik&vl_type_clair=Avoir&";
$vf_c_script_cial_lignes="_graal_das_actions_cial_lignes.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&";
$vf_c_script_cial_compta="_graal_exe_docial_comptabilise.php?genreaction=$vl_c_genreaction&vl_commercial_cleunik=$commercial_cleunik&vl_action_cleunik=$vl_action_cleunik&";
$js_bon_preparation="";
$js_confirmation_cdecli="";
$param_bp00="vl_e_action_cleunik=$vl_action_cleunik&vl_commercial_cleunik=$commercial_cleunik&vl_genre_adresse=2&";
$param_generaux_graal_029=intval(fa_recup_session('vs_param_generaux_graal_029','0'));
switch ($param_generaux_graal_029) {
  case 1:$vf_c_script_modele_avocli="_graal_pdf_avocli_01.php?$param_bp00";break;  //  Modele 1
  case 2:$vf_c_script_modele_avocli="_graal_pdf_avocli_02.php?$param_bp00";break;  //  Modele 2
  case 3:$vf_c_script_modele_avocli="_graal_pdf_avocli_03.php?$param_bp00";break;  //  Modele 3
  case 4:$vf_c_script_modele_avocli="_graal_pdf_avocli_04.php?$param_bp00";break;  //  Modele 4
  case 5:$vf_c_script_modele_avocli="_graal_pdf_avocli_05.php?$param_bp00";break;  //  Modele 4
}
$pf_cial_affiche_representants="pf_cial_affiche_representants();";
$pf_cial_affiche_colisage="pf_cial_affiche_colisage();";
$param_generaux_graal_163=intval(fa_recup_session('vs_param_generaux_graal_163',0)); //  Gestion reprÃ©sentants
$param_generaux_graal_164=intval(fa_recup_session('vs_param_generaux_graal_164',0)); //  Gestion colisage
if ($param_generaux_graal_163==2){$pf_cial_affiche_representants="";}
if ($param_generaux_graal_164==2){$pf_cial_affiche_colisage="";}
$js_confirmation_cdecli=<<<EOT
    case 'faccli':
      pf_cial_pdf("$vf_c_script_modele_avocli"+"raf_random="+Math.random()+"&");
      break;
    case 'faccli_01':
      pf_cial_pdf("_graal_pdf_avocli_01.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
    case 'faccli_02':
      pf_cial_pdf("_graal_pdf_avocli_02.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
	 case 'faccli_03':
      pf_cial_pdf("_graal_pdf_avocli_03.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
    case 'faccli_04':
      pf_cial_pdf("_graal_pdf_avocli_04.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
    case 'faccli_05':
      pf_cial_pdf("_graal_pdf_avocli_05.php?$param_bp00"+"raf_random="+Math.random()+"$pg&");
      break;
EOT;
$js_bon_preparation="";
$pf_cial_affiche_transporteur=<<<EOT
function pf_cial_affiche_transporteur(stream){
  var vl_c_datas=stream;
  fa_value_set("tb_pds_net",fa_xml_get(vl_c_datas,"poids_net"));
  fa_value_set("tb_pds_bru",fa_xml_get(vl_c_datas,"poids_bru"));
  fa_value_set("tb_vol_net",fa_xml_get(vl_c_datas,"volum_net"));
  fa_value_set("tb_vol_bru",fa_xml_get(vl_c_datas,"volum_bru"));
  fa_value_set("tb_sur_net",fa_xml_get(vl_c_datas,"surfa_net"));
  fa_value_set("tb_sur_bru",fa_xml_get(vl_c_datas,"surfa_bru"));
  fa_value_set("tb_transporteur",fa_xml_get(vl_c_datas,"nomcommercial"));
  fa_value_set("tb_conditionnement_memo",fa_xml_get(vl_c_datas,"nombre_colis"));
  fa_att_set("tb_transporteur","_graal_cleunik",fa_xml_get(vl_c_datas,"action_trans_cleunik"));
  fa_att_set("tb_transporteur","_act_cleunik",fa_xml_get(vl_c_datas,"act_cleunik_trans"));
}
EOT;
$pf_cial_faccli_suppri=<<<EOT
function pf_cial_faccli_suppri() {
	if (confirm("Confirmez-vous la suppression DEFINITIVE de cet avoir ?")==false) {return;}
  fa_xmlhttprequest_txt("_graal_bdope_doc_cial_01.php?vf_c_action=avocli->suppri&vl_commercial_cleunik=$commercial_cleunik&","",pf_cial_faccli_suppri_fin);
}
function pf_cial_faccli_suppri_fin(stream) {
  alert(stream);
	pf_etat_fen("sortir");
}
EOT;
switch ($type_gestion_doc){
	case 1:
$pf_cial_affiche_donnees=<<<EOT
function pf_cial_affiche_donnees() {
  pf_cial_entete();
  fa_xmlhttprequest_xml("$vf_c_script_cial_adresses_02"+"raf_random="+Math.random()+"&","",pf_cial_affiche_adresse_facturati);
  pf_cial_affiche_lignes();
  $pf_cial_affiche_representants
  pf_cial_affiche_montants();
  pf_cial_affiche_donnees_bonsdepreparation();
}
function pf_cial_pdf(vv_quoi){
	fa_att_set('iframe_docpdf','src',vv_quoi);
}
EOT;
		break;
	case 2:
	case 3:
$pf_cial_affiche_donnees=<<<EOT
function pf_cial_affiche_donnees() {
  pf_cial_entete();
  fa_xmlhttprequest_xml("$vf_c_script_cial_adresses_02"+"raf_random="+Math.random()+"&","",pf_cial_affiche_adresse_facturati);
  fa_xmlhttprequest_xml("$vf_c_script_cial_transporteur"+"raf_random="+Math.random()+"&","",pf_cial_affiche_transporteur);
  pf_cial_affiche_lignes();
  $pf_cial_affiche_representants
  $pf_cial_affiche_colisage
  pf_cial_affiche_montants();
  pf_cial_affiche_donnees_bonsdepreparation();
}
function pf_cial_pdf(vv_quoi){
	fa_att_set('iframe_docpdf','src',vv_quoi);
}
EOT;
		break;
}
$pf_cial_faccli_compta=<<<EOT
function pf_cial_faccli_compta() {
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt("$vf_c_script_cial_compta&quoi=compta_seule&","",pf_cial_faccli_compta_fin);
}
function pf_cial_faccli_decomptabilise() {
	fa_grise_fenetre("","oui");
  fa_xmlhttprequest_txt("$vf_c_script_cial_compta&quoi=enleve&","",pf_cial_faccli_compta_fin);
}
function pf_cial_faccli_compta_fin(stream) {
  alert(stream);
	window.location=document.location;
}
EOT;
$pf_cial_affiche_colisage=<<<EOT
function pf_cial_affiche_colisage() {
  fa_das("arbre_colisage","$vf_c_script_cial_colisage"+"raf_random="+Math.random()+"&");
}
EOT;
$pf_cial_affiche_donnees_bonsdepreparation=<<<EOT
function pf_cial_affiche_donnees_bonsdepreparation() {
  fa_das("arbre_bonsdepreparation","$vf_c_script_cial_bonsdepreparation"+"raf_random="+Math.random()+"&");
}
function pf_cial_fin_chargement_pdf(){
	pf_cial_affiche_donnees_bonsdepreparation();
}
EOT;
$pf_cial_affiche_representants=<<<EOT
function pf_cial_affiche_representants() {
  fa_das("arbre_representants","$vf_c_script_cial_representants"+"raf_random="+Math.random()+"&");
}
EOT;
$tb_cial_int_complement=<<<EOT
	fa_mlsel("ml_type_avoir",fa_xml_get(vl_c_datas,'type_avoir'),"value");
	fa_cache_oui('bt_supprimer');
EOT;
$tb_cial_int=$tb_cial_int_02.$tb_cial_int_03.$tb_cial_int_04.$tb_cial_int_complement;
$pf_cial_transformations=$pf_cial_faccli_compta.$pf_cial_faccli_suppri;
$boutons_modifier="oui";

$sql_req="SELECT f2.compta_etat,f1.montant_paye from _avocli_entetes f2 left join _echeancier f1 on f1.action_cleunik=f2.action_cleunik where f2.action_cleunik=$vl_action_cleunik;";
$result = _graal_requete_bd($sql_req);
$row = mysql_fetch_assoc($result);
$compta_etat=$row['compta_etat'];
$montant_paye=$row['montant_paye'];
_graal_libere_requete_bd($result);
switch ($compta_etat){
	case 1:
		$boutons_modifier="compta";
		break;
	case 8:
		if ($montant_paye==0){	
			$boutons_modifier="non";
		}
}
switch ($vf_c_action) {
	case 'modifier' :
	  	switch ("$boutons_modifier"){
	  		case "oui":
	  			$vl_c_ini="fa_grise_oui('bt_cial_faccli_compta_enleve');fa_grise_oui('bt_cial_faccli_compta');fa_grise_oui('bt_cial_faccli_suppri');fa_grise_oui('bt_cial_faccli_avocli');fa_grise_oui('bt_cial_enregistrer');";
	  			break;
	  		case "non":
	  			$vl_c_ini="fa_grise_non('bt_cial_faccli_compta_enleve');";
	  			break;
	  		case "compta":
	  			$vl_c_ini="fa_grise_oui('bt_cial_faccli_compta_enleve');fa_grise_non('bt_cial_faccli_compta');fa_grise_oui('bt_cial_faccli_suppri');fa_grise_oui('bt_cial_faccli_avocli');fa_grise_oui('bt_cial_enregistrer');";
	  			break;
	  	}
    break; 
  case 'modifier' :
    $vl_c_ini="fa_grise_oui('bt_cial_enregistrer');fa_grise_oui('bt_cial_faccli_compta_enleve');fa_grise_oui('bt_cial_faccli_compta');fa_grise_oui('bt_cial_faccli_suppri');";
    break; 
  case 'ajoutermodifier' :
    $vl_c_ini="fa_grise_oui('bt_cial_enregistrer');pf_cial_etat_fen('modifier');fa_grise_oui('bt_cial_faccli_compta_enleve');fa_grise_oui('bt_cial_faccli_compta');fa_grise_oui('bt_cial_faccli_suppri');";
    break;
}
$vl_cial_etat_fen="fa_grise_non('bt_cial_enregistrer');fa_grise_non('bt_cial_faccli_compta_enleve');fa_grise_non('bt_cial_faccli_compta');fa_grise_non('bt_cial_faccli_suppri');";
?>
