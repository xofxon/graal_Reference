<?php
$var_rc='\r\n';
$vl_c_url_absolue=fa_url_absolue();
$param_generaux_graal_042=intval(fa_recup_session('vs_param_generaux_graal_042','0'));
$param_generaux_graal_043=intval(fa_recup_session('vs_param_generaux_graal_043','0'));
$vl_c_bgn_215_js=fa_recup_dico_js("bgn_215");
$vl_c_bgn_216_js=fa_recup_dico_js("bgn_216");
$vl_c_bgn_217_js=fa_recup_dico_js("bgn_217");
$vl_c_bgn_218_js=fa_recup_dico_js("bgn_218");
$vl_c_bgn_219_js=fa_recup_dico_js("bgn_219");
$vl_c_bgn_220_js=fa_recup_dico_js("bgn_220");
$vl_c_bgn_221_js=fa_recup_dico_js("bgn_221");
$vl_c_bgn_222_js=fa_recup_dico_js("bgn_222");
$vl_c_bgn_223_js=fa_recup_dico_js("bgn_223");
$vl_c_bgn_224_js=fa_recup_dico_js("bgn_224");
echo <<<END
<script type="application/x-javascript"><![CDATA[
const c_script_recep_courriel="_graal_exe_courriel_recept.php?vl_e_graal_cleunik=";
const c_script_traite_courriel="_graal_das_courriel_recept.php?";
const c_script_bdope_listes="_graal_bdope_listes_courriels_01.php?var=vs_tempo_panier_liste_expe&";
const c_script_var='_graal_cree_variable_session_tempo.php';
const c_script_bdope_recept="_graal_bdope_courriel_recept_01.php?var=vs_tempo_panier_cle_recep&";
const c_script_rech_interlo='_graal_fen_rech_interlocuteurs_01.php?p02=Fen_00514&';
const vf_c_fen_interlo_mail="_graal_fen_act_interlo_mail_01.php?";
const vf_c_fen_interlo_tel="_graal_fen_act_interlo_tel_01.php?";
const vf_c_fen_interlo_fax="_graal_fen_act_interlo_fax_01.php?";
const c_script_fen_visu_acteurs='_graal_fen_rech_acteurs.php?vl_c_origine=selection&';
const c_script_fen_interlo_simple_01='_graal_fen_act_interlo_simple_01.php?';
const c_script_fen_interlo_simple_04='_graal_fen_act_interlo_simple_04.php?';
const c_script_fen_interlo_simple_05='_graal_fen_act_interlo_simple_05.php?';
const c_script_fen_acteurs_simple='_graal_fen_acteurs_simple_01.php?';
const c_script_fen_acteurs_simple_04='_graal_fen_acteurs_simple_04.php?';
const c_script_fen_acteurs_simple_05='_graal_fen_acteurs_simple_05.php?';
const c_script_fen_acteurs='_graal_fen_acteurs_01.php?';
const c_script_analy_recept='_graal_analyse_courriel_recept_03.php?var=vs_tempo_panier_cle_recep&';
const c_vide_dossier='_graal_exe_vide_dossier_courriels.php';
const c_script_detail="_graal_xul_courriel_01.php?";
const c_fen_interlo_mail="_graal_fen_act_interlo_mail_01.php?";
const c_fen_interlo_tel="_graal_fen_act_interlo_tel_01.php?";
const c_fen_interlo_fax="_graal_fen_act_interlo_fax_01.php?";
const c_script_bdope_truelle='_graal_truelle_courriel_recept_01.php?var=vs_tempo_panier_cle_recep&';
const c_upload_courriel="_graal_exe_courriel_import_recus.php?";
const c_fen_courriel_ar="_graal_fen_courriel_03.php?action_cleunik=";
var vf_c_liste_en_cours="",vf_indice_liste_pj=0,vf_b_suite=false;
var vf_c_tableau_retour="",vf_c_exploit="";
var vf_c_param="",vf_c_qui="",vf_c_refweb="",vf_e_integre="";
const lstn_grise = { 
	willRebuild : function(event){},
	didRebuild  : function(event){fa_grise_fenetre(event,"non");} 
};
function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  var vl_c_chaine=fa_xml_get(vl_c_datas,'blocnote_riche');
  var vl_c_sortie=vl_c_chaine.replace(/<br>/g, "$var_rc"); 
  fa_value_set("tb_message",vl_c_sortie);
}
function pf_ajoute_courriel(vv_genre,vv_qui,vv_type) {
  var vl_c_zone="";
  switch (vv_genre) {
    case 'E':vl_c_zone="z10";break;
    case 'R':vl_c_zone="z26";break;
  }
	vf_c_exploit="refweb";
  switch (vv_type) {
    case '1':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_rech_interlo+"genreacteur="+vv_qui+"&",800,600);
      break;
    case '2':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_fen_visu_acteurs+"vl_e_genreacteur="+vv_qui+"&",800,600);
      break;
    case '3':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&refweb='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs_simple+vl_c_param,700,750);
      break;
    case '4':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&refweb='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs+vl_c_param,1350,800);
      break;

  }
}
function pf_ajoute_fax(vv_genre,vv_qui,vv_type) {
  var vl_c_zone="";
  switch (vv_genre) {
    case 'E':vl_c_zone="z10";break;
    case 'R':vl_c_zone="z26";break;
  }
	vf_c_exploit="fax";
  switch (vv_type) {
    case '1':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_rech_interlo+"genreacteur="+vv_qui+"&",800,600);
      break;
    case '2':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_fen_visu_acteurs+"vl_e_genreacteur="+vv_qui+"&",800,600);
      break;
    case '3':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&fax='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs_simple_05+vl_c_param,700,750);
      break;
    case '4':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&fax='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs+vl_c_param,1350,800);
      break;

  }
}

function pf_ajoute_liste(vv_genre,vv_couleur,vv_type){
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  vf_c_param ="&vl_c_action=ajouter_kilometre&"
  vf_c_param+="vl_e_type="+vv_type+"&";
  vf_c_param+="quellecouleur="+vv_couleur+"&";
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      switch (vv_genre) {
        case "E":
          switch (vv_type) {
            case '1':vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z10");break;
            case '2':vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z13");break;
          }
          break;
        case "R":
          switch (vv_type) {
            case '1':vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z26");break;
            case '2':vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z33");break;
          }
          break;
      }
    }
  }
  fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_liste_expe&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_ajoute_liste_suite);
}
function pf_ajoute_liste_suite(){
  fa_xmlhttprequest_txt(c_script_bdope_listes,vf_c_param,pf_traite_courriel);
}
function pf_ajoute_tel(vv_genre,vv_qui,vv_type) {
  var vl_c_zone="";
  switch (vv_genre) {
    case 'E':vl_c_zone="z10";break;
    case 'R':vl_c_zone="z26";break;
  }
	vf_c_exploit="tel";
  switch (vv_type) {
    case '1':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_rech_interlo+"genreacteur="+vv_qui+"&",800,600);
      break;
    case '2':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      fa_ouvre(c_script_fen_visu_acteurs+"vl_e_genreacteur="+vv_qui+"&",800,600);
      break;
    case '3':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&tel='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs_simple_04+vl_c_param,700,750);
      break;
    case '4':
      vf_c_qui=vv_qui;
      var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
      vf_c_refweb=fa_cell_get("arbre_courriels",rowIndex,vl_c_zone);
      if (vf_c_refweb=="") {alert("$vl_c_bgn_215_js");return;}
      var vl_c_param="genreacteur="+vv_qui+'&refweb='+fa_enc(vf_c_refweb)+"&";
      fa_ouvre(c_script_fen_acteurs+vl_c_param,1350,800);
      break;

  }
}

function pf_alimente_defaut(){
  fa_value_set('rdg_oui_non_aff_html',1);
  fa_value_set('rdg_aff_quoi',2);
  fa_value_set('rdg_dat_type',1);
  fa_value_set('rdg_marquoi',3);
  fa_value_set('rdg_oui_non_aff_sele',1);
}
function pf_choix_traite_courriel(vv_quoi) {
  vf_e_integre=vv_quoi;
  pf_traite_courriel();
}
function pf_courriel_analyse() {
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01");
    }
  fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_cle_recep&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_courriel_analyse_suite);
  }
}
function pf_courriel_analyse_suite(){
  fa_att_set("if_courriel","src",c_script_analy_recept+"&raf="+Math.random());
}
function pf_courriel_enregistre_actions() {
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  var vl_e_nb_sel=vl_t_tableau.length;
	var j=0;
  if (vl_e_nb_sel!=0) {
  	if ("$param_generaux_graal_042"=="2") {
  		for(i=0;i<vl_e_nb_sel;i++) {
        if (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z25_invisible")=="af06") {
          j++;
        }
    	}
			if (j>1) {
				alert("$vl_c_bgn_223_js");
				return;
			}
  	}
    var vl_t_web=[];
    j=-1;
    for(i=0;i<vl_e_nb_sel;i++) {
      //  Pour l'instant (9 novembre 2007), on désactive le test du "déjà enregistré"
      //if (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z15")==2) {
        if ((fa_cell_get("arbre_courriels",vl_t_tableau[i],"z20")!=0) ||(fa_value_get('rdg_oui_non_reg_00006')==1 )) {
          j++;
          vl_t_web[j]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01");
        }
      //}
    }
    if (vl_t_web.length!=0) {
    	fa_grise_fenetre("","oui");
      fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_cle_courriels_action&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_courriel_enregistre_actions_suite);
    } else {
      alert("$vl_c_bgn_216_js");
    }
  }
}
function pf_courriel_enregistre_actions_suite(vv_stream){
  fa_xmlhttprequest_txt(c_script_detail+'vl_genre=action&raf='+Math.random(),"",pf_courriel_enregistre_actions_suitefin);
}
function pf_courriel_enregistre_actions_suitefin(vv_stream){
  var vl_c_datas=vv_stream;
	var tableau_retour=vl_c_datas.split('|');
	alert(tableau_retour[0]);
 	fa_grise_fenetre("","non");
	if ("$param_generaux_graal_043"=="1") {
		var vl_e_nb_sel=tableau_retour[1];
		if (vl_e_nb_sel!=0){
			var vl_t_cleunik_ar=tableau_retour[2].split(';');
			for(i=0;i<vl_e_nb_sel;i++) {
				if (confirm("$vl_c_bgn_224_js")==true) {
  				fa_ouvre(c_fen_courriel_ar+vl_t_cleunik_ar[i],0,0);
				}
	    }
    }
	} else {
	}
}
function pf_courriel_telecharge(){
  var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
  var vl_courriel_brut_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z01");
	pf07_courriel_telecharge(vl_courriel_brut_cleunik);
}
function pf_detaille_courriel(){
  var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
  var vl_courriel_brut_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z01");
  var vl_c_fen=c_script_detail+"vl_genre=xul&raf="+Math.random()+"&vl_courriel_brut_cleunik="+vl_courriel_brut_cleunik+"&vl_affiche_html="+fa_value_get('rdg_oui_non_aff_html');
  fa_att_set("if_courriel","src",vl_c_fen);
}
function pf_detaille_courriel_ouvre(){
  var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
  var vl_courriel_brut_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z01");
  var vl_c_fen=c_script_detail+"vl_genre=xul&raf="+Math.random()+"&vl_courriel_brut_cleunik="+vl_courriel_brut_cleunik+"&vl_affiche_html="+fa_value_get('rdg_oui_non_aff_html');
  fa_ouvre(vl_c_fen);
}
function pf_elimine_recus(vv_qui){
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    var j=-1;
    for(i=0;i<vl_e_nb_sel;i++) {
      switch (vv_qui) {
        case 1: 
          if ( (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z15")==2) || (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z15")==4)) {j++;vl_t_web[j]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01")}
          break;
        case 2: case 3:
          if (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z15")==3) {j++;vl_t_web[j]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01")}
          break;
        case 4:
          if (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z38")!="") {j++;vl_t_web[j]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01")}
          break;

      }
    }
    if (vl_t_web.length!=0) {
      fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_cle_recep&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_elimine_recus_suite,vv_qui);
    } else {
      ;
      switch (vv_qui) {
      case 1:alert("$vl_c_bgn_217_js");break;
      case 2:alert("$vl_c_bgn_218_js");break;
      case 3:case 4:alert("$vl_c_bgn_219_js");break;
    }
    }
  }
}
function pf_elimine_recus_suite(vv_raf,vv_qui){
  switch (vv_qui) {
    case 1:fa_xmlhttprequest_txt(c_script_bdope_recept,"vl_c_action=supprime_kilometre&",pf_traite_courriel);break;
    case 2:fa_xmlhttprequest_txt(c_script_bdope_recept,"vl_c_action=reintegre_kilometre&",pf_traite_courriel);break;
    case 3:case 4:fa_xmlhttprequest_txt(c_script_bdope_recept,"vl_c_action=elimine_kilometre&",pf_traite_courriel);break;
  }
}
function pf_etat_fen(vv_quoi){
  switch(vv_quoi) {
    case "ini":
      fa_xmlhttprequest_txt(c_vide_dossier,"","");
      pf_alimente_defaut();
      fa05_sel_date(1,'bem_tb_deb','bem_tb_fin');
      fa_focusdonne('ml_emetteur');
      fa_value_set('rdg_oui_non_reg_00006',$vl_tb_reg_00006[0]);
      fa_value_set('rdg_oui_non_reg_00005',$vl_tb_reg_00005[0]);
      fa_value_set('rdg_oui_non_reg_00004',$vl_tb_reg_00004[0]);
      fa_value_set('rdg_oui_non_reg_00003',$vl_tb_reg_00003[0]);
			fa_badl("arbre_courriels",lstn_grise);
			if ("$vl_e_sequence"!=0) {
				var vl_c_param=c_script_traite_courriel+"&raf="+Math.random()+"&vl_e_sequence=$vl_e_sequence&vl_e_integre=seq&";
				fa_grise_fenetre("","oui");
  			fa_das("arbre_courriels",vl_c_param);
			}
      break;
    case "annuler":
      pf_raz_fiche();
      pf_alimente_defaut();
      break;
    case "sortir":
      window.close();
      break;   
  }
}
function pf_imp_courriel(vv_compte){
	var vl_c_nomfic=fa03_sel_fichier("","");
	if(vl_c_nomfic!="") {
		 fa03_fichier_lit_et_envoie(c_upload_courriel+"vl_e_graal_cleunik="+vv_compte,pf_imp_courriel_fin,vl_c_nomfic);
	}
}
function pf_imp_courriel_fin(vv_data){
  var tableau_retour=vv_data.split('|');
	var vl_c_param=c_script_traite_courriel+"&raf="+Math.random()+"&vl_e_integre=cle&vl_e_courriel_brut_cleunik="+tableau_retour[0]+"&";
	fa_grise_fenetre("","oui");
  fa_das("arbre_courriels",vl_c_param);
}
function pf_marque_recus(vv_qui){
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    for(i=0;i<vl_e_nb_sel;i++) {
      vl_t_web[i]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01")
    }
    if (vl_t_web.length!=0) {
      fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_cle_recep&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_marque_recus_suite,vv_qui);
    } else {
      switch (vv_qui) {
        case 1:alert("$vl_c_bgn_221_js");break;
        case 2:alert("$vl_c_bgn_222_js");break;
      }
    }
  }
}
function pf_marque_recus_suite(vv_raf,vv_qui){
  switch (vv_qui) {
    case 1:fa_xmlhttprequest_txt(c_script_bdope_recept,"vl_c_action=marque_kilometre&",pf_traite_courriel);break;
    case 2:fa_xmlhttprequest_txt(c_script_bdope_recept,"vl_c_action=demarque_kilometre&",pf_traite_courriel);break;
  }
}
function pf_menucontextuel_arbre(event,vv_qui){
  var tree = document.getElementById(vv_qui);
	var rowIndex=fa_cui(vv_qui);
  if(rowIndex == -1){tree.setAttribute("context","");return;}
	var vl_genre=fa_cell_get(vv_qui,rowIndex,"z39");
  var tbo = tree.treeBoxObject;
  // get the row, col and child element at the point
  var row = { }, col = { }, child = { };
  try {
    tbo.getCellAt(event.clientX, event.clientY, row, col, child);
    var vl_c_nom_col=col.value.id;
    switch (vl_c_nom_col) {
      case "z05": 
      case "z11":
				switch (vl_genre){
					case "1":
						tree.setAttribute("context","ml_reponse_tel");
						break;
					case "2":
						tree.setAttribute("context","ml_reponse_fax");
						break;
					case "":
						tree.setAttribute("context","ml_expediteur");
						break;
				}
				break;
      case "z26": 
      case "z31":
      case "z33":
				switch (vl_genre){
					case "1":
						tree.setAttribute("context","ml_reponse_tel");
						break;
					case "2":
						tree.setAttribute("context","ml_reponse_fax");
						break;
					case "":
						tree.setAttribute("context","ml_reponse_web");
						break;
				}
				break;
      case "z21":
        tree.setAttribute("context","ml_truelle");break;
      case "z17": //  pièces jointes
        tree.setAttribute("context","ml_suspect");break;
      default : 
        tree.setAttribute("context","ml_standard");
        fa_grise_non("mli_std01");fa_grise_non("mli_std02");fa_grise_non("mli_std03");fa_grise_non("mli_std04");fa_grise_non("mli_std05");fa_grise_non("mli_std06");
        switch (fa_value_get('rdg_aff_quoi')) {
          case '0'://Tous
            break;
          case '1': // Enregistrés
            //fa_grise_oui("mli_std01");// pour pouvoir enregistrer de nouveau !!
            fa_grise_oui("mli_std02");fa_grise_oui("mli_std03");fa_grise_oui("mli_std04");
            break;
          case '2': //  En attente de traitement
            fa_grise_oui("mli_std03");fa_grise_oui("mli_std04");
            break
          case '3': // courriels supprimés
            fa_grise_oui("mli_std01");fa_grise_oui("mli_std02");
            break;
          case '4': // en anomalies
            fa_grise_oui("mli_std01");fa_grise_oui("mli_std03");fa_grise_oui("mli_std04");
            break;
        }
        break;
    }
  } catch (e) {
    tree.setAttribute("context","");
  }
}
function pf_onunload(){
	fa_brl("arbre_courriels",lstn_grise);
}
function pf_ouvre(vv_genre,vv_quoi) {
  var rowIndex=fa_cui("arbre_courriels");if(rowIndex == -1){return;}
  switch (vv_genre) {
    case "E":
      var vl_genreacteur=fa_cell_get("arbre_courriels",rowIndex,"z22");
      var vl_e_interlo_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z24");
      var vl_e_act_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z23");
      var vl_e_intweb_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z20");
      break;
    case "R":
      var vl_genreacteur=fa_cell_get("arbre_courriels",rowIndex,"z28");
      var vl_e_interlo_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z30");
      var vl_e_act_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z29");
      var vl_e_intweb_cleunik=fa_cell_get("arbre_courriels",rowIndex,"z27");
      break;
  }
  if (vl_genreacteur=="0") {return;}
  var vl_c_param="genreacteur="+vl_genreacteur+"&";
  switch (vv_quoi) {
    case "interlo":
      vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vl_e_interlo_cleunik)+"&";
      vl_c_param+='vl_e_act_cleunik='+fa_enc(vl_e_act_cleunik)+'&';
      fa_ouvre_interlo(vl_c_param);
      break;
    case "refweb":
      vl_c_param+='vl_e_intweb_cleunik='+fa_enc(vl_e_intweb_cleunik)+"&";
      fa_ouvre(c_fen_interlo_mail+vl_c_param,600,350);
      break;
		case "tel":
      vl_c_param+='vl_e_intel_cleunik='+fa_enc(vl_e_intweb_cleunik)+"&";
      fa_ouvre(c_fen_interlo_tel+vl_c_param,500,480);
      break;			
		case "fax":
      vl_c_param+='vl_e_intweb_cleunik='+fa_enc(vl_e_intweb_cleunik)+"&";
      fa_ouvre(c_fen_interlo_fax+vl_c_param,600,350);
      break;			

  }
}
function pf_ouvre_interlo_recup(vl_int_cleunik,vl_qui, vl_act_cleunik,vl_raisonsoc,vl_portee) {
  var vl_c_param="genreacteur="+vl_portee+"&";
  switch (vf_c_exploit){
  	case "refweb":
			vl_c_param+='vl_e_intweb_cleunik=-1&';
		  vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vl_int_cleunik)+"&";
		  vl_c_param+='refweb='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(vf_c_fen_interlo_mail+vl_c_param,700,720);
			break;
		case "tel":
			vl_c_param+='vl_e_intel_cleunik=-1&';
		  vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vl_int_cleunik)+"&";
		  vl_c_param+='tel='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(vf_c_fen_interlo_tel+vl_c_param,500,480);
			break;
		case "fax":
			vl_c_param+='vl_e_intel_cleunik=-1&';
		  vl_c_param+='vl_e_interlo_cleunik='+fa_enc(vl_int_cleunik)+"&";
		  vl_c_param+='fax='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(vf_c_fen_interlo_fax+vl_c_param,700,410);
			break;

  }
}
function pf_ouvre_acteur_recup(vl_act_cleunik,vl_c_raisonsoc,vl_c_typeacteur){
  var vl_c_param="vl_e_act_cleunik="+vl_act_cleunik+"&genreacteur="+vl_c_typeacteur+"&";
  switch (vf_c_exploit){
  	case "refweb":
			vl_c_param+='refweb='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(c_script_fen_interlo_simple_01+vl_c_param,700,720);
			break;
  	case "tel":
			vl_c_param+='tel='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(c_script_fen_interlo_simple_04+vl_c_param,700,520);
			break;
  	case "fax":
			vl_c_param+='fax='+fa_enc(vf_c_refweb)+"&";
		  fa_ouvre(c_script_fen_interlo_simple_05+vl_c_param,700,520);
			break;

	}			
}
function pf_raz_fiche(){}
function pf_sel_courriel(vv_qui){
	fa_grise_fenetre("","oui");
  fa_bgc("bt_recep",'red');fa_bgc("bt_recep_date",'red');
  fa_grise_oui("bt_recep");fa_grise_oui("bt_recep_date");
  //fa_das("arbre_courriels","");
	fa_lignes_arbre_deselectionne("arbre_courriels");
  fa_xmlhttprequest_txt(c_script_recep_courriel+vv_qui,"",pf_sel_courriel_fin);
}
function pf_sel_courriel_fin(stream) {
  var vl_c_datas = stream;
  fa_bgc("bt_recep",'init');fa_bgc('bt_recep_date','init');
  fa_grise_non("bt_recep");fa_grise_non("bt_recep_date");
  fa_value_set("tb_cr_recep",vl_c_datas);
  fa_cache_non('vb_div');
  fa_cache_non('dk_02');
  fa_gid('dk_02').selectedIndex=0;
  pf_choix_traite_courriel(0);
}
function pf_sel_ligne() { 
  if (fa_value_get('rdg_oui_non_aff_sele')==1) {pf_detaille_courriel();};
}
function pf_traite_courriel() {
	var vl_c_datedeb=fa_value_get("bem_tb_deb");
	var vl_c_datefin=fa_value_get("bem_tb_fin");
	vl_c_datedeb=vl_c_datedeb.replace("-", "", "gi");
	vl_c_datefin=vl_c_datefin.replace("-", "", "gi");
  fa_value_set("tb_message","");
  var uticptbal_cleunik=fa_mlget('ml_emetteur','_graal_cleunik');
  var vl_e_quel_statut=fa_value_get('rdg_aff_quoi');
  var vl_c_scrip_date="";
  if (vf_e_integre=='dates') {
    vl_c_scrip_date='vl_c_dateheuredebut='+fa_enc(vl_c_datedeb)+'&vl_c_dateheurefin='+fa_enc(vl_c_datefin)+"&type_date="+fa_value_get("rdg_dat_type")+"&";
  }
  var vl_c_param=c_script_traite_courriel+"&raf="+Math.random()+"&uticptbal_cleunik="+uticptbal_cleunik+"&vl_e_integre="+fa_enc(vf_e_integre)+"&vl_e_quel_statut="+vl_e_quel_statut+"&vl_e_marque="+fa_value_get("rdg_marquoi")+"&"+vl_c_scrip_date;
	fa_grise_fenetre("","oui");
  fa_das("arbre_courriels",vl_c_param);
}
function pf_truelle(vv_qui) {
  var rowIndex=fa_cui("arbre_courriels");
  if(rowIndex == -1){return;}
  var vl_t_tableau=[];
  vl_t_tableau=fa_lignes_selectionnees("arbre_courriels");
  vl_e_nb_sel=vl_t_tableau.length;
  if (vl_e_nb_sel!=0) {
    var vl_t_web=[];
    var j=-1;
    for(i=0;i<vl_e_nb_sel;i++) {
      if (fa_cell_get("arbre_courriels",vl_t_tableau[i],"z15")==4) {j++;vl_t_web[j]=fa_cell_get("arbre_courriels",vl_t_tableau[i],"z01");}
    }
    if (vl_t_web.length!=0) {
      fa_xmlhttprequest_txt(c_script_var+'?var=vs_tempo_panier_cle_recep&','vl_t_listecles='+fa_jsarray2php_00(vl_t_web),pf_truelle_suite,vv_qui);
    } else {
      switch (vv_qui) {
        case 1:alert("$vl_c_bgn_220_js");break;
        case 2:alert("$vl_c_bgn_220_js");break;
      }
    }
  }
}
function pf_truelle_suite(vv_raf,vv_qui){
  fa_xmlhttprequest_txt(c_script_bdope_truelle,"vl_c_action="+vv_qui+"&",pf_truelle_fin);
}
function pf_truelle_fin(vv_stream) {
  pf_traite_courriel();
}
]]></script>
END;
?>
