<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_e_doc_cleunik;
var vf_e_uti_cleunik_ajout,vf_e_uti_cleunik_modif;
const vf_c_url_arbre_modif='_graal_das_droits_doc_02.php?doc_cleunik=';
const vf_c_url_arbre_ajout='_graal_das_droits_doc_01.php?doc_cleunik=';
const vf_c_script_edite='_graal_xml_droits_doc_01.php';
const vf_c_script_bdope_droits='_graal_bdope_droits_doc_01.php';
function pf_affiche_datas(stream){
  var vl_c_datas = stream;
  fa_uncheck('ch_m01');
  fa_uncheck('ch_m02');
  fa_uncheck('ch_m03');
  fa_uncheck('ch_m04');
  var droits_proprio=fa_xml_get(vl_c_datas,'droits_proprio');
  if ((droits_proprio & 1) == 1) {fa_check('ch_m01');}
  if ((droits_proprio & 2) == 2) {fa_check('ch_m02');}
  if ((droits_proprio & 4) == 4) {fa_check('ch_m03');}
  if ((droits_proprio & 8) == 8) {fa_check('ch_m04');}
}
function pf_alimente_table(){
  fa_das('arb_ajout',vf_c_url_arbre_ajout+vf_e_doc_cleunik+'&raf_random='+Math.random());
  fa_das('arb_modif',vf_c_url_arbre_modif+vf_e_doc_cleunik+'&raf_random='+Math.random());
}
function pf_etat_fen(vv_quoi){
  switch(vv_quoi) {
    case "ini":
    vf_e_doc_cleunik = fa_att_get("_graal_fen_droits_01","_graal_doc_cleunik");
    pf_alimente_table();
    break;
  case "sortir":
    window.close();
    break;   
  }
}
function pf_fin_requete(stream){
  var vl_datas = stream;
  pf_alimente_table();
}
function pf_sel_ligne(vv_objet){
  var arbre = document.getElementById(vv_objet);
  var rowIndex = arbre.currentIndex;
  if(rowIndex == -1){return;}
  switch(vv_objet) {
    case "arb_ajout":
      vf_e_uti_cleunik_ajout=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("ajo_uti_cleunik"));
      break;
    case "arb_modif":
      vf_e_uti_cleunik_modif=arbre.view.getCellText( rowIndex ,arbre.columns.getNamedColumn("mod_uti_cleunik"));
      s ="vl_e_uti_cleunik="+fa_enc(vf_e_uti_cleunik_modif)+"&";
      s +="vl_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
      s +="&raf_random="+Math.random()+"&";
      fa_xmlhttprequest_xml(vf_c_script_edite,s,pf_affiche_datas);
      break;
  }
}
function pf_validation(vv_quoi){
  var s;
  var vl_e_droits_proprio;
  switch(vv_quoi) {
    case "modifier":
      if (fa_cui('arb_modif')==-1) {return;}
      vl_e_droits_proprio=0;
      if (fa_est_coche("ch_m01")==true) {vl_e_droits_proprio+=1;};
      if (fa_est_coche("ch_m02")==true) {vl_e_droits_proprio+=2;};
      if (fa_est_coche("ch_m03")==true) {vl_e_droits_proprio+=4;};
      if (fa_est_coche("ch_m04")==true) {vl_e_droits_proprio+=8;};
      s ="vf_c_action=modifier&";
      s +="vl_e_uti_cleunik="+fa_enc(vf_e_uti_cleunik_modif)+"&";
      s +="vl_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
      s +="vl_e_droits_proprio="+fa_enc(vl_e_droits_proprio)+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_droits,s,pf_fin_requete);
      break;
    case "ajouter":
      if (fa_cui('arb_ajout')==-1) {return;}
      vl_e_droits_proprio=0;
      if (fa_est_coche('ch_n01')==true) {vl_e_droits_proprio+=1;};
      if (fa_est_coche('ch_n02')==true) {vl_e_droits_proprio+=2;};
      if (fa_est_coche('ch_n03')==true) {vl_e_droits_proprio+=4;};
      if (fa_est_coche('ch_n04')==true) {vl_e_droits_proprio+=8;};
      s ="vf_c_action=ajouter&";
      s +="vl_e_uti_cleunik="+fa_enc(vf_e_uti_cleunik_ajout)+"&";
      s +="vl_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
      s +="vl_e_droits_proprio="+fa_enc(vl_e_droits_proprio)+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_droits,s,pf_fin_requete);
      break;
   case "supprimer":
      if (fa_cui('arb_modif')==-1) {return;}
      if (fa_cl('arb_modif')==1) {alert("Il faut qu\'au moins un utilisateur ait des droits.");return;}
      if (confirm("Confirmez-vous la suppression des droits pour ce couple utilisateur/document ?") == false) {return;}
      s ="vf_c_action=supprimer&";
      s +="vl_e_uti_cleunik="+fa_enc(vf_e_uti_cleunik_modif)+"&";
      s +="vl_e_doc_cleunik="+fa_enc(vf_e_doc_cleunik)+"&";
      fa_xmlhttprequest_txt(vf_c_script_bdope_droits,s,pf_fin_requete); 
      break;
  }
}
]]></script>
END;
?>
