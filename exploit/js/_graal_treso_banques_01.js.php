<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_url_alimente_table_01="_graal_das_treso_banques_01.php";
const _c_script_edite="_graal_xml_treso_banques_01.php";
const _c_script_bdope_fen="_graal_bdope_treso_banques_01.php";
var vf_c_action="",vf_banque_cleunik=-2;
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  fa_value_set("tb_code",fa_xml_get(vl_c_datas,"code"));
  fa_value_set("tb_nom",fa_xml_get(vl_c_datas,"nom"));
  vf_e_utilisations=fa_xml_get(vl_c_datas,"utilisations");
  vf_banque_cleunik=fa_xml_get(vl_c_datas,"banque_cleunik");
}
function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui("broadcaster_01");
  pf_raz_fiche();
  pf_alimente_table("arbre_banques");
}
function pf_alimente_defaut(){
  vf_banque_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_nom","");
}
function pf_alimente_table(vv_qui){
  fa_das(vv_qui,_c_url_alimente_table_01+"?raf="+Math.random());
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      var i=fa_cui("arbre_banques");if(i==-1){return;}
      if (vf_e_utilisations==0 && vf_banque_cleunik>0) {fa_grise_non("bt_supprimer");} else {fa_grise_oui("bt_supprimer");}
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    fa_focusdonne("tb_code")
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_focusdonne("tb_code")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_groupe_oui("broadcaster_01");
    pf_raz_fiche();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=="ok") {pf_alimente_table("arbre_banques");} else {alert(vl_datas)}
  pf_etat_fen("annuler");
}
function pf_raz_fiche(){
  vf_banque_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_nom","");
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return}
  var i=fa_cui(vv_qui);if(i==-1){return;}
  var s ="banque_cleunik="+fa_cell_get(vv_qui,i,"tc_banque_cleunik")+"&";
  fa_xmlhttprequest_xml(_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi) {
    var vl_c_donnees;
    vl_c_donnees="";
    vl_c_donnees+="vl_banque_cleunik="+fa_enc(vf_banque_cleunik)+"&";
    vl_c_donnees+="vl_code="+fa_enc(fa_value_get("tb_code"))+"&";
    vl_c_donnees+="vl_nom="+fa_enc(fa_value_get("tb_nom"))+"&";
    switch(vv_quoi) {
      case "enregistrer":
        if (vf_banque_cleunik!=-2)
          {vl_c_donnees+="vf_c_action=modifier&";}
        else
          {vl_c_donnees+="vf_c_action=ajouter&";}
        break;
      case "supprimer":
          if(confirm("Confirmez-vous la suppression de cette banque ?")==false) return;
          vl_c_donnees+="vf_c_action=supprimer&";
        break;
    }
    fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
