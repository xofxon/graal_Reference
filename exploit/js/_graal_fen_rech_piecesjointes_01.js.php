<?php
switch ($vl_c_type) {
  case "select":
    $vf_c_code01='fa_att_set("tarbre_pj","seltype","multiple");';
    $vf_c_code02='fa_att_set("tarbre_pj","context","pop_selections")';
    break;
  case "recenv":
  case "rectou":
  case "recrec":
  case "recfav":
    $vf_c_code01='fa_att_set("tarbre_pj","seltype","single");';
    $vf_c_code02='fa_att_set("tarbre_pj","context","pop_selections")';
    break;
}
echo <<<END
<script type="application/x-javascript"><![CDATA[
var vf_c_url_alimente_table;
const c_rdf_pj="_graal_das_piecesjointes_01.php?vl_c_nature=$vl_c_type&";
const c_script_bdope_fen="_graal_bdope_ged_favoris_01.php?"
const c_script_downl_pj="_graal_tel_doc_03.php?vl_e_doc_cleunik=";
const c_script_action="_graal_fen_actions_01.php?genreaction=avecpj&visu=oui&vl_e_doc_cleunik=";
const c_script_favoris_partage='_graal_fen_favoris_partage_01.php?vf_c_type_favori=2&';

function pf_aa_init() {
  $vf_c_code01
  $vf_c_code02
  pf_approximatif();
  fa_ael('tb_limit','input',pf_approximatif);
}
function pf_approximatif() {
  var vl_c_rdf=c_rdf_pj+'vl_c_recherche='+fa_enc(fa_value_get("tb_rechapproxima"))+'&raf_random='+Math.random();
  vl_c_rdf+="&vl_c_type="+fa_value_get("boh_ml_qui");
  fa_das("tarbre_pj",vl_c_rdf);
}
function pf_change_menu() {
  var vo_list = document.getElementById("boh_ml_qui");
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
}
function pf_etat_fen(vv_quoi){
  switch (vv_quoi) {
    case 'sortir' :
      close();
      break;
    case 'renvoyer' :
      var vl_t_tableau=[];
      var vl_e_nb_sel;
      vl_t_tableau=fa_lignes_selectionnees("tarbre_pj");
      vl_e_nb_sel=vl_t_tableau.length;
      if (vl_e_nb_sel!=0) {
        var vl_t_doc_cleunik=[];
        var vl_t_courriel_pj_nom=[];
        for(i=0;i<vl_e_nb_sel;i++) {
          vl_t_doc_cleunik[i]=fa_cell_get("tarbre_pj",vl_t_tableau[i],"doc_cleunik");
          vl_t_courriel_pj_nom[i]=fa_cell_get("tarbre_pj",vl_t_tableau[i],"nom");
        }
        if (window.opener!=null) {
          try {
            window.opener.pf_retour_fenetre_pj(vl_t_doc_cleunik,vl_t_courriel_pj_nom);
            close();
          } catch(e) {
             //alert(e)
          }
        }
      }
  }
}
function pf_favoris_partager() {
  var rowIndex=fa_cui("tarbre_pj");if(rowIndex == -1){return;}
  var vl_c_param;
  vl_c_param="vf_e_cleunik="+fa_cell_get("tarbre_pj",rowIndex,"doc_cleunik")+"&";
  vl_c_param+="raf_random="+Math.random()+"&";
  fa_ouvre(c_script_favoris_partage+vl_c_param,500,60);
}
function pf_onunload(){
	fa_gid("tb_limit").removeEventListener("input",pf_approximatif, false);
}
function pf_sel_ligne(vv_qui) {}
function pf_telecharge_pj(){
  var rowIndex=fa_cui("tarbre_pj");if(rowIndex == -1){return;}
  fa_ouvre(c_script_downl_pj+fa_cell_get("tarbre_pj",rowIndex,"doc_cleunik"),400,400);
}
END;
switch ($vl_c_type) {
  case "select":
    break;
  case "recenv":
  case "rectou":
  case "recrec":
echo <<<END
function pf_ajout_favoris() {
  var rowIndex = fa_cui("tarbre_pj");if(rowIndex == -1){return;}
  var s="vf_c_action=ajouter&vl_doc_cleunik="+fa_cell_get("tarbre_pj",rowIndex,"doc_cleunik");
  fa_xmlhttprequest_txt(c_script_bdope_fen,s,pf_ajout_favoris_fin);
}
function pf_ajout_favoris_fin(vv_stream) {
  alert(vv_stream);
}
END;
  break;
  case "recfav":
echo <<<END
function pf_enleve_favoris() {
  var rowIndex = fa_cui("tarbre_pj");if(rowIndex == -1){return;}
  var s="vf_c_action=supprimer&vl_doc_cleunik="+fa_cell_get("tarbre_pj",rowIndex,"doc_cleunik");
  fa_xmlhttprequest_txt(c_script_bdope_fen,s,pf_enleve_favoris_fin);
}
function pf_enleve_favoris_fin(vv_stream) {
  alert(vv_stream);
  pf_approximatif();
}
END;
    break;
}
echo <<<END
function pf_voir_actions() {
  var rowIndex = fa_cui("tarbre_pj");if(rowIndex == -1){return;}
  var s=fa_cell_get("tarbre_pj",rowIndex,"doc_cleunik");
  fa_ouvre(c_script_action+s,1000,600);
}
]]></script>
END;
?>
