<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const vf_c_script_bdope_fen="_graal_bdope_art_dep_emp_01.php";
const vf_c_script_xml_dep_emp='_graal_xml_art_dep_emp_01.php';
var vf_c_action;
const vf_e_art_depemp_cleunik="$vl_e_art_depemp_cleunik",vf_e_art_cleunik="$vl_e_art_cleunik";
function pf_aa_init(){
  fa_sep("tb_qte_stock");
  fa_sep("tb_qte_inven");
  switch (vf_e_art_depemp_cleunik) {
    case "-1":  //  création
      pf_etat_fen("ajouter");
      break;
    default:
      pf_etat_fen("ini");
      pf_selectionne_dep_emp();
      break    
  }
}
function pf_affiche_datas(stream){
	var vl_c_datas = stream;
	var vl_e_depot,vl_e_empla;
	fa_value_set('tb_qte_stock',fa_xml_get(vl_c_datas,'qte_stock'));
	fa_value_set('tb_qte_inven',fa_xml_get(vl_c_datas,'qte_inven'));
	fa_value_set('tb_dateheure_inven',fa_xml_get(vl_c_datas,'dateheure_inven'));
	fa_mlsel("ml_depot",fa_xml_get(vl_c_datas,'choix_depot'));
	fa_mlsel("ml_empla",fa_xml_get(vl_c_datas,'choix_empla'));
}
function pf_alimente_defaut(){
	fa_value_set('tb_qte_stock',"");
	fa_value_set('tb_qte_inven',"");
	fa_value_set('tb_dateheure_inven',"");
	fa_gid("ml_depot").selectedIndex=0;
	fa_gid("ml_empla").selectedIndex=0;
}
function pf_etat_fen(vv_quoi)  {
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "ini":
      fa_grise_non("bt_modifier");
      fa_grise_non("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_annuler");
      fa_grise_non("bt_sortir");
      break;
    case "modifier":
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      fa_focusdonne("ml_depot");
      break;
    case "ajouter":
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_modifier");
      fa_grise_non("bt_sortir");
      fa_grise_non("bt_annuler");
      fa_grise_non("bt_enregistrer");
      pf_raz_fiche();
      pf_alimente_defaut();
      fa_focusdonne("ml_depot");
      break;
    case "annuler":
      fa_grise_oui("bt_modifier");
      fa_grise_oui("bt_annuler");
      fa_grise_oui("bt_supprimer");
      fa_grise_oui("bt_enregistrer");
      fa_grise_non("bt_sortir");
      switch (vf_e_art_depemp_cleunik)
      {
        case "-1":  //  création
          pf_etat_fen("ajouter");
          break;
        default:
          pf_etat_fen("ini");
          pf_selectionne_dep_emp();
          break    
      }
      break;
    case "sortir":
      window.close();
      break;
    default:
      break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  window.opener.pf_affiche_donnees_dep_emp();
  if (vl_datas!="-1") {
      switch (vf_c_action){
        case "ajouter":
          alert("Dépôt/Emplacement ajouté.");
		  pf_etat_fen("annuler");
          break;
        case "modifier":
          alert("Dépôt/Emplacement modifié.");
		  pf_etat_fen("sortir");
          break;
        case "supprimer":
          alert("Dépôt/Emplacement supprimé.");
          pf_etat_fen("sortir");
          break;
      }
    }
  else
    {
    alert(vl_datas);
    pf_etat_fen("annuler");
    }
}
function pf_raz_fiche(){
	fa_value_set('tb_qte_stock',"");
	fa_value_set('tb_qte_inven',"");
	fa_value_set('tb_dateheure_inven',"");
}
function pf_selectionne_dep_emp(){
  var vl_c_param;
  var raf_random=Math.random();
  vl_c_param="";
  vl_c_param+="vl_e_art_depemp_cleunik="+vf_e_art_depemp_cleunik+"&";
  vl_c_param+="raf_random="+raf_random+"&";
  fa_xmlhttprequest_xml(vf_c_script_xml_dep_emp,vl_c_param,pf_affiche_datas);
}
function pf_validation(vv_quoi){
  var vl_c_donnees;
  vl_c_donnees="";
  vl_c_donnees+="vl_art_depemp_cleunik="+vf_e_art_depemp_cleunik+"&";
  vl_c_donnees+="vl_art_cleunik="+vf_e_art_cleunik+"&";
  vl_c_donnees+="vl_choix_depot="+fa_mlget("ml_depot")+"&";
  vl_c_donnees+="vl_choix_empla="+fa_mlget("ml_empla")+"&";
  switch(vv_quoi)
  {
    case "enregistrer":
      if (vf_e_art_depemp_cleunik!=-1){
        	vl_c_donnees+="vf_c_action=modifier&";
			vf_c_action="modifier";
		} else {
			vl_c_donnees+="vf_c_action=ajouter&";
			vf_c_action="ajouter";
		}
      break;
    case "supprimer":
        Check = confirm("Confirmez-vous la suppression de ce couple dépot/emplacement, pour cet article ?");
        if(Check == false) return;
        vl_c_donnees+="vf_c_action=supprimer&";
		vf_c_action="supprimer";
      break;
  }
  fa_xmlhttprequest_txt(vf_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
