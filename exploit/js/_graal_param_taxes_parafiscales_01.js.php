<?php
echo <<<END
<script type="application/x-javascript"><![CDATA[
const _c_url_alimente_table_01="_graal_das_param_taxes_parafiscales_01.php";
const _c_script_edite="_graal_xml_param_taxes_parafiscales_01.php";
const _c_script_bdope_fen="_graal_bdope_param_taxes_parafiscales_01.php";
const c_script_pc="_graal_fen_rech_param_pc_01.php?";
const c_script_taxe="_graal_fen_rech_param_taxes_01.php?";
var vf_c_action="",vf_tpf_cleunik=-2;
function pf_affiche_datas(stream){
  var vl_c_datas=stream;
  fa_value_set("tb_code",fa_xml_get(vl_c_datas,"code"));
  fa_value_set("tb_denomination",fa_xml_get(vl_c_datas,"denomination"));
  fa_value_set("tb_valeur_base",fa_xml_get(vl_c_datas,"valeur_base"));
  fa_value_set("tb_compte_vente",fa_xml_get(vl_c_datas,"compte_vente"));
  fa_value_set("tb_compte_achat",fa_xml_get(vl_c_datas,"compte_achat"));
  fa_value_set("tb_dateheuremodification",fa_xml_get(vl_c_datas,"dateheuremodification"));
  fa_value_set("tb_dateheurecreation",fa_xml_get(vl_c_datas,"dateheurecreation"));
  fa_value_set("rdg_compte_actif",fa_xml_get(vl_c_datas,"actif"));
  vf_e_utilisations=fa_xml_get(vl_c_datas,"utilisations");
  vf_tpf_cleunik=fa_xml_get(vl_c_datas,"tpf_cleunik");
  fa_value_set("tb_code_vente",fa_xml_get(vl_c_datas,"code_vente"));
  fa_att_set("tb_code_vente","compte_vente",fa_xml_get(vl_c_datas,'compte_vente'));
  fa_value_set("tb_intitule_vente",fa_xml_get(vl_c_datas,"intitule_vente"));
  fa_value_set("tb_code_achat",fa_xml_get(vl_c_datas,"code_achat"));
  fa_att_set("tb_code_achat","compte_achat",fa_xml_get(vl_c_datas,'compte_achat'));
  fa_value_set("tb_intitule_achat",fa_xml_get(vl_c_datas,"intitule_achat"));
  fa_value_set("ml_base",fa_xml_get(vl_c_datas,"base"));
  fa_value_set("tb_code_taxes",fa_xml_get(vl_c_datas,"code_tva"));
  fa_att_set("tb_code_taxes","compte_taxes",fa_xml_get(vl_c_datas,'taxes_cleunik'));
  fa_value_set("tb_intitule_taxes",fa_xml_get(vl_c_datas,"intitule_tva"));
}
function pf_aa_init(){
  fa_grise_oui("bt_supprimer");
  fa_grise_oui("bt_modifier");
  fa_grise_oui("bt_enregistrer");
  fa_grise_oui("bt_annuler");
  fa_grise_groupe_oui("broadcaster_01");
  pf_raz_fiche();
  pf_alimente_table("arbre_taxes");
}
function pf_alimente_defaut(){
  vf_tpf_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_denomination","");
  fa_value_set("tb_taux","");
  fa_value_set("tb_code_vente","");
  fa_value_set("tb_code_achat","");
  fa_value_set("tb_intitule_vente","");
  fa_value_set("tb_intitule_achat","");
  fa_value_set("tb_dateheuremodification","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("rdg_compte_actif",1);
}
function pf_alimente_table(vv_qui){
  fa_das(vv_qui,_c_url_alimente_table_01+"?raf="+Math.random());
}
function pf_etat_fen(vv_quoi){
  vf_c_action=vv_quoi;
  switch(vv_quoi) {
    case "selectionner":
      var i=fa_cui("arbre_taxes");if(i==-1){return;}
      if (vf_e_utilisations==0 && vf_tpf_cleunik>0) {fa_grise_non("bt_supprimer");} else {fa_grise_oui("bt_supprimer");}
      fa_grise_non("bt_modifier");
      fa_grise_oui("bt_enregistrer");
      fa_grise_oui("bt_ajouter");
      fa_grise_oui("bt_detailler");
      fa_grise_oui("bt_sortir");
      fa_grise_non("bt_annuler");
      break;
    case "modifier":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    fa_focusdonne("tb_code")
    break;
    case "ajouter":
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_ajouter");
    fa_grise_oui("bt_detailler");
    fa_grise_oui("bt_sortir");
    fa_grise_non("bt_annuler");
    fa_grise_non("bt_enregistrer");
    fa_grise_groupe_non("broadcaster_01");
    pf_raz_fiche();
    pf_alimente_defaut();
    fa_focusdonne("tb_code")
    break;
    case "annuler":
    fa_grise_oui("bt_modifier");
    fa_grise_oui("bt_annuler");
    fa_grise_oui("bt_supprimer");
    fa_grise_oui("bt_enregistrer");
    fa_grise_non("bt_sortir");
    fa_grise_non("bt_ajouter");
    fa_grise_non("bt_detailler");
    fa_grise_groupe_oui("broadcaster_01");
    pf_raz_fiche();
    break;
    case "sortir":
    window.close();
    break;
    default:
    break;
  }
  }
function pf_fin_requete(stream){
  var vl_datas = stream;
  if (vl_datas=="ok") {pf_alimente_table("arbre_taxes");} else {alert(vl_datas)}
  pf_etat_fen("annuler");
}
function pf_ouvre(vv_quoi) {
  switch (vv_quoi) {
    case "pc_tva_vente":
      fa_ouvre(c_script_pc+"vl_c_quellerecherche=pc_tva_vente&",600,350);
      break;
    case "pc_tva_achat":
      fa_ouvre(c_script_pc+"vl_c_quellerecherche=pc_tva_achat&",600,350);
      break;
	case "pc_tva":
      fa_ouvre(c_script_taxe+"vl_c_quellerecherche=taxe&",600,350);
      break;
  }
}
function pf_raz_fiche(){
  vf_tpf_cleunik=-2;
  fa_value_set("tb_code","");
  fa_value_set("tb_denomination","");
  fa_value_set("tb_taux","");
  fa_value_set("tb_code_vente","");
  fa_value_set("tb_code_achat","");
  fa_value_set("tb_intitule_vente","");
  fa_value_set("tb_intitule_achat","");
  fa_value_set("tb_dateheuremodification","");
  fa_value_set("tb_dateheurecreation","");
  fa_value_set("rdg_compte_actif",1);
}
function pf_retour_param_pc(vl_e_pc_cleunik,vl_c_code,vl_c_intitule,vv_quoi) {
  switch (vv_quoi) {
    case "pc_tva_vente":
      fa_value_set("tb_code_vente",vl_c_code);
      fa_att_set("tb_code_vente","compte_vente",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_vente",vl_c_intitule);
      break;
    case "pc_tva_achat":
      fa_value_set("tb_code_achat",vl_c_code);
      fa_att_set("tb_code_achat","compte_achat",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_achat",vl_c_intitule);
      break;
    case "taxe":
      fa_value_set("tb_code_taxes",vl_c_code);
      fa_att_set("tb_code_taxes","compte_taxes_",vl_e_pc_cleunik);
      fa_value_set("tb_intitule_taxes",vl_c_intitule);
      break;
  }
}
function pf_sel_ligne(vv_qui){
  if(fa_est_grise("bt_detailler")==true){return}
  var i=fa_cui(vv_qui);if(i==-1){return;}
  var s ="tpf_cleunik="+fa_cell_get(vv_qui,i,"tc_tpf_cleunik")+"&";
  fa_xmlhttprequest_xml(_c_script_edite,s,pf_affiche_datas);
}
function pf_validation(vv_quoi) {
    var vl_c_donnees;
    vl_c_donnees="";
    vl_c_donnees+="vl_tpf_cleunik="+fa_enc(vf_tpf_cleunik)+"&";
    vl_c_donnees+="vl_code="+fa_enc(fa_value_get("tb_code"))+"&";
    vl_c_donnees+="vl_denomination="+fa_enc(fa_value_get("tb_denomination"))+"&";
    vl_c_donnees+="vl_valeur_base="+fa_enc(fa_value_get("tb_valeur_base"))+"&";
    vl_c_donnees+="vl_base="+fa_enc(fa_value_get("ml_base"))+"&";
    vl_c_donnees+="vl_compte_vente="+fa_enc(fa_att_get("tb_code_vente","compte_vente"))+"&";
    vl_c_donnees+="vl_compte_achat="+fa_enc(fa_att_get("tb_code_achat","compte_achat"))+"&";
    vl_c_donnees+="vl_compte_taxe="+fa_enc(fa_att_get("tb_code_taxes","compte_taxes"))+"&";
    vl_c_donnees+="vl_actif="+fa_enc(fa_value_get("rdg_compte_actif"))+"&";
    switch(vv_quoi) {
      case "enregistrer":
        if (vf_tpf_cleunik!=-2)
          {vl_c_donnees+="vf_c_action=modifier&";}
        else
          {vl_c_donnees+="vf_c_action=ajouter&";}
        break;
      case "supprimer":
          if(confirm("Confirmez-vous la suppression de cette taxe parafiscale ?")==false) return;
          vl_c_donnees+="vf_c_action=supprimer&";
        break;
    }
    fa_xmlhttprequest_txt(_c_script_bdope_fen,vl_c_donnees,pf_fin_requete);
}
]]></script>
END;
?>
