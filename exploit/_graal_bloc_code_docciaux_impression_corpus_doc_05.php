<?php
	while ($row = mysql_fetch_assoc($result)) {
    $Quantité=$row['qte'];
    //  L'arrondi ne fonctionne pas dans la requête (8/7/2008)
    $Quantité=round($row['qte'],$row['qte_nbdec']);
    $Code=$row['code_interne'];
    $Désignation=$row['description_interne'];
    $pu=$row['pu'];
    $nbdec_pu=$row['nbdec_pu'];
    $pu_arrondi=fa_reel($pu,$nbdec_pu);
    $htbrutremise=$row['htbrutremise'];
    $htbrutremise_arrondi=fa_reel($htbrutremise,$nbdec_pu);
    $blocnotebrut=trim($row['blocnotebrut']);
    if ($blocnotebrut!="") {
      $Désignation.=EOL.$blocnotebrut;
    }
    $taxe=trim($row['code']);
		$code_acteur=$row['code_acteur'];
		$description_acteur=$row['description_acteur'];
  switch ($nombre_taxes) {
    case 1:
      switch ($nb_remises_lignes) {
        case 0:
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
					if ($Quantité==0) {$Quantité="";}
          $line = array("Code"=>$Code,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Montant"=>$htbrutremise_arrondi);
					$line_acteur = array("Code"=>"(".$code_acteur.")","Quantité"=>"","Désignation"=>"(".$description_acteur.")","PU"=>"","Montant"=>"");
          break;
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
					if ($Quantité==0) {$Quantité="";}
					//if ($remise==0) {$remise="";}
          $line = array("Code"=>$Code,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Remise"=>$remise,"Montant"=>$htbrutremise_arrondi);
					$line_acteur = array("Code"=>"(".$code_acteur.")","Quantité"=>"","Désignation"=>"(".$description_acteur.")","PU"=>"","Remise"=>"","Montant"=>"");
          break;
      }
      break;
    default:
      switch ($nb_remises_lignes) {
        case 0:
          $line = array("Code"=>$Code,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Montant"=>$htbrutremise_arrondi,"T"=>$taxe);
					$line_acteur = array("Code"=>"(".$code_acteur.")","Quantité"=>"","Désignation"=>"(".$description_acteur.")","PU"=>"","Montant"=>"","T"=>"");
          break;
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
					if ($Quantité==0) {$Quantité="";}
					//if ($remise==0) {$remise="";}
          $line = array("Code"=>$Code,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Remise"=>$remise,"Montant"=>$htbrutremise_arrondi,"T"=>$taxe);
					$line_acteur = array("Code"=>"(".$code_acteur.")","Quantité"=>"","Désignation"=>"(".$description_acteur.")","PU"=>"","Remise"=>"","Montant"=>"","T"=>"");
          break;
      }
      break;
    }
		if (trim($code_acteur.$description_acteur)!="") {
			$pdf->_graal_pf_imprime_ligne($line_acteur,$y,$cols,$format,$fonts_acteur,$type,$position_pied);
    }
		$pdf->_graal_pf_imprime_ligne($line,$y,$cols,$format,$fonts,$type,$position_pied);
  }
?>