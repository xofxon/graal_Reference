<?php
define('EOL', "\r\n");
require("_graal_fonctions_diverses.php");
require("_graal_fonctions_mysql.php");
include("_graal_fonctions_documents.php");
$vl_e_doc_cleunik=intval(fa_recup_param('vl_e_doc_cleunik','0'));
if (fa_verif_droit($vl_e_doc_cleunik)==false) {fa_redirige("document_interdit");}
$sql_req = "SELECT _documents.document AS document, _documents.emplacement AS emplacement,_documents.mime as mime FROM _documents WHERE _documents.doc_cleunik=$vl_e_doc_cleunik;";
$vl_e_critere_cleunik=0;
$result = _graal_requete_bd($sql_req);
//  On n'est censÃ© n'en avoir qu'un !!!
//echo('<requete01 data="'.$sql_req.'"/>');
$row = mysql_fetch_assoc($result);
header("Content-disposition: attachment; filename=\"".basename($row['emplacement'])."\"");
$vl_c_content_type_defaut="application/force-download";
if ($row['mime']!="") {$vl_c_content_type_defaut=$row['mime'];}
header("Content-Type: $vl_c_content_type_defaut");
echo $row['document'];
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
