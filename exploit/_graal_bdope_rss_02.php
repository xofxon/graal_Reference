<?php
/* les informations de header  et toutes les variables sont décrites dans le fichier _graal_rss_pseudoliens_01.php*/
$vl_e_uti_cleunik =0; //  Entreprise
$vf_c_echo='';
$typedoc=7;
/*
le 29 septembre 2010
  typedoc    1 -> Liens,
             2 -> Notes,
             3 -> Documents,
             4 -> Dossier,
             5 -> courriels envoyés,
             6 -> modèles de courriels texte,
             7 -> Flux RSS,
             8 -> requêtes personnelles,
             9 -> images des articles, logos de l'entreprise
            10 -> modèles de courriels HTML,
            11 -> modèles de notes,
            12 -> modèles de notification de lecture,
            13 -> pièces jointes,
            14 -> menus arbres personalisés
            15 -> menus pages personalisés
           101 -> modèles textes entêtes offres clients,
           102 -> modèles textes pied offres clients,
           111 -> modèles textes entêtes commandes clients,
           112 -> modèles textes pied commandes clients,
           121 -> modèles textes entêtes livraison clients,
           122 -> modèles textes pied livraison clients,
           131 -> modèles textes entêtes facture clients,
           132 -> modèles textes pied facture clients,
           141 -> modèles textes entêtes demandes fournisseur,
           142 -> modèles textes pied demandes fournisseur,
           151 -> modèles textes entêtes commandes fournisseur,
           152 -> modèles textes pied commandes fournisseur,
           153 -> modèles formulaires de fiches palettes,
           154 -> fichiers pdf de filigranne de documents,
           900 -> Conditions générales de vente
           901 -> Bloc de désinscription pour emailing html
           902 -> Bloc de désinscription pour emailing texte
           903 -> Bloc de sondage pour emailing html
           904 -> Bloc de sondage pour emailing texte
*/
$droits_proprio=15;
$droits_groupe=0;
$droits_lambda=0;
$sql_req = "select count(*) FROM _documents WHERE emplacement = '$vl_c_chemincomplet' and typedoc=$typedoc";
$vl_e_nombre_doc=0;
if ($res = _graal_requete_bd($sql_req)){
  $ligne = mysql_fetch_row($res);
  $vl_e_nombre_doc=$ligne[0];
 }
 if ($vl_e_nombre_doc==0) {//  N'existe pas -> on ajoute
  $vf_e_doc_cleunik=_graal_requete_max("doc_cleunik","_documents");
  $sql_req = "INSERT INTO _documents set doc_cleunik=$vf_e_doc_cleunik,typedoc=$typedoc,emplacement= '$vl_c_chemincomplet',titre='$vl_c_intitule',dateheurecreation = now(),descriptif_sommaire = '$vl_c_intitule'";
  $res = _graal_requete_bd($sql_req);
  $sql_req = "INSERT INTO _documents_rattachement set doc_cleunik=$vf_e_doc_cleunik,rat_cleunik=$vl_e_uti_cleunik,portee=$vl_e_utilis;";
  $vf_c_echo=_graal_exec_requete($sql_req);
  if($res === false) {echo 'Erreur';}
  else {
    $sql_req = "INSERT INTO _droits_doc set doc_cleunik=$vf_e_doc_cleunik,uti_cleunik=$vl_e_uti_cleunik,droits_proprio=$droits_proprio,droits_groupe=$droits_groupe,droits_lambda=$droits_lambda";
    $vf_c_echo=_graal_exec_requete($sql_req);
  }
}

?>
