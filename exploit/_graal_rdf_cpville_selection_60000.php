<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$recherche=fa_recup_param('recherche','');
$sql_req="select concat_ws(_utf8'',choix_code,_utf8' ',choix_valeur_texte_01) as cp_ville,choix_code,choix_valeur_texte_01,choix_cleunik from _vue_cp_ville_france where recherche like'%$recherche%' LIMIT 50;";
$result = _graal_requete_bd($sql_req);
//echo $sql_req;
echo <<<END
<?xml version="1.0" encoding="UTF-8"?>
<RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:NC="http://home.netscape.com/NC-rdf#" xmlns:KEY="urn:suggest:rdf#">
<RDF:Seq RDF:about="urn:suggest:values">
END;
$vl_e_nombre_enr=mysql_num_rows($result);
if ($vl_e_nombre_enr!=0) { 
  while ($row = mysql_fetch_assoc($result)){
    echo('<RDF:li><RDF:Description KEY:label="'.fa_ent_xml($row['cp_ville']).'" KEY:issuggest="'.fa_ent_xml($row['choix_cleunik']).'" KEY:prop=""/></RDF:li>'.EOL);
  }    
echo <<<END
  </RDF:Seq>
  <RDF:Seq RDF:about="urn:suggest:nb">
    <RDF:li><RDF:Description RDF:number="$vl_e_nombre_enr"/></RDF:li>
  </RDF:Seq>
END;
} else {
echo <<<END
  </RDF:Seq>
  <RDF:Seq RDF:about="urn:suggest:nb">
    <RDF:li><RDF:Description RDF:number="$vl_e_nombre_enr"/></RDF:li>
  </RDF:Seq>
END;
}
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
?>
