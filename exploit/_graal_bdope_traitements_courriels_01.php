<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_traitements_courriel_01";
fa_acces_script();
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_t_intweb_cleunik=fa_recup_param("vl_t_intweb_cleunik","");
$vl_e_veutpasmail=intval(fa_recup_param('vl_e_veutpasmail','0'));
$vl_e_valide=intval(fa_recup_param('vl_e_valide','0'));
$vl_t_intweb_cleunik=unserialize(stripslashes($vl_t_intweb_cleunik));
$vl_b_transaction_ok=true;
$vl_e_i=-1;
$sql_condition="";
foreach($vl_t_intweb_cleunik as $vl_raf) {
  $vl_e_i++;
  $vl_intweb_cleunik=$vl_t_intweb_cleunik[$vl_e_i];
  if ($vl_e_i==0) {$sql_condition.= "$vl_intweb_cleunik";} else {$sql_condition.= ",$vl_intweb_cleunik";};
}
switch (TRUE){
  case $vf_c_action=="kilometre_veutpasmail";
    $sql_req = "UPDATE _act_interlo_mail SET veuxpasdemail=$vl_e_veutpasmail WHERE intweb_cleunik in($sql_condition);";    
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'La modification des courriels a échoué.'.$vl_c_mess_err;} else {echo 'La modification des courriels a été correctement effectuée.';}
    break;
  case $vf_c_action=="kilometre_validite";
    $sql_req = "UPDATE _act_interlo_mail SET valide=$vl_e_valide WHERE intweb_cleunik in($sql_condition);";    
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'La modification des courriels a échoué.'.$vl_c_mess_err;} else {echo 'La modification des courriels a été correctement effectuée.';}
    break;
  case $vf_c_action=="kilometre_bascule_interlo";
    $sql_req = "UPDATE _act_interlo_mail SET int_cleunik=$vl_e_valide WHERE intweb_cleunik in($sql_condition);";    
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'La bascule des courriels a échoué.'.$vl_c_mess_err;} else {echo 'La bascule des courriels a été correctement effectuée.';}
    break;

  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
?>
