<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_e_act_cleunik=intval(fa_recup_param("vl_e_act_cleunik","-1"));
$vl_e_art_cleunik=intval(fa_recup_param("vl_e_art_cleunik","-1"));
$vl_e_art_acteur_cleunik=intval(fa_recup_param("vl_e_art_acteur_cleunik","0"));
$vl_e_type=intval(fa_recup_param("vl_e_type",""));
$vl_c_genre=fa_recup_param("vl_c_genre","article");
switch ($vl_e_type) {
  case 110004:  // fournisseur
    $vl_c_id_fenetre="Fen_00245";$vl_c_id_inc_acteurs_selection_01="Div_00045";$vl_c_id_inc_acteurs_01="Div_00037";$vl_c_id_inc_articles_fournis="Div_00220";$vl_c_barre_presente_articles_fournis="pasok";
		break;
  case 110003:  // clients
    $vl_c_id_fenetre="Fen_00479";$vl_c_id_inc_acteurs_selection_01="Div_00044";$vl_c_id_inc_acteurs_01="Div_00032";$vl_c_id_article_ventes="Div_00318";$vl_c_barre_presente_articles_client="pasok";$vl_c_id_fen_artcli="Fen_00245";
		break;
  case 110002:  // prospects fournisseur
    $vl_c_id_fenetre="Fen_00739";$vl_c_id_inc_acteurs_selection_01="Div_00043";$vl_c_id_inc_acteurs_01="Div_00036";$vl_c_id_inc_articles_fournis="Div_00541";$vl_c_barre_presente_articles_fournis="pasok";
		break;
  case 110001:  // prospects clients
    $vl_c_id_fenetre="Fen_00740";$vl_c_id_inc_acteurs_selection_01="Div_00042";$vl_c_id_inc_acteurs_01="Div_00035";$vl_c_id_article_ventes="Div_00542";$vl_c_barre_presente_articles_fournis="pasok";
		break;

  default:fa_redirige("acces_interdit");break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bbu_100=fa_recup_dico("bbu_100");
$vl_c_bbu_101=fa_recup_dico("bbu_101");
$vl_c_bbu_102=fa_recup_dico("bbu_102");
$vl_c_bbu_103=fa_recup_dico("bbu_103");
$vl_c_bbu_104=fa_recup_dico("bbu_104");
$vl_c_bbu_105=fa_recup_dico("bbu_105");
$vl_c_bbu_106=fa_recup_dico("bbu_106");
$vl_c_bbu_107=fa_recup_dico("bbu_107");
$vl_c_bbu_108=fa_recup_dico("bbu_108");
$vl_c_bbu_109=fa_recup_dico("bbu_109");
$vl_c_bbu_110=fa_recup_dico("bbu_110");
$vl_c_bbu_111=fa_recup_dico("bbu_111");
$vl_c_bbu_112=fa_recup_dico("bbu_112");
$vl_c_bbu_113=fa_recup_dico("bbu_113");
$vl_c_bbu_114=fa_recup_dico("bbu_114");$vl_c_bbu_114="UnitÃ© d'achat";
$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_dico_00010=fa_recup_dico('dico_00010');
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00106=fa_recup_dico('dico_00106');
$vl_c_dico_00149=fa_recup_dico('dico_00149');
if ($vl_e_art_acteur_cleunik==0) {$vl_c_action=fa_recup_dico('dico_00002');} else {$vl_c_action=fa_recup_dico('dico_00003');} 
//  On recherche les informations sur l'acteur 
if ($vl_e_act_cleunik!=-1){$vl_c_acteur=_graal_requete_acteur($vl_e_act_cleunik);}
//  On recherche les informations sur l'article 
if ($vl_e_art_cleunik!=-1){
  $ret=_graal_requete_article($vl_e_art_cleunik);
  $vl_c_code=$ret[0];
  $vl_c_mnemotechnique=$ret[1];
  $vl_c_description=$ret[2]; 
}
$ml_unite_reappro=fa_brik_menulist_choix(119,1,-1,-1,'','ml_unite_reappro',"broadcaster_01",0);
$ml_unite_achat=fa_brik_menulist_choix(110,1,-1,-1,'','ml_unite_achat',"broadcaster_01",0);
$vl_c_id_inc_acteurs_recherche="Div_00205";
$vl_c_inactif_acteurs_recherche='false';
$vl_c_qui_acteurs_recherche='06';
$vl_c_id_article_recherche='Div_00208';
$vl_c_type_article_recherche="1";
switch ($vl_e_type) {
  case 110004:  // fournisseur
  case 110002:  // prospect fournisseur
    $vl_tc_composants=array($vl_c_id_inc_acteurs_selection_01,$vl_c_id_inc_acteurs_recherche,$vl_c_id_article_recherche,$vl_c_id_inc_articles_fournis);break;
  case 110003:  // clients
  case 110001:  // prospect clients
    $vl_tc_composants=array($vl_c_id_inc_acteurs_selection_01,$vl_c_id_inc_acteurs_recherche,$vl_c_id_article_recherche,$vl_c_id_article_ventes);break;
}
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" title="$vl_c_bbu_100" id="_win_fen_art_acteurs" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include("js/_graal_art_acteurs_01.js.php");
include_once("js/_graal_01.js.php");
if ($vl_e_act_cleunik==-1){
  $vl_c_infos_adresses="true";$vl_c_infos_sitesweb="true";
  include("_graal_inc_acteurs_selection_01.php");
  $vl_c_id_vbox_inc_acteurs_01='aai_acteurs_01';
  $vl_c_id_arbre_inc_acteurs_01='arbre_des_acteurs';
  $vl_c_menucontext_01="pop_acteurs";
  	$vl_c_menucontext_arbre=<<<EOT
		<popupset>
			<popup id="pop_acteurs">
				<menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','$vl_c_id_arbre_inc_acteurs_01');" />
			</popup>
		</popupset>
EOT;
	echo($vl_c_menucontext_arbre);
  include("_graal_inc_acteurs_01.php");
}
if ($vl_e_art_cleunik==-1){
echo('<vbox flex="2">');
include("js/_graal_articles_selection_01.js.php");
include("_graal_inc_articles_recherche_01.php");
$vl_c_id_vbox_inc_article_01='arbre_articles_01';
$vl_c_id_arbre_inc_article_01='arbre_des_articles';
include("_graal_inc_articles_recherche_01_bis.php");
echo('</vbox>');
}
if ($vl_e_act_cleunik==-1 || $vl_e_art_cleunik==-1) {echo ("<splitter />");}
echo <<<END
  <vbox flex="1">
  <groupbox id="groupe_acteur" >
    <caption><label value="$vl_c_bbu_101"/></caption>
    <textbox id="tb_acteur" value="$vl_c_acteur" disabled="true"/>
  </groupbox>
  <groupbox id="groupe_article">
    <caption><label value="$vl_c_bbu_102"/></caption>
    <hbox>
      <label value="$vl_c_bbu_103" />
      <textbox id="tb_code_art" value="$vl_c_code" disabled="true" />
      <label value="$vl_c_bbu_104" />
      <textbox id="tb_code_mnemotechnique" value="$vl_c_mnemotechnique" disabled="true" />
      <label value="$vl_c_bbu_105" />
      <textbox flex="2" id="tb_code_description" value="$vl_c_description" disabled="true" />
    </hbox>
  </groupbox>
  <groupbox >
    <caption><label value="$vl_c_bbu_106"/></caption>
    <hbox>
      <label control="la_code" value="$vl_c_bbu_107"/>
      <textbox flex="1" id="tb_code"  />
      <label control="la_description" value="$vl_c_bbu_108"/>
      <textbox flex="3" id="tb_description"  />
    </hbox>
    <hbox>
END;
  switch ($vl_e_type) {
    case 110004:  // fournisseur
    case 110002:  // prospect fournisseur
echo <<<END
      <label control="la_delai_reappro" value="$vl_c_bbu_109"/>
      <textbox flex="1" id="tb_delai_reappro" size="3"   />
      $ml_unite_reappro
      <label control="la_minimum_commande" value="$vl_c_bbu_113"/>
      <textbox flex="1" id="tb_minimum_commande" decimalplaces="2" type="number" hidespinbuttons="true"   />
      <label control="la_unite_achat" value="$vl_c_bbu_114"/>
      $ml_unite_achat
END;
      break;
    case 110003:  // clients
    case 110001:  // prospect clients
      break;
  }
echo <<<END
      <label control="la_dateheurevalidite" value="$vl_c_bbu_110"/>
      <hbox>
				<spacer flex="1"/>
				<datepicker type="popup" monthLeadingZero="true" dateLeadingZero="true" observes="broadcaster_01" id="dp_dateheurevalidite"/>
				<spacer flex="1"/>
			</hbox>                  
    </hbox> 
    <label control="la_blocnotebrut" value="$vl_c_bbu_112"/>
    <textbox flex="1" id="tb_blocnotebrut"   multiline="true"/>
   </groupbox>
  <hbox> 
    <button flex="1" id="bt_ajouter" label="$vl_c_action" crop="end" dir="normal" oncommand="pf_validation('enregistrer');" />
    <button flex="1" id="bt_sortir" label="$vl_c_dico_00007" crop="end" dir="normal" oncommand="pf_etat_fen('sortir');" />
    <button flex='1' id='bt_supprimer' label='$vl_c_dico_00004' crop='end' dir='normal' oncommand='pf_validation("supprimer");' />
    <button flex="1" id="bt_info_fen"  class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_win_id')" />
  </hbox>
END;
  switch ($vl_e_type) {
    case 110004:  // fournisseur
    case 110002:  // prospect fournisseur
      include("_graal_inc_articles_fournis_01.php");
      break;
    case 110003:  // clients
    case 110001:  // prospect clients
      include("_graal_inc_articles_client_01.php");
      break;
  }
echo <<<END
</vbox>
</window>
END;
?>
