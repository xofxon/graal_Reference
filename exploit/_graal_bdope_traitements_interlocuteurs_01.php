<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_rech_interlocuteurs_01";
$t_origines_ok[1]="_graal_traitements_interlocuteurs_01";
fa_acces_script();
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_t_interlocuteur=fa_recup_param("vl_t_interlocuteur","");
$vl_e_civilite=intval(fa_recup_param(vl_e_civilite,'0'));
$vl_t_interlocuteur=unserialize(stripslashes($vl_t_interlocuteur));
$vl_b_transaction_ok=true;
$vl_e_i=-1;
$sql_condition="";
foreach($vl_t_interlocuteur as $vl_raf) {
  $vl_e_i++;
  $vl_int_cleunik=$vl_t_interlocuteur[$vl_e_i];
  if ($vl_e_i==0) {$sql_condition.= "$vl_int_cleunik";} else {$sql_condition.= ",$vl_int_cleunik";};
}
switch (TRUE) {
  case $vf_c_action=="kilometres_activer";
    $sql_req = "UPDATE _act_interlo SET actif=1 WHERE int_cleunik in($sql_condition);";    
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'L\'activation des interlocuteurs a échoué.'.$vl_c_mess_err;} else {echo 'L\'activation des interlocuteurs a été correctement effectuée.';}
    break;
  case $vf_c_action=="kilometres_desactiver";
    $sql_req = "UPDATE _act_interlo SET actif=2 WHERE int_cleunik in($sql_condition);";
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'La désactivation des interlocuteurs a échoué.'.$vl_c_mess_err;} else {echo 'La désactivation des interlocuteurs a été correctement effectuée.';}
    break;
  case $vf_c_action=="kilometres_civilites";
    $sql_req = "UPDATE _act_interlo SET choix_cleunik=$vl_e_civilite WHERE int_cleunik in($sql_condition);";
    $vf_c_echo=_graal_exec_requete($sql_req);if($vf_c_echo!='ok') {$vl_b_transaction_ok=false;$vl_c_mess_err.="Erreur update ".$sql_req.EOL;}
    if ($vl_b_transaction_ok==false) {echo 'Le changement de civilité a échoué.'.$vl_c_mess_err;} else {echo 'Le changement de civilité a été correctement effectué.';}
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
?>
