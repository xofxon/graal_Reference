<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_portee=intval(fa_recup_param('portee','16'));
$vl_e_int_cleunik=intval(fa_recup_param('int_cleunik','10001770'));
$vl_c_genrecritere=fa_recup_param('genrecritere','');
switch ($vl_c_genrecritere) {
  case "entreprise": $vl_e_uti_cleunik=0;break;
  case "moi":$vl_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));break;
}
$vl_c_operateur_01="=";
$sql_req ="select critere_cleunik,critere_code,critere_denomination,critere_choixmultiples,critere_codechoixpertinent as critere_codechoixpertinent";
$sql_req.=" from _criteres where (critere_cleunik >9999 or critere_cleunik in (59,60)) and ( critere_portee &$vl_e_portee and critere_portee & 4096)";
$sql_req.=" AND (critere_cleunik not in (select distinct critere_cleunik from _act_interlo_choix_fixes where int_cleunik=$vl_e_int_cleunik and uti_cleunik=$vl_e_uti_cleunik) or (critere_cleunik in (select distinct critere_cleunik from _act_interlo_choix_fixes where int_cleunik=$vl_e_int_cleunik and uti_cleunik=$vl_e_uti_cleunik) and critere_choixmultiples=1))";
$sql_req.=" AND critere_actif =1";
$sql_req.=" ORDER BY critere_denomination";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)){
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  echo('<row:critere_cleunik NC:parseType="Integer">'.fa_ent_xml($row['critere_cleunik']).'</row:critere_cleunik>');
  echo('<row:critere_code>'.fa_ent_xml($row['critere_code']).'</row:critere_code>');
  echo('<row:critere_denomination>'.fa_ent_xml($row['critere_denomination']).'</row:critere_denomination>');
  echo('<row:critere_choixmultiples>'.fa_ent_xml($row['critere_choixmultiples']).'</row:critere_choixmultiples>');
  echo('<row:critere_codechoixpertinent>'.fa_ent_xml($row['critere_codechoixpertinent']).'</row:critere_codechoixpertinent>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
// fin du fichier RDF
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
