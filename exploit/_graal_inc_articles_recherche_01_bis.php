<?php
include_once("_graal_var_portee.php");
$vl_c_bbo_011=fa_recup_dico("bbo_011");
$vl_c_bbo_012=fa_recup_dico("bbo_012");
$vl_c_bbo_013=fa_recup_dico("bbo_013");
$vl_c_bbo_017=fa_recup_dico("bbo_017");
$vl_c_bbo_018=fa_recup_dico("bbo_018");
$vl_c_bbo_019=fa_recup_dico("bbo_019");
$vl_c_bbo_020=fa_recup_dico("bbo_020");
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->vl_modele_recherche_articles)){$vl_modele_recherche_articles=$vl_c_xml->vl_modele_recherche_articles->attributes();}else{$vl_modele_recherche_articles='1';}
switch ($vl_c_id_arbre_inc_article_01) {
  case 'arbre_des_articles':
    $vl_c_complement_nom="";
    break;
  case 'arbre_des_articles_panier':
    $vl_c_complement_nom="_panier";
    break;
}
$vl_c_bloc_arbre_criteres_debut="";
$vl_c_bloc_arbre_criteres_corpus="";
$vl_c_bloc_arbre_criteres_fin="";
if ($vl_c_bloc_arbre_criteres==true){
	$vl_c_dico_00044=fa_recup_dico("dico_00044");
	$sql_req_criteres="select f2.critere_denomination,f2.critere_cleunik,f1.* from _choix f1 left join _criteres f2 using (critere_cleunik) where f2.critere_cleunik>999 and (critere_portee & $vl_e_articl) order by f2.critere_cleunik,f1.choix_valeur_texte_01";
	$xml="";
	$vl_e_critere_cleunik=0;
  $res_uti=_graal_requete_bd($sql_req_criteres);
  while ($row_uti = mysql_fetch_assoc($res_uti)){
  	$critere_denomination=fa_ent_xml($row_uti['critere_denomination']);
		$choix_valeur_texte_01=fa_ent_xml($row_uti['choix_valeur_texte_01']);
		$choix_cleunik_action=fa_ent_xml($row_uti['choix_cleunik']);
  	if ($vl_e_critere_cleunik!=$row_uti['critere_cleunik']){
			$critere_cleunik_action=fa_ent_xml($row_uti['critere_cleunik']);
  		if ($vl_e_critere_cleunik!=0){
  			$xml.="</treechildren></treeitem>";
  		}
  		$xml.="<treeitem  container='true' old_open='true'><treerow><treecell label='$critere_denomination' _graal_choix_cleunik='0' _graal_critere_cleunik='$critere_cleunik_action'/></treerow><treechildren>";
  		$vl_e_critere_cleunik=$row_uti['critere_cleunik'];
  	}
		$xml .="<treeitem><treerow><treecell label='$choix_valeur_texte_01' _graal_choix_cleunik='$choix_cleunik_action' _graal_critere_cleunik='$critere_cleunik_action'/></treerow></treeitem>";
    /*
		if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
	  $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_actions.php?critere_cleunik='.$row_uti['cleunik'].'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
	  */
  }
	_graal_libere_requete_bd($res_uti);
	if ($xml!=""){
		$xml.="</treechildren></treeitem>";
		$xml .='</treechildren></tree>';
	
	
	$vl_c_bloc_arbre_criteres_debut="<hbox flex='1'>";
	$vl_c_bloc_arbre_criteres_corpus=<<<EOT
		<vbox >
		<radiogroup id='rdg_cherche_choix' value="3">
                <vbox flex="1">
								<hbox>
                  <radio observes="broadcaster_01" id='ra_cherche_choix_oui' label="Avec" value='1' />
                  <radio observes="broadcaster_01" id='ra_cherche_choix_non' label="Sans" value='2'/>
									<radio observes="broadcaster_01" id='ra_cherche_choix_ns' label="Ignoré" value='3' />
                </hbox>
								<hbox>
                  
                </hbox>
							</vbox>
              </radiogroup>
EOT;
	$vl_c_bloc_arbre_criteres_corpus.="<tree id='tb_choix_articles' hidecolumnpicker='true' seltype='multiple' flex='1' ><treecols><treecol ignoreincolumnpicker='true' class='colname' flex='2' primary='true' hideheader='true'/></treecols><treechildren id='treeitems'>$xml</vbox><splitter/>";
	$vl_c_bloc_arbre_criteres_fin="</hbox>";
	}
}
switch ($vl_modele_recherche_articles){
	case 2:	//	Modèle "Disponibilité"
$tabart=<<<EOT
  <vbox id="$vl_c_id_vbox_inc_article_01" flex="2" class='overflow_01'>
<tree id="$vl_c_id_arbre_inc_article_01" onclick="pf_sel_arbre_articles();" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" context="$vl_c_menucontext_01">
<treecols>
 <treecol id="code$vl_c_complement_nom" sort="?code" label="$vl_c_bbo_011" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="mnemotech$vl_c_complement_nom" sort="?mnemotechnique" label="$vl_c_bbo_012" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="art_cleunik$vl_c_complement_nom" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="description$vl_c_complement_nom" sort="?description" label="$vl_c_bbo_013" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="types_gestion$vl_c_complement_nom" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 
 
 <treecol id="qte_stock" class="droite" sort="?val_qte_stock" label="$vl_c_bbo_017" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="val_qte_stock" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="encommande_cli" class="droite" sort="?val_encommande_cli" label="$vl_c_bbo_018" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="val_encommande_cli" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="encommande_fou" class="droite" sort="?val_encommande_fou" label="$vl_c_bbo_019" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="val_encommande_fou" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="dispo" class="droite" sort="?val_dispo" label="$vl_c_bbo_020" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="val_dispo" hidden="true"  ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 </treecols>
 <template><query expr="*"/><action>
 <treechildren>

 <treeitem container="true" uri="?" seltype="single">
 <treerow>
 <treecell properties="?properties" label="?code"/>
 <treecell properties="?properties" label="?mnemotechnique"/>
 <treecell properties="?properties" label="?art_cleunik"/>
 <treecell properties="?properties" label="?description"/>
 <treecell properties="?properties" label="?types_gestion"/>
 
 <treecell properties="?properties" label="?qte_stock"/>
 <treecell properties="?properties" label="?val_qte_stock"/>
 <treecell properties="?properties" label="?encommande_cli"/>
 <treecell properties="?properties" label="?val_encommande_cli"/>
 <treecell properties="?properties" label="?encommande_fou"/>
 <treecell properties="?properties" label="?val_encommande_fou"/>
 <treecell properties="?properties" label="?dispo"/>
 <treecell properties="?properties" label="?val_dispo"/>
 </treerow>
 </treeitem>
 </treechildren>
 </action></template>
 </tree>
 </vbox>
EOT;
		break;
  	case 1:
  	default:
$tabart=<<<EOT
  <vbox id="$vl_c_id_vbox_inc_article_01" flex="2" class='overflow_01'>
<tree id="$vl_c_id_arbre_inc_article_01" onclick="pf_sel_arbre_articles();" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" context="$vl_c_menucontext_01">
<treecols>
 <treecol id="code$vl_c_complement_nom" sort="?code" label="$vl_c_bbo_011" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="mnemotech$vl_c_complement_nom" sort="?mnemotechnique" label="$vl_c_bbo_012" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="art_cleunik$vl_c_complement_nom" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol id="description$vl_c_complement_nom" sort="?description" label="$vl_c_bbo_013" /><splitter class="tree-splitter" resizeafter="grow"/>
 <treecol hidden="true" id="types_gestion$vl_c_complement_nom" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
 </treecols>
 <template><query expr="*"/><action>
 <treechildren>

 <treeitem container="true" uri="?" seltype="single">
 <treerow>
 <treecell properties="?properties" label="?code"/>
 <treecell properties="?properties" label="?mnemotechnique"/>
 <treecell properties="?properties" label="?art_cleunik"/>
 <treecell properties="?properties" label="?description"/>
 <treecell properties="?properties" label="?types_gestion"/>
 </treerow>
 </treeitem>
 </treechildren>
 </action></template>
 </tree>
 </vbox>
EOT;
  }
echo $vl_c_bloc_arbre_criteres_debut;
echo $vl_c_bloc_arbre_criteres_corpus;
echo $tabart;
echo $vl_c_bloc_arbre_criteres_fin;
?>
