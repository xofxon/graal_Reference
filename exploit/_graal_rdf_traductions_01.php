<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_langue=intval(fa_recup_param('vl_e_langue','120115'));  //  anglais par défaut
$vl_e_français=120131;
$vl_b_atraduireseuls=intval(fa_recup_param('vl_b_atraduireseuls','0'));
$vl_e_uti_cleunik=0;
$vl_e_type=intval(fa_recup_param('vl_e_type','0'));
//  On commence par ajouter, à partir des libellés français, les libellés étrangers
$sql_req = "insert into _objets_libelle select alias01.fen_cleunik,alias01.descriptif,$vl_e_langue,$vl_e_uti_cleunik from _objets_libelle alias01 where alias01.fen_cleunik not in ( select _objets_libelle.fen_cleunik from _objets_libelle where langue=$vl_e_langue)";
$result = _graal_requete_bd($sql_req);
//  On ne récupère que les objets qui ont des éléments, puisque le but est de traduire les descriptions des éléments
$sql_req = "SELECT _objets_libelle.fen_cleunik as fen_cleunik,_objets.titre as titre,_objets_libelle.descriptif AS descriptif,traduction.descriptif AS descriptif_traduit FROM _objets_libelle,_objets_libelle traduction,_objets WHERE _objets_libelle.langue=$vl_e_français and traduction.langue=$vl_e_langue and _objets_libelle.fen_cleunik=traduction.fen_cleunik and _objets_libelle.fen_cleunik=_objets.fen_cleunik and _objets.type_objet=$vl_e_type and _objets.fen_cleunik in ( select distinct _elements.fen_cleunik from _elements)";
if ($vl_b_atraduireseuls==1)
{
  $sql_req .= " and _objets_libelle.descriptif=traduction.descriptif"; 
}
$sql_req .= " ORDER BY descriptif;";
$result = _graal_requete_bd($sql_req);

echo(fa_xcree_entete_rdf());
  // boucle de récupération des enregistrements de la requête et génération du contenu RDF
  while ($row = mysql_fetch_assoc($result))
    {
      echo('<RDF:li>'.EOL);
      echo('<RDF:Description>');
      // parseType = indication pour le type des données, utile pour le tri sur la colonne
      echo('<row:fen_cleunik NC:parseType="Integer">'.fa_ent_xml($row['fen_cleunik']).'</row:fen_cleunik>');
      echo('<row:titre>'.fa_ent_xml($row['titre']).'</row:titre>');
      echo('<row:descriptif_traduit>'.fa_ent_xml($row['descriptif_traduit']).'</row:descriptif_traduit>');
      echo('<row:descriptif>'.fa_ent_xml($row['descriptif']).'</row:descriptif>');
      echo('</RDF:Description>'.EOL);
      echo('</RDF:li>'.EOL);
    }
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
