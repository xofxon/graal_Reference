<?php
include("_graal_var_portee.php");
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
if (isset($vl_c_xml->selection_telephone)){$selection_telephone=$vl_c_xml->selection_telephone->attributes();}else{$selection_telephone='1';}

$vl_c_selqui_01="false";
$vl_c_selqui_02="false";
$vl_c_selqui_03="false";
$vl_c_selqui_04="false";
$vl_c_selqui_05="false";
$vl_c_selqui_06="false";
$vl_c_selqui_07="false";
$vl_c_selqui_08="false";
$vl_c_selqui_09="false";
$vl_c_inactif="true";
$vl_e_portee=0;
switch ($vl_c_id_rech_tel_01){
  case "Div_00127";$vl_c_selqui_09="true";$vl_c_inactif="false";$vl_e_portee+=$vl_e_acteur;break;  //Recherche de tous les téléphones
  case "Div_00128";$vl_c_selqui_02="true";$vl_e_portee+=$vl_e_entrep;break; //  Entreprise
  case "Div_00129";$vl_c_selqui_03="true";$vl_e_portee+=$vl_e_procli;break; //  Prospects Clients
  case "Div_00130";$vl_c_selqui_05="true";$vl_e_portee+=$vl_e_profou;break; //  Prospects Fournisseurs
  case "Div_00131";$vl_c_selqui_04="true";$vl_e_portee+=$vl_e_client;break; //  Clients
  case "Div_00132";$vl_c_selqui_06="true";$vl_e_portee+=$vl_e_fourni;break; //  Fournisseurs
  case "Div_00133";$vl_c_selqui_07="true";$vl_e_portee+=$vl_e_autrac;break; //  Autres
  case "Div_00134";$vl_c_selqui_08="true";$vl_e_portee+=$vl_e_actind;break; //  Indéterminés
}
$vf_c_url_alimente_table="_graal_das_paniers_01.php?vl_e_maportee=";
$vl_c_source_paniers="$vf_c_url_alimente_table$vl_e_portee";
_graal_requete_charge_varlib($vl_c_id_rech_tel_01,$vl_e_uti_cleunik);
$vl_c_dico_00018=fa_recup_dico("dico_00018");
$vl_c_dico_00019=fa_recup_dico("dico_00019");
$vl_c_dico_00020=fa_recup_dico("dico_00020");
$vl_c_dico_00021=fa_recup_dico("dico_00021");
$vl_c_dico_00022=fa_recup_dico("dico_00022");
$vl_c_dico_00023=fa_recup_dico("dico_00023");
$vl_c_dico_00024=fa_recup_dico("dico_00024");
$vl_c_dico_00025=fa_recup_dico("dico_00025");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_mes_00007=fa_recup_dico("mess_00007");
$vl_c_bbe_010=fa_recup_dico("bbe_010");
$vl_c_bbe_011=fa_recup_dico("bbe_011");
$vl_c_bbe_012=fa_recup_dico("bbe_012");
$vl_c_bbe_013=fa_recup_dico("bbe_013");
$vl_c_bbe_014=fa_recup_dico("bbe_014");
$vl_c_bbe_015=fa_recup_dico("bbe_015");
$vl_c_bbe_016=fa_recup_dico("bbe_016");
$vl_c_bbe_017=fa_recup_dico("bbe_017");
$vl_c_bbe_018=fa_recup_dico("bbe_018");
$vl_c_bbe_019=fa_recup_dico("bbe_019");
$vl_c_bbe_020=fa_recup_dico("bbe_020");
$vl_c_bbe_021=fa_recup_dico("bbe_021");
$vl_c_bbe_022=fa_recup_dico("bbe_022");
$vl_c_bbe_023=fa_recup_dico("bbe_023");
$vl_c_bbe_024=fa_recup_dico("bbe_024");
$vl_c_bbe_025=fa_recup_dico("bbe_025");
$vl_c_bbe_026=fa_recup_dico("bbe_026");
$vl_c_bbe_027=fa_recup_dico("bbe_027");
$vl_c_bbe_028=fa_recup_dico("bbe_028");
$vl_c_bbe_029=fa_recup_dico("bbe_029");
$vl_c_bbe_030=fa_recup_dico("bbe_030");
if ($vl_c_reftel=='azertyuiop'){
	$vl_c_recherche_ini=$vl_c_bbe_011;
	$vl_c_bao_ml_actif=1;
} else {
	$vl_c_recherche_ini=$vl_c_reftel;
	$selection_telephone=4;
	$vl_c_bao_ml_actif=0;
}
echo <<<END
<script type="text/javascript">
<![CDATA[
function po_change_menu_actifs() {
  var vo_list = document.getElementById("bao_ml_actif")
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"));
}
function po_change_menu() {
	fa_das("bao_ml_actif","$vl_c_source_paniers"+"&raf_random="+Math.random()+"&");
}
function po_selbao_ml_actif() {
  var item=fa_gid("bao_ml_actif").selectedItem;
  var vl_portee=item.getAttribute("value");
  switch (vl_portee) {
    case "0":case "1":case "2":
      fa_cache_non("bbe_courriel_01");
      break;
    case "3":
      fa_cache_oui("bbe_courriel_01");
      break;
  } 
}

]]>
</script>
  <vbox id="bbe_ove_01" class='overflow_01' collapsed="$vl_b_cache_bloc_sel_rech_tel">
  <hbox>
     <menulist sizetopopup="none" value="$vl_c_bao_ml_actif" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bao_ml_actif" oncommand="po_selbao_ml_actif();po_change_menu_actifs();pf_approximatif();" flags="" ref="*" querytype="xml" datasources="">
      <menupopup>
        <menuitem label="$vl_c_dico_00046" tooltiptext="$vl_c_dico_00046" value="1" /> <!--  Actifs-->
        <menuitem label="$vl_c_dico_00047" tooltiptext="$vl_c_dico_00047" value="2" /> <!--  Inactifs-->
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" value="0" /> <!--  Tous-->
      </menupopup>
      <template><query expr="*"/><action>
        <menupopup>
          <menuseparator/>
          <menuitem uri="?" class="menuitem-iconic ?prop" label="?panier_titre" tooltiptext="?panier_titre" selected="true" value="3" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers-->
        </menupopup>
      </action></template>

    </menulist>
  </hbox>
	
	<hbox id="bbe_courriel_01">
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="1" id="bbe_ml_qui" oncommand="pf_approximatif();">
      <menupopup>
        <menuitem label="$vl_c_dico_00019" tooltiptext="$vl_c_dico_00019" selected="$vl_c_selqui_02" value="2"/>
        <menuitem label="$vl_c_dico_00020" tooltiptext="$vl_c_dico_00020" selected="$vl_c_selqui_03" value="3"/>
        <menuitem label="$vl_c_dico_00021" tooltiptext="$vl_c_dico_00021" selected="$vl_c_selqui_04" value="4"/>
        <menuitem label="$vl_c_dico_00022" tooltiptext="$vl_c_dico_00022" selected="$vl_c_selqui_05" value="5"/>
        <menuitem label="$vl_c_dico_00023" tooltiptext="$vl_c_dico_00023" selected="$vl_c_selqui_06" value="6"/>
        <menuitem label="$vl_c_dico_00024" tooltiptext="$vl_c_dico_00024" selected="$vl_c_selqui_07" value="7"/>
        <menuitem label="$vl_c_dico_00025" tooltiptext="$vl_c_dico_00025" selected="$vl_c_selqui_08" value="8"/>
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" selected="$vl_c_selqui_09" value="9"/>
      </menupopup>
    </menulist>
    <label flex="0" value="$vl_c_bbe_010"/>
    <textbox flex="2" value="$vl_c_recherche_ini" id="bbe_tb_rechapproxima" oninput="pf_approximatif();" minwidth="60" />
    <label flex="0" value="$vl_c_bbe_012"/>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbe_ml_zone" oncommand="pf_approximatif();" value="$selection_telephone">
      <menupopup>
        <menuitem label="$vl_c_bbe_013" tooltiptext="$vl_c_bbe_013" value="1"/> <!--  Nom de la société-->
        <menuitem label="$vl_c_bbe_014" tooltiptext="$vl_c_bbe_014" value="2"/> <!--  Nom commercial-->
        <menuitem label="$vl_c_bbe_015" tooltiptext="$vl_c_bbe_015" value="3"/> <!--  Interlocuteur-->
        <menuitem label="$vl_c_bbe_016" tooltiptext="$vl_c_bbe_016" value="4"/> <!--  Téléphone-->
      </menupopup>
    </menulist>
    <label flex="0" value="$vl_c_bbe_029"/>
		<textbox flex="0"   value="$vl_c_bbe_030" id="bbe_tb_limit" size="4" type="number" hidespinbuttons="true"/>
		<keyset id="_graal_ks_02">
    <key id="k-recherche" modifiers="alt" keycode="VK_F3" oncommand="pf_approximatif();"/>
	</keyset>
    <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_mes_00007" oncommand="pf_approximatif();" id="tb_rafraichir_table"/>
    <toolbarbutton id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_id_fenetre')" />
  </hbox>
  </vbox>
    <vbox flex="1">
  <vbox flex="1" class='overflow_01'>
   <tree id="arbre_des_tel_interlo_act" enableColumnDrag="true" flex="1" flags="" ref="*" querytype="xml" datasources="" seltype="single" ondblclick="pf_dblclick_arbre_tel_interlo_act();" context="pop_selections">
     <treecols>
      <treecol hidden="true" id="act_cleunik$affixe_colonne_telephones" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" id="int_cleunik$affixe_colonne_telephones" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol hidden="true" id="intel_cleunik$affixe_colonne_telephones" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="portee$affixe_colonne_telephones" sort="?portee" label="$vl_c_bbe_022" /><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="raisonsoc$affixe_colonne_telephones" sort="?raisonsoc" label="$vl_c_bbe_023"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="nc$affixe_colonne_telephones" sort="?nc" label="$vl_c_bbe_024"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="civilite$affixe_colonne_telephones" sort="?civilite" label="$vl_c_bbe_025"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="qui$affixe_colonne_telephones" sort="?qui" label="$vl_c_bbe_026"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="genretel$affixe_colonne_telephones" sort="?genretel" label="$vl_c_bbe_027"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="notel$affixe_colonne_telephones" sort="?notel" label="$vl_c_bbe_028"/><splitter class="tree-splitter" resizeafter="grow"/>
      <treecol id="typeacteur$affixe_colonne_telephones" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
     </treecols>
     <template><query expr="*"/><action>
       <treechildren>
         <treeitem container="true" uri="?" seltype="single">
           <treerow>
             <treecell label="?act_cleunik"/>
             <treecell label="?int_cleunik"/>
             <treecell label="?intel_cleunik"/>
             <treecell label="?portee"/>
             <treecell label="?raisonsoc" properties="?prop_act"/>
             <treecell label="?nc"/>
             <treecell label="?civilite"/>
             <treecell label="?qui" properties="?prop_int"/>
             <treecell label="?genretel"/>
             <treecell label="?notel"/>
             <treecell label="?typeacteur"/>
           </treerow>
         </treeitem>
       </treechildren>
     </action></template>
   </tree>
  
  
  </vbox>
  </vbox>
END;
?>
