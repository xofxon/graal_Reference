<?php
include("_graal_header_xul.inc.php");
$vl_c_id_fenetre="Imp_00001";
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);
$vl_b_import_prospect=true;
$vl_c_zaa_101=fa_recup_dico("zaa_101");
$vl_c_zaa_101="Importation depuis le système d'information 'APISoft' vers celui 'XsOFtware'";
$vl_c_base_origine="apisoft_bar_prospect";
$vl_c_base_destination="$sql_bdd";
$ml_prefixes=fa_brik_menulist_choix(66,1,2,1,'','ml_prefixe_tel_00',"broadcaster_01",121111);
include("_graal_header_winxul.inc.php");
echo <<<END
<window title="$vl_c_zaa_101" id="_graal_trad_objets_01" onload="fa_aa(this);pf_etat_fen('ini')" $c_xmlns>
$vl_c_graal_cp00
END;
include_once("js/_graal_01.js.php");
include("js/_import_apisoft_02.js.php");
echo <<<END
  <vbox flex="1" class="overflow_01">
    <groupbox>
      <description>$vl_c_zaa_101</description>
      <hbox>
        <description>Base origine <textbox id="c_base_ori" value="$vl_c_base_origine"/></description>
        <description>Base destination <textbox id="c_base_des" value="$vl_c_base_destination"/></description>
      </hbox>
      <groupbox>
        <description>Fichiers de base</description>
        <tabbox flex="1">
          <tabs>
            <tab id="tab_procli" linkedpanel="tabpanel_procli" label="Prospects"     />
            <tab id="tab_pccomp" linkedpanel="tabpanel_pccomp" label="Compléments Prospects" />
            <tab id="tab_action" linkedpanel="tabpanel_action" label="Actions"     />
            <tab id="tab_divers" linkedpanel="tabpanel_divers" label="Tables diverses" />
          </tabs>
          <tabpanels flex="1" >
            <tabpanel id="tabpanel_procli">
            /* Onglet des prospects */       
              <groupbox>
                <description>Préparation</description>
                <vbox>
                  <label value="Secteurs géographiques"/>
END;
//  On recherche Tous les genres critères supérieurs à 9999        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT critere_cleunik,critere_denomination FROM _criteres WHERE critere_actif=1 and critere_cleunik >9999 and critere_portee & 2 order by critere_denomination";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs != 0) 
{
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_secteurs_geo_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
echo("<menuitem value='Aucun !!' id='0' _graal_cleunik='0' label='Aucun' selected='true'/>");
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['critere_denomination'])). "' id='".$row['critere_cleunik'] ."' _graal_cleunik='".$row['critere_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['critere_denomination']))."' selected='true'/>");
   }
echo <<<END
  </menupopup>
</menulist>
<button label="Importer" oncommand="pf_importation_critere('ml_secteurs_geo_00')" />
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
                  <label value="Familles de prospects"/>
END;
//  On recherche Tous les genres critères supérieurs à 9999        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT critere_cleunik,critere_denomination FROM _criteres WHERE critere_actif=1 and critere_cleunik >9999 and critere_portee &2 order by critere_denomination";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs != 0) 
{
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_familles_pro_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
echo("<menuitem value='Aucun !!' id='0' _graal_cleunik='0' label='Aucun' selected='true'/>");
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['critere_denomination'])). "' id='".$row['critere_cleunik'] ."' _graal_cleunik='".$row['critere_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['critere_denomination']))."' selected='true'/>");
   }
echo <<<END
  </menupopup>
</menulist>
<button label="Importer" oncommand="pf_importation_critere('ml_familles_pro_00')" />
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
                  <label value="Origines"/>
END;
//  On recherche Tous les genres critères supérieurs à 9999        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT critere_cleunik,critere_denomination FROM _criteres WHERE critere_actif=1 and critere_cleunik >9999 and critere_portee &2 order by critere_denomination";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs != 0) 
{
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_origine_pro_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
echo("<menuitem value='Aucun !!' id='0' _graal_cleunik='0' label='Aucun' selected='true'/>");
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['critere_denomination'])). "' id='".$row['critere_cleunik'] ."' _graal_cleunik='".$row['critere_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['critere_denomination']))."' selected='true'/>");
   }
echo <<<END
  </menupopup>
</menulist>
<button label="Importer" oncommand="pf_importation_critere('ml_origine_pro_00')" />
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END


                  <button hidden="true" label="Autre traitements" oncommand="alert('Bonjour le monde');"/>
                </vbox>
              </groupbox>   
              <groupbox>
                <description>Importation</description>
                <hbox>
END;
//  On recherche Tous les genres d'acteur client        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (80) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_genre" value="Genres d\'acteurs"/>
END;
}
else
{
echo('<label control="la_genre" value="Genres d acteurs."/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_genres_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
</hbox>
<hbox>
END;
//  On recherche Tous les civilités        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (86) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_civilite" value="Civilités"/>
END;
}
else
{
echo('<label control="la_civilite" value="Civilités."/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_civilite_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
</hbox>
<hbox>
END;
//  On recherche Tous les genres de courriel        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (84) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_courriels" value="Courriels"/>
END;
}
else
{
echo('<label control="la_courriel" value="Courriel."/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_courriel_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
</hbox>
<hbox>
END;

//  On recherche Tous les genres de fax        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (83) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_fax" value="Fax"/>
END;
}
else
{
echo('<label control="la_fax" value="Fax."/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_fax_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
//  On recherche Tous les préfixes internationaux        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur',_choix.choix_code as 'prefixe' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (66) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_fax" value="Préfixes internationaux Fax"/>
END;
}
else
{
echo('<label control="la_fax" value="Préfixes internationaux Fax"/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_prefixe_fax_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='(".fa_remplace_quotes(fa_ent_xml($row['prefixe'])) . ") ".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
</hbox>
<hbox>
END;

//  On recherche Tous les genres de téléphones        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (82) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_tel" value="Téléphones"/>
END;
}
else
{
echo('<label control="la_tel" value="Téléphones"/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_tel_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo('<label control="la_fax" value="Préfixes internationaux Tel"/>');
echo("$ml_prefixes");
echo <<<END
</hbox>
<hbox>
END;
//  On recherche Tous les genres de portables        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (82) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_por" value="Portables"/>
END;
}
else
{
echo('<label control="la_por" value="Portables"/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_por_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
//  On recherche Tous les préfixes internationaux        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur',_choix.choix_code as 'prefixe' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (66) and  choix_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs == 0) 
{
$vl_b_import_prospect=false;
echo <<<END
<label control="la_fax" value="Préfixes internationaux Portable"/>
END;
}
else
{
echo('<label control="la_fax" value="Préfixes internationaux Portable"/>');
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="15" id="ml_prefixe_por_00" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='(".fa_remplace_quotes(fa_ent_xml($row['prefixe'])) . ") ".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
echo <<<END
  </menupopup>
</menulist>
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
</hbox>
END;


if ($vl_b_import_prospect==true)
{ echo ('<button label="Importer" oncommand="pf_importation(\'1\');"/>');}
else
{echo ('<button label="Importation impossible "/>');}
echo <<<END
             </groupbox>
             
              <groupbox>
                <description>Annexes</description>
                <vbox>
                  <button label="Rattachements Représentants/Prospects" oncommand="pf_importation('6');"/>
                </vbox>
              </groupbox>

                
            </tabpanel>
            <tabpanel id="tabpanel_action">
            /* Onglet des actions */       
              <groupbox>
                <description>Préparation</description>
                <vbox>
                  <groupbox>
                    <description>Types d actions</description>
                    <button label="Importer" oncommand="pf_importation('3');"/>
                  </groupbox>
                </vbox>
              </groupbox>   
              <groupbox>
                <description>Importations</description>
                <vbox>
                  <groupbox>
                    <description>Actions</description>
                    <button label="Importer" oncommand="pf_importation('4');"/>
                  </groupbox>
                </vbox>
              </groupbox>   
            </tabpanel>
            <tabpanel id="tabpanel_divers">
            /* Onglet des tables diverses */       
              <groupbox>
                <description>Importations</description>
                <hbox>
                                <groupbox>
                <description>Relations prospects/clients</description>
                  
                    <label control="la_prefixe_choix_cleunik" value="Intitulé de la relation du prospect"/>
END;
$sql_req_genre_rel = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (114) and  choix_portee & 6 ORDER BY _choix.choix_valeur_texte_01;";
$sql_result_genre_rel = _graal_requete_bd($sql_req_genre_rel);
$vl_e_nombre_valeurs_genres=mysql_num_rows($sql_result_genre_rel);
echo <<<END
  <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="1" id="ml_rel_gauche" _graal_nombre="$vl_e_nombre_valeurs_genres">
  <menupopup>
END;
if ($vl_e_nombre_valeurs_genres == 0) 
{
echo("<menuitem value='0' id='0' _graal_cleunik='0' label='$vl_c_dico_00010' selected='true'/>");
}
else
{
while ($row = mysql_fetch_assoc($sql_result_genre_rel))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
_graal_libere_requete_bd($sql_result_genre_rel);
echo <<<END
      </menupopup>
    </menulist>
  <label control="la_prefixe_choix_cleunik" value="Intitulé de la relation du client"/>
  <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="1" id="ml_rel_droite" _graal_nombre="$vl_e_nombre_valeurs_genres">
  <menupopup>
END;
$sql_req_genre_rel = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (114) and  choix_portee & 6 ORDER BY _choix.choix_valeur_texte_01;";
$sql_result_genre_rel = _graal_requete_bd($sql_req_genre_rel);
while ($row = mysql_fetch_assoc($sql_result_genre_rel))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
_graal_libere_requete_bd($sql_result_genre_rel);
echo <<<END
      </menupopup>
    </menulist>
END;
}
echo <<<END

                  
                  <button label="Importer" oncommand="pf_importation('2');"/>
              </groupbox>

                                <groupbox>
                <description>Relations prospects/représentants</description>
                  
                    <label control="la_prefixe_choix_cleunik_rep" value="Intitulé de la relation du prospect"/>
END;
$sql_req_genre_rel = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (114) and  choix_portee & 6 ORDER BY _choix.choix_valeur_texte_01;";
$sql_result_genre_rel = _graal_requete_bd($sql_req_genre_rel);
$vl_e_nombre_valeurs_genres=mysql_num_rows($sql_result_genre_rel);
echo <<<END
  <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="1" id="ml_rel_gauche_rep" _graal_nombre="$vl_e_nombre_valeurs_genres">
  <menupopup>
END;
if ($vl_e_nombre_valeurs_genres == 0) 
{
echo("<menuitem value='0' id='0' _graal_cleunik='0' label='$vl_c_dico_00010' selected='true'/>");
}
else
{
while ($row = mysql_fetch_assoc($sql_result_genre_rel))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
_graal_libere_requete_bd($sql_result_genre_rel);
echo <<<END
      </menupopup>
    </menulist>
  <label control="la_prefixe_choix_cleunik_rep" value="Intitulé de la relation du représentant"/>
  <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" flex="1" id="ml_rel_droite_rep" _graal_nombre="$vl_e_nombre_valeurs_genres">
  <menupopup>
END;
$sql_req_genre_rel = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN (114) and  choix_portee & 6 ORDER BY _choix.choix_valeur_texte_01;";
$sql_result_genre_rel = _graal_requete_bd($sql_req_genre_rel);
while ($row = mysql_fetch_assoc($sql_result_genre_rel))
  {
  echo("<menuitem value='" .fa_remplace_quotes(fa_ent_xml($row['valeur'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."' selected='true'/>");
  }
_graal_libere_requete_bd($sql_result_genre_rel);
echo <<<END
      </menupopup>
    </menulist>
END;
}
echo <<<END

                  
                  <button label="Importer" oncommand="pf_importation('5');"/>
              </groupbox>
                </hbox>
              </groupbox>   
            </tabpanel>
            <tabpanel id="tabpanel_pccomp">
              <groupbox flex='10'>
                <description>Traitements</description>
                <hbox>
                  <menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" id="ml_complements_procli" _graal_nombre="10">
                    <menupopup>
                      <menuitem value="ASSIST" label="ASSIST" />
                      <menuitem value="Tél direct" label="Tél direct" />
                      <menuitem value="ECH" label="ECH" />
                      <menuitem value="Chambres" label="Chambres" />
                      <menuitem value="Restaurant" label="Restaurant" />
                      <menuitem value="Prochain contact" label="Prochain contact" />
                      <menuitem value="FERMETURE HEBDO" label="FERMETURE HEBDO" />
                      <menuitem value="Fermeture Annuelle" label="Fermeture Annuelle" />
                      <menuitem value="SEMINAIRES" label="SEMINAIRES" />
                      <menuitem value="FamilleTiers" label="FamilleTiers" />
                      <menuitem value="Secteur" label="Secteur" />
                      <menuitem value="Origine" label="Origine" />
                    </menupopup>
                  </menulist>
                  
END;
//  On recherche Tous les genres critères supérieurs à 9999        
//  la condition "choix_portee & 16" permet d'utiliser le et binaire
$sql_req = "SELECT critere_cleunik,critere_denomination FROM _criteres WHERE critere_actif=1 and critere_cleunik >9999 and critere_portee & 2";
$sql_result = _graal_requete_bd($sql_req);
$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
if ($vl_e_nombre_valeurs != 0) 
{
echo('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" id="ml_complement_procli_critere" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
echo('<menupopup>');
echo("<menuitem value='Aucun !!' id='0' _graal_cleunik='0' label='Aucun' selected='true'/>");
while ($row = mysql_fetch_assoc($sql_result))
  {
  echo("<menuitem flex='10' value='" .fa_remplace_quotes(fa_ent_xml($row['critere_denomination'])). "' id='".$row['critere_cleunik'] ."' _graal_cleunik='".$row['critere_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['critere_denomination']))."' selected='true'/>");
   }
echo <<<END
  </menupopup>
</menulist>
<button label="Importer" oncommand="pf_importation_critere('complement_procli')" />
END;
}
_graal_libere_requete_bd($sql_result);
echo <<<END
                </hbox>
                      </groupbox>
            </tabpanel>
          </tabpanels>
        </tabbox>
      </groupbox>
    </groupbox>
  </vbox>
</window>
END;
?>
<?php
?>
