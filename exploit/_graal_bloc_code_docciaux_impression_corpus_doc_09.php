<?php
while ($row = mysql_fetch_assoc($result)) {
	$commande_ligne=pf_cherche_commande_ligne($row['cdefou_ligne_qte_cleunik']);
    $Quantité=$row['qte'];
    //  L'arrondi ne fonctionne pas dans la requête (8/7/2008)
    $Quantité=round($row['qte'],$row['qte_nbdec']);
    $Code=$row['code_interne'];
    $Désignation="Commande $commande_ligne".EOL.$row['description_interne'];
    $pu=$row['pu'];
    $nbdec_pu=$row['nbdec_pu'];
    $nbdec_pu=4;//	On force à 4 décimales pour France Lampes (côté fournisseur)
    $pu_arrondi=fa_reel($pu,$nbdec_pu);
    $htbrutremise=$row['htbrutremise'];
    $htbrutremise_arrondi=fa_reel($htbrutremise,$nbdec_pu);	
    $blocnotebrut=trim($row['blocnotebrut']);
    if ($blocnotebrut!="") {
      $Désignation.=EOL.$blocnotebrut;
    }
    $code_acteur=$row['code_acteur'];
    $taxe=trim($row['code']);
    $tpf=trim($row['code_tpf']);
    if ($tpf=="RAF"){$tpf="";}
    if ($Quantité==0){$Code="";}

    $line = array($ref_col[ 0]=>$Code,$ref_col[ 1]=>$Désignation,$ref_col[ 2]=>$Quantité,$ref_col[ 3]=>$pu_arrondi,$ref_col[ 4]=>$code_acteur);
    
    $pdf->_graal_pf_imprime_ligne($line,$y,$cols,$format,$fonts,$type,$position_pied);
  }
 function pf_cherche_commande_ligne($cdefou_ligne_qte_cleunik) {
	$sql_req="SELECT f1.code,f3.ligne_cleunik";
	$sql_req.=" from _cdefou_entetes f1 left join _cdefou_lignes f3 using(commercial_cleunik) left join _cdefou_lignes_qte f2 using(commercial_ligne_cleunik) ";
	$sql_req.=" WHERE f2.ligne_qte_cleunik=$cdefou_ligne_qte_cleunik ;";
	$result = _graal_requete_bd($sql_req);
	//echo $sql_req;
	$row = mysql_fetch_assoc($result);
	$commande=$row['code'];
	$ligne_cleunik=sprintf("%02d", $row['ligne_cleunik']);
	_graal_libere_requete_bd($result);
	return $commande."-".$ligne_cleunik;
}
?>