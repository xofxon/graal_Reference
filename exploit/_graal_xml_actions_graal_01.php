<?php
include("_graal_header_xml.inc.php");
include("_graal_var_portee.php");
define('EOL', "\r\n");
$vl_e_act_cleunik=intval(fa_recup_param('vl_e_act_cleunik','0'));
$vl_e_int_cleunik=intval(fa_recup_param('vl_e_int_cleunik','0'));
$vl_e_action_cleunik=intval(fa_recup_param('vl_e_action_cleunik','0'));
$vl_e_choix_cleunik=intval(fa_recup_param('vl_e_choix_cleunik','0'));
// execution de la requÃ¨te SQL
$sql_req = "SELECT f01.act_cleunik as `act_cleunik`,f01.int_cleunik as `int_cleunik`,f01.action_cleunik as `action_cleunik`,f01.choix_cleunik as `choix_cleunik`,f01.portee as `portee`,f02.choix_valeur_texte_01 as `choix_valeur_texte_01`,f03.raisonsoc as `raisonsoc`,concat_ws(' ',f05.choix_valeur_texte_01,f04.prenom,f04.patronyme) as `interlocuteur`,f01.blocnotebrut as `blocnotebrut`,f01.principal FROM _graal f01,_choix f02,_acteurs f03,_act_interlo f04,_choix f05 where f01.action_cleunik=$vl_e_action_cleunik and f01.act_cleunik=$vl_e_act_cleunik and f01.int_cleunik=$vl_e_int_cleunik and f01.choix_cleunik=$vl_e_choix_cleunik and f02.choix_cleunik=f01.choix_cleunik and f01.act_cleunik=f03.act_cleunik and f04.int_cleunik =f01.int_cleunik and f05.choix_cleunik = f04.choix_cleunik;"; 
$result = _graal_requete_bd($sql_req);
echo fa_xcree_entete_xml();
$row = mysql_fetch_assoc($result);
echo('<Description>');
switch ($row['portee']) {
  case 8192 : echo('<interlocuteur data="'.fa_ent_xml($row['raisonsoc']).'"/>');
  case 4096 : echo('<interlocuteur data="'.fa_ent_xml($row['interlocuteur']).'"/>');
}
echo('<choix_cleunik data="'.fa_ent_xml($row['choix_cleunik']).'"/>');
echo('<blocnotebrut data="'.fa_ent_xml($row['blocnotebrut']).'"/>');
echo('<principal data="'.fa_ent_xml($row['principal']).'"/>');
echo('</Description>');
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
