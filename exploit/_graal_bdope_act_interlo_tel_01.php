<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_act_interlo_tel_01";
$t_origines_ok[1]="_graal_fen_act_interlo_simple_01";
$t_origines_ok[2]="_graal_fen_acteurs_simple_02";
$t_origines_ok[3]="_graal_fen_acteurs_simple_03";
$t_origines_ok[4]="_graal_fen_acteurs_simple_04";
$t_origines_ok[5]="_graal_fen_actions_02";
$t_origines_ok[6]="_graal_fen_act_interlo_simple_03";
$t_origines_ok[7]="_graal_fen_act_interlo_simple_02";
fa_acces_script();
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_intel_cleunik=intval(fa_recup_param("vl_intel_cleunik",0));
$vl_int_cleunik=intval(fa_recup_param("vl_int_cleunik",0));
$vl_act_cleunik=intval(fa_recup_param("vl_act_cleunik",0));
$vl_telformate=fa_recup_param("vl_telformate","");
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_infofavori=intval(fa_recup_param("vl_infofavori",0));
$vl_choix_cleunik=intval(fa_recup_param("vl_choix_cleunik",0));
$vl_prefixe_choix_cleunik=intval(fa_recup_param("vl_prefixe_choix_cleunik",0));
$vl_portable=intval(fa_recup_param("vl_portable",2));
$vl_sms=intval(fa_recup_param("vl_sms",2));
$a[0]='/[^0-9]/i'; // Tout ce qui n'est pas compris entre 0 et 9 sans distinction de minuscule ou majuscule
$b[0]='';
$vl_c_chaine_nette=preg_replace($a, $b, $vl_telformate);
switch (TRUE){
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _act_interlo_tel WHERE _act_interlo_tel.intel_cleunik = $vl_intel_cleunik;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_intel_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="ajouter":
    $vl_e_fen_cleunik=_graal_requete_max("intel_cleunik","_act_interlo_tel");
    $sql_req = "INSERT INTO _act_interlo_tel set intel_cleunik=$vl_e_fen_cleunik,int_cleunik=$vl_int_cleunik,telformate='$vl_telformate',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut',intel_05='$vl_c_chaine_nette',intel_06=$vl_c_chaine_nette,infofavori=$vl_infofavori,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik,prefixe_choix_cleunik=$vl_prefixe_choix_cleunik,portable=$vl_portable,sms=$vl_sms;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_e_fen_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE _act_interlo_tel set telformate='$vl_telformate',dateheuremodif=now(),blocnotebrut='$vl_blocnotebrut',intel_05='$vl_c_chaine_nette',intel_06=$vl_c_chaine_nette,infofavori=$vl_infofavori,act_cleunik=$vl_act_cleunik,choix_cleunik=$vl_choix_cleunik,prefixe_choix_cleunik=$vl_prefixe_choix_cleunik,portable=$vl_portable,sms=$vl_sms WHERE _act_interlo_tel.intel_cleunik=$vl_intel_cleunik;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_intel_cleunik;}  else {$vf_c_echo=-1;}
    break;
	case $vf_c_action=="existe":
    $sql_req = "select count(*) as nombre from _act_interlo_tel WHERE intel_06=$vl_c_chaine_nette;";
		$result = _graal_requete_bd($sql_req);
		$row = mysql_fetch_assoc($result);
		$vf_c_echo=fa_ent_xml($row['nombre']);
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
