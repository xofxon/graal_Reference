<?php
include("_graal_header_xul.inc.php");
$vl_c_id_fenetre="Imp_00001";
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);
$vl_b_import_fournisseur=true;
$vl_b_import_client=true;
$vl_b_import_transporteur=true;
$vl_b_import_representant=true;
$vl_c_zaa_101=fa_recup_dico("zaa_101");
$vl_c_zaa_101="Importation depuis le système d'information 'INES EPAC' vers celui 'XsOFtware'";
$vl_c_base_origine="ines_epac";
$vl_c_base_destination="$sql_bdd";
$ml_prefixes=fa_brik_menulist_choix(66,1,4,1,'','ml_prefixe_tel_00',"broadcaster_01",121111);
$ml_familles_art_00=pf_menulist_criteres("ml_familles_art_00","1024");
$ml_types_art_00=pf_menulist_criteres("ml_types_art_00","1024");
$ml_secteurs_geo_00=pf_menulist_criteres("ml_secteurs_geo_00","4");
$ml_familles_cli_00=pf_menulist_criteres("ml_familles_cli_00","4");

$ml_genres_00=pf_menulist_choix("ml_genres_00","4","80");
$ml_civilite_00=pf_menulist_choix("ml_civilite_00","4","86");
$ml_courriel_00=pf_menulist_choix("ml_courriel_00","4","84");
$ml_fax_00=pf_menulist_choix("ml_fax_00","4","83");
$ml_prefixe_fax_00=pf_menulist_choix("ml_prefixe_fax_00","4","66");
$ml_tel_00=pf_menulist_choix("ml_tel_00","4","82");
$ml_prefixe_tel_00=pf_menulist_choix("ml_prefixe_tel_00","4","66");
$ml_por_00=pf_menulist_choix("ml_por_00","4","82");
$ml_prefixe_por_00=pf_menulist_choix("ml_prefixe_por_00","4","66");
$ml_site_00=pf_menulist_choix("ml_site_00","4","85");

$ml_familles_fou_00=pf_menulist_criteres("ml_familles_fou_00","16");
$ml_genres_01=pf_menulist_choix("ml_genres_01","16","80");
$ml_civilite_01=pf_menulist_choix("ml_civilite_01","16","86");
$ml_courriel_01=pf_menulist_choix("ml_courriel_01","16","84");
$ml_fax_01=pf_menulist_choix("ml_fax_01","16","83");
$ml_prefixe_fax_01=pf_menulist_choix("ml_prefixe_fax_01","16","66");
$ml_tel_01=pf_menulist_choix("ml_tel_01","16","82");
$ml_prefixe_tel_01=pf_menulist_choix("ml_prefixe_tel_01","16","66");
$ml_por_01=pf_menulist_choix("ml_por_01","16","82");
$ml_prefixe_por_01=pf_menulist_choix("ml_prefixe_por_01","16","66");
$ml_site_01=pf_menulist_choix("ml_site_01","16","85");
$lib_10032=fa_remplace_quotes("Secteurs d\'activité préférés");
$lib_10033=fa_remplace_quotes("Ville d\'implantation");
$lib_10034=fa_remplace_quotes("Secteurs d\'activité exclus");
include("_graal_header_winxul.inc.php");
echo <<<END
<window title="$vl_c_zaa_101" id="_graal_trad_objets_01" onload="fa_aa(this);pf_etat_fen('ini')" $c_xmlns>
$vl_c_graal_cp00
END;
include_once("js/_graal_01.js.php");
include("js/_import_ines_epac_01.js.php");
echo <<<END
  <vbox flex="1" class="overflow_01">
    <groupbox>
      <description>$vl_c_zaa_101</description>
      <hbox>
        <description>Base origine <textbox id="c_base_ori" value="$vl_c_base_origine"/></description>
        <description>Base destination <textbox id="c_base_des" value="$vl_c_base_destination"/></description>
      </hbox>
      <groupbox>
        <description>Fichiers de base</description>
        <tabbox flex="1">
          <tabs>
            <tab label="Clients" linkedpanel="tabpanel_client" id="tab_client"   />
            <tab label="Contacts clients" linkedpanel="tabpanel_contacts_clients" id="tab_contacts_clients"/>
            <tab label="Articles" linkedpanel="tabpanel_article" id="tab_article"/>
            <tab label="Actions" linkedpanel="tabpanel_actions" id="tab_actions"/>
            <tab label="Tables diverses" linkedpanel="tabpanel_diverse" id="tab_diverse"/>
            
          </tabs>
          <tabpanels flex="1" >
           <tabpanel id="tabpanel_diverse">
              <groupbox>
                <description>Importations</description>
                <vbox>
                  <button label="1 Table des taxes" oncommand="pf_importation('6');" />
                  <button label="2 Table des catégories achat/vente" oncommand="pf_importation('7');" />
                  <button label="3 Table des tarifs" oncommand="pf_importation('8');"/>
                  <button label="4 Table des unités (stock,achat,vente)" oncommand="pf_importation('12');"/>
                  <button label="5 Table des modes de règlement" oncommand="pf_importation('14');"/>
                  <button label="6 Table des comptes comptables des articles" oncommand="pf_importation('15');"/>
                  <button label="7 Table des taxes parafiscales" oncommand="pf_importation('19');" />
                  <button hidden="true" label="" oncommand=""/>
                </vbox>
              </groupbox>   
            </tabpanel>
            <tabpanel id="tabpanel_client">
              
            <groupbox>
                <description>Préparation</description>
                <vbox>
                  <button label="Correspondances des pays d'adresses de livraison et de facturation" oncommand="pf_preparation('1');"/>
                  <button label="Associer les pays" oncommand="pf_ouvre_pays_ines();"/>
                  <button hidden="true" label="Correspondances des devises" oncommand="pf_preparation('10');"/>
                  <button hidden="true" label="Associer les devises" oncommand="pf_ouvre_devise_apisoft();"/>

                  <button label="Importer les types de clients" oncommand="pf_importation_critere_cli('10013','TYPE_CLI','clients');"/>
                  <button label="Importer les 'Adresses 3 ??' " oncommand="pf_importation_critere_cli('10014','CL_AD3','clients');"/>
                  <button label="Importer les 'Origines def  '" oncommand="pf_importation_critere_cli('10015','ORIGINE_DEF','clients');"/>
                  <button label="Importer les 'resp dossier  '" oncommand="pf_importation_critere_cli('10016','CL_RESP_DOSSIER','clients');"/>
                  <button label="Importer les 'commercial    '" oncommand="pf_importation_critere_cli('10017','CL_COMMERCIAL','clients');"/>
                  
                  <button hidden="true" label="Importer les 'npai          '" oncommand="pf_importation_critere_cli_perso('10018','npai','clients_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button hidden="true" label="Importer les 'apport        '" oncommand="pf_importation_critere_cli_perso('10019','apport','clients_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  
                  <button hidden="true" label="Autre traitements" oncommand="alert('Bonjour le monde');"/>
                </vbox>
              </groupbox>   
              <groupbox>
                <description>Importation</description>
                <vbox>
                <label value="Genres d'acteurs"/>
                $ml_genres_00
                <label value="Civilités"/>
                $ml_civilite_00
                <label value="Courriels"/>
                $ml_courriel_00
                <label value="Fax"/>
                $ml_fax_00
                <label value="Préfixes internationaux Fax"/>
                $ml_prefixe_fax_00
                <label value="Téléphones"/>
                $ml_tel_00
                <label value="Préfixes internationaux Tel"/>
                $ml_prefixe_tel_00
                <label value="Portables"/>
                $ml_por_00
                <label value="Préfixes internationaux Portables"/>
                $ml_prefixe_por_00
                <label value="Sites"/>
                $ml_site_00
				<button label="Importer" oncommand="pf_importation('1');"/>
				</vbox>
             </groupbox>   
              <groupbox>
                <description>Annexes</description>
                <vbox>
                  <button label="Importer les 'npai          '" oncommand="pf_importation_critere_cli_perso('10018','npai','clients_personnalisation','CHV_VALEUR_TEXTE','&lt;&gt;0');"/>
                  <button label="Importer les 'Apport        '" oncommand="pf_importation_critere_cli_perso('10019','Apport','clients_personnalisation','CHV_VALEUR_TEXTE','&lt;&gt;0');"/>
                  <button label="Importer les adresses" oncommand="pf_importation('23');"/>
                </vbox>
              </groupbox>
            </tabpanel>
            <tabpanel id="tabpanel_contacts_clients">
              <groupbox>
                <description>Préparation</description>
                <vbox>
                  <button label="Correspondances des pays d'adresses" oncommand="pf_preparation('2');"/>
                  <button label="Associer les pays" oncommand="pf_ouvre_pays_ines();"/>

                  <button label="Importer les fonctions" oncommand="pf_importation_critere_cli('92','CT_FONCTION','contacts');"/>
                  <button label="Importer les civilités " oncommand="pf_importation_critere_cli('86','CT_GENRE','contacts');"/>
                  
                </vbox>
              </groupbox>   
              <groupbox>
                <description>Importation</description>
                <vbox>
                <label value="Civilités"/>
                $ml_civilite_01
                <label value="Courriels"/>
                $ml_courriel_01
                <label value="Téléphones"/>
                $ml_tel_01
                <label value="Préfixes internationaux Tel"/>
                $ml_prefixe_tel_01
                <label value="Portables"/>
                $ml_por_01
                <label value="Préfixes internationaux Portables"/>
                $ml_prefixe_por_01
				<button label="Importer" oncommand="pf_importation('2');"/>
				</vbox>
             </groupbox>   
              <groupbox>
                
                <description>Annexes</description>
                <vbox>
                  <button label="Importer les 'Reçoit emailing'		"							 oncommand="pf_importation_critere_contacts_perso('10020','Reçoit emailing','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Style'				"							 oncommand="pf_importation_critere_contacts_perso('10021','Style','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="?Importer les 'Date création fiche'	"							 oncommand="pf_importation_critere_contacts_perso('','Date création fiche','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Origine'			"								 oncommand="pf_importation_critere_contacts_perso('10022','Origine','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'contacté'		"								 oncommand="pf_importation_critere_contacts_perso('10023','contacté','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'INSEAD'			"								 oncommand="pf_importation_critere_contacts_perso('10024','INSEAD','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Apport'			"								 oncommand="pf_importation_critere_contacts_perso('10025','Apport','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Local'			"								 oncommand="pf_importation_critere_contacts_perso('10026','Local','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Appel entrant'	"								 oncommand="pf_importation_critere_contacts_perso('10027','Appel entrant','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Date signature contrat'"							 oncommand="pf_importation_critere_contacts_perso('10028','Date signature contrat','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Situation'	"									 oncommand="pf_importation_critere_contacts_perso('10029','Situation','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'En recherche de franchise depuis'	"			 oncommand="pf_importation_critere_contacts_perso('10030','En recherche de franchise depuis','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'POOL'			"								 oncommand="pf_importation_critere_contacts_perso('10031','POOL','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Secteurs d'activité préférés'	"				 oncommand="pf_importation_critere_contacts_perso('10032','$lib_10032','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Ville d'implantation'			"				 oncommand="pf_importation_critere_contacts_perso('10033','$lib_10033','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Secteurs d'activité exclus'	"					 oncommand="pf_importation_critere_contacts_perso('10034','$lib_10034','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Veut avoir signé un contrat de franchise dans'"	 oncommand="pf_importation_critere_contacts_perso('10035','Veut avoir signé un contrat de franchise dans','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Interessé'	" 									 oncommand="pf_importation_critere_contacts_perso('10036','Interessé','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'Urgent'			"								 oncommand="pf_importation_critere_contacts_perso('10037','Urgent','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'FACEBOOK'	" 									 oncommand="pf_importation_critere_contacts_perso('10038','FACEBOOK','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  <button label="Importer les 'EXPORT'			"								 oncommand="pf_importation_critere_contacts_perso('10039','EXPORT','contacts_personnalisation','CHV_VALEUR_TEXTE','0');"/>
                  
                  
                </vbox>
              </groupbox>
            </tabpanel>
            <tabpanel id="tabpanel_actions">
              <groupbox>
                <description>Préparation</description>
                <vbox>
                  <button label="Pas de préparation particulière" oncommand="alert('On vous a dit qu\'il n\'y avait rien !!');"/>
                </vbox>
              </groupbox>   
              <groupbox>
                <description>Importation</description>
                <hbox>
				<button label="Importer les actions classiques" oncommand="pf_importation('3');"/>
				<button label="Importer les factures clients" oncommand="pf_importation('4');"/>
				</hbox>
              </groupbox>   
            </tabpanel>

            <tabpanel id="tabpanel_article">
              <vbox>
              <groupbox>
                <description>1 Importation des articles</description>
                <button label="Importer" oncommand="pf_importation('5');"/>
              </groupbox>
             </vbox>   
            </tabpanel>
          </tabpanels>
        </tabbox>
      </groupbox>
    </groupbox>
  </vbox>
</window>
END;

function pf_menulist_criteres($id,$portee){
	$sql_req = "SELECT critere_cleunik,critere_denomination FROM _criteres WHERE critere_actif=1 and critere_cleunik >9999 and critere_portee & $portee";
	$sql_result = _graal_requete_bd($sql_req);
	$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
	$ml="";
	if ($vl_e_nombre_valeurs != 0) {
		$ml.=('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" value="" flex="15" class="normal" id="'.$id.'" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
		$ml.=('<menupopup>');
		$ml.=("<menuitem value='0' id='0' _graal_cleunik='0' label='Aucun' selected='true'/>");
		while ($row = mysql_fetch_assoc($sql_result)) {
  			$ml.=("<menuitem crop='none' value='" .fa_remplace_quotes(fa_ent_xml($row['critere_cleunik'])). "' id='".$row['critere_cleunik'] ."' _graal_cleunik='".$row['critere_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['critere_denomination']))."'/>");
   		}
		$ml.="</menupopup>";
		$ml.="</menulist>";
	}
	_graal_libere_requete_bd($sql_result);
	return $ml;
}
function pf_menulist_choix($id,$portee,$critere){
	$sql_req = "SELECT _choix.choix_cleunik AS choix_cleunik,_choix.choix_valeur_texte_01 AS 'valeur' FROM _choix WHERE _choix.choix_actif=1 and _choix.critere_cleunik IN ($critere) and  choix_portee & $portee";
	$sql_result = _graal_requete_bd($sql_req);
	$vl_e_nombre_valeurs=mysql_num_rows($sql_result);
	$ml="";
	if ($vl_e_nombre_valeurs != 0) {
		$ml.=('<menulist sizetopopup="none" onfocus="setTimeout(fa_focus_gere_menulist, 0, this);" value="" class="normal" id="'.$id.'" _graal_nombre="'.$vl_e_nombre_valeurs.'">');
		$ml.=('<menupopup>');
		while ($row = mysql_fetch_assoc($sql_result)) {
  			$ml.=("<menuitem crop='none' value='" .fa_remplace_quotes(fa_ent_xml($row['choix_cleunik'])). "' id='".$row['choix_cleunik'] ."' _graal_cleunik='".$row['choix_cleunik']."' label='".fa_remplace_quotes(fa_ent_xml($row['valeur']))."'/>");
  		}
		$ml.=("</menupopup></menulist>");
	}
	_graal_libere_requete_bd($sql_result);
	return $ml;
	//return $sql_req;
	//return $vl_e_nombre_valeurs;
}
?>
