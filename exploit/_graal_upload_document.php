<?php
define('EOL', "\r\n");
include("_graal_header_txt.inc.php");
include("_graal_var_portee.php");
include("_graal_fonctions_documents.php");
$vf_c_genre=fa_recup_param('genre','utilis');
$vl_e_portee_cleunik=fa_recup_param('portee_cleunik','0');
$vl_c_quelsdocs=fa_recup_param('quelsdocs','?');
$vl_c_nom_fichier=fa_recup_param('vl_c_nom_fichier','??');
/*
le 29 septembre 2010
  typedoc    1 -> Liens,
             2 -> Notes,
             3 -> Documents,
             4 -> Dossier,
             5 -> courriels envoyés,
             6 -> modèles de courriels texte,
             7 -> Flux RSS,
             8 -> requêtes personnelles,
             9 -> images des articles, logos de l'entreprise
            10 -> modèles de courriels HTML,
            11 -> modèles de notes,
            12 -> modèles de notification de lecture,
            13 -> pièces jointes,
            14 -> menus arbres personalisés
            15 -> menus pages personalisés
           101 -> modèles textes entêtes offres clients,
           102 -> modèles textes pied offres clients,
           111 -> modèles textes entêtes commandes clients,
           112 -> modèles textes pied commandes clients,
           121 -> modèles textes entêtes livraison clients,
           122 -> modèles textes pied livraison clients,
           131 -> modèles textes entêtes facture clients,
           132 -> modèles textes pied facture clients,
           141 -> modèles textes entêtes demandes fournisseur,
           142 -> modèles textes pied demandes fournisseur,
           151 -> modèles textes entêtes commandes fournisseur,
           152 -> modèles textes pied commandes fournisseur,
           153 -> modèles formulaires de fiches palettes,
           154 -> fichiers pdf de filigranne de documents,
           900 -> Conditions générales de vente
           901 -> Bloc de désinscription pour emailing html
           902 -> Bloc de désinscription pour emailing texte
           903 -> Bloc de sondage pour emailing html
           904 -> Bloc de sondage pour emailing texte
*/
set_time_limit(6000);
$name=$_FILES['filename']['name'];
$size=$_FILES['filename']['size'];
$tmp=$_FILES['filename']['tmp_name'];
$type=$_FILES['filename']['type'];  //  Pas fiable : regarde, a priori, l'extension !!
$error=$_FILES['filename']['error'];
$droits_proprio=15; //  1+2+4+8
$droits_groupe=0;
$droits_lambda=0;


$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));

switch ($vl_c_quelsdocs){
  case "undoc_action"   : $typedoc=3;break;   //  Un lien d'action
  case "uneimg_articl"  : $typedoc=9;break;   //  Une image article
  case "undoc_interl"   : $typedoc=3;break;   //  Un lien d'acteur
  case "undoc_articl"   : $typedoc=3;break;   //  Un lien d'acteur
  case "undoc_acteur"   : $typedoc=3;break;   //  Un lien d'acteur
  case "undoc"          : $typedoc=3;break;   //  Un lien sélectionné
  case "medoc"          : $typedoc=3;break;  //Mes documents
  case "nosdocs"        : $typedoc=3;break;  // Nos documents
  case "leurdocs"       : $typedoc=3;break; //  Leurs documents
  case "undoc_entrep"   : $typedoc=3;break;   //  Un document d'entreprise
  case "unlogoentrep"  	: $typedoc=9;break;   //  Un logo d'entreprise
  case "cgv"  			: $typedoc=900;break;   //  Les conditions générales de ventes
  case "palett"			: $typedoc=153;break;   //  Formulaire de palette
  case "filigrane"		: $typedoc=154;break;   //  Fichier filigrane
  default : fa_redirige("acces_bizar");break;
}
$vl_c_nom_fichier=addslashes($vl_c_nom_fichier);
$vf_e_doc_cleunik=_graal_requete_max("doc_cleunik","_documents");
$vf_c_retour=fa_insere_document($vf_e_doc_cleunik,$vl_c_nom_fichier,$typedoc,$size,$tmp,$vf_c_genre,$vl_e_portee_cleunik,$vl_e_uti_cleunik,$droits_proprio,$droits_groupe,$droits_lambda);
//$vf_c_retour=$tmp;
echo $vf_c_retour;
_graal_ferme_connexion();
?>
