<?php
_graal_requete_charge_varlib($vl_c_id_article_nome_achats,$vl_e_uti_cleunik);
error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);  //  Pour éviter les warnings éventuels générés par simplexml_load_string
$vl_c_bqj_001=fa_recup_dico("bqj_001");
$vl_c_bqj_002=fa_recup_dico("bqj_002");
$vl_c_bqj_003=fa_recup_dico("bqj_003");
$vl_c_bqj_004=fa_recup_dico("bqj_004");
$vl_c_bqj_005=fa_recup_dico("bqj_005");
$vl_c_bqj_007=fa_recup_dico("bqj_007");
$vl_c_bqj_008=fa_recup_dico("bqj_008");
$vl_c_bqj_009=fa_recup_dico("bqj_009");
$vl_c_bqj_010=fa_recup_dico("bqj_010");
$vl_c_bqj_011=fa_recup_dico("bqj_011");
$vl_c_bqj_013=fa_recup_dico("bqj_013");
$vl_c_bqj_018=fa_recup_dico("bqj_018");
$vl_c_bqj_019=fa_recup_dico("bqj_019");
$vl_c_bqj_020=fa_recup_dico("bqj_020");
$vl_c_bqj_021=fa_recup_dico("bqj_021");
$vl_c_bqj_022=fa_recup_dico("bqj_022");
$vl_c_bqj_023=fa_recup_dico("bqj_023");
$vl_c_bqj_024=fa_recup_dico("bqj_024");
$vl_c_bqj_025=fa_recup_dico("bqj_025");
$vl_c_bqj_026=fa_recup_dico("bqj_026");
$vl_c_dico_00001=fa_recup_dico('dico_00001');
$vl_c_dico_00002=fa_recup_dico('dico_00002');
$vl_c_dico_00003=fa_recup_dico('dico_00003');
$vl_c_dico_00004=fa_recup_dico('dico_00004');
$vl_c_dico_00005=fa_recup_dico('dico_00005');
$vl_c_dico_00006=fa_recup_dico('dico_00006');
$vl_c_dico_00007=fa_recup_dico('dico_00007');
$vl_c_id_fen_nomenclature_ach="Fen_00775";
$vl_tb_droits_nomenc_ach=_graal_requete_droits_fenetre($vl_c_id_fen_nomenclature_ach,$vl_e_uti_cleunik);
if ($vl_tb_droits_nomenc_ach[1]!=0){ $vl_c_ajouter="<button id='bt_nomclatureach_ajouter' class='ajouter' observes='broadcaster_01' tooltiptext='$vl_c_dico_00002' label='$vl_c_dico_00002' oncommand='pf_nomclatureach_ajouter()'/>";}
if ($vl_tb_droits_nomenc_ach[2]!=0){ $vl_c_modifier="<button id='bt_nomclatureach_modifier' class='modifier' observes='broadcaster_01' tooltiptext='$vl_c_dico_00003' label='$vl_c_dico_00003' oncommand='pf_nomclatureach_modifier()'/>";}
if ($vl_tb_droits_nomenc_ach[3]!=0){ $vl_c_supprimer="<button id='bt_nomclatureach_supprimer' class='supprimer' observes='broadcaster_01' tooltiptext='$vl_c_dico_00004' label='$vl_c_dico_00004' oncommand='pf_nomclatureach_supprimer()'/>";}
if (($vl_tb_droits_nomenc_ach[1]!=0) or ($vl_tb_droits_nomenc_fab[2]!=0) or ($vl_tb_droits_nomenc_fab[3]!=0)) {
  $vl_c_enregistrer="<button observes='broadcaster_01' class='enregistrer' id='bt_val_nomencach' tooltiptext ='$vl_c_dico_00005' label='$vl_c_dico_00005' oncommand='pf_nomclatureach_valider()'/>";
  $vl_c_annuler="<button observes='broadcaster_01' class='annuler' id='bt_nomencach_annuler' tooltiptext ='$vl_c_dico_00006' label='$vl_c_dico_00006' oncommand='pf_nomclatureach_annuler()'/>";
}
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
$selection_article=fa_ent_xml($vl_c_xml->selection_article->attributes());
echo <<<END
<hbox flex="1">
<vbox flex="3">
      <toolbar grippyhidden="true">
  		  <toolbarbutton class="table-rafraichir" tooltiptext="$vl_c_bqj_001" oncommand="pf_affiche_donnees_nomenclature_ach();"/>
      </toolbar>
<popup id="pop_nomclatureach_arbre_nomenc">
  <menuitem class="menuitem-iconic ai07" label="$vl_c_bqj_013" oncommand="pf_ouvre('nomenc_ach');" />
</popup>
<tree id="arbre_nomenc_ach" flex="20" seltype="single" onselect="pf_sel_arbre_nomenc_ach();" context="pop_nomclatureach_arbre_nomenc">
  <treecols>
    <treecol id="arbre_nomenc_ach_col01" flex="1" label="$vl_c_bqj_007"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_codearticle" flex="3" label="$vl_c_bqj_009"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_quantite" flex="1" label="$vl_c_bqj_008" class="droite" /><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_col02"  class="colname" primary="true" flex="20" label="$vl_c_bqj_011" /><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_art_cleunik_pere"  hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_art_cleunik_fils"  hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
    <treecol id="arbre_nomenc_ach_modifiable" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" />
  </treecols>
  <treechildren id="fils_arbre_nomenc_ach">
  </treechildren>
</tree>
</vbox>
<splitter/>
<vbox id="bqj_art_nomenclatures_ach_02"> 
<groupbox flex="1">
  <caption><label value="$vl_c_bqj_018"/></caption>
        <grid flex="1">
          <columns >
           <column flex="1" />
           <column flex="4" />
          </columns>
          <rows>
           <row >
             <label value="$vl_c_bqj_007"/>
             <textbox observes="broadcaster_03" id="tb_nomencach_noligne" type="number" hidespinbuttons="true" size="3"   />
           </row>
           <row >
            <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_03" flex="1" id="selart_nomenc_ach_ml_zone" class="normal" oncommand="pf_param_choix_selart_nomenc_ach();" value="$selection_article">
              <menupopup>
                <menuitem label="$vl_c_bqj_010" value="1"/>
                <menuitem label="$vl_c_bqj_009" value="2"/>
                <menuitem label="$vl_c_bqj_019" value="3"/>
              </menupopup>
            </menulist>

            <hbox>
            <textbox observes="broadcaster_03" flex="1" type="autosuggest" autosuggestsearch="" autosuggestparam="recherche" autosuggestlimit="limit" limit="50"
              minlength="2"
              maxrows="50"
              ref="urn:suggest:values"
              label="?label"
              properties="?prop"
              issuggest="?issuggest"
               
              
              _graal_cleunik=""
              id="selart_nomenc_ach"
            />
            <button observes="broadcaster_03" class="ad02" oncommand="pf_nomclatureach_sel_article_pour_ligne();"/>
            </hbox>
           </row>
           <row >
             <label value="$vl_c_bqj_009"/>
             <textbox readonly="true" id="tb_nomencach_codefils"   />
           </row>
           <row >
             <label value="$vl_c_bqj_010"/>
             <textbox readonly="true" id="tb_nomencach_descourfils"   />
           </row>
           <row >
             <label value="$vl_c_bqj_008"/>
             <hbox>
               <textbox observes="broadcaster_03" id="tb_nomencach_quantite" type="number" hidespinbuttons="true" decimalplaces="2"  onblur="pf_nomenclatureach_valorise();" />
               <label value="$vl_c_bqj_020"/>
               <textbox observes="broadcaster_03" id="tb_nomencach_nbdecimales" max="4" min="0" type="number"  onblur="fa_att_set('tb_nomencach_quantite','decimalplaces',this.value);" flex="1"/>
            </hbox>
           </row>
           <row >
             <label value="$vl_c_bqj_021"/>
                <hbox>
                  <textbox id="tb_nomencach_valorisation" type="number" hidespinbuttons="true" decimalplaces="2" readonly="true"  onblur="pf_nomenclatureach_valorise();" _graal_base_valorisation=""/>
                  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_03" flex="1" id="ml_nomencach_base_valorisation" oncommand="pf_nomclatureach_change_menu_actifs_base_valorisation();" flags="" ref="*" querytype="xml" datasources="">
                    <template><query expr="*"/><action>
                      <menupopup>
                        <menuitem uri="?" class="menuitem-iconic ?prop" _graal_nombre="?nombre" label="?tar_designation" value="?tar_cleunik" _graal_cleunik="?tar_cleunik" _graal_base_valorisation="?pu_reference"/> <!--  Les tarifs -->
                      </menupopup>
                    </action></template>
                  </menulist>
                  
                </hbox>
            </row>
           <row >
             <label value="$vl_c_bqj_022"/>
             <hbox>
               <textbox observes="broadcaster_03" id="tb_nomencach_valeur_complement" type="number" hidespinbuttons="true" decimalplaces="2"  onblur="pf_nomenclatureach_valorise();" />
               <label value="Type"/>
                <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes="broadcaster_03" flex="1" id="ml_nomencach_valeur_complement_type" class="normal" oncommand="pf_nomenclatureach_valorise();">
              <menupopup>
                <menuitem label="$vl_c_bqj_023" value="1" selected="true"/>
                <menuitem label="$vl_c_bqj_024" value="2" />
              </menupopup>
            </menulist>
            </hbox>
            </row>
           <row >
             <label value="$vl_c_bqj_025"/>
                <hbox>
                  <textbox id="tb_nomencach_valeurligne" type="number" hidespinbuttons="true" decimalplaces="2" readonly="true"  />
                  <_graal_raf flex="1" />
                </hbox>
            </row>

           <row flex= "10">
             <label value="$vl_c_bqj_026" flex="10"/>
             <textbox observes="broadcaster_03" id="tb_nomencach_blocnotebrut" multiline="true" row="10"   flex= "10"/>
           </row>
					<row flex= "1" collapsed="true">
						<_graal_raf />
						<hbox flex="1">
							<caption><label value="$vl_c_bqj_002" /></caption>
		          <radiogroup id='rdg_nomencach_ajout_pa_pere' flex="1" value="2" disabled="true">
		            <hbox>
		              <radio id='ra_nomencach_ajout_pa_pere_oui' label="$vl_c_dico_00013" value='1' />
		              <spacer flex="1"/>
		              <radio id='ra_nomencach_ajout_pa_pere_non' label="$vl_c_dico_00014" value='2'/>
		             </hbox>
		           </radiogroup>
						</hbox>	
					</row>	
					<row flex= "1">
						<_graal_raf />
						<hbox flex="1">
							<caption><label value="$vl_c_bqj_003" /></caption>
		          <radiogroup id='rdg_nomencach_ajout_pr_pere' flex="1" value="1" >
		            <hbox>
		              <radio id='ra_nomencach-ajout_pr_pere_oui' label="$vl_c_dico_00013" value='1' observes="broadcaster_03"/>
		              <spacer flex="1"/>
		              <radio id='ra_nomencach_ajout_pr_pere_non' label="$vl_c_dico_00014" value='2' observes="broadcaster_03"/>
		             </hbox>
		           </radiogroup>
						</hbox>	
					</row>
					<row flex= "1" collapsed="true">
						<_graal_raf />
						<hbox flex="1">
							<caption><label value="$vl_c_bqj_004" /></caption>
		          <radiogroup id='rdg_nomencach_gere_stock' flex="1" value="2" disabled="true">
		            <hbox>
		              <radio id='ra_nomencach_gere_stock_oui' label="$vl_c_dico_00013" value='1' />
		              <spacer flex="1"/>
		              <radio id='ra_nomencach_gere_stock_non' label="$vl_c_dico_00014" value='2'/>
		             </hbox>
		           </radiogroup>
						</hbox>	
					</row>	
					<row flex= "1" collapsed="true">
						<_graal_raf />
						<hbox flex="1">
							<caption><label value="$vl_c_bqj_005" /></caption>
		          <radiogroup id='rdg_nomencach_gere_classique' flex="1" value="2" disabled="true">
		            <hbox>
		              <radio id='ra_nomencach_gere_classique_oui' label="$vl_c_dico_00013" value='1' />
		              <spacer flex="1"/>
		              <radio id='ra_nomencach_gere_classique_non' label="$vl_c_dico_00014" value='2'/>
		             </hbox>
		           </radiogroup>
						</hbox>	
					</row>	
          </rows>
        </grid>
<hbox>
$vl_c_ajouter<spacer flex="1"/>
$vl_c_modifier<spacer flex="1"/>
$vl_c_supprimer<spacer flex="1"/>
$vl_c_enregistrer<spacer flex="1"/>
$vl_c_annuler<spacer flex="1"/>
</hbox>
</groupbox>
</vbox>
</hbox>
END;
?>
