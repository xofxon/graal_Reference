<?php
include("_graal_header_txt.inc.php");
include("_import_class_data_km.php");
/* Valable pour descriptifs APISoft Version ??????????? */
define('EOL', "\r\n");
set_time_limit(600);
$vl_c_base_origine=fa_recup_param('vl_c_base_origine','apisoft_bar_gc');
$vl_c_base_destination=fa_recup_param('vl_c_base_destination','graal_bar_02');
$vl_e_critere_cleunik_unite_achat=110;
$vl_e_critere_cleunik_unite_vente=109;
$vl_e_critere_cleunik_unite_stock=108;
$vf_e_choix_cleunik=_graal_requete_max("choix_cleunik","$vl_c_base_destination._choix");
$o_unite=new _graal_import();
$o_unite->req="INSERT INTO $vl_c_base_destination._choix (critere_cleunik,choix_cleunik,choix_code,choix_valeur_texte_01,choix_actif) VALUES ";
//  Recherche pour unités achats
$sql_req = "SELECT Unite FROM $vl_c_base_origine.unitemesure where Unite not in (select choix_code from $vl_c_base_destination._choix where critere_cleunik=$vl_e_critere_cleunik_unite_achat)";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)){
  $vf_e_choix_cleunik++;
  $i++;
  $choix_code=addslashes($row['Unite']);
  $choix_valeur_texte_01=addslashes($row['Unite']);
  $o_unite->dat.="($vl_e_critere_cleunik_unite_achat,$vf_e_choix_cleunik,'$choix_code','$choix_valeur_texte_01',1),";
}
_graal_libere_requete_bd($result);
//  Recherche pour unités ventes
$sql_req = "SELECT Unite FROM $vl_c_base_origine.unitemesure where Unite not in (select choix_code from $vl_c_base_destination._choix where critere_cleunik=$vl_e_critere_cleunik_unite_vente)";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)){
  $vf_e_choix_cleunik++;
  $i++;
  $choix_code=addslashes($row['Unite']);
  $choix_valeur_texte_01=addslashes($row['Unite']);
  $o_unite->dat.="($vl_e_critere_cleunik_unite_vente,$vf_e_choix_cleunik,'$choix_code','$choix_valeur_texte_01',1),";
}
_graal_libere_requete_bd($result);
//  Recherche pour unités stocks
$sql_req = "SELECT Unite FROM $vl_c_base_origine.unitemesure where Unite not in (select choix_code from $vl_c_base_destination._choix where critere_cleunik=$vl_e_critere_cleunik_unite_stock)";
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)){
  $vf_e_choix_cleunik++;
  $i++;
  $choix_code=addslashes($row['Unite']);
  $choix_valeur_texte_01=addslashes($row['Unite']);
  $o_unite->dat.="($vl_e_critere_cleunik_unite_stock,$vf_e_choix_cleunik,'$choix_code','$choix_valeur_texte_01',1),";
}
_graal_libere_requete_bd($result);
//  Insertion
$o_unite->execute();
echo("$i unités importées.");
?>
