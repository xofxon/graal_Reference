<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_c_dico_00079=fa_recup_dico('dico_00079');
$vl_c_dico_00080=fa_recup_dico('dico_00080');
$vl_c_dico_00081=fa_recup_dico('dico_00081');
$vl_c_dico_00091=fa_recup_dico('dico_00091');
$vl_c_dico_00092=fa_recup_dico('dico_00092');
$genreaction=fa_recup_param("genreaction","??");
$vl_commercial_cleunik=intval(fa_recup_param("vl_commercial_cleunik",-1));
switch ($genreaction){
  case "offcli":
  case "cdecli":
  case "livcli":
  case "faccli":
  case "demfou":
  case "cdefou":
  case "recfou":
  case "facfou":
  case "retcli":
  case "retfou":
    $fichier="_".$genreaction."_representants";
    break;
  case "avocli":
	case "avofin":
    $fichier="_avocli_representants";
    break;
  case "avofou":
	case "avofif":
    $fichier="_avofou_representants";
    break;
  default:
    $fichier="foireux";
    break;  //  Toutes les actions génériques
}
$vl_e_act_cleunik=intval(fa_recup_param('vl_e_act_cleunik','10007305'));
$sql_req = "SELECT f1.action_rep_cleunik as `action_rep_cleunik`,f1.act_cleunik_rep as `act_cleunik_rep`,f2.raisonsoc as qui,f1.commission_typ as `type`,f1.commission_taux as `taux`,f1.commission_fixe as `fixe`,f1.commission_regle as `regle` FROM $fichier f1 left join _acteurs f2 on(f1.act_cleunik_rep=f2.act_cleunik) where commercial_cleunik=$vl_commercial_cleunik;";
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' act_cleunik_rep="'.fa_ent_xml($row['act_cleunik_rep']).'"');
  echo(' action_rep_cleunik="'.fa_ent_xml($row['action_rep_cleunik']).'"');
  echo(' qui="'.fa_ent_xml($row['qui']).'"');
  switch ($row['type']) {
    case 1 : echo(' type="'.$vl_c_dico_00079.'"');break;
    case 2 : echo(' type="'.$vl_c_dico_00080.'"');break;
    case 3 : echo(' type="'.$vl_c_dico_00081.'"');break;
  }
  switch ($row['regle']) {
    case 1 : echo(' regle="'.$vl_c_dico_00091.'"');break;
    case 2 : echo(' regle="'.$vl_c_dico_00092.'"');break;
  }
  if ($row['taux']==0) {
    echo(' taux=""');
  } else {
    echo(' taux="'.fa_ent_xml($row['taux']).'"');
  }
  if ($row['fixe']==0) {
    echo(' fixe=""');
  } else {
    echo(' fixe="'.fa_ent_xml($row['fixe']).'"');
  }
  	echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
