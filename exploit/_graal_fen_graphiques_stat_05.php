<?php
include("_graal_header_xul.inc.php");
include("_graal_var_portee.php");
$vl_c_id_fenetre="Fen_00073"; //Représentations statisques sous forme de graphique
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_genre=fa_recup_param("genre",'graal');
$vl_nature=fa_recup_param("nature",'graal');
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_dico_00106=fa_recup_dico("dico_00106");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$export_oocalc="";
/*
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t01,$vl_e_uti_cleunik);
$vl_b_acces=$vl_tb_droits[0];
*/
//$vl_b_acces=true;$vl_c_t01="Exporter vers OpenOffice Calc";if ($vl_b_acces==true) {$export_oocalc=('<menuitem label="'.$vl_c_t01.'" oncommand="pf_recup_requete(\'ods\');" class="menuitem-iconic ac12" />');}
//$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t02,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t02.'" oncommand="pf_recup_requete(\'rdf\');" class="menuitem-iconic ak02" collapsed="true"/>');}
//$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t03,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t03.'" oncommand="pf_recup_requete(\'htm\');" class="menuitem-iconic ak03" />');}
//$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t04,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==true) {echo('<menuitem label="'.$vl_c_t04.'" oncommand="pf_recup_requete(\'xml\');" class="menuitem-iconic ak04" disabled="true"/>');}

/*
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t05,$vl_e_uti_cleunik);
$vl_b_acces=$vl_tb_droits[0];
*/
$vl_b_acces=true;$vl_c_t05="Exporter vers Microsoft Excel";
if ($vl_b_acces==true) {$export_oocalc.=('<menuitem label="'.$vl_c_t05.'" oncommand="pf_calcule_excel();" class="menuitem-iconic ak05" dir="reverse"/>');}
//echo ('<menuseparator />');
$popup_acteur=<<<EOT
<popupset>
  <popup id="pop_selections_cial">
  <menuitem class="menuitem-iconic ad09" label="$vl_c_dico_00106" oncommand="fa_infos_colonnes_arbre_recup('$vl_c_id_fenetre','arbre_des_stats_cial_09');" />
    <menuitem class="menuitem-iconic ai15" label="Ouvrir la fiche acteur" oncommand="pf_acteur_ouvre();" />
	<menuitem class="menuitem-iconic ag01" label="Ouvrir les statistiques acteur" oncommand="pf_acteur_ouvre_stats();" />
	$export_oocalc	
  </popup>
</popupset>
EOT;
$vl_c_url_alimente_menu="_graal_das_paniers_01.php?vl_e_maportee=";

    $cial_01="false";$cial_02="true";$cial_03="false";$cial_04="false";$cial_05="false";$cial_06="false";$cial_07="false";$cial_08="false";
    switch ($vl_genre) {
      case "faccli_avocli":$_graal_nombre="1";$mi="<menuitem class='menuitem-non-iconic' value='4' label='Factures/Avoirs clients' selected='true' />";break;
      case "faccli":$_graal_nombre="1";$mi="<menuitem class='menuitem-non-iconic' value='9' label='Factures clients seules' selected='true' />";break;
      case "avocli":$_graal_nombre="1";$mi="<menuitem class='menuitem-non-iconic' value='10' label='Avoirs clients seuls' selected='true' />";break;
      case "facfou":$_graal_nombre="1";$mi="<menuitem class='menuitem-non-iconic' value='8' label='Factures fournisseurs' selected='true' />";break;
    }
    $ml="<menulist sizetopopup='none' onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex='1' id='ml_art_03' _graal_nombre='$_graal_nombre'><menupopup>$mi</menupopup></menulist>";
    $vl_nombre_sel_art=12;
    $vl_c_source_paniers="$vl_c_url_alimente_menu$vl_e_client";
    $sql_req="select distinct(year(dateheure_confirm)) as 'Années' from _faccli_lignes_qte order by 1";
    $sql_result = _graal_requete_bd($sql_req);
  $vl_e_nombre_types=mysql_num_rows($sql_result);
	$vl_e_nombre_types++;	//	il faut compter la ligne "Tous les statuts"
	$vv_brik='';
  $vv_brik.='<menupopup>';
  $vv_treecol="";$vv_teecell="";
  while ($row = mysql_fetch_assoc($sql_result)) {
    $vv_brik.="<menuitem crop='none' value='" .fa_remplace_quotes(fa_ent_xml($row['Années'])). "' label='".fa_remplace_quotes(fa_ent_xml($row['Années']))."'  tooltiptext='".fa_remplace_quotes(fa_ent_xml($row['Années']))."' />";
  	$value=fa_ent_xml($row['Années']);
  	$vv_treecol.=<<<EOT
  		<treecol class="droite" id="CA_$value" label="CA $value" old_sort="?CA_$value"/><splitter class="tree-splitter" resizeafter="grow"/>
EOT;
$vv_treecell.=<<<EOT
	<treecell label="?CA_$value"/>
EOT;
  }
  $vv_brik.='</menupopup>';
  $vv_brik.='</menulist>';
  _graal_libere_requete_bd($sql_result);
    $vv_brik='<menulist sizetopopup="none" hidden="true" class="sans_icone" flex="1" id="ml_annee" value="'.$value.'">'.$vv_brik;
    
    
    
$corpus_deck06_cial_01=<<<EOT
   <_graal_deck value="Deck n° 6 pour un les documents commerciaux">
    <vbox flex="1">
    <hbox>
    <menulist sizetopopup="none" class="sans_icone" flex="1" id="ml_panier_acteurs_01" flags="" ref="*" querytype="xml" datasources="$vl_c_source_paniers" value="1">
      <menupopup>
          <menuitem class='menuitem-non-iconic' crop="none" label='Pas de sélection particulière' selected='true' _graal_cleunik="1"/>
      </menupopup>
      <template><query expr="*"/><action>
        <menupopup>
          <menuseparator/>
          <menuitem uri="?" class="menuitem-iconic ?prop" label="?panier_titre" selected="true" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers -->
        </menupopup>
      </action></template>
    </menulist>
    $ml
        <menulist sizetopopup="none" class="sans_icone" flex="1" id="ml_art_02" _graal_nombre="4'" value="4">
          <menupopup>
            <menuitem class='menuitem-non-iconic' value='1' label='Quantité' hidden="true"/>
            <menuitem class='menuitem-non-iconic' value='2' label='Valeur brute ((PU*Qté) (Offerts compris)' />
            <menuitem class='menuitem-non-iconic' value='4' label='Valeur nette (PU*Qté)- % Remises(ligne, bas)(Offerts exclus)' selected='true' />
            <menuitem class='menuitem-non-iconic' value='3' label='Nombre de lignes' hidden="true"/>
          </menupopup>
        </menulist>
        <button id="bt_calcul" label="Calculer" onclick="pf_calcule();" />
    </hbox>
      <hbox hidden="true">
$vv_brik
        <label value="Regroupé par "/>
        <menulist sizetopopup="none" class="sans_icone" flex="1" id="ml_art_04" _graal_nombre="5'" value="5">
          <menupopup>
            <menuitem class='menuitem-non-iconic' value='1' hidden="true" label='jour' />
            <menuitem class='menuitem-non-iconic' value='2' hidden="true" label='semaine'  />
            <menuitem class='menuitem-non-iconic' value='3' hidden="true" label='mois'  />
            <menuitem class='menuitem-non-iconic' value='4' hidden="true" label='trimestre'  />
            <menuitem class='menuitem-non-iconic' value='5' label='année' selected='true' />
          </menupopup>
        </menulist>
        
      </hbox>
EOT;

$corpus_deck06_cial_02=<<<EOT
   </vbox>
   </_graal_deck>
EOT;
    
include("_graal_header_winxul.inc.php");
echo <<<END
<window context="graal_cp00" id="_graal_stat_01" title="Statistiques" _genre="$vl_genre" onload="fa_aa(this);pf_init();" onunload="pf_onunload();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_stat_05.js.php");
include_once("js/_graal_05_dates.js.php");
echo <<<END
<popup id="colorpicker1"><colorpicker onselect="pf_couleur('1',this.color);"/></popup>
<popup id="colorpicker2"><colorpicker onselect="pf_couleur('2',this.color);"/></popup>
<popup id="colorpicker3"><colorpicker onselect="pf_couleur('3',this.color);"/></popup>
<popup id="colorpicker4"><colorpicker onselect="pf_couleur('4',this.color);"/></popup>
$popup_article_01
$popup_acteur
<hbox id="hbox_panneaudegauche" flex="1">
<box id="datas" hidden="true" value=""/>  

<tabbox id="tabbox_01" flex="1" orient="vertical" class="overflow_01">
  <tabs id="tab_infogene">
     <tab class="$class_tabedition" id="tab_donnees" linkedpanel="tabpanel_donnees" first-tab="true" label="Données" selected="true"/>
     <tab class="af08" id="tab_graphe" linkedpanel="tabpanel_graphe" label="Paramètres graphe" hidden="true"/>
  </tabs>
  <tabpanels flex="1">
		<tabpanel id="tabpanel_donnnees" flex="1">
  <deck id="dk_01" selectedIndex="0" flex="1">
END;

    echo $corpus_deck06_cial_01;
    echo <<<END
    <tree id="arbre_des_stats_cial_09" flex="1" flags="" ref="*" querytype="xml" datasources="" enableColumnDrag="true" context="pop_selections_cial">
       <treecols>
       <treecol id="cleunik_reference" label="" old_sort="?cleunik_reference" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
       <treecol id="typeacteur" label="" old_sort="?typeacteur" hidden="true" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
<treecol id="Acteur" label="Acteur" old_sort="?Acteur"/><splitter class="tree-splitter" resizeafter="grow"/>
$vv_treecol
<treecol class="droite" id="CA_total" label="CA total" /><splitter class="tree-splitter" resizeafter="grow"/>
       </treecols>
       <template><query expr="*"/><action>
         <treechildren>
           <treeitem uri="?" seltype="single">
             <treerow>
			<treecell label="?cleunik_reference"/>
			<treecell label="?typeacteur"/>
             <treecell label="?Acteur"/>
$vv_treecell
<treecell label="?CA_total"/>
             </treerow>
           </treeitem>
         </treechildren>
       </action></template>
    </tree>
END;
    echo $corpus_deck06_cial_02;
   
echo <<<END
  </deck>
  </tabpanel>
END;
$raf=<<<EOT
		<tabpanel id="tabpanel_actions" flex="1">
include("_graal_inc_parametres_graphes_01.php");
</tabpanel>
EOT;
echo <<<END
    
  </tabpanels>
</tabbox>
</hbox>
END;
$raf=<<<EOT
<splitter />
<button id="bt_10" label="Voir" tooltiptext="Voir l'histogramme" onclick="pf_dessin()" />
<vbox flex="3">
    <iframe onload="event.stopPropagation();" id="webFrame" flex="3" />
</vbox>
EOT;
echo <<<END
</window>
END;


?>
