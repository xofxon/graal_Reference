<?php
include("_graal_header_txt.inc.php");
include("_import_class_data_km.php");
define('EOL', "\r\n");
$vl_e_uti_cleunik_ori=intval(fa_recup_param('vl_e_uti_cleunik_ori','0'));
$vl_e_uti_cleunik_des=intval(fa_recup_param('vl_e_uti_cleunik_des','0'));
$vl_e_type=intval(fa_recup_param('vl_e_type','0'));
$vl_e_mini=intval(fa_recup_session('borne_mini','0'));
$vl_e_maxi=intval(fa_recup_session('borne_maxi','0'));
$sql_req = "SELECT _droits_uti_fen.fen_cleunik as fen_cleunik,_droits_uti_fen.duf_acces as acces,_droits_uti_fen.duf_ajout as ajout,_droits_uti_fen.duf_modif as modif,_droits_uti_fen.duf_suppr as suppr FROM _droits_uti_fen,_objets WHERE _objets.type_objet=$vl_e_type and _objets.fen_cleunik=_droits_uti_fen.fen_cleunik and _droits_uti_fen.uti_cleunik=$vl_e_uti_cleunik_ori and _droits_uti_fen.fen_cleunik not in (select _droits_uti_fen.fen_cleunik from _droits_uti_fen where _droits_uti_fen.uti_cleunik=$vl_e_uti_cleunik_des)";
$duf_cleunik=_graal_requete_max("duf_cleunik","_droits_uti_fen");
$o_droits=new _graal_import();
$o_droits->req="INSERT INTO _droits_uti_fen (fen_cleunik,uti_cleunik,duf_cleunik,duf_acces,duf_ajout,duf_modif,duf_suppr) VALUES ";
$i=0;$i1=1000;
$result = _graal_requete_bd($sql_req);
while ($row = mysql_fetch_assoc($result)) {
  $fen_cleunik=$row['fen_cleunik'];
  $uti_cleunik=$vl_e_uti_cleunik_des;
  $duf_cleunik++;
  $duf_acces=$row['acces'];
  $duf_ajout=$row['ajout'];
  $duf_modif=$row['modif'];
  $duf_suppr=$row['suppr'];
  $i++;
  $o_droits->dat.="($fen_cleunik,$uti_cleunik,$duf_cleunik,$duf_acces,$duf_ajout,$duf_modif,$duf_suppr),";
  if ($i % $i1==0){
    $o_droits->execute();
  }
}
$o_droits->execute();
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
echo ("Duplication des $i droits terminÃ©e.")
?>
