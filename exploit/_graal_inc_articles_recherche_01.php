<?php
include("_graal_var_portee.php");
error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);  //  Pour éviter les warnings éventuels générés par simplexml_load_string
$vl_c_selqui_01="false";
$vl_c_selqui_02="false";
$vl_c_selqui_03="false";
$vl_c_selqui_04="false";
$vl_c_selqui_05="false";
$vl_c_selqui_06="false";
switch ($vl_c_id_article_recherche) {
  case "Div_00206":
  case "Div_00222":
  case "Div_00227":
  case "Div_00487":
    $vl_c_selqui_05="true";$vl_c_inactif="false";break;  //  Tous les articles
  case "Div_00207":
  case "Div_00223":
  case "Div_00228":
  case "Div_00488":
    $vl_c_selqui_02="true";$vl_c_inactif="true";break;  //  Favoris
  case "Div_00208":
  case "Div_00224":
  case "Div_00229":
  case "Div_00489":
  case "Div_00591":
    $vl_c_selqui_03="true";$vl_c_inactif="true";break;  //  Articles d'achats
  case "Div_00209":
  case "Div_00225":
  case "Div_00230":
  case "Div_00490":
    $vl_c_selqui_04="true";$vl_c_inactif="true";break;  //  Articles de vente
  case "Div_00210":
  case "Div_00226":
  case "Div_00231":
  case "Div_00491":
    $vl_c_selqui_06="true";$vl_c_inactif="true";break;  //  Articles de fabrication
  default: fa_redirige("acces_interdit");break; 
  } 
//Recherche de tous les articles
_graal_requete_charge_varlib($vl_c_id_article_recherche,$vl_e_uti_cleunik);
$vl_c_dico_00018=fa_recup_dico("dico_00018");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00038=fa_recup_dico("dico_00038");
$vl_c_dico_00039=fa_recup_dico("dico_00039");
$vl_c_dico_00040=fa_recup_dico("dico_00040");
$vl_c_dico_00041=fa_recup_dico("dico_00041");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");

$vl_c_bbo_002=fa_recup_dico("bbo_002");
$vl_c_bbo_005=fa_recup_dico("bbo_005");
$vl_c_bbo_006=fa_recup_dico("bbo_006");
$vl_c_bbo_008=fa_recup_dico("bbo_008");
$vl_c_bbo_009=fa_recup_dico("bbo_009");
$vl_c_bbo_010=fa_recup_dico("bbo_010");
$vl_c_bbo_011=fa_recup_dico("bbo_011");
$vl_c_bbo_012=fa_recup_dico("bbo_012");
$vl_c_bbo_013=fa_recup_dico("bbo_013");
$vl_c_bbo_014=fa_recup_dico("bbo_014");
$vl_c_bbo_015=fa_recup_dico("bbo_015");
$vl_c_bbo_016=fa_recup_dico("bbo_016");

$vl_c_source_paniers="_graal_das_paniers_01.php?vl_e_maportee=$vl_e_articl";
$vl_c_xml=simplexml_load_string(fa_recup_session("vs_param_environ",""));
$selection_article=fa_ent_xml($vl_c_xml->selection_article->attributes());

echo <<<END
<script type="text/javascript">
<![CDATA[
function po_sel() {
  po_change_menu()
}
function po_change_menu() {
  var vo_list = document.getElementById("bbo_ml_qui")
  var vo_item = vo_list.selectedItem;
  vo_list.setAttribute("class",vo_item.getAttribute("class"))
}
function po_selbbo_ml_actif() {
  var vl_portee=fa_mlget("bbo_ml_actif","value");
  switch (vl_portee) {
    case "0":case "1":case "2":
      fa_cache_non("hb_recherche");
      break;
    case "3":
      fa_cache_oui("hb_recherche");
      break;
  } 
}
]]>
</script>
  <hbox>
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbo_ml_actif" oncommand="po_selbbo_ml_actif();fa_approximatif_bbo();" flags="" ref="*" querytype="xml" datasources="$vl_c_source_paniers" class="normal" _graal_cleunik="??">
      <menupopup>
        <menuitem label="$vl_c_dico_00046" tooltiptext="$vl_c_dico_00046" selected="true" value="1" _graal_cleunik="actifs"/> <!--  Actifs-->
        <menuitem label="$vl_c_dico_00047" tooltiptext="$vl_c_dico_00047" value="2" _graal_cleunik="inactifs"/> <!--  Inactifs-->
        <menuitem label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" value="0" _graal_cleunik="tous"/> <!--  Tous-->
      </menupopup>
      <template><query expr="*"/><action>
        <menupopup>
          <menuseparator/>
          <menuitem uri="?" label="?panier_titre" tooltiptext="?panier_titre" selected="true" value="3" _graal_cleunik="?panier_cleunik"/> <!--  Mes paniers -->
        </menupopup>
      </action></template>
    </menulist>
  </hbox>
  <hbox id="hb_recherche">
    <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' disabled="$vl_c_inactif" flex="1" id="bbo_ml_qui" oncommand="po_sel();fa_approximatif_bbo();">
      <menupopup>
        <menuitem hidden="true" label="$vl_c_dico_00018" selected="$vl_c_selqui_01" value="aucun"/>
        <menuitem class="menuitem-iconic ag15" label="$vl_c_dico_00038" tooltiptext="$vl_c_dico_00038" selected="$vl_c_selqui_02" value="favoris"/>
        <menuitem class="menuitem-iconic ag02" label="$vl_c_dico_00039" tooltiptext="$vl_c_dico_00039" selected="$vl_c_selqui_03" value="achats"/>
        <menuitem class="menuitem-iconic ah19" label="$vl_c_dico_00040" tooltiptext="$vl_c_dico_00040" selected="$vl_c_selqui_04" value="ventes"/>
        <menuitem class="menuitem-iconic af04" label="$vl_c_dico_00041" tooltiptext="$vl_c_dico_00041" selected="$vl_c_selqui_06" value="fabrication"/>
        <menuitem class="menuitem-iconic ai07" label="$vl_c_dico_00026" tooltiptext="$vl_c_dico_00026" selected="$vl_c_selqui_05" value="tous"/>
      </menupopup>
    </menulist>
  <label flex="0" value="$vl_c_bbo_002"/>
  <textbox flex="2"   value="$vl_c_bbo_010" id="bbo_tb_rechapproxima" oninput="fa_approximatif_bbo();" _raf_type="search" _raf_searchbutton="true" old_type="autocomplete" old_autocompletesearch="history"/>
  <label flex="0" value="$vl_c_bbo_005"/>
  <menulist sizetopopup="none" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' flex="1" id="bbo_ml_zone" oncommand="fa_approximatif_bbo()" class="normal" value="$selection_article">
    <menupopup>
      <menuitem label="$vl_c_bbo_006" tooltiptext="$vl_c_bbo_006" value="1"/>
      <menuitem label="$vl_c_bbo_008" tooltiptext="$vl_c_bbo_008" value="2"/>
      <menuitem label="$vl_c_bbo_009" tooltiptext="$vl_c_bbo_009" value="3"/>
    </menupopup>
  </menulist>
  <label flex="0" value="$vl_c_bbo_015"/>
  <textbox flex="0"   value="$vl_c_bbo_016" id="bbo_tb_limit" old_oninput="fa_approximatif_bbo()" size="4" type="number" hidespinbuttons="true"/>

  <label hidden="true" flex="0" value="$vl_c_bbo_014"/>
  <textbox hidden="true" flex="1" id="tb_selvalidite" />
  <keyset id="_graal_ks_02">
    <key id="k-recherche" modifiers="alt" keycode="VK_F3" oncommand="fa_approximatif_bbo();"/>
	</keyset>
    <toolbarbutton class="table-rafraichir" id="bbo_top_raf01" oncommand="fa_approximatif_bbo();"/>
    <toolbarbutton id="bt_info_fen" class="ab19" label="$vl_c_dico_00149"  crop="end" dir="normal" oncommand="fa_infos_fenetre('$vl_c_id_fenetre')" />
  </hbox>
END;
?>
