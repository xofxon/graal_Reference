<?php
$ml_representants="";
$ml_representants.="<menuitem value='-1' id='-1' label='Tous les représentants'/>";
$sql_req_rep =" select case f03.nomcommercial when '' then f03.raisonsoc else f03.nomcommercial END as `raisonsoc`, f03.act_cleunik as cle_rep from _faccli_representants";
$sql_req_rep.=" f02 left join _acteurs f03 on f03.act_cleunik=f02.act_cleunik_rep group by f02.act_cleunik_rep order by 1";
    $result = _graal_requete_bd($sql_req_rep);
      while ($row = mysql_fetch_assoc($result)) {
        $vl_c_qui=fa_ent_xml($row[raisonsoc]);
        $vl_act_cleunik=fa_ent_xml($row[cle_rep]);
        $ml_representants.="<menuitem value='$vl_act_cleunik' id='$vl_act_cleunik' label='$vl_c_qui'/>";
      }
if ($ml_representants!=""){
	$ml_representants_finale="<menulist sizetopopup='none' class='sans_icone' value='-1' onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes='broadcaster_bem' id='ml_representant'><menupopup>";
	$ml_representants_finale.=$ml_representants;
	$ml_representants_finale.="</menupopup></menulist>";
}
echo <<<END
$ml_representants_finale
    <vbox id="_graal_ove_actions_arbre_02" flex="10" >
      <tree id="$vl_c_arbre_action" flex="1" flags="" ref="*" querytype="xml" datasources="" enableColumnDrag="true" hidecolumnpicker="false" onclick="pf_sel_ligne_bem(this.id);" ondblclick="pf_dblclick_arbre_actions_bem()" context="$vl_c_menucontext_01" label="Arbre des actions">
        <treecols>
          <treecol hidden="true" id="tc_action_cleunik" ignoreincolumnpicker="true" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol hidden="true" id="tc_choix_cleunik" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol hidden="true" id="tc_dateheuredebut" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol hidden="true" id="tc_dateheurefin" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_genre" label="$vl_c_bem_034" sort="?genre" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_description" label="$vl_c_bem_035" sort="?description" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_qui" label="$vl_c_bem_042" sort="?qui" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_priorite" label="$vl_c_bem_040" sort="?priorite" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_statut" label="$vl_c_bem_041" sort="?statut" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_datedebut" label="$vl_c_bem_036" sort="?dateheuredebut" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_heuredebut" label="$vl_c_bem_037" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_datefin" label="$vl_c_bem_038" sort="?dateheurefin" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_heurefin" label="$vl_c_bem_039" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_sujet" label="$vl_c_bem_043" sort="?sujet" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_reference" label="$vl_c_bem_044" sort="?reference" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_poidsdesmots" label="$vl_c_bem_048" sort="?poidsdesmots" /><splitter class="tree-splitter" resizeafter="grow"/>
			<treecol id="tc_dateheurecreation" label="$vl_c_bem_053" sort="?dateheurecreation" /><splitter class="tree-splitter" resizeafter="grow"/>
          <treecol id="tc_representant" label="$vl_c_bem_054" sort="?representant" /><splitter class="tree-splitter" resizeafter="grow"/>
			<treecol id="tc_montant" label="$vl_c_bem_055" class="droite" sort="?montant" /><splitter class="tree-splitter" resizeafter="grow"/>
		<treecol id="tc_datemodif" label="Modif du document" sort="?dateheuremodif" /><splitter class="tree-splitter" resizeafter="grow"/>
		 <treecol hidden="true" id="tc_dateheuremodif" label="Modif du document" sort="?dateheuremodif" ignoreincolumnpicker="true"/><splitter class="tree-splitter" resizeafter="grow"/>
		 <treecol id="tc_acteur_principal" label="$vl_c_bem_088" sort="?acteur_principal" /><splitter class="tree-splitter" resizeafter="grow"/>
		 <treecol id="tc_interl_principal" label="$vl_c_bem_089" sort="?interl_principal" /><splitter class="tree-splitter" resizeafter="grow"/>
		 <treecol id="tc_confidentialite" label="Confidentialité" sort="?confidentialite" /><splitter class="tree-splitter" resizeafter="grow"/>
        </treecols>
        <template><query expr="*"/><action>
          <treechildren>
            <treeitem uri="?" seltype="single">
              <treerow>
                <treecell label="?action_cleunik"/>
                <treecell label="?choix_cleunik"/>
                <treecell label="?dateheuredebut" properties="?properties_qui"/>
                <treecell label="?dateheurefin"/>
                <treecell label="?genre"/>
                <treecell label="?description"/>
                <treecell label="?qui" properties="?properties_qui"/>
                <treecell label="?priorite"/>
                <treecell label="?statut" properties="?prop_nombre_graal_act"/>
                <treecell label="?datedebut"/>
                <treecell label="?heuredebut"/>
                <treecell label="?datefin"/>
                <treecell label="?heurefin"/>
                <treecell label="?sujet" properties="?prop_pj ?properties_qui"/>
                <treecell label="?reference"/>
                <treecell label="?poidsdesmots"/>
				<treecell label="?dateheurecreation"/>
                <treecell label="?representant"/>
				<treecell label="?montant"/>
				<treecell label="?datemodif"/>
				<treecell label="?dateheuremodif"/>
				<treecell label="?acteur_principal"/>
				<treecell label="?interl_principal"/>
				<treecell label="?confidentialite"/>
              </treerow>
            </treeitem>
          </treechildren>
        </action></template>
      </tree>
    </vbox>
END;
?>
