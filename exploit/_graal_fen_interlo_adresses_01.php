<?php
include("_graal_header_xul.inc.php");
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_e_act_cleunik=intval(fa_recup_param("vl_e_act_cleunik","-1"));
$vl_e_int_cleunik=intval(fa_recup_param("vl_e_int_cleunik","-1"));
$vl_e_adr_cleunik=intval(fa_recup_param("vl_e_adr_cleunik","-1"));
switch ($vl_c_genreacteur){
  case "110000": $vl_c_id_fenetre="Fen_00185";$vl_e_choix_portee="01";break;  //  Adresses postales de l'entreprise
  case "110001": $vl_c_id_fenetre="Fen_00186";$vl_e_choix_portee="02";break;  //  Adresses postales des prospects clients
  case "110002": $vl_c_id_fenetre="Fen_00187";$vl_e_choix_portee="08";break;  //  Adresses postales des prospects fournisseurs
  case "110003": $vl_c_id_fenetre="Fen_00188";$vl_e_choix_portee="04";break;  //  Adresses postales des clients
  case "110004": $vl_c_id_fenetre="Fen_00189";$vl_e_choix_portee="16";break;  //  Adresses postales des fournisseurs
  case "110005": $vl_c_id_fenetre="Fen_00190";$vl_e_choix_portee="32";break;  //  Adresses postales des autres acteurs
  case "110006": $vl_c_id_fenetre="Fen_00191";$vl_e_choix_portee="64";break;  //  Adresses postales des acteurs indéterminés
  default:
    die;  
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_tb_droits[1]=0; //  On n'affiche pas le bouton "ajouter"
$vl_tb_droits[5]=0; //  On n'affiche pas le bouton "détailler"
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=$vl_tb_droits[5];
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bbg_100=fa_recup_dico("bbg_100");
$vl_c_bbg_101=fa_recup_dico("bbg_101");
$vl_c_bbg_102=fa_recup_dico("bbg_102");
$vl_c_bbg_103=fa_recup_dico("bbg_103");
$vl_c_bbg_104=fa_recup_dico("bbg_104");
$vl_c_bbg_105=fa_recup_dico("bbg_105");
$vl_c_bbg_106=fa_recup_dico("bbg_106");
$vl_c_bbg_107=fa_recup_dico("bbg_107");
$vl_c_bbg_108=fa_recup_dico("bbg_108");
$vl_c_bbg_109=fa_recup_dico("bbg_109");
$vl_c_bbg_110=fa_recup_dico("bbg_110");
$vl_c_bbg_111=fa_recup_dico("bbg_111");
$vl_c_bbg_112=fa_recup_dico("bbg_112");
$vl_c_dico_00010=fa_recup_dico("dico_00010");
//  On recherche les informations sur l'acteur 
if ($vl_e_int_cleunik!=-1){
  $sql_req="SELECT concat_ws(' ',prenom,patronyme,'(',raisonsoc,')') as qui FROM _act_interlo, _acteurs where _acteurs.act_cleunik=_act_interlo.act_cleunik and _act_interlo.int_cleunik=$vl_e_int_cleunik;";
  $result=_graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_c_qui=fa_ent_xml($row['qui']);
  _graal_libere_requete_bd($result);
}
$cb_adresses=fa_brik_checkbox_choix(98,1,$vl_e_choix_portee,1,'','cb_adresse_00',"broadcaster_01",0,false,false);
$ml_pays=fa_brik_menulist_choix(60,1,$vl_e_choix_portee,1,'','ml_pays',"broadcaster_01",60000);
include("_graal_header_winxul.inc.php"); 
echo <<<END
<window context="graal_cp00" _graal_int_cleunik="$vl_e_int_cleunik" _graal_act_cleunik="$vl_e_act_cleunik" _graal_adr_cleunik="$vl_e_adr_cleunik" title="$vl_c_bbg_100" id="_win_fen_act_interlo_adresses" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_act_interlo_adresses_01.js.php");
echo <<<END
<broadcasterset>
  <broadcaster id="broadcaster_01" />
</broadcasterset>
<vbox id="hbox_panneaudegauche" flex="1">
<description>$vl_c_qui</description>
<hbox>
<vbox id="box_boite_outils_xof_03" flex="10">
  <grid flex="1">
    <columns flex="1">
      <column/>
      <column flex="1"/>
    </columns>
    <rows>
      <row flex= "1">
        <label control="la_adr_complementnom" value="$vl_c_bbg_102"/>
        <textbox observes="broadcaster_01" id="tb_adr_complementnom"  />
      </row>
      <row flex= "1">
        <label control="la_adr_ligne1" value="$vl_c_bbg_103"/>
        <textbox observes="broadcaster_01" id="tb_adr_ligne1"  />
      </row>
      <row flex= "1">
        <label control="la_adr_ligne2" value="$vl_c_bbg_104"/>
        <textbox observes="broadcaster_01" id="tb_adr_ligne2"  />
      </row>
      <row flex= "1">
        <label control="la_adr_ligne3" value="$vl_c_bbg_105"/>
        <textbox observes="broadcaster_01" id="tb_adr_ligne3"  />
      </row>
      <row flex= "1">
        <label control="la_adr_cp" value="$vl_c_bbg_106"/> 
        <hbox flex= "1">
          <textbox observes="broadcaster_01" flex= "1" id="tb_adr_cp"  />
          <label flex= "1" control="la_adr_ville" value="$vl_c_bbg_107"/>
          <textbox observes="broadcaster_01" flex= "10" id="tb_adr_ville"  />
        </hbox>
      </row>
      <row flex= "1">
      </row>
      <row flex= "1">
        <label control="la_choix_cleunik" value="$vl_c_bbg_108"/>
        $ml_pays      
      </row>
      <row flex= "1">
        <label control="la_adr_latitude" value="$vl_c_bbg_110"/>
        <hbox flex="1">
          <textbox observes="broadcaster_01" flex="1" id="tb_adr_latitude" type="number" hidespinbuttons="true" decimalplaces="6"  />
          <label flex="1" control="la_adr_longitude" value="$vl_c_bbg_111"/>
          <textbox observes="broadcaster_01" flex="10" id="tb_adr_longitude" type="number" hidespinbuttons="true" decimalplaces="6"  />
        </hbox>
      </row>
      <row flex= "1">
          <label flex="1" control="la_adr_cod" value="$vl_c_bbg_101"/>
          <textbox observes="broadcaster_01" id="tb_adr_cod"  />
      </row>
      <row flex= "1">
        <label control="la_dateheuremodif" value="$vl_c_bbg_109"/>
        <label id="tb_dateheuremodif" />
      </row>

    </rows>
  </grid>
</vbox>
<vbox>
  <label control="la_adr_typecoordonnees" value="$vl_c_bbg_112"/>
  $cb_adresses
</vbox>
</hbox>
      <hbox flex="1" id="boutons_standards" >
END;
include("_graal_inc_boutons_01.php");
echo <<<END
</hbox>
</vbox>
</window>
END;
?>
