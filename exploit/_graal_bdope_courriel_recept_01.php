<?php 
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_courriel_02";
$t_origines_ok[1]="_graal_fen_courriel_04";
fa_acces_script();
$vl_c_action=fa_recup_param('vl_c_action',"");
$vl_c_hash=fa_recup_param(vl_c_hash,'cenestpasun hashacceptable');
$vf_c_echo='';
switch (TRUE) {
  case $vl_c_action=="supprime_kilometre":
  case $vl_c_action=="elimine_kilometre":
  case $vl_c_action=="reintegre_kilometre":
  case $vl_c_action=="marque_kilometre":
  case $vl_c_action=="demarque_kilometre":
		$vl_c_var=fa_recup_param('var','vs_tempo_panier_cle_recep');
		$vl_t_listecles=fa_recup_session("$vl_c_var",'');
		unset($_SESSION["$vl_c_var"]);
		$vl_e_i=-1;
		foreach($vl_t_listecles as $vl_raf) {
		  $vl_e_i++;
		  $vl_liste.=$vl_t_listecles[$vl_e_i].',';
		}
		if ($vl_liste!="") {
		  $vl_liste=substr($vl_liste, 0, -1);
		}
		switch (TRUE) {
		  case $vl_c_action=="supprime_kilometre":
		    $sql_req = "update _courriel_recus_brut set integre= 3 WHERE courriel_brut_cleunik IN($vl_liste)";
		    $vf_c_echo=_graal_exec_requete($sql_req);
		    break;
		  case $vl_c_action=="elimine_kilometre":
		    $sql_req = "update _courriel_recus_brut set integre= 5,courriel=NULL WHERE courriel_brut_cleunik IN($vl_liste)";
		    $vf_c_echo=_graal_exec_requete($sql_req);
		    break;
		  case $vl_c_action=="reintegre_kilometre":
		    $sql_req = "update _courriel_recus_brut set integre= 2 WHERE courriel_brut_cleunik IN($vl_liste)";
		    $vf_c_echo=_graal_exec_requete($sql_req);
		    break;
		  case $vl_c_action=="marque_kilometre":
		    $sql_req = "update _courriel_recus_brut set marquage= 1 WHERE courriel_brut_cleunik IN($vl_liste)";
		    $vf_c_echo=_graal_exec_requete($sql_req);
		    break;
		  case $vl_c_action=="demarque_kilometre":
		    $sql_req = "update _courriel_recus_brut set marquage=NULL WHERE courriel_brut_cleunik IN($vl_liste)";
		    $vf_c_echo=_graal_exec_requete($sql_req);
		    break;
		} 
		break;
	case "verif_hash":
		$sql_req = "select count(*) as nombre from _courriel_recus_brut where hash='$vl_c_hash'";
		$result = _graal_requete_bd($sql_req);
		$row = mysql_fetch_assoc($result);
    $vf_c_echo=$row['nombre'];
		_graal_libere_requete_bd($result);
		break;
} 
_graal_ferme_connexion();
echo $vf_c_echo;       
?>
