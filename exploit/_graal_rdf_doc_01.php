<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vf_c_argfen00=fa_recup_param('quelsdocs','');
$vl_e_typedoc=fa_recup_param('vs_typedoc','1');
$vl_e_uti_cleunik=fa_recup_session('vs_uti_cleunik','0');
switch (TRUE) {
  case $vf_c_argfen00 == "medoc":
  case $vf_c_argfen00 == "mesliens": 
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.typedoc,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc FROM _documents	WHERE _documents.doc_cleunik in(SELECT distinct(_documents.doc_cleunik) AS doc_cleunik FROM _droits_doc, _documents	WHERE _documents.doc_cleunik = _droits_doc.doc_cleunik AND _droits_doc.uti_cleunik=$vl_e_uti_cleunik AND _documents.typedoc = $vl_e_typedoc) order by _documents.doc_cleunik desc;";
    break;
  case $vf_c_argfen00 == "nosdocs":
  case $vf_c_argfen00 == "nosliens":
  case $vf_c_argfen00 == "nosflux": 
    $sql_req = "SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc = $vl_e_typedoc and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0 order by _documents.doc_cleunik desc";
    break;
  case $vf_c_argfen00 == "leurdocs": 
  case $vf_c_argfen00 == "leurliens":
    $sql_req="SELECT _documents.doc_cleunik AS doc_cleunik,_documents.emplacement AS emplacement,_documents.titre AS titre,_documents.dateheurecreation AS dateheurecreation,_documents.dateheuremodif AS dateheuremodif,_documents.choix_cleunik AS choix_cleunik,_documents.descriptif_sommaire as descriptif_sommaire,_documents.tailledoc as tailledoc,_droits_doc.uti_cleunik AS uti_cleunik,_droits_doc.droits_proprio AS droits_proprio,_utilisateur.prenom AS prenom,_utilisateur.patronyme AS patronyme FROM _utilisateur, _droits_doc, _documents	WHERE _utilisateur.uti_cleunik = _droits_doc.uti_cleunik AND _documents.doc_cleunik = _droits_doc.doc_cleunik AND _documents.typedoc = $vl_e_typedoc AND _droits_doc.uti_cleunik<>$vl_e_uti_cleunik and (select count(*) from _droits_doc where _documents.doc_cleunik = _droits_doc.doc_cleunik and _droits_doc.uti_cleunik=$vl_e_uti_cleunik) > 0";
    break;
  default :
    echo 	('booom');
    exit;
}
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)){
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  echo('<row:doc_cleunik NC:parseType="Integer">'.fa_ent_xml($row['doc_cleunik']).'</row:doc_cleunik>');
  echo('<row:emplacement>'.fa_ent_xml($row['emplacement']).'</row:emplacement>');
  echo('<row:descriptif_sommaire>'.fa_ent_xml($row['descriptif_sommaire']).'</row:descriptif_sommaire>');
  echo('<row:titre>'.fa_ent_xml($row['titre']).'</row:titre>');
  echo('<row:prenom>'.fa_ent_xml($row['prenom']).'</row:prenom>');
  echo('<row:patronyme>'.fa_ent_xml($row['patronyme']).'</row:patronyme>');
  echo('<row:dateheurecreation>'.fa_ent_xml($row['dateheurecreation']).'</row:dateheurecreation>');
  echo('<row:dateheuremodif>'.fa_ent_xml($row['dateheuremodif']).'</row:dateheuremodif>');
  echo('<row:tailledoc NC:parseType="Integer">'.fa_ent_xml($row['tailledoc']).'</row:tailledoc>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
