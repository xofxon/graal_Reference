<?php
	while ($row = mysql_fetch_assoc($result)) {
    $Quantité=$row['qte'];
    //  L'arrondi ne fonctionne pas dans la requête (8/7/2008)
    $Quantité=round($row['qte'],$row['qte_nbdec']);
    $Code=$row['code_interne'];
    $Désignation=$row['description_interne'];
    $pu=$row['pu'];
    $nbdec_pu=$row['nbdec_pu'];
    $pu_arrondi=fa_reel($pu,$nbdec_pu);
    $htbrutremise=$row['htbrutremise'];
    $htbrutremise_arrondi=fa_reel($htbrutremise,$nbdec_pu);
    $blocnotebrut=trim($row['blocnotebrut']);
    $unite=$row['z17'];
    if ($blocnotebrut!="") {
      $Désignation.=EOL.$blocnotebrut;
    }
    $taxe=trim($row['code']);

  switch ($nombre_taxes) {
    case 1:
      switch ($nb_remises_lignes) {
        case 0:
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
		  if ($Quantité==0) {$Quantité="";}
          $line = array("Code"=>$Code,"Unité"=>$unite,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Montant"=>$htbrutremise_arrondi);
          break;
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
					if ($Quantité==0) {$Quantité="";}
					//if ($remise==0) {$remise="";}
          $line = array("Code"=>$Code,"Unité"=>$unite,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Remise"=>$remise,"Montant"=>$htbrutremise_arrondi);
          break;
      }
      break;
    default:
      switch ($nb_remises_lignes) {
        case 0:
          $line = array("Code"=>$Code,"Unité"=>$unite,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Montant"=>$htbrutremise_arrondi,"T"=>$taxe);
          break;
        default:
          if ($row['remise_taux']==0) {
            $remise="";
          } else {
            $z14=fa_reel(fa_ent_xml($row['remise_taux']),$nbdec_pu);
            switch ($row['remise_type']) {
              case 1:$remise_type="%";break;
              case 2:$remise_type="€";break;
            }
            switch ($row['remise_natu']) {
              case 1:$remise_genre="- ";break;
              case 2:$remise_genre="+ ";break;
            }
            $remise=$remise_genre.$z14." ".$remise_type;
          }
          if ($pu_arrondi==0) {$pu_arrondi="";}
          if ($htbrutremise_arrondi==0) {$htbrutremise_arrondi="";}
					if ($Quantité==0) {$Quantité="";}
					//if ($remise==0) {$remise="";}
          $line = array("Code"=>$Code,"Unité"=>$unite,"Quantité"=>$Quantité,"Désignation"=>$Désignation,"PU"=>$pu_arrondi,"Remise"=>$remise,"Montant"=>$htbrutremise_arrondi,"T"=>$taxe);
          break;
      }
      break;
    }
    $pdf->_graal_pf_imprime_ligne($line,$y,$cols,$format,$fonts,$type,$position_pied);
  }
?>