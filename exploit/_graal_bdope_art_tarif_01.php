<?php
include("_graal_header_txt.inc.php");
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_tar_cleunik=intval(fa_recup_param("vl_tar_cleunik",""));
$vl_art_cleunik=intval(fa_recup_param("vl_art_cleunik",""));
$vl_act_cleunik=intval(fa_recup_param("vl_act_cleunik",""));
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_dateheurevalidite=fa_recup_param("vl_dateheurevalidite","");
$vl_tarif=intval(fa_recup_param("vl_tarif",""));
$vl_genre=intval(fa_recup_param("vl_genre",""));
$vl_type=intval(fa_recup_param("vl_type",""));
$vl_actif=intval(fa_recup_param("vl_actif",""));
$vl_prix_unitaire=fa_floatval(fa_recup_param("vl_prix_unitaire",""));
$vl_nb_dec=intval(fa_recup_param("vl_nb_dec",2));
$vl_unite_quantite=fa_floatval(fa_recup_param("vl_unite_quantite",""));
$vl_quantite_basse=fa_floatval(fa_recup_param("vl_quantite_basse",""));
$vl_quantite_haute=fa_floatval(fa_recup_param("vl_quantite_haute",""));
define('EOL', "\r\n");
switch (TRUE){
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _art_tarifs WHERE tar_cleunik = $vl_tar_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="Tarif supprimé.";} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="ajouter":
    $vl_tar_cleunik=_graal_requete_max("tar_cleunik","_art_tarifs");
    $sql_req = "INSERT INTO _art_tarifs set tar_cleunik=$vl_tar_cleunik,art_cleunik=$vl_art_cleunik,act_cleunik=$vl_act_cleunik,tarif_cleunik=$vl_tarif,actif=$vl_actif,blocnotebrut='$vl_blocnotebrut',pu_reference=$vl_prix_unitaire,type=$vl_genre,nb_dec=$vl_nb_dec,unite_quantite=$vl_unite_quantite,quantite_basse=$vl_quantite_basse,quantite_haute=$vl_quantite_haute";
    if ($vl_dateheurevalidite!='') {$sql_req.=",dateheure_validite='$vl_dateheurevalidite'";}
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="Tarif ajouté.";}
    break;
  case $vf_c_action=="modifier":
    $sql_req = "UPDATE _art_tarifs set tarif_cleunik=$vl_tarif,actif=$vl_actif,blocnotebrut='$vl_blocnotebrut',pu_reference=$vl_prix_unitaire,nb_dec=$vl_nb_dec,unite_quantite=$vl_unite_quantite,quantite_basse=$vl_quantite_basse,quantite_haute=$vl_quantite_haute,dateheure_dermaj=now()";
    if ($vl_dateheurevalidite!='') {$sql_req.=",dateheure_validite='$vl_dateheurevalidite'";}
    $sql_req.=" WHERE tar_cleunik=$vl_tar_cleunik;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo="Tarif modifié.";}
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
