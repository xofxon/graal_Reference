<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session("vs_uti_cleunik","0"));
$vl_c_genreacteur=fa_recup_param('genreacteur','0');
$vl_e_interlo_cleunik=intval(fa_recup_param("vl_e_interlo_cleunik","-1"));
$vl_e_mesinst_cleunik=intval(fa_recup_param("vl_e_mesinst_cleunik","-1"));
$vl_c_mesinst=fa_recup_param('mesinst','');
switch ($vl_c_genreacteur){
  case "110000": $vl_c_id_fenetre="Fen_00697";$vl_e_choix_portee="01";break;  //  Adresses courriels des interlocuteurs des Membres de l'entreprise
  case "110001": $vl_c_id_fenetre="Fen_00698";$vl_e_choix_portee="02";break;  //  adresses courriels des interlocuteurs prospects clients
  case "110002": $vl_c_id_fenetre="Fen_00699";$vl_e_choix_portee="08";break;  //  adresses courriels des interlocuteurs prospects fournisseurs
  case "110003": $vl_c_id_fenetre="Fen_00700";$vl_e_choix_portee="04";break;  //  adresses courriels des interlocuteurs clients
  case "110004": $vl_c_id_fenetre="Fen_00701";$vl_e_choix_portee="16";break;  //  adresses courriels des interlocuteurs fournisseurs
  case "110005": $vl_c_id_fenetre="Fen_00702";$vl_e_choix_portee="32";break;  //  adresses courriels des interlocuteurs autres acteurs
  case "110006": $vl_c_id_fenetre="Fen_00703";$vl_e_choix_portee="64";break;  //  adresses courriels des interlocuteurs acteurs indéterminés
  default:
    fa_redirige("acces_interdit");  
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=0;$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bpi_100=fa_recup_dico("bpi_100");
$vl_c_bpi_101=fa_recup_dico("bpi_101");
$vl_c_bpi_102=fa_recup_dico("bpi_102");
$vl_c_bpi_103=fa_recup_dico("bpi_103");
$vl_c_bpi_104=fa_recup_dico("bpi_104");
$vl_c_bpi_105=fa_recup_dico("bpi_105");
$vl_c_bpi_106=fa_recup_dico("bpi_106");
$vl_c_bpi_107=fa_recup_dico("bpi_107");
$vl_c_bpi_108=fa_recup_dico("bpi_108");
$vl_c_bpi_109=fa_recup_dico("bpi_109");
$vl_c_bpi_110=fa_recup_dico("bpi_110");
$vl_c_bpi_111=fa_recup_dico("bpi_111");
$vl_c_bpi_112=fa_recup_dico("bpi_112");
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00028=fa_recup_dico("dico_00028");
//  On recherche l'interlocuteur à partir de l'adresse de messagerie instantanée
if ($vl_e_mesinst_cleunik!=-1){
  $sql_req="SELECT int_cleunik as int_cleunik FROM _act_interlo_mesinst where mesinst_cleunik=$vl_e_mesinst_cleunik;"; 
  $result=_graal_requete_bd($sql_req);
  $row = mysql_fetch_assoc($result);
  $vl_e_interlo_cleunik=$row['int_cleunik'];
  _graal_libere_requete_bd($result);
}
//  On recherche les informations sur l'acteur et l'interlocuteur 
if ($vl_e_interlo_cleunik!=-1){
  $vl_c_tab=_graal_requete_interlo($vl_e_interlo_cleunik);
  $vl_c_qui=$vl_c_tab[0];
  $vl_e_act_cleunik=$vl_c_tab[1];
}
$ml_type_mesinst=fa_brik_menulist_choix(143,1,-1,1,'','ml_type_mesinst_00',"broadcaster_01",-96);
$ml_prot_mesinst=fa_brik_menulist_choix(144,1,-1,1,'','ml_prot_mesinst_00',"broadcaster_01",-99);
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
//$c_id_windows=""; 
echo <<<END
<window context="grbpi_cp00" title="$vl_c_bpi_100" id="$c_id_windows" onload="fa_aa(this);pf_aa_init();" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_03.js.php");
include("js/_graal_act_interlo_mesinst_01.js.php");
echo <<<END
<broadcasterset><broadcaster id="broadcaster_01" /></broadcasterset>
  <deck id="dk_01" flex="1">
    <_graal_deck value="Deck n° 1 Toutes les informations générales" flex="1">
    <vbox flex="1">
  
  <description>$vl_c_qui</description>
  <grid flex="1">
    <columns flex="1">
      <column/>
      <column flex="1"/>
    </columns>
    <rows>
      <row flex= "1">
        <label value="$vl_c_bpi_105"/>
        <hbox>
          $ml_type_mesinst
          $ml_prot_mesinst
        </hbox>
     </row>
      <row flex= "1">
      <label control="la_mesinst" value="$vl_c_bpi_101"/>
      <hbox flex= "1">
        <textbox observes="broadcaster_01" flex= "30" id="tb_mesinst"  />
        <toolbarbutton collapsed="true" observes="broadcaster_01" flex= "1" class="aj18" id="tb_courriel_01" tooltiptext="$vl_c_bpi_110" oncommand="pf_verifie();"/>
      </hbox>
      </row>
      <row flex= "1">
        <label control="la_infodefaut" value="$vl_c_bpi_104"/>
        <radiogroup id='rdg_actif' flex="1" name='name'>
          <hbox>
            <radio observes="broadcaster_01" id='ra_choix_actif_oui' label="$vl_c_dico_00013" value='1' />
            <radio observes="broadcaster_01" id='ra_choix_actif_non' label="$vl_c_dico_00014" value='2'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row flex= "1">
        <label control="la_veuxpasdecontact" value="$vl_c_bpi_107"/>
        <radiogroup id='rdg_veuxpasdecontact' flex="1" name='name'>
          <hbox>
            <radio class="ak16" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdecontact_oui' label="$vl_c_dico_00013" value='1' />
            <radio class="ak17" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdecontact_non' label="$vl_c_dico_00014" value='2'/>
            <radio class="ak18" dir="reverse" observes="broadcaster_01" id='ra_veuxpasdecontact_nsp' label="$vl_c_dico_00028" value='3'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row flex= "1">
        <label control="la_valide" value="$vl_c_bpi_109"/>
        <radiogroup id='rdg_valide' flex="1" name='name'>
          <hbox>
            <radio class="af16" dir="reverse" observes="broadcaster_01" id='ra_valide_oui' label="$vl_c_dico_00013" value='1' />
            <radio class="ae15" dir="reverse" observes="broadcaster_01" id='ra_valide_non' label="$vl_c_dico_00014" value='2'/>
            <radio class="af15" dir="reverse" observes="broadcaster_01" id='ra_valide_nsp' label="$vl_c_dico_00028" value='3'/>
            <spacer flex="1"/>
           </hbox>
         </radiogroup>
      </row>
      <row flex= "1" collapsed="true">
        <label control="la_dateheureverification" value="$vl_c_bpi_111"/>
        <label value="" id="tb_dateheureverification" />
      </row>
      <row flex= "1" collapsed="true">
        <label control="la_cr_verification" value="$vl_c_bpi_112"/>
        <textbox readonly="true" id="tb_cr_verification" multiline="true" rows="5"/>
      </row>
      <row flex= "30">
        <label control="la_blocnotebrut" value="$vl_c_bpi_103"/>
        <textbox observes="broadcaster_01" id="tb_blocnotebrut"   multiline="true"/>
      </row>
      <row flex= "1">
        <label control="la_dateheuremodif" value="$vl_c_bpi_102"/>
        <label id="tb_dateheuremodif" />
      </row>

    </rows>
  </grid>
  <hbox flex="0" id="boutons_standards"> 
END;
include("_graal_inc_boutons_01.php");
echo <<<END
</hbox>
</vbox>
</_graal_deck>
<_graal_deck value="Deck n° 2 Toutes les informations sur la viabilité du courriel">
  <vbox flex="1">
    <iframe onload="event.stopPropagation();" id="if_cr_visite" flex="1" src="" />
    <button label="Retour" oncommand="fa_gid('dk_01').selectedIndex=0;" />
  </vbox>
</_graal_deck>
</deck>
</window>
END;
?>
