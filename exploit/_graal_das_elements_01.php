<?php
include("_graal_header_xml.inc.php");
$vl_c_dico00008=fa_recup_dico("dico_00008");
$vl_c_dico00009=fa_recup_dico("dico_00009");
$vl_c_dico00010=fa_recup_dico("dico_00010");
$vl_c_dico00011=fa_recup_dico("dico_00011");
$vl_c_dico00012=fa_recup_dico("dico_00012");
$vl_c_dico00017=fa_recup_dico("dico_00017");
$vl_c_dico00030=fa_recup_dico("dico_00030");
$vl_c_dico00060=fa_recup_dico("dico_00060");
$vl_c_dico00061=fa_recup_dico("dico_00061");
$vs_e_uti_cleunik=intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_e_obj_cleunik=intval(fa_recup_param('vl_e_obj_cleunik','0'));
$vl_e_type=intval(fa_recup_param('vl_e_type','0'));
$vl_e_langue=intval(fa_recup_param('vl_e_langue','120131'));  //  français par défaut
switch ($vl_e_type) {
	case 1:
	case 2:
	case 4:
		$sql_req = "SELECT 0 as valeur_defaut,_elements.fen_cleunik as fen_cleunik,_elements.ele_cleunik as ele_cleunik,_elements.titre AS titre,_elements_libelle.descriptif AS descriptif,_elements_libelle.commentaire AS commentaire,_elements.type_objet as type_objet FROM _elements left join _elements_libelle using(ele_cleunik) WHERE (_elements_libelle.langue=$vl_e_langue or _elements_libelle.langue is null) and _elements.fen_cleunik=$vl_e_obj_cleunik and _elements_libelle.uti_cleunik = 0 ORDER BY titre";
		break;
	case 11:
$sql_req =<<<EOT
SELECT 0 as valeur_defaut,_elements.fen_cleunik as fen_cleunik,_elements.ele_cleunik as ele_cleunik,_elements.titre AS titre,_elements_libelle.descriptif AS descriptif,_elements_libelle.commentaire AS commentaire,_elements.type_objet as type_objet,'' as prop FROM _elements left join _elements_libelle using(ele_cleunik) WHERE (_elements_libelle.langue=120131 or _elements_libelle.langue is null) and _elements.fen_cleunik=$vl_e_obj_cleunik and _elements_libelle.uti_cleunik = 0 and _elements.ele_cleunik not in (select _elements_libelle.ele_cleunik from _elements_libelle where uti_cleunik = $vs_e_uti_cleunik )
union 
SELECT 1 as valeur_defaut,_elements.fen_cleunik as fen_cleunik,_elements.ele_cleunik as ele_cleunik,_elements.titre AS titre,_elements_libelle.descriptif AS descriptif,_elements_libelle.commentaire AS commentaire,_elements.type_objet as type_objet,'' as prop FROM _elements left join _elements_libelle using(ele_cleunik) WHERE (_elements_libelle.langue=120131 or _elements_libelle.langue is null) and _elements.fen_cleunik=$vl_e_obj_cleunik and _elements_libelle.uti_cleunik = $vs_e_uti_cleunik 
ORDER BY titre;
EOT;
		break;
}
//echo $sql_req;
$result = _graal_requete_bd($sql_req);
echo('<donnees>');
while ($row = mysql_fetch_assoc($result)) {
	echo('<quoi ');
  echo(' fen_cleunik="'.fa_ent_xml($row['fen_cleunik']).'"');
  echo(' ele_cleunik="'.fa_ent_xml($row['ele_cleunik']).'"');
  echo(' titre="'.fa_ent_xml($row['titre']).'"');
  echo(' descriptif="'.fa_ent_xml($row['descriptif']).'"');
  echo(' commentaire="'.fa_ent_xml($row['commentaire']).'"');
  echo(' type_objet="'.fa_ent_xml($row['type_objet']).'"');
  if ($row['valeur_defaut']==0){
  	echo(' propertie_defaut=""');
  } else {
  	echo(' propertie_defaut="ac04"');
  }
	echo(' prop="'.fa_ent_xml($row['prop']).'"');
  switch ($row['type_objet']){
    case 1:echo(" type_objet_clair='$vl_c_dico00008'");break;
    case 2:echo(" type_objet_clair='$vl_c_dico00009'");break;
    case 3:echo(" type_objet_clair='$vl_c_dico00011'");break;
    case 4:echo(" type_objet_clair='$vl_c_dico00012'");break;
    case 5:echo(" type_objet_clair='$vl_c_dico00017'");break;
    case 6:echo(" type_objet_clair='$vl_c_dico00030'");break;
    case 7:echo(" type_objet_clair='$vl_c_dico00060'");break;
    case 8:echo(" type_objet_clair='$vl_c_dico00061'");break;
    default:echo(" type_objet_clair='$vl_c_dico00010'");break;
  }
  echo('/>');
}
echo('</donnees>');
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
