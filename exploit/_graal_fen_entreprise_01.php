<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_id_fenetre="Fen_00003";
$vl_c_id_inc_entreprise_corpus="Div_00049";
$vl_c_id_inc_acteurs_adresses_01="Div_00057";
$vl_c_id_inc_acteurs_interlos="Div_00146";
$vl_c_id_inc_acteurs_sites="Div_00178";
$vl_c_id_inc_entreprise_param_graal="Div_00517";
if ($vl_act_cleunik!=-1) {
	/*
	 * Gestion de la liste noire des acteurs
	 * Gestion de la liste blanche des acteurs
	 */
	$vl_c_xml_uti=simplexml_load_string($_SESSION["vs_param_environ"]);
	if (isset($vl_c_xml_uti->gesacteurs_ml_zone)){$vs_gesacteurs_ml_zone=$vl_c_xml_uti->gesacteurs_ml_zone->attributes();}else{$vs_gesacteurs_ml_zone='1';}
	switch ($vs_gesacteurs_ml_zone){
		case '1':	//	Accès libre
			$sql_req ="SELECT typeacteur FROM _acteurs where act_cleunik=0 ";
			$result=_graal_requete_bd($sql_req);
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['typeacteur'];
			_graal_libere_requete_bd($result);
			break;
		case '3':	//	Accès sur liste noire
			$sql_req ="SELECT typeacteur FROM _acteurs where act_cleunik=0 ";
			$sql_req.=" and (select count(*) from _acteurs_noire where _acteurs_noire.act_cleunik=_acteurs.act_cleunik and _acteurs_noire.uti_cleunik=$vl_e_uti_cleunik) = 0 ;"; 
			$result=_graal_requete_bd($sql_req);
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['typeacteur'];
			_graal_libere_requete_bd($result);
		break;
		case '4':	//	Accès sur liste blanche
			$sql_req ="SELECT typeacteur FROM _acteurs where act_cleunik=0 ";
			$sql_req.=" and (select count(*) from _acteurs_blanc where _acteurs_blanc.act_cleunik=_acteurs.act_cleunik and _acteurs_blanc.uti_cleunik=$vl_e_uti_cleunik) <> 0 ;"; 
			$result=_graal_requete_bd($sql_req);
			if (mysql_num_rows($result)==0){fa_redirige("acces_interdit");}
			$row = mysql_fetch_assoc($result);
			$vl_c_genreacteur=$row['typeacteur'];
			_graal_libere_requete_bd($result);
			break;
	}
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);if ($vl_tb_droits[0]==false) {fa_redirige("acces_interdit");}
$vl_b_ajout=$vl_tb_droits[1];$vl_b_modif=$vl_tb_droits[2];$vl_b_suppr=$vl_tb_droits[3];$vl_b_impri=$vl_tb_droits[4];$vl_b_detai=0;
$vl_b_ajout=0;//	Monosociété pour l'instant (8 septembre 2009)
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bay_101=fa_recup_dico("bay_101");
$vl_c_bay_102=fa_recup_dico("bay_102");
$vl_c_bay_103=fa_recup_dico("bay_103");
$vl_c_bay_104=fa_recup_dico("bay_104");
$vl_c_bay_107=fa_recup_dico("bay_107");
$vl_c_bay_108=fa_recup_dico("bay_108");
$vl_c_bay_109=fa_recup_dico("bay_109");
$tab_key=array();
$vl_k_bay_102=fa_cree_raccourcis($vl_c_bay_102,$tab_key);
$vl_k_bay_104=fa_cree_raccourcis($vl_c_bay_104,$tab_key);
$vl_k_bay_107=fa_cree_raccourcis($vl_c_bay_107,$tab_key);
$vl_k_bay_108=fa_cree_raccourcis($vl_c_bay_108,$tab_key);
$vl_k_bay_109=fa_cree_raccourcis($vl_c_bay_109,$tab_key);

$vl_tb_droits_admin=_graal_requete_droits_fenetre('Trait_00298',$vl_e_uti_cleunik); //  Paramètres généraux de l'entreprise
$brik_01_admin="";
if ($vl_tb_droits_admin[0]==true) {
  $brik_01_admin="<tab class='ah03' linkedpanel='tabpanel_param_graal' id='tab_param_graal' label='$vl_c_bay_109' accesskey='$vl_k_bay_109'/>";
  $vl_accordion='<?xml-stylesheet href="xbl/accordion.css?v=1.0" type="text/css"?>';
  $vl_tb_droits_offcli_ente=_graal_requete_droits_fenetre('Fen_00718',$vl_e_uti_cleunik);
  $vl_tb_droits_offcli_pied=_graal_requete_droits_fenetre('Fen_00719',$vl_e_uti_cleunik);
  $vl_tb_droits_cdecli_ente=_graal_requete_droits_fenetre('Fen_00720',$vl_e_uti_cleunik);
  $vl_tb_droits_cdecli_pied=_graal_requete_droits_fenetre('Fen_00721',$vl_e_uti_cleunik);
  $vl_tb_droits_livcli_ente=_graal_requete_droits_fenetre('Fen_00722',$vl_e_uti_cleunik);
  $vl_tb_droits_livcli_pied=_graal_requete_droits_fenetre('Fen_00723',$vl_e_uti_cleunik);
  $vl_tb_droits_faccli_ente=_graal_requete_droits_fenetre('Fen_00724',$vl_e_uti_cleunik);
  $vl_tb_droits_faccli_pied=_graal_requete_droits_fenetre('Fen_00725',$vl_e_uti_cleunik);
  $vl_tb_droits_demfou_ente=_graal_requete_droits_fenetre('Fen_00726',$vl_e_uti_cleunik);
  $vl_tb_droits_demfou_pied=_graal_requete_droits_fenetre('Fen_00727',$vl_e_uti_cleunik);
  $vl_tb_droits_cdefou_ente=_graal_requete_droits_fenetre('Fen_00728',$vl_e_uti_cleunik);
  $vl_tb_droits_cdefou_pied=_graal_requete_droits_fenetre('Fen_00729',$vl_e_uti_cleunik);
  $vl_tb_droits_palettessss=_graal_requete_droits_fenetre('Fen_00730',$vl_e_uti_cleunik);
  $vl_tb_droits_livcli_bord=_graal_requete_droits_fenetre('Fen_00731',$vl_e_uti_cleunik);
  
  $vl_tb_droits_retcli_ente=_graal_requete_droits_fenetre('Fen_01098',$vl_e_uti_cleunik);
  $vl_tb_droits_retcli_pied=_graal_requete_droits_fenetre('Fen_01099',$vl_e_uti_cleunik);
  $vl_tb_droits_retfou_ente=_graal_requete_droits_fenetre('Fen_01100',$vl_e_uti_cleunik);
  $vl_tb_droits_retfou_pied=_graal_requete_droits_fenetre('Fen_01101',$vl_e_uti_cleunik);
  
  $vl_tb_droits_recfou_ente=_graal_requete_droits_fenetre('Fen_01102',$vl_e_uti_cleunik);
  $vl_tb_droits_recfou_pied=_graal_requete_droits_fenetre('Fen_01103',$vl_e_uti_cleunik);
  $vl_tb_droits_facfou_ente=_graal_requete_droits_fenetre('Fen_01104',$vl_e_uti_cleunik);
  $vl_tb_droits_facfou_pied=_graal_requete_droits_fenetre('Fen_01105',$vl_e_uti_cleunik);
  $vl_tb_droits_relfou_ente=_graal_requete_droits_fenetre('Fen_01132',$vl_e_uti_cleunik);
  $vl_tb_droits_relfou_pied=_graal_requete_droits_fenetre('Fen_01133',$vl_e_uti_cleunik);
  
$vl_tb_droits_condgenvent=_graal_requete_droits_fenetre('Fen_00732',$vl_e_uti_cleunik);
}
$vl_c_voir_doc="non";
$vl_c_genreged="110000";
$vl_c_selection="non";
$vl_c_quelsdocs="docs";
$vl_c_id_ged_selection="Div_00364";$id_inc_ged="Div_00369";
include("_graal_header_winxul.inc.php");
$vl_tc_composants=array($vl_c_id_inc_entreprise_corpus,$vl_c_id_inc_acteurs_adresses_01,$vl_c_id_inc_acteurs_interlos,$vl_c_id_inc_acteurs_sites,$id_inc_ged);
echo <<<END
$vl_accordion
<window context="graal_cp00" _graal_genreacteur="$vl_c_genreacteur" title="$vl_c_bay_101" id="_win_fen_entreprise_01" onload="fa_aa(this);pf_etat_fen('ini')" $c_xmlns>
$vl_c_graal_cp00
END;
include("_graal_visites.inc.php");
include_once("js/_graal_01.js.php");
include("js/_graal_04.js.php");
include("js/_graal_entreprise_01.js.php");
echo <<<END
<broadcasterset>
  <broadcaster id="broadcaster_01" />
</broadcasterset>
<hbox>
END;
include("_graal_inc_entreprise_01.php");
echo('<vbox id="boutons_standards" >');
include("_graal_inc_boutons_01.php");
echo <<<END
  </vbox>
</hbox>
  <splitter></splitter>
  <tabbox id="tabbox_01" flex="1" orient="vertical" class="overflow_01">
    <tabs>
       <tab first-tab="true" linkedpanel="tabpanel_edition" id="tab_edition" label="$vl_c_bay_102" selected="true" accesskey="$vl_k_bay_102"/>
       <tab linkedpanel="tabpanel_adresses_post" id="tab_adresses_postales" label="$vl_c_bay_104" accesskey="$vl_k_bay_104"/>
       <tab class="af12" linkedpanel="tabpanel_sites" id="tab_sites" label="$vl_c_bay_107" accesskey="$vl_k_bay_107"/>
       <tab class="ah03" linkedpanel="tabpanel_ged" id="tab_ged" label="$vl_c_bay_108" accesskey="$vl_k_bay_108"/>
       $brik_01_admin
    </tabs>
    <tabpanels flex="1">
  		<tabpanel id="tabpanel_edition" flex="1">
END;
include("_graal_inc_acteurs_interlos_01.php");
echo <<<END
      </tabpanel>
    	<tabpanel id="tabpanel_adresses_post" flex="1">
END;
include("_graal_inc_acteurs_adresses_02.php");
echo <<<END
      </tabpanel>
      <tabpanel id="tabpanel_sites" flex="1">
END;
$vl_c_bloc_sites="true";
include("_graal_inc_acteurs_sites_01.php");
echo <<<END
      </tabpanel>
      <tabpanel id="tabpanel_ged" flex="1" orient="vertical">
END;
include("_graal_inc_ged_selection_01.php");
include("_graal_inc_ged_01.php");
echo <<<END
      </tabpanel>
END;
if ($vl_tb_droits_admin[0]==true) {
  echo '<tabpanel id="tabpanel_param_graal" flex="1">';
  include("_graal_inc_entreprise_param_graal.php");
  echo '</tabpanel>';
}      
echo <<<END
    </tabpanels>
  </tabbox> 
 </window>
END;
?>
