<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_type=fa_recup_param('type','1');  //  1 Normal,2 Choix,3 Critere
$vl_c_genre=fa_recup_param('genre','0');  //  1 ventes, 2 achats
$vl_e_choix_cleunik=intval(fa_recup_param('vl_e_choix_cleunik','0'));
$vl_e_critere_cleunik=intval(fa_recup_param('vl_e_critere_cleunik','0'));
$vl_c_quoi=fa_recup_param('vl_c_quoi','');
$vl_c_enclair=fa_recup_param('vl_c_enclair','');
$vl_c_code_critere=fa_recup_param('vl_c_code_critere','');
$vl_c_code_choix=fa_recup_param('vl_c_code_choix','');
$vl_c_deno_critere=fa_recup_param('vl_c_deno_critere','');
$vl_c_deno_choix=fa_recup_param('vl_c_deno_choix','');
switch ($vl_c_genre) {
  case "1": $vl_c_id_fenetre="Fen_01114";$vl_c_id_article_ventes="Div_00318";$vl_c_id_article_recherche="Div_00490";$vl_c_id_inc_infos_critere_choix_01="Div_00344";$vl_c_id_inc_acteurs_selection_01="Div_00040";$vl_c_id_inc_acteurs_01="Div_00033";break;  //  Tarifs de vente
  case "2": $vl_c_id_fenetre="Fen_01xxx";$vl_c_id_article_recherche="Div_00591";$id_inc_tarifs_particuliers_fournis="Div_00445";$vl_c_id_inc_infos_critere_choix_01="Div_00344";$vl_c_id_inc_acteurs_selection_01="Div_00040";$vl_c_id_inc_acteurs_01="Div_00033";break;  //  Tarifs d'achats
  default: fa_redirige("acces_interdit");break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==false) {fa_redirige("acces_interdit");}

$ml_tarifs="<hbox flex='1'>";
$ml_tarifs.=fa_brik_menulist_coche(101,1,-1,-1,'','ml_tarif',"broadcaster_bem",0);
$ml_tarifs.=<<<EOT
	<menulist sizetopopup="none" value="3" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' id="ml_tarifs_actifs" class="sans_icone" _graal_nombre="3">
		<menupopup>
			<menuitem value="1" label="Tarifs actifs" tooltiptext="Tarifs actifs" crop="end"/>
          	<menuitem value="2" label="Tarifs inactifs" tooltiptext="Tarifs inactifs" crop="end"/>
          	<menuitem value="3" label="Tous" tooltiptext="Tous" crop="end"/>
		</menupopup>
	</menulist>
	</hbox>
EOT;
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bvg_100=fa_recup_dico("bvg_100");
$vl_c_bvg_101=fa_recup_dico("bvg_101");
$vl_c_bvg_102=fa_recup_dico("bvg_102");
$vl_c_bvg_103=fa_recup_dico("bvg_103");
$vl_c_bvg_104=fa_recup_dico("bvg_104");
$vl_c_bvg_105=fa_recup_dico("bvg_105");
_graal_requete_charge_varlib($vl_c_id_article_ventes,$vl_e_uti_cleunik);
$vl_c_bdg_001=fa_recup_dico("bdg_001");
$vl_c_bdg_002=fa_recup_dico("bdg_002");
$vl_c_bdg_003=fa_recup_dico("bdg_003");
$vl_c_bdg_004=fa_recup_dico("bdg_004");
$vl_c_bdg_005=fa_recup_dico("bdg_005");
$vl_c_bdg_006=fa_recup_dico("bdg_006");
$vl_c_bdg_007=fa_recup_dico("bdg_007");
$vl_c_bdg_008=fa_recup_dico("bdg_008");
$vl_c_bdg_009=fa_recup_dico("bdg_009");
$vl_c_bdg_010=fa_recup_dico("bdg_010");
$vl_c_bdg_011=fa_recup_dico("bdg_011");
$vl_c_bdg_012=fa_recup_dico("bdg_012");
$vl_c_bdg_013=fa_recup_dico("bdg_013");
$vl_c_bdg_014=fa_recup_dico("bdg_014");
$vl_c_bdg_015=fa_recup_dico("bdg_015");
$vl_c_bdg_016=fa_recup_dico("bdg_016");
$vl_c_bdg_017=fa_recup_dico("bdg_017");
$vl_c_bdg_017="Descriptions particulières(vente)";
$vl_c_bdg_021=fa_recup_dico("bdg_021");
$vl_c_bdg_022=fa_recup_dico("bdg_022");
$vl_c_bdg_023=fa_recup_dico("bdg_023");
$vl_c_bdg_024=fa_recup_dico("bdg_024");
$vl_c_bdg_025=fa_recup_dico("bdg_025");
$vl_c_bdg_026=fa_recup_dico("bdg_026");
$vl_c_bdg_027=fa_recup_dico("bdg_027");
$vl_c_bdg_028=fa_recup_dico("bdg_028");
$vl_c_bdg_029=fa_recup_dico("bdg_029");
$vl_c_bdg_030=fa_recup_dico("bdg_030");
$vl_c_bdg_031=fa_recup_dico("bdg_031");
$vl_c_bdg_032=fa_recup_dico("bdg_032");
$vl_c_bdg_033=fa_recup_dico("bdg_033");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
switch ($vl_c_genre) {
  case "1": //  Tarifs de vente
    $vl_c_id_t01="Trait_00315";$vl_c_id_t02="Trait_00316";
    break;  
  case "2": //  Tarifs d'achats
    $vl_c_id_t01="Trait_00xxx";$vl_c_id_t02="Trait_00xxx";
    break;  
}
_graal_requete_charge_libobj($vl_c_id_t01,$vl_e_uti_cleunik);$vl_c_t01=fa_recup_dico("$vl_c_id_t01");
_graal_requete_charge_libobj($vl_c_id_t02,$vl_e_uti_cleunik);$vl_c_t02=fa_recup_dico("$vl_c_id_t02");
$bt_suppression_tarif='';
$bt_desactivation_tarif='';
$bt_activation_tarif='';
$bt_maj_validite='';
$bt_maj_tarifs='';
$bt_dup_tarifs='';
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
$c_id_windows="";
$vl_tc_composants=array($vl_c_id_fenetre,$vl_c_id_article_recherche,$vl_c_id_article_ventes);
echo <<<END
<window id="$c_id_windows" title="$vl_c_bvg_100" onload="fa_aa(this);pf_aa_init()" onunload="pf_aa_ferme();" $c_xmlns>
$vl_c_graal_cp00
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t01,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==true){
	$vl_complement_arbre_tarif_type_vente=('<menuitem label="'.$vl_c_t01.'" oncommand="pf_export_excel_01();" class="menuitem-iconic ak05" dir="reverse"/>');
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t02,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==true){
	$vl_importation_excel=<<<EOT
	<button id="bt_ouvre_csv" flex="1" label="$vl_c_t02" tooltiptext="$vl_c_t02" oncommand="pf_ouvre_csv();" class="menuitem-iconic ak05" dir="reverse" />
	<menulist sizetopopup="none" value="1" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' id="ml_separateur" class="sans_icone" _graal_nombre="2">
		<menupopup>
			<menuitem value="1" label="$vl_c_bvg_104" tooltiptext="$vl_c_bvg_104" crop="end"/>
          	<menuitem value="2" label="$vl_c_bvg_105" tooltiptext="$vl_c_bvg_105" crop="end"/>
		</menupopup>
	</menulist>
EOT;
}
include("_graal_visites.inc.php");
include_once("js/_graal_05_dates.js.php");
include_once("js/_graal_01.js.php");
include("js/_graal_articles_traitements_04.js.php");
include("js/_graal_03.js.php");
$vl_c_type_article_recherche="11";
include("js/_graal_articles_selection_01.js.php");
echo <<<END
<vbox id="vb_selection">
<hbox>
$ml_tarifs
</hbox>
  <vbox >
END;
switch ($vl_c_type) {
  case '1' : // Normal
    include("_graal_inc_articles_recherche_01.php");
    break;
  case '2' : // Choix
  case '3' : // Critère
    $_graal_inc_infos_critere_choix_01="articles";
    include("_graal_inc_infos_critere_choix_01.php");
    break;
}
echo <<<END
</vbox>
</vbox>
<hbox >
<button flex="1" id="bt_saisie" tooltiptext ="$vl_c_bvg_101" label="$vl_c_bvg_101" crop="end" dir="normal" oncommand="pf_saisie();" />
$vl_importation_excel
<button flex="1" id="bt_validation" tooltiptext ="$vl_c_bvg_102" label="$vl_c_bvg_102" crop="end" dir="normal" oncommand="pf_validation();" collapsed="true"/>
</hbox>
<vbox id="$vl_c_id_vbox_inc_article_01" flex="2">
END;
include("_graal_inc_arbre_tarif_type_vente_01.php");
echo <<<END
</vbox>


  </window>
END;
?>
