<?php
set_time_limit(300);
include("_graal_header_html.inc.php");
define('EOL', "\r\n");
$query=fa_recup_telquel('vl_c_requete','select now()');
if ($query=='') die('Error: SQL command must be provided');
$command = strtolower(substr($query,0,strpos($query,' ')));
if (strpos('select,show,describe',$command)===false) die('Error: Only SELECT/SHOW/DESCRIBE is allowed');
$connection = mysql_connect($sql_serveur,$sql_user,$sql_passwd) or die('Error: Could not connect to server - ' . mysql_error());
$result = mysql_query("SET CHARACTER SET 'utf8';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$result = mysql_query("SET collation_connection = 'utf8_general_ci';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$result = mysql_query($query,$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$query);
$nfields = mysql_num_fields($result);
$vl_e_noligne=0;

echo <<<END
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type=text/css>
body {background: white; color: black;}
table {empty-cells:show;} /* permet d'afficher le cadre des cellules vides */
table {table-layout: auto; width: 100%;} 
@media screen
{
  * {color: green !important; backgroud: white !important;}
  body {font-family: verdana;}
  h1 {margin-top: 1em;}
}
@media print
{
  * {color: black !important; backgroud: white !important;}
  body {font: 12pt "Times New Roman", "TimesNR", Times, serif;}
  h1 {margin-top: 2em; border-bottom: 1px solid silver;}
  div {page-break-after: always;}
}
</style>
</head>
<body>
<table border=1 cellspacing=1 cellpadding=0>
END;
//  Entête du tableau
echo'<tr>';
//  Lecture des colonnes
for ($i=0; $i<$nfields; $i++)
{    
    $fieldname = mysql_field_name($result, $i);
    echo("<th>$fieldname</th>");
}
echo'</tr>'.EOL;
//  Lecture des résultats de la requête
while ($line = mysql_fetch_array($result, MYSQL_ASSOC)) 
{
  $j = 0;
  $vl_e_noligne++;
  echo'<tr>';
  foreach ($line as $field)
  {
      echo("<td>$field</td>");
      $j++;
  }
  echo'</tr>'.EOL;
}
mysql_free_result($result);
mysql_close($connection);
//  fin de la table et de la page HTML
echo <<<END
</table>
</body>
END;
?>
