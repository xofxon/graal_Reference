<?php
include("_graal_header_xul.inc.php");
define('EOL', "\r\n");
$vl_action_cleunik=intval(fa_recup_param('vl_action_cleunik','0'));
$sql_req = "SELECT commentaire_cleunik,"._graalsql_date('_actions_commentaires.dateheuremodif')." as `datemodif`,"._graalsql_time('_actions_commentaires.dateheuremodif')." as `heuremodif`,concat_ws(' ',prenom,patronyme) as qui,blocnote_brut as 'commentaire' FROM _actions_commentaires,_act_interlo where action_cleunik=$vl_action_cleunik and _actions_commentaires.int_cleunik=_act_interlo.int_cleunik order by _actions_commentaires.dateheuremodif desc";
$result = _graal_requete_bd($sql_req);
include("_graal_header_winxul.inc.php");
/*
  Attention, comme cette fenêtre est censée n'être appelée que dans une frame, il faut bien la mettre avec le style transparent
*/
echo('<window class="transparent" id="_graal_fen_iframe_actions_commentaires_01.php" '.$c_xmlns.' >');
echo <<<END
<vbox flex="1" id="comactions" class="overflow_01">
END;
$nb=0;
$nombre=mysql_num_rows($result);
$vl_c_xxx_100=fa_recup_dico("xxx_100");
$vl_c_xxx_100="commentaire";
$vl_c_xxx_101="commentaires";
$vl_c_xxx_102="Aucun commentaire";
switch ($nombre) {
  case 0  :echo ("<caption><label value='$vl_c_xxx_102'/>");break;
  case 1  :echo ("<caption><label value='$nombre $vl_c_xxx_100'/>");break;
  default :echo ("<caption><label value='$nombre $vl_c_xxx_101'/>");break; 
}
echo("</caption>");
while ($row = mysql_fetch_assoc($result)) {
  $nb++;
  $vl_nblignes=fa_compte_rc($row['commentaire']);
  $vl_nblignes+=1;
  $commentaire_cleunik=fa_remplace_quotes(fa_ent_xml($row['commentaire_cleunik']));
  $commentaire=fa_remplace_quotes(fa_ent_xml($row['commentaire']));
  $qui=fa_remplace_quotes(fa_ent_xml($row['qui'])).' le '.fa_ent_xml($row['datemodif']).' à '.fa_ent_xml($row['heuremodif']);
  if ($nb&1)
    echo("<groupbox class='rose_01'>"); //  impair
  else
    echo("<groupbox class='jaune_01'>"); //  pair
  echo("<caption>");
  echo("<label value='$qui' class='gras vert text-link' onclick='window.parent.pf_affiche_commentaire($commentaire_cleunik);'/>");
  echo("</caption>");
  echo("<hbox flex='1'>");
    echo("<textbox value='$commentaire' flex='1' multiline='true' rows='$vl_nblignes' readonly='true'/>");
  echo("</hbox>");
  echo("</groupbox>");
}
echo <<<END
</vbox>
<spacer flex="0"/>
</window>
END;
?>
