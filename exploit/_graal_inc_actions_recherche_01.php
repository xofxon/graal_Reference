<?php
$bloc_date="periode_datepicker";
include("_graal_var_portee.php");
include("_graal_inc_actions_recherche_selection_01.php");
if ($vl_c_bloc_arbre_criteres==true){
	$vl_c_dico_00044=fa_recup_dico("dico_00044");
	$sql_req_criteres="select f2.critere_denomination,f2.critere_cleunik,f1.* from _choix f1 left join _criteres f2 using (critere_cleunik) where critere_portee & $vl_e_action and f2.critere_cleunik<>0 order by f2.critere_cleunik,f1.choix_valeur_texte_01";
	$xml="";
	$vl_e_critere_cleunik=0;
  $res_uti=_graal_requete_bd($sql_req_criteres);
  $vl_e_nb_criteres=mysql_num_rows($res_uti);
  if ($vl_e_nb_criteres!=0){
  while ($row_uti = mysql_fetch_assoc($res_uti)){
  	$critere_denomination=fa_ent_xml($row_uti['critere_denomination']);
		$choix_valeur_texte_01=fa_ent_xml($row_uti['choix_valeur_texte_01']);
		$choix_cleunik_action=fa_ent_xml($row_uti['choix_cleunik']);
  	if ($vl_e_critere_cleunik!=$row_uti['critere_cleunik']){
			$critere_cleunik_action=fa_ent_xml($row_uti['critere_cleunik']);
  		if ($vl_e_critere_cleunik!=0){
  			$xml.="</treechildren></treeitem>";
  		}
  		$xml.="<treeitem  container='true' open='true'><treerow><treecell label='$critere_denomination' _graal_choix_cleunik='0' _graal_critere_cleunik='$critere_cleunik_action'/></treerow><treechildren>";
  		$vl_e_critere_cleunik=$row_uti['critere_cleunik'];
  	}
		$xml .="<treeitem><treerow><treecell label='$choix_valeur_texte_01' _graal_choix_cleunik='$choix_cleunik_action' _graal_critere_cleunik='$critere_cleunik_action'/></treerow></treeitem>";
    /*
		if ($row_uti['critere_actif']==2) {$prop="pa obsolete";} else {$prop="pa";}
	  $xml .='<item label=" ' .fa_ent_xml($row_uti['denomination']). '" properties="'.$prop.'" url="_graal_fen_choix_criteres_actions.php?critere_cleunik='.$row_uti['cleunik'].'&#38;per='.$row_uti['critere_codechoixpertinent'].'"/>'.EOL;
	  */
  }
	_graal_libere_requete_bd($res_uti);
	$xml.="</treechildren></treeitem>";
	$xml .='</treechildren></tree>';
	//$xml .='</tree>';
	$vl_c_bloc_arbre_criteres_debut="<hbox flex='1'>";
	$vl_c_bloc_arbre_criteres_corpus=<<<EOT
		<vbox flex='1'>
		<radiogroup id='rdg_cherche_choix' value="3">
                <vbox>
								<hbox>
                  <radio observes="broadcaster_01" id='ra_cherche_choix_oui' label="Avec" value='1' />
                  <radio observes="broadcaster_01" id='ra_cherche_choix_non' label="Sans" value='2'/>
				  <radio observes="broadcaster_01" id='ra_cherche_choix_ns' label="Ignoré" value='3' />
                </hbox>
								<hbox>
                  
                </hbox>
							</vbox>
              </radiogroup>
EOT;
	$vl_c_bloc_arbre_criteres_corpus.="<tree id='tb_choix_actions' hidecolumnpicker='true' seltype='multiple' flex='1' onselect='pf_sel_arbre_choix_critere(this);'><treecols><treecol ignoreincolumnpicker='true' class='colname' flex='2' primary='true' hideheader='true'/></treecols><treechildren id='treeitems'>$xml</vbox><splitter/>";
	$vl_c_bloc_arbre_criteres_fin="</hbox>";
	}
}
echo <<<END
$vl_c_bloc_arbre_criteres_debut
$vl_c_bloc_arbre_criteres_corpus
END;

switch ("$vl_c_quelarbre_actions"){
	case "1":include("_graal_inc_arbre_action_01.php");break;	// "Normal"
	case "2":include("_graal_inc_arbre_action_02.php");break;	//	Avec transporteur
	case "3":include("_graal_inc_arbre_action_02.php");break;	//	Avec transporteur
	case "4":include("_graal_inc_arbre_action_03.php");break;	//	Facture par représentants
	case "5":include("_graal_inc_arbre_action_04.php");break;	//	Documents chiffrés
	case "6":include("_graal_inc_arbre_action_05.php");break;	//	Suivi des commandes clients
	case "7":include("_graal_inc_arbre_action_06.php");break;	//	CA avoirs et factures clientsDocuments chiffrés
	default:include("_graal_inc_arbre_action_01.php");break;	//	Générique
}

echo <<<END
$vl_c_bloc_arbre_criteres_fin		
END;
if ($vl_c_visu_action=="oui") {
echo <<<END
<splitter ondblclick="aad_pf_cache();"> </splitter>
  <vbox flex="10">
      <iframe onload="fa_aa(window.graal_iframe_visu_action);event.stopPropagation();" id="graal_iframe_visu_action" src="" flex="1"/>
  </vbox>
END;
}
if ($vl_b_bloc_action_recherche==true) {
  echo('</vbox></vbox>');
}
?>
