<?php
// transformation d'un fichier .tiff en fichier .png
require("_graal_fonctions_diverses.php");
$vl_c_fichier=fa_recup_param('vl_c_fichier','');
$vl_e_angle_rotation=intval(fa_recup_param('vl_e_angle_rotation','0'));
// http://linuxreviews.org/man/convert/
//http://www.imagemagick.org/Usage/basics/
//	Il faudra peut-être affiner les réglages ...
//exec("convert $vl_c_fichier -fuzz 5% -transparent white $vl_c_fichier.png");
/*
 * On compte le nombre de pages
 */
$rotation="";
if ($vl_e_angle_rotation!=0) {
	$rotation=" -rotate $vl_e_angle_rotation";
}
exec("identify -ping -format '%k' $vl_c_fichier",$vl_c_resultat);
//var_dump($vl_c_resultat);
$vl_c_nombre=strlen($vl_c_resultat[0]);
/*
echo $vl_c_nombre;
echo "convert $vl_c_fichier*.png* $vl_c_fichier.pdf";
*/
	exec("convert $vl_c_fichier -transparent white $vl_c_fichier.png");
	exec("convert $vl_c_fichier*.png* $vl_c_fichier.pdf");
	//echo "convert $vl_c_fichier*.png* $vl_c_fichier.pdf";
	header('Content-type: application/pdf');
	echo file_get_contents("$vl_c_fichier.pdf");

/*
if ($vl_c_nombre>1){
	/*
	exec("convert $vl_c_fichier -transparent white $vl_c_fichier.png");
	$vl_c_nombre--;
	for($i=0;$i <= $vl_c_nombre;$i++)
	{
	   $vl_c_chaine_fichiers.=$vl_c_fichier."-$i".".png ";
	}
	exec("convert $vl_c_chaine_fichiers $rotation -append $vl_c_fichier.png",$vl_c_resultat);
	
	exec("convert $vl_c_fichier -transparent white $vl_c_fichier.png");
	exec("convert $vl_c_fichier*.png* $vl_c_fichier.pdf");
	//echo "convert $vl_c_fichier*.png* $vl_c_fichier.pdf";
	header('Content-type: application/pdf');
	echo file_get_contents("$vl_c_fichier.pdf");
} else {
	exec("convert $vl_c_fichier -transparent white $vl_c_fichier.png");
	header('Content-type: image/png');
	echo file_get_contents("$vl_c_fichier.png");
}
*/
?>
