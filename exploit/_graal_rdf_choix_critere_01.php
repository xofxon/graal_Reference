<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_t_listecles=fa_recup_param('vl_c_liste_cleunik','');
$vl_c_critere_cleunik=fa_recup_param('vl_c_critere_cleunik','60');
$vl_c_etat=fa_recup_param('vl_c_etat','1');
$vl_c_nombre=fa_recup_param('vl_c_nombre','graal');
$vl_c_position=fa_recup_param('vl_c_position','2');
$vl_c_genre=fa_recup_param('genre','graal');
$vl_c_actif=fa_recup_dico("dico_00046");
$vl_c_inactif=fa_recup_dico("dico_00047");
$vl_c_operateur_01="=";
$vl_c_sauf=fa_recup_param('sauf','');
$vl_e_uti_cleunik=intval(fa_recup_param("vl_e_uti_cleunik",-1)); //  Va de pair avec vl_c_sauf
$vl_e_recipiendaire=intval(fa_recup_param("vl_e_recipiendaire",-1)); //  Va de pair avec vl_c_sauf
switch ($vl_c_etat) {
  case "1": break;  //  Tous
  case "2": $vl_c_operateur_01=">";$vl_c_operateur_02=" IN ";break;     //  les utilisés
  case "3": $vl_c_operateur_01="=";$vl_c_operateur_02=" NOT IN ";break; //  pas utilisés
}
$sql_utilisations="";
switch ($vl_c_nombre) {
  case 'graal':         $sql_utilisations=",0 as nombre";break;
  case 'acteurs':       $sql_utilisations=",(SELECT count(*) from _act_choix_fixes where _act_choix_fixes.choix_cleunik = _choix.choix_cleunik) as nombre";break;
  case 'interlocuteurs':$sql_utilisations=",(SELECT count(*) from _act_interlo_choix_fixes where _act_interlo_choix_fixes.choix_cleunik = _choix.choix_cleunik) as nombre ";break;
  case 'articles':      $sql_utilisations=",(SELECT count(*) from _art_choix_fixes where _art_choix_fixes.choix_cleunik = _choix.choix_cleunik) as nombre ";break;
  case 'actions':       $sql_utilisations=",(SELECT count(*) from _actions_choix_fixes where _actions_choix_fixes.choix_cleunik = _choix.choix_cleunik) as nombre ";break;
  case 'ged':           $sql_utilisations=",(SELECT count(*) from _documents_choix_fixes where _documents_choix_fixes.choix_cleunik = _choix.choix_cleunik) as nombre ";break;
} 
$sql_sauf="";
if ($vl_c_sauf=="sauf") {
  switch ($vl_c_nombre) {
    case 'graal':break;
    case 'acteurs':       $sql_sauf=" and _choix.choix_cleunik not in (select choix_cleunik from _act_choix_fixes where _act_choix_fixes.choix_cleunik = _choix.choix_cleunik and _act_choix_fixes.uti_cleunik=$vl_e_uti_cleunik and _act_choix_fixes.critere_cleunik=$vl_c_critere_cleunik and _act_choix_fixes.act_cleunik=$vl_e_recipiendaire)";break;
    case 'interlocuteurs':$sql_sauf=" and _choix.choix_cleunik not in (select choix_cleunik from _act_interlo_choix_fixes where _act_interlo_choix_fixes.choix_cleunik = _choix.choix_cleunik and _act_interlo_choix_fixes.uti_cleunik=$vl_e_uti_cleunik and _act_interlo_choix_fixes.critere_cleunik=$vl_c_critere_cleunik and _act_interlo_choix_fixes.int_cleunik=$vl_e_recipiendaire)";break;
    case 'articles':      $sql_sauf=" and _choix.choix_cleunik not in (select choix_cleunik from _art_choix_fixes where _art_choix_fixes.choix_cleunik = _choix.choix_cleunik and _art_choix_fixes.uti_cleunik=$vl_e_uti_cleunik and _art_choix_fixes.critere_cleunik=$vl_c_critere_cleunik and _art_choix_fixes.art_cleunik=$vl_e_recipiendaire)";break;
    case 'actions':       $sql_sauf=" and _choix.choix_cleunik not in (select choix_cleunik from _actions_choix_fixes where _actions_choix_fixes.choix_cleunik = _choix.choix_cleunik and _actions_choix_fixes.uti_cleunik=$vl_e_uti_cleunik and _actions_choix_fixes.critere_cleunik=$vl_c_critere_cleunik and _actions_choix_fixes.action_cleunik=$vl_e_recipiendaire)";break;
    case 'ged':           $sql_sauf=" and _choix.choix_cleunik not in (select choix_cleunik from _documents_choix_fixes where _documents_choix_fixes.choix_cleunik = _choix.choix_cleunik and _documents_choix_fixes.uti_cleunik=$vl_e_uti_cleunik and _documents_choix_fixes.critere_cleunik=$vl_c_critere_cleunik and _documents_choix_fixes.doc_cleunik=$vl_e_recipiendaire)";break;
  } 
}


switch ($vl_c_position) {
  case "4": //  liste de clé uniques sans notion de critère_cleunik
    $vl_t_listecles=unserialize(stripslashes($vl_t_listecles));
    $vl_e_i=-1;
    foreach($vl_t_listecles as $vl_raf) {
      $vl_e_i++;
      $vl_choix_cleunik.=$vl_t_listecles[$vl_e_i].',';
    }
    if ($vl_choix_cleunik!="") {
      $vl_choix_cleunik=substr($vl_choix_cleunik, 0, -1);
    }
    $sql_req = "SELECT _choix.critere_cleunik AS critere_cleunik,_choix.choix_cleunik AS choix_cleunik,_choix.choix_code AS choix_code,_choix.choix_valeur_texte_01 AS choix_valeur_texte_01,_choix.choix_valeur_texte_02 AS choix_valeur_texte_02,case _choix.choix_actif WHEN 1 THEN '$vl_c_actif' ELSE '$vl_c_inactif' END AS choix_actif,_choix.choix_portee AS choix_portee $sql_utilisations  FROM _choix WHERE _choix.choix_cleunik $vl_c_operateur_02 ($vl_choix_cleunik)";
    break;
  case "1": //  Actifs et inactifs
  case "2": //  les actifs
  case "3": //  les inactifs
    $sql_req = "SELECT _choix.critere_cleunik AS critere_cleunik,_choix.choix_cleunik AS choix_cleunik,_choix.choix_code AS choix_code,_choix.choix_valeur_texte_01 AS choix_valeur_texte_01,_choix.choix_valeur_texte_02 AS choix_valeur_texte_02,case _choix.choix_actif WHEN 1 THEN '$vl_c_actif' ELSE '$vl_c_inactif' END AS choix_actif,_choix.choix_portee AS choix_portee $sql_utilisations FROM _choix WHERE _choix.critere_cleunik =$vl_c_critere_cleunik ";
    switch (TRUE) {
      case $vl_c_liste_cleunik == '': break;
      default :
        $sql_req .= " AND _choix.choix_cleunik IN ($vl_t_listecles)";
        exit;
    }
    switch ($vl_c_position) {
      case "1": break;  //  Actifs et inactifs
      case "2": $sql_req .= " AND _choix.choix_actif =1";break;//  les actifs
      case "3": $sql_req .= " AND _choix.choix_actif =2";break;//  les inactifs
    }
    switch ($vl_c_etat){
      case "1": break;  //  Tous
      case "2": //  les utilisés
      case "3": //  les pas utilisés
       switch ($vl_c_critere_cleunik) {
         case 31:    //  Section Classification des produits français 
         case 32:    //  Sous-sections Classification des produits français
         case 33:    //  Divisions Classification des produits français
         case 34:    //  Groupes Classification des produits français
         case 35:    //  Classes Classification des produits français
         case 36:    //  Catégories Classification des produits français
         case 37:    //  Sous-catégories Classification des produits français
          $sql_req .= " and (SELECT count(*) as nombre from _art_choix_fixes where _art_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 11:    //  PCS N1
         case 12:    //  PCS N2
         case 13:    //  PCS N3
         case 14:    //  PCS N4
         case 21:    //  NAF N1
         case 22:    //  NAF N2
         case 23:    //  NAF N3
         case 24:    //  NAF N4
         case 25:    //  NAF N5
         case 41:    //  Catégories juridiques Niveau 1 
         case 42:    //  Catégories juridiques Niveau 2
         case 43:    //  Catégories juridiques Niveau 3
         case 51:    //  Nomenclature économique de synthèse Niveau 1 
         case 52:    //  Nomenclature économique de synthèse Niveau 2
         case 53:    //  Nomenclature économique de synthèse Niveau 3
         case 61:    //  Régions 
         case 62:    //  Départements
         case 63:    //  Arrondissements
         case 64:    //  Cantons
         case 65:    //  Communes
         case 80:    //  Genres d'acteurs
         case 136:   //   Meta tags des sites des acteurs  
          $sql_req .= " and (SELECT count(*) as nombre from _act_choix_fixes where _act_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 59:     //  Langues
          $sql_req .= " and (SELECT count(*) as nombre from _utilisateur where _utilisateur.langue_appli = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 60:    
/*        Pays On cherche dans 
         - les critères des acteurs
         - les adresses postales des acteurs
         - les adresses postales des interlocuteurs d'acteurs
         - Les adresses des offres de prix client
         - Les adresses des commandes client
         - Les adresses des livraison client
         - Les adresses des factures client
         - Les adresses des demande de prix fournisseur
         - Les adresses des commandes fournisseur
         - Les adresses des réceptions fournisseur
         - Les adresses des factures fournisseur
*/          
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_adresses.choix_cleunik) from _act_adresses,_choix where _act_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_act_choix_fixes.choix_cleunik) from _act_choix_fixes where _act_choix_fixes.critere_cleunik = $vl_c_critere_cleunik union SELECT distinct(_act_interlo_adresses.choix_cleunik) from _act_interlo_adresses,_choix where _act_interlo_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_offcli_adresses.choix_cleunik) from _offcli_adresses,_choix where _offcli_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_cdecli_adresses.choix_cleunik) from _cdecli_adresses,_choix where _cdecli_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_livcli_adresses.choix_cleunik) from _livcli_adresses,_choix where _livcli_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_faccli_adresses.choix_cleunik) from _faccli_adresses,_choix where _faccli_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_demfou_adresses.choix_cleunik) from _demfou_adresses,_choix where _demfou_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_cdefou_adresses.choix_cleunik) from _cdefou_adresses,_choix where _cdefou_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_recfou_adresses.choix_cleunik) from _recfou_adresses,_choix where _recfou_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_facfou_adresses.choix_cleunik) from _facfou_adresses,_choix where _facfou_adresses.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik);";
          break;
         case 66:    //  Préfixes téléphoniques internationaux On cherche dans les téléphones et les fax des interlocuteurs des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo_fax.prefixe_choix_cleunik) from _act_interlo_fax,_choix where _act_interlo_fax.prefixe_choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_act_interlo_tel.prefixe_choix_cleunik) from _act_interlo_tel,_choix where _act_interlo_tel.prefixe_choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
         case 67:
/*   Devise 
        On cherche dans 
         - les acteurs
         - Les offres de prix client
         - Les commandes client
         - Les livraison client
         - Les factures client
         - Les demande de prix fournisseur
         - Les commandes fournisseur
         - Les réceptions fournisseur
         - Les factures fournisseur
*/          
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_acteurs.devise) from _acteurs,_choix where _acteurs.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_offcli_entetes.devise) from _offcli_entetes,_choix where _offcli_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_cdecli_entetes.devise) from _cdecli_entetes,_choix where _cdecli_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_livcli_entetes.devise) from _livcli_entetes,_choix where _livcli_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_faccli_entetes.devise) from _faccli_entetes,_choix where _faccli_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_demfou_entetes.devise) from _demfou_entetes,_choix where _demfou_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_cdefou_entetes.devise) from _cdefou_entetes,_choix where _cdefou_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_recfou_entetes.devise) from _recfou_entetes,_choix where _recfou_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_facfou_entetes.devise) from _facfou_entetes,_choix where _facfou_entetes.devise = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik);";
          break;
         case 92:    //  Fonctions (interlocuteurs)
         case 81:     //  Genres d'interlocuteurs
          $sql_req .= " and (SELECT count(*) as nombre from _act_interlo_choix_fixes where _act_interlo_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 82:    //  Genres de téléphones On cherche dans les téléphones des interlocuteurs des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo_tel.choix_cleunik) from _act_interlo_tel,_choix where _act_interlo_tel.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik )";
          break;
         case 83:    //  Genres de Fax On cherche dans les fax des interlocuteurs des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo_fax.choix_cleunik) from _act_interlo_fax,_choix where _act_interlo_fax.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik )";
          break;
         case 84:    //  Genres de courriels On cherche dans les courriels des interlocuteurs des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo_mail.choix_cleunik) from _act_interlo_mail,_choix where _act_interlo_mail.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik )";
          break;
         case 85:    //  Genres de Sites On cherche dans les sites des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_sites.choix_cleunik) from _act_sites,_choix where _act_sites.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik )";
          break;
         case 86:    //  Civilités On cherche dans les interlocuteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo.choix_cleunik) from _act_interlo,_choix where _act_interlo.choix_cleunik = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik )";
          break;
         case 94:     //  Genres d'actions
          $sql_req .= " and (SELECT count(*) as nombre from _actions where _actions.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 95:     //  Nature des Relations entre les actions et les interlocuteurs/acteurs
          $sql_req .= " and (SELECT count(*) as nombre from _graal where _graal.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 98:    //  Genres d'adresses postales On cherche dans les adresses des acteurs et des interlocuteurs des acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_choix.choix_cleunik) from _act_adresses,_choix where _act_adresses.adr_typecoordonnees & _choix.choix_valeur_texte_02 and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_choix.choix_cleunik) from _act_interlo_adresses,_choix where _act_interlo_adresses.adr_typecoordonnees & _choix.choix_valeur_texte_02 and _choix.critere_cleunik=$vl_c_critere_cleunik);";
          break;
         case 101:  //  Tarifs de vente
         case 127:  //  Tarifs d'achats
          $sql_req .= " and ((SELECT count(*) as nombre from _art_tarifs where _art_tarifs.tarif_cleunik = _choix.choix_cleunik)+(SELECT count(*) as nombre from _act_compta where _act_compta.tarif_cleunik = _choix.choix_cleunik)) $vl_c_operateur_01 0";
          break;
         case 108:  //  Unités de stocks
          $sql_req .= " and (SELECT count(*) as nombre from _art_stock where _art_stock.unite_stock = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 109:  //  Unités de vente
          $sql_req .= " and (SELECT count(*) as nombre from _art_ventes where _art_ventes.unite_vente = _choix.choix_cleunik)+(SELECT count(*) from _cdecli_lignes_qte where qte_unite=_choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 110:  //  Unités d'achats
          $sql_req .= " and (SELECT count(*) as nombre from _art_achats where _art_achats.unite_achat = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;

         case 113:     //  Intitulé des relations entre interlocuteurs d'acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_act_interlo_relations.choix_cleunik_gauche) from _act_interlo_relations where _act_interlo_relations.choix_cleunik_gauche = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_act_interlo_relations.choix_cleunik_droite) from _act_interlo_relations where _act_interlo_relations.choix_cleunik_droite = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
         case 114:     //  Intitulé des relations entre acteurs
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_acteurs_relations.choix_cleunik_gauche) from _acteurs_relations where _acteurs_relations.choix_cleunik_gauche = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_acteurs_relations.choix_cleunik_droite) from _acteurs_relations where _acteurs_relations.choix_cleunik_droite = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_acteurs_representants.choix_cleunik_droite) from _acteurs_representants where _acteurs_representants.choix_cleunik_droite = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_acteurs_representants.choix_cleunik_gauche) from _acteurs_representants where _acteurs_representants.choix_cleunik_gauche = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
         case 115:     //  Mode de gestion
          $sql_req .= " and (SELECT count(*) as nombre from _acteurs where _acteurs.modegestion = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 116:     //  Dépôts
          $sql_req .= " and (SELECT count(*) as nombre from _art_dep_emp where _art_dep_emp.choix_depot = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 117:     //  Emplacements
          $sql_req .= " and (SELECT count(*) as nombre from _art_dep_emp where _art_dep_emp.choix_empla = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         case 118:     //  Intitulé des relations entre articles
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_art_relations.choix_cleunik_gauche) from _art_relations where _art_relations.choix_cleunik_gauche = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_art_relations.choix_cleunik_droite) from _art_relations where _art_relations.choix_cleunik_droite = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
         case 119:     //  Unités de temps
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_art_achats.unite_reappro) from _art_achats where _art_achats.unite_reappro = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_art_fournis.unite_reappro) from _art_fournis where _art_fournis.unite_reappro = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
        case 122:     //  Confidentialité des actions
          $sql_req .= " and (SELECT count(*) as nombre from _actions where _actions.confidentialite = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 123:     //  Priorités des actions
          $sql_req .= " and (SELECT count(*) as nombre from _actions where _actions.priorite = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 124:     //  Statuts des actions
          $sql_req .= " and (SELECT count(*) as nombre from _actions where _actions.statut = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 125:     //  Intitulé des relations entre action
          $sql_req .= " AND _choix.choix_cleunik $vl_c_operateur_02 (SELECT distinct(_graal_act.choix_cleunik_gauche) from _graal_act where _graal_act.choix_cleunik_gauche = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik union SELECT distinct(_graal_act.choix_cleunik_droite) from _graal_act where _graal_act.choix_cleunik_droite = _choix.choix_cleunik and _choix.critere_cleunik=$vl_c_critere_cleunik)";
          break;
        case 128:  //  Unités de conditionnement
          $sql_req .= " and (SELECT count(*) as nombre from _art_stock where _art_stock.unite_condi = _choix.choix_cleunik)+(SELECT count(*) from _cdecli_lignes_qte where unite_condi=_choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 129: //  Statuts des lignes d'actions commerciales
          $sql_req .= " and ((SELECT count(*) as nombre from _offcli_lignes where _offcli_lignes.statut = _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdecli_lignes where _cdecli_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _livcli_lignes where _livcli_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _faccli_lignes where _faccli_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _demfou_lignes where _demfou_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdefou_lignes where _cdefou_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _recfou_lignes where _recfou_lignes.statut= _choix.choix_cleunik)+(SELECT count(*) as nombre from _facfou_lignes where _facfou_lignes.statut= _choix.choix_cleunik)) $vl_c_operateur_01 0";
          break;
        case 130:  //  Origine des mouvements de stock
          $sql_req .= " and (SELECT count(*) as nombre from _mouvements_stock where _mouvements_stock.genre_mvt = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 131:  //  Unités de capacité
          $sql_req .= " and (SELECT count(*) as nombre from _art_dimensions where _art_dimensions.unite_capacite = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 132:  //  Unités de masse
          $sql_req .= " and (SELECT count(*) as nombre from _art_dimensions where _art_dimensions.unite_poids = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 133:  //  Unités de volume
        case 134:  //  Unités de surface
        case 135:  //  Unités de longueur
          break;
        case 137: //  Modes de paiement
          $sql_req .= " and (SELECT count(*) as nombre from _modereg_det where _modereg_det.mode_paiement = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 138: //  Types de paiement
          $sql_req .= " and (SELECT count(*) as nombre from _modereg_det where _modereg_det.type_paiement = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
        case 139: //  Types de port
				//	à rebrancher, une fois toutes les tables effectivement créées dans la table !!
				//$sql_req .= " and ((SELECT count(*) as nombre from _offcli_entetes where _offcli_entetes.typpor = _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdecli_entetes where _cdecli_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _livcli_entetes where _livcli_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _faccli_entetes where _faccli_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _demfou_entetes where _demfou_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdefou_entetes where _cdefou_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _recfou_entetes where _recfou_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _facfou_entetes where _facfou_entetes.typpor= _choix.choix_cleunik)) $vl_c_operateur_01 0";
        $sql_req .= " and ((SELECT count(*) as nombre from _offcli_entetes where _offcli_entetes.typpor = _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdecli_entetes where _cdecli_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _livcli_entetes where _livcli_entetes.typpor= _choix.choix_cleunik)+(SELECT count(*) as nombre from _faccli_entetes where _faccli_entetes.typpor= _choix.choix_cleunik)) $vl_c_operateur_01 0";
         break;           
        case 140: //  Modalités de livraison
					//	à rebrancher, une fois toutes les tables effectivement créées dans la table !!
        //$sql_req .= " and ((SELECT count(*) as nombre from _offcli_entetes where _offcli_entetes.modliv = _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdecli_entetes where _cdecli_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _livcli_entetes where _livcli_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _faccli_entetes where _faccli_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _demfou_entetes where _demfou_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdefou_entetes where _cdefou_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _recfou_entetes where _recfou_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _facfou_entetes where _facfou_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _act_choix_fixes where _act_choix_fixes.choix_cleunik = _choix.choix_cleunik)) $vl_c_operateur_01 0";
        $sql_req .= " and ((SELECT count(*) as nombre from _offcli_entetes where _offcli_entetes.modliv = _choix.choix_cleunik)+(SELECT count(*) as nombre from _cdecli_entetes where _cdecli_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _livcli_entetes where _livcli_entetes.modliv= _choix.choix_cleunik)+(SELECT count(*) as nombre from _faccli_entetes where _faccli_entetes.modliv= _choix.choix_cleunik)) $vl_c_operateur_01 0";
         break;           
         case 1000: //  Millésimes       (articles seuls)
         case 1001: //  Couleurs         (articles seuls)
         case 1002: //  Type de vin      (articles seuls)
         case 1003: //  Disponible  (articles seuls)
         case 1004: //  Contenants       (articles seuls)
          $sql_req .= " and (SELECT count(*) as nombre from _art_choix_fixes where _art_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
          break;
         default:
            switch ($vl_c_genre) {
              case 'graal':
                break;
              case 'acteurs':
                $sql_req .= " and (SELECT count(*) as nombre from _act_choix_fixes where _act_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
                break;
              case 'interlocuteurs':
                $sql_req .= " and (SELECT count(*) as nombre from _act_interlo_choix_fixes where _act_interlo_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
                break;
              case 'articles':
                $sql_req .= " and (SELECT count(*) as nombre from _art_choix_fixes where _art_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
                break;
              case 'actions':
                $sql_req .= " and (SELECT count(*) as nombre from _actions_choix_fixes where _actions_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
                break;
              case 'ged':
                $sql_req .= " and (SELECT count(*) as nombre from _documents_choix_fixes where _documents_choix_fixes.choix_cleunik = _choix.choix_cleunik) $vl_c_operateur_01 0";
                break;
            } 
            break;
       }
      break;
    }
}
$sql_req.=$sql_sauf;  //  Partie de cette requete gérée plus haut
if ($vl_c_critere_cleunik==65) {$sql_req.=" LIMIT 250";}
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
/*
  echo('<RDF:Description>');
	echo('<row:req>'.fa_ent_xml($sql_req).'</row:req>');
  echo('</RDF:Description>'.EOL);
*/
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
  echo('<row:critere_cleunik NC:parseType="Integer">'.fa_ent_xml($row['critere_cleunik']).'</row:critere_cleunik>');
  echo('<row:choix_cleunik NC:parseType="Integer">'.fa_ent_xml($row['choix_cleunik']).'</row:choix_cleunik>');
  echo('<row:choix_code>'.fa_ent_xml($row['choix_code']).'</row:choix_code>');
  echo('<row:choix_valeur_texte_01>'.fa_ent_xml($row['choix_valeur_texte_01']).'</row:choix_valeur_texte_01>');
  echo('<row:choix_valeur_texte_02>'.fa_ent_xml($row['choix_valeur_texte_02']).'</row:choix_valeur_texte_02>');
  echo('<row:choix_portee>'.fa_ent_xml($row['choix_portee']).'</row:choix_portee>');
  echo('<row:choix_actif>'.fa_ent_xml($row['choix_actif']).'</row:choix_actif>');
  echo('<row:nombre NC:parseType="Integer">'.fa_ent_xml($row['nombre']).'</row:nombre>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
// fin du fichier RDF
echo('</RDF:Bag>'.EOL);
//echo('<RDF:req>'.EOL);echo $sql_req;echo('</RDF:req>'.EOL);
echo('</RDF:RDF>'.EOL);
// fermeture du curseur et de la connexion
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
