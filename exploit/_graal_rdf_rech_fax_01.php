<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_typeacteur=intval(fa_recup_param('typeacteur','9'));
$vl_c_raisonsoc=fa_recup_param('raisonsoc','%');
$vl_c_quoi=intval(fa_recup_param('quoi','4'));
$vl_c_actifs=fa_recup_param('vl_c_actifs','0');
$sql_req = "SELECT _acteurs.act_cleunik as act_cleunik, _act_interlo.int_cleunik as int_cleunik, _act_interlo_fax.intel_cleunik as intel_cleunik, _acteurs.raisonsoc as raisonsoc, _acteurs.nomcommercial as nomcommercial, _choix.choix_valeur_texte_01 as civilite, concat_ws(' ',_act_interlo.prenom,_act_interlo.patronyme) as qui, _act_interlo.prenom as prenom, _act_interlo.patronyme as nom, _act_interlo_fax.telformate as notel, _act_interlo_fax.intel_05 as intel_05,_choixtel.choix_valeur_texte_01 as genretel, _choixact.choix_valeur_texte_01 as portee from _acteurs,_act_interlo,_choix,_act_interlo_fax,_choix _choixtel, _choix _choixact where _acteurs.act_cleunik = _act_interlo.act_cleunik and _choix.choix_cleunik = _act_interlo.choix_cleunik and _act_interlo_fax.int_cleunik=_act_interlo.int_cleunik and _choixtel.choix_cleunik = _act_interlo_fax.choix_cleunik and _choixact.choix_cleunik = _acteurs.typeacteur";
switch ($vl_e_typeacteur) {
    case 2: $sql_req.=" and _acteurs.typeacteur =110000";break; //  membres de l'entreprise
    case 3: $sql_req.=" and _acteurs.typeacteur =110001";break; //  Prospects clients  
    case 4: $sql_req.=" and _acteurs.typeacteur =110003";break; //  Clients 
    case 5: $sql_req.=" and _acteurs.typeacteur =110002";break; //  Prospects fournisseurs
    case 6: $sql_req.=" and _acteurs.typeacteur =110004";break; //  Fournisseurs
    case 7: $sql_req.=" and _acteurs.typeacteur =110008";break; //  Autres acteurs
    case 8: $sql_req.=" and _acteurs.typeacteur =110006";break; //  Acteurs indéterminés
    case 9: break; //  Tous les acteurs
}
switch ($vl_c_actifs) {
  case '1': $sql_req.=" and _acteurs.actif=1";break; //  actifs
  case '2': $sql_req.=" and _acteurs.actif=2";break;//  inactifs
  case '0': break;//  tous
}
switch ($vl_c_quoi) {
  case 1 : $sql_req.=" and _acteurs.raisonsoc like '$vl_c_raisonsoc%' ORDER BY `raisonsoc` ASC";break;  //  Raison sociale
  case 2 : $sql_req.=" and _acteurs.nomcommercial like '$vl_c_raisonsoc%' ORDER BY `nomcommercial` ASC";break;  //  Nom commercial
  case 3 : $sql_req.=" and concat_ws(' ',_act_interlo.prenom,_act_interlo.patronyme) like '$vl_c_raisonsoc%' ORDER BY qui ASC";break;  //  Interlocuteur
  case 4 : $sql_req.=" and _act_interlo_fax.intel_05 like '$vl_c_raisonsoc%' ORDER BY `intel_05` ASC";break;  //  fax
}
$sql_req.="  LIMIT 0, 100";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
  while ($row = mysql_fetch_assoc($result))
    {
      echo('<RDF:li>'.EOL);
      echo('<RDF:Description>');
      // parseType = indication pour le type des données, utile pour le tri sur la colonne
      echo('<row:act_cleunik NC:parseType="Integer">'.fa_ent_xml($row['act_cleunik']).'</row:act_cleunik>');
      echo('<row:int_cleunik NC:parseType="Integer">'.fa_ent_xml($row['int_cleunik']).'</row:int_cleunik>');
      echo('<row:intel_cleunik NC:parseType="Integer">'.fa_ent_xml($row['intel_cleunik']).'</row:intel_cleunik>');
      echo('<row:raisonsoc>'.fa_ent_xml($row['raisonsoc']).'</row:raisonsoc>');
      echo('<row:nc>'.fa_ent_xml($row['nomcommercial']).'</row:nc>');
      echo('<row:civilite>'.fa_ent_xml($row['civilite']).'</row:civilite>');
      echo('<row:qui>'.fa_ent_xml($row['qui']).'</row:qui>');
      echo('<row:prenom>'.fa_ent_xml($row['prenom']).'</row:prenom>');
      echo('<row:nom>'.fa_ent_xml($row['nom']).'</row:nom>');
      echo('<row:notel>'.fa_ent_xml($row['notel']).'</row:notel>');
      echo('<row:genretel>'.fa_ent_xml($row['genretel']).'</row:genretel>');
      echo('<row:portee>'.fa_ent_xml($row['portee']).'</row:portee>');
      echo('</RDF:Description>'.EOL);
      echo('</RDF:li>'.EOL);
    }
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
