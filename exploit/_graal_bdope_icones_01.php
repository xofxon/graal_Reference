<?php
include("_graal_header_txt.inc.php");
$t_origines_ok=array();
$t_origines_ok[0]="_graal_fen_doc_08";
fa_acces_script();
define('EOL', "\r\n");
$vf_e_ficones_cleunik=intval(fa_recup_param('vf_e_ficones_cleunik','0'));
$vf_c_action=fa_recup_param('vf_c_action','0');
$vf_c_titre=fa_recup_param('vf_c_titre','');
$vf_c_descriptif_sommaire=fa_recup_param('vf_c_descriptif_sommaire','');
$vf_c_hash=fa_recup_param('vf_c_hash','');
$vf_c_echo='';
switch (TRUE) {
  case $vf_c_action=='verifier_hash':
  	$sql_req = "select count(*) FROM _ficones WHERE ficones_hash = '$vf_c_hash';";
    if ($res = _graal_requete_bd($sql_req)) {
      $ligne = mysql_fetch_row($res);
      $nombre_doc=$ligne[0];
      $vf_c_echo=$nombre_doc;
      $sql_req = "select ficones_cleunik FROM _ficones WHERE ficones_hash = '$vf_c_hash';";
      if ($res = _graal_requete_bd($sql_req)) {
        $ligne = mysql_fetch_row($res);
        $vf_e_doc_cleunik=$ligne[0];
        $vf_c_echo.="|".$vf_e_doc_cleunik."|";
      }
    }
    else {
      $vf_c_echo="-1|-1|";
    }
    break;
  case $vf_c_action=='supprimer': //  Suppression d'un document 
    $sql_req = "DELETE FROM _ficones WHERE ficones_cleunik = $vf_e_ficones_cleunik";
    $res = _graal_requete_bd($sql_req);
    if($res === false) {echo 'Erreur';} else {$vf_c_echo='ok';}
    break;
  case $vf_c_action=='modifier':  //  Modification d'un document
    $sql_req = "update _ficones set ficones_designation = '$vf_c_titre',ficones_infos='$vf_c_descriptif_sommaire' where ficones_cleunik=$vf_e_ficones_cleunik";
    $res = _graal_requete_bd($sql_req);
    if($res === false) {echo 'Erreur';} else {$vf_c_echo='ok';}
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;       
?>
