<?php
//Devrait être enregistré sous forme _graal_bdope_art_fournis_01.php
include("_graal_header_txt.inc.php");
$vf_c_echo="";
$vf_c_action=fa_recup_param("vf_c_action","??????");
$vl_art_acteur_cleunik=intval(fa_recup_param("vl_art_acteur_cleunik",""));
$vl_art_cleunik=intval(fa_recup_param("vl_art_cleunik",""));
$vl_act_cleunik=intval(fa_recup_param("vl_act_cleunik",""));
$vl_code=fa_recup_param("vl_code","");
$vl_description=fa_recup_param("vl_description","");
$vl_blocnotebrut=fa_recup_param("vl_blocnotebrut","");
$vl_delai_reappro=intval(fa_recup_param("vl_delai_reappro",""));
$vl_unite_reappro=intval(fa_recup_param("vl_unite_reappro",""));
$vl_dateheurevalidite=fa_recup_param("vl_dateheurevalidite","");
$vl_minimum_commande=fa_floatval(fa_recup_param("vl_minimum_commande",4));
$type=intval(fa_recup_param("type",""));
$vl_unite_achat=intval(fa_recup_param("vl_unite_achat","-36"));
define('EOL', "\r\n");
switch (TRUE){
  case $vf_c_action=="supprimer":
    $sql_req = "DELETE FROM _art_acteur WHERE _art_acteur.art_acteur_cleunik = $vl_art_acteur_cleunik";
    $vf_c_echo=_graal_exec_requete($sql_req);
    if($vf_c_echo=='ok') {$vf_c_echo=$vl_art_fournis_cleunik;} else {$vf_c_echo=-1;}
    break;
  case $vf_c_action=="ajouter":
    $vl_art_acteur_cleunik=_graal_requete_max("art_acteur_cleunik","_art_acteur");
    switch ($type) {
      case 110004: //  fournisseur
		case 110002:  // prospect fournisseur
        $sql_req = "INSERT INTO _art_acteur set art_acteur_cleunik=$vl_art_acteur_cleunik,art_cleunik=$vl_art_cleunik,act_cleunik=$vl_act_cleunik,code='$vl_code',";
        $sql_req.= " description='$vl_description',blocnotebrut='$vl_blocnotebrut',dateheurecreation=now(),delai_reappro=$vl_delai_reappro,unite_reappro=$vl_unite_reappro,";
        $sql_req.= " minimum_commande=$vl_minimum_commande,unite_achat=$vl_unite_achat";
        break;
      case 110003: //  client
			case 110001:  // prospects clients
        $sql_req = "INSERT INTO _art_acteur set art_acteur_cleunik=$vl_art_acteur_cleunik,art_cleunik=$vl_art_cleunik,act_cleunik=$vl_act_cleunik,code='$vl_code',description='$vl_description',blocnotebrut='$vl_blocnotebrut',dateheurecreation=now()";
        break;
    }
    if ($vl_dateheurevalidite!='') {$sql_req.=",dateheurevalidite='$vl_dateheurevalidite'";}
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
  case $vf_c_action=="modifier":
    switch ($type) {
      case 110004: //  fournisseur
		  case 110002:  // prospect fournisseur
        $sql_req = "UPDATE _art_acteur set code='$vl_code',description='$vl_description',blocnotebrut='$vl_blocnotebrut',dateheuremodif=now(),delai_reappro=$vl_delai_reappro,";
        $sql_req.= " unite_reappro=$vl_unite_reappro,minimum_commande=$vl_minimum_commande,unite_achat=$vl_unite_achat";
        break;
      case 110003: //  client
		case 110001:  // prospects clients      
        $sql_req = "UPDATE _art_acteur set code='$vl_code',description='$vl_description',blocnotebrut='$vl_blocnotebrut',dateheuremodif=now()";
        break;
    }
    if ($vl_dateheurevalidite!='') {$sql_req.=",dateheurevalidite='$vl_dateheurevalidite'";}
    $sql_req.=" WHERE art_acteur_cleunik=$vl_art_acteur_cleunik;";
    $vf_c_echo=_graal_exec_requete($sql_req);
    break;
  case $vf_c_action=="??????":
    exit;
    break;
}
_graal_ferme_connexion();
echo $vf_c_echo;
?>
