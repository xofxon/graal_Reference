<?php
include("_graal_header_pdf_02.inc.php");
include("_graal_var_portee.php");
include("_graal_fonctions_numerotation.php");
include("_graal_htbrutremise_inc.php");// contient la variable $sql_htbrutremise
include("_graal_fonctions_documents.php");
include("_graal_fonctions_documents_ciaux.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_commercial_cleunik=intval(fa_recup_param("vl_commercial_cleunik","0"));
$vl_e_action_cleunik=intval(fa_recup_param("vl_e_action_cleunik","0"));
$genre_adresse=intval(fa_recup_param("vl_genre_adresse","1"));  // 1-> adresse de livraison, 2 adresse de facturation 
$vl_c_fichier_seul=fa_recup_param("vl_c_fichier_seul","non");
if ($vl_commercial_cleunik==0) {fa_redirige("acces_interdit");}
$param_generaux_graal_010=intval(fa_recup_session('vs_param_generaux_graal_010',2)); //  1->mémoriser le pdf dans le fichier, 2->ne pas le mémoriser dans le fichier
$param_generaux_graal_023=intval(fa_recup_session('vs_param_generaux_graal_023',2)); //  Identifiant document CGV
$param_generaux_graal_026=intval(fa_recup_session('vs_param_generaux_graal_026',-1)); //  Mode d'édition des CGV (Conditions générales de vente)
$param_generaux_graal_057=intval(fa_recup_session('vs_param_generaux_graal_057',-1)); //  Logo sur la première page d'édition
$param_generaux_graal_058=intval(fa_recup_session('vs_param_generaux_graal_058',-1)); //  Logo sur les autres pages d'adition
$param_generaux_graal_075=intval(fa_recup_session('vs_param_generaux_graal_075',0)); //  Largeur logo première page
$param_generaux_graal_076=intval(fa_recup_session('vs_param_generaux_graal_076',0)); //  Hauteur logo première page
$param_generaux_graal_077=intval(fa_recup_session('vs_param_generaux_graal_077',0)); //  Largeur logo autres pages
$param_generaux_graal_078=intval(fa_recup_session('vs_param_generaux_graal_078',0)); //  Hauteur logo autres pages

$vl_c_fic_ligne="_faccli_lignes";
$vl_c_fic_qte="_faccli_lignes_qte";
$vl_c_fic_entete="_faccli_entetes";
$vl_e_fic_adresses="_faccli_adresses";

$vl_c_id_fenetre="Edi_00022";

$vl_c_dico_00058=fa_recup_dico("dico_00058");
$police_du_document="FreeSerif";	// Il faut intégrer la police : 819.5 Ko
$police_du_document="Courier";		//	Police non intégrée : 3.6 Ko
$police_du_document="times";		//	Police non intégrée : 3.5 Ko	Pas de différence visuelle avec FreeSerif
$genreaction="faccli";
$genreregroupement="initial";
include("_graal_req_docial_recap_montants.inc.php");
require_once('_graal_pdf_bloc_001.php');
define('EOL', "\r\n");
class pseudo extends _graal_TCPDF {
function Header() {}
}
class toto extends _graal_TCPDF {
// private variables
var $contenu_code;
var $contenu_nom_commercial;
var $contenu_dateexp;
var $contenu_code_bondepreparation;
var $impression_cgv;
var $police_du_document;
function Header() {
	global $vl_c_fic_entete;
  global $vl_commercial_cleunik;
  global $genre_adresse;
  global $action_cleunik;
  global $datecre;
  global $dateliv;
  global $codealphnaum15_seul;
  global $description_reg;
  global $vosreferences;
  global $blocnotebrut_entete;
  global $y;
  global $cols;
  global $format;
  global $nbligne_montant_pied;
  global $hauteur_blocnote_pied;
  global $ybas_tableau;
  global $blocnotebrut_pied;
  global $position_pied;
	global $raisonsoc;
	global $vl_e_fic_adresses;
	global $date_echeance;
	global $tvaintracommunautaire;
	global $param_generaux_graal_057;
	global $param_generaux_graal_058;	
	global $param_generaux_graal_075;
	global $param_generaux_graal_076;
	global $param_generaux_graal_077;
	global $param_generaux_graal_078;

	$vl_c_bvj_101=fa_recup_dico("bvj_101");$vl_c_bvj_101="Poux Grand";
	$vl_c_bvj_102=fa_recup_dico("bvj_102");$vl_c_bvj_102="F-82300 SAINT CIRQ";
	$vl_c_bvj_103=fa_recup_dico("bvj_103");$vl_c_bvj_103="";
	$vl_c_bvj_104=fa_recup_dico("bvj_104");$vl_c_bvj_104="+33 5 63 63 94 69";
	$vl_c_bvj_105=fa_recup_dico("bvj_105");$vl_c_bvj_105="+33 5 47 74 50 81";
	$vl_c_bvj_106=fa_recup_dico("bvj_106");$vl_c_bvj_106="";
	$vl_c_bvj_107=fa_recup_dico("bvj_107");$vl_c_bvj_107="www.francelampes.com";
	$vl_c_bvj_108=fa_recup_dico("bvj_108");$vl_c_bvj_108="info@francelampes.com";
	$vl_c_bvj_109=fa_recup_dico("bvj_109");$vl_c_bvj_109="FACTURE/INVOICE";
	$vl_c_bvj_110=fa_recup_dico("bvj_110");$vl_c_bvj_110="";
	
	$vl_c_bvj_111=fa_recup_dico("bvj_111");$vl_c_bvj_111="n° ";
	$vl_c_bvj_112=fa_recup_dico("bvj_112");$vl_c_bvj_112="Date : ";
	$vl_c_bvj_113=fa_recup_dico("bvj_113");$vl_c_bvj_113="Cde Client/Order ref. : ";
	$vl_c_bvj_114=fa_recup_dico("bvj_114");$vl_c_bvj_114="Mode de règlement: ";
	$vl_c_bvj_115=fa_recup_dico("bvj_115");$vl_c_bvj_115="Livraison";
	$vl_c_bvj_116=fa_recup_dico("bvj_116");$vl_c_bvj_116="Contact :";
	$vl_c_bvj_117=fa_recup_dico("bvj_117");$vl_c_bvj_117="Compte client :";
	$vl_c_bvj_118=fa_recup_dico("bvj_118");$vl_c_bvj_118="Email :";
	$vl_c_bvj_122=fa_recup_dico("bvj_122");$vl_c_bvj_122="Echéance :";
	$vl_c_bvj_123=fa_recup_dico("bvj_123");$vl_c_bvj_123="N° TVA :";
	
	
	
	
		
  switch ($this->getPage()) {
    case 1:
    default:
		$this->_graal_logo($param_generaux_graal_058,10,6,$param_generaux_graal_077,$param_generaux_graal_078);
      $this->SetFont( $this->police_du_document, "",9);
      $length = $this->GetStringWidth( $vl_c_bvj_101 );
      $y=10;
		$this->SetXY(85,$y);$this->MultiCell(0, 4, $vl_c_bvj_101,0,'L');$y+=4;
		$this->SetXY(85,$y);$this->MultiCell(0, 4, $vl_c_bvj_102,0,'L');$y+=4;
		$this->SetXY(85,$y);$this->MultiCell(0, 4, $vl_c_bvj_103,0,'L');$y+=4;
		$this->Image('css/telephone.jpg', 85, $y, 4, 4);
		$this->SetXY(89,$y);$this->MultiCell(0, 4, $vl_c_bvj_104,0,'L');$y+=4;
		$this->Image('css/fax.jpg', 85, $y, 4, 4);
		$this->SetXY(89,$y);$this->MultiCell(0, 4, $vl_c_bvj_105,0,'L');$y+=4;
		
		$this->SetXY(85,$y);$this->MultiCell(0, 4, $vl_c_bvj_106,0,'L');$y+=4;
		$this->SetXY(85,$y);$this->MultiCell(0, 4, $vl_c_bvj_107,0,'L');$y+=4;
		$this->Image('css/courriel.jpg', 85, $y, 4, 4);
		$this->SetXY(89,$y);$this->MultiCell(0, 4, $vl_c_bvj_108,0,'L');$y+=4;
		
	  $y=10;
      $this->SetXY(150,$y);
      $this->SetFont( $this->police_du_document, "B",14);
      $length = $this->GetStringWidth( $vl_c_bvj_109 );
      $this->SetXY(150,$y);$this->Cell($length,4, $vl_c_bvj_109, 0, 0, "L");$y+=5;
      //$this->SetFont( $this->police_du_document, "BI",12);
      //$length = $this->GetStringWidth( $vl_c_bvj_110 );
      $this->SetXY(150,$y);$this->Cell($length,4, $vl_c_bvj_110, 0, 0, "L");$y+=5;
      $this->SetFont( $this->police_du_document, "B",10);
      $this->SetXY(150,$y);$this->MultiCell(0, 4, $vl_c_bvj_111.$this->contenu_code,0,'L');$y+=5;
      $this->SetFont( $this->police_du_document, "",9);
      $this->SetXY(150,$y);$this->MultiCell(0, 4, $vl_c_bvj_112.$datecre,0,'L');$y+=5;
      
      $this->SetFont( $this->police_du_document, "B",12);
      
      
      
      $this->_graal_pdf_cadre_00("",$colonne=10,$ligne=50,$largeur=95,$hauteur=50,'1111');
      $this->SetLineStyle(array("width" => 0.25, "cap" => "butt", "join" => "miter", "dash" => 0, "color" => array(0, 0, 0)));
      $this->_graal_pdf_cadre_00("",$colonne=110,$ligne=50,$largeur=90,$hauteur=50,'1111');
      $this->SetLineStyle(array("width" =>0.1, "cap" => "butt", "join" => "miter", "dash" => 0, "color" => array(0, 0, 0)));
      $this->SetFont( $this->police_du_document, "",9);
      $this->SetFillColor(255,255,255);
      
       $contenu=$vl_c_bvj_117.$codealphnaum15_seul;
       $x1=140;
       $y1=45;
       $lar=40;
       $hau=10;
       $coins="1111";
       $style="DF";
       $cadrage="L";
       $border_style="";
		$x2  = $x1 + $lar;
	$y2  = $y1 + $hau;
  $mid = $y1 + (($y2-$y1) / 2);
	$this->RoundedRect($x1, $y1, ($x2 - $x1), ($y2-$y1), 2.5, $coins,$style);
  $this->SetXY( $x1+3 , $y1+($hau/2)-3 );
  /*  
  $length = $this->GetStringWidth( $contenu );
	$this->Cell($length,2, $contenu, 0, 0, $cadrage,1);
   */   
   $length = $this->GetStringWidth( $vl_c_bvj_117 );
	$this->Cell($length,2, $vl_c_bvj_117, 0, 0, $cadrage,1);
	$this->SetFont( $this->police_du_document, "B",9);
	$length = $this->GetStringWidth( $codealphnaum15_seul );
	$this->Cell($length,2, $codealphnaum15_seul, 0, 0, $cadrage,1);

	
      $y=50;
      $this->SetXY(10,$y);
      $this->SetFont( $this->police_du_document, "",9);
      $this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_113.$vosreferences,0,'L');$y+=5;
      $this->SetFont( $this->police_du_document, "",9);
      $this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_115,0,'L');
      
      /*
	   * Recherche interlocuteur privilégié du document et ses coordonnées
	   */
	$interlo_privilegie=-110422;
	$int_cleunik=-1;
  $sql_req ="SELECT concat_ws(' ',a3.choix_valeur_texte_01,a2.prenom,a2.patronyme) as qui,a1.principal,a2.int_cleunik FROM _graal a1 left join _act_interlo a2 using(int_cleunik) ";
  $sql_req.=" left join _choix a3 on a3.choix_cleunik=a2.choix_cleunik where a1.action_cleunik=$action_cleunik and a1.choix_cleunik=$interlo_privilegie;";
  $result = _graal_requete_bd($sql_req);
  if (mysql_num_rows($result) == 0) {
  	_graal_libere_requete_bd($result);
  	$sql_req=" SELECT concat_ws(' ',a3.choix_valeur_texte_01,a2.prenom,a2.patronyme) as qui,a2.int_cleunik FROM $vl_c_fic_entete a4 left join _acteurs a5 using(act_cleunik)";
  	$sql_req.=" left join _act_interlo a2 using(act_cleunik) left join _choix a3 on a3.choix_cleunik=a2.choix_cleunik where a4.action_cleunik=$action_cleunik";
  	
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $qui="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$qui=fa_ent_xml($row['qui']);
    	$int_cleunik=$row['int_cleunik'];
  	}
  } else {
    $row = mysql_fetch_assoc($result);
    $qui=fa_ent_xml($row['qui']);
    $int_cleunik=$row['int_cleunik'];
  }
  _graal_libere_requete_bd($result);
      
      
      /*
       * On cherche l'adresse de livraison
       */
      $sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&1";
	  $result = _graal_requete_bd($sql_req);
	  if (mysql_num_rows($result) == 0) {
		//	On recherche l'adresse de facturation si l'on a pas demandé et trouvé l'adresse de livraison
	  	$sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&2;";
	  	$result = _graal_requete_bd($sql_req);
	  }
	  $row = mysql_fetch_assoc($result);
	  $adresse="";
	  if (trim($row['adr_nom'])!="") {$adresse.=$row['adr_nom'].EOL;}
	  if (trim($row['adr_complementnom'])!="") {
	  	if($qui!=$row['adr_complementnom']) {
	  		$adresse.=$row['adr_complementnom'].EOL;
	  	}
	  }
	  if (trim($row['adr_ligne1'])!="") {$adresse.=$row['adr_ligne1'].EOL;}
	  if (trim($row['adr_ligne2'])!="") {$adresse.=$row['adr_ligne2'].EOL;}
	  if (trim($row['adr_ligne3'])!="") {$adresse.=$row['adr_ligne3'].EOL;}
	  if (trim($row['adr_cp'].$row['adr_ville'])!="") {$adresse.=$row['adr_cp']." ".$row['adr_ville'].EOL;}
      if (trim($row['pays'])!="") {$adresse.=$row['pays'].EOL;}
	  
	  _graal_libere_requete_bd($result);
	  $this->SetXY(25,$y);
	  $this->MultiCell(0, 4, $adresse,0,'L');
	  $y=$this->getY();
	  
  	$sql_req=" select telformate from _act_interlo_tel where int_cleunik=$int_cleunik and portable=1;";
  	
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $tel="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$tel=fa_ent_xml($row['telformate']);
  	}
    _graal_libere_requete_bd($result);
    $sql_req=" select telformate from _act_interlo_fax where int_cleunik=$int_cleunik;";
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $fax="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$fax=fa_ent_xml($row['telformate']);
  	}
    _graal_libere_requete_bd($result);
    
    $sql_req=" select refweb from _act_interlo_mail where int_cleunik=$int_cleunik;";
    //
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $mail="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$mail=fa_ent_xml($row['refweb']);
  	}
    _graal_libere_requete_bd($result);
    $sql_req=" select telformate from _act_interlo_tel where int_cleunik=$int_cleunik and portable=2;";
  	$result = _graal_requete_bd($sql_req);
  	if (mysql_num_rows($result) == 0) {
	    $por="";
  	} else {
    	$row = mysql_fetch_assoc($result);
    	$por=fa_ent_xml($row['telformate']);
  	}
    _graal_libere_requete_bd($result);
  	$x=$this->getX();
  	$x=11;
  	$this->SetXY(10,$y);$this->MultiCell(0, 4, $vl_c_bvj_116.$qui,0,'L');$y+=5;
    if (trim($tel)!=""){
	 	$this->Image('css/telephone.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $tel );
		$this->Cell( $length, 2, $tel);
		$x+=$length+2;
    }
    
  if (trim($fax)!=""){
	 	$this->Image('css/fax.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $fax );
		$this->Cell( $length, 2, $fax);
		$x+=$length+2;
    }
  if (trim($por)!=""){
	 	$this->Image('css/portable.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $por );
		$this->Cell( $length, 2, $por);
		$x+=$length+2;
    }
    $y+=5;
    $x=11;
    if (trim($mail)!=""){
	 	$this->Image('css/courriel.jpg', $x, $y, 4, 4);
	 	$x+=5;
		$this->setXY($x,$y);
		$length = $this->GetStringWidth( $mail );
		$this->Cell( $length, 2, $mail);
		$x+=$length+2;
    }
      /*
       * On recherche l'adresse de facturation
       */
	  $sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&2";
	  $result = _graal_requete_bd($sql_req);
	  if (mysql_num_rows($result) == 0){
		//	On recherche l'adresse de livraison si l'on a pas trouvé l'adresse de facturation
	  	$sql_req="Select f1.*,f2.choix_valeur_texte_01 as pays from $vl_e_fic_adresses f1 left join _choix f2 using(choix_cleunik) where f1.commercial_cleunik=$vl_commercial_cleunik and f1.adr_typecoordonnees&1;";
	  	$result = _graal_requete_bd($sql_req);
	  }
	  $row = mysql_fetch_assoc($result);
	  $adresse="";
	  if (trim($row['adr_nom'])!="") {$adresse.=$row['adr_nom'].EOL;}
  	  if (trim($row['adr_complementnom'])!="") {
  	  	if($row['adr_nom']!=$row['adr_complementnom']) {
		  	if($qui!=$row['adr_complementnom']) {
		  		$adresse.=$row['adr_complementnom'].EOL;
		  	}
  	  	}
	  }
	  if (trim($row['adr_ligne1'])!="") {$adresse.=$row['adr_ligne1'].EOL;}
	  if (trim($row['adr_ligne2'])!="") {$adresse.=$row['adr_ligne2'].EOL;}
	  if (trim($row['adr_ligne3'])!="") {$adresse.=$row['adr_ligne3'].EOL;}
	  if (trim($row['adr_cp'].$row['adr_ville'])!="") {$adresse.=$row['adr_cp']." ".$row['adr_ville'].EOL;}
      if (trim($row['pays'])!="") {$adresse.=$row['pays'].EOL;}
      if (trim($tvaintracommunautaire)!="") {$adresse.=EOL.EOL.$vl_c_bvj_123.$tvaintracommunautaire;}
	  
	  _graal_libere_requete_bd($result);
	  $this->SetXY(120,60);
	  $this->SetFont( $this->police_du_document, "",10);
	  $this->MultiCell(0, 4, $adresse,0,'L');
      $y+=5;
      
  $this->SetFont($this->police_du_document, "",11);
  $this->SetXY(10,100);
  $this->MultiCell(0, 4, $blocnotebrut_entete,0,"L");
  //  Entête du tableau
  $this->SetFont($this->police_du_document, "",9);
  $y=$this->getY();
  /*
  if ($nbligne_montant_pied>2) {
    $this->addCols_01( $cols,$xyz=array("10",$y,(30+(($nbligne_montant_pied-2)*5)+$hauteur_blocnote_pied)));
  } else {
    $this->addCols_01( $cols,$xyz=array("10",$y,30+$hauteur_blocnote_pied));
  }
  */
  $this->addCols_01( $cols,$xyz=array("10",$y,30+$hauteur_blocnote_pied));
  //$this->addCols_02( $cols,$xyz=array("10",$y,30+$hauteur_blocnote_pied,23));
  $this->addLineFormat_00($format,$cols);
  $this->setY($y+10);
  $y=$this->getY();
  $ybas_tableau=$this->h - ($this->h-$position_pied);
      break;
    
  }
}
}
$sql_req ="SELECT f1.blocnotebrut,f1.code_interne,f1.mnemotechnique_interne as z06,f1.description_interne,f4.qte,f4.qte_nbdec,f4.qte_unite as z10,f1.pu as pu,";
$sql_req.=" f1.pu_type as z12,f1.nbdec_pu,f1.remise_taux,f2.choix_valeur_texte_01 as z17,f3.choix_valeur_texte_01 as z18,f1.typeligne as z19,f1.coef_facture as coef_facture,";
$sql_req.=" f1.remise_genr,f1.remise_natu,f1.remise_type,$sql_htbrutremise,f5.code,f6.code as code_tpf from $vl_c_fic_ligne f1,_choix f2,_choix f3,$vl_c_fic_qte f4,";
$sql_req.=" _param_taxes f5, _param_tpf f6 WHERE commercial_cleunik=$vl_commercial_cleunik and f1.commercial_ligne_cleunik=f4.commercial_ligne_cleunik";
$sql_req.="  and f2.choix_cleunik = qte_unite and f3.choix_cleunik=statut and f5.taxes_cleunik=f1.taxes_cleunik and f6.tpf_cleunik=f1.tpf_cleunik order by f1.ligne_cleunik;";
//die($sql_req);
$result = _graal_requete_bd($sql_req);
if (mysql_num_rows($result)==0) {
  //  Rien à éditer
  $pdf = new _graal_TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true);
  $pdf->_graal_pf_rai(); 
} else {
	$vl_c_bvj_114=fa_recup_dico("bvj_114");$vl_c_bvj_114="Mode de règlement: ";
	$vl_c_bvj_119=fa_recup_dico("bvj_119");$vl_c_bvj_119="SARL au capital de 7622.45 euros - RCS Montauban B 412 223 349 - APE 4669A - Code TVA FR 84 412 223 349 00033";
	$vl_c_bvj_120=fa_recup_dico("bvj_120");$vl_c_bvj_120="DEEE :Eco-contribution de recyclage pour les lampes usagées (JO 29/08/2006)";
	$vl_c_bvj_121=fa_recup_dico("bvj_121");$vl_c_bvj_121="Nous nous réservons la propriété des matériels et fournitures jusqu'au paiement complet du prix par l'acheteur. Notre réserve de propriété porte aussi bien sur les marchandises que sur leur prix si elles ont déjà été revendues (Loi N° 80.335 du 12 Mai 1980). Aucun escompte ne pourra êre déduit de cette facture.";
	$vl_c_bvj_122=fa_recup_dico("bvj_122");$vl_c_bvj_122="Echéance :";
	$texte_entre_corps_et_pied_01=$vl_c_bvj_119;
  	$texte_entre_corps_et_pied_02=$vl_c_bvj_120;
  	$texte_fin_de_page=$vl_c_bvj_121;
  //  Recherche informations entête
  //  Recherche du nombre de remises de lignes pour déterminer l'affichage ou non de la colonne  
  //  Recherche du nombre de taux de taxes différents pour déterminer l'affichage ou non de la colonne  
	include("_graal_bloc_code_docciaux_03.php");
  //  Calcul du nombre de lignes de montants dans le pied
	include("_graal_bloc_code_docciaux_montants_pied_doc.php");
  $pseudo_pdf = new pseudo(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true);
  $pseudo_pdf->Open();
  $pseudo_pdf->SetFont( $police_du_document, "", 9);  //  Police utilisée pour les lignes
  $hauteur_blocnote_pied=0;
  $hauteur_texte_entre_corps_et_pied_01=0;
  $hauteur_texte_entre_corps_et_pied_02=0;
  $hauteur_fin_de_page=0;
  if (trim($blocnotebrut_pied)!="") {
    $hauteur_blocnote_pied+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $blocnotebrut_pied,$x=10,$pos=2,array($police_du_document, "", 9)),0);
  }
if (trim($texte_entre_corps_et_pied_01)!="") {
    $hauteur_texte_entre_corps_et_pied_01+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $texte_entre_corps_et_pied_01,$x=10,$pos=2,array($police_du_document, "", 6)),0);
    $hauteur_texte_entre_corps_et_pied_01=5;
  }
if (trim($texte_entre_corps_et_pied_02)!="") {
    $hauteur_texte_entre_corps_et_pied_02+=round($pseudo_pdf->_graal_hauteur_00( $y=80, $texte_entre_corps_et_pied_02,$x=10,$pos=2,array($police_du_document, "", 6)),0);
    $hauteur_texte_entre_corps_et_pied_02=5;
  }
if (trim($texte_fin_de_page)!="") {
    $hauteur_fin_de_page+=round($pseudo_pdf->_graal_hauteur_00( $y=0, $texte_fin_de_page,$x=10,$pos=2,array($police_du_document, "", 6)),0);
  } else{
  	$hauteur_fin_de_page+=10;
  }
  
  if ($texte_entre_corps_et_pied_02>$texte_entre_corps_et_pied_01){
  	$hauteur_blocnote_pied+=$hauteur_texte_entre_corps_et_pied_02;
  } else {
  	$hauteur_blocnote_pied+=$hauteur_texte_entre_corps_et_pied_01;
  }
  
  $hauteur_blocnote_pied+=$hauteur_fin_de_page;
  
  //  S'il y a 2 lignes de montants, le pied peut commencer à 270
  $position_pied=250;
  if ($nbligne_montant_pied>2) {
    $position_pied=$position_pied-(($nbligne_montant_pied-2)*5);
  }
  $position_pied-=$hauteur_blocnote_pied;
  $pdf = new toto(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true); 
  $pdf->SetCreator(PDF_CREATOR);
  //$pdf->SetProtection(array('print'));  //  On protège le document : seule l'impression est autorisée. 
  /*
   * le 27 août 2009 -> ne plus utiliser la protection, sinon on ne peut rien faire avec le document via le programme pdftk
   */
  //$pdf->setPrintHeader(false);
  $pdf->setPrintFooter(false);  //  Définir ce que l'on mettra dans le pied
  $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);
  $pdf->SetAutoPageBreak(TRUE, 10);
  $pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
  $pdf->SetFooterMargin(5);
  $pdf->SetLineWidth(0.01);  //  Cadre invisible
  $pdf->AliasNbPages("nombredepages");
  $pdf->contenu_code=$code;
  $pdf->contenu_dateexp=$dateexp;
  
  
  $ref_col=array();
  $vl_c_bvj_124=fa_recup_dico("bvj_124");
  $vl_c_bvj_125=fa_recup_dico("bvj_125");
  $vl_c_bvj_126=fa_recup_dico("bvj_126");
  $vl_c_bvj_127=fa_recup_dico("bvj_127");
  $vl_c_bvj_128=fa_recup_dico("bvj_128");
  $vl_c_bvj_129=fa_recup_dico("bvj_129");
  $vl_c_bvj_130=fa_recup_dico("bvj_130");
  $vl_c_bvj_131=fa_recup_dico("bvj_131");
  
  $ref_col[ 0]="Référence";
  $ref_col[ 1]="Désignation";
  $ref_col[ 2]="Quantité";
  $ref_col[ 3]="PU";
  $ref_col[ 4]="Montant";
  $ref_col[ 5]="Taxe DEEE";
  $ref_col[ 6]="Remise";
  $ref_col[ 7]="T";
  
  $ref_col[ 0]=$vl_c_bvj_124;
  $ref_col[ 1]=$vl_c_bvj_125;
  $ref_col[ 2]=$vl_c_bvj_126;
  $ref_col[ 3]=$vl_c_bvj_127;
  $ref_col[ 4]=$vl_c_bvj_128;
  $ref_col[ 5]=$vl_c_bvj_129;
  $ref_col[ 6]=$vl_c_bvj_130;
  $ref_col[ 7]=$vl_c_bvj_131;
  
  
  
  switch ($nombre_taxes) {
    case 1:
      switch ($nb_remises_lignes) {
        case 0:
        	switch ($nombre_tpf){
        		case 0:
        			$cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>110,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 4]=>20);
			          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 4]=>"R");
			          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"));
			          $type=array($ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 4]=>"Texte");
			          break;
        		default:
        			$cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>100,$ref_col[ 5]=>10,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 4]=>20);
			          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 5]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 4]=>"R");
			          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 5]=>array($police_du_document,"","6"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"));
			          $type=array($ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 5]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 4]=>"Texte");
        			break;
        	}
            break;
        default:
        	switch ($nombre_tpf){
        		case 0:
        			//  Attention largeur minimum 6 ???? !!!! pour taxe ????
			          $cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>90,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 6]=>20,$ref_col[ 4]=>20);
			          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 6]=>"R",$ref_col[ 4]=>"R");
			          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 6]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"));
			          $type=array( $ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 6]=>"Texte",$ref_col[ 4]=>"Texte");
			          break;
        		default:
			          $cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>80,$ref_col[ 5]=>10,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 6]=>20,$ref_col[ 4]=>20);
			          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 5]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 6]=>"R",$ref_col[ 4]=>"R");
			          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 5]=>array($police_du_document,"","6"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 6]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"));
			          $type=array( $ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 5]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 6]=>"Texte",$ref_col[ 4]=>"Texte");
			          
        			break;
        	}
            break;
          
        break;
      }
      break;
    default:
      switch ($nb_remises_lignes) {
        case 0:
        	switch ($nombre_tpf){
        		case 0:
        			$cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>104,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 4]=>20,$ref_col[ 7]=>6);
          			$format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 4]=>"R",$ref_col[ 7]=>"C");
          			$fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"),$ref_col[ 7]=>array($police_du_document,"","9"));
          			$type=array($ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 4]=>"Texte",$ref_col[ 7]=>"Texte");
			          break;
        		default:
			          $cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>94,$ref_col[ 5]=>10,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 4]=>20,$ref_col[ 7]=>6);
          			$format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 5]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 4]=>"R",$ref_col[ 7]=>"C");
          			$fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 5]=>array($police_du_document,"","6"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"),$ref_col[ 7]=>array($police_du_document,"","9"));
          			$type=array($ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 5]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 4]=>"Texte",$ref_col[ 7]=>"Texte");
        			break;
        	}
            break;
        default:
      		switch ($nombre_tpf){
        		case 0:
        			//  Attention largeur minimum 6 ???? !!!! pour taxe ????
			          $cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>84,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 6]=>20,$ref_col[ 4]=>20,$ref_col[ 7]=>6);
			          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 6]=>"R",$ref_col[ 4]=>"R",$ref_col[ 7]=>"R");
			          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 6]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"),$ref_col[ 7]=>array($police_du_document,"","9"));
			          $type=array( $ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 6]=>"Texte",$ref_col[ 4]=>"Texte",$ref_col[ 7]=>"Texte");
			          break;
        		default:
          			//  Attention largeur minimum 6 ???? !!!! pour taxe ????
          $cols=array( $ref_col[ 0]=>25,$ref_col[ 1]=>74,$ref_col[ 5]=>10,$ref_col[ 2]=>15,$ref_col[ 3]=>20,$ref_col[ 6]=>20,$ref_col[ 4]=>20,$ref_col[ 7]=>6);
          $format=array($ref_col[ 0]=>"L",$ref_col[ 1]=>"L",$ref_col[ 5]=>"L",$ref_col[ 2]=>"C",$ref_col[ 3]=>"R",$ref_col[ 6]=>"R",$ref_col[ 4]=>"R",$ref_col[ 7]=>"R");
          $fonts=array( $ref_col[ 0]=>array($police_du_document,"B","9"),$ref_col[ 1]=>array($police_du_document,"","9"),$ref_col[ 5]=>array($police_du_document,"","6"),$ref_col[ 2]=>array($police_du_document,"B","9"),$ref_col[ 3]=>array($police_du_document,"","9"),$ref_col[ 6]=>array($police_du_document,"","9"),$ref_col[ 4]=>array($police_du_document,"","9"),$ref_col[ 7]=>array($police_du_document,"","9"));
          $type=array( $ref_col[ 0]=>"Texte",$ref_col[ 1]=>"Texte",$ref_col[ 5]=>"Texte",$ref_col[ 2]=>"Texte",$ref_col[ 3]=>"Texte",$ref_col[ 6]=>"Texte",$ref_col[ 4]=>"Texte",$ref_col[ 7]=>"Texte");
          			
        			break;
        	}
        	
        	
          
        break;
      }
    break;
  }
	$pdf->impression_cgv="false";
  $pdf->AddPage();
  
  //	Impression du corps de la page : modele 3: Code, Désignation, TaxeParafiscale (le cas échéant), Quantité,PU,Remise(le cas écheant), montant, code taxe (le cas échéant)
	include('_graal_bloc_code_docciaux_impression_corpus_doc_07.php');
  //  Fin de document
  include("_graal_bloc_code_docciaux_impression_pied_doc_04.php");
  
  fa_fin_creation_faccli();
}
?>
