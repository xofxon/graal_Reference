<?php
include("_graal_header_xul.inc.php");
$vl_e_uti_cleunik =intval(fa_recup_session('vs_uti_cleunik','0'));
$vl_c_type=fa_recup_param('type','1');  //  1 Normal,2 Choix,3 Critere
$vl_c_genre=fa_recup_param('genre','0');  //  1 ventes, 2 achats
$vl_e_choix_cleunik=intval(fa_recup_param('vl_e_choix_cleunik','0'));
$vl_e_critere_cleunik=intval(fa_recup_param('vl_e_critere_cleunik','0'));
$vl_c_quoi=fa_recup_param('vl_c_quoi','');
$vl_c_enclair=fa_recup_param('vl_c_enclair','');
$vl_c_code_critere=fa_recup_param('vl_c_code_critere','');
$vl_c_code_choix=fa_recup_param('vl_c_code_choix','');
$vl_c_deno_critere=fa_recup_param('vl_c_deno_critere','');
$vl_c_deno_choix=fa_recup_param('vl_c_deno_choix','');
switch ($vl_c_genre) {
  case "1": $vl_c_id_fenetre="Fen_00xxx";$vl_c_id_article_recherche="Div_xxxxx";$vl_c_id_inc_infos_critere_choix_01="Div_00344";$vl_c_id_inc_acteurs_selection_01="Div_00040";$vl_c_id_inc_acteurs_01="Div_00033";break;  //  Tarifs de vente
  case "2": $vl_c_id_fenetre="Fen_01112";$vl_c_id_article_recherche="Div_00591";$id_inc_tarifs_particuliers_fournis="Div_00445";$vl_c_id_inc_infos_critere_choix_01="Div_00344";$vl_c_id_inc_acteurs_selection_01="Div_00040";$vl_c_id_inc_acteurs_01="Div_00033";break;  //  Tarifs d'achats
  default: fa_redirige("acces_interdit");break;
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];if ($vl_b_acces==false) {fa_redirige("acces_interdit");}
$ml_fournisseurs="";
$sql_req_panier = "SELECT panier_requete_selection as req,panier_resultat,panier_type,panier_portee FROM `_panier` WHERE panier_cleunik=-78";//	Fournisseurs avec tarifs particuliers
    $result = _graal_requete_bd($sql_req_panier);
    $row = mysql_fetch_assoc($result);
    $panier_portee=$row['panier_portee'];
    if ($row['panier_type']==1) {
      $vl_act_cleunik=$row['panier_resultat'];
      _graal_libere_requete_bd($result);
    } else {
      $sql_req_panier = $row['req'];
      _graal_libere_requete_bd($result);
      $result = _graal_requete_bd($sql_req_panier);
      while ($row = mysql_fetch_assoc($result)) {
      
        $vl_act_cleunik=$row[act_cleunik];
        $vl_c_qui=_graal_requete_acteur($vl_act_cleunik);
        $ml_fournisseurs.="<menuitem sizetopopup='none' class='menuitem-non-iconic' value='-1' id='-1' _graal_cleunik='$vl_act_cleunik' label='$vl_c_qui'/>";
      }
    }
if ($ml_fournisseurs!=""){
	$ml_fournisseurs_finale="<menulist sizetopopup='none' onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' observes='broadcaster_bem' flex='1' id='ml_fournisseurs'><menupopup>";
	$ml_fournisseurs_finale.=$ml_fournisseurs;
	$ml_fournisseurs_finale.="</menupopup></menulist>";
}
_graal_requete_charge_varlib($vl_c_id_fenetre,$vl_e_uti_cleunik);$vl_c_graal_cp00=fa_cree_graal_cp00($vl_c_id_fenetre);
$vl_c_bvd_100=fa_recup_dico("bvd_100");
$vl_c_bvd_101=fa_recup_dico("bvd_101");
$vl_c_bvd_102=fa_recup_dico("bvd_102");
$vl_c_bvd_103=fa_recup_dico("bvd_103");
$vl_c_bvd_104=fa_recup_dico("bvd_104");
$vl_c_bvd_105=fa_recup_dico("bvd_105");
$vl_c_dico_00013=fa_recup_dico("dico_00013");
$vl_c_dico_00014=fa_recup_dico("dico_00014");
$vl_c_dico_00026=fa_recup_dico("dico_00026");
$vl_c_dico_00046=fa_recup_dico("dico_00046");
$vl_c_dico_00047=fa_recup_dico("dico_00047");
$vl_c_dico_00106=fa_recup_dico("dico_00106");
switch ($vl_c_genre) {
  case "1": //  Tarifs de vente
    $vl_c_id_t01="Trait_00xxx";$vl_c_id_t02="Trait_00xxx";
    break;  
  case "2": //  Tarifs d'achats
    $vl_c_id_t01="Trait_00313";$vl_c_id_t02="Trait_00314";
    break;  
}
_graal_requete_charge_libobj($vl_c_id_t01,$vl_e_uti_cleunik);$vl_c_t01=fa_recup_dico("$vl_c_id_t01");
_graal_requete_charge_libobj($vl_c_id_t02,$vl_e_uti_cleunik);$vl_c_t02=fa_recup_dico("$vl_c_id_t02");
$bt_suppression_tarif='';
$bt_desactivation_tarif='';
$bt_activation_tarif='';
$bt_maj_validite='';
$bt_maj_tarifs='';
$bt_dup_tarifs='';
include("_graal_header_winxul.inc.php");
$c_id_windows=$vl_c_id_fenetre;
$c_id_windows="";
$vl_tc_composants=array($vl_c_id_fenetre,$vl_c_id_article_recherche,$id_inc_tarifs_particuliers_fournis);
echo <<<END
<window id="$c_id_windows" title="$vl_c_bvd_100" onload="fa_aa(this);pf_aa_init()" onunload="pf_aa_ferme();" $c_xmlns>
$vl_c_graal_cp00
END;
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t01,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==true){
	$vl_complement_arbre_tarif_particulier_achat_01=('<menuitem label="'.$vl_c_t01.'" oncommand="pf_export_excel_01();" class="menuitem-iconic ak05" dir="reverse"/>');
}
$vl_tb_droits=_graal_requete_droits_fenetre($vl_c_id_t02,$vl_e_uti_cleunik);$vl_b_acces=$vl_tb_droits[0];
if ($vl_b_acces==true){
	$vl_importation_excel=<<<EOT
	<button id="bt_ouvre_csv" flex="1" label="$vl_c_t02" tooltiptext="$vl_c_t02" oncommand="pf_ouvre_csv();" class="menuitem-iconic ak05" dir="reverse" />
	<menulist sizetopopup="none" value="1" onfocus='setTimeout(fa_focus_gere_menulist, 0, this);' id="ml_separateur" class="sans_icone" _graal_nombre="2">
		<menupopup>
			<menuitem value="1" label="$vl_c_bvd_104" tooltiptext="$vl_c_bvd_104" crop="end"/>
          	<menuitem value="2" label="$vl_c_bvd_105" tooltiptext="$vl_c_bvd_105" crop="end"/>
		</menupopup>
	</menulist>
	<radiogroup id='rdg_maj_codes' value="2">
            <hbox>
            <label value="MAJ des codes chez le fournisseur"/>
              <radio observes="broadcaster_01" id='ra_oui_maj_codes' label="$vl_c_dico_00013" value='1' />
              <radio observes="broadcaster_01" id='ra_non_maj_codes' label="$vl_c_dico_00014" value='2'/>
            </hbox>
          </radiogroup>
EOT;
}
include("_graal_visites.inc.php");
include_once("js/_graal_05_dates.js.php");
include_once("js/_graal_01.js.php");
include("js/_graal_articles_traitements_03.js.php");
include("js/_graal_03.js.php");
$vl_c_type_article_recherche="10";
include("js/_graal_articles_selection_01.js.php");
echo <<<END
<vbox id="vb_selection">
<hbox>
$ml_fournisseurs_finale
</hbox>
  <vbox >
END;
switch ($vl_c_type) {
  case '1' : // Normal
    include("_graal_inc_articles_recherche_01.php");
    break;
  case '2' : // Choix
  case '3' : // Crit√®re
    $_graal_inc_infos_critere_choix_01="articles";
    include("_graal_inc_infos_critere_choix_01.php");
    break;
}
echo <<<END
</vbox>
</vbox>
<hbox >
<button flex="1" id="bt_saisie" tooltiptext ="$vl_c_bvd_101" label="$vl_c_bvd_101" crop="end" dir="normal" oncommand="pf_saisie();" />
$vl_importation_excel
<button flex="1" id="bt_validation" tooltiptext ="$vl_c_bvd_102" label="$vl_c_bvd_102" crop="end" dir="normal" oncommand="pf_validation();" collapsed="true"/>
</hbox>
<vbox id="$vl_c_id_vbox_inc_article_01" flex="2">
END;
$vl_b_toolbar_tarifs_particulier_achat=="pasok";
$vl_b_code_chez_fournisseur=="ok";
include("_graal_inc_arbre_tarif_particulier_achat_02.php");
echo <<<END
</vbox>
</vbox>


  </window>
END;
?>
