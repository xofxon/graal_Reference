<?php
include("_graal_header_txt.inc.php");
$eol="\n";
$today = date("D M j G:i:s T Y");
$vl_c_smtp=fa_recup_param('vl_c_serveursmtp','');
$vl_c_sendmail_from=fa_recup_param('vl_c_sendfrom','');
$vl_c_nomemetteur=fa_recup_param('vl_c_nomemetteur','');
$vl_c_emetteur=fa_recup_param('vl_c_courrielemetteur','');
$vl_c_destinataire="<".fa_recup_param('vl_c_destinataire','').">";
$vl_c_port_smtp=intval(fa_recup_param('vl_c_port_smtp','25'));
$vs_mesid=fa_recup_session('vs_mesid','xsoftware');
$vl_c_sujet="Envoi test envoyé le ".$today;
$vl_c_message="Message test envoyé le ".$today;
//  On décide de toujours commencer par l'émetteur
$vl_c_id="<"._graal_requete_uuid().$vs_mesid.">";
$vl_c_id=str_replace("-",".",$vl_c_id);
$vl_c_headers="From: $vl_c_emetteur$eol";
$vl_c_headers .= "Return-Path: $vl_c_emetteur$eol";
$vl_c_headers .= "Message-ID: $vl_c_id$eol";
$vl_c_headers .= "X-Mailer: XsOFtware Logiciel de gestion en ligne pour les TPE$eol";
$vl_c_headers .= "MIME-Version: 1.0$eol";
$vl_c_headers .= "Content-type: text/plain; charset=utf-8$eol";  //  Par défaut pour du texte
$vl_c_headers .= "X-Priority: 5$eol";
$vl_c_headers .= "Sensitivity:private$eol";
//*******************************************
//  Modification ponctuelle des paramètres du serveur
//*******************************************

ini_set('SMTP',$vl_c_smtp);
ini_set('sendmail_from',$vl_c_sendmail_from);
ini_set('smtp_port',$vl_c_port_smtp);

/*
ini_set('SMTP',"smtp.xsoftware.fr");
ini_set('sendmail_from',$vl_c_sendmail_from);
ini_set('smtp_port',25);
*/
if (mail($vl_c_destinataire, $vl_c_sujet, $vl_c_message, $vl_c_headers,"-f $vl_c_sendmail_from") == true){
  echo "ok, courrier envoyé à $vl_c_destinataire".$eol."$vl_c_sujet".$eol."$vl_c_message".$eol."$vl_c_headers";
}
else {
  echo "Le courriel n'a pas été envoyé à $vl_c_destinataire".$eol."$vl_c_sujet".$eol."$vl_c_message".$eol."$vl_c_headers";
}
//*******************************************
//  Remise en l'état des paramètres du serveur
//*******************************************
ini_restore('SMTP');
ini_restore('sendmail_from'); 
ini_restore('smtp_port');
?>
