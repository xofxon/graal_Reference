<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$vl_e_art_cleunik=intval(fa_recup_param("vl_art_cleunik","10000113"));
$vl_actif=intval(fa_recup_param("actif",3));
$vl_e_type_tarifs=intval(fa_recup_param("vl_e_type_tarifs",'-1'));
$vl_e_tarif_cleunik=intval(fa_recup_param("vl_e_tarif_cleunik",'-1'));
$sql_req = "SELECT _acteurs.act_cleunik as act_cleunik,tar_cleunik,case _art_tarifs.pu_reference WHEN 0 THEN '' ELSE round(_art_tarifs.pu_reference,_art_tarifs.nb_dec) END as pu_reference,choix_code,choix_valeur_texte_01,nomcommercial,"._graalsql_date('dateheure_validite')." as datevalidite,_art_tarifs.actif FROM _article,_art_tarifs,_choix,_acteurs where choix_cleunik=tarif_cleunik and _art_tarifs.art_cleunik=$vl_e_art_cleunik and _article.art_cleunik=$vl_e_art_cleunik and _acteurs.act_cleunik=_art_tarifs.act_cleunik and type=$vl_e_type_tarifs and tarif_cleunik=$vl_e_tarif_cleunik";
switch ($vl_actif) {
  case 1 : $sql_req.= " and _art_tarifs.actif=1";break;
  case 2 : $sql_req.= " and _art_tarifs.actif=2";break;
  case 3 : break;
}
$sql_req.=" order by choix_valeur_texte_01;";
$result = _graal_requete_bd($sql_req);
echo(fa_xcree_entete_rdf());
while ($row = mysql_fetch_assoc($result)) {
  echo('<RDF:li>'.EOL);
  echo('<RDF:Description>');
    // parseType = indication pour le type des donn√©es, utile pour le tri sur la colonne
    echo('<row:tar_cleunik_type NC:parseType="Integer">'.fa_ent_xml($row['tar_cleunik']).'</row:tar_cleunik_type>');
    echo('<row:act_cleunik_particulier NC:parseType="Integer">'.fa_ent_xml($row['act_cleunik']).'</row:act_cleunik_particulier>');
    echo('<row:code_type>'.fa_ent_xml($row['choix_code']).'</row:code_type>');
    echo('<row:designation_type>'.fa_ent_xml($row['choix_valeur_texte_01']).'</row:designation_type>');
    echo('<row:tarif_type>'.fa_ent_xml($row['pu_reference']).'</row:tarif_type>');
    echo('<row:nomacteur_particulier>'.fa_ent_xml($row['nomcommercial']).'</row:nomacteur_particulier>');
    if ($row['actif']==1) {
      echo('<row:properties></row:properties>');
    } else {
      echo('<row:properties>css_0001</row:properties>');
    }
    echo('<row:datevalidite>'.fa_ent_xml($row['datevalidite']).'</row:datevalidite>');
    //echo('<row:req>'.fa_ent_xml($sql_req).'</row:req>');
  echo('</RDF:Description>'.EOL);
  echo('</RDF:li>'.EOL);
}
echo('</RDF:Bag>'.EOL);
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
_graal_ferme_connexion();
?>
