<?php
_graal_requete_charge_varlib($vl_c_id_inc_mysql_objets_02,$vl_e_uti_cleunik);
/*
if ($vl_c_requete=='') die('Error: SQL command must be provided');
$command = strtolower(substr($vl_c_requete,0,strpos($vl_c_requete,' ')));
if (strpos('select,show,describe,check',$command)===false) die('Error: Only SELECT/SHOW/DESCRIBE/CHECK is allowed');
$connection = mysql_connect($sql_serveur,$sql_user,$sql_passwd) or die('Error: Could not connect to server - ' . mysql_error());
$result = mysql_query("SET CHARACTER SET 'utf8';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$vl_c_requete);
$result = mysql_query("SET collation_connection = 'utf8_general_ci';",$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$vl_c_requete);
$result = mysql_query($vl_c_requete,$connection) or die('Error: Query failed - ' . mysql_error().'<br>'.$vl_c_requete);
*/
$command = strtolower(substr($vl_c_requete,0,strpos($vl_c_requete,' ')));
if (strpos('select,show,describe,check',$command)===false) $vl_c_requete="";
$connection = mysql_connect($sql_serveur,$sql_user,$sql_passwd);
$result = mysql_query("SET CHARACTER SET 'utf8';",$connection);
$result = mysql_query("SET collation_connection = 'utf8_general_ci';",$connection);
$result = mysql_query($vl_c_requete,$connection);
$nfields = mysql_num_fields($result);
echo <<<END
  <vbox id="wab_objets_01" flex="1" class="overflow_01" >
    <tree id="arbre_receptacle" flex="1" hidecolumnpicker="true" flags="" ref="*" querytype="xml" datasources="" context="wab_cp01" >
       <treecols>
END;
        for ($i=0; $i<$nfields; $i++)
        {
            $fieldname = mysql_field_name($result, $i);
            $quote="/'/";
            $toto=preg_replace($quote,'_',$fieldname);
            $toto=fa_ent_xml_cabal($toto);
            echo '<treecol id="'.$toto.'" label="'.$fieldname.'" sort="?'.$toto.'"/>';
            echo('<splitter class="tree-splitter" resizeafter="grow"/>');
        }
echo <<<END
       </treecols>
       <template><query expr="*"/><action>
         <treechildren>
           <treeitem uri="?" seltype="single">
             <treerow>
END;
        for ($i=0; $i<$nfields; $i++)
        {
            $fieldname = mysql_field_name($result, $i);
            $quote="/'/";
            $toto=preg_replace($quote,'_',$fieldname);
            $fieldname=fa_ent_xml_cabal($toto);
            echo '<treecell label="?'.$fieldname.'"/>';
        }
mysql_free_result($result);
echo <<<END
             </treerow>
           </treeitem>
         </treechildren>
       </action></template>
    </tree>
  </vbox>
END;
?>
