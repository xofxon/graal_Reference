<?php
// (c) Xavier Nicolay
// Exemple de génération de devis/facture PDF

require('_aa_invoice_01.php');
class toto extends INVOICE {
function Header() {
	global $debut_bloc_lignes;
  switch ($this->getPage()) {
    case 1:
      $this->addSociete( "MaSociete",
                    "MonAdresse\n" .
                    "75000 PARIS\n".
                    "R.C.S. PARIS B 000 000 007\n" .
                    "Capital : 18000 " . EURO );
      $this->fact_dev( "Devis ", "TEMPO" );
      $this->temporaire( "Devis temporaire" );
      $this->addDate( "03/12/2003");
      $this->addClient("CL01");
      $this->addPageNumber($this->getPage()."/{nb}");
      $this->addClientAdresse("Ste\nM. XXXX\n3ème étage\n33, rue d'ailleurs\n75000 PARIS");
      $this->addReglement("Chèque à réception de facture");
      $this->addEcheance("03/12/2003");
      $this->addNumTVA("FR888777666");
      $this->addReference("Devis ... du ....",10,92);
      $this->_entete_tableau(10,100);
      $this->setY(109);
      $debut_bloc_lignes=109;
      break;
    default:
      $this->addSociete( "MaSociete",
                    "MonAdresse\n" .
                    "75000 PARIS\n".
                    "R.C.S. PARIS B 000 000 007\n" .
                    "Capital : 18000 " . EURO );
      $this->fact_dev( "Devis ", "TEMPO" );
      $this->temporaire( "Devis temporaire" );
      $this->addDate( "03/12/2003");
      $this->addClient("CL01");
      $this->addPageNumber($this->getPage()."/{nb}");
      $this->addReference("Devis ... du ....",10,52);
      $this->_entete_tableau(10,60);
      $this->setY(69);
      $debut_bloc_lignes=69;
      break;
  }
}
function _entete_tableau($r1=10,$y1=100) {
  $cols=array( "REFERENCE"    => 23,
               "DESIGNATION"  => 78,
               "QUANTITE"     => 22,
               "P.U. HT"      => 26,
               "MONTANT H.T." => 30,
               "TVA"          => 11 );
  $this->addCols( $cols,$r1,$y1);
  $cols=array( "REFERENCE"    => "L",
               "DESIGNATION"  => "L",
               "QUANTITE"     => "C",
               "P.U. HT"      => "R",
               "MONTANT H.T." => "R",
               "TVA"          => "C" );
  $this->addLineFormat($cols);
}
}
$pseudo_pdf = new toto( 'P', 'mm', 'A4' );
$pseudo_pdf->Open();
$pseudo_pdf->SetFont( "FreeSerif", "", 10);
$pdf = new toto( 'P', 'mm', 'A4' );
$pdf->Open();
$pdf->SetDisplayMode(75);
$pdf->AliasNbPages();
//$pdf->SetAutoPageBreak(20);// en mm
$pdf->AddPage();
$pdf->setY($debut_bloc_lignes);



$y    = $pdf->GetY();
$line = array( "REFERENCE"    => "REF1",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
$size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF2",
               "DESIGNATION"  => "Câble RS232",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  $pseudo_size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF3 bis",
               "DESIGNATION"  => "Câble RS232",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  $size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF3",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  $size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF4",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  $size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF5",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $size = round($pdf->addLine( $y_init, $line ),2);
  $y+= $pseudo_size + 2;
$line = array( "REFERENCE"    => "REF6",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $size = round($pdf->addLine( $y_init, $line ),2);
  $y+= $pseudo_size + 2;
$line = array( "REFERENCE"    => "REF7",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  $size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF8",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "$pseudo_size",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  if (($y_init+$pseudo_size + 2)>=200) {
    $pdf->AddPage();
    $pdf->SetY(69);
    $y=$pdf->GetY();
    $y_init=$y;
  }
  $size = round($pdf->addLine( $y_init, $line ),2);
  $y+= $size + 2;
$line = array( "REFERENCE"    => "REF9",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "600.00",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  if ($y>=200) {
    $pdf->AddPage();
    $y=$pdf->GetY();
  }
  $size = round($pdf->addLine( $y_init, $line ),2);
$line = array( "REFERENCE"    => "REF10",
               "DESIGNATION"  => "Carte Mère MSI 6378\n" .
                                 "Processeur AMD 1Ghz\n" .
                                 "128Mo SDRAM, 30 Go Disque, CD-ROM, Floppy, Carte vidéo",
               "QUANTITE"     => "1",
               "P.U. HT"      => "600.00",
               "MONTANT H.T." => "$y_init",
               "TVA"          => "1" );
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  if ($y>=200) {
    $pdf->AddPage();
    $y=$pdf->GetY();
  }
  $size = round($pdf->addLine( $y_init, $line ),2);
















$pdf->addCadreTVAs();
        
// invoice = array( "px_unit" => value,
//                  "qte"     => qte,
//                  "tva"     => code_tva );
// tab_tva = array( "1"       => 19.6,
//                  "2"       => 5.5, ... );
// params  = array( "RemiseGlobale" => [0|1],
//                      "remise_tva"     => [1|2...],  // {la remise s'applique sur ce code TVA}
//                      "remise"         => value,     // {montant de la remise}
//                      "remise_percent" => percent,   // {pourcentage de remise sur ce montant de TVA}
//                  "FraisPort"     => [0|1],
//                      "portTTC"        => value,     // montant des frais de ports TTC
//                                                     // par defaut la TVA = 19.6 %
//                      "portHT"         => value,     // montant des frais de ports HT
//                      "portTVA"        => tva_value, // valeur de la TVA a appliquer sur le montant HT
//                  "AccompteExige" => [0|1],
//                      "accompte"         => value    // montant de l'acompte (TTC)
//                      "accompte_percent" => percent  // pourcentage d'acompte (TTC)
//                  "Remarque" => "texte"              // texte
$tot_prods = array( array ( "px_unit" => 600, "qte" => 1, "tva" => 1 ),
                    array ( "px_unit" =>  10, "qte" => 1, "tva" => 1 ));
$tab_tva = array( "1"       => 19.6,
                  "2"       => 5.5);
$params  = array( "RemiseGlobale" => 1,
                      "remise_tva"     => 1,       // {la remise s'applique sur ce code TVA}
                      "remise"         => 0,       // {montant de la remise}
                      "remise_percent" => 10,      // {pourcentage de remise sur ce montant de TVA}
                  "FraisPort"     => 1,
                      "portTTC"        => 10,      // montant des frais de ports TTC
                                                   // par defaut la TVA = 19.6 %
                      "portHT"         => 0,       // montant des frais de ports HT
                      "portTVA"        => 19.6,    // valeur de la TVA a appliquer sur le montant HT
                  "AccompteExige" => 1,
                      "accompte"         => 0,     // montant de l'acompte (TTC)
                      "accompte_percent" => 15,    // pourcentage d'acompte (TTC)
                  "Remarque" => "Avec un acompte, svp..." );

$pdf->addTVAs( $params, $tab_tva, $tot_prods);
$pdf->addCadreEurosFrancs();
$pdf->Output();

function pf_verif_hauteur_dispo($line,$y) {
  global $pseudo_pdf,$pdf;
  $pseudo_size = round($pseudo_pdf->addLine( 1, $line ),2);
  $y_init=$y;
  $y+= $pseudo_size + 2;
  if ($y>=200) {
    $pdf->AddPage();
    $y=$pdf->GetY();
  } else {
    $y+= $size + 2;
  }
/*
  $size = round($pdf->addLine( $y_init, $line ),2);
  return $size;
*/
  return $pseudo_size;
}



?>
