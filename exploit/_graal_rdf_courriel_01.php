<?php
include("_graal_header_xml.inc.php");
define('EOL', "\r\n");
$recherche=fa_recup_param('recherche','ch');
$limit=intval(fa_recup_param('limit','50'));
$sql_req="SELECT intweb_cleunik,recherche,nomcommercial,type_acteur_clair FROM _vue_courriels_02 where recherche like '%$recherche%' limit $limit;";
$result = _graal_requete_bd($sql_req);
echo('<?xml version="1.0" encoding="UTF-8"?>');
echo('<RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:NC="http://home.netscape.com/NC-rdf#" xmlns:KEY="urn:suggest:rdf#">');
echo('<RDF:Seq RDF:about="urn:suggest:values">');
$vl_e_nombre_enr=mysql_num_rows($result);
if ($vl_e_nombre_enr!=0) { 
  while ($row = mysql_fetch_assoc($result)){
    echo('<RDF:li><RDF:Description KEY:label="'.fa_ent_xml($row['recherche']).'['.fa_ent_xml($row['nomcommercial']).'    '.fa_ent_xml($row['type_acteur_clair']).']" KEY:issuggest="'.fa_ent_xml($row['intweb_cleunik']).'" KEY:prop=""/></RDF:li>'.EOL);
  }    
echo <<<END
  </RDF:Seq>
  <RDF:Seq RDF:about="urn:suggest:nb">
    <RDF:li><RDF:Description RDF:number="$vl_e_nombre_enr"/></RDF:li>
  </RDF:Seq>
END;
} else {
echo <<<END
  </RDF:Seq>
  <RDF:Seq RDF:about="urn:suggest:nb">
    <RDF:li><RDF:Description RDF:number="$vl_e_nombre_enr"/></RDF:li>
  </RDF:Seq>
END;
}
echo('</RDF:RDF>'.EOL);
_graal_libere_requete_bd($result);
?>
